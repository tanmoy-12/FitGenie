var Sde=Object.create;var Jw=Object.defineProperty,Ide=Object.defineProperties,Ede=Object.getOwnPropertyDescriptor,Tde=Object.getOwnPropertyDescriptors,Dde=Object.getOwnPropertyNames,RV=Object.getOwnPropertySymbols,MV=Object.getPrototypeOf,PV=Object.prototype.hasOwnProperty,kde=Object.prototype.propertyIsEnumerable,Nde=Reflect.get;var OV=(n,t,e)=>t in n?Jw(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,ke=(n,t)=>{for(var e in t||={})PV.call(t,e)&&OV(n,e,t[e]);if(RV)for(var e of RV(t))kde.call(t,e)&&OV(n,e,t[e]);return n},Ft=(n,t)=>Ide(n,Tde(t));var is=(n,t)=>()=>(t||n((t={exports:{}}).exports,t),t.exports),bn=(n,t)=>{for(var e in t)Jw(n,e,{get:t[e],enumerable:!0})},Ade=(n,t,e,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Dde(t))!PV.call(n,o)&&o!==e&&Jw(n,o,{get:()=>t[o],enumerable:!(r=Ede(t,o))||r.enumerable});return n};var rg=(n,t,e)=>(e=n!=null?Sde(MV(n)):{},Ade(t||!n||!n.__esModule?Jw(e,"default",{value:n,enumerable:!0}):e,n));var fh=(n,t,e)=>Nde(MV(n),e,t);var B=(n,t,e)=>new Promise((r,o)=>{var i=l=>{try{a(e.next(l))}catch(c){o(c)}},s=l=>{try{a(e.throw(l))}catch(c){o(c)}},a=l=>l.done?r(l.value):Promise.resolve(l.value).then(i,s);a((e=e.apply(n,t)).next())});var F6=is((Not,P6)=>{"use strict";P6.exports=mr;var Us=null;try{Us=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function mr(n,t,e){this.low=n|0,this.high=t|0,this.unsigned=!!e}mr.prototype.__isLong__;Object.defineProperty(mr.prototype,"__isLong__",{value:!0});function Wi(n){return(n&&n.__isLong__)===!0}mr.isLong=Wi;var E6={},T6={};function tm(n,t){var e,r,o;return t?(n>>>=0,(o=0<=n&&n<256)&&(r=T6[n],r)?r:(e=gr(n,(n|0)<0?-1:0,!0),o&&(T6[n]=e),e)):(n|=0,(o=-128<=n&&n<128)&&(r=E6[n],r)?r:(e=gr(n,n<0?-1:0,!1),o&&(E6[n]=e),e))}mr.fromInt=tm;function Ws(n,t){if(isNaN(n))return t?em:Gs;if(t){if(n<0)return em;if(n>=A6)return M6}else{if(n<=-k6)return Ui;if(n+1>=k6)return O6}return n<0?Ws(-n,t).neg():gr(n%zy|0,n/zy|0,t)}mr.fromNumber=Ws;function gr(n,t,e){return new mr(n,t,e)}mr.fromBits=gr;var EI=Math.pow;function BP(n,t,e){if(n.length===0)throw Error("empty string");if(n==="NaN"||n==="Infinity"||n==="+Infinity"||n==="-Infinity")return Gs;if(typeof t=="number"?(e=t,t=!1):t=!!t,e=e||10,e<2||36<e)throw RangeError("radix");var r;if((r=n.indexOf("-"))>0)throw Error("interior hyphen");if(r===0)return BP(n.substring(1),t,e).neg();for(var o=Ws(EI(e,8)),i=Gs,s=0;s<n.length;s+=8){var a=Math.min(8,n.length-s),l=parseInt(n.substring(s,s+a),e);if(a<8){var c=Ws(EI(e,a));i=i.mul(c).add(Ws(l))}else i=i.mul(o),i=i.add(Ws(l))}return i.unsigned=t,i}mr.fromString=BP;function Il(n,t){return typeof n=="number"?Ws(n,t):typeof n=="string"?BP(n,t):gr(n.low,n.high,typeof t=="boolean"?t:n.unsigned)}mr.fromValue=Il;var D6=65536,b1e=1<<24,zy=D6*D6,A6=zy*zy,k6=A6/2,N6=tm(b1e),Gs=tm(0);mr.ZERO=Gs;var em=tm(0,!0);mr.UZERO=em;var By=tm(1);mr.ONE=By;var R6=tm(1,!0);mr.UONE=R6;var VP=tm(-1);mr.NEG_ONE=VP;var O6=gr(-1,2147483647,!1);mr.MAX_VALUE=O6;var M6=gr(-1,-1,!0);mr.MAX_UNSIGNED_VALUE=M6;var Ui=gr(0,-2147483648,!1);mr.MIN_VALUE=Ui;var We=mr.prototype;We.toInt=function(){return this.unsigned?this.low>>>0:this.low};We.toNumber=function(){return this.unsigned?(this.high>>>0)*zy+(this.low>>>0):this.high*zy+(this.low>>>0)};We.toString=function(t){if(t=t||10,t<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Ui)){var e=Ws(t),r=this.div(e),o=r.mul(e).sub(this);return r.toString(t)+o.toInt().toString(t)}else return"-"+this.neg().toString(t);for(var i=Ws(EI(t,6),this.unsigned),s=this,a="";;){var l=s.div(i),c=s.sub(l.mul(i)).toInt()>>>0,u=c.toString(t);if(s=l,s.isZero())return u+a;for(;u.length<6;)u="0"+u;a=""+u+a}};We.getHighBits=function(){return this.high};We.getHighBitsUnsigned=function(){return this.high>>>0};We.getLowBits=function(){return this.low};We.getLowBitsUnsigned=function(){return this.low>>>0};We.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Ui)?64:this.neg().getNumBitsAbs();for(var t=this.high!=0?this.high:this.low,e=31;e>0&&!(t&1<<e);e--);return this.high!=0?e+33:e+1};We.isZero=function(){return this.high===0&&this.low===0};We.eqz=We.isZero;We.isNegative=function(){return!this.unsigned&&this.high<0};We.isPositive=function(){return this.unsigned||this.high>=0};We.isOdd=function(){return(this.low&1)===1};We.isEven=function(){return(this.low&1)===0};We.equals=function(t){return Wi(t)||(t=Il(t)),this.unsigned!==t.unsigned&&this.high>>>31===1&&t.high>>>31===1?!1:this.high===t.high&&this.low===t.low};We.eq=We.equals;We.notEquals=function(t){return!this.eq(t)};We.neq=We.notEquals;We.ne=We.notEquals;We.lessThan=function(t){return this.comp(t)<0};We.lt=We.lessThan;We.lessThanOrEqual=function(t){return this.comp(t)<=0};We.lte=We.lessThanOrEqual;We.le=We.lessThanOrEqual;We.greaterThan=function(t){return this.comp(t)>0};We.gt=We.greaterThan;We.greaterThanOrEqual=function(t){return this.comp(t)>=0};We.gte=We.greaterThanOrEqual;We.ge=We.greaterThanOrEqual;We.compare=function(t){if(Wi(t)||(t=Il(t)),this.eq(t))return 0;var e=this.isNegative(),r=t.isNegative();return e&&!r?-1:!e&&r?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1};We.comp=We.compare;We.negate=function(){return!this.unsigned&&this.eq(Ui)?Ui:this.not().add(By)};We.neg=We.negate;We.add=function(t){Wi(t)||(t=Il(t));var e=this.high>>>16,r=this.high&65535,o=this.low>>>16,i=this.low&65535,s=t.high>>>16,a=t.high&65535,l=t.low>>>16,c=t.low&65535,u=0,d=0,p=0,f=0;return f+=i+c,p+=f>>>16,f&=65535,p+=o+l,d+=p>>>16,p&=65535,d+=r+a,u+=d>>>16,d&=65535,u+=e+s,u&=65535,gr(p<<16|f,u<<16|d,this.unsigned)};We.subtract=function(t){return Wi(t)||(t=Il(t)),this.add(t.neg())};We.sub=We.subtract;We.multiply=function(t){if(this.isZero())return Gs;if(Wi(t)||(t=Il(t)),Us){var e=Us.mul(this.low,this.high,t.low,t.high);return gr(e,Us.get_high(),this.unsigned)}if(t.isZero())return Gs;if(this.eq(Ui))return t.isOdd()?Ui:Gs;if(t.eq(Ui))return this.isOdd()?Ui:Gs;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(N6)&&t.lt(N6))return Ws(this.toNumber()*t.toNumber(),this.unsigned);var r=this.high>>>16,o=this.high&65535,i=this.low>>>16,s=this.low&65535,a=t.high>>>16,l=t.high&65535,c=t.low>>>16,u=t.low&65535,d=0,p=0,f=0,h=0;return h+=s*u,f+=h>>>16,h&=65535,f+=i*u,p+=f>>>16,f&=65535,f+=s*c,p+=f>>>16,f&=65535,p+=o*u,d+=p>>>16,p&=65535,p+=i*c,d+=p>>>16,p&=65535,p+=s*l,d+=p>>>16,p&=65535,d+=r*u+o*c+i*l+s*a,d&=65535,gr(f<<16|h,d<<16|p,this.unsigned)};We.mul=We.multiply;We.divide=function(t){if(Wi(t)||(t=Il(t)),t.isZero())throw Error("division by zero");if(Us){if(!this.unsigned&&this.high===-2147483648&&t.low===-1&&t.high===-1)return this;var e=(this.unsigned?Us.div_u:Us.div_s)(this.low,this.high,t.low,t.high);return gr(e,Us.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?em:Gs;var r,o,i;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return em;if(t.gt(this.shru(1)))return R6;i=em}else{if(this.eq(Ui)){if(t.eq(By)||t.eq(VP))return Ui;if(t.eq(Ui))return By;var s=this.shr(1);return r=s.div(t).shl(1),r.eq(Gs)?t.isNegative()?By:VP:(o=this.sub(t.mul(r)),i=r.add(o.div(t)),i)}else if(t.eq(Ui))return this.unsigned?em:Gs;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();i=Gs}for(o=this;o.gte(t);){r=Math.max(1,Math.floor(o.toNumber()/t.toNumber()));for(var a=Math.ceil(Math.log(r)/Math.LN2),l=a<=48?1:EI(2,a-48),c=Ws(r),u=c.mul(t);u.isNegative()||u.gt(o);)r-=l,c=Ws(r,this.unsigned),u=c.mul(t);c.isZero()&&(c=By),i=i.add(c),o=o.sub(u)}return i};We.div=We.divide;We.modulo=function(t){if(Wi(t)||(t=Il(t)),Us){var e=(this.unsigned?Us.rem_u:Us.rem_s)(this.low,this.high,t.low,t.high);return gr(e,Us.get_high(),this.unsigned)}return this.sub(this.div(t).mul(t))};We.mod=We.modulo;We.rem=We.modulo;We.not=function(){return gr(~this.low,~this.high,this.unsigned)};We.and=function(t){return Wi(t)||(t=Il(t)),gr(this.low&t.low,this.high&t.high,this.unsigned)};We.or=function(t){return Wi(t)||(t=Il(t)),gr(this.low|t.low,this.high|t.high,this.unsigned)};We.xor=function(t){return Wi(t)||(t=Il(t)),gr(this.low^t.low,this.high^t.high,this.unsigned)};We.shiftLeft=function(t){return Wi(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?gr(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):gr(0,this.low<<t-32,this.unsigned)};We.shl=We.shiftLeft;We.shiftRight=function(t){return Wi(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?gr(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):gr(this.high>>t-32,this.high>=0?0:-1,this.unsigned)};We.shr=We.shiftRight;We.shiftRightUnsigned=function(t){if(Wi(t)&&(t=t.toInt()),t&=63,t===0)return this;var e=this.high;if(t<32){var r=this.low;return gr(r>>>t|e<<32-t,e>>>t,this.unsigned)}else return t===32?gr(e,0,this.unsigned):gr(e>>>t-32,0,this.unsigned)};We.shru=We.shiftRightUnsigned;We.shr_u=We.shiftRightUnsigned;We.toSigned=function(){return this.unsigned?gr(this.low,this.high,!1):this};We.toUnsigned=function(){return this.unsigned?this:gr(this.low,this.high,!0)};We.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()};We.toBytesLE=function(){var t=this.high,e=this.low;return[e&255,e>>>8&255,e>>>16&255,e>>>24,t&255,t>>>8&255,t>>>16&255,t>>>24]};We.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24,t>>>16&255,t>>>8&255,t&255,e>>>24,e>>>16&255,e>>>8&255,e&255]};mr.fromBytes=function(t,e,r){return r?mr.fromBytesLE(t,e):mr.fromBytesBE(t,e)};mr.fromBytesLE=function(t,e){return new mr(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,e)};mr.fromBytesBE=function(t,e){return new mr(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],e)}});var E5=is((Yy,I5)=>{"use strict";var sEe=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},um=sEe();I5.exports=Yy=um.fetch;um.fetch&&(Yy.default=um.fetch.bind(um));Yy.Headers=um.Headers;Yy.Request=um.Request;Yy.Response=um.Response});var T5=is(()=>{"use strict"});var nq=is((tq,hF)=>{"use strict";(function(n,t,e){function r(a){var l=this,c=s();l.next=function(){var u=2091639*l.s0+l.c*23283064365386963e-26;return l.s0=l.s1,l.s1=l.s2,l.s2=u-(l.c=u|0)},l.c=1,l.s0=c(" "),l.s1=c(" "),l.s2=c(" "),l.s0-=c(a),l.s0<0&&(l.s0+=1),l.s1-=c(a),l.s1<0&&(l.s1+=1),l.s2-=c(a),l.s2<0&&(l.s2+=1),c=null}function o(a,l){return l.c=a.c,l.s0=a.s0,l.s1=a.s1,l.s2=a.s2,l}function i(a,l){var c=new r(a),u=l&&l.state,d=c.next;return d.int32=function(){return c.next()*4294967296|0},d.double=function(){return d()+(d()*2097152|0)*11102230246251565e-32},d.quick=d,u&&(typeof u=="object"&&o(u,c),d.state=function(){return o(c,{})}),d}function s(){var a=4022871197,l=function(c){c=String(c);for(var u=0;u<c.length;u++){a+=c.charCodeAt(u);var d=.02519603282416938*a;a=d>>>0,d-=a,d*=a,a=d>>>0,d-=a,a+=d*4294967296}return(a>>>0)*23283064365386963e-26};return l}t&&t.exports?t.exports=i:e&&e.amd?e(function(){return i}):this.alea=i})(tq,typeof hF=="object"&&hF,typeof define=="function"&&define)});var oq=is((rq,mF)=>{"use strict";(function(n,t,e){function r(s){var a=this,l="";a.x=0,a.y=0,a.z=0,a.w=0,a.next=function(){var u=a.x^a.x<<11;return a.x=a.y,a.y=a.z,a.z=a.w,a.w^=a.w>>>19^u^u>>>8},s===(s|0)?a.x=s:l+=s;for(var c=0;c<l.length+64;c++)a.x^=l.charCodeAt(c)|0,a.next()}function o(s,a){return a.x=s.x,a.y=s.y,a.z=s.z,a.w=s.w,a}function i(s,a){var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(typeof c=="object"&&o(c,l),u.state=function(){return o(l,{})}),u}t&&t.exports?t.exports=i:e&&e.amd?e(function(){return i}):this.xor128=i})(rq,typeof mF=="object"&&mF,typeof define=="function"&&define)});var sq=is((iq,gF)=>{"use strict";(function(n,t,e){function r(s){var a=this,l="";a.next=function(){var u=a.x^a.x>>>2;return a.x=a.y,a.y=a.z,a.z=a.w,a.w=a.v,(a.d=a.d+362437|0)+(a.v=a.v^a.v<<4^(u^u<<1))|0},a.x=0,a.y=0,a.z=0,a.w=0,a.v=0,s===(s|0)?a.x=s:l+=s;for(var c=0;c<l.length+64;c++)a.x^=l.charCodeAt(c)|0,c==l.length&&(a.d=a.x<<10^a.x>>>4),a.next()}function o(s,a){return a.x=s.x,a.y=s.y,a.z=s.z,a.w=s.w,a.v=s.v,a.d=s.d,a}function i(s,a){var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(typeof c=="object"&&o(c,l),u.state=function(){return o(l,{})}),u}t&&t.exports?t.exports=i:e&&e.amd?e(function(){return i}):this.xorwow=i})(iq,typeof gF=="object"&&gF,typeof define=="function"&&define)});var lq=is((aq,yF)=>{"use strict";(function(n,t,e){function r(s){var a=this;a.next=function(){var c=a.x,u=a.i,d,p,f;return d=c[u],d^=d>>>7,p=d^d<<24,d=c[u+1&7],p^=d^d>>>10,d=c[u+3&7],p^=d^d>>>3,d=c[u+4&7],p^=d^d<<7,d=c[u+7&7],d=d^d<<13,p^=d^d<<9,c[u]=p,a.i=u+1&7,p};function l(c,u){var d,p,f=[];if(u===(u|0))p=f[0]=u;else for(u=""+u,d=0;d<u.length;++d)f[d&7]=f[d&7]<<15^u.charCodeAt(d)+f[d+1&7]<<13;for(;f.length<8;)f.push(0);for(d=0;d<8&&f[d]===0;++d);for(d==8?p=f[7]=-1:p=f[d],c.x=f,c.i=0,d=256;d>0;--d)c.next()}l(a,s)}function o(s,a){return a.x=s.x.slice(),a.i=s.i,a}function i(s,a){s==null&&(s=+new Date);var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(c.x&&o(c,l),u.state=function(){return o(l,{})}),u}t&&t.exports?t.exports=i:e&&e.amd?e(function(){return i}):this.xorshift7=i})(aq,typeof yF=="object"&&yF,typeof define=="function"&&define)});var uq=is((cq,xF)=>{"use strict";(function(n,t,e){function r(s){var a=this;a.next=function(){var c=a.w,u=a.X,d=a.i,p,f;return a.w=c=c+1640531527|0,f=u[d+34&127],p=u[d=d+1&127],f^=f<<13,p^=p<<17,f^=f>>>15,p^=p>>>12,f=u[d]=f^p,a.i=d,f+(c^c>>>16)|0};function l(c,u){var d,p,f,h,m,g=[],y=128;for(u===(u|0)?(p=u,u=null):(u=u+"\0",p=0,y=Math.max(y,u.length)),f=0,h=-32;h<y;++h)u&&(p^=u.charCodeAt((h+32)%u.length)),h===0&&(m=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,h>=0&&(m=m+1640531527|0,d=g[h&127]^=p+m,f=d==0?f+1:0);for(f>=128&&(g[(u&&u.length||0)&127]=-1),f=127,h=4*128;h>0;--h)p=g[f+34&127],d=g[f=f+1&127],p^=p<<13,d^=d<<17,p^=p>>>15,d^=d>>>12,g[f]=p^d;c.w=m,c.X=g,c.i=f}l(a,s)}function o(s,a){return a.i=s.i,a.w=s.w,a.X=s.X.slice(),a}function i(s,a){s==null&&(s=+new Date);var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(c.X&&o(c,l),u.state=function(){return o(l,{})}),u}t&&t.exports?t.exports=i:e&&e.amd?e(function(){return i}):this.xor4096=i})(cq,typeof xF=="object"&&xF,typeof define=="function"&&define)});var pq=is((dq,vF)=>{"use strict";(function(n,t,e){function r(s){var a=this,l="";a.next=function(){var u=a.b,d=a.c,p=a.d,f=a.a;return u=u<<25^u>>>7^d,d=d-p|0,p=p<<24^p>>>8^f,f=f-u|0,a.b=u=u<<20^u>>>12^d,a.c=d=d-p|0,a.d=p<<16^d>>>16^f,a.a=f-u|0},a.a=0,a.b=0,a.c=-1640531527,a.d=1367130551,s===Math.floor(s)?(a.a=s/4294967296|0,a.b=s|0):l+=s;for(var c=0;c<l.length+20;c++)a.b^=l.charCodeAt(c)|0,a.next()}function o(s,a){return a.a=s.a,a.b=s.b,a.c=s.c,a.d=s.d,a}function i(s,a){var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(typeof c=="object"&&o(c,l),u.state=function(){return o(l,{})}),u}t&&t.exports?t.exports=i:e&&e.amd?e(function(){return i}):this.tychei=i})(dq,typeof vF=="object"&&vF,typeof define=="function"&&define)});var fq=is(()=>{"use strict"});var mq=is((hq,I1)=>{"use strict";(function(n,t,e){var r=256,o=6,i=52,s="random",a=e.pow(r,o),l=e.pow(2,i),c=l*2,u=r-1,d;function p(w,C,I){var A=[];C=C==!0?{entropy:!0}:C||{};var M=g(m(C.entropy?[w,v(t)]:w??y(),3),A),$=new f(A),V=function(){for(var W=$.g(o),K=a,te=0;W<l;)W=(W+te)*r,K*=r,te=$.g(1);for(;W>=c;)W/=2,K/=2,te>>>=1;return(W+te)/K};return V.int32=function(){return $.g(4)|0},V.quick=function(){return $.g(4)/4294967296},V.double=V,g(v($.S),t),(C.pass||I||function(W,K,te,ee){return ee&&(ee.S&&h(ee,$),W.state=function(){return h($,{})}),te?(e[s]=W,K):W})(V,M,"global"in C?C.global:this==e,C.state)}function f(w){var C,I=w.length,A=this,M=0,$=A.i=A.j=0,V=A.S=[];for(I||(w=[I++]);M<r;)V[M]=M++;for(M=0;M<r;M++)V[M]=V[$=u&$+w[M%I]+(C=V[M])],V[$]=C;(A.g=function(W){for(var K,te=0,ee=A.i,oe=A.j,ie=A.S;W--;)K=ie[ee=u&ee+1],te=te*r+ie[u&(ie[ee]=ie[oe=u&oe+K])+(ie[oe]=K)];return A.i=ee,A.j=oe,te})(r)}function h(w,C){return C.i=w.i,C.j=w.j,C.S=w.S.slice(),C}function m(w,C){var I=[],A=typeof w,M;if(C&&A=="object")for(M in w)try{I.push(m(w[M],C-1))}catch{}return I.length?I:A=="string"?w:w+"\0"}function g(w,C){for(var I=w+"",A,M=0;M<I.length;)C[u&M]=u&(A^=C[u&M]*19)+I.charCodeAt(M++);return v(C)}function y(){try{var w;return d&&(w=d.randomBytes)?w=w(r):(w=new Uint8Array(r),(n.crypto||n.msCrypto).getRandomValues(w)),v(w)}catch{var C=n.navigator,I=C&&C.plugins;return[+new Date,n,I,n.screen,v(t)]}}function v(w){return String.fromCharCode.apply(0,w)}if(g(e.random(),t),typeof I1=="object"&&I1.exports){I1.exports=p;try{d=fq()}catch{}}else typeof define=="function"&&define.amd?define(function(){return p}):e["seed"+s]=p})(typeof self<"u"?self:hq,[],Math)});var Ab=is((gbt,gq)=>{"use strict";var jDe=nq(),HDe=oq(),qDe=sq(),KDe=lq(),XDe=uq(),YDe=pq(),ym=mq();ym.alea=jDe;ym.xor128=HDe;ym.xorwow=qDe;ym.xorshift7=KDe;ym.xor4096=XDe;ym.tychei=YDe;gq.exports=ym});var Pie=is(Mie=>{"use strict";(function(){"use strict";var n;function t(x){var _=0;return function(){return _<x.length?{done:!1,value:x[_++]}:{done:!0}}}var e=typeof Object.defineProperties=="function"?Object.defineProperty:function(x,_,N){return x==Array.prototype||x==Object.prototype||(x[_]=N.value),x};function r(x){x=[typeof globalThis=="object"&&globalThis,x,typeof window=="object"&&window,typeof self=="object"&&self,typeof global=="object"&&global];for(var _=0;_<x.length;++_){var N=x[_];if(N&&N.Math==Math)return N}throw Error("Cannot find global object")}var o=r(this);function i(x,_){if(_)e:{var N=o;x=x.split(".");for(var F=0;F<x.length-1;F++){var H=x[F];if(!(H in N))break e;N=N[H]}x=x[x.length-1],F=N[x],_=_(F),_!=F&&_!=null&&e(N,x,{configurable:!0,writable:!0,value:_})}}i("Symbol",function(x){function _(Y){if(this instanceof _)throw new TypeError("Symbol is not a constructor");return new N(F+(Y||"")+"_"+H++,Y)}function N(Y,X){this.h=Y,e(this,"description",{configurable:!0,writable:!0,value:X})}if(x)return x;N.prototype.toString=function(){return this.h};var F="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",H=0;return _}),i("Symbol.iterator",function(x){if(x)return x;x=Symbol("Symbol.iterator");for(var _="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),N=0;N<_.length;N++){var F=o[_[N]];typeof F=="function"&&typeof F.prototype[x]!="function"&&e(F.prototype,x,{configurable:!0,writable:!0,value:function(){return s(t(this))}})}return x});function s(x){return x={next:x},x[Symbol.iterator]=function(){return this},x}function a(x){var _=typeof Symbol<"u"&&Symbol.iterator&&x[Symbol.iterator];return _?_.call(x):{next:t(x)}}function l(x){if(!(x instanceof Array)){x=a(x);for(var _,N=[];!(_=x.next()).done;)N.push(_.value);x=N}return x}var c=typeof Object.assign=="function"?Object.assign:function(x,_){for(var N=1;N<arguments.length;N++){var F=arguments[N];if(F)for(var H in F)Object.prototype.hasOwnProperty.call(F,H)&&(x[H]=F[H])}return x};i("Object.assign",function(x){return x||c});var u=typeof Object.create=="function"?Object.create:function(x){function _(){}return _.prototype=x,new _},d;if(typeof Object.setPrototypeOf=="function")d=Object.setPrototypeOf;else{var p;e:{var f={a:!0},h={};try{h.__proto__=f,p=h.a;break e}catch{}p=!1}d=p?function(x,_){if(x.__proto__=_,x.__proto__!==_)throw new TypeError(x+" is not extensible");return x}:null}var m=d;function g(x,_){if(x.prototype=u(_.prototype),x.prototype.constructor=x,m)m(x,_);else for(var N in _)if(N!="prototype")if(Object.defineProperties){var F=Object.getOwnPropertyDescriptor(_,N);F&&Object.defineProperty(x,N,F)}else x[N]=_[N];x.za=_.prototype}function y(){this.m=!1,this.j=null,this.i=void 0,this.h=1,this.v=this.s=0,this.l=null}function v(x){if(x.m)throw new TypeError("Generator is already running");x.m=!0}y.prototype.u=function(x){this.i=x};function w(x,_){x.l={ma:_,na:!0},x.h=x.s||x.v}y.prototype.return=function(x){this.l={return:x},this.h=this.v};function C(x,_,N){return x.h=N,{value:_}}function I(x){this.h=new y,this.i=x}function A(x,_){v(x.h);var N=x.h.j;return N?M(x,"return"in N?N.return:function(F){return{value:F,done:!0}},_,x.h.return):(x.h.return(_),$(x))}function M(x,_,N,F){try{var H=_.call(x.h.j,N);if(!(H instanceof Object))throw new TypeError("Iterator result "+H+" is not an object");if(!H.done)return x.h.m=!1,H;var Y=H.value}catch(X){return x.h.j=null,w(x.h,X),$(x)}return x.h.j=null,F.call(x.h,Y),$(x)}function $(x){for(;x.h.h;)try{var _=x.i(x.h);if(_)return x.h.m=!1,{value:_.value,done:!1}}catch(N){x.h.i=void 0,w(x.h,N)}if(x.h.m=!1,x.h.l){if(_=x.h.l,x.h.l=null,_.na)throw _.ma;return{value:_.return,done:!0}}return{value:void 0,done:!0}}function V(x){this.next=function(_){return v(x.h),x.h.j?_=M(x,x.h.j.next,_,x.h.u):(x.h.u(_),_=$(x)),_},this.throw=function(_){return v(x.h),x.h.j?_=M(x,x.h.j.throw,_,x.h.u):(w(x.h,_),_=$(x)),_},this.return=function(_){return A(x,_)},this[Symbol.iterator]=function(){return this}}function W(x){function _(F){return x.next(F)}function N(F){return x.throw(F)}return new Promise(function(F,H){function Y(X){X.done?F(X.value):Promise.resolve(X.value).then(_,N).then(Y,H)}Y(x.next())})}function K(x){return W(new V(new I(x)))}i("Promise",function(x){function _(X){this.i=0,this.j=void 0,this.h=[],this.u=!1;var ne=this.l();try{X(ne.resolve,ne.reject)}catch(he){ne.reject(he)}}function N(){this.h=null}function F(X){return X instanceof _?X:new _(function(ne){ne(X)})}if(x)return x;N.prototype.i=function(X){if(this.h==null){this.h=[];var ne=this;this.j(function(){ne.m()})}this.h.push(X)};var H=o.setTimeout;N.prototype.j=function(X){H(X,0)},N.prototype.m=function(){for(;this.h&&this.h.length;){var X=this.h;this.h=[];for(var ne=0;ne<X.length;++ne){var he=X[ne];X[ne]=null;try{he()}catch(Oe){this.l(Oe)}}}this.h=null},N.prototype.l=function(X){this.j(function(){throw X})},_.prototype.l=function(){function X(Oe){return function(Ue){he||(he=!0,Oe.call(ne,Ue))}}var ne=this,he=!1;return{resolve:X(this.I),reject:X(this.m)}},_.prototype.I=function(X){if(X===this)this.m(new TypeError("A Promise cannot resolve to itself"));else if(X instanceof _)this.L(X);else{e:switch(typeof X){case"object":var ne=X!=null;break e;case"function":ne=!0;break e;default:ne=!1}ne?this.F(X):this.s(X)}},_.prototype.F=function(X){var ne=void 0;try{ne=X.then}catch(he){this.m(he);return}typeof ne=="function"?this.M(ne,X):this.s(X)},_.prototype.m=function(X){this.v(2,X)},_.prototype.s=function(X){this.v(1,X)},_.prototype.v=function(X,ne){if(this.i!=0)throw Error("Cannot settle("+X+", "+ne+"): Promise already settled in state"+this.i);this.i=X,this.j=ne,this.i===2&&this.K(),this.H()},_.prototype.K=function(){var X=this;H(function(){if(X.D()){var ne=o.console;typeof ne<"u"&&ne.error(X.j)}},1)},_.prototype.D=function(){if(this.u)return!1;var X=o.CustomEvent,ne=o.Event,he=o.dispatchEvent;return typeof he>"u"?!0:(typeof X=="function"?X=new X("unhandledrejection",{cancelable:!0}):typeof ne=="function"?X=new ne("unhandledrejection",{cancelable:!0}):(X=o.document.createEvent("CustomEvent"),X.initCustomEvent("unhandledrejection",!1,!0,X)),X.promise=this,X.reason=this.j,he(X))},_.prototype.H=function(){if(this.h!=null){for(var X=0;X<this.h.length;++X)Y.i(this.h[X]);this.h=null}};var Y=new N;return _.prototype.L=function(X){var ne=this.l();X.T(ne.resolve,ne.reject)},_.prototype.M=function(X,ne){var he=this.l();try{X.call(ne,he.resolve,he.reject)}catch(Oe){he.reject(Oe)}},_.prototype.then=function(X,ne){function he(dt,Ke){return typeof dt=="function"?function(Et){try{Oe(dt(Et))}catch(Zt){Ue(Zt)}}:Ke}var Oe,Ue,It=new _(function(dt,Ke){Oe=dt,Ue=Ke});return this.T(he(X,Oe),he(ne,Ue)),It},_.prototype.catch=function(X){return this.then(void 0,X)},_.prototype.T=function(X,ne){function he(){switch(Oe.i){case 1:X(Oe.j);break;case 2:ne(Oe.j);break;default:throw Error("Unexpected state: "+Oe.i)}}var Oe=this;this.h==null?Y.i(he):this.h.push(he),this.u=!0},_.resolve=F,_.reject=function(X){return new _(function(ne,he){he(X)})},_.race=function(X){return new _(function(ne,he){for(var Oe=a(X),Ue=Oe.next();!Ue.done;Ue=Oe.next())F(Ue.value).T(ne,he)})},_.all=function(X){var ne=a(X),he=ne.next();return he.done?F([]):new _(function(Oe,Ue){function It(Et){return function(Zt){dt[Et]=Zt,Ke--,Ke==0&&Oe(dt)}}var dt=[],Ke=0;do dt.push(void 0),Ke++,F(he.value).T(It(dt.length-1),Ue),he=ne.next();while(!he.done)})},_});function te(x,_){x instanceof String&&(x+="");var N=0,F=!1,H={next:function(){if(!F&&N<x.length){var Y=N++;return{value:_(Y,x[Y]),done:!1}}return F=!0,{done:!0,value:void 0}}};return H[Symbol.iterator]=function(){return H},H}i("Array.prototype.keys",function(x){return x||function(){return te(this,function(_){return _})}}),i("Array.prototype.fill",function(x){return x||function(_,N,F){var H=this.length||0;for(0>N&&(N=Math.max(0,H+N)),(F==null||F>H)&&(F=H),F=Number(F),0>F&&(F=Math.max(0,H+F)),N=Number(N||0);N<F;N++)this[N]=_;return this}});function ee(x){return x||Array.prototype.fill}i("Int8Array.prototype.fill",ee),i("Uint8Array.prototype.fill",ee),i("Uint8ClampedArray.prototype.fill",ee),i("Int16Array.prototype.fill",ee),i("Uint16Array.prototype.fill",ee),i("Int32Array.prototype.fill",ee),i("Uint32Array.prototype.fill",ee),i("Float32Array.prototype.fill",ee),i("Float64Array.prototype.fill",ee),i("Object.is",function(x){return x||function(_,N){return _===N?_!==0||1/_===1/N:_!==_&&N!==N}}),i("Array.prototype.includes",function(x){return x||function(_,N){var F=this;F instanceof String&&(F=String(F));var H=F.length;for(N=N||0,0>N&&(N=Math.max(N+H,0));N<H;N++){var Y=F[N];if(Y===_||Object.is(Y,_))return!0}return!1}}),i("String.prototype.includes",function(x){return x||function(_,N){if(this==null)throw new TypeError("The 'this' value for String.prototype.includes must not be null or undefined");if(_ instanceof RegExp)throw new TypeError("First argument to String.prototype.includes must not be a regular expression");return this.indexOf(_,N||0)!==-1}});var oe=this||self;function ie(x,_){x=x.split(".");var N=oe;x[0]in N||typeof N.execScript>"u"||N.execScript("var "+x[0]);for(var F;x.length&&(F=x.shift());)x.length||_===void 0?N[F]&&N[F]!==Object.prototype[F]?N=N[F]:N=N[F]={}:N[F]=_}function se(x){var _;e:{if((_=oe.navigator)&&(_=_.userAgent))break e;_=""}return _.indexOf(x)!=-1}var fe=Array.prototype.map?function(x,_){return Array.prototype.map.call(x,_,void 0)}:function(x,_){for(var N=x.length,F=Array(N),H=typeof x=="string"?x.split(""):x,Y=0;Y<N;Y++)Y in H&&(F[Y]=_.call(void 0,H[Y],Y,x));return F},ue={},ye=null;function Te(x){var _=x.length,N=3*_/4;N%3?N=Math.floor(N):"=.".indexOf(x[_-1])!=-1&&(N="=.".indexOf(x[_-2])!=-1?N-2:N-1);var F=new Uint8Array(N),H=0;return De(x,function(Y){F[H++]=Y}),H!==N?F.subarray(0,H):F}function De(x,_){function N(he){for(;F<x.length;){var Oe=x.charAt(F++),Ue=ye[Oe];if(Ue!=null)return Ue;if(!/^[\s\xa0]*$/.test(Oe))throw Error("Unknown base64 encoding at char: "+Oe)}return he}Fe();for(var F=0;;){var H=N(-1),Y=N(0),X=N(64),ne=N(64);if(ne===64&&H===-1)break;_(H<<2|Y>>4),X!=64&&(_(Y<<4&240|X>>2),ne!=64&&_(X<<6&192|ne))}}function Fe(){if(!ye){ye={};for(var x="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),_=["+/=","+/","-_=","-_.","-_"],N=0;5>N;N++){var F=x.concat(_[N].split(""));ue[N]=F;for(var H=0;H<F.length;H++){var Y=F[H];ye[Y]===void 0&&(ye[Y]=H)}}}}var Re=typeof Uint8Array<"u",Ve=!(se("Trident")||se("MSIE"))&&typeof oe.btoa=="function";function Le(x){if(!Ve){var _;_===void 0&&(_=0),Fe(),_=ue[_];for(var N=Array(Math.floor(x.length/3)),F=_[64]||"",H=0,Y=0;H<x.length-2;H+=3){var X=x[H],ne=x[H+1],he=x[H+2],Oe=_[X>>2];X=_[(X&3)<<4|ne>>4],ne=_[(ne&15)<<2|he>>6],he=_[he&63],N[Y++]=Oe+X+ne+he}switch(Oe=0,he=F,x.length-H){case 2:Oe=x[H+1],he=_[(Oe&15)<<2]||F;case 1:x=x[H],N[Y]=_[x>>2]+_[(x&3)<<4|Oe>>4]+he+F}return N.join("")}for(_="";10240<x.length;)_+=String.fromCharCode.apply(null,x.subarray(0,10240)),x=x.subarray(10240);return _+=String.fromCharCode.apply(null,x),btoa(_)}var qe=RegExp("[-_.]","g");function lt(x){switch(x){case"-":return"+";case"_":return"/";case".":return"=";default:return""}}function mt(x){if(!Ve)return Te(x);qe.test(x)&&(x=x.replace(qe,lt)),x=atob(x);for(var _=new Uint8Array(x.length),N=0;N<x.length;N++)_[N]=x.charCodeAt(N);return _}var pt;function Rt(){return pt||(pt=new Uint8Array(0))}var kt={},Sn=typeof Uint8Array.prototype.slice=="function",Nt=0,Yt=0;function Fn(x){var _=0>x;x=Math.abs(x);var N=x>>>0;x=Math.floor((x-N)/4294967296),_&&(N=a(Qn(N,x)),_=N.next().value,x=N.next().value,N=_),Nt=N>>>0,Yt=x>>>0}var Nn=typeof BigInt=="function";function Qn(x,_){return _=~_,x?x=~x+1:_+=1,[x,_]}function jn(x,_){this.i=x>>>0,this.h=_>>>0}function Cs(x){if(!x)return zr||(zr=new jn(0,0));if(!/^-?\d+$/.test(x))return null;if(16>x.length)Fn(Number(x));else if(Nn)x=BigInt(x),Nt=Number(x&BigInt(4294967295))>>>0,Yt=Number(x>>BigInt(32)&BigInt(4294967295));else{var _=+(x[0]==="-");Yt=Nt=0;for(var N=x.length,F=_,H=(N-_)%6+_;H<=N;F=H,H+=6)F=Number(x.slice(F,H)),Yt*=1e6,Nt=1e6*Nt+F,4294967296<=Nt&&(Yt+=Nt/4294967296|0,Nt%=4294967296);_&&(_=a(Qn(Nt,Yt)),x=_.next().value,_=_.next().value,Nt=x,Yt=_)}return new jn(Nt,Yt)}var zr;function ca(x,_){return Error("Invalid wire type: "+x+" (at position "+_+")")}function Do(){return Error("Failed to read varint, encoding is invalid.")}function Hl(x,_){return Error("Tried to read past the end of the data "+_+" > "+x)}function io(){throw Error("Invalid UTF8")}function _s(x,_){return _=String.fromCharCode.apply(null,_),x==null?_:x+_}var os=void 0,Ss,ql=typeof TextDecoder<"u",tp,Dv=typeof TextEncoder<"u",eg;function Bw(x){if(x!==kt)throw Error("illegal external caller")}function Kl(x,_){if(Bw(_),this.V=x,x!=null&&x.length===0)throw Error("ByteString should be constructed with non-empty values")}function kv(){return eg||(eg=new Kl(null,kt))}function zw(x){Bw(kt);var _=x.V;return _=_==null||Re&&_!=null&&_ instanceof Uint8Array?_:typeof _=="string"?mt(_):null,_==null?_:x.V=_}function Pue(x){if(typeof x=="string")return{buffer:mt(x),C:!1};if(Array.isArray(x))return{buffer:new Uint8Array(x),C:!1};if(x.constructor===Uint8Array)return{buffer:x,C:!1};if(x.constructor===ArrayBuffer)return{buffer:new Uint8Array(x),C:!1};if(x.constructor===Kl)return{buffer:zw(x)||Rt(),C:!0};if(x instanceof Uint8Array)return{buffer:new Uint8Array(x.buffer,x.byteOffset,x.byteLength),C:!1};throw Error("Type not convertible to a Uint8Array, expected a Uint8Array, an ArrayBuffer, a base64 encoded string, a ByteString or an Array of numbers")}function Y3(x,_){this.i=null,this.m=!1,this.h=this.j=this.l=0,QN(this,x,_)}function QN(x,_,N){N=N===void 0?{}:N,x.S=N.S===void 0?!1:N.S,_&&(_=Pue(_),x.i=_.buffer,x.m=_.C,x.l=0,x.j=x.i.length,x.h=x.l)}Y3.prototype.reset=function(){this.h=this.l};function uh(x,_){if(x.h=_,_>x.j)throw Hl(x.j,_)}function Nv(x){var _=x.i,N=x.h,F=_[N++],H=F&127;if(F&128&&(F=_[N++],H|=(F&127)<<7,F&128&&(F=_[N++],H|=(F&127)<<14,F&128&&(F=_[N++],H|=(F&127)<<21,F&128&&(F=_[N++],H|=F<<28,F&128&&_[N++]&128&&_[N++]&128&&_[N++]&128&&_[N++]&128&&_[N++]&128)))))throw Do();return uh(x,N),H}function Z3(x,_){if(0>_)throw Error("Tried to read a negative byte length: "+_);var N=x.h,F=N+_;if(F>x.j)throw Hl(_,x.j-N);return x.h=F,N}var Q3=[];function JN(){this.h=[]}JN.prototype.length=function(){return this.h.length},JN.prototype.end=function(){var x=this.h;return this.h=[],x};function J3(x,_,N){for(;0<N||127<_;)x.h.push(_&127|128),_=(_>>>7|N<<25)>>>0,N>>>=7;x.h.push(_)}function dh(x,_){for(;127<_;)x.h.push(_&127|128),_>>>=7;x.h.push(_)}function eA(x,_){if(Q3.length){var N=Q3.pop();QN(N,x,_),x=N}else x=new Y3(x,_);this.h=x,this.j=this.h.h,this.i=this.l=-1,this.setOptions(_)}eA.prototype.setOptions=function(x){x=x===void 0?{}:x,this.ca=x.ca===void 0?!1:x.ca},eA.prototype.reset=function(){this.h.reset(),this.j=this.h.h,this.i=this.l=-1};function eV(x){var _=x.h;if(_.h==_.j)return!1;x.j=x.h.h;var N=Nv(x.h)>>>0;if(_=N>>>3,N&=7,!(0<=N&&5>=N))throw ca(N,x.j);if(1>_)throw Error("Invalid field number: "+_+" (at position "+x.j+")");return x.l=_,x.i=N,!0}function Uw(x){switch(x.i){case 0:if(x.i!=0)Uw(x);else e:{x=x.h;for(var _=x.h,N=_+10,F=x.i;_<N;)if(!(F[_++]&128)){uh(x,_);break e}throw Do()}break;case 1:x=x.h,uh(x,x.h+8);break;case 2:x.i!=2?Uw(x):(_=Nv(x.h)>>>0,x=x.h,uh(x,x.h+_));break;case 5:x=x.h,uh(x,x.h+4);break;case 3:_=x.l;do{if(!eV(x))throw Error("Unmatched start-group tag: stream EOF");if(x.i==4){if(x.l!=_)throw Error("Unmatched end-group tag");break}Uw(x)}while(!0);break;default:throw ca(x.i,x.j)}}var Ww=[];function Fue(){this.j=[],this.i=0,this.h=new JN}function tg(x,_){_.length!==0&&(x.j.push(_),x.i+=_.length)}function Lue(x,_){if(_=_.R){tg(x,x.h.end());for(var N=0;N<_.length;N++)tg(x,zw(_[N])||Rt())}}var Fu=typeof Symbol=="function"&&typeof Symbol()=="symbol"?Symbol():void 0;function ph(x,_){return Fu?x[Fu]|=_:x.A!==void 0?x.A|=_:(Object.defineProperties(x,{A:{value:_,configurable:!0,writable:!0,enumerable:!1}}),_)}function tV(x,_){Fu?x[Fu]&&(x[Fu]&=~_):x.A!==void 0&&(x.A&=~_)}function Ur(x){var _;return Fu?_=x[Fu]:_=x.A,_??0}function Xl(x,_){Fu?x[Fu]=_:x.A!==void 0?x.A=_:Object.defineProperties(x,{A:{value:_,configurable:!0,writable:!0,enumerable:!1}})}function tA(x){return ph(x,1),x}function $ue(x,_){Xl(_,(x|0)&-51)}function Gw(x,_){Xl(_,(x|18)&-41)}var nA={};function jw(x){return x!==null&&typeof x=="object"&&!Array.isArray(x)&&x.constructor===Object}var Av,nV=[];Xl(nV,23),Av=Object.freeze(nV);function rA(x){if(Ur(x.o)&2)throw Error("Cannot mutate an immutable Message")}function oA(x){var _=x.length;(_=_?x[_-1]:void 0)&&jw(_)?_.g=1:(_={},x.push((_.g=1,_)))}function rV(x){var _=x.i+x.G;return x.B||(x.B=x.o[_]={})}function ua(x,_){return _===-1?null:_>=x.i?x.B?x.B[_]:void 0:x.o[_+x.G]}function Yl(x,_,N,F){rA(x),Rv(x,_,N,F)}function Rv(x,_,N,F){x.j&&(x.j=void 0),_>=x.i||F?rV(x)[_]=N:(x.o[_+x.G]=N,(x=x.B)&&_ in x&&delete x[_])}function iA(x,_,N,F){var H=ua(x,_);Array.isArray(H)||(H=Av);var Y=Ur(H);if(Y&1||tA(H),F)Y&2||ph(H,2),N&1||Object.freeze(H);else{F=!(N&2);var X=Y&2;N&1||!X?F&&Y&16&&!X&&tV(H,16):(H=tA(Array.prototype.slice.call(H)),Rv(x,_,H))}return H}function sA(x,_){var N=ua(x,_),F=N==null?N:typeof N=="number"||N==="NaN"||N==="Infinity"||N==="-Infinity"?Number(N):void 0;return F!=null&&F!==N&&Rv(x,_,F),F}function oV(x,_,N,F,H){x.h||(x.h={});var Y=x.h[N],X=iA(x,N,3,H);if(!Y){var ne=X;Y=[];var he=!!(Ur(x.o)&16);X=!!(Ur(ne)&2);var Oe=ne;!H&&X&&(ne=Array.prototype.slice.call(ne));for(var Ue=X,It=0;It<ne.length;It++){var dt=ne[It],Ke=_,Et=!1;if(Et=Et===void 0?!1:Et,dt=Array.isArray(dt)?new Ke(dt):Et?new Ke:void 0,dt!==void 0){Ke=dt.o;var Zt=Et=Ur(Ke);X&&(Zt|=2),he&&(Zt|=16),Zt!=Et&&Xl(Ke,Zt),Ke=Zt,Ue=Ue||!!(2&Ke),Y.push(dt)}}return x.h[N]=Y,he=Ur(ne),_=he|33,_=Ue?_&-9:_|8,he!=_&&(Ue=ne,Object.isFrozen(Ue)&&(Ue=Array.prototype.slice.call(Ue)),Xl(Ue,_),ne=Ue),Oe!==ne&&Rv(x,N,ne),(H||F&&X)&&ph(Y,2),F&&Object.freeze(Y),Y}return H||(H=Object.isFrozen(Y),F&&!H?Object.freeze(Y):!F&&H&&(Y=Array.prototype.slice.call(Y),x.h[N]=Y)),Y}function aA(x,_,N){var F=!!(Ur(x.o)&2);if(_=oV(x,_,N,F,F),x=iA(x,N,3,F),!(F||Ur(x)&8)){for(F=0;F<_.length;F++){if(N=_[F],Ur(N.o)&2){var H=uV(N,!1);H.j=N}else H=N;N!==H&&(_[F]=H,x[F]=H.o)}ph(x,8)}return _}function Zl(x,_,N){if(N!=null&&typeof N!="number")throw Error("Value of float/double field must be a number|null|undefined, found "+typeof N+": "+N);Yl(x,_,N)}function iV(x,_,N,F,H){rA(x);var Y=oV(x,N,_,!1,!1);return N=F??new N,x=iA(x,_,2,!1),H!=null?(Y.splice(H,0,N),x.splice(H,0,N.o)):(Y.push(N),x.push(N.o)),N.C()&&tV(x,8),N}function Hw(x,_){return x??_}function Ql(x,_,N){return N=N===void 0?0:N,Hw(sA(x,_),N)}var qw;function Vue(x){switch(typeof x){case"number":return isFinite(x)?x:String(x);case"object":if(x)if(Array.isArray(x)){if(Ur(x)&128)return x=Array.prototype.slice.call(x),oA(x),x}else{if(Re&&x!=null&&x instanceof Uint8Array)return Le(x);if(x instanceof Kl){var _=x.V;return _==null?"":typeof _=="string"?_:x.V=Le(_)}}}return x}function sV(x,_,N,F){if(x!=null){if(Array.isArray(x))x=lA(x,_,N,F!==void 0);else if(jw(x)){var H={},Y;for(Y in x)H[Y]=sV(x[Y],_,N,F);x=H}else x=_(x,F);return x}}function lA(x,_,N,F){var H=Ur(x);F=F?!!(H&16):void 0,x=Array.prototype.slice.call(x);for(var Y=0;Y<x.length;Y++)x[Y]=sV(x[Y],_,N,F);return N(H,x),x}function Bue(x){return x.ja===nA?x.toJSON():Vue(x)}function zue(x,_){x&128&&oA(_)}function aV(x,_,N){if(N=N===void 0?Gw:N,x!=null){if(Re&&x instanceof Uint8Array)return x.length?new Kl(new Uint8Array(x),kt):kv();if(Array.isArray(x)){var F=Ur(x);return F&2?x:_&&!(F&32)&&(F&16||F===0)?(Xl(x,F|2),x):(x=lA(x,aV,F&4?Gw:N,!0),_=Ur(x),_&4&&_&2&&Object.freeze(x),x)}return x.ja===nA?cV(x):x}}function lV(x,_,N,F,H,Y,X){if(x=x.h&&x.h[N]){if(F=Ur(x),F&2?F=x:(Y=fe(x,cV),Gw(F,Y),Object.freeze(Y),F=Y),rA(_),X=F==null?Av:tA([]),F!=null){for(Y=!!F.length,x=0;x<F.length;x++){var ne=F[x];Y=Y&&!(Ur(ne.o)&2),X[x]=ne.o}Y=(Y?8:0)|1,x=Ur(X),(x&Y)!==Y&&(Object.isFrozen(X)&&(X=Array.prototype.slice.call(X)),Xl(X,x|Y)),_.h||(_.h={}),_.h[N]=F}else _.h&&(_.h[N]=void 0);Rv(_,N,X,H)}else Yl(_,N,aV(F,Y,X),H)}function cV(x){return Ur(x.o)&2||(x=uV(x,!0),ph(x.o,2)),x}function uV(x,_){var N=x.o,F=[];ph(F,16);var H=x.constructor.h;if(H&&F.push(H),H=x.B,H){F.length=N.length,F.fill(void 0,F.length,N.length);var Y={};F[F.length-1]=Y}Ur(N)&128&&oA(F),_=_||x.C()?Gw:$ue,Y=x.constructor,qw=F,F=new Y(F),qw=void 0,x.R&&(F.R=x.R.slice()),Y=!!(Ur(N)&16);for(var X=H?N.length-1:N.length,ne=0;ne<X;ne++)lV(x,F,ne-x.G,N[ne],!1,Y,_);if(H)for(var he in H)lV(x,F,+he,H[he],!0,Y,_);return F}function Si(x,_,N){x==null&&(x=qw),qw=void 0;var F=this.constructor.i||0,H=0<F,Y=this.constructor.h,X=!1;if(x==null){x=Y?[Y]:[];var ne=48,he=!0;H&&(F=0,ne|=128),Xl(x,ne)}else{if(!Array.isArray(x)||Y&&Y!==x[0])throw Error();var Oe=ne=ph(x,0);if((he=(16&Oe)!==0)&&((X=(32&Oe)!==0)||(Oe|=32)),H){if(128&Oe)F=0;else if(0<x.length){var Ue=x[x.length-1];if(jw(Ue)&&"g"in Ue){F=0,Oe|=128,delete Ue.g;var It=!0,dt;for(dt in Ue){It=!1;break}It&&x.pop()}}}else if(128&Oe)throw Error();ne!==Oe&&Xl(x,Oe)}this.G=(Y?0:-1)-F,this.h=void 0,this.o=x;e:{if(Y=this.o.length,F=Y-1,Y&&(Y=this.o[F],jw(Y))){this.B=Y,this.i=F-this.G;break e}_!==void 0&&-1<_?(this.i=Math.max(_,F+1-this.G),this.B=void 0):this.i=Number.MAX_VALUE}if(!H&&this.B&&"g"in this.B)throw Error('Unexpected "g" flag in sparse object of message that is not a group type.');if(N){_=he&&!X&&!0,H=this.i;var Ke;for(he=0;he<N.length;he++)X=N[he],X<H?(X+=this.G,(F=x[X])?dV(F,_):x[X]=Av):(Ke||(Ke=rV(this)),(F=Ke[X])?dV(F,_):Ke[X]=Av)}}Si.prototype.toJSON=function(){return lA(this.o,Bue,zue)},Si.prototype.C=function(){return!!(Ur(this.o)&2)};function dV(x,_){if(Array.isArray(x)){var N=Ur(x),F=1;!_||N&2||(F|=16),(N&F)!==F&&Xl(x,N|F)}}Si.prototype.ja=nA,Si.prototype.toString=function(){return this.o.toString()};function pV(x,_,N){if(N){var F={},H;for(H in N){var Y=N[H],X=Y.ra;X||(F.J=Y.xa||Y.oa.W,Y.ia?(F.aa=yV(Y.ia),X=function(ne){return function(he,Oe,Ue){return ne.J(he,Oe,Ue,ne.aa)}}(F)):Y.ka?(F.Z=xV(Y.da.P,Y.ka),X=function(ne){return function(he,Oe,Ue){return ne.J(he,Oe,Ue,ne.Z)}}(F)):X=F.J,Y.ra=X),X(_,x,Y.da),F={J:F.J,aa:F.aa,Z:F.Z}}}Lue(_,x)}var Kw=Symbol();function fV(x,_,N){return x[Kw]||(x[Kw]=function(F,H){return _(F,H,N)})}function hV(x){var _=x[Kw];if(!_){var N=uA(x);_=function(F,H){return vV(F,H,N)},x[Kw]=_}return _}function Uue(x){var _=x.ia;if(_)return hV(_);if(_=x.wa)return fV(x.da.P,_,x.ka)}function Wue(x){var _=Uue(x),N=x.da,F=x.oa.U;return _?function(H,Y){return F(H,Y,N,_)}:function(H,Y){return F(H,Y,N)}}function mV(x,_){var N=x[_];return typeof N=="function"&&N.length===0&&(N=N(),x[_]=N),Array.isArray(N)&&(Mv in N||Ov in N||0<N.length&&typeof N[0]=="function")?N:void 0}function gV(x,_,N,F,H,Y){_.P=x[0];var X=1;if(x.length>X&&typeof x[X]!="number"){var ne=x[X++];N(_,ne)}for(;X<x.length;){N=x[X++];for(var he=X+1;he<x.length&&typeof x[he]!="number";)he++;switch(ne=x[X++],he-=X,he){case 0:F(_,N,ne);break;case 1:(he=mV(x,X))?(X++,H(_,N,ne,he)):F(_,N,ne,x[X++]);break;case 2:he=X++,he=mV(x,he),H(_,N,ne,he,x[X++]);break;case 3:Y(_,N,ne,x[X++],x[X++],x[X++]);break;case 4:Y(_,N,ne,x[X++],x[X++],x[X++],x[X++]);break;default:throw Error("unexpected number of binary field arguments: "+he)}}return _}var Xw=Symbol();function yV(x){var _=x[Xw];if(!_){var N=cA(x);_=function(F,H){return bV(F,H,N)},x[Xw]=_}return _}function xV(x,_){var N=x[Xw];return N||(N=function(F,H){return pV(F,H,_)},x[Xw]=N),N}var Ov=Symbol();function Gue(x,_){x.push(_)}function jue(x,_,N){x.push(_,N.W)}function Hue(x,_,N,F){var H=yV(F),Y=cA(F).P,X=N.W;x.push(_,function(ne,he,Oe){return X(ne,he,Oe,Y,H)})}function que(x,_,N,F,H,Y){var X=xV(F,Y),ne=N.W;x.push(_,function(he,Oe,Ue){return ne(he,Oe,Ue,F,X)})}function cA(x){var _=x[Ov];return _||(_=gV(x,x[Ov]=[],Gue,jue,Hue,que),Mv in x&&Ov in x&&(x.length=0),_)}var Mv=Symbol();function Kue(x,_){x[0]=_}function Xue(x,_,N,F){var H=N.U;x[_]=F?function(Y,X,ne){return H(Y,X,ne,F)}:H}function Yue(x,_,N,F,H){var Y=N.U,X=hV(F),ne=uA(F).P;x[_]=function(he,Oe,Ue){return Y(he,Oe,Ue,ne,X,H)}}function Zue(x,_,N,F,H,Y,X){var ne=N.U,he=fV(F,H,Y);x[_]=function(Oe,Ue,It){return ne(Oe,Ue,It,F,he,X)}}function uA(x){var _=x[Mv];return _||(_=gV(x,x[Mv]={},Kue,Xue,Yue,Zue),Mv in x&&Ov in x&&(x.length=0),_)}function vV(x,_,N){for(;eV(_)&&_.i!=4;){var F=_.l,H=N[F];if(!H){var Y=N[0];Y&&(Y=Y[F])&&(H=N[F]=Wue(Y))}if(!H||!H(_,x,F)){H=_,F=x,Y=H.j,Uw(H);var X=H;if(!X.ca){if(H=X.h.h-Y,X.h.h=Y,X=X.h,H==0)H=kv();else{if(Y=Z3(X,H),X.S&&X.m)H=X.i.subarray(Y,Y+H);else{X=X.i;var ne=Y;H=Y+H,H=ne===H?Rt():Sn?X.slice(ne,H):new Uint8Array(X.subarray(ne,H))}H=H.length==0?kv():new Kl(H,kt)}(Y=F.R)?Y.push(H):F.R=[H]}}}return x}function bV(x,_,N){for(var F=N.length,H=F%2==1,Y=H?1:0;Y<F;Y+=2)(0,N[Y+1])(_,x,N[Y]);pV(x,_,H?N[0]:void 0)}function Pv(x,_){return{U:x,W:_}}var da=Pv(function(x,_,N){if(x.i!==5)return!1;x=x.h;var F=x.i,H=x.h,Y=F[H],X=F[H+1],ne=F[H+2];return F=F[H+3],uh(x,x.h+4),X=(Y<<0|X<<8|ne<<16|F<<24)>>>0,x=2*(X>>31)+1,Y=X>>>23&255,X&=8388607,Yl(_,N,Y==255?X?NaN:1/0*x:Y==0?x*Math.pow(2,-149)*X:x*Math.pow(2,Y-150)*(X+Math.pow(2,23))),!0},function(x,_,N){if(_=sA(_,N),_!=null){dh(x.h,8*N+5),x=x.h;var F=+_;F===0?0<1/F?Nt=Yt=0:(Yt=0,Nt=2147483648):isNaN(F)?(Yt=0,Nt=2147483647):(F=(N=0>F?-2147483648:0)?-F:F,34028234663852886e22<F?(Yt=0,Nt=(N|2139095040)>>>0):11754943508222875e-54>F?(F=Math.round(F/Math.pow(2,-149)),Yt=0,Nt=(N|F)>>>0):(_=Math.floor(Math.log(F)/Math.LN2),F*=Math.pow(2,-_),F=Math.round(8388608*F),16777216<=F&&++_,Yt=0,Nt=(N|_+127<<23|F&8388607)>>>0)),N=Nt,x.h.push(N>>>0&255),x.h.push(N>>>8&255),x.h.push(N>>>16&255),x.h.push(N>>>24&255)}}),Que=Pv(function(x,_,N){if(x.i!==0)return!1;var F=x.h,H=0,Y=x=0,X=F.i,ne=F.h;do{var he=X[ne++];H|=(he&127)<<Y,Y+=7}while(32>Y&&he&128);for(32<Y&&(x|=(he&127)>>4),Y=3;32>Y&&he&128;Y+=7)he=X[ne++],x|=(he&127)<<Y;if(uh(F,ne),128>he)F=H>>>0,he=x>>>0,(x=he&2147483648)&&(F=~F+1>>>0,he=~he>>>0,F==0&&(he=he+1>>>0)),F=4294967296*he+(F>>>0);else throw Do();return Yl(_,N,x?-F:F),!0},function(x,_,N){_=ua(_,N),_!=null&&(typeof _=="string"&&Cs(_),_!=null&&(dh(x.h,8*N),typeof _=="number"?(x=x.h,Fn(_),J3(x,Nt,Yt)):(N=Cs(_),J3(x.h,N.i,N.h))))}),Jue=Pv(function(x,_,N){return x.i!==0?!1:(Yl(_,N,Nv(x.h)),!0)},function(x,_,N){if(_=ua(_,N),_!=null&&_!=null)if(dh(x.h,8*N),x=x.h,N=_,0<=N)dh(x,N);else{for(_=0;9>_;_++)x.h.push(N&127|128),N>>=7;x.h.push(1)}}),wV=Pv(function(x,_,N){if(x.i!==2)return!1;var F=Nv(x.h)>>>0;x=x.h;var H=Z3(x,F);if(x=x.i,ql){var Y=x,X;(X=Ss)||(X=Ss=new TextDecoder("utf-8",{fatal:!0})),x=H+F,Y=H===0&&x===Y.length?Y:Y.subarray(H,x);try{var ne=X.decode(Y)}catch(It){if(os===void 0){try{X.decode(new Uint8Array([128]))}catch{}try{X.decode(new Uint8Array([97])),os=!0}catch{os=!1}}throw!os&&(Ss=void 0),It}}else{ne=H,F=ne+F,H=[];for(var he=null,Oe,Ue;ne<F;)Oe=x[ne++],128>Oe?H.push(Oe):224>Oe?ne>=F?io():(Ue=x[ne++],194>Oe||(Ue&192)!==128?(ne--,io()):H.push((Oe&31)<<6|Ue&63)):240>Oe?ne>=F-1?io():(Ue=x[ne++],(Ue&192)!==128||Oe===224&&160>Ue||Oe===237&&160<=Ue||((Y=x[ne++])&192)!==128?(ne--,io()):H.push((Oe&15)<<12|(Ue&63)<<6|Y&63)):244>=Oe?ne>=F-2?io():(Ue=x[ne++],(Ue&192)!==128||(Oe<<28)+(Ue-144)>>30||((Y=x[ne++])&192)!==128||((X=x[ne++])&192)!==128?(ne--,io()):(Oe=(Oe&7)<<18|(Ue&63)<<12|(Y&63)<<6|X&63,Oe-=65536,H.push((Oe>>10&1023)+55296,(Oe&1023)+56320))):io(),8192<=H.length&&(he=_s(he,H),H.length=0);ne=_s(he,H)}return Yl(_,N,ne),!0},function(x,_,N){if(_=ua(_,N),_!=null){var F=!1;if(F=F===void 0?!1:F,Dv){if(F&&/(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])/.test(_))throw Error("Found an unpaired surrogate");_=(tp||(tp=new TextEncoder)).encode(_)}else{for(var H=0,Y=new Uint8Array(3*_.length),X=0;X<_.length;X++){var ne=_.charCodeAt(X);if(128>ne)Y[H++]=ne;else{if(2048>ne)Y[H++]=ne>>6|192;else{if(55296<=ne&&57343>=ne){if(56319>=ne&&X<_.length){var he=_.charCodeAt(++X);if(56320<=he&&57343>=he){ne=1024*(ne-55296)+he-56320+65536,Y[H++]=ne>>18|240,Y[H++]=ne>>12&63|128,Y[H++]=ne>>6&63|128,Y[H++]=ne&63|128;continue}else X--}if(F)throw Error("Found an unpaired surrogate");ne=65533}Y[H++]=ne>>12|224,Y[H++]=ne>>6&63|128}Y[H++]=ne&63|128}}_=H===Y.length?Y:Y.subarray(0,H)}dh(x.h,8*N+2),dh(x.h,_.length),tg(x,x.h.end()),tg(x,_)}}),CV=Pv(function(x,_,N,F,H){if(x.i!==2)return!1;_=iV(_,N,F),N=x.h.j,F=Nv(x.h)>>>0;var Y=x.h.h+F,X=Y-N;if(0>=X&&(x.h.j=Y,H(_,x,void 0,void 0,void 0),X=Y-x.h.h),X)throw Error("Message parsing ended unexpectedly. Expected to read "+(F+" bytes, instead read "+(F-X)+" bytes, either the data ended unexpectedly or the message misreported its own length"));return x.h.h=Y,x.h.j=N,!0},function(x,_,N,F,H){if(_=aA(_,F,N),_!=null)for(F=0;F<_.length;F++){var Y=x;dh(Y.h,8*N+2);var X=Y.h.end();tg(Y,X),X.push(Y.i),Y=X,H(_[F],x),X=x;var ne=Y.pop();for(ne=X.i+X.h.length()-ne;127<ne;)Y.push(ne&127|128),ne>>>=7,X.i++;Y.push(ne),X.i++}});function dA(x){return function(_,N){e:{if(Ww.length){var F=Ww.pop();F.setOptions(N),QN(F.h,_,N),_=F}else _=new eA(_,N);try{var H=uA(x),Y=vV(new H.P,_,H);break e}finally{H=_.h,H.i=null,H.m=!1,H.l=0,H.j=0,H.h=0,H.S=!1,_.l=-1,_.i=-1,100>Ww.length&&Ww.push(_)}Y=void 0}return Y}}function pA(x){return function(){var _=new Fue;bV(this,_,cA(x)),tg(_,_.h.end());for(var N=new Uint8Array(_.i),F=_.j,H=F.length,Y=0,X=0;X<H;X++){var ne=F[X];N.set(ne,Y),Y+=ne.length}return _.j=[N],N}}function ng(x){Si.call(this,x)}g(ng,Si);var _V=[ng,1,Jue,2,da,3,wV,4,wV];ng.prototype.l=pA(_V);function fA(x){Si.call(this,x,-1,ede)}g(fA,Si),fA.prototype.addClassification=function(x,_){return iV(this,1,ng,x,_),this};var ede=[1],tde=dA([fA,1,CV,_V]);function Fv(x){Si.call(this,x)}g(Fv,Si);var SV=[Fv,1,da,2,da,3,da,4,da,5,da];Fv.prototype.l=pA(SV);function IV(x){Si.call(this,x,-1,nde)}g(IV,Si);var nde=[1],rde=dA([IV,1,CV,SV]);function Yw(x){Si.call(this,x)}g(Yw,Si);var EV=[Yw,1,da,2,da,3,da,4,da,5,da,6,Que],ode=dA(EV);Yw.prototype.l=pA(EV);function TV(x,_,N){if(N=x.createShader(N===0?x.VERTEX_SHADER:x.FRAGMENT_SHADER),x.shaderSource(N,_),x.compileShader(N),!x.getShaderParameter(N,x.COMPILE_STATUS))throw Error(`Could not compile WebGL shader.

`+x.getShaderInfoLog(N));return N}function ide(x){return aA(x,ng,1).map(function(_){var N=ua(_,1);return{index:N??0,qa:Ql(_,2),label:ua(_,3)!=null?Hw(ua(_,3),""):void 0,displayName:ua(_,4)!=null?Hw(ua(_,4),""):void 0}})}function sde(x){return{x:Ql(x,1),y:Ql(x,2),z:Ql(x,3),visibility:sA(x,4)!=null?Ql(x,4):void 0}}function hA(x){return aA(rde(x),Fv,1).map(sde)}function mA(x,_){this.i=x,this.h=_,this.m=0}function DV(x,_,N){return ade(x,_),typeof x.h.canvas.transferToImageBitmap=="function"?Promise.resolve(x.h.canvas.transferToImageBitmap()):N?Promise.resolve(x.h.canvas):typeof createImageBitmap=="function"?createImageBitmap(x.h.canvas):(x.j===void 0&&(x.j=document.createElement("canvas")),new Promise(function(F){x.j.height=x.h.canvas.height,x.j.width=x.h.canvas.width,x.j.getContext("2d",{}).drawImage(x.h.canvas,0,0,x.h.canvas.width,x.h.canvas.height),F(x.j)}))}function ade(x,_){var N=x.h;if(x.s===void 0){var F=TV(N,`
  attribute vec2 aVertex;
  attribute vec2 aTex;
  varying vec2 vTex;
  void main(void) {
    gl_Position = vec4(aVertex, 0.0, 1.0);
    vTex = aTex;
  }`,0),H=TV(N,`
  precision mediump float;
  varying vec2 vTex;
  uniform sampler2D sampler0;
  void main(){
    gl_FragColor = texture2D(sampler0, vTex);
  }`,1),Y=N.createProgram();if(N.attachShader(Y,F),N.attachShader(Y,H),N.linkProgram(Y),!N.getProgramParameter(Y,N.LINK_STATUS))throw Error(`Could not compile WebGL program.

`+N.getProgramInfoLog(Y));F=x.s=Y,N.useProgram(F),H=N.getUniformLocation(F,"sampler0"),x.l={O:N.getAttribLocation(F,"aVertex"),N:N.getAttribLocation(F,"aTex"),ya:H},x.v=N.createBuffer(),N.bindBuffer(N.ARRAY_BUFFER,x.v),N.enableVertexAttribArray(x.l.O),N.vertexAttribPointer(x.l.O,2,N.FLOAT,!1,0,0),N.bufferData(N.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),N.STATIC_DRAW),N.bindBuffer(N.ARRAY_BUFFER,null),x.u=N.createBuffer(),N.bindBuffer(N.ARRAY_BUFFER,x.u),N.enableVertexAttribArray(x.l.N),N.vertexAttribPointer(x.l.N,2,N.FLOAT,!1,0,0),N.bufferData(N.ARRAY_BUFFER,new Float32Array([0,1,0,0,1,0,1,1]),N.STATIC_DRAW),N.bindBuffer(N.ARRAY_BUFFER,null),N.uniform1i(H,0)}F=x.l,N.useProgram(x.s),N.canvas.width=_.width,N.canvas.height=_.height,N.viewport(0,0,_.width,_.height),N.activeTexture(N.TEXTURE0),x.i.bindTexture2d(_.glName),N.enableVertexAttribArray(F.O),N.bindBuffer(N.ARRAY_BUFFER,x.v),N.vertexAttribPointer(F.O,2,N.FLOAT,!1,0,0),N.enableVertexAttribArray(F.N),N.bindBuffer(N.ARRAY_BUFFER,x.u),N.vertexAttribPointer(F.N,2,N.FLOAT,!1,0,0),N.bindFramebuffer(N.DRAW_FRAMEBUFFER?N.DRAW_FRAMEBUFFER:N.FRAMEBUFFER,null),N.clearColor(0,0,0,0),N.clear(N.COLOR_BUFFER_BIT),N.colorMask(!0,!0,!0,!0),N.drawArrays(N.TRIANGLE_FAN,0,4),N.disableVertexAttribArray(F.O),N.disableVertexAttribArray(F.N),N.bindBuffer(N.ARRAY_BUFFER,null),x.i.bindTexture2d(0)}function lde(x){this.h=x}var cde=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11]);function ude(x,_){return _+x}function kV(x,_){window[x]=_}function dde(x){var _=document.createElement("script");return _.setAttribute("src",x),_.setAttribute("crossorigin","anonymous"),new Promise(function(N){_.addEventListener("load",function(){N()},!1),_.addEventListener("error",function(){N()},!1),document.body.appendChild(_)})}function pde(){return K(function(x){switch(x.h){case 1:return x.s=2,C(x,WebAssembly.instantiate(cde),4);case 4:x.h=3,x.s=0;break;case 2:return x.s=0,x.l=null,x.return(!1);case 3:return x.return(!0)}})}function gA(x){if(this.h=x,this.listeners={},this.l={},this.L={},this.s={},this.v={},this.M=this.u=this.ga=!0,this.I=Promise.resolve(),this.fa="",this.D={},this.locateFile=x&&x.locateFile||ude,typeof window=="object")var _=window.location.pathname.toString().substring(0,window.location.pathname.toString().lastIndexOf("/"))+"/";else if(typeof location<"u")_=location.pathname.toString().substring(0,location.pathname.toString().lastIndexOf("/"))+"/";else throw Error("solutions can only be loaded on a web page or in a web worker");if(this.ha=_,x.options){_=a(Object.keys(x.options));for(var N=_.next();!N.done;N=_.next()){N=N.value;var F=x.options[N].default;F!==void 0&&(this.l[N]=typeof F=="function"?F():F)}}}n=gA.prototype,n.close=function(){return this.j&&this.j.delete(),Promise.resolve()};function fde(x){var _,N,F,H,Y,X,ne,he,Oe,Ue,It;return K(function(dt){switch(dt.h){case 1:return x.ga?(_=x.h.files===void 0?[]:typeof x.h.files=="function"?x.h.files(x.l):x.h.files,C(dt,pde(),2)):dt.return();case 2:if(N=dt.i,typeof window=="object")return kV("createMediapipeSolutionsWasm",{locateFile:x.locateFile}),kV("createMediapipeSolutionsPackedAssets",{locateFile:x.locateFile}),X=_.filter(function(Ke){return Ke.data!==void 0}),ne=_.filter(function(Ke){return Ke.data===void 0}),he=Promise.all(X.map(function(Ke){var Et=Zw(x,Ke.url);if(Ke.path!==void 0){var Zt=Ke.path;Et=Et.then(function(vr){return x.overrideFile(Zt,vr),Promise.resolve(vr)})}return Et})),Oe=Promise.all(ne.map(function(Ke){return Ke.simd===void 0||Ke.simd&&N||!Ke.simd&&!N?dde(x.locateFile(Ke.url,x.ha)):Promise.resolve()})).then(function(){var Ke,Et,Zt;return K(function(vr){if(vr.h==1)return Ke=window.createMediapipeSolutionsWasm,Et=window.createMediapipeSolutionsPackedAssets,Zt=x,C(vr,Ke(Et),2);Zt.i=vr.i,vr.h=0})}),Ue=function(){return K(function(Ke){return x.h.graph&&x.h.graph.url?Ke=C(Ke,Zw(x,x.h.graph.url),0):(Ke.h=0,Ke=void 0),Ke})}(),C(dt,Promise.all([Oe,he,Ue]),7);if(typeof importScripts!="function")throw Error("solutions can only be loaded on a web page or in a web worker");return F=_.filter(function(Ke){return Ke.simd===void 0||Ke.simd&&N||!Ke.simd&&!N}).map(function(Ke){return x.locateFile(Ke.url,x.ha)}),importScripts.apply(null,l(F)),H=x,C(dt,createMediapipeSolutionsWasm(Module),6);case 6:H.i=dt.i,x.m=new OffscreenCanvas(1,1),x.i.canvas=x.m,Y=x.i.GL.createContext(x.m,{antialias:!1,alpha:!1,va:typeof WebGL2RenderingContext<"u"?2:1}),x.i.GL.makeContextCurrent(Y),dt.h=4;break;case 7:if(x.m=document.createElement("canvas"),It=x.m.getContext("webgl2",{}),!It&&(It=x.m.getContext("webgl",{}),!It))return alert("Failed to create WebGL canvas context when passing video frame."),dt.return();x.K=It,x.i.canvas=x.m,x.i.createContext(x.m,!0,!0,{});case 4:x.j=new x.i.SolutionWasm,x.ga=!1,dt.h=0}})}function hde(x){var _,N,F,H,Y,X,ne,he;return K(function(Oe){if(Oe.h==1){if(x.h.graph&&x.h.graph.url&&x.fa===x.h.graph.url)return Oe.return();if(x.u=!0,!x.h.graph||!x.h.graph.url){Oe.h=2;return}return x.fa=x.h.graph.url,C(Oe,Zw(x,x.h.graph.url),3)}for(Oe.h!=2&&(_=Oe.i,x.j.loadGraph(_)),N=a(Object.keys(x.D)),F=N.next();!F.done;F=N.next())H=F.value,x.j.overrideFile(H,x.D[H]);if(x.D={},x.h.listeners)for(Y=a(x.h.listeners),X=Y.next();!X.done;X=Y.next())ne=X.value,xde(x,ne);he=x.l,x.l={},x.setOptions(he),Oe.h=0})}n.reset=function(){var x=this;return K(function(_){x.j&&(x.j.reset(),x.s={},x.v={}),_.h=0})},n.setOptions=function(x,_){var N=this;if(_=_||this.h.options){for(var F=[],H=[],Y={},X=a(Object.keys(x)),ne=X.next();!ne.done;Y={X:Y.X,Y:Y.Y},ne=X.next())if(ne=ne.value,!(ne in this.l&&this.l[ne]===x[ne])){this.l[ne]=x[ne];var he=_[ne];he!==void 0&&(he.onChange&&(Y.X=he.onChange,Y.Y=x[ne],F.push(function(Oe){return function(){var Ue;return K(function(It){if(It.h==1)return C(It,Oe.X(Oe.Y),2);Ue=It.i,Ue===!0&&(N.u=!0),It.h=0})}}(Y))),he.graphOptionXref&&(ne=Object.assign({},{calculatorName:"",calculatorIndex:0},he.graphOptionXref,{valueNumber:he.type===1?x[ne]:0,valueBoolean:he.type===0?x[ne]:!1,valueString:he.type===2?x[ne]:""}),H.push(ne)))}(F.length!==0||H.length!==0)&&(this.u=!0,this.H=(this.H===void 0?[]:this.H).concat(H),this.F=(this.F===void 0?[]:this.F).concat(F))}};function mde(x){var _,N,F,H,Y,X,ne;return K(function(he){switch(he.h){case 1:if(!x.u)return he.return();if(!x.F){he.h=2;break}_=a(x.F),N=_.next();case 3:if(N.done){he.h=5;break}return F=N.value,C(he,F(),4);case 4:N=_.next(),he.h=3;break;case 5:x.F=void 0;case 2:if(x.H){for(H=new x.i.GraphOptionChangeRequestList,Y=a(x.H),X=Y.next();!X.done;X=Y.next())ne=X.value,H.push_back(ne);x.j.changeOptions(H),H.delete(),x.H=void 0}x.u=!1,he.h=0}})}n.initialize=function(){var x=this;return K(function(_){return _.h==1?C(_,fde(x),2):_.h!=3?C(_,hde(x),3):C(_,mde(x),0)})};function Zw(x,_){var N,F;return K(function(H){return _ in x.L?H.return(x.L[_]):(N=x.locateFile(_,""),F=fetch(N).then(function(Y){return Y.arrayBuffer()}),x.L[_]=F,H.return(F))})}n.overrideFile=function(x,_){this.j?this.j.overrideFile(x,_):this.D[x]=_},n.clearOverriddenFiles=function(){this.D={},this.j&&this.j.clearOverriddenFiles()},n.send=function(x,_){var N=this,F,H,Y,X,ne,he,Oe,Ue,It;return K(function(dt){switch(dt.h){case 1:return N.h.inputs?(F=1e3*(_??performance.now()),C(dt,N.I,2)):dt.return();case 2:return C(dt,N.initialize(),3);case 3:for(H=new N.i.PacketDataList,Y=a(Object.keys(x)),X=Y.next();!X.done;X=Y.next())if(ne=X.value,he=N.h.inputs[ne]){e:{var Ke=x[ne];switch(he.type){case"video":var Et=N.s[he.stream];if(Et||(Et=new mA(N.i,N.K),N.s[he.stream]=Et),Et.m===0&&(Et.m=Et.i.createTexture()),typeof HTMLVideoElement<"u"&&Ke instanceof HTMLVideoElement)var Zt=Ke.videoWidth,vr=Ke.videoHeight;else typeof HTMLImageElement<"u"&&Ke instanceof HTMLImageElement?(Zt=Ke.naturalWidth,vr=Ke.naturalHeight):(Zt=Ke.width,vr=Ke.height);vr={glName:Et.m,width:Zt,height:vr},Zt=Et.h,Zt.canvas.width=vr.width,Zt.canvas.height=vr.height,Zt.activeTexture(Zt.TEXTURE0),Et.i.bindTexture2d(Et.m),Zt.texImage2D(Zt.TEXTURE_2D,0,Zt.RGBA,Zt.RGBA,Zt.UNSIGNED_BYTE,Ke),Et.i.bindTexture2d(0),Et=vr;break e;case"detections":for(Et=N.s[he.stream],Et||(Et=new lde(N.i),N.s[he.stream]=Et),Et.data||(Et.data=new Et.h.DetectionListData),Et.data.reset(Ke.length),vr=0;vr<Ke.length;++vr){Zt=Ke[vr];var pr=Et.data,ko=pr.setBoundingBox,Is=vr,Ii=Zt.la,In=new Yw;if(Zl(In,1,Ii.sa),Zl(In,2,Ii.ta),Zl(In,3,Ii.height),Zl(In,4,Ii.width),Zl(In,5,Ii.rotation),Yl(In,6,Ii.pa),Ii=In.l(),ko.call(pr,Is,Ii),Zt.ea)for(pr=0;pr<Zt.ea.length;++pr){In=Zt.ea[pr],ko=Et.data,Is=ko.addNormalizedLandmark,Ii=vr,In=Object.assign({},In,{visibility:In.visibility?In.visibility:0});var No=new Fv;Zl(No,1,In.x),Zl(No,2,In.y),Zl(No,3,In.z),In.visibility&&Zl(No,4,In.visibility),In=No.l(),Is.call(ko,Ii,In)}if(Zt.ba)for(pr=0;pr<Zt.ba.length;++pr)ko=Et.data,Is=ko.addClassification,Ii=vr,In=Zt.ba[pr],No=new ng,Zl(No,2,In.qa),In.index&&Yl(No,1,In.index),In.label&&Yl(No,3,In.label),In.displayName&&Yl(No,4,In.displayName),In=No.l(),Is.call(ko,Ii,In)}Et=Et.data;break e;default:Et={}}}switch(Oe=Et,Ue=he.stream,he.type){case"video":H.pushTexture2d(Object.assign({},Oe,{stream:Ue,timestamp:F}));break;case"detections":It=Oe,It.stream=Ue,It.timestamp=F,H.pushDetectionList(It);break;default:throw Error("Unknown input config type: '"+he.type+"'")}}return N.j.send(H),C(dt,N.I,4);case 4:H.delete(),dt.h=0}})};function gde(x,_,N){var F,H,Y,X,ne,he,Oe,Ue,It,dt,Ke,Et,Zt,vr;return K(function(pr){switch(pr.h){case 1:if(!N)return pr.return(_);for(F={},H=0,Y=a(Object.keys(N)),X=Y.next();!X.done;X=Y.next())ne=X.value,he=N[ne],typeof he!="string"&&he.type==="texture"&&_[he.stream]!==void 0&&++H;1<H&&(x.M=!1),Oe=a(Object.keys(N)),X=Oe.next();case 2:if(X.done){pr.h=4;break}if(Ue=X.value,It=N[Ue],typeof It=="string")return Zt=F,vr=Ue,C(pr,yde(x,Ue,_[It]),14);if(dt=_[It.stream],It.type==="detection_list"){if(dt){for(var ko=dt.getRectList(),Is=dt.getLandmarksList(),Ii=dt.getClassificationsList(),In=[],No=0;No<ko.size();++No){var np=ode(ko.get(No)),vde=Ql(np,1),bde=Ql(np,2),wde=Ql(np,3),Cde=Ql(np,4),_de=Ql(np,5,0),Qw=void 0;Qw=Qw===void 0?0:Qw,np={la:{sa:vde,ta:bde,height:wde,width:Cde,rotation:_de,pa:Hw(ua(np,6),Qw)},ea:hA(Is.get(No)),ba:ide(tde(Ii.get(No)))},In.push(np)}ko=In}else ko=[];F[Ue]=ko,pr.h=7;break}if(It.type==="proto_list"){if(dt){for(ko=Array(dt.size()),Is=0;Is<dt.size();Is++)ko[Is]=dt.get(Is);dt.delete()}else ko=[];F[Ue]=ko,pr.h=7;break}if(dt===void 0){pr.h=3;break}if(It.type==="float_list"){F[Ue]=dt,pr.h=7;break}if(It.type==="proto"){F[Ue]=dt,pr.h=7;break}if(It.type!=="texture")throw Error("Unknown output config type: '"+It.type+"'");return Ke=x.v[Ue],Ke||(Ke=new mA(x.i,x.K),x.v[Ue]=Ke),C(pr,DV(Ke,dt,x.M),13);case 13:Et=pr.i,F[Ue]=Et;case 7:It.transform&&F[Ue]&&(F[Ue]=It.transform(F[Ue])),pr.h=3;break;case 14:Zt[vr]=pr.i;case 3:X=Oe.next(),pr.h=2;break;case 4:return pr.return(F)}})}function yde(x,_,N){var F;return K(function(H){return typeof N=="number"||N instanceof Uint8Array||N instanceof x.i.Uint8BlobList?H.return(N):N instanceof x.i.Texture2dDataOut?(F=x.v[_],F||(F=new mA(x.i,x.K),x.v[_]=F),H.return(DV(F,N,x.M))):H.return(void 0)})}function xde(x,_){for(var N=_.name||"$",F=[].concat(l(_.wants)),H=new x.i.StringList,Y=a(_.wants),X=Y.next();!X.done;X=Y.next())H.push_back(X.value);Y=x.i.PacketListener.implement({onResults:function(ne){for(var he={},Oe=0;Oe<_.wants.length;++Oe)he[F[Oe]]=ne.get(Oe);var Ue=x.listeners[N];Ue&&(x.I=gde(x,he,_.outs).then(function(It){It=Ue(It);for(var dt=0;dt<_.wants.length;++dt){var Ke=he[F[dt]];typeof Ke=="object"&&Ke.hasOwnProperty&&Ke.hasOwnProperty("delete")&&Ke.delete()}It&&(x.I=It)}))}}),x.j.attachMultiListener(H,Y),H.delete()}n.onResults=function(x,_){this.listeners[_||"$"]=x},ie("Solution",gA),ie("OptionType",{BOOL:0,NUMBER:1,ua:2,0:"BOOL",1:"NUMBER",2:"STRING"});function NV(x){switch(x===void 0&&(x=0),x){case 1:return"pose_landmark_full.tflite";case 2:return"pose_landmark_heavy.tflite";default:return"pose_landmark_lite.tflite"}}function AV(x){var _=this;x=x||{},this.h=new gA({locateFile:x.locateFile,files:function(N){return[{url:"pose_solution_packed_assets_loader.js"},{simd:!1,url:"pose_solution_wasm_bin.js"},{simd:!0,url:"pose_solution_simd_wasm_bin.js"},{data:!0,url:NV(N.modelComplexity)}]},graph:{url:"pose_web.binarypb"},listeners:[{wants:["pose_landmarks","world_landmarks","segmentation_mask","image_transformed"],outs:{image:{type:"texture",stream:"image_transformed"},poseLandmarks:{type:"proto",stream:"pose_landmarks",transform:hA},poseWorldLandmarks:{type:"proto",stream:"world_landmarks",transform:hA},segmentationMask:{type:"texture",stream:"segmentation_mask"}}}],inputs:{image:{type:"video",stream:"input_frames_gpu"}},options:{useCpuInference:{type:0,graphOptionXref:{calculatorType:"InferenceCalculator",fieldName:"use_cpu_inference"},default:typeof window!="object"||window.navigator===void 0?!1:"iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";").includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document},selfieMode:{type:0,graphOptionXref:{calculatorType:"GlScalerCalculator",calculatorIndex:1,fieldName:"flip_horizontal"}},modelComplexity:{type:1,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorModelComplexity",fieldName:"int_value"},onChange:function(N){var F,H,Y;return K(function(X){return X.h==1?(F=NV(N),H="third_party/mediapipe/modules/pose_landmark/"+F,C(X,Zw(_.h,F),2)):(Y=X.i,_.h.overrideFile(H,Y),X.return(!0))})}},smoothLandmarks:{type:0,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorSmoothLandmarks",fieldName:"bool_value"}},enableSegmentation:{type:0,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorEnableSegmentation",fieldName:"bool_value"}},smoothSegmentation:{type:0,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorSmoothSegmentation",fieldName:"bool_value"}},minDetectionConfidence:{type:1,graphOptionXref:{calculatorType:"TensorsToDetectionsCalculator",calculatorName:"poselandmarkgpu__posedetectiongpu__TensorsToDetectionsCalculator",fieldName:"min_score_thresh"}},minTrackingConfidence:{type:1,graphOptionXref:{calculatorType:"ThresholdingCalculator",calculatorName:"poselandmarkgpu__poselandmarkbyroigpu__tensorstoposelandmarksandsegmentation__ThresholdingCalculator",fieldName:"threshold"}}}})}n=AV.prototype,n.reset=function(){this.h.reset()},n.close=function(){return this.h.close(),Promise.resolve()},n.onResults=function(x){this.h.onResults(x)},n.initialize=function(){var x=this;return K(function(_){return C(_,x.h.initialize(),0)})},n.send=function(x,_){var N=this;return K(function(F){return C(F,N.h.send(x,_),0)})},n.setOptions=function(x){this.h.setOptions(x)},ie("Pose",AV),ie("POSE_CONNECTIONS",[[0,1],[1,2],[2,3],[3,7],[0,4],[4,5],[5,6],[6,8],[9,10],[11,12],[11,13],[13,15],[15,17],[15,19],[15,21],[17,19],[12,14],[14,16],[16,18],[16,20],[16,22],[18,20],[11,23],[12,24],[23,24],[23,25],[24,26],[25,27],[26,28],[27,29],[28,30],[29,31],[30,32],[27,31],[28,32]]),ie("POSE_LANDMARKS",{NOSE:0,LEFT_EYE_INNER:1,LEFT_EYE:2,LEFT_EYE_OUTER:3,RIGHT_EYE_INNER:4,RIGHT_EYE:5,RIGHT_EYE_OUTER:6,LEFT_EAR:7,RIGHT_EAR:8,LEFT_RIGHT:9,RIGHT_LEFT:10,LEFT_SHOULDER:11,RIGHT_SHOULDER:12,LEFT_ELBOW:13,RIGHT_ELBOW:14,LEFT_WRIST:15,RIGHT_WRIST:16,LEFT_PINKY:17,RIGHT_PINKY:18,LEFT_INDEX:19,RIGHT_INDEX:20,LEFT_THUMB:21,RIGHT_THUMB:22,LEFT_HIP:23,RIGHT_HIP:24,LEFT_KNEE:25,RIGHT_KNEE:26,LEFT_ANKLE:27,RIGHT_ANKLE:28,LEFT_HEEL:29,RIGHT_HEEL:30,LEFT_FOOT_INDEX:31,RIGHT_FOOT_INDEX:32}),ie("POSE_LANDMARKS_LEFT",{LEFT_EYE_INNER:1,LEFT_EYE:2,LEFT_EYE_OUTER:3,LEFT_EAR:7,LEFT_RIGHT:9,LEFT_SHOULDER:11,LEFT_ELBOW:13,LEFT_WRIST:15,LEFT_PINKY:17,LEFT_INDEX:19,LEFT_THUMB:21,LEFT_HIP:23,LEFT_KNEE:25,LEFT_ANKLE:27,LEFT_HEEL:29,LEFT_FOOT_INDEX:31}),ie("POSE_LANDMARKS_RIGHT",{RIGHT_EYE_INNER:4,RIGHT_EYE:5,RIGHT_EYE_OUTER:6,RIGHT_EAR:8,RIGHT_LEFT:10,RIGHT_SHOULDER:12,RIGHT_ELBOW:14,RIGHT_WRIST:16,RIGHT_PINKY:18,RIGHT_INDEX:20,RIGHT_THUMB:22,RIGHT_HIP:24,RIGHT_KNEE:26,RIGHT_ANKLE:28,RIGHT_HEEL:30,RIGHT_FOOT_INDEX:32}),ie("POSE_LANDMARKS_NEUTRAL",{NOSE:0}),ie("VERSION","0.5.1675469404")}).call(Mie)});function LV(n,t){return Object.is(n,t)}var so=null,eC=!1,vA=1,ss=Symbol("SIGNAL");function gn(n){let t=so;return so=n,t}function $V(){return so}var $v={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,kind:"unknown",producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function nC(n){if(eC)throw new Error("");if(so===null)return;so.consumerOnSignalRead(n);let t=so.nextProducerIndex++;if(iC(so),t<so.producerNode.length&&so.producerNode[t]!==n&&Lv(so)){let e=so.producerNode[t];oC(e,so.producerIndexOfThis[t])}so.producerNode[t]!==n&&(so.producerNode[t]=n,so.producerIndexOfThis[t]=Lv(so)?UV(n,so,t):0),so.producerLastReadVersion[t]=n.version}function Rde(){vA++}function VV(n){if(!(Lv(n)&&!n.dirty)&&!(!n.dirty&&n.lastCleanEpoch===vA)){if(!n.producerMustRecompute(n)&&!wA(n)){FV(n);return}n.producerRecomputeValue(n),FV(n)}}function BV(n){if(n.liveConsumerNode===void 0)return;let t=eC;eC=!0;try{for(let e of n.liveConsumerNode)e.dirty||Ode(e)}finally{eC=t}}function zV(){return so?.consumerAllowSignalWrites!==!1}function Ode(n){n.dirty=!0,BV(n),n.consumerMarkedDirty?.(n)}function FV(n){n.dirty=!1,n.lastCleanEpoch=vA}function rC(n){return n&&(n.nextProducerIndex=0),gn(n)}function bA(n,t){if(gn(t),!(!n||n.producerNode===void 0||n.producerIndexOfThis===void 0||n.producerLastReadVersion===void 0)){if(Lv(n))for(let e=n.nextProducerIndex;e<n.producerNode.length;e++)oC(n.producerNode[e],n.producerIndexOfThis[e]);for(;n.producerNode.length>n.nextProducerIndex;)n.producerNode.pop(),n.producerLastReadVersion.pop(),n.producerIndexOfThis.pop()}}function wA(n){iC(n);for(let t=0;t<n.producerNode.length;t++){let e=n.producerNode[t],r=n.producerLastReadVersion[t];if(r!==e.version||(VV(e),r!==e.version))return!0}return!1}function CA(n){if(iC(n),Lv(n))for(let t=0;t<n.producerNode.length;t++)oC(n.producerNode[t],n.producerIndexOfThis[t]);n.producerNode.length=n.producerLastReadVersion.length=n.producerIndexOfThis.length=0,n.liveConsumerNode&&(n.liveConsumerNode.length=n.liveConsumerIndexOfThis.length=0)}function UV(n,t,e){if(WV(n),n.liveConsumerNode.length===0&&GV(n))for(let r=0;r<n.producerNode.length;r++)n.producerIndexOfThis[r]=UV(n.producerNode[r],n,r);return n.liveConsumerIndexOfThis.push(e),n.liveConsumerNode.push(t)-1}function oC(n,t){if(WV(n),n.liveConsumerNode.length===1&&GV(n))for(let r=0;r<n.producerNode.length;r++)oC(n.producerNode[r],n.producerIndexOfThis[r]);let e=n.liveConsumerNode.length-1;if(n.liveConsumerNode[t]=n.liveConsumerNode[e],n.liveConsumerIndexOfThis[t]=n.liveConsumerIndexOfThis[e],n.liveConsumerNode.length--,n.liveConsumerIndexOfThis.length--,t<n.liveConsumerNode.length){let r=n.liveConsumerIndexOfThis[t],o=n.liveConsumerNode[t];iC(o),o.producerIndexOfThis[r]=t}}function Lv(n){return n.consumerIsAlwaysLive||(n?.liveConsumerNode?.length??0)>0}function iC(n){n.producerNode??=[],n.producerIndexOfThis??=[],n.producerLastReadVersion??=[]}function WV(n){n.liveConsumerNode??=[],n.liveConsumerIndexOfThis??=[]}function GV(n){return n.producerNode!==void 0}function jV(n){let t=Object.create(Mde);t.computation=n;let e=()=>{if(VV(t),nC(t),t.value===tC)throw t.error;return t.value};return e[ss]=t,e}var yA=Symbol("UNSET"),xA=Symbol("COMPUTING"),tC=Symbol("ERRORED"),Mde=Ft(ke({},$v),{value:yA,dirty:!0,error:null,equal:LV,kind:"computed",producerMustRecompute(n){return n.value===yA||n.value===xA},producerRecomputeValue(n){if(n.value===xA)throw new Error("Detected cycle in computations.");let t=n.value;n.value=xA;let e=rC(n),r,o=!1;try{r=n.computation(),gn(null),o=t!==yA&&t!==tC&&r!==tC&&n.equal(t,r)}catch(i){r=tC,n.error=i}finally{bA(n,e)}if(o){n.value=t;return}n.value=r,n.version++}});function Pde(){throw new Error}var HV=Pde;function qV(){HV()}function KV(n){HV=n}var Fde=null;function XV(n){let t=Object.create(_A);t.value=n;let e=()=>(nC(t),t.value);return e[ss]=t,e}function sC(n,t){zV()||qV(),n.equal(n.value,t)||(n.value=t,Lde(n))}function YV(n,t){zV()||qV(),sC(n,t(n.value))}var _A=Ft(ke({},$v),{equal:LV,value:void 0,kind:"signal"});function Lde(n){n.version++,Rde(),BV(n),Fde?.()}function Bt(n){return typeof n=="function"}function og(n){let e=n(r=>{Error.call(r),r.stack=new Error().stack});return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}var aC=og(n=>function(e){n(this),this.message=e?`${e.length} errors occurred during unsubscription:
${e.map((r,o)=>`${o+1}) ${r.toString()}`).join(`
  `)}`:"",this.name="UnsubscriptionError",this.errors=e});function hh(n,t){if(n){let e=n.indexOf(t);0<=e&&n.splice(e,1)}}var Jn=class n{constructor(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let t;if(!this.closed){this.closed=!0;let{_parentage:e}=this;if(e)if(this._parentage=null,Array.isArray(e))for(let i of e)i.remove(this);else e.remove(this);let{initialTeardown:r}=this;if(Bt(r))try{r()}catch(i){t=i instanceof aC?i.errors:[i]}let{_finalizers:o}=this;if(o){this._finalizers=null;for(let i of o)try{ZV(i)}catch(s){t=t??[],s instanceof aC?t=[...t,...s.errors]:t.push(s)}}if(t)throw new aC(t)}}add(t){var e;if(t&&t!==this)if(this.closed)ZV(t);else{if(t instanceof n){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=(e=this._finalizers)!==null&&e!==void 0?e:[]).push(t)}}_hasParent(t){let{_parentage:e}=this;return e===t||Array.isArray(e)&&e.includes(t)}_addParent(t){let{_parentage:e}=this;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t}_removeParent(t){let{_parentage:e}=this;e===t?this._parentage=null:Array.isArray(e)&&hh(e,t)}remove(t){let{_finalizers:e}=this;e&&hh(e,t),t instanceof n&&t._removeParent(this)}};Jn.EMPTY=(()=>{let n=new Jn;return n.closed=!0,n})();var SA=Jn.EMPTY;function lC(n){return n instanceof Jn||n&&"closed"in n&&Bt(n.remove)&&Bt(n.add)&&Bt(n.unsubscribe)}function ZV(n){Bt(n)?n():n.unsubscribe()}var pa={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var ig={setTimeout(n,t,...e){let{delegate:r}=ig;return r?.setTimeout?r.setTimeout(n,t,...e):setTimeout(n,t,...e)},clearTimeout(n){let{delegate:t}=ig;return(t?.clearTimeout||clearTimeout)(n)},delegate:void 0};function cC(n){ig.setTimeout(()=>{let{onUnhandledError:t}=pa;if(t)t(n);else throw n})}function Vv(){}var QV=IA("C",void 0,void 0);function JV(n){return IA("E",void 0,n)}function eB(n){return IA("N",n,void 0)}function IA(n,t,e){return{kind:n,value:t,error:e}}var mh=null;function sg(n){if(pa.useDeprecatedSynchronousErrorHandling){let t=!mh;if(t&&(mh={errorThrown:!1,error:null}),n(),t){let{errorThrown:e,error:r}=mh;if(mh=null,e)throw r}}else n()}function tB(n){pa.useDeprecatedSynchronousErrorHandling&&mh&&(mh.errorThrown=!0,mh.error=n)}var gh=class extends Jn{constructor(t){super(),this.isStopped=!1,t?(this.destination=t,lC(t)&&t.add(this)):this.destination=Bde}static create(t,e,r){return new ag(t,e,r)}next(t){this.isStopped?TA(eB(t),this):this._next(t)}error(t){this.isStopped?TA(JV(t),this):(this.isStopped=!0,this._error(t))}complete(){this.isStopped?TA(QV,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(t){this.destination.next(t)}_error(t){try{this.destination.error(t)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}},$de=Function.prototype.bind;function EA(n,t){return $de.call(n,t)}var DA=class{constructor(t){this.partialObserver=t}next(t){let{partialObserver:e}=this;if(e.next)try{e.next(t)}catch(r){uC(r)}}error(t){let{partialObserver:e}=this;if(e.error)try{e.error(t)}catch(r){uC(r)}else uC(t)}complete(){let{partialObserver:t}=this;if(t.complete)try{t.complete()}catch(e){uC(e)}}},ag=class extends gh{constructor(t,e,r){super();let o;if(Bt(t)||!t)o={next:t??void 0,error:e??void 0,complete:r??void 0};else{let i;this&&pa.useDeprecatedNextContext?(i=Object.create(t),i.unsubscribe=()=>this.unsubscribe(),o={next:t.next&&EA(t.next,i),error:t.error&&EA(t.error,i),complete:t.complete&&EA(t.complete,i)}):o=t}this.destination=new DA(o)}};function uC(n){pa.useDeprecatedSynchronousErrorHandling?tB(n):cC(n)}function Vde(n){throw n}function TA(n,t){let{onStoppedNotification:e}=pa;e&&ig.setTimeout(()=>e(n,t))}var Bde={closed:!0,next:Vv,error:Vde,complete:Vv};var lg=typeof Symbol=="function"&&Symbol.observable||"@@observable";function ai(n){return n}function kA(...n){return NA(n)}function NA(n){return n.length===0?ai:n.length===1?n[0]:function(e){return n.reduce((r,o)=>o(r),e)}}var on=(()=>{class n{constructor(e){e&&(this._subscribe=e)}lift(e){let r=new n;return r.source=this,r.operator=e,r}subscribe(e,r,o){let i=Ude(e)?e:new ag(e,r,o);return sg(()=>{let{operator:s,source:a}=this;i.add(s?s.call(i,a):a?this._subscribe(i):this._trySubscribe(i))}),i}_trySubscribe(e){try{return this._subscribe(e)}catch(r){e.error(r)}}forEach(e,r){return r=nB(r),new r((o,i)=>{let s=new ag({next:a=>{try{e(a)}catch(l){i(l),s.unsubscribe()}},error:i,complete:o});this.subscribe(s)})}_subscribe(e){var r;return(r=this.source)===null||r===void 0?void 0:r.subscribe(e)}[lg](){return this}pipe(...e){return NA(e)(this)}toPromise(e){return e=nB(e),new e((r,o)=>{let i;this.subscribe(s=>i=s,s=>o(s),()=>r(i))})}}return n.create=t=>new n(t),n})();function nB(n){var t;return(t=n??pa.Promise)!==null&&t!==void 0?t:Promise}function zde(n){return n&&Bt(n.next)&&Bt(n.error)&&Bt(n.complete)}function Ude(n){return n&&n instanceof gh||zde(n)&&lC(n)}function AA(n){return Bt(n?.lift)}function Jt(n){return t=>{if(AA(t))return t.lift(function(e){try{return n(e,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function jt(n,t,e,r,o){return new RA(n,t,e,r,o)}var RA=class extends gh{constructor(t,e,r,o,i,s){super(t),this.onFinalize=i,this.shouldUnsubscribe=s,this._next=e?function(a){try{e(a)}catch(l){t.error(l)}}:super._next,this._error=o?function(a){try{o(a)}catch(l){t.error(l)}finally{this.unsubscribe()}}:super._error,this._complete=r?function(){try{r()}catch(a){t.error(a)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){let{closed:e}=this;super.unsubscribe(),!e&&((t=this.onFinalize)===null||t===void 0||t.call(this))}}};function cg(){return Jt((n,t)=>{let e=null;n._refCount++;let r=jt(t,void 0,void 0,void 0,()=>{if(!n||n._refCount<=0||0<--n._refCount){e=null;return}let o=n._connection,i=e;e=null,o&&(!i||o===i)&&o.unsubscribe(),t.unsubscribe()});n.subscribe(r),r.closed||(e=n.connect())})}var ug=class extends on{constructor(t,e){super(),this.source=t,this.subjectFactory=e,this._subject=null,this._refCount=0,this._connection=null,AA(t)&&(this.lift=t.lift)}_subscribe(t){return this.getSubject().subscribe(t)}getSubject(){let t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;let{_connection:t}=this;this._subject=this._connection=null,t?.unsubscribe()}connect(){let t=this._connection;if(!t){t=this._connection=new Jn;let e=this.getSubject();t.add(this.source.subscribe(jt(e,void 0,()=>{this._teardown(),e.complete()},r=>{this._teardown(),e.error(r)},()=>this._teardown()))),t.closed&&(this._connection=null,t=Jn.EMPTY)}return t}refCount(){return cg()(this)}};var rB=og(n=>function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var zt=(()=>{class n extends on{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(e){let r=new dC(this,this);return r.operator=e,r}_throwIfClosed(){if(this.closed)throw new rB}next(e){sg(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(let r of this.currentObservers)r.next(e)}})}error(e){sg(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=e;let{observers:r}=this;for(;r.length;)r.shift().error(e)}})}complete(){sg(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;let{observers:e}=this;for(;e.length;)e.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var e;return((e=this.observers)===null||e===void 0?void 0:e.length)>0}_trySubscribe(e){return this._throwIfClosed(),super._trySubscribe(e)}_subscribe(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)}_innerSubscribe(e){let{hasError:r,isStopped:o,observers:i}=this;return r||o?SA:(this.currentObservers=null,i.push(e),new Jn(()=>{this.currentObservers=null,hh(i,e)}))}_checkFinalizedStatuses(e){let{hasError:r,thrownError:o,isStopped:i}=this;r?e.error(o):i&&e.complete()}asObservable(){let e=new on;return e.source=this,e}}return n.create=(t,e)=>new dC(t,e),n})(),dC=class extends zt{constructor(t,e){super(),this.destination=t,this.source=e}next(t){var e,r;(r=(e=this.destination)===null||e===void 0?void 0:e.next)===null||r===void 0||r.call(e,t)}error(t){var e,r;(r=(e=this.destination)===null||e===void 0?void 0:e.error)===null||r===void 0||r.call(e,t)}complete(){var t,e;(e=(t=this.destination)===null||t===void 0?void 0:t.complete)===null||e===void 0||e.call(t)}_subscribe(t){var e,r;return(r=(e=this.source)===null||e===void 0?void 0:e.subscribe(t))!==null&&r!==void 0?r:SA}};var Wr=class extends zt{constructor(t){super(),this._value=t}get value(){return this.getValue()}_subscribe(t){let e=super._subscribe(t);return!e.closed&&t.next(this._value),e}getValue(){let{hasError:t,thrownError:e,_value:r}=this;if(t)throw e;return this._throwIfClosed(),r}next(t){super.next(this._value=t)}};var OA={now(){return(OA.delegate||Date).now()},delegate:void 0};var pC=class extends Jn{constructor(t,e){super()}schedule(t,e=0){return this}};var Bv={setInterval(n,t,...e){let{delegate:r}=Bv;return r?.setInterval?r.setInterval(n,t,...e):setInterval(n,t,...e)},clearInterval(n){let{delegate:t}=Bv;return(t?.clearInterval||clearInterval)(n)},delegate:void 0};var fC=class extends pC{constructor(t,e){super(t,e),this.scheduler=t,this.work=e,this.pending=!1}schedule(t,e=0){var r;if(this.closed)return this;this.state=t;let o=this.id,i=this.scheduler;return o!=null&&(this.id=this.recycleAsyncId(i,o,e)),this.pending=!0,this.delay=e,this.id=(r=this.id)!==null&&r!==void 0?r:this.requestAsyncId(i,this.id,e),this}requestAsyncId(t,e,r=0){return Bv.setInterval(t.flush.bind(t,this),r)}recycleAsyncId(t,e,r=0){if(r!=null&&this.delay===r&&this.pending===!1)return e;e!=null&&Bv.clearInterval(e)}execute(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;let r=this._execute(t,e);if(r)return r;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(t,e){let r=!1,o;try{this.work(t)}catch(i){r=!0,o=i||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),o}unsubscribe(){if(!this.closed){let{id:t,scheduler:e}=this,{actions:r}=e;this.work=this.state=this.scheduler=null,this.pending=!1,hh(r,this),t!=null&&(this.id=this.recycleAsyncId(e,t,null)),this.delay=null,super.unsubscribe()}}};var dg=class n{constructor(t,e=n.now){this.schedulerActionCtor=t,this.now=e}schedule(t,e=0,r){return new this.schedulerActionCtor(this,t).schedule(r,e)}};dg.now=OA.now;var hC=class extends dg{constructor(t,e=dg.now){super(t,e),this.actions=[],this._active=!1}flush(t){let{actions:e}=this;if(this._active){e.push(t);return}let r;this._active=!0;do if(r=t.execute(t.state,t.delay))break;while(t=e.shift());if(this._active=!1,r){for(;t=e.shift();)t.unsubscribe();throw r}}};var MA=new hC(fC),oB=MA;var Uo=new on(n=>n.complete());function mC(n){return n&&Bt(n.schedule)}function PA(n){return n[n.length-1]}function gC(n){return Bt(PA(n))?n.pop():void 0}function Jl(n){return mC(PA(n))?n.pop():void 0}function iB(n,t){return typeof PA(n)=="number"?n.pop():t}function yC(n,t){var e={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.indexOf(r)<0&&(e[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(n);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(n,r[o])&&(e[r[o]]=n[r[o]]);return e}function aB(n,t,e,r){function o(i){return i instanceof e?i:new e(function(s){s(i)})}return new(e||(e=Promise))(function(i,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?i(u.value):o(u.value).then(a,l)}c((r=r.apply(n,t||[])).next())})}function sB(n){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&n[t],r=0;if(e)return e.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function yh(n){return this instanceof yh?(this.v=n,this):new yh(n)}function lB(n,t,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=e.apply(n,t||[]),o,i=[];return o=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",s),o[Symbol.asyncIterator]=function(){return this},o;function s(f){return function(h){return Promise.resolve(h).then(f,d)}}function a(f,h){r[f]&&(o[f]=function(m){return new Promise(function(g,y){i.push([f,m,g,y])>1||l(f,m)})},h&&(o[f]=h(o[f])))}function l(f,h){try{c(r[f](h))}catch(m){p(i[0][3],m)}}function c(f){f.value instanceof yh?Promise.resolve(f.value.v).then(u,d):p(i[0][2],f)}function u(f){l("next",f)}function d(f){l("throw",f)}function p(f,h){f(h),i.shift(),i.length&&l(i[0][0],i[0][1])}}function cB(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=n[Symbol.asyncIterator],e;return t?t.call(n):(n=typeof sB=="function"?sB(n):n[Symbol.iterator](),e={},r("next"),r("throw"),r("return"),e[Symbol.asyncIterator]=function(){return this},e);function r(i){e[i]=n[i]&&function(s){return new Promise(function(a,l){s=n[i](s),o(a,l,s.done,s.value)})}}function o(i,s,a,l){Promise.resolve(l).then(function(c){i({value:c,done:a})},s)}}var xC=n=>n&&typeof n.length=="number"&&typeof n!="function";function vC(n){return Bt(n?.then)}function bC(n){return Bt(n[lg])}function wC(n){return Symbol.asyncIterator&&Bt(n?.[Symbol.asyncIterator])}function CC(n){return new TypeError(`You provided ${n!==null&&typeof n=="object"?"an invalid object":`'${n}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}function Wde(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var _C=Wde();function SC(n){return Bt(n?.[_C])}function IC(n){return lB(this,arguments,function*(){let e=n.getReader();try{for(;;){let{value:r,done:o}=yield yh(e.read());if(o)return yield yh(void 0);yield yield yh(r)}}finally{e.releaseLock()}})}function EC(n){return Bt(n?.getReader)}function Ir(n){if(n instanceof on)return n;if(n!=null){if(bC(n))return Gde(n);if(xC(n))return jde(n);if(vC(n))return Hde(n);if(wC(n))return uB(n);if(SC(n))return qde(n);if(EC(n))return Kde(n)}throw CC(n)}function Gde(n){return new on(t=>{let e=n[lg]();if(Bt(e.subscribe))return e.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function jde(n){return new on(t=>{for(let e=0;e<n.length&&!t.closed;e++)t.next(n[e]);t.complete()})}function Hde(n){return new on(t=>{n.then(e=>{t.closed||(t.next(e),t.complete())},e=>t.error(e)).then(null,cC)})}function qde(n){return new on(t=>{for(let e of n)if(t.next(e),t.closed)return;t.complete()})}function uB(n){return new on(t=>{Xde(n,t).catch(e=>t.error(e))})}function Kde(n){return uB(IC(n))}function Xde(n,t){var e,r,o,i;return aB(this,void 0,void 0,function*(){try{for(e=cB(n);r=yield e.next(),!r.done;){let s=r.value;if(t.next(s),t.closed)return}}catch(s){o={error:s}}finally{try{r&&!r.done&&(i=e.return)&&(yield i.call(e))}finally{if(o)throw o.error}}t.complete()})}function Ei(n,t,e,r=0,o=!1){let i=t.schedule(function(){e(),o?n.add(this.schedule(null,r)):this.unsubscribe()},r);if(n.add(i),!o)return i}function TC(n,t=0){return Jt((e,r)=>{e.subscribe(jt(r,o=>Ei(r,n,()=>r.next(o),t),()=>Ei(r,n,()=>r.complete(),t),o=>Ei(r,n,()=>r.error(o),t)))})}function DC(n,t=0){return Jt((e,r)=>{r.add(n.schedule(()=>e.subscribe(r),t))})}function dB(n,t){return Ir(n).pipe(DC(t),TC(t))}function pB(n,t){return Ir(n).pipe(DC(t),TC(t))}function fB(n,t){return new on(e=>{let r=0;return t.schedule(function(){r===n.length?e.complete():(e.next(n[r++]),e.closed||this.schedule())})})}function hB(n,t){return new on(e=>{let r;return Ei(e,t,()=>{r=n[_C](),Ei(e,t,()=>{let o,i;try{({value:o,done:i}=r.next())}catch(s){e.error(s);return}i?e.complete():e.next(o)},0,!0)}),()=>Bt(r?.return)&&r.return()})}function kC(n,t){if(!n)throw new Error("Iterable cannot be null");return new on(e=>{Ei(e,t,()=>{let r=n[Symbol.asyncIterator]();Ei(e,t,()=>{r.next().then(o=>{o.done?e.complete():e.next(o.value)})},0,!0)})})}function mB(n,t){return kC(IC(n),t)}function gB(n,t){if(n!=null){if(bC(n))return dB(n,t);if(xC(n))return fB(n,t);if(vC(n))return pB(n,t);if(wC(n))return kC(n,t);if(SC(n))return hB(n,t);if(EC(n))return mB(n,t)}throw CC(n)}function Hn(n,t){return t?gB(n,t):Ir(n)}function ct(...n){let t=Jl(n);return Hn(n,t)}function pg(n,t){let e=Bt(n)?n:()=>n,r=o=>o.error(e());return new on(t?o=>t.schedule(r,0,o):r)}function zv(n){return!!n&&(n instanceof on||Bt(n.lift)&&Bt(n.subscribe))}var Lu=og(n=>function(){n(this),this.name="EmptyError",this.message="no elements in sequence"});function yB(n){return n instanceof Date&&!isNaN(n)}function Wt(n,t){return Jt((e,r)=>{let o=0;e.subscribe(jt(r,i=>{r.next(n.call(t,i,o++))}))})}var{isArray:Yde}=Array;function Zde(n,t){return Yde(t)?n(...t):n(t)}function NC(n){return Wt(t=>Zde(n,t))}var{isArray:Qde}=Array,{getPrototypeOf:Jde,prototype:epe,keys:tpe}=Object;function AC(n){if(n.length===1){let t=n[0];if(Qde(t))return{args:t,keys:null};if(npe(t)){let e=tpe(t);return{args:e.map(r=>t[r]),keys:e}}}return{args:n,keys:null}}function npe(n){return n&&typeof n=="object"&&Jde(n)===epe}function RC(n,t){return n.reduce((e,r,o)=>(e[r]=t[o],e),{})}function Uv(...n){let t=Jl(n),e=gC(n),{args:r,keys:o}=AC(n);if(r.length===0)return Hn([],t);let i=new on(rpe(r,t,o?s=>RC(o,s):ai));return e?i.pipe(NC(e)):i}function rpe(n,t,e=ai){return r=>{xB(t,()=>{let{length:o}=n,i=new Array(o),s=o,a=o;for(let l=0;l<o;l++)xB(t,()=>{let c=Hn(n[l],t),u=!1;c.subscribe(jt(r,d=>{i[l]=d,u||(u=!0,a--),a||r.next(e(i.slice()))},()=>{--s||r.complete()}))},r)},r)}}function xB(n,t,e){n?Ei(e,n,t):t()}function vB(n,t,e,r,o,i,s,a){let l=[],c=0,u=0,d=!1,p=()=>{d&&!l.length&&!c&&t.complete()},f=m=>c<r?h(m):l.push(m),h=m=>{i&&t.next(m),c++;let g=!1;Ir(e(m,u++)).subscribe(jt(t,y=>{o?.(y),i?f(y):t.next(y)},()=>{g=!0},void 0,()=>{if(g)try{for(c--;l.length&&c<r;){let y=l.shift();s?Ei(t,s,()=>h(y)):h(y)}p()}catch(y){t.error(y)}}))};return n.subscribe(jt(t,f,()=>{d=!0,p()})),()=>{a?.()}}function Kr(n,t,e=1/0){return Bt(t)?Kr((r,o)=>Wt((i,s)=>t(r,i,o,s))(Ir(n(r,o))),e):(typeof t=="number"&&(e=t),Jt((r,o)=>vB(r,o,n,e)))}function ec(n=1/0){return Kr(ai,n)}function bB(){return ec(1)}function fg(...n){return bB()(Hn(n,Jl(n)))}function rp(n){return new on(t=>{Ir(n()).subscribe(t)})}function FA(...n){let t=gC(n),{args:e,keys:r}=AC(n),o=new on(i=>{let{length:s}=e;if(!s){i.complete();return}let a=new Array(s),l=s,c=s;for(let u=0;u<s;u++){let d=!1;Ir(e[u]).subscribe(jt(i,p=>{d||(d=!0,c--),a[u]=p},()=>l--,void 0,()=>{(!l||!d)&&(c||i.next(r?RC(r,a):a),i.complete())}))}});return t?o.pipe(NC(t)):o}function wB(n=0,t,e=oB){let r=-1;return t!=null&&(mC(t)?e=t:r=t),new on(o=>{let i=yB(n)?+n-e.now():n;i<0&&(i=0);let s=0;return e.schedule(function(){o.closed||(o.next(s++),0<=r?this.schedule(void 0,r):o.complete())},i)})}function Wv(...n){let t=Jl(n),e=iB(n,1/0),r=n;return r.length?r.length===1?Ir(r[0]):ec(e)(Hn(r,t)):Uo}function fr(n,t){return Jt((e,r)=>{let o=0;e.subscribe(jt(r,i=>n.call(t,i,o++)&&r.next(i)))})}function CB(n){return Jt((t,e)=>{let r=!1,o=null,i=null,s=!1,a=()=>{if(i?.unsubscribe(),i=null,r){r=!1;let c=o;o=null,e.next(c)}s&&e.complete()},l=()=>{i=null,s&&e.complete()};t.subscribe(jt(e,c=>{r=!0,o=c,i||Ir(n(c)).subscribe(i=jt(e,a,l))},()=>{s=!0,(!r||!i||i.closed)&&e.complete()}))})}function OC(n,t=MA){return CB(()=>wB(n,t))}function op(n){return Jt((t,e)=>{let r=null,o=!1,i;r=t.subscribe(jt(e,void 0,void 0,s=>{i=Ir(n(s,op(n)(t))),r?(r.unsubscribe(),r=null,i.subscribe(e)):o=!0})),o&&(r.unsubscribe(),r=null,i.subscribe(e))})}function _B(n,t,e,r,o){return(i,s)=>{let a=e,l=t,c=0;i.subscribe(jt(s,u=>{let d=c++;l=a?n(l,u,d):(a=!0,u),r&&s.next(l)},o&&(()=>{a&&s.next(l),s.complete()})))}}function $u(n,t){return Bt(t)?Kr(n,t,1):Kr(n,1)}function ip(n){return Jt((t,e)=>{let r=!1;t.subscribe(jt(e,o=>{r=!0,e.next(o)},()=>{r||e.next(n),e.complete()}))})}function Ti(n){return n<=0?()=>Uo:Jt((t,e)=>{let r=0;t.subscribe(jt(e,o=>{++r<=n&&(e.next(o),n<=r&&e.complete())}))})}function MC(n,t=ai){return n=n??ope,Jt((e,r)=>{let o,i=!0;e.subscribe(jt(r,s=>{let a=t(s);(i||!n(o,a))&&(i=!1,o=a,r.next(s))}))})}function ope(n,t){return n===t}function PC(n=ipe){return Jt((t,e)=>{let r=!1;t.subscribe(jt(e,o=>{r=!0,e.next(o)},()=>r?e.complete():e.error(n())))})}function ipe(){return new Lu}function xh(n){return Jt((t,e)=>{try{t.subscribe(e)}finally{e.add(n)}})}function Vu(n,t){let e=arguments.length>=2;return r=>r.pipe(n?fr((o,i)=>n(o,i,r)):ai,Ti(1),e?ip(t):PC(()=>new Lu))}function hg(n){return n<=0?()=>Uo:Jt((t,e)=>{let r=[];t.subscribe(jt(e,o=>{r.push(o),n<r.length&&r.shift()},()=>{for(let o of r)e.next(o);e.complete()},void 0,()=>{r=null}))})}function LA(n,t){let e=arguments.length>=2;return r=>r.pipe(n?fr((o,i)=>n(o,i,r)):ai,hg(1),e?ip(t):PC(()=>new Lu))}function $A(n,t){return Jt(_B(n,t,arguments.length>=2,!0))}function VA(n){return fr((t,e)=>n<=e)}function sp(...n){let t=Jl(n);return Jt((e,r)=>{(t?fg(n,e,t):fg(n,e)).subscribe(r)})}function li(n,t){return Jt((e,r)=>{let o=null,i=0,s=!1,a=()=>s&&!o&&r.complete();e.subscribe(jt(r,l=>{o?.unsubscribe();let c=0,u=i++;Ir(n(l,u)).subscribe(o=jt(r,d=>r.next(t?t(l,d,u,c++):d),()=>{o=null,a()}))},()=>{s=!0,a()}))})}function ap(n){return Jt((t,e)=>{Ir(n).subscribe(jt(e,()=>e.complete(),Vv)),!e.closed&&t.subscribe(e)})}function ao(n,t,e){let r=Bt(n)||t||e?{next:n,error:t,complete:e}:n;return r?Jt((o,i)=>{var s;(s=r.subscribe)===null||s===void 0||s.call(r);let a=!0;o.subscribe(jt(i,l=>{var c;(c=r.next)===null||c===void 0||c.call(r,l),i.next(l)},()=>{var l;a=!1,(l=r.complete)===null||l===void 0||l.call(r),i.complete()},l=>{var c;a=!1,(c=r.error)===null||c===void 0||c.call(r,l),i.error(l)},()=>{var l,c;a&&((l=r.unsubscribe)===null||l===void 0||l.call(r)),(c=r.finalize)===null||c===void 0||c.call(r)}))}):ai}var hz="https://g.co/ng/security#xss",nt=class extends Error{code;constructor(t,e){super(v_(t,e)),this.code=t}};function v_(n,t){return`${`NG0${Math.abs(n)}`}${t?": "+t:""}`}var mz=Symbol("InputSignalNode#UNSET"),spe=Ft(ke({},_A),{transformFn:void 0,applyValueToInputSignal(n,t){sC(n,t)}});function gz(n,t){let e=Object.create(spe);e.value=n,e.transformFn=t?.transform;function r(){if(nC(e),e.value===mz)throw new nt(-950,!1);return e.value}return r[ss]=e,r}function r0(n){return{toString:n}.toString()}var FC="__parameters__";function ape(n){return function(...e){if(n){let r=n(...e);for(let o in r)this[o]=r[o]}}}function yz(n,t,e){return r0(()=>{let r=ape(t);function o(...i){if(this instanceof o)return r.apply(this,i),this;let s=new o(...i);return a.annotation=s,a;function a(l,c,u){let d=l.hasOwnProperty(FC)?l[FC]:Object.defineProperty(l,FC,{value:[]})[FC];for(;d.length<=u;)d.push(null);return(d[u]=d[u]||[]).push(s),l}}return e&&(o.prototype=Object.create(e.prototype)),o.prototype.ngMetadataName=n,o.annotationCls=o,o})}var Kv=globalThis;function er(n){for(let t in n)if(n[t]===er)return t;throw Error("Could not find renamed property on target object.")}function lpe(n,t){for(let e in t)t.hasOwnProperty(e)&&!n.hasOwnProperty(e)&&(n[e]=t[e])}function ui(n){if(typeof n=="string")return n;if(Array.isArray(n))return"["+n.map(ui).join(", ")+"]";if(n==null)return""+n;if(n.overriddenName)return`${n.overriddenName}`;if(n.name)return`${n.name}`;let t=n.toString();if(t==null)return""+t;let e=t.indexOf(`
`);return e===-1?t:t.substring(0,e)}function QA(n,t){return n==null||n===""?t===null?"":t:t==null||t===""?n:n+" "+t}var cpe=er({__forward_ref__:er});function Ni(n){return n.__forward_ref__=Ni,n.toString=function(){return ui(this())},n}function ci(n){return xz(n)?n():n}function xz(n){return typeof n=="function"&&n.hasOwnProperty(cpe)&&n.__forward_ref__===Ni}function Me(n){return{token:n.token,providedIn:n.providedIn||null,factory:n.factory,value:void 0}}function Ao(n){return{providers:n.providers||[],imports:n.imports||[]}}function b_(n){return SB(n,bz)||SB(n,wz)}function vz(n){return b_(n)!==null}function SB(n,t){return n.hasOwnProperty(t)?n[t]:null}function upe(n){let t=n&&(n[bz]||n[wz]);return t||null}function IB(n){return n&&(n.hasOwnProperty(EB)||n.hasOwnProperty(dpe))?n[EB]:null}var bz=er({\u0275prov:er}),EB=er({\u0275inj:er}),wz=er({ngInjectableDef:er}),dpe=er({ngInjectorDef:er}),Ge=class{_desc;ngMetadataName="InjectionToken";\u0275prov;constructor(t,e){this._desc=t,this.\u0275prov=void 0,typeof e=="number"?this.__NG_ELEMENT_ID__=e:e!==void 0&&(this.\u0275prov=Me({token:this,providedIn:e.providedIn||"root",factory:e.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}};function Cz(n){return n&&!!n.\u0275providers}var ppe=er({\u0275cmp:er}),fpe=er({\u0275dir:er}),hpe=er({\u0275pipe:er}),mpe=er({\u0275mod:er}),KC=er({\u0275fac:er}),qv=er({__NG_ELEMENT_ID__:er}),TB=er({__NG_ENV_ID__:er});function Di(n){return typeof n=="string"?n:n==null?"":String(n)}function gpe(n){return typeof n=="function"?n.name||n.toString():typeof n=="object"&&n!=null&&typeof n.type=="function"?n.type.name||n.type.toString():Di(n)}function ype(n,t){let e=t?`. Dependency path: ${t.join(" > ")} > ${n}`:"";throw new nt(-200,n)}function tR(n,t){throw new nt(-201,!1)}var Qt=function(n){return n[n.Default=0]="Default",n[n.Host=1]="Host",n[n.Self=2]="Self",n[n.SkipSelf=4]="SkipSelf",n[n.Optional=8]="Optional",n}(Qt||{}),JA;function _z(){return JA}function Es(n){let t=JA;return JA=n,t}function Sz(n,t,e){let r=b_(n);if(r&&r.providedIn=="root")return r.value===void 0?r.value=r.factory():r.value;if(e&Qt.Optional)return null;if(t!==void 0)return t;tR(n,"Injector")}var xpe={},Xv=xpe,e2="__NG_DI_FLAG__",XC="ngTempTokenPath",vpe="ngTokenPath",bpe=/\n/gm,wpe="\u0275",DB="__source",vg;function Cpe(){return vg}function lp(n){let t=vg;return vg=n,t}function _pe(n,t=Qt.Default){if(vg===void 0)throw new nt(-203,!1);return vg===null?Sz(n,void 0,t):vg.get(n,t&Qt.Optional?null:void 0,t)}function it(n,t=Qt.Default){return(_z()||_pe)(ci(n),t)}function Q(n,t=Qt.Default){return it(n,w_(t))}function w_(n){return typeof n>"u"||typeof n=="number"?n:0|(n.optional&&8)|(n.host&&1)|(n.self&&2)|(n.skipSelf&&4)}function t2(n){let t=[];for(let e=0;e<n.length;e++){let r=ci(n[e]);if(Array.isArray(r)){if(r.length===0)throw new nt(900,!1);let o,i=Qt.Default;for(let s=0;s<r.length;s++){let a=r[s],l=Spe(a);typeof l=="number"?l===-1?o=a.token:i|=l:o=a}t.push(it(o,i))}else t.push(it(r))}return t}function Iz(n,t){return n[e2]=t,n.prototype[e2]=t,n}function Spe(n){return n[e2]}function Ipe(n,t,e,r){let o=n[XC];throw t[DB]&&o.unshift(t[DB]),n.message=Epe(`
`+n.message,o,e,r),n[vpe]=o,n[XC]=null,n}function Epe(n,t,e,r=null){n=n&&n.charAt(0)===`
`&&n.charAt(1)==wpe?n.slice(2):n;let o=ui(t);if(Array.isArray(t))o=t.map(ui).join(" -> ");else if(typeof t=="object"){let i=[];for(let s in t)if(t.hasOwnProperty(s)){let a=t[s];i.push(s+":"+(typeof a=="string"?JSON.stringify(a):ui(a)))}o=`{${i.join(", ")}}`}return`${e}${r?"("+r+")":""}[${o}]: ${n.replace(bpe,`
  `)}`}var nR=Iz(yz("Optional"),8);var Tpe=Iz(yz("SkipSelf"),4);function wg(n,t){let e=n.hasOwnProperty(KC);return e?n[KC]:null}function Dpe(n,t,e){if(n.length!==t.length)return!1;for(let r=0;r<n.length;r++){let o=n[r],i=t[r];if(e&&(o=e(o),i=e(i)),i!==o)return!1}return!0}function kpe(n){return n.flat(Number.POSITIVE_INFINITY)}function rR(n,t){n.forEach(e=>Array.isArray(e)?rR(e,t):t(e))}function Ez(n,t,e){t>=n.length?n.push(e):n.splice(t,0,e)}function YC(n,t){return t>=n.length-1?n.pop():n.splice(t,1)[0]}function Npe(n,t,e,r){let o=n.length;if(o==t)n.push(e,r);else if(o===1)n.push(r,n[0]),n[0]=e;else{for(o--,n.push(n[o-1],n[o]);o>t;){let i=o-2;n[o]=n[i],o--}n[t]=e,n[t+1]=r}}function C_(n,t,e){let r=o0(n,t);return r>=0?n[r|1]=e:(r=~r,Npe(n,r,t,e)),r}function BA(n,t){let e=o0(n,t);if(e>=0)return n[e|1]}function o0(n,t){return Ape(n,t,1)}function Ape(n,t,e){let r=0,o=n.length>>e;for(;o!==r;){let i=r+(o-r>>1),s=n[i<<e];if(t===s)return i<<e;s>t?o=i:r=i+1}return~(o<<e)}var Cg={},ki=[],_g=new Ge(""),Tz=new Ge("",-1),Dz=new Ge(""),ZC=class{get(t,e=Xv){if(e===Xv){let r=new Error(`NullInjectorError: No provider for ${ui(t)}!`);throw r.name="NullInjectorError",r}return e}};function kz(n,t){let e=n[mpe]||null;if(!e&&t===!0)throw new Error(`Type ${ui(n)} does not have '\u0275mod' property.`);return e}function Bu(n){return n[ppe]||null}function Nz(n){return n[fpe]||null}function Az(n){return n[hpe]||null}function Rz(n){let t=Bu(n)||Nz(n)||Az(n);return t!==null&&t.standalone}function Ng(n){return{\u0275providers:n}}function Rpe(...n){return{\u0275providers:Oz(!0,n),\u0275fromNgModule:!0}}function Oz(n,...t){let e=[],r=new Set,o,i=s=>{e.push(s)};return rR(t,s=>{let a=s;n2(a,i,[],r)&&(o||=[],o.push(a))}),o!==void 0&&Mz(o,i),e}function Mz(n,t){for(let e=0;e<n.length;e++){let{ngModule:r,providers:o}=n[e];oR(o,i=>{t(i,r)})}}function n2(n,t,e,r){if(n=ci(n),!n)return!1;let o=null,i=IB(n),s=!i&&Bu(n);if(!i&&!s){let l=n.ngModule;if(i=IB(l),i)o=l;else return!1}else{if(s&&!s.standalone)return!1;o=n}let a=r.has(o);if(s){if(a)return!1;if(r.add(o),s.dependencies){let l=typeof s.dependencies=="function"?s.dependencies():s.dependencies;for(let c of l)n2(c,t,e,r)}}else if(i){if(i.imports!=null&&!a){r.add(o);let c;try{rR(i.imports,u=>{n2(u,t,e,r)&&(c||=[],c.push(u))})}finally{}c!==void 0&&Mz(c,t)}if(!a){let c=wg(o)||(()=>new o);t({provide:o,useFactory:c,deps:ki},o),t({provide:Dz,useValue:o,multi:!0},o),t({provide:_g,useValue:()=>it(o),multi:!0},o)}let l=i.providers;if(l!=null&&!a){let c=n;oR(l,u=>{t(u,c)})}}else return!1;return o!==n&&n.providers!==void 0}function oR(n,t){for(let e of n)Cz(e)&&(e=e.\u0275providers),Array.isArray(e)?oR(e,t):t(e)}var Ope=er({provide:String,useValue:er});function Pz(n){return n!==null&&typeof n=="object"&&Ope in n}function Mpe(n){return!!(n&&n.useExisting)}function Ppe(n){return!!(n&&n.useFactory)}function Sg(n){return typeof n=="function"}function Fpe(n){return!!n.useClass}var __=new Ge(""),UC={},Lpe={},zA;function S_(){return zA===void 0&&(zA=new ZC),zA}var lo=class{},Yv=class extends lo{parent;source;scopes;records=new Map;_ngOnDestroyHooks=new Set;_onDestroyHooks=[];get destroyed(){return this._destroyed}_destroyed=!1;injectorDefTypes;constructor(t,e,r,o){super(),this.parent=e,this.source=r,this.scopes=o,o2(t,s=>this.processProvider(s)),this.records.set(Tz,mg(void 0,this)),o.has("environment")&&this.records.set(lo,mg(void 0,this));let i=this.records.get(__);i!=null&&typeof i.value=="string"&&this.scopes.add(i.value),this.injectorDefTypes=new Set(this.get(Dz,ki,Qt.Self))}destroy(){jv(this),this._destroyed=!0;let t=gn(null);try{for(let r of this._ngOnDestroyHooks)r.ngOnDestroy();let e=this._onDestroyHooks;this._onDestroyHooks=[];for(let r of e)r()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),gn(t)}}onDestroy(t){return jv(this),this._onDestroyHooks.push(t),()=>this.removeOnDestroy(t)}runInContext(t){jv(this);let e=lp(this),r=Es(void 0),o;try{return t()}finally{lp(e),Es(r)}}get(t,e=Xv,r=Qt.Default){if(jv(this),t.hasOwnProperty(TB))return t[TB](this);r=w_(r);let o,i=lp(this),s=Es(void 0);try{if(!(r&Qt.SkipSelf)){let l=this.records.get(t);if(l===void 0){let c=Upe(t)&&b_(t);c&&this.injectableDefInScope(c)?l=mg(r2(t),UC):l=null,this.records.set(t,l)}if(l!=null)return this.hydrate(t,l)}let a=r&Qt.Self?S_():this.parent;return e=r&Qt.Optional&&e===Xv?null:e,a.get(t,e)}catch(a){if(a.name==="NullInjectorError"){if((a[XC]=a[XC]||[]).unshift(ui(t)),i)throw a;return Ipe(a,t,"R3InjectorError",this.source)}else throw a}finally{Es(s),lp(i)}}resolveInjectorInitializers(){let t=gn(null),e=lp(this),r=Es(void 0),o;try{let i=this.get(_g,ki,Qt.Self);for(let s of i)s()}finally{lp(e),Es(r),gn(t)}}toString(){let t=[],e=this.records;for(let r of e.keys())t.push(ui(r));return`R3Injector[${t.join(", ")}]`}processProvider(t){t=ci(t);let e=Sg(t)?t:ci(t&&t.provide),r=Vpe(t);if(!Sg(t)&&t.multi===!0){let o=this.records.get(e);o||(o=mg(void 0,UC,!0),o.factory=()=>t2(o.multi),this.records.set(e,o)),e=t,o.multi.push(t)}this.records.set(e,r)}hydrate(t,e){let r=gn(null);try{return e.value===UC&&(e.value=Lpe,e.value=e.factory()),typeof e.value=="object"&&e.value&&zpe(e.value)&&this._ngOnDestroyHooks.add(e.value),e.value}finally{gn(r)}}injectableDefInScope(t){if(!t.providedIn)return!1;let e=ci(t.providedIn);return typeof e=="string"?e==="any"||this.scopes.has(e):this.injectorDefTypes.has(e)}removeOnDestroy(t){let e=this._onDestroyHooks.indexOf(t);e!==-1&&this._onDestroyHooks.splice(e,1)}};function r2(n){let t=b_(n),e=t!==null?t.factory:wg(n);if(e!==null)return e;if(n instanceof Ge)throw new nt(204,!1);if(n instanceof Function)return $pe(n);throw new nt(204,!1)}function $pe(n){if(n.length>0)throw new nt(204,!1);let e=upe(n);return e!==null?()=>e.factory(n):()=>new n}function Vpe(n){if(Pz(n))return mg(void 0,n.useValue);{let t=Fz(n);return mg(t,UC)}}function Fz(n,t,e){let r;if(Sg(n)){let o=ci(n);return wg(o)||r2(o)}else if(Pz(n))r=()=>ci(n.useValue);else if(Ppe(n))r=()=>n.useFactory(...t2(n.deps||[]));else if(Mpe(n))r=()=>it(ci(n.useExisting));else{let o=ci(n&&(n.useClass||n.provide));if(Bpe(n))r=()=>new o(...t2(n.deps));else return wg(o)||r2(o)}return r}function jv(n){if(n.destroyed)throw new nt(205,!1)}function mg(n,t,e=!1){return{factory:n,value:t,multi:e?[]:void 0}}function Bpe(n){return!!n.deps}function zpe(n){return n!==null&&typeof n=="object"&&typeof n.ngOnDestroy=="function"}function Upe(n){return typeof n=="function"||typeof n=="object"&&n instanceof Ge}function o2(n,t){for(let e of n)Array.isArray(e)?o2(e,t):e&&Cz(e)?o2(e.\u0275providers,t):t(e)}function Ai(n,t){n instanceof Yv&&jv(n);let e,r=lp(n),o=Es(void 0);try{return t()}finally{lp(r),Es(o)}}function Lz(){return _z()!==void 0||Cpe()!=null}function $z(n){if(!Lz())throw new nt(-203,!1)}function Wpe(n){return typeof n=="function"}var qu=0,sn=1,Lt=2,Wo=3,ma=4,xa=5,QC=6,JC=7,Ds=8,Zv=9,zu=10,Rr=11,Qv=12,kB=13,Ag=14,nc=15,bh=16,gg=17,Uu=18,I_=19,Vz=20,cp=21,UA=22,e_=23,as=24,rc=25,Bz=1;var wh=7,t_=8,Ig=9,ls=10;function up(n){return Array.isArray(n)&&typeof n[Bz]=="object"}function Ku(n){return Array.isArray(n)&&n[Bz]===!0}function zz(n){return(n.flags&4)!==0}function Dh(n){return n.componentOffset>-1}function iR(n){return(n.flags&1)===1}function Wu(n){return!!n.template}function n_(n){return(n[Lt]&512)!==0}function i0(n){return(n[Lt]&256)===256}var i2=class{previousValue;currentValue;firstChange;constructor(t,e,r){this.previousValue=t,this.currentValue=e,this.firstChange=r}isFirstChange(){return this.firstChange}};function Uz(n,t,e,r){t!==null?t.applyValueToInputSignal(t,r):n[e]=r}var Ri=(()=>{let n=()=>Wz;return n.ngInherit=!0,n})();function Wz(n){return n.type.prototype.ngOnChanges&&(n.setInput=jpe),Gpe}function Gpe(){let n=jz(this),t=n?.current;if(t){let e=n.previous;if(e===Cg)n.previous=t;else for(let r in t)e[r]=t[r];n.current=null,this.ngOnChanges(t)}}function jpe(n,t,e,r,o){let i=this.declaredInputs[r],s=jz(n)||Hpe(n,{previous:Cg,current:null}),a=s.current||(s.current={}),l=s.previous,c=l[i];a[i]=new i2(c&&c.currentValue,e,l===Cg),Uz(n,t,o,e)}var Gz="__ngSimpleChanges__";function jz(n){return n[Gz]||null}function Hpe(n,t){return n[Gz]=t}var NB=null;var Ts=function(n,t,e){NB?.(n,t,e)},qpe="svg",Kpe="math";function oc(n){for(;Array.isArray(n);)n=n[qu];return n}function Hz(n,t){return oc(t[n])}function va(n,t){return oc(t[n.index])}function qz(n,t){return n.data[t]}function Xpe(n,t){return n[t]}function ic(n,t){let e=t[n];return up(e)?e:e[qu]}function Ype(n){return(n[Lt]&4)===4}function sR(n){return(n[Lt]&128)===128}function Zpe(n){return Ku(n[Wo])}function r_(n,t){return t==null?null:n[t]}function Kz(n){n[gg]=0}function aR(n){n[Lt]&1024||(n[Lt]|=1024,sR(n)&&T_(n))}function Qpe(n,t){for(;n>0;)t=t[Ag],n--;return t}function E_(n){return!!(n[Lt]&9216||n[as]?.dirty)}function s2(n){n[zu].changeDetectionScheduler?.notify(9),n[Lt]&64&&(n[Lt]|=1024),E_(n)&&T_(n)}function T_(n){n[zu].changeDetectionScheduler?.notify(0);let t=Ch(n);for(;t!==null&&!(t[Lt]&8192||(t[Lt]|=8192,!sR(t)));)t=Ch(t)}function Xz(n,t){if(i0(n))throw new nt(911,!1);n[cp]===null&&(n[cp]=[]),n[cp].push(t)}function Jpe(n,t){if(n[cp]===null)return;let e=n[cp].indexOf(t);e!==-1&&n[cp].splice(e,1)}function Ch(n){let t=n[Wo];return Ku(t)?t[Wo]:t}function Yz(n){return n[JC]??=[]}function Zz(n){return n.cleanup??=[]}function efe(n,t,e,r){let o=Yz(t);o.push(e),n.firstCreatePass&&Zz(n).push(r,o.length-1)}var Kt={lFrame:iU(null),bindingsEnabled:!0,skipHydrationRootTNode:null};var a2=!1;function tfe(){return Kt.lFrame.elementDepthCount}function nfe(){Kt.lFrame.elementDepthCount++}function rfe(){Kt.lFrame.elementDepthCount--}function Qz(){return Kt.bindingsEnabled}function ofe(){return Kt.skipHydrationRootTNode!==null}function ife(n){return Kt.skipHydrationRootTNode===n}function sfe(){Kt.skipHydrationRootTNode=null}function en(){return Kt.lFrame.lView}function co(){return Kt.lFrame.tView}function ve(n){return Kt.lFrame.contextLView=n,n[Ds]}function be(n){return Kt.lFrame.contextLView=null,n}function Oi(){let n=Jz();for(;n!==null&&n.type===64;)n=n.parent;return n}function Jz(){return Kt.lFrame.currentTNode}function afe(){let n=Kt.lFrame,t=n.currentTNode;return n.isParent?t:t.parent}function s0(n,t){let e=Kt.lFrame;e.currentTNode=n,e.isParent=t}function eU(){return Kt.lFrame.isParent}function lfe(){Kt.lFrame.isParent=!1}function cfe(){return Kt.lFrame.contextLView}function tU(){return a2}function AB(n){let t=a2;return a2=n,t}function lR(){let n=Kt.lFrame,t=n.bindingRootIndex;return t===-1&&(t=n.bindingRootIndex=n.tView.bindingStartIndex),t}function cR(){return Kt.lFrame.bindingIndex}function ufe(n){return Kt.lFrame.bindingIndex=n}function a0(){return Kt.lFrame.bindingIndex++}function l0(n){let t=Kt.lFrame,e=t.bindingIndex;return t.bindingIndex=t.bindingIndex+n,e}function dfe(){return Kt.lFrame.inI18n}function pfe(n,t){let e=Kt.lFrame;e.bindingIndex=e.bindingRootIndex=n,l2(t)}function ffe(){return Kt.lFrame.currentDirectiveIndex}function l2(n){Kt.lFrame.currentDirectiveIndex=n}function hfe(n){let t=Kt.lFrame.currentDirectiveIndex;return t===-1?null:n[t]}function nU(){return Kt.lFrame.currentQueryIndex}function uR(n){Kt.lFrame.currentQueryIndex=n}function mfe(n){let t=n[sn];return t.type===2?t.declTNode:t.type===1?n[xa]:null}function rU(n,t,e){if(e&Qt.SkipSelf){let o=t,i=n;for(;o=o.parent,o===null&&!(e&Qt.Host);)if(o=mfe(i),o===null||(i=i[Ag],o.type&10))break;if(o===null)return!1;t=o,n=i}let r=Kt.lFrame=oU();return r.currentTNode=t,r.lView=n,!0}function dR(n){let t=oU(),e=n[sn];Kt.lFrame=t,t.currentTNode=e.firstChild,t.lView=n,t.tView=e,t.contextLView=n,t.bindingIndex=e.bindingStartIndex,t.inI18n=!1}function oU(){let n=Kt.lFrame,t=n===null?null:n.child;return t===null?iU(n):t}function iU(n){let t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:n,child:null,inI18n:!1};return n!==null&&(n.child=t),t}function sU(){let n=Kt.lFrame;return Kt.lFrame=n.parent,n.currentTNode=null,n.lView=null,n}var aU=sU;function pR(){let n=sU();n.isParent=!0,n.tView=null,n.selectedIndex=-1,n.contextLView=null,n.elementDepthCount=0,n.currentDirectiveIndex=-1,n.currentNamespace=null,n.bindingRootIndex=-1,n.bindingIndex=-1,n.currentQueryIndex=0}function gfe(n){return(Kt.lFrame.contextLView=Qpe(n,Kt.lFrame.contextLView))[Ds]}function ac(){return Kt.lFrame.selectedIndex}function _h(n){Kt.lFrame.selectedIndex=n}function c0(){let n=Kt.lFrame;return qz(n.tView,n.selectedIndex)}function yfe(){return Kt.lFrame.currentNamespace}var lU=!0;function fR(){return lU}function hR(n){lU=n}function xfe(n,t,e){let{ngOnChanges:r,ngOnInit:o,ngDoCheck:i}=t.type.prototype;if(r){let s=Wz(t);(e.preOrderHooks??=[]).push(n,s),(e.preOrderCheckHooks??=[]).push(n,s)}o&&(e.preOrderHooks??=[]).push(0-n,o),i&&((e.preOrderHooks??=[]).push(n,i),(e.preOrderCheckHooks??=[]).push(n,i))}function mR(n,t){for(let e=t.directiveStart,r=t.directiveEnd;e<r;e++){let i=n.data[e].type.prototype,{ngAfterContentInit:s,ngAfterContentChecked:a,ngAfterViewInit:l,ngAfterViewChecked:c,ngOnDestroy:u}=i;s&&(n.contentHooks??=[]).push(-e,s),a&&((n.contentHooks??=[]).push(e,a),(n.contentCheckHooks??=[]).push(e,a)),l&&(n.viewHooks??=[]).push(-e,l),c&&((n.viewHooks??=[]).push(e,c),(n.viewCheckHooks??=[]).push(e,c)),u!=null&&(n.destroyHooks??=[]).push(e,u)}}function WC(n,t,e){cU(n,t,3,e)}function GC(n,t,e,r){(n[Lt]&3)===e&&cU(n,t,e,r)}function WA(n,t){let e=n[Lt];(e&3)===t&&(e&=16383,e+=1,n[Lt]=e)}function cU(n,t,e,r){let o=r!==void 0?n[gg]&65535:0,i=r??-1,s=t.length-1,a=0;for(let l=o;l<s;l++)if(typeof t[l+1]=="number"){if(a=t[l],r!=null&&a>=r)break}else t[l]<0&&(n[gg]+=65536),(a<i||i==-1)&&(vfe(n,e,t,l),n[gg]=(n[gg]&4294901760)+l+2),l++}function RB(n,t){Ts(4,n,t);let e=gn(null);try{t.call(n)}finally{gn(e),Ts(5,n,t)}}function vfe(n,t,e,r){let o=e[r]<0,i=e[r+1],s=o?-e[r]:e[r],a=n[s];o?n[Lt]>>14<n[gg]>>16&&(n[Lt]&3)===t&&(n[Lt]+=16384,RB(a,i)):RB(a,i)}var bg=-1,Sh=class{factory;injectImpl;resolving=!1;canSeeViewProviders;multi;componentProviders;index;providerFactory;constructor(t,e,r){this.factory=t,this.canSeeViewProviders=e,this.injectImpl=r}};function bfe(n){return n instanceof Sh}function wfe(n){return(n.flags&8)!==0}function Cfe(n){return(n.flags&16)!==0}function _fe(n,t,e){let r=0;for(;r<e.length;){let o=e[r];if(typeof o=="number"){if(o!==0)break;r++;let i=e[r++],s=e[r++],a=e[r++];n.setAttribute(t,s,a,i)}else{let i=o,s=e[++r];Sfe(i)?n.setProperty(t,i,s):n.setAttribute(t,i,s),r++}}return r}function uU(n){return n===3||n===4||n===6}function Sfe(n){return n.charCodeAt(0)===64}function Eg(n,t){if(!(t===null||t.length===0))if(n===null||n.length===0)n=t.slice();else{let e=-1;for(let r=0;r<t.length;r++){let o=t[r];typeof o=="number"?e=o:e===0||(e===-1||e===2?OB(n,e,o,null,t[++r]):OB(n,e,o,null,null))}}return n}function OB(n,t,e,r,o){let i=0,s=n.length;if(t===-1)s=-1;else for(;i<n.length;){let a=n[i++];if(typeof a=="number"){if(a===t){s=-1;break}else if(a>t){s=i-1;break}}}for(;i<n.length;){let a=n[i];if(typeof a=="number")break;if(a===e){if(r===null){o!==null&&(n[i+1]=o);return}else if(r===n[i+1]){n[i+2]=o;return}}i++,r!==null&&i++,o!==null&&i++}s!==-1&&(n.splice(s,0,t),i=s+1),n.splice(i++,0,e),r!==null&&n.splice(i++,0,r),o!==null&&n.splice(i++,0,o)}var GA={},c2=class{injector;parentInjector;constructor(t,e){this.injector=t,this.parentInjector=e}get(t,e,r){r=w_(r);let o=this.injector.get(t,GA,r);return o!==GA||e===GA?o:this.parentInjector.get(t,e,r)}};function dU(n){return n!==bg}function o_(n){return n&32767}function Ife(n){return n>>16}function i_(n,t){let e=Ife(n),r=t;for(;e>0;)r=r[Ag],e--;return r}var u2=!0;function MB(n){let t=u2;return u2=n,t}var Efe=256,pU=Efe-1,fU=5,Tfe=0,tc={};function Dfe(n,t,e){let r;typeof e=="string"?r=e.charCodeAt(0)||0:e.hasOwnProperty(qv)&&(r=e[qv]),r==null&&(r=e[qv]=Tfe++);let o=r&pU,i=1<<o;t.data[n+(o>>fU)]|=i}function s_(n,t){let e=hU(n,t);if(e!==-1)return e;let r=t[sn];r.firstCreatePass&&(n.injectorIndex=t.length,jA(r.data,n),jA(t,null),jA(r.blueprint,null));let o=gR(n,t),i=n.injectorIndex;if(dU(o)){let s=o_(o),a=i_(o,t),l=a[sn].data;for(let c=0;c<8;c++)t[i+c]=a[s+c]|l[s+c]}return t[i+8]=o,i}function jA(n,t){n.push(0,0,0,0,0,0,0,0,t)}function hU(n,t){return n.injectorIndex===-1||n.parent&&n.parent.injectorIndex===n.injectorIndex||t[n.injectorIndex+8]===null?-1:n.injectorIndex}function gR(n,t){if(n.parent&&n.parent.injectorIndex!==-1)return n.parent.injectorIndex;let e=0,r=null,o=t;for(;o!==null;){if(r=vU(o),r===null)return bg;if(e++,o=o[Ag],r.injectorIndex!==-1)return r.injectorIndex|e<<16}return bg}function d2(n,t,e){Dfe(n,t,e)}function kfe(n,t){if(t==="class")return n.classes;if(t==="style")return n.styles;let e=n.attrs;if(e){let r=e.length,o=0;for(;o<r;){let i=e[o];if(uU(i))break;if(i===0)o=o+2;else if(typeof i=="number")for(o++;o<r&&typeof e[o]=="string";)o++;else{if(i===t)return e[o+1];o=o+2}}}return null}function mU(n,t,e){if(e&Qt.Optional||n!==void 0)return n;tR(t,"NodeInjector")}function gU(n,t,e,r){if(e&Qt.Optional&&r===void 0&&(r=null),!(e&(Qt.Self|Qt.Host))){let o=n[Zv],i=Es(void 0);try{return o?o.get(t,r,e&Qt.Optional):Sz(t,r,e&Qt.Optional)}finally{Es(i)}}return mU(r,t,e)}function yU(n,t,e,r=Qt.Default,o){if(n!==null){if(t[Lt]&2048&&!(r&Qt.Self)){let s=Ofe(n,t,e,r,tc);if(s!==tc)return s}let i=xU(n,t,e,r,tc);if(i!==tc)return i}return gU(t,e,r,o)}function xU(n,t,e,r,o){let i=Afe(e);if(typeof i=="function"){if(!rU(t,n,r))return r&Qt.Host?mU(o,e,r):gU(t,e,r,o);try{let s;if(s=i(r),s==null&&!(r&Qt.Optional))tR(e);else return s}finally{aU()}}else if(typeof i=="number"){let s=null,a=hU(n,t),l=bg,c=r&Qt.Host?t[nc][xa]:null;for((a===-1||r&Qt.SkipSelf)&&(l=a===-1?gR(n,t):t[a+8],l===bg||!FB(r,!1)?a=-1:(s=t[sn],a=o_(l),t=i_(l,t)));a!==-1;){let u=t[sn];if(PB(i,a,u.data)){let d=Nfe(a,t,e,s,r,c);if(d!==tc)return d}l=t[a+8],l!==bg&&FB(r,t[sn].data[a+8]===c)&&PB(i,a,t)?(s=u,a=o_(l),t=i_(l,t)):a=-1}}return o}function Nfe(n,t,e,r,o,i){let s=t[sn],a=s.data[n+8],l=r==null?Dh(a)&&u2:r!=s&&(a.type&3)!==0,c=o&Qt.Host&&i===a,u=jC(a,s,e,l,c);return u!==null?Jv(t,s,u,a):tc}function jC(n,t,e,r,o){let i=n.providerIndexes,s=t.data,a=i&1048575,l=n.directiveStart,c=n.directiveEnd,u=i>>20,d=r?a:a+u,p=o?a+u:c;for(let f=d;f<p;f++){let h=s[f];if(f<l&&e===h||f>=l&&h.type===e)return f}if(o){let f=s[l];if(f&&Wu(f)&&f.type===e)return l}return null}function Jv(n,t,e,r){let o=n[e],i=t.data;if(bfe(o)){let s=o;s.resolving&&ype(gpe(i[e]));let a=MB(s.canSeeViewProviders);s.resolving=!0;let l,c=s.injectImpl?Es(s.injectImpl):null,u=rU(n,r,Qt.Default);try{o=n[e]=s.factory(void 0,i,n,r),t.firstCreatePass&&e>=r.directiveStart&&xfe(e,i[e],t)}finally{c!==null&&Es(c),MB(a),s.resolving=!1,aU()}}return o}function Afe(n){if(typeof n=="string")return n.charCodeAt(0)||0;let t=n.hasOwnProperty(qv)?n[qv]:void 0;return typeof t=="number"?t>=0?t&pU:Rfe:t}function PB(n,t,e){let r=1<<n;return!!(e[t+(n>>fU)]&r)}function FB(n,t){return!(n&Qt.Self)&&!(n&Qt.Host&&t)}var vh=class{_tNode;_lView;constructor(t,e){this._tNode=t,this._lView=e}get(t,e,r){return yU(this._tNode,this._lView,t,w_(r),e)}};function Rfe(){return new vh(Oi(),en())}function Go(n){return r0(()=>{let t=n.prototype.constructor,e=t[KC]||p2(t),r=Object.prototype,o=Object.getPrototypeOf(n.prototype).constructor;for(;o&&o!==r;){let i=o[KC]||p2(o);if(i&&i!==e)return i;o=Object.getPrototypeOf(o)}return i=>new i})}function p2(n){return xz(n)?()=>{let t=p2(ci(n));return t&&t()}:wg(n)}function Ofe(n,t,e,r,o){let i=n,s=t;for(;i!==null&&s!==null&&s[Lt]&2048&&!n_(s);){let a=xU(i,s,e,r|Qt.Self,tc);if(a!==tc)return a;let l=i.parent;if(!l){let c=s[Vz];if(c){let u=c.get(e,tc,r);if(u!==tc)return u}l=vU(s),s=s[Ag]}i=l}return o}function vU(n){let t=n[sn],e=t.type;return e===2?t.declTNode:e===1?n[xa]:null}function yR(n){return kfe(Oi(),n)}function LB(n,t=null,e=null,r){let o=bU(n,t,e,r);return o.resolveInjectorInitializers(),o}function bU(n,t=null,e=null,r,o=new Set){let i=[e||ki,Rpe(n)];return r=r||(typeof n=="object"?void 0:ui(n)),new Yv(i,t||S_(),r||null,o)}var qn=class n{static THROW_IF_NOT_FOUND=Xv;static NULL=new ZC;static create(t,e){if(Array.isArray(t))return LB({name:""},e,t,"");{let r=t.name??"";return LB({name:r},t.parent,t.providers,r)}}static \u0275prov=Me({token:n,providedIn:"any",factory:()=>it(Tz)});static __NG_ELEMENT_ID__=-1};var Mfe=new Ge("");Mfe.__NG_ELEMENT_ID__=n=>{let t=Oi();if(t===null)throw new nt(204,!1);if(t.type&2)return t.value;if(n&Qt.Optional)return null;throw new nt(204,!1)};var wU=!1,u0=(()=>{class n{static __NG_ELEMENT_ID__=Pfe;static __NG_ENV_ID__=e=>e}return n})(),f2=class extends u0{_lView;constructor(t){super(),this._lView=t}onDestroy(t){return Xz(this._lView,t),()=>Jpe(this._lView,t)}};function Pfe(){return new f2(en())}var Tg=class{},D_=new Ge("",{providedIn:"root",factory:()=>!1});var CU=new Ge(""),_U=new Ge(""),pp=(()=>{class n{taskId=0;pendingTasks=new Set;get _hasPendingTasks(){return this.hasPendingTasks.value}hasPendingTasks=new Wr(!1);add(){this._hasPendingTasks||this.hasPendingTasks.next(!0);let e=this.taskId++;return this.pendingTasks.add(e),e}has(e){return this.pendingTasks.has(e)}remove(e){this.pendingTasks.delete(e),this.pendingTasks.size===0&&this._hasPendingTasks&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this._hasPendingTasks&&this.hasPendingTasks.next(!1)}static \u0275prov=Me({token:n,providedIn:"root",factory:()=>new n})}return n})();var h2=class extends zt{__isAsync;destroyRef=void 0;pendingTasks=void 0;constructor(t=!1){super(),this.__isAsync=t,Lz()&&(this.destroyRef=Q(u0,{optional:!0})??void 0,this.pendingTasks=Q(pp,{optional:!0})??void 0)}emit(t){let e=gn(null);try{super.next(t)}finally{gn(e)}}subscribe(t,e,r){let o=t,i=e||(()=>null),s=r;if(t&&typeof t=="object"){let l=t;o=l.next?.bind(l),i=l.error?.bind(l),s=l.complete?.bind(l)}this.__isAsync&&(i=this.wrapInTimeout(i),o&&(o=this.wrapInTimeout(o)),s&&(s=this.wrapInTimeout(s)));let a=super.subscribe({next:o,error:i,complete:s});return t instanceof Jn&&t.add(a),a}wrapInTimeout(t){return e=>{let r=this.pendingTasks?.add();setTimeout(()=>{t(e),r!==void 0&&this.pendingTasks?.remove(r)})}}},Un=h2;function a_(...n){}function SU(n){let t,e;function r(){n=a_;try{e!==void 0&&typeof cancelAnimationFrame=="function"&&cancelAnimationFrame(e),t!==void 0&&clearTimeout(t)}catch{}}return t=setTimeout(()=>{n(),r()}),typeof requestAnimationFrame=="function"&&(e=requestAnimationFrame(()=>{n(),r()})),()=>r()}function $B(n){return queueMicrotask(()=>n()),()=>{n=a_}}var xR="isAngularZone",l_=xR+"_ID",Ffe=0,ln=class n{hasPendingMacrotasks=!1;hasPendingMicrotasks=!1;isStable=!0;onUnstable=new Un(!1);onMicrotaskEmpty=new Un(!1);onStable=new Un(!1);onError=new Un(!1);constructor(t){let{enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:r=!1,shouldCoalesceRunChangeDetection:o=!1,scheduleInRootZone:i=wU}=t;if(typeof Zone>"u")throw new nt(908,!1);Zone.assertZonePatched();let s=this;s._nesting=0,s._outer=s._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(s._inner=s._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(s._inner=s._inner.fork(Zone.longStackTraceZoneSpec)),s.shouldCoalesceEventChangeDetection=!o&&r,s.shouldCoalesceRunChangeDetection=o,s.callbackScheduled=!1,s.scheduleInRootZone=i,Vfe(s)}static isInAngularZone(){return typeof Zone<"u"&&Zone.current.get(xR)===!0}static assertInAngularZone(){if(!n.isInAngularZone())throw new nt(909,!1)}static assertNotInAngularZone(){if(n.isInAngularZone())throw new nt(909,!1)}run(t,e,r){return this._inner.run(t,e,r)}runTask(t,e,r,o){let i=this._inner,s=i.scheduleEventTask("NgZoneEvent: "+o,t,Lfe,a_,a_);try{return i.runTask(s,e,r)}finally{i.cancelTask(s)}}runGuarded(t,e,r){return this._inner.runGuarded(t,e,r)}runOutsideAngular(t){return this._outer.run(t)}},Lfe={};function vR(n){if(n._nesting==0&&!n.hasPendingMicrotasks&&!n.isStable)try{n._nesting++,n.onMicrotaskEmpty.emit(null)}finally{if(n._nesting--,!n.hasPendingMicrotasks)try{n.runOutsideAngular(()=>n.onStable.emit(null))}finally{n.isStable=!0}}}function $fe(n){if(n.isCheckStableRunning||n.callbackScheduled)return;n.callbackScheduled=!0;function t(){SU(()=>{n.callbackScheduled=!1,m2(n),n.isCheckStableRunning=!0,vR(n),n.isCheckStableRunning=!1})}n.scheduleInRootZone?Zone.root.run(()=>{t()}):n._outer.run(()=>{t()}),m2(n)}function Vfe(n){let t=()=>{$fe(n)},e=Ffe++;n._inner=n._inner.fork({name:"angular",properties:{[xR]:!0,[l_]:e,[l_+e]:!0},onInvokeTask:(r,o,i,s,a,l)=>{if(Bfe(l))return r.invokeTask(i,s,a,l);try{return VB(n),r.invokeTask(i,s,a,l)}finally{(n.shouldCoalesceEventChangeDetection&&s.type==="eventTask"||n.shouldCoalesceRunChangeDetection)&&t(),BB(n)}},onInvoke:(r,o,i,s,a,l,c)=>{try{return VB(n),r.invoke(i,s,a,l,c)}finally{n.shouldCoalesceRunChangeDetection&&!n.callbackScheduled&&!zfe(l)&&t(),BB(n)}},onHasTask:(r,o,i,s)=>{r.hasTask(i,s),o===i&&(s.change=="microTask"?(n._hasPendingMicrotasks=s.microTask,m2(n),vR(n)):s.change=="macroTask"&&(n.hasPendingMacrotasks=s.macroTask))},onHandleError:(r,o,i,s)=>(r.handleError(i,s),n.runOutsideAngular(()=>n.onError.emit(s)),!1)})}function m2(n){n._hasPendingMicrotasks||(n.shouldCoalesceEventChangeDetection||n.shouldCoalesceRunChangeDetection)&&n.callbackScheduled===!0?n.hasPendingMicrotasks=!0:n.hasPendingMicrotasks=!1}function VB(n){n._nesting++,n.isStable&&(n.isStable=!1,n.onUnstable.emit(null))}function BB(n){n._nesting--,vR(n)}var g2=class{hasPendingMicrotasks=!1;hasPendingMacrotasks=!1;isStable=!0;onUnstable=new Un;onMicrotaskEmpty=new Un;onStable=new Un;onError=new Un;run(t,e,r){return t.apply(e,r)}runGuarded(t,e,r){return t.apply(e,r)}runOutsideAngular(t){return t()}runTask(t,e,r,o){return t.apply(e,r)}};function Bfe(n){return IU(n,"__ignore_ng_zone__")}function zfe(n){return IU(n,"__scheduler_tick__")}function IU(n,t){return!Array.isArray(n)||n.length!==1?!1:n[0]?.data?.[t]===!0}var Gu=class{_console=console;handleError(t){this._console.error("ERROR",t)}},Ufe=new Ge("",{providedIn:"root",factory:()=>{let n=Q(ln),t=Q(Gu);return e=>n.runOutsideAngular(()=>t.handleError(e))}});function zB(n,t){return gz(n,t)}function Wfe(n){return gz(mz,n)}var EU=(zB.required=Wfe,zB);function Gfe(){return Rg(Oi(),en())}function Rg(n,t){return new hr(va(n,t))}var hr=(()=>{class n{nativeElement;constructor(e){this.nativeElement=e}static __NG_ELEMENT_ID__=Gfe}return n})();function jfe(n){return n instanceof hr?n.nativeElement:n}var UB=new Set;function fp(n){UB.has(n)||(UB.add(n),performance?.mark?.("mark_feature_usage",{detail:{feature:n}}))}function TU(n){return typeof n=="function"&&n[ss]!==void 0}function kh(n,t){fp("NgSignals");let e=XV(n),r=e[ss];return t?.equal&&(r.equal=t.equal),e.set=o=>sC(r,o),e.update=o=>YV(r,o),e.asReadonly=Hfe.bind(e),e}function Hfe(){let n=this[ss];if(n.readonlyFn===void 0){let t=()=>this();t[ss]=n,n.readonlyFn=t}return n.readonlyFn}function DU(n){return TU(n)&&typeof n.set=="function"}function qfe(){return this._results[Symbol.iterator]()}var c_=class{_emitDistinctChangesOnly;dirty=!0;_onDirty=void 0;_results=[];_changesDetected=!1;_changes=void 0;length=0;first=void 0;last=void 0;get changes(){return this._changes??=new zt}constructor(t=!1){this._emitDistinctChangesOnly=t}get(t){return this._results[t]}map(t){return this._results.map(t)}filter(t){return this._results.filter(t)}find(t){return this._results.find(t)}reduce(t,e){return this._results.reduce(t,e)}forEach(t){this._results.forEach(t)}some(t){return this._results.some(t)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(t,e){this.dirty=!1;let r=kpe(t);(this._changesDetected=!Dpe(this._results,r,e))&&(this._results=r,this.length=r.length,this.last=r[this.length-1],this.first=r[0])}notifyOnChanges(){this._changes!==void 0&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.next(this)}onDirty(t){this._onDirty=t}setDirty(){this.dirty=!0,this._onDirty?.()}destroy(){this._changes!==void 0&&(this._changes.complete(),this._changes.unsubscribe())}[Symbol.iterator]=qfe};function kU(n){return(n.flags&128)===128}var NU=function(n){return n[n.OnPush=0]="OnPush",n[n.Default=1]="Default",n}(NU||{}),AU=new Map,Kfe=0;function Xfe(){return Kfe++}function Yfe(n){AU.set(n[I_],n)}function y2(n){AU.delete(n[I_])}var WB="__ngContext__";function Og(n,t){up(t)?(n[WB]=t[I_],Yfe(t)):n[WB]=t}function RU(n){return MU(n[Qv])}function OU(n){return MU(n[ma])}function MU(n){for(;n!==null&&!Ku(n);)n=n[ma];return n}var x2;function PU(n){x2=n}function FU(){if(x2!==void 0)return x2;if(typeof document<"u")return document;throw new nt(210,!1)}var d0=new Ge("",{providedIn:"root",factory:()=>Zfe}),Zfe="ng",bR=new Ge(""),lc=new Ge("",{providedIn:"platform",factory:()=>"unknown"});var k_=new Ge(""),wR=new Ge("",{providedIn:"root",factory:()=>FU().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});var Qfe="h",Jfe="b";var LU=!1,ehe=new Ge("",{providedIn:"root",factory:()=>LU});var CR=function(n){return n[n.CHANGE_DETECTION=0]="CHANGE_DETECTION",n[n.AFTER_NEXT_RENDER=1]="AFTER_NEXT_RENDER",n}(CR||{}),Mg=new Ge("");var yg=function(n){return n[n.EarlyRead=0]="EarlyRead",n[n.Write=1]="Write",n[n.MixedReadWrite=2]="MixedReadWrite",n[n.Read=3]="Read",n}(yg||{}),$U=(()=>{class n{impl=null;execute(){this.impl?.execute()}static \u0275prov=Me({token:n,providedIn:"root",factory:()=>new n})}return n})(),the=[yg.EarlyRead,yg.Write,yg.MixedReadWrite,yg.Read],nhe=(()=>{class n{ngZone=Q(ln);scheduler=Q(Tg);errorHandler=Q(Gu,{optional:!0});sequences=new Set;deferredRegistrations=new Set;executing=!1;constructor(){Q(Mg,{optional:!0})}execute(){this.executing=!0;for(let e of the)for(let r of this.sequences)if(!(r.erroredOrDestroyed||!r.hooks[e]))try{r.pipelinedValue=this.ngZone.runOutsideAngular(()=>this.maybeTrace(()=>r.hooks[e](r.pipelinedValue),r.snapshot))}catch(o){r.erroredOrDestroyed=!0,this.errorHandler?.handleError(o)}this.executing=!1;for(let e of this.sequences)e.afterRun(),e.once&&(this.sequences.delete(e),e.destroy());for(let e of this.deferredRegistrations)this.sequences.add(e);this.deferredRegistrations.size>0&&this.scheduler.notify(8),this.deferredRegistrations.clear()}register(e){this.executing?this.deferredRegistrations.add(e):(this.sequences.add(e),this.scheduler.notify(7))}unregister(e){this.executing&&this.sequences.has(e)?(e.erroredOrDestroyed=!0,e.pipelinedValue=void 0,e.once=!0):(this.sequences.delete(e),this.deferredRegistrations.delete(e))}maybeTrace(e,r){return r?r.run(CR.AFTER_NEXT_RENDER,e):e()}static \u0275prov=Me({token:n,providedIn:"root",factory:()=>new n})}return n})(),v2=class{impl;hooks;once;snapshot;erroredOrDestroyed=!1;pipelinedValue=void 0;unregisterOnDestroy;constructor(t,e,r,o,i=null){this.impl=t,this.hooks=e,this.once=r,this.snapshot=i,this.unregisterOnDestroy=o?.onDestroy(()=>this.destroy())}afterRun(){this.erroredOrDestroyed=!1,this.pipelinedValue=void 0,this.snapshot?.dispose(),this.snapshot=null}destroy(){this.impl.unregister(this),this.unregisterOnDestroy?.()}};function _R(n,t){!t?.injector&&$z(_R);let e=t?.injector??Q(qn);return fp("NgAfterRender"),VU(n,e,t,!1)}function cc(n,t){!t?.injector&&$z(cc);let e=t?.injector??Q(qn);return fp("NgAfterNextRender"),VU(n,e,t,!0)}function rhe(n,t){if(n instanceof Function){let e=[void 0,void 0,void 0,void 0];return e[t]=n,e}else return[n.earlyRead,n.write,n.mixedReadWrite,n.read]}function VU(n,t,e,r){let o=t.get($U);o.impl??=t.get(nhe);let i=t.get(Mg,null,{optional:!0}),s=e?.phase??yg.MixedReadWrite,a=e?.manualCleanup!==!0?t.get(u0):null,l=new v2(o.impl,rhe(n,s),r,a,i?.snapshot(null));return o.impl.register(l),l}var ohe=()=>null;function BU(n,t,e=!1){return ohe(n,t,e)}function zU(n,t){let e=n.contentQueries;if(e!==null){let r=gn(null);try{for(let o=0;o<e.length;o+=2){let i=e[o],s=e[o+1];if(s!==-1){let a=n.data[s];uR(i),a.contentQueries(2,t[s],s)}}}finally{gn(r)}}}function b2(n,t,e){uR(0);let r=gn(null);try{t(n,e)}finally{gn(r)}}function UU(n,t,e){if(zz(t)){let r=gn(null);try{let o=t.directiveStart,i=t.directiveEnd;for(let s=o;s<i;s++){let a=n.data[s];if(a.contentQueries){let l=e[s];a.contentQueries(1,l,s)}}}finally{gn(r)}}}var sc=function(n){return n[n.Emulated=0]="Emulated",n[n.None=2]="None",n[n.ShadowDom=3]="ShadowDom",n}(sc||{}),LC;function ihe(){if(LC===void 0&&(LC=null,Kv.trustedTypes))try{LC=Kv.trustedTypes.createPolicy("angular",{createHTML:n=>n,createScript:n=>n,createScriptURL:n=>n})}catch{}return LC}function N_(n){return ihe()?.createHTML(n)||n}var $C;function WU(){if($C===void 0&&($C=null,Kv.trustedTypes))try{$C=Kv.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:n=>n,createScript:n=>n,createScriptURL:n=>n})}catch{}return $C}function GB(n){return WU()?.createHTML(n)||n}function jB(n){return WU()?.createScriptURL(n)||n}var ju=class{changingThisBreaksApplicationSecurity;constructor(t){this.changingThisBreaksApplicationSecurity=t}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${hz})`}},w2=class extends ju{getTypeName(){return"HTML"}},C2=class extends ju{getTypeName(){return"Style"}},_2=class extends ju{getTypeName(){return"Script"}},S2=class extends ju{getTypeName(){return"URL"}},I2=class extends ju{getTypeName(){return"ResourceURL"}};function As(n){return n instanceof ju?n.changingThisBreaksApplicationSecurity:n}function Xu(n,t){let e=she(n);if(e!=null&&e!==t){if(e==="ResourceURL"&&t==="URL")return!0;throw new Error(`Required a safe ${t}, got a ${e} (see ${hz})`)}return e===t}function she(n){return n instanceof ju&&n.getTypeName()||null}function GU(n){return new w2(n)}function jU(n){return new C2(n)}function HU(n){return new _2(n)}function qU(n){return new S2(n)}function KU(n){return new I2(n)}function ahe(n){let t=new T2(n);return lhe()?new E2(t):t}var E2=class{inertDocumentHelper;constructor(t){this.inertDocumentHelper=t}getInertBodyElement(t){t="<body><remove></remove>"+t;try{let e=new window.DOMParser().parseFromString(N_(t),"text/html").body;return e===null?this.inertDocumentHelper.getInertBodyElement(t):(e.firstChild?.remove(),e)}catch{return null}}},T2=class{defaultDoc;inertDocument;constructor(t){this.defaultDoc=t,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert")}getInertBodyElement(t){let e=this.inertDocument.createElement("template");return e.innerHTML=N_(t),e}};function lhe(){try{return!!new window.DOMParser().parseFromString(N_(""),"text/html")}catch{return!1}}var che=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;function A_(n){return n=String(n),n.match(che)?n:"unsafe:"+n}function Yu(n){let t={};for(let e of n.split(","))t[e]=!0;return t}function p0(...n){let t={};for(let e of n)for(let r in e)e.hasOwnProperty(r)&&(t[r]=!0);return t}var XU=Yu("area,br,col,hr,img,wbr"),YU=Yu("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),ZU=Yu("rp,rt"),uhe=p0(ZU,YU),dhe=p0(YU,Yu("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),phe=p0(ZU,Yu("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),HB=p0(XU,dhe,phe,uhe),QU=Yu("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),fhe=Yu("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,srcset,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),hhe=Yu("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext"),mhe=p0(QU,fhe,hhe),ghe=Yu("script,style,template"),D2=class{sanitizedSomething=!1;buf=[];sanitizeChildren(t){let e=t.firstChild,r=!0,o=[];for(;e;){if(e.nodeType===Node.ELEMENT_NODE?r=this.startElement(e):e.nodeType===Node.TEXT_NODE?this.chars(e.nodeValue):this.sanitizedSomething=!0,r&&e.firstChild){o.push(e),e=vhe(e);continue}for(;e;){e.nodeType===Node.ELEMENT_NODE&&this.endElement(e);let i=xhe(e);if(i){e=i;break}e=o.pop()}}return this.buf.join("")}startElement(t){let e=qB(t).toLowerCase();if(!HB.hasOwnProperty(e))return this.sanitizedSomething=!0,!ghe.hasOwnProperty(e);this.buf.push("<"),this.buf.push(e);let r=t.attributes;for(let o=0;o<r.length;o++){let i=r.item(o),s=i.name,a=s.toLowerCase();if(!mhe.hasOwnProperty(a)){this.sanitizedSomething=!0;continue}let l=i.value;QU[a]&&(l=A_(l)),this.buf.push(" ",s,'="',KB(l),'"')}return this.buf.push(">"),!0}endElement(t){let e=qB(t).toLowerCase();HB.hasOwnProperty(e)&&!XU.hasOwnProperty(e)&&(this.buf.push("</"),this.buf.push(e),this.buf.push(">"))}chars(t){this.buf.push(KB(t))}};function yhe(n,t){return(n.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_CONTAINED_BY)!==Node.DOCUMENT_POSITION_CONTAINED_BY}function xhe(n){let t=n.nextSibling;if(t&&n!==t.previousSibling)throw JU(t);return t}function vhe(n){let t=n.firstChild;if(t&&yhe(n,t))throw JU(t);return t}function qB(n){let t=n.nodeName;return typeof t=="string"?t:"FORM"}function JU(n){return new Error(`Failed to sanitize html because the element is clobbered: ${n.outerHTML}`)}var bhe=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,whe=/([^\#-~ |!])/g;function KB(n){return n.replace(/&/g,"&amp;").replace(bhe,function(t){let e=t.charCodeAt(0),r=t.charCodeAt(1);return"&#"+((e-55296)*1024+(r-56320)+65536)+";"}).replace(whe,function(t){return"&#"+t.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}var VC;function SR(n,t){let e=null;try{VC=VC||ahe(n);let r=t?String(t):"";e=VC.getInertBodyElement(r);let o=5,i=r;do{if(o===0)throw new Error("Failed to sanitize html because the input is unstable");o--,r=i,i=e.innerHTML,e=VC.getInertBodyElement(r)}while(r!==i);let a=new D2().sanitizeChildren(XB(e)||e);return N_(a)}finally{if(e){let r=XB(e)||e;for(;r.firstChild;)r.firstChild.remove()}}}function XB(n){return"content"in n&&Che(n)?n.content:null}function Che(n){return n.nodeType===Node.ELEMENT_NODE&&n.nodeName==="TEMPLATE"}var ba=function(n){return n[n.NONE=0]="NONE",n[n.HTML=1]="HTML",n[n.STYLE=2]="STYLE",n[n.SCRIPT=3]="SCRIPT",n[n.URL=4]="URL",n[n.RESOURCE_URL=5]="RESOURCE_URL",n}(ba||{});function e4(n){let t=IR();return t?GB(t.sanitize(ba.HTML,n)||""):Xu(n,"HTML")?GB(As(n)):SR(FU(),Di(n))}function di(n){let t=IR();return t?t.sanitize(ba.URL,n)||"":Xu(n,"URL")?As(n):A_(Di(n))}function f0(n){let t=IR();if(t)return jB(t.sanitize(ba.RESOURCE_URL,n)||"");if(Xu(n,"ResourceURL"))return jB(As(n));throw new nt(904,!1)}function _he(n,t){return t==="src"&&(n==="embed"||n==="frame"||n==="iframe"||n==="media"||n==="script")||t==="href"&&(n==="base"||n==="link")?f0:di}function t4(n,t,e){return _he(t,e)(n)}function IR(){let n=en();return n&&n[zu].sanitizer}function n4(n){return n instanceof Function?n():n}var dp=function(n){return n[n.None=0]="None",n[n.SignalBased=1]="SignalBased",n[n.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",n}(dp||{});function She(n,t,e){let r=n.length;for(;;){let o=n.indexOf(t,e);if(o===-1)return o;if(o===0||n.charCodeAt(o-1)<=32){let i=t.length;if(o+i===r||n.charCodeAt(o+i)<=32)return o}e=o+1}}var r4="ng-template";function Ihe(n,t,e,r){let o=0;if(r){for(;o<t.length&&typeof t[o]=="string";o+=2)if(t[o]==="class"&&She(t[o+1].toLowerCase(),e,0)!==-1)return!0}else if(ER(n))return!1;if(o=t.indexOf(1,o),o>-1){let i;for(;++o<t.length&&typeof(i=t[o])=="string";)if(i.toLowerCase()===e)return!0}return!1}function ER(n){return n.type===4&&n.value!==r4}function Ehe(n,t,e){let r=n.type===4&&!e?r4:n.value;return t===r}function The(n,t,e){let r=4,o=n.attrs,i=o!==null?Nhe(o):0,s=!1;for(let a=0;a<t.length;a++){let l=t[a];if(typeof l=="number"){if(!s&&!fa(r)&&!fa(l))return!1;if(s&&fa(l))continue;s=!1,r=l|r&1;continue}if(!s)if(r&4){if(r=2|r&1,l!==""&&!Ehe(n,l,e)||l===""&&t.length===1){if(fa(r))return!1;s=!0}}else if(r&8){if(o===null||!Ihe(n,o,l,e)){if(fa(r))return!1;s=!0}}else{let c=t[++a],u=Dhe(l,o,ER(n),e);if(u===-1){if(fa(r))return!1;s=!0;continue}if(c!==""){let d;if(u>i?d="":d=o[u+1].toLowerCase(),r&2&&c!==d){if(fa(r))return!1;s=!0}}}}return fa(r)||s}function fa(n){return(n&1)===0}function Dhe(n,t,e,r){if(t===null)return-1;let o=0;if(r||!e){let i=!1;for(;o<t.length;){let s=t[o];if(s===n)return o;if(s===3||s===6)i=!0;else if(s===1||s===2){let a=t[++o];for(;typeof a=="string";)a=t[++o];continue}else{if(s===4)break;if(s===0){o+=4;continue}}o+=i?1:2}return-1}else return Ahe(t,n)}function khe(n,t,e=!1){for(let r=0;r<t.length;r++)if(The(n,t[r],e))return!0;return!1}function Nhe(n){for(let t=0;t<n.length;t++){let e=n[t];if(uU(e))return t}return n.length}function Ahe(n,t){let e=n.indexOf(4);if(e>-1)for(e++;e<n.length;){let r=n[e];if(typeof r=="number")return-1;if(r===t)return e;e++}return-1}function YB(n,t){return n?":not("+t.trim()+")":t}function Rhe(n){let t=n[0],e=1,r=2,o="",i=!1;for(;e<n.length;){let s=n[e];if(typeof s=="string")if(r&2){let a=n[++e];o+="["+s+(a.length>0?'="'+a+'"':"")+"]"}else r&8?o+="."+s:r&4&&(o+=" "+s);else o!==""&&!fa(s)&&(t+=YB(i,o),o=""),r=s,i=i||!fa(r);e++}return o!==""&&(t+=YB(i,o)),t}function Ohe(n){return n.map(Rhe).join(",")}function Mhe(n){let t=[],e=[],r=1,o=2;for(;r<n.length;){let i=n[r];if(typeof i=="string")o===2?i!==""&&t.push(i,n[++r]):o===8&&e.push(i);else{if(!fa(o))break;o=i}r++}return e.length&&t.push(1,...e),t}var Ro={};function Phe(n,t){return n.createText(t)}function Fhe(n,t,e){n.setValue(t,e)}function o4(n,t,e){return n.createElement(t,e)}function u_(n,t,e,r,o){n.insertBefore(t,e,r,o)}function i4(n,t,e){n.appendChild(t,e)}function ZB(n,t,e,r,o){r!==null?u_(n,t,e,r,o):i4(n,t,e)}function Lhe(n,t,e){n.removeChild(null,t,e)}function $he(n,t,e){n.setAttribute(t,"style",e)}function Vhe(n,t,e){e===""?n.removeAttribute(t,"class"):n.setAttribute(t,"class",e)}function s4(n,t,e){let{mergedAttrs:r,classes:o,styles:i}=e;r!==null&&_fe(n,t,r),o!==null&&Vhe(n,t,o),i!==null&&$he(n,t,i)}function z(n=1){a4(co(),en(),ac()+n,!1)}function a4(n,t,e,r){if(!r)if((t[Lt]&3)===3){let i=n.preOrderCheckHooks;i!==null&&WC(t,i,e)}else{let i=n.preOrderHooks;i!==null&&GC(t,i,0,e)}_h(e)}function Be(n,t=Qt.Default){let e=en();if(e===null)return it(n,t);let r=Oi();return yU(r,e,ci(n),t)}function l4(){let n="invalid";throw new Error(n)}function c4(n,t,e,r,o,i){let s=gn(null);try{let a=null;o&dp.SignalBased&&(a=t[r][ss]),a!==null&&a.transformFn!==void 0&&(i=a.transformFn(i)),o&dp.HasDecoratorInputTransform&&(i=n.inputTransforms[r].call(t,i)),n.setInput!==null?n.setInput(t,a,i,e,r):Uz(t,a,r,i)}finally{gn(s)}}function TR(n,t,e,r,o,i,s,a,l,c,u){let d=t.blueprint.slice();return d[qu]=o,d[Lt]=r|4|128|8|64|1024,(c!==null||n&&n[Lt]&2048)&&(d[Lt]|=2048),Kz(d),d[Wo]=d[Ag]=n,d[Ds]=e,d[zu]=s||n&&n[zu],d[Rr]=a||n&&n[Rr],d[Zv]=l||n&&n[Zv]||null,d[xa]=i,d[I_]=Xfe(),d[QC]=u,d[Vz]=c,d[nc]=t.type==2?n[nc]:d,d}function u4(n,t,e,r){if(e===0)return-1;let o=t.length;for(let i=0;i<e;i++)t.push(r),n.blueprint.push(r),n.data.push(null);return o}function d4(n,t,e,r,o){let i=ac(),s=r&2;try{_h(-1),s&&t.length>rc&&a4(n,t,rc,!1),Ts(s?2:0,o),e(r,o)}finally{_h(i),Ts(s?3:1,o)}}function p4(n,t,e){Qz()&&(Og(va(e,t),t),f4(n,t,e))}function f4(n,t,e){Yhe(n,t,e),(e.flags&64)===64&&Zhe(n,t,e)}function h4(n,t,e=va){let r=t.localNames;if(r!==null){let o=t.index+1;for(let i=0;i<r.length;i+=2){let s=r[i+1],a=s===-1?e(t,n):n[s];n[o++]=a}}}function Bhe(n){let t=n.tView;return t===null||t.incompleteFirstPass?n.tView=DR(1,null,n.template,n.decls,n.vars,n.directiveDefs,n.pipeDefs,n.viewQuery,n.schemas,n.consts,n.id):t}function DR(n,t,e,r,o,i,s,a,l,c,u){let d=rc+r,p=d+o,f=zhe(d,p),h=typeof c=="function"?c():c;return f[sn]={type:n,blueprint:f,template:e,queries:null,viewQuery:a,declTNode:t,data:f.slice().fill(null,d),bindingStartIndex:d,expandoStartIndex:p,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:typeof i=="function"?i():i,pipeRegistry:typeof s=="function"?s():s,firstChild:null,schemas:l,consts:h,incompleteFirstPass:!1,ssrId:u}}function zhe(n,t){let e=[];for(let r=0;r<t;r++)e.push(r<n?null:Ro);return e}function Uhe(n,t,e,r){let i=r.get(ehe,LU)||e===sc.ShadowDom,s=n.selectRootElement(t,i);return Whe(s),s}function Whe(n){Ghe(n)}var Ghe=()=>null;function QB(n,t,e,r,o){for(let i in t){if(!t.hasOwnProperty(i))continue;let s=t[i];if(s===void 0)continue;r??={};let a,l=dp.None;Array.isArray(s)?(a=s[0],l=s[1]):a=s;let c=i;if(o!==null){if(!o.hasOwnProperty(i))continue;c=o[i]}n===0?JB(r,e,c,a,l):JB(r,e,c,a)}return r}function JB(n,t,e,r,o){let i;n.hasOwnProperty(e)?(i=n[e]).push(t,r):i=n[e]=[t,r],o!==void 0&&i.push(o)}function jhe(n,t,e){let r=t.directiveStart,o=t.directiveEnd,i=n.data,s=t.attrs,a=[],l=null,c=null;for(let u=r;u<o;u++){let d=i[u],p=e?e.get(d):null,f=p?p.inputs:null,h=p?p.outputs:null;l=QB(0,d.inputs,u,l,f),c=QB(1,d.outputs,u,c,h);let m=l!==null&&s!==null&&!ER(t)?ume(l,u,s):null;a.push(m)}l!==null&&(l.hasOwnProperty("class")&&(t.flags|=8),l.hasOwnProperty("style")&&(t.flags|=16)),t.initialInputs=a,t.inputs=l,t.outputs=c}function Hhe(n){return n==="class"?"className":n==="for"?"htmlFor":n==="formaction"?"formAction":n==="innerHtml"?"innerHTML":n==="readonly"?"readOnly":n==="tabindex"?"tabIndex":n}function R_(n,t,e,r,o,i,s,a){let l=va(t,e),c=t.inputs,u;!a&&c!=null&&(u=c[r])?(NR(n,e,u,r,o),Dh(t)&&qhe(e,t.index)):t.type&3?(r=Hhe(r),o=s!=null?s(o,t.value||"",r):o,i.setProperty(l,r,o)):t.type&12}function qhe(n,t){let e=ic(t,n);e[Lt]&16||(e[Lt]|=64)}function m4(n,t,e,r){if(Qz()){let o=r===null?null:{"":-1},i=Jhe(n,e);if(i!==null){let[s,a]=y4(n,e,i);g4(n,t,e,s,o,a)}o&&tme(e,r,o)}e.mergedAttrs=Eg(e.mergedAttrs,e.attrs)}function g4(n,t,e,r,o,i){for(let c=0;c<r.length;c++)d2(s_(e,t),n,r[c].type);rme(e,n.data.length,r.length);for(let c=0;c<r.length;c++){let u=r[c];u.providersResolver&&u.providersResolver(u)}let s=!1,a=!1,l=u4(n,t,r.length,null);for(let c=0;c<r.length;c++){let u=r[c];e.mergedAttrs=Eg(e.mergedAttrs,u.hostAttrs),ome(n,e,t,l,u),nme(l,u,o),u.contentQueries!==null&&(e.flags|=4),(u.hostBindings!==null||u.hostAttrs!==null||u.hostVars!==0)&&(e.flags|=64);let d=u.type.prototype;!s&&(d.ngOnChanges||d.ngOnInit||d.ngDoCheck)&&((n.preOrderHooks??=[]).push(e.index),s=!0),!a&&(d.ngOnChanges||d.ngDoCheck)&&((n.preOrderCheckHooks??=[]).push(e.index),a=!0),l++}jhe(n,e,i)}function Khe(n,t,e,r,o){let i=o.hostBindings;if(i){let s=n.hostBindingOpCodes;s===null&&(s=n.hostBindingOpCodes=[]);let a=~t.index;Xhe(s)!=a&&s.push(a),s.push(e,r,i)}}function Xhe(n){let t=n.length;for(;t>0;){let e=n[--t];if(typeof e=="number"&&e<0)return e}return 0}function Yhe(n,t,e){let r=e.directiveStart,o=e.directiveEnd;Dh(e)&&sme(t,e,n.data[r+e.componentOffset]),n.firstCreatePass||s_(e,t);let i=e.initialInputs;for(let s=r;s<o;s++){let a=n.data[s],l=Jv(t,n,s,e);if(Og(l,t),i!==null&&cme(t,s-r,l,a,e,i),Wu(a)){let c=ic(e.index,t);c[Ds]=Jv(t,n,s,e)}}}function Zhe(n,t,e){let r=e.directiveStart,o=e.directiveEnd,i=e.index,s=ffe();try{_h(i);for(let a=r;a<o;a++){let l=n.data[a],c=t[a];l2(a),(l.hostBindings!==null||l.hostVars!==0||l.hostAttrs!==null)&&Qhe(l,c)}}finally{_h(-1),l2(s)}}function Qhe(n,t){n.hostBindings!==null&&n.hostBindings(1,t)}function Jhe(n,t){let e=n.directiveRegistry,r=null;if(e)for(let o=0;o<e.length;o++){let i=e[o];khe(t,i.selectors,!1)&&(r??=[],Wu(i)?r.unshift(i):r.push(i))}return r}function y4(n,t,e){let r=[],o=null;for(let i of e)i.findHostDirectiveDefs!==null&&(o??=new Map,i.findHostDirectiveDefs(i,r,o)),Wu(i)&&(r.push(i),eme(n,t,r.length-1));return Dh(t)?r.push(...e.slice(1)):r.push(...e),[r,o]}function eme(n,t,e){t.componentOffset=e,(n.components??=[]).push(t.index)}function tme(n,t,e){if(t){let r=n.localNames=[];for(let o=0;o<t.length;o+=2){let i=e[t[o+1]];if(i==null)throw new nt(-301,!1);r.push(t[o],i)}}}function nme(n,t,e){if(e){if(t.exportAs)for(let r=0;r<t.exportAs.length;r++)e[t.exportAs[r]]=n;Wu(t)&&(e[""]=n)}}function rme(n,t,e){n.flags|=1,n.directiveStart=t,n.directiveEnd=t+e,n.providerIndexes=t}function ome(n,t,e,r,o){n.data[r]=o;let i=o.factory||(o.factory=wg(o.type,!0)),s=new Sh(i,Wu(o),Be);n.blueprint[r]=s,e[r]=s,Khe(n,t,r,u4(n,e,o.hostVars,Ro),o)}function ime(n){let t=16;return n.signals?t=4096:n.onPush&&(t=64),t}function sme(n,t,e){let r=va(t,n),o=Bhe(e),i=n[zu].rendererFactory,s=kR(n,TR(n,o,null,ime(e),r,t,null,i.createRenderer(r,e),null,null,null));return n[t.index]=s}function ame(n,t,e,r,o,i){let s=va(n,t);lme(t[Rr],s,i,n.value,e,r,o)}function lme(n,t,e,r,o,i,s){if(i==null)n.removeAttribute(t,o,e);else{let a=s==null?Di(i):s(i,r||"",o);n.setAttribute(t,o,a,e)}}function cme(n,t,e,r,o,i){let s=i[t];if(s!==null)for(let a=0;a<s.length;){let l=s[a++],c=s[a++],u=s[a++],d=s[a++];c4(r,e,l,c,u,d)}}function ume(n,t,e){let r=null,o=0;for(;o<e.length;){let i=e[o];if(i===0){o+=4;continue}else if(i===5){o+=2;continue}if(typeof i=="number")break;if(n.hasOwnProperty(i)){r===null&&(r=[]);let s=n[i];for(let a=0;a<s.length;a+=3)if(s[a]===t){r.push(i,s[a+1],s[a+2],e[o+1]);break}}o+=2}return r}function x4(n,t,e,r){return[n,!0,0,t,null,r,null,e,null,null]}function kR(n,t){return n[Qv]?n[kB][ma]=t:n[Qv]=t,n[kB]=t,t}function v4(n,t){let e=n[Zv],r=e?e.get(Gu,null):null;r&&r.handleError(t)}function NR(n,t,e,r,o){for(let i=0;i<e.length;){let s=e[i++],a=e[i++],l=e[i++],c=t[s],u=n.data[s];c4(u,c,r,a,l,o)}}function dme(n,t){let e=ic(t,n),r=e[sn];pme(r,e);let o=e[qu];o!==null&&e[QC]===null&&(e[QC]=BU(o,e[Zv])),AR(r,e,e[Ds])}function pme(n,t){for(let e=t.length;e<n.blueprint.length;e++)t.push(n.blueprint[e])}function AR(n,t,e){dR(t);try{let r=n.viewQuery;r!==null&&b2(1,r,e);let o=n.template;o!==null&&d4(n,t,o,1,e),n.firstCreatePass&&(n.firstCreatePass=!1),t[Uu]?.finishViewCreation(n),n.staticContentQueries&&zU(n,t),n.staticViewQueries&&b2(2,n.viewQuery,e);let i=n.components;i!==null&&fme(t,i)}catch(r){throw n.firstCreatePass&&(n.incompleteFirstPass=!0,n.firstCreatePass=!1),r}finally{t[Lt]&=-5,pR()}}function fme(n,t){for(let e=0;e<t.length;e++)dme(n,t[e])}var Hu=function(n){return n[n.Important=1]="Important",n[n.DashCase=2]="DashCase",n}(Hu||{}),hme;function RR(n,t){return hme(n,t)}function b4(n){return(n.flags&32)===32}function xg(n,t,e,r,o){if(r!=null){let i,s=!1;Ku(r)?i=r:up(r)&&(s=!0,r=r[qu]);let a=oc(r);n===0&&e!==null?o==null?i4(t,e,a):u_(t,e,a,o||null,!0):n===1&&e!==null?u_(t,e,a,o||null,!0):n===2?Lhe(t,a,s):n===3&&t.destroyNode(a),i!=null&&Tme(t,n,i,e,o)}}function mme(n,t){w4(n,t),t[qu]=null,t[xa]=null}function gme(n,t,e,r,o,i){r[qu]=o,r[xa]=t,O_(n,r,e,1,o,i)}function w4(n,t){t[zu].changeDetectionScheduler?.notify(10),O_(n,t,t[Rr],2,null,null)}function yme(n){let t=n[Qv];if(!t)return HA(n[sn],n);for(;t;){let e=null;if(up(t))e=t[Qv];else{let r=t[ls];r&&(e=r)}if(!e){for(;t&&!t[ma]&&t!==n;)up(t)&&HA(t[sn],t),t=t[Wo];t===null&&(t=n),up(t)&&HA(t[sn],t),e=t&&t[ma]}t=e}}function xme(n,t,e,r){let o=ls+r,i=e.length;r>0&&(e[o-1][ma]=t),r<i-ls?(t[ma]=e[o],Ez(e,ls+r,t)):(e.push(t),t[ma]=null),t[Wo]=e;let s=t[bh];s!==null&&e!==s&&C4(s,t);let a=t[Uu];a!==null&&a.insertView(n),s2(t),t[Lt]|=128}function C4(n,t){let e=n[Ig],r=t[Wo];if(up(r))n[Lt]|=2;else{let o=r[Wo][nc];t[nc]!==o&&(n[Lt]|=2)}e===null?n[Ig]=[t]:e.push(t)}function OR(n,t){let e=n[Ig],r=e.indexOf(t);e.splice(r,1)}function k2(n,t){if(n.length<=ls)return;let e=ls+t,r=n[e];if(r){let o=r[bh];o!==null&&o!==n&&OR(o,r),t>0&&(n[e-1][ma]=r[ma]);let i=YC(n,ls+t);mme(r[sn],r);let s=i[Uu];s!==null&&s.detachView(i[sn]),r[Wo]=null,r[ma]=null,r[Lt]&=-129}return r}function _4(n,t){if(i0(t))return;let e=t[Rr];e.destroyNode&&O_(n,t,e,3,null,null),yme(t)}function HA(n,t){if(i0(t))return;let e=gn(null);try{t[Lt]&=-129,t[Lt]|=256,t[as]&&CA(t[as]),bme(n,t),vme(n,t),t[sn].type===1&&t[Rr].destroy();let r=t[bh];if(r!==null&&Ku(t[Wo])){r!==t[Wo]&&OR(r,t);let o=t[Uu];o!==null&&o.detachView(n)}y2(t)}finally{gn(e)}}function vme(n,t){let e=n.cleanup,r=t[JC];if(e!==null)for(let s=0;s<e.length-1;s+=2)if(typeof e[s]=="string"){let a=e[s+3];a>=0?r[a]():r[-a].unsubscribe(),s+=2}else{let a=r[e[s+1]];e[s].call(a)}r!==null&&(t[JC]=null);let o=t[cp];if(o!==null){t[cp]=null;for(let s=0;s<o.length;s++){let a=o[s];a()}}let i=t[e_];if(i!==null){t[e_]=null;for(let s of i)s.destroy()}}function bme(n,t){let e;if(n!=null&&(e=n.destroyHooks)!=null)for(let r=0;r<e.length;r+=2){let o=t[e[r]];if(!(o instanceof Sh)){let i=e[r+1];if(Array.isArray(i))for(let s=0;s<i.length;s+=2){let a=o[i[s]],l=i[s+1];Ts(4,a,l);try{l.call(a)}finally{Ts(5,a,l)}}else{Ts(4,o,i);try{i.call(o)}finally{Ts(5,o,i)}}}}}function wme(n,t,e){return Cme(n,t.parent,e)}function Cme(n,t,e){let r=t;for(;r!==null&&r.type&168;)t=r,r=t.parent;if(r===null)return e[qu];if(Dh(r)){let{encapsulation:o}=n.data[r.directiveStart+r.componentOffset];if(o===sc.None||o===sc.Emulated)return null}return va(r,e)}function _me(n,t,e){return Ime(n,t,e)}function Sme(n,t,e){return n.type&40?va(n,e):null}var Ime=Sme,ez;function MR(n,t,e,r){let o=wme(n,r,t),i=t[Rr],s=r.parent||t[xa],a=_me(s,r,t);if(o!=null)if(Array.isArray(e))for(let l=0;l<e.length;l++)ZB(i,o,e[l],a,!1);else ZB(i,o,e,a,!1);ez!==void 0&&ez(i,r,t,e,o)}function Hv(n,t){if(t!==null){let e=t.type;if(e&3)return va(t,n);if(e&4)return N2(-1,n[t.index]);if(e&8){let r=t.child;if(r!==null)return Hv(n,r);{let o=n[t.index];return Ku(o)?N2(-1,o):oc(o)}}else{if(e&128)return Hv(n,t.next);if(e&32)return RR(t,n)()||oc(n[t.index]);{let r=S4(n,t);if(r!==null){if(Array.isArray(r))return r[0];let o=Ch(n[nc]);return Hv(o,r)}else return Hv(n,t.next)}}}return null}function S4(n,t){if(t!==null){let r=n[nc][xa],o=t.projection;return r.projection[o]}return null}function N2(n,t){let e=ls+n+1;if(e<t.length){let r=t[e],o=r[sn].firstChild;if(o!==null)return Hv(r,o)}return t[wh]}function PR(n,t,e,r,o,i,s){for(;e!=null;){if(e.type===128){e=e.next;continue}let a=r[e.index],l=e.type;if(s&&t===0&&(a&&Og(oc(a),r),e.flags|=2),!b4(e))if(l&8)PR(n,t,e.child,r,o,i,!1),xg(t,n,o,a,i);else if(l&32){let c=RR(e,r),u;for(;u=c();)xg(t,n,o,u,i);xg(t,n,o,a,i)}else l&16?Eme(n,t,r,e,o,i):xg(t,n,o,a,i);e=s?e.projectionNext:e.next}}function O_(n,t,e,r,o,i){PR(e,r,n.firstChild,t,o,i,!1)}function Eme(n,t,e,r,o,i){let s=e[nc],l=s[xa].projection[r.projection];if(Array.isArray(l))for(let c=0;c<l.length;c++){let u=l[c];xg(t,n,o,u,i)}else{let c=l,u=s[Wo];kU(r)&&(c.flags|=128),PR(n,t,c,u,o,i,!0)}}function Tme(n,t,e,r,o){let i=e[wh],s=oc(e);i!==s&&xg(t,n,r,i,o);for(let a=ls;a<e.length;a++){let l=e[a];O_(l[sn],l,n,t,r,i)}}function Dme(n,t,e,r,o){if(t)o?n.addClass(e,r):n.removeClass(e,r);else{let i=r.indexOf("-")===-1?void 0:Hu.DashCase;o==null?n.removeStyle(e,r,i):(typeof o=="string"&&o.endsWith("!important")&&(o=o.slice(0,-10),i|=Hu.Important),n.setStyle(e,r,o,i))}}function kme(n,t,e,r){let o=gn(null);try{let i=t.tView,a=n[Lt]&4096?4096:16,l=TR(n,i,e,a,null,t,null,null,r?.injector??null,r?.embeddedViewInjector??null,r?.dehydratedView??null),c=n[t.index];l[bh]=c;let u=n[Uu];return u!==null&&(l[Uu]=u.createEmbeddedView(i)),AR(i,l,e),l}finally{gn(o)}}function tz(n,t){return!t||t.firstChild===null||kU(n)}function Nme(n,t,e,r=!0){let o=t[sn];if(xme(o,t,n,e),r){let s=N2(e,n),a=t[Rr],l=a.parentNode(n[wh]);l!==null&&gme(o,n[xa],a,t,l,s)}let i=t[QC];i!==null&&i.firstChild!==null&&(i.firstChild=null)}function d_(n,t,e,r,o=!1){for(;e!==null;){if(e.type===128){e=o?e.projectionNext:e.next;continue}let i=t[e.index];i!==null&&r.push(oc(i)),Ku(i)&&Ame(i,r);let s=e.type;if(s&8)d_(n,t,e.child,r);else if(s&32){let a=RR(e,t),l;for(;l=a();)r.push(l)}else if(s&16){let a=S4(t,e);if(Array.isArray(a))r.push(...a);else{let l=Ch(t[nc]);d_(l[sn],l,a,r,!0)}}e=o?e.projectionNext:e.next}return r}function Ame(n,t){for(let e=ls;e<n.length;e++){let r=n[e],o=r[sn].firstChild;o!==null&&d_(r[sn],r,o,t)}n[wh]!==n[qu]&&t.push(n[wh])}var I4=[];function Rme(n){return n[as]??Ome(n)}function Ome(n){let t=I4.pop()??Object.create(Pme);return t.lView=n,t}function Mme(n){n.lView[as]!==n&&(n.lView=null,I4.push(n))}var Pme=Ft(ke({},$v),{consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:n=>{T_(n.lView)},consumerOnSignalRead(){this.lView[as]=this}});function Fme(n){let t=n[as]??Object.create(Lme);return t.lView=n,t}var Lme=Ft(ke({},$v),{consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:n=>{let t=Ch(n.lView);for(;t&&!E4(t[sn]);)t=Ch(t);t&&aR(t)},consumerOnSignalRead(){this.lView[as]=this}});function E4(n){return n.type!==2}function T4(n){if(n[e_]===null)return;let t=!0;for(;t;){let e=!1;for(let r of n[e_])r.dirty&&(e=!0,r.zone===null||Zone.current===r.zone?r.run():r.zone.run(()=>r.run()));t=e&&!!(n[Lt]&8192)}}var $me=100;function D4(n,t=!0,e=0){let o=n[zu].rendererFactory,i=!1;i||o.begin?.();try{Vme(n,e)}catch(s){throw t&&v4(n,s),s}finally{i||o.end?.()}}function Vme(n,t){let e=tU();try{AB(!0),A2(n,t);let r=0;for(;E_(n);){if(r===$me)throw new nt(103,!1);r++,A2(n,1)}}finally{AB(e)}}function Bme(n,t,e,r){if(i0(t))return;let o=t[Lt],i=!1,s=!1;dR(t);let a=!0,l=null,c=null;i||(E4(n)?(c=Rme(t),l=rC(c)):$V()===null?(a=!1,c=Fme(t),l=rC(c)):t[as]&&(CA(t[as]),t[as]=null));try{Kz(t),ufe(n.bindingStartIndex),e!==null&&d4(n,t,e,2,r);let u=(o&3)===3;if(!i)if(u){let f=n.preOrderCheckHooks;f!==null&&WC(t,f,null)}else{let f=n.preOrderHooks;f!==null&&GC(t,f,0,null),WA(t,0)}if(s||zme(t),T4(t),k4(t,0),n.contentQueries!==null&&zU(n,t),!i)if(u){let f=n.contentCheckHooks;f!==null&&WC(t,f)}else{let f=n.contentHooks;f!==null&&GC(t,f,1),WA(t,1)}Wme(n,t);let d=n.components;d!==null&&A4(t,d,0);let p=n.viewQuery;if(p!==null&&b2(2,p,r),!i)if(u){let f=n.viewCheckHooks;f!==null&&WC(t,f)}else{let f=n.viewHooks;f!==null&&GC(t,f,2),WA(t,2)}if(n.firstUpdatePass===!0&&(n.firstUpdatePass=!1),t[UA]){for(let f of t[UA])f();t[UA]=null}i||(t[Lt]&=-73)}catch(u){throw i||T_(t),u}finally{c!==null&&(bA(c,l),a&&Mme(c)),pR()}}function k4(n,t){for(let e=RU(n);e!==null;e=OU(e))for(let r=ls;r<e.length;r++){let o=e[r];N4(o,t)}}function zme(n){for(let t=RU(n);t!==null;t=OU(t)){if(!(t[Lt]&2))continue;let e=t[Ig];for(let r=0;r<e.length;r++){let o=e[r];aR(o)}}}function Ume(n,t,e){let r=ic(t,n);N4(r,e)}function N4(n,t){sR(n)&&A2(n,t)}function A2(n,t){let r=n[sn],o=n[Lt],i=n[as],s=!!(t===0&&o&16);if(s||=!!(o&64&&t===0),s||=!!(o&1024),s||=!!(i?.dirty&&wA(i)),s||=!1,i&&(i.dirty=!1),n[Lt]&=-9217,s)Bme(r,n,r.template,n[Ds]);else if(o&8192){T4(n),k4(n,1);let a=r.components;a!==null&&A4(n,a,1)}}function A4(n,t,e){for(let r=0;r<t.length;r++)Ume(n,t[r],e)}function Wme(n,t){let e=n.hostBindingOpCodes;if(e!==null)try{for(let r=0;r<e.length;r++){let o=e[r];if(o<0)_h(~o);else{let i=o,s=e[++r],a=e[++r];pfe(s,i);let l=t[i];Ts(24,l),a(2,l),Ts(25,l)}}}finally{_h(-1)}}function FR(n,t){let e=tU()?64:1088;for(n[zu].changeDetectionScheduler?.notify(t);n;){n[Lt]|=e;let r=Ch(n);if(n_(n)&&!r)return n;n=r}return null}var Ih=class{_lView;_cdRefInjectingView;notifyErrorHandler;_appRef=null;_attachedToViewContainer=!1;get rootNodes(){let t=this._lView,e=t[sn];return d_(e,t,e.firstChild,[])}constructor(t,e,r=!0){this._lView=t,this._cdRefInjectingView=e,this.notifyErrorHandler=r}get context(){return this._lView[Ds]}get dirty(){return!!(this._lView[Lt]&9280)||!!this._lView[as]?.dirty}set context(t){this._lView[Ds]=t}get destroyed(){return i0(this._lView)}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){let t=this._lView[Wo];if(Ku(t)){let e=t[t_],r=e?e.indexOf(this):-1;r>-1&&(k2(t,r),YC(e,r))}this._attachedToViewContainer=!1}_4(this._lView[sn],this._lView)}onDestroy(t){Xz(this._lView,t)}markForCheck(){FR(this._cdRefInjectingView||this._lView,4)}markForRefresh(){aR(this._cdRefInjectingView||this._lView)}detach(){this._lView[Lt]&=-129}reattach(){s2(this._lView),this._lView[Lt]|=128}detectChanges(){this._lView[Lt]|=1024,D4(this._lView,this.notifyErrorHandler)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new nt(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null;let t=n_(this._lView),e=this._lView[bh];e!==null&&!t&&OR(e,this._lView),w4(this._lView[sn],this._lView)}attachToAppRef(t){if(this._attachedToViewContainer)throw new nt(902,!1);this._appRef=t;let e=n_(this._lView),r=this._lView[bh];r!==null&&!e&&C4(r,this._lView),s2(this._lView)}},ks=(()=>{class n{static __NG_ELEMENT_ID__=Hme}return n})(),Gme=ks,jme=class extends Gme{_declarationLView;_declarationTContainer;elementRef;constructor(t,e,r){super(),this._declarationLView=t,this._declarationTContainer=e,this.elementRef=r}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(t,e){return this.createEmbeddedViewImpl(t,e)}createEmbeddedViewImpl(t,e,r){let o=kme(this._declarationLView,this._declarationTContainer,t,{embeddedViewInjector:e,dehydratedView:r});return new Ih(o)}};function Hme(){return LR(Oi(),en())}function LR(n,t){return n.type&4?new jme(t,n,Rg(n,t)):null}function M_(n,t,e,r,o){let i=n.data[t];if(i===null)i=qme(n,t,e,r,o),dfe()&&(i.flags|=32);else if(i.type&64){i.type=e,i.value=r,i.attrs=o;let s=afe();i.injectorIndex=s===null?-1:s.injectorIndex}return s0(i,!0),i}function qme(n,t,e,r,o){let i=Jz(),s=eU(),a=s?i:i&&i.parent,l=n.data[t]=Xme(n,a,e,t,r,o);return Kme(n,l,i,s),l}function Kme(n,t,e,r){n.firstChild===null&&(n.firstChild=t),e!==null&&(r?e.child==null&&t.parent!==null&&(e.child=t):e.next===null&&(e.next=t,t.prev=e))}function Xme(n,t,e,r,o,i){let s=t?t.injectorIndex:-1,a=0;return ofe()&&(a|=128),{type:e,index:r,insertBeforeIndex:null,injectorIndex:s,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:a,providerIndexes:0,value:o,attrs:i,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}var bXe=new RegExp(`^(\\d+)*(${Jfe}|${Qfe})*(.*)`);var Yme=()=>null;function nz(n,t){return Yme(n,t)}var R2=class{},p_=class{},O2=class{resolveComponentFactory(t){throw Error(`No component factory found for ${ui(t)}.`)}},Dg=class{static NULL=new O2},Ns=class{},Mi=(()=>{class n{destroyNode=null;static __NG_ELEMENT_ID__=()=>Zme()}return n})();function Zme(){let n=en(),t=Oi(),e=ic(t.index,n);return(up(e)?e:n)[Rr]}var Qme=(()=>{class n{static \u0275prov=Me({token:n,providedIn:"root",factory:()=>null})}return n})();function M2(n,t,e){let r=e?n.styles:null,o=e?n.classes:null,i=0;if(t!==null)for(let s=0;s<t.length;s++){let a=t[s];if(typeof a=="number")i=a;else if(i==1)o=QA(o,a);else if(i==2){let l=a,c=t[++s];r=QA(r,l+": "+c+";")}}e?n.styles=r:n.stylesWithoutHost=r,e?n.classes=o:n.classesWithoutHost=o}var f_=class extends Dg{ngModule;constructor(t){super(),this.ngModule=t}resolveComponentFactory(t){let e=Bu(t);return new Eh(e,this.ngModule)}};function rz(n,t){let e=[];for(let r in n){if(!n.hasOwnProperty(r))continue;let o=n[r];if(o===void 0)continue;let i=Array.isArray(o),s=i?o[0]:o,a=i?o[1]:dp.None;t?e.push({propName:s,templateName:r,isSignal:(a&dp.SignalBased)!==0}):e.push({propName:s,templateName:r})}return e}function Jme(n){let t=n.toLowerCase();return t==="svg"?qpe:t==="math"?Kpe:null}var Eh=class extends p_{componentDef;ngModule;selector;componentType;ngContentSelectors;isBoundToModule;get inputs(){let t=this.componentDef,e=t.inputTransforms,r=rz(t.inputs,!0);if(e!==null)for(let o of r)e.hasOwnProperty(o.propName)&&(o.transform=e[o.propName]);return r}get outputs(){return rz(this.componentDef.outputs,!1)}constructor(t,e){super(),this.componentDef=t,this.ngModule=e,this.componentType=t.type,this.selector=Ohe(t.selectors),this.ngContentSelectors=t.ngContentSelectors??[],this.isBoundToModule=!!e}create(t,e,r,o){let i=gn(null);try{o=o||this.ngModule;let s=o instanceof lo?o:o?.injector;s&&this.componentDef.getStandaloneInjector!==null&&(s=this.componentDef.getStandaloneInjector(s)||s);let a=s?new c2(t,s):t,l=a.get(Ns,null);if(l===null)throw new nt(407,!1);let c=a.get(Qme,null),u=a.get(Tg,null),d={rendererFactory:l,sanitizer:c,changeDetectionScheduler:u},p=l.createRenderer(null,this.componentDef),f=this.componentDef.selectors[0][0]||"div",h=r?Uhe(p,r,this.componentDef.encapsulation,a):o4(p,f,Jme(f)),m=512;this.componentDef.signals?m|=4096:this.componentDef.onPush||(m|=16);let g=null;h!==null&&(g=BU(h,a,!0));let y=DR(0,null,null,1,0,null,null,null,null,null,null),v=TR(null,y,null,m,null,null,d,p,a,null,g);v[rc]=h,dR(v);let w=null;try{let C=r?["ng-version","19.1.4"]:Mhe(this.componentDef.selectors[0]),I=M_(y,rc,2,"#host",C),[A,M]=y4(y,I,[this.componentDef]);g4(y,v,I,A,{},M);for(let $ of A)I.mergedAttrs=Eg(I.mergedAttrs,$.hostAttrs);I.mergedAttrs=Eg(I.mergedAttrs,C),M2(I,I.mergedAttrs,!0),h&&(s4(p,h,I),Og(h,v)),e!==void 0&&ege(I,this.ngContentSelectors,e),f4(y,v,I),UU(y,I,v),mR(y,I),w=ic(I.index,v),v[Ds]=w[Ds],AR(y,v,null)}catch(C){throw w!==null&&y2(w),y2(v),C}finally{pR()}return new P2(this.componentType,v)}finally{gn(i)}}},P2=class extends R2{_rootLView;instance;hostView;changeDetectorRef;componentType;location;previousInputValues=null;_tNode;constructor(t,e){super(),this._rootLView=e,this._tNode=qz(e[sn],rc),this.location=Rg(this._tNode,e),this.instance=ic(this._tNode.index,e)[Ds],this.hostView=this.changeDetectorRef=new Ih(e,void 0,!1),this.componentType=t}setInput(t,e){let r=this._tNode.inputs,o;if(r!==null&&(o=r[t])){if(this.previousInputValues??=new Map,this.previousInputValues.has(t)&&Object.is(this.previousInputValues.get(t),e))return;let i=this._rootLView;NR(i[sn],i,o,t,e),this.previousInputValues.set(t,e);let s=ic(this._tNode.index,i);FR(s,1)}}get injector(){return new vh(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(t){this.hostView.onDestroy(t)}};function ege(n,t,e){let r=n.projection=[];for(let o=0;o<t.length;o++){let i=e[o];r.push(i!=null&&i.length?Array.from(i):null)}}var Rs=(()=>{class n{static __NG_ELEMENT_ID__=tge}return n})();function tge(){let n=Oi();return O4(n,en())}var nge=Rs,R4=class extends nge{_lContainer;_hostTNode;_hostLView;constructor(t,e,r){super(),this._lContainer=t,this._hostTNode=e,this._hostLView=r}get element(){return Rg(this._hostTNode,this._hostLView)}get injector(){return new vh(this._hostTNode,this._hostLView)}get parentInjector(){let t=gR(this._hostTNode,this._hostLView);if(dU(t)){let e=i_(t,this._hostLView),r=o_(t),o=e[sn].data[r+8];return new vh(o,e)}else return new vh(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(t){let e=oz(this._lContainer);return e!==null&&e[t]||null}get length(){return this._lContainer.length-ls}createEmbeddedView(t,e,r){let o,i;typeof r=="number"?o=r:r!=null&&(o=r.index,i=r.injector);let s=nz(this._lContainer,t.ssrId),a=t.createEmbeddedViewImpl(e||{},i,s);return this.insertImpl(a,o,tz(this._hostTNode,s)),a}createComponent(t,e,r,o,i){let s=t&&!Wpe(t),a;if(s)a=e;else{let h=e||{};a=h.index,r=h.injector,o=h.projectableNodes,i=h.environmentInjector||h.ngModuleRef}let l=s?t:new Eh(Bu(t)),c=r||this.parentInjector;if(!i&&l.ngModule==null){let m=(s?c:this.parentInjector).get(lo,null);m&&(i=m)}let u=Bu(l.componentType??{}),d=nz(this._lContainer,u?.id??null),p=d?.firstChild??null,f=l.create(c,o,p,i);return this.insertImpl(f.hostView,a,tz(this._hostTNode,d)),f}insert(t,e){return this.insertImpl(t,e,!0)}insertImpl(t,e,r){let o=t._lView;if(Zpe(o)){let a=this.indexOf(t);if(a!==-1)this.detach(a);else{let l=o[Wo],c=new R4(l,l[xa],l[Wo]);c.detach(c.indexOf(t))}}let i=this._adjustIndex(e),s=this._lContainer;return Nme(s,o,i,r),t.attachToViewContainerRef(),Ez(qA(s),i,t),t}move(t,e){return this.insert(t,e)}indexOf(t){let e=oz(this._lContainer);return e!==null?e.indexOf(t):-1}remove(t){let e=this._adjustIndex(t,-1),r=k2(this._lContainer,e);r&&(YC(qA(this._lContainer),e),_4(r[sn],r))}detach(t){let e=this._adjustIndex(t,-1),r=k2(this._lContainer,e);return r&&YC(qA(this._lContainer),e)!=null?new Ih(r):null}_adjustIndex(t,e=0){return t??this.length+e}};function oz(n){return n[t_]}function qA(n){return n[t_]||(n[t_]=[])}function O4(n,t){let e,r=t[n.index];return Ku(r)?e=r:(e=x4(r,t,null,n),t[n.index]=e,kR(t,e)),oge(e,t,n,r),new R4(e,n,t)}function rge(n,t){let e=n[Rr],r=e.createComment(""),o=va(t,n),i=e.parentNode(o);return u_(e,i,r,e.nextSibling(o),!1),r}var oge=age,ige=()=>!1;function sge(n,t,e){return ige(n,t,e)}function age(n,t,e,r){if(n[wh])return;let o;e.type&8?o=oc(r):o=rge(t,e),n[wh]=o}var F2=class n{queryList;matches=null;constructor(t){this.queryList=t}clone(){return new n(this.queryList)}setDirty(){this.queryList.setDirty()}},L2=class n{queries;constructor(t=[]){this.queries=t}createEmbeddedView(t){let e=t.queries;if(e!==null){let r=t.contentQueries!==null?t.contentQueries[0]:e.length,o=[];for(let i=0;i<r;i++){let s=e.getByIndex(i),a=this.queries[s.indexInDeclarationView];o.push(a.clone())}return new n(o)}return null}insertView(t){this.dirtyQueriesWithMatches(t)}detachView(t){this.dirtyQueriesWithMatches(t)}finishViewCreation(t){this.dirtyQueriesWithMatches(t)}dirtyQueriesWithMatches(t){for(let e=0;e<this.queries.length;e++)$R(t,e).matches!==null&&this.queries[e].setDirty()}},h_=class{flags;read;predicate;constructor(t,e,r=null){this.flags=e,this.read=r,typeof t=="string"?this.predicate=mge(t):this.predicate=t}},$2=class n{queries;constructor(t=[]){this.queries=t}elementStart(t,e){for(let r=0;r<this.queries.length;r++)this.queries[r].elementStart(t,e)}elementEnd(t){for(let e=0;e<this.queries.length;e++)this.queries[e].elementEnd(t)}embeddedTView(t){let e=null;for(let r=0;r<this.length;r++){let o=e!==null?e.length:0,i=this.getByIndex(r).embeddedTView(t,o);i&&(i.indexInDeclarationView=r,e!==null?e.push(i):e=[i])}return e!==null?new n(e):null}template(t,e){for(let r=0;r<this.queries.length;r++)this.queries[r].template(t,e)}getByIndex(t){return this.queries[t]}get length(){return this.queries.length}track(t){this.queries.push(t)}},V2=class n{metadata;matches=null;indexInDeclarationView=-1;crossesNgTemplate=!1;_declarationNodeIndex;_appliesToNextNode=!0;constructor(t,e=-1){this.metadata=t,this._declarationNodeIndex=e}elementStart(t,e){this.isApplyingToNode(e)&&this.matchTNode(t,e)}elementEnd(t){this._declarationNodeIndex===t.index&&(this._appliesToNextNode=!1)}template(t,e){this.elementStart(t,e)}embeddedTView(t,e){return this.isApplyingToNode(t)?(this.crossesNgTemplate=!0,this.addMatch(-t.index,e),new n(this.metadata)):null}isApplyingToNode(t){if(this._appliesToNextNode&&(this.metadata.flags&1)!==1){let e=this._declarationNodeIndex,r=t.parent;for(;r!==null&&r.type&8&&r.index!==e;)r=r.parent;return e===(r!==null?r.index:-1)}return this._appliesToNextNode}matchTNode(t,e){let r=this.metadata.predicate;if(Array.isArray(r))for(let o=0;o<r.length;o++){let i=r[o];this.matchTNodeWithReadOption(t,e,lge(e,i)),this.matchTNodeWithReadOption(t,e,jC(e,t,i,!1,!1))}else r===ks?e.type&4&&this.matchTNodeWithReadOption(t,e,-1):this.matchTNodeWithReadOption(t,e,jC(e,t,r,!1,!1))}matchTNodeWithReadOption(t,e,r){if(r!==null){let o=this.metadata.read;if(o!==null)if(o===hr||o===Rs||o===ks&&e.type&4)this.addMatch(e.index,-2);else{let i=jC(e,t,o,!1,!1);i!==null&&this.addMatch(e.index,i)}else this.addMatch(e.index,r)}}addMatch(t,e){this.matches===null?this.matches=[t,e]:this.matches.push(t,e)}};function lge(n,t){let e=n.localNames;if(e!==null){for(let r=0;r<e.length;r+=2)if(e[r]===t)return e[r+1]}return null}function cge(n,t){return n.type&11?Rg(n,t):n.type&4?LR(n,t):null}function uge(n,t,e,r){return e===-1?cge(t,n):e===-2?dge(n,t,r):Jv(n,n[sn],e,t)}function dge(n,t,e){if(e===hr)return Rg(t,n);if(e===ks)return LR(t,n);if(e===Rs)return O4(t,n)}function M4(n,t,e,r){let o=t[Uu].queries[r];if(o.matches===null){let i=n.data,s=e.matches,a=[];for(let l=0;s!==null&&l<s.length;l+=2){let c=s[l];if(c<0)a.push(null);else{let u=i[c];a.push(uge(t,u,s[l+1],e.metadata.read))}}o.matches=a}return o.matches}function B2(n,t,e,r){let o=n.queries.getByIndex(e),i=o.matches;if(i!==null){let s=M4(n,t,o,e);for(let a=0;a<i.length;a+=2){let l=i[a];if(l>0)r.push(s[a/2]);else{let c=i[a+1],u=t[-l];for(let d=ls;d<u.length;d++){let p=u[d];p[bh]===p[Wo]&&B2(p[sn],p,c,r)}if(u[Ig]!==null){let d=u[Ig];for(let p=0;p<d.length;p++){let f=d[p];B2(f[sn],f,c,r)}}}}}return r}function pge(n,t){return n[Uu].queries[t].queryList}function P4(n,t,e){let r=new c_((e&4)===4);return efe(n,t,r,r.destroy),(t[Uu]??=new L2).queries.push(new F2(r))-1}function fge(n,t,e){let r=co();return r.firstCreatePass&&(F4(r,new h_(n,t,e),-1),(t&2)===2&&(r.staticViewQueries=!0)),P4(r,en(),t)}function hge(n,t,e,r){let o=co();if(o.firstCreatePass){let i=Oi();F4(o,new h_(t,e,r),i.index),gge(o,n),(e&2)===2&&(o.staticContentQueries=!0)}return P4(o,en(),e)}function mge(n){return n.split(",").map(t=>t.trim())}function F4(n,t,e){n.queries===null&&(n.queries=new $2),n.queries.track(new V2(t,e))}function gge(n,t){let e=n.contentQueries||(n.contentQueries=[]),r=e.length?e[e.length-1]:-1;t!==r&&e.push(n.queries.length-1,t)}function $R(n,t){return n.queries.getByIndex(t)}function yge(n,t){let e=n[sn],r=$R(e,t);return r.crossesNgTemplate?B2(e,n,t,[]):M4(e,n,r,t)}var ga=class{},e0=class{};var z2=class extends ga{ngModuleType;_parent;_bootstrapComponents=[];_r3Injector;instance;destroyCbs=[];componentFactoryResolver=new f_(this);constructor(t,e,r,o=!0){super(),this.ngModuleType=t,this._parent=e;let i=kz(t);this._bootstrapComponents=n4(i.bootstrap),this._r3Injector=bU(t,e,[{provide:ga,useValue:this},{provide:Dg,useValue:this.componentFactoryResolver},...r],ui(t),new Set(["environment"])),o&&this.resolveInjectorInitializers()}resolveInjectorInitializers(){this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(this.ngModuleType)}get injector(){return this._r3Injector}destroy(){let t=this._r3Injector;!t.destroyed&&t.destroy(),this.destroyCbs.forEach(e=>e()),this.destroyCbs=null}onDestroy(t){this.destroyCbs.push(t)}},U2=class extends e0{moduleType;constructor(t){super(),this.moduleType=t}create(t){return new z2(this.moduleType,t,[])}};var m_=class extends ga{injector;componentFactoryResolver=new f_(this);instance=null;constructor(t){super();let e=new Yv([...t.providers,{provide:ga,useValue:this},{provide:Dg,useValue:this.componentFactoryResolver}],t.parent||S_(),t.debugName,new Set(["environment"]));this.injector=e,t.runEnvironmentInitializers&&e.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(t){this.injector.onDestroy(t)}};function P_(n,t,e=null){return new m_({providers:n,parent:t,debugName:e,runEnvironmentInitializers:!0}).injector}var xge=(()=>{class n{_injector;cachedInjectors=new Map;constructor(e){this._injector=e}getOrCreateStandaloneInjector(e){if(!e.standalone)return null;if(!this.cachedInjectors.has(e)){let r=Oz(!1,e.type),o=r.length>0?P_([r],this._injector,`Standalone[${e.type.name}]`):null;this.cachedInjectors.set(e,o)}return this.cachedInjectors.get(e)}ngOnDestroy(){try{for(let e of this.cachedInjectors.values())e!==null&&e.destroy()}finally{this.cachedInjectors.clear()}}static \u0275prov=Me({token:n,providedIn:"environment",factory:()=>new n(it(lo))})}return n})();function Ct(n){return r0(()=>{let t=L4(n),e=Ft(ke({},t),{decls:n.decls,vars:n.vars,template:n.template,consts:n.consts||null,ngContentSelectors:n.ngContentSelectors,onPush:n.changeDetection===NU.OnPush,directiveDefs:null,pipeDefs:null,dependencies:t.standalone&&n.dependencies||null,getStandaloneInjector:t.standalone?o=>o.get(xge).getOrCreateStandaloneInjector(e):null,getExternalStyles:null,signals:n.signals??!1,data:n.data||{},encapsulation:n.encapsulation||sc.Emulated,styles:n.styles||ki,_:null,schemas:n.schemas||null,tView:null,id:""});t.standalone&&fp("NgStandalone"),$4(e);let r=n.dependencies;return e.directiveDefs=sz(r,!1),e.pipeDefs=sz(r,!0),e.id=wge(e),e})}function vge(n){return Bu(n)||Nz(n)}function bge(n){return n!==null}function Oo(n){return r0(()=>({type:n.type,bootstrap:n.bootstrap||ki,declarations:n.declarations||ki,imports:n.imports||ki,exports:n.exports||ki,transitiveCompileScopes:null,schemas:n.schemas||null,id:n.id||null}))}function iz(n,t){if(n==null)return Cg;let e={};for(let r in n)if(n.hasOwnProperty(r)){let o=n[r],i,s,a=dp.None;Array.isArray(o)?(a=o[0],i=o[1],s=o[2]??i):(i=o,s=o),t?(e[i]=a!==dp.None?[r,a]:r,t[i]=s):e[i]=r}return e}function yn(n){return r0(()=>{let t=L4(n);return $4(t),t})}function L4(n){let t={};return{type:n.type,providersResolver:null,factory:null,hostBindings:n.hostBindings||null,hostVars:n.hostVars||0,hostAttrs:n.hostAttrs||null,contentQueries:n.contentQueries||null,declaredInputs:t,inputTransforms:null,inputConfig:n.inputs||Cg,exportAs:n.exportAs||null,standalone:n.standalone??!0,signals:n.signals===!0,selectors:n.selectors||ki,viewQuery:n.viewQuery||null,features:n.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:iz(n.inputs,t),outputs:iz(n.outputs),debugInfo:null}}function $4(n){n.features?.forEach(t=>t(n))}function sz(n,t){if(!n)return null;let e=t?Az:vge;return()=>(typeof n=="function"?n():n).map(r=>e(r)).filter(bge)}function wge(n){let t=0,e=typeof n.consts=="function"?"":n.consts,r=[n.selectors,n.ngContentSelectors,n.hostVars,n.hostAttrs,e,n.vars,n.decls,n.encapsulation,n.standalone,n.signals,n.exportAs,JSON.stringify(n.inputs),JSON.stringify(n.outputs),Object.getOwnPropertyNames(n.type.prototype),!!n.contentQueries,!!n.viewQuery];for(let i of r.join("|"))t=Math.imul(31,t)+i.charCodeAt(0)<<0;return t+=2147483648,"c"+t}function Cge(n){return Object.getPrototypeOf(n.prototype).constructor}function Or(n){let t=Cge(n.type),e=!0,r=[n];for(;t;){let o;if(Wu(n))o=t.\u0275cmp||t.\u0275dir;else{if(t.\u0275cmp)throw new nt(903,!1);o=t.\u0275dir}if(o){if(e){r.push(o);let s=n;s.inputs=BC(n.inputs),s.inputTransforms=BC(n.inputTransforms),s.declaredInputs=BC(n.declaredInputs),s.outputs=BC(n.outputs);let a=o.hostBindings;a&&Tge(n,a);let l=o.viewQuery,c=o.contentQueries;if(l&&Ige(n,l),c&&Ege(n,c),_ge(n,o),lpe(n.outputs,o.outputs),Wu(o)&&o.data.animation){let u=n.data;u.animation=(u.animation||[]).concat(o.data.animation)}}let i=o.features;if(i)for(let s=0;s<i.length;s++){let a=i[s];a&&a.ngInherit&&a(n),a===Or&&(e=!1)}}t=Object.getPrototypeOf(t)}Sge(r)}function _ge(n,t){for(let e in t.inputs){if(!t.inputs.hasOwnProperty(e)||n.inputs.hasOwnProperty(e))continue;let r=t.inputs[e];if(r!==void 0&&(n.inputs[e]=r,n.declaredInputs[e]=t.declaredInputs[e],t.inputTransforms!==null)){let o=Array.isArray(r)?r[0]:r;if(!t.inputTransforms.hasOwnProperty(o))continue;n.inputTransforms??={},n.inputTransforms[o]=t.inputTransforms[o]}}}function Sge(n){let t=0,e=null;for(let r=n.length-1;r>=0;r--){let o=n[r];o.hostVars=t+=o.hostVars,o.hostAttrs=Eg(o.hostAttrs,e=Eg(e,o.hostAttrs))}}function BC(n){return n===Cg?{}:n===ki?[]:n}function Ige(n,t){let e=n.viewQuery;e?n.viewQuery=(r,o)=>{t(r,o),e(r,o)}:n.viewQuery=t}function Ege(n,t){let e=n.contentQueries;e?n.contentQueries=(r,o,i)=>{t(r,o,i),e(r,o,i)}:n.contentQueries=t}function Tge(n,t){let e=n.hostBindings;e?n.hostBindings=(r,o)=>{t(r,o),e(r,o)}:n.hostBindings=t}function Pg(n){let t=n.inputConfig,e={};for(let r in t)if(t.hasOwnProperty(r)){let o=t[r];Array.isArray(o)&&o[3]&&(e[r]=o[3])}n.inputTransforms=e}function V4(n){return kge(n)?Array.isArray(n)||!(n instanceof Map)&&Symbol.iterator in n:!1}function Dge(n,t){if(Array.isArray(n))for(let e=0;e<n.length;e++)t(n[e]);else{let e=n[Symbol.iterator](),r;for(;!(r=e.next()).done;)t(r.value)}}function kge(n){return n!==null&&(typeof n=="function"||typeof n=="object")}function VR(n,t,e){return n[t]=e}function Nge(n,t){return n[t]}function ya(n,t,e){let r=n[t];return Object.is(r,e)?!1:(n[t]=e,!0)}function t0(n,t,e,r){let o=ya(n,t,e);return ya(n,t+1,r)||o}function Age(n,t,e,r,o){let i=t0(n,t,e,r);return ya(n,t+2,o)||i}function Rge(n,t,e,r,o,i){let s=t0(n,t,e,r);return t0(n,t+2,o,i)||s}function Oge(n,t,e,r,o,i,s,a,l){let c=t.consts,u=M_(t,n,4,s||null,a||null);m4(t,e,u,r_(c,l)),mR(t,u);let d=u.tView=DR(2,u,r,o,i,t.directiveRegistry,t.pipeRegistry,null,t.schemas,c,null);return t.queries!==null&&(t.queries.template(t,u),d.queries=t.queries.embeddedTView(u)),u}function Mge(n,t,e,r,o,i,s,a,l,c){let u=e+rc,d=t.firstCreatePass?Oge(u,t,n,r,o,i,s,a,l):t.data[u];s0(d,!1);let p=Pge(t,n,d,e);fR()&&MR(t,n,p,d),Og(p,n);let f=x4(p,n,p,d);return n[u]=f,kR(n,f),sge(f,d,n),iR(d)&&p4(t,n,d),l!=null&&h4(n,d,c),d}function Ne(n,t,e,r,o,i,s,a){let l=en(),c=co(),u=r_(c.consts,i);return Mge(l,c,n,t,e,r,o,u,s,a),Ne}var Pge=Fge;function Fge(n,t,e,r){return hR(!0),t[Rr].createComment("")}var BR=(()=>{class n{log(e){console.log(e)}warn(e){console.warn(e)}static \u0275fac=function(r){return new(r||n)};static \u0275prov=Me({token:n,factory:n.\u0275fac,providedIn:"platform"})}return n})();var B4=new Ge("");function Nh(n){return!!n&&typeof n.then=="function"}function z4(n){return!!n&&typeof n.subscribe=="function"}var F_=new Ge("");var U4=(()=>{class n{resolve;reject;initialized=!1;done=!1;donePromise=new Promise((e,r)=>{this.resolve=e,this.reject=r});appInits=Q(F_,{optional:!0})??[];injector=Q(qn);constructor(){}runInitializers(){if(this.initialized)return;let e=[];for(let o of this.appInits){let i=Ai(this.injector,o);if(Nh(i))e.push(i);else if(z4(i)){let s=new Promise((a,l)=>{i.subscribe({complete:a,error:l})});e.push(s)}}let r=()=>{this.done=!0,this.resolve()};Promise.all(e).then(()=>{r()}).catch(o=>{this.reject(o)}),e.length===0&&r(),this.initialized=!0}static \u0275fac=function(r){return new(r||n)};static \u0275prov=Me({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Lge=(()=>{class n{static \u0275prov=Me({token:n,providedIn:"root",factory:()=>new W2})}return n})(),W2=class{queuedEffectCount=0;queues=new Map;schedule(t){this.enqueue(t)}remove(t){let e=t.zone,r=this.queues.get(e);r.has(t)&&(r.delete(t),this.queuedEffectCount--)}enqueue(t){let e=t.zone;this.queues.has(e)||this.queues.set(e,new Set);let r=this.queues.get(e);r.has(t)||(this.queuedEffectCount++,r.add(t))}flush(){for(;this.queuedEffectCount>0;)for(let[t,e]of this.queues)t===null?this.flushQueue(e):t.run(()=>this.flushQueue(e))}flushQueue(t){for(let e of t)t.delete(e),this.queuedEffectCount--,e.run()}},h0=new Ge("");function $ge(){KV(()=>{throw new nt(600,!1)})}function Vge(n){return n.isBoundToModule}var Bge=10;function zge(n,t,e){try{let r=e();return Nh(r)?r.catch(o=>{throw t.runOutsideAngular(()=>n.handleError(o)),o}):r}catch(r){throw t.runOutsideAngular(()=>n.handleError(r)),r}}var cs=(()=>{class n{_runningTick=!1;_destroyed=!1;_destroyListeners=[];_views=[];internalErrorHandler=Q(Ufe);afterRenderManager=Q($U);zonelessEnabled=Q(D_);rootEffectScheduler=Q(Lge);dirtyFlags=0;deferredDirtyFlags=0;tracingSnapshot=null;externalTestViews=new Set;afterTick=new zt;get allViews(){return[...this.externalTestViews.keys(),...this._views]}get destroyed(){return this._destroyed}componentTypes=[];components=[];isStable=Q(pp).hasPendingTasks.pipe(Wt(e=>!e));constructor(){Q(Mg,{optional:!0})}whenStable(){let e;return new Promise(r=>{e=this.isStable.subscribe({next:o=>{o&&r()}})}).finally(()=>{e.unsubscribe()})}_injector=Q(lo);_rendererFactory=null;get injector(){return this._injector}bootstrap(e,r){let o=e instanceof p_;if(!this._injector.get(U4).done){let p=!o&&Rz(e),f=!1;throw new nt(405,f)}let s;o?s=e:s=this._injector.get(Dg).resolveComponentFactory(e),this.componentTypes.push(s.componentType);let a=Vge(s)?void 0:this._injector.get(ga),l=r||s.selector,c=s.create(qn.NULL,[],l,a),u=c.location.nativeElement,d=c.injector.get(B4,null);return d?.registerApplication(u),c.onDestroy(()=>{this.detachView(c.hostView),HC(this.components,c),d?.unregisterApplication(u)}),this._loadComponent(c),c}tick(){this.zonelessEnabled||(this.dirtyFlags|=1),this._tick()}_tick=()=>{if(this.tracingSnapshot!==null){let r=this.tracingSnapshot;this.tracingSnapshot=null,r.run(CR.CHANGE_DETECTION,this._tick),r.dispose();return}if(this._runningTick)throw new nt(101,!1);let e=gn(null);try{this._runningTick=!0,this.synchronize()}catch(r){this.internalErrorHandler(r)}finally{this._runningTick=!1,gn(e),this.afterTick.next()}};synchronize(){this._rendererFactory===null&&!this._injector.destroyed&&(this._rendererFactory=this._injector.get(Ns,null,{optional:!0})),this.dirtyFlags|=this.deferredDirtyFlags,this.deferredDirtyFlags=0;let e=0;for(;this.dirtyFlags!==0&&e++<Bge;)this.synchronizeOnce()}synchronizeOnce(){if(this.dirtyFlags|=this.deferredDirtyFlags,this.deferredDirtyFlags=0,this.dirtyFlags&16&&(this.dirtyFlags&=-17,this.rootEffectScheduler.flush()),this.dirtyFlags&7){let e=!!(this.dirtyFlags&1);this.dirtyFlags&=-8,this.dirtyFlags|=8;for(let{_lView:r,notifyErrorHandler:o}of this.allViews)Uge(r,o,e,this.zonelessEnabled);if(this.dirtyFlags&=-5,this.syncDirtyFlagsWithViews(),this.dirtyFlags&23)return}else this._rendererFactory?.begin?.(),this._rendererFactory?.end?.();this.dirtyFlags&8&&(this.dirtyFlags&=-9,this.afterRenderManager.execute()),this.syncDirtyFlagsWithViews()}syncDirtyFlagsWithViews(){if(this.allViews.some(({_lView:e})=>E_(e))){this.dirtyFlags|=2;return}else this.dirtyFlags&=-8}attachView(e){let r=e;this._views.push(r),r.attachToAppRef(this)}detachView(e){let r=e;HC(this._views,r),r.detachFromAppRef()}_loadComponent(e){this.attachView(e.hostView),this.tick(),this.components.push(e),this._injector.get(h0,[]).forEach(o=>o(e))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(e=>e()),this._views.slice().forEach(e=>e.destroy())}finally{this._destroyed=!0,this._views=[],this._destroyListeners=[]}}onDestroy(e){return this._destroyListeners.push(e),()=>HC(this._destroyListeners,e)}destroy(){if(this._destroyed)throw new nt(406,!1);let e=this._injector;e.destroy&&!e.destroyed&&e.destroy()}get viewCount(){return this._views.length}static \u0275fac=function(r){return new(r||n)};static \u0275prov=Me({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function HC(n,t){let e=n.indexOf(t);e>-1&&n.splice(e,1)}function Uge(n,t,e,r){if(!e&&!E_(n))return;D4(n,t,e&&!r?0:1)}function wa(n,t,e,r){let o=en(),i=a0();if(ya(o,i,t)){let s=co(),a=c0();ame(a,o,n,t,e,r)}return wa}function zR(n,t,e,r){return ya(n,a0(),e)?t+Di(e)+r:Ro}function Wge(n,t,e,r,o,i){let s=cR(),a=t0(n,s,e,o);return l0(2),a?t+Di(e)+r+Di(o)+i:Ro}function Gge(n,t,e,r,o,i,s,a){let l=cR(),c=Age(n,l,e,o,s);return l0(3),c?t+Di(e)+r+Di(o)+i+Di(s)+a:Ro}function jge(n,t,e,r,o,i,s,a,l,c){let u=cR(),d=Rge(n,u,e,o,s,l);return l0(4),d?t+Di(e)+r+Di(o)+i+Di(s)+a+Di(l)+c:Ro}function zC(n,t){return n<<17|t<<2}function Th(n){return n>>17&32767}function Hge(n){return(n&2)==2}function qge(n,t){return n&131071|t<<17}function G2(n){return n|2}function kg(n){return(n&131068)>>2}function KA(n,t){return n&-131069|t<<2}function Kge(n){return(n&1)===1}function j2(n){return n|1}function Xge(n,t,e,r,o,i){let s=i?t.classBindings:t.styleBindings,a=Th(s),l=kg(s);n[r]=e;let c=!1,u;if(Array.isArray(e)){let d=e;u=d[1],(u===null||o0(d,u)>0)&&(c=!0)}else u=e;if(o)if(l!==0){let p=Th(n[a+1]);n[r+1]=zC(p,a),p!==0&&(n[p+1]=KA(n[p+1],r)),n[a+1]=qge(n[a+1],r)}else n[r+1]=zC(a,0),a!==0&&(n[a+1]=KA(n[a+1],r)),a=r;else n[r+1]=zC(l,0),a===0?a=r:n[l+1]=KA(n[l+1],r),l=r;c&&(n[r+1]=G2(n[r+1])),az(n,u,r,!0),az(n,u,r,!1),Yge(t,u,n,r,i),s=zC(a,l),i?t.classBindings=s:t.styleBindings=s}function Yge(n,t,e,r,o){let i=o?n.residualClasses:n.residualStyles;i!=null&&typeof t=="string"&&o0(i,t)>=0&&(e[r+1]=j2(e[r+1]))}function az(n,t,e,r){let o=n[e+1],i=t===null,s=r?Th(o):kg(o),a=!1;for(;s!==0&&(a===!1||i);){let l=n[s],c=n[s+1];Zge(l,t)&&(a=!0,n[s+1]=r?j2(c):G2(c)),s=r?Th(c):kg(c)}a&&(n[e+1]=r?G2(o):j2(o))}function Zge(n,t){return n===null||t==null||(Array.isArray(n)?n[1]:n)===t?!0:Array.isArray(n)&&typeof t=="string"?o0(n,t)>=0:!1}var ha={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function Qge(n){return n.substring(ha.key,ha.keyEnd)}function Jge(n){return eye(n),W4(n,G4(n,0,ha.textEnd))}function W4(n,t){let e=ha.textEnd;return e===t?-1:(t=ha.keyEnd=tye(n,ha.key=t,e),G4(n,t,e))}function eye(n){ha.key=0,ha.keyEnd=0,ha.value=0,ha.valueEnd=0,ha.textEnd=n.length}function G4(n,t,e){for(;t<e&&n.charCodeAt(t)<=32;)t++;return t}function tye(n,t,e){for(;t<e&&n.charCodeAt(t)>32;)t++;return t}function re(n,t,e){let r=en(),o=a0();if(ya(r,o,t)){let i=co(),s=c0();R_(i,s,r,n,t,r[Rr],e,!1)}return re}function H2(n,t,e,r,o){let i=t.inputs,s=o?"class":"style";NR(n,e,i[s],s,r)}function Zu(n,t){return nye(n,t,null,!0),Zu}function j4(n){q4(lye,H4,n,!0)}function H4(n,t){for(let e=Jge(t);e>=0;e=W4(t,e))C_(n,Qge(t),!0)}function nye(n,t,e,r){let o=en(),i=co(),s=l0(2);if(i.firstUpdatePass&&X4(i,n,s,r),t!==Ro&&ya(o,s,t)){let a=i.data[ac()];Y4(i,a,o,o[Rr],n,o[s+1]=uye(t,e),r,s)}}function q4(n,t,e,r){let o=co(),i=l0(2);o.firstUpdatePass&&X4(o,null,i,r);let s=en();if(e!==Ro&&ya(s,i,e)){let a=o.data[ac()];if(Z4(a,r)&&!K4(o,i)){let l=r?a.classesWithoutHost:a.stylesWithoutHost;l!==null&&(e=QA(l,e||"")),H2(o,a,s,e,r)}else cye(o,a,s,s[Rr],s[i+1],s[i+1]=aye(n,t,e),r,i)}}function K4(n,t){return t>=n.expandoStartIndex}function X4(n,t,e,r){let o=n.data;if(o[e+1]===null){let i=o[ac()],s=K4(n,e);Z4(i,r)&&t===null&&!s&&(t=!1),t=rye(o,i,t,r),Xge(o,i,t,e,s,r)}}function rye(n,t,e,r){let o=hfe(n),i=r?t.residualClasses:t.residualStyles;if(o===null)(r?t.classBindings:t.styleBindings)===0&&(e=XA(null,n,t,e,r),e=n0(e,t.attrs,r),i=null);else{let s=t.directiveStylingLast;if(s===-1||n[s]!==o)if(e=XA(o,n,t,e,r),i===null){let l=oye(n,t,r);l!==void 0&&Array.isArray(l)&&(l=XA(null,n,t,l[1],r),l=n0(l,t.attrs,r),iye(n,t,r,l))}else i=sye(n,t,r)}return i!==void 0&&(r?t.residualClasses=i:t.residualStyles=i),e}function oye(n,t,e){let r=e?t.classBindings:t.styleBindings;if(kg(r)!==0)return n[Th(r)]}function iye(n,t,e,r){let o=e?t.classBindings:t.styleBindings;n[Th(o)]=r}function sye(n,t,e){let r,o=t.directiveEnd;for(let i=1+t.directiveStylingLast;i<o;i++){let s=n[i].hostAttrs;r=n0(r,s,e)}return n0(r,t.attrs,e)}function XA(n,t,e,r,o){let i=null,s=e.directiveEnd,a=e.directiveStylingLast;for(a===-1?a=e.directiveStart:a++;a<s&&(i=t[a],r=n0(r,i.hostAttrs,o),i!==n);)a++;return n!==null&&(e.directiveStylingLast=a),r}function n0(n,t,e){let r=e?1:2,o=-1;if(t!==null)for(let i=0;i<t.length;i++){let s=t[i];typeof s=="number"?o=s:o===r&&(Array.isArray(n)||(n=n===void 0?[]:["",n]),C_(n,s,e?!0:t[++i]))}return n===void 0?null:n}function aye(n,t,e){if(e==null||e==="")return ki;let r=[],o=As(e);if(Array.isArray(o))for(let i=0;i<o.length;i++)n(r,o[i],!0);else if(typeof o=="object")for(let i in o)o.hasOwnProperty(i)&&n(r,i,o[i]);else typeof o=="string"&&t(r,o);return r}function lye(n,t,e){let r=String(t);r!==""&&!r.includes(" ")&&C_(n,r,e)}function cye(n,t,e,r,o,i,s,a){o===Ro&&(o=ki);let l=0,c=0,u=0<o.length?o[0]:null,d=0<i.length?i[0]:null;for(;u!==null||d!==null;){let p=l<o.length?o[l+1]:void 0,f=c<i.length?i[c+1]:void 0,h=null,m;u===d?(l+=2,c+=2,p!==f&&(h=d,m=f)):d===null||u!==null&&u<d?(l+=2,h=u):(c+=2,h=d,m=f),h!==null&&Y4(n,t,e,r,h,m,s,a),u=l<o.length?o[l]:null,d=c<i.length?i[c]:null}}function Y4(n,t,e,r,o,i,s,a){if(!(t.type&3))return;let l=n.data,c=l[a+1],u=Kge(c)?lz(l,t,e,o,kg(c),s):void 0;if(!g_(u)){g_(i)||Hge(c)&&(i=lz(l,null,e,o,a,s));let d=Hz(ac(),e);Dme(r,s,d,o,i)}}function lz(n,t,e,r,o,i){let s=t===null,a;for(;o>0;){let l=n[o],c=Array.isArray(l),u=c?l[1]:l,d=u===null,p=e[o+1];p===Ro&&(p=d?ki:void 0);let f=d?BA(p,r):u===r?p:void 0;if(c&&!g_(f)&&(f=BA(l,r)),g_(f)&&(a=f,s))return a;let h=n[o+1];o=s?Th(h):kg(h)}if(t!==null){let l=i?t.residualClasses:t.residualStyles;l!=null&&(a=BA(l,r))}return a}function g_(n){return n!==void 0}function uye(n,t){return n==null||n===""||(typeof t=="string"?n=n+t:typeof n=="object"&&(n=ui(As(n)))),n}function Z4(n,t){return(n.flags&(t?8:16))!==0}function Q4(n,t,e){let r=en(),o=zR(r,n,t,e);q4(C_,H4,o,!0)}function dye(n,t,e,r,o,i){let s=t.consts,a=r_(s,o),l=M_(t,n,2,r,a);return m4(t,e,l,r_(s,i)),l.attrs!==null&&M2(l,l.attrs,!1),l.mergedAttrs!==null&&M2(l,l.mergedAttrs,!0),t.queries!==null&&t.queries.elementStart(t,l),l}function E(n,t,e,r){let o=en(),i=co(),s=rc+n,a=o[Rr],l=i.firstCreatePass?dye(s,i,o,t,e,r):i.data[s],c=pye(i,o,l,a,t,n);o[s]=c;let u=iR(l);return s0(l,!0),s4(a,c,l),!b4(l)&&fR()&&MR(i,o,c,l),tfe()===0&&Og(c,o),nfe(),u&&(p4(i,o,l),UU(i,l,o)),r!==null&&h4(o,l),E}function S(){let n=Oi();eU()?lfe():(n=n.parent,s0(n,!1));let t=n;ife(t)&&sfe(),rfe();let e=co();return e.firstCreatePass&&(mR(e,n),zz(n)&&e.queries.elementEnd(n)),t.classesWithoutHost!=null&&wfe(t)&&H2(e,t,en(),t.classesWithoutHost,!0),t.stylesWithoutHost!=null&&Cfe(t)&&H2(e,t,en(),t.stylesWithoutHost,!1),S}function ce(n,t,e,r){return E(n,t,e,r),S(),ce}var pye=(n,t,e,r,o,i)=>(hR(!0),o4(r,o,yfe()));function et(){return en()}function UR(n,t,e){let r=en(),o=a0();if(ya(r,o,t)){let i=co(),s=c0();R_(i,s,r,n,t,r[Rr],e,!0)}return UR}var y_="en-US";var fye=y_;function hye(n){typeof n=="string"&&(fye=n.toLowerCase().replace(/_/g,"-"))}var mye=(n,t,e)=>{};function _e(n,t,e,r){let o=en(),i=co(),s=Oi();return J4(i,o,o[Rr],s,n,t,r),_e}function gye(n,t,e,r){let o=n.cleanup;if(o!=null)for(let i=0;i<o.length-1;i+=2){let s=o[i];if(s===e&&o[i+1]===r){let a=t[JC],l=o[i+2];return a.length>l?a[l]:null}typeof s=="string"&&(i+=2)}return null}function J4(n,t,e,r,o,i,s){let a=iR(r),c=n.firstCreatePass&&Zz(n),u=t[Ds],d=Yz(t),p=!0;if(r.type&3||s){let m=va(r,t),g=s?s(m):m,y=d.length,v=s?C=>s(oc(C[r.index])):r.index,w=null;if(!s&&a&&(w=gye(n,t,o,r.index)),w!==null){let C=w.__ngLastListenerFn__||w;C.__ngNextListenerFn__=i,w.__ngLastListenerFn__=i,p=!1}else{i=uz(r,t,u,i),mye(m,o,i);let C=e.listen(g,o,i);d.push(i,C),c&&c.push(o,v,y,y+1)}}else i=uz(r,t,u,i);let f=r.outputs,h;if(p&&f!==null&&(h=f[o])){let m=h.length;if(m)for(let g=0;g<m;g+=2){let y=h[g],v=h[g+1],I=t[y][v].subscribe(i),A=d.length;d.push(i,I),c&&c.push(o,r.index,A,-(A+1))}}}function cz(n,t,e,r){let o=gn(null);try{return Ts(6,t,e),e(r)!==!1}catch(i){return v4(n,i),!1}finally{Ts(7,t,e),gn(o)}}function uz(n,t,e,r){return function o(i){if(i===Function)return r;let s=Dh(n)?ic(n.index,t):t;FR(s,5);let a=cz(t,e,r,i),l=o.__ngNextListenerFn__;for(;l;)a=cz(t,e,l,i)&&a,l=l.__ngNextListenerFn__;return a}}function le(n=1){return gfe(n)}function Ca(n,t,e,r,o){let i=en(),s=zR(i,t,e,r);if(s!==Ro){let a=co(),l=c0();R_(a,l,i,n,s,i[Rr],o,!1)}return Ca}function eW(n,t,e,r){hge(n,t,e,r)}function hp(n,t,e){fge(n,t,e)}function uc(n){let t=en(),e=co(),r=nU();uR(r+1);let o=$R(e,r);if(n.dirty&&Ype(t)===((o.metadata.flags&2)===2)){if(o.matches===null)n.reset([]);else{let i=yge(t,r);n.reset(i,jfe),n.notifyOnChanges()}return!0}return!1}function dc(){return pge(en(),nU())}function Fg(n){let t=cfe();return Xpe(t,rc+n)}function O(n,t=""){let e=en(),r=co(),o=n+rc,i=r.firstCreatePass?M_(r,o,1,t,null):r.data[o],s=yye(r,e,i,t,n);e[o]=s,fR()&&MR(r,e,s,i),s0(i,!1)}var yye=(n,t,e,r,o)=>(hR(!0),Phe(t[Rr],r));function Ye(n){return Tt("",n,""),Ye}function Tt(n,t,e){let r=en(),o=zR(r,n,t,e);return o!==Ro&&L_(r,ac(),o),Tt}function _a(n,t,e,r,o){let i=en(),s=Wge(i,n,t,e,r,o);return s!==Ro&&L_(i,ac(),s),_a}function WR(n,t,e,r,o,i,s){let a=en(),l=Gge(a,n,t,e,r,o,i,s);return l!==Ro&&L_(a,ac(),l),WR}function GR(n,t,e,r,o,i,s,a,l){let c=en(),u=jge(c,n,t,e,r,o,i,s,a,l);return u!==Ro&&L_(c,ac(),u),GR}function L_(n,t,e){let r=Hz(t,n);Fhe(n[Rr],r,e)}function ft(n,t,e){DU(t)&&(t=t());let r=en(),o=a0();if(ya(r,o,t)){let i=co(),s=c0();R_(i,s,r,n,t,r[Rr],e,!1)}return ft}function gt(n,t){let e=DU(n);return e&&n.set(t),e}function ht(n,t){let e=en(),r=co(),o=Oi();return J4(r,e,e[Rr],o,n,t),ht}function xye(n,t,e){let r=co();if(r.firstCreatePass){let o=Wu(n);q2(e,r.data,r.blueprint,o,!0),q2(t,r.data,r.blueprint,o,!1)}}function q2(n,t,e,r,o){if(n=ci(n),Array.isArray(n))for(let i=0;i<n.length;i++)q2(n[i],t,e,r,o);else{let i=co(),s=en(),a=Oi(),l=Sg(n)?n:ci(n.provide),c=Fz(n),u=a.providerIndexes&1048575,d=a.directiveStart,p=a.providerIndexes>>20;if(Sg(n)||!n.multi){let f=new Sh(c,o,Be),h=ZA(l,t,o?u:u+p,d);h===-1?(d2(s_(a,s),i,l),YA(i,n,t.length),t.push(l),a.directiveStart++,a.directiveEnd++,o&&(a.providerIndexes+=1048576),e.push(f),s.push(f)):(e[h]=f,s[h]=f)}else{let f=ZA(l,t,u+p,d),h=ZA(l,t,u,u+p),m=f>=0&&e[f],g=h>=0&&e[h];if(o&&!g||!o&&!m){d2(s_(a,s),i,l);let y=wye(o?bye:vye,e.length,o,r,c);!o&&g&&(e[h].providerFactory=y),YA(i,n,t.length,0),t.push(l),a.directiveStart++,a.directiveEnd++,o&&(a.providerIndexes+=1048576),e.push(y),s.push(y)}else{let y=tW(e[o?h:f],c,!o&&r);YA(i,n,f>-1?f:h,y)}!o&&r&&g&&e[h].componentProviders++}}}function YA(n,t,e,r){let o=Sg(t),i=Fpe(t);if(o||i){let l=(i?ci(t.useClass):t).prototype.ngOnDestroy;if(l){let c=n.destroyHooks||(n.destroyHooks=[]);if(!o&&t.multi){let u=c.indexOf(e);u===-1?c.push(e,[r,l]):c[u+1].push(r,l)}else c.push(e,l)}}}function tW(n,t,e){return e&&n.componentProviders++,n.multi.push(t)-1}function ZA(n,t,e,r){for(let o=e;o<r;o++)if(t[o]===n)return o;return-1}function vye(n,t,e,r){return K2(this.multi,[])}function bye(n,t,e,r){let o=this.multi,i;if(this.providerFactory){let s=this.providerFactory.componentProviders,a=Jv(e,e[sn],this.providerFactory.index,r);i=a.slice(0,s),K2(o,i);for(let l=s;l<a.length;l++)i.push(a[l])}else i=[],K2(o,i);return i}function K2(n,t){for(let e=0;e<n.length;e++){let r=n[e];t.push(r())}return t}function wye(n,t,e,r,o){let i=new Sh(n,e,Be);return i.multi=[],i.index=t,i.componentProviders=0,tW(i,o,r&&!e),i}function Pi(n,t=[]){return e=>{e.providersResolver=(r,o)=>xye(r,o?o(n):n,t)}}function Fi(n,t,e){let r=lR()+n,o=en();return o[r]===Ro?VR(o,r,e?t.call(e):t()):Nge(o,r)}function Qu(n,t,e,r){return Cye(en(),lR(),n,t,e,r)}function mp(n,t,e,r,o){return _ye(en(),lR(),n,t,e,r,o)}function nW(n,t){let e=n[t];return e===Ro?void 0:e}function Cye(n,t,e,r,o,i){let s=t+e;return ya(n,s,o)?VR(n,s+1,i?r.call(i,o):r(o)):nW(n,s+1)}function _ye(n,t,e,r,o,i,s){let a=t+e;return t0(n,a,o,i)?VR(n,a+2,s?r.call(s,o,i):r(o,i)):nW(n,a+2)}var X2=class{ngModuleFactory;componentFactories;constructor(t,e){this.ngModuleFactory=t,this.componentFactories=e}},$_=(()=>{class n{compileModuleSync(e){return new U2(e)}compileModuleAsync(e){return Promise.resolve(this.compileModuleSync(e))}compileModuleAndAllComponentsSync(e){let r=this.compileModuleSync(e),o=kz(e),i=n4(o.declarations).reduce((s,a)=>{let l=Bu(a);return l&&s.push(new Eh(l)),s},[]);return new X2(r,i)}compileModuleAndAllComponentsAsync(e){return Promise.resolve(this.compileModuleAndAllComponentsSync(e))}clearCache(){}clearCacheFor(e){}getModuleId(e){}static \u0275fac=function(r){return new(r||n)};static \u0275prov=Me({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var Sye=(()=>{class n{zone=Q(ln);changeDetectionScheduler=Q(Tg);applicationRef=Q(cs);_onMicrotaskEmptySubscription;initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.changeDetectionScheduler.runningTick||this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static \u0275fac=function(r){return new(r||n)};static \u0275prov=Me({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Iye=new Ge("",{factory:()=>!1});function rW({ngZoneFactory:n,ignoreChangesOutsideZone:t,scheduleInRootZone:e}){return n??=()=>new ln(Ft(ke({},iW()),{scheduleInRootZone:e})),[{provide:ln,useFactory:n},{provide:_g,multi:!0,useFactory:()=>{let r=Q(Sye,{optional:!0});return()=>r.initialize()}},{provide:_g,multi:!0,useFactory:()=>{let r=Q(Eye);return()=>{r.initialize()}}},t===!0?{provide:CU,useValue:!0}:[],{provide:_U,useValue:e??wU}]}function oW(n){let t=n?.ignoreChangesOutsideZone,e=n?.scheduleInRootZone,r=rW({ngZoneFactory:()=>{let o=iW(n);return o.scheduleInRootZone=e,o.shouldCoalesceEventChangeDetection&&fp("NgZone_CoalesceEvent"),new ln(o)},ignoreChangesOutsideZone:t,scheduleInRootZone:e});return Ng([{provide:Iye,useValue:!0},{provide:D_,useValue:!1},r])}function iW(n){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:n?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:n?.runCoalescing??!1}}var Eye=(()=>{class n{subscription=new Jn;initialized=!1;zone=Q(ln);pendingTasks=Q(pp);initialize(){if(this.initialized)return;this.initialized=!0;let e=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(e=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{ln.assertNotInAngularZone(),queueMicrotask(()=>{e!==null&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(e),e=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{ln.assertInAngularZone(),e??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}static \u0275fac=function(r){return new(r||n)};static \u0275prov=Me({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var Tye=(()=>{class n{appRef=Q(cs);taskService=Q(pp);ngZone=Q(ln);zonelessEnabled=Q(D_);tracing=Q(Mg,{optional:!0});disableScheduling=Q(CU,{optional:!0})??!1;zoneIsDefined=typeof Zone<"u"&&!!Zone.root.run;schedulerTickApplyArgs=[{data:{__scheduler_tick__:!0}}];subscriptions=new Jn;angularZoneId=this.zoneIsDefined?this.ngZone._inner?.get(l_):null;scheduleInRootZone=!this.zonelessEnabled&&this.zoneIsDefined&&(Q(_U,{optional:!0})??!1);cancelScheduledCallback=null;useMicrotaskScheduler=!1;runningTick=!1;pendingRenderTaskId=null;constructor(){this.subscriptions.add(this.appRef.afterTick.subscribe(()=>{this.runningTick||this.cleanup()})),this.subscriptions.add(this.ngZone.onUnstable.subscribe(()=>{this.runningTick||this.cleanup()})),this.disableScheduling||=!this.zonelessEnabled&&(this.ngZone instanceof g2||!this.zoneIsDefined)}notify(e){if(!this.zonelessEnabled&&e===5)return;let r=!1;switch(e){case 0:{this.appRef.dirtyFlags|=2;break}case 3:case 2:case 4:case 5:case 1:{this.appRef.dirtyFlags|=4;break}case 8:{this.appRef.deferredDirtyFlags|=8;break}case 6:{this.appRef.dirtyFlags|=2,r=!0;break}case 13:{this.appRef.dirtyFlags|=16,r=!0;break}case 14:{this.appRef.dirtyFlags|=2,r=!0;break}case 12:{r=!0;break}case 10:case 9:case 7:case 11:default:this.appRef.dirtyFlags|=8}if(this.appRef.tracingSnapshot=this.tracing?.snapshot(this.appRef.tracingSnapshot)??null,!this.shouldScheduleTick(r))return;let o=this.useMicrotaskScheduler?$B:SU;this.pendingRenderTaskId=this.taskService.add(),this.scheduleInRootZone?this.cancelScheduledCallback=Zone.root.run(()=>o(()=>this.tick())):this.cancelScheduledCallback=this.ngZone.runOutsideAngular(()=>o(()=>this.tick()))}shouldScheduleTick(e){return!(this.disableScheduling&&!e||this.appRef.destroyed||this.pendingRenderTaskId!==null||this.runningTick||this.appRef._runningTick||!this.zonelessEnabled&&this.zoneIsDefined&&Zone.current.get(l_+this.angularZoneId))}tick(){if(this.runningTick||this.appRef.destroyed)return;if(this.appRef.dirtyFlags===0){this.cleanup();return}!this.zonelessEnabled&&this.appRef.dirtyFlags&7&&(this.appRef.dirtyFlags|=1);let e=this.taskService.add();try{this.ngZone.run(()=>{this.runningTick=!0,this.appRef._tick()},void 0,this.schedulerTickApplyArgs)}catch(r){throw this.taskService.remove(e),r}finally{this.cleanup()}this.useMicrotaskScheduler=!0,$B(()=>{this.useMicrotaskScheduler=!1,this.taskService.remove(e)})}ngOnDestroy(){this.subscriptions.unsubscribe(),this.cleanup()}cleanup(){if(this.runningTick=!1,this.cancelScheduledCallback?.(),this.cancelScheduledCallback=null,this.pendingRenderTaskId!==null){let e=this.pendingRenderTaskId;this.pendingRenderTaskId=null,this.taskService.remove(e)}}static \u0275fac=function(r){return new(r||n)};static \u0275prov=Me({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function Dye(){return typeof $localize<"u"&&$localize.locale||y_}var jR=new Ge("",{providedIn:"root",factory:()=>Q(jR,Qt.Optional|Qt.SkipSelf)||Dye()});var Y2=new Ge(""),kye=new Ge("");function Gv(n){return!n.moduleRef}function Nye(n){let t=Gv(n)?n.r3Injector:n.moduleRef.injector,e=t.get(ln);return e.run(()=>{Gv(n)?n.r3Injector.resolveInjectorInitializers():n.moduleRef.resolveInjectorInitializers();let r=t.get(Gu,null),o;if(e.runOutsideAngular(()=>{o=e.onError.subscribe({next:i=>{r.handleError(i)}})}),Gv(n)){let i=()=>t.destroy(),s=n.platformInjector.get(Y2);s.add(i),t.onDestroy(()=>{o.unsubscribe(),s.delete(i)})}else{let i=()=>n.moduleRef.destroy(),s=n.platformInjector.get(Y2);s.add(i),n.moduleRef.onDestroy(()=>{HC(n.allPlatformModules,n.moduleRef),o.unsubscribe(),s.delete(i)})}return zge(r,e,()=>{let i=t.get(U4);return i.runInitializers(),i.donePromise.then(()=>{let s=t.get(jR,y_);if(hye(s||y_),!t.get(kye,!0))return Gv(n)?t.get(cs):(n.allPlatformModules.push(n.moduleRef),n.moduleRef);if(Gv(n)){let l=t.get(cs);return n.rootComponent!==void 0&&l.bootstrap(n.rootComponent),l}else return Aye(n.moduleRef,n.allPlatformModules),n.moduleRef})})})}function Aye(n,t){let e=n.injector.get(cs);if(n._bootstrapComponents.length>0)n._bootstrapComponents.forEach(r=>e.bootstrap(r));else if(n.instance.ngDoBootstrap)n.instance.ngDoBootstrap(e);else throw new nt(-403,!1);t.push(n)}var qC=null;function Rye(n=[],t){return qn.create({name:t,providers:[{provide:__,useValue:"platform"},{provide:Y2,useValue:new Set([()=>qC=null])},...n]})}function Oye(n=[]){if(qC)return qC;let t=Rye(n);return qC=t,$ge(),Mye(t),t}function Mye(n){let t=n.get(bR,null);Ai(n,()=>{t?.forEach(e=>e())})}var Sa=(()=>{class n{static __NG_ELEMENT_ID__=Pye}return n})();function Pye(n){return Fye(Oi(),en(),(n&16)===16)}function Fye(n,t,e){if(Dh(n)&&!e){let r=ic(n.index,t);return new Ih(r,r)}else if(n.type&175){let r=t[nc];return new Ih(r,t)}return null}var Z2=class{constructor(){}supports(t){return V4(t)}create(t){return new Q2(t)}},Lye=(n,t)=>t,Q2=class{length=0;collection;_linkedRecords=null;_unlinkedRecords=null;_previousItHead=null;_itHead=null;_itTail=null;_additionsHead=null;_additionsTail=null;_movesHead=null;_movesTail=null;_removalsHead=null;_removalsTail=null;_identityChangesHead=null;_identityChangesTail=null;_trackByFn;constructor(t){this._trackByFn=t||Lye}forEachItem(t){let e;for(e=this._itHead;e!==null;e=e._next)t(e)}forEachOperation(t){let e=this._itHead,r=this._removalsHead,o=0,i=null;for(;e||r;){let s=!r||e&&e.currentIndex<dz(r,o,i)?e:r,a=dz(s,o,i),l=s.currentIndex;if(s===r)o--,r=r._nextRemoved;else if(e=e._next,s.previousIndex==null)o++;else{i||(i=[]);let c=a-o,u=l-o;if(c!=u){for(let p=0;p<c;p++){let f=p<i.length?i[p]:i[p]=0,h=f+p;u<=h&&h<c&&(i[p]=f+1)}let d=s.previousIndex;i[d]=u-c}}a!==l&&t(s,a,l)}}forEachPreviousItem(t){let e;for(e=this._previousItHead;e!==null;e=e._nextPrevious)t(e)}forEachAddedItem(t){let e;for(e=this._additionsHead;e!==null;e=e._nextAdded)t(e)}forEachMovedItem(t){let e;for(e=this._movesHead;e!==null;e=e._nextMoved)t(e)}forEachRemovedItem(t){let e;for(e=this._removalsHead;e!==null;e=e._nextRemoved)t(e)}forEachIdentityChange(t){let e;for(e=this._identityChangesHead;e!==null;e=e._nextIdentityChange)t(e)}diff(t){if(t==null&&(t=[]),!V4(t))throw new nt(900,!1);return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let e=this._itHead,r=!1,o,i,s;if(Array.isArray(t)){this.length=t.length;for(let a=0;a<this.length;a++)i=t[a],s=this._trackByFn(a,i),e===null||!Object.is(e.trackById,s)?(e=this._mismatch(e,i,s,a),r=!0):(r&&(e=this._verifyReinsertion(e,i,s,a)),Object.is(e.item,i)||this._addIdentityChange(e,i)),e=e._next}else o=0,Dge(t,a=>{s=this._trackByFn(o,a),e===null||!Object.is(e.trackById,s)?(e=this._mismatch(e,a,s,o),r=!0):(r&&(e=this._verifyReinsertion(e,a,s,o)),Object.is(e.item,a)||this._addIdentityChange(e,a)),e=e._next,o++}),this.length=o;return this._truncate(e),this.collection=t,this.isDirty}get isDirty(){return this._additionsHead!==null||this._movesHead!==null||this._removalsHead!==null||this._identityChangesHead!==null}_reset(){if(this.isDirty){let t;for(t=this._previousItHead=this._itHead;t!==null;t=t._next)t._nextPrevious=t._next;for(t=this._additionsHead;t!==null;t=t._nextAdded)t.previousIndex=t.currentIndex;for(this._additionsHead=this._additionsTail=null,t=this._movesHead;t!==null;t=t._nextMoved)t.previousIndex=t.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(t,e,r,o){let i;return t===null?i=this._itTail:(i=t._prev,this._remove(t)),t=this._unlinkedRecords===null?null:this._unlinkedRecords.get(r,null),t!==null?(Object.is(t.item,e)||this._addIdentityChange(t,e),this._reinsertAfter(t,i,o)):(t=this._linkedRecords===null?null:this._linkedRecords.get(r,o),t!==null?(Object.is(t.item,e)||this._addIdentityChange(t,e),this._moveAfter(t,i,o)):t=this._addAfter(new J2(e,r),i,o)),t}_verifyReinsertion(t,e,r,o){let i=this._unlinkedRecords===null?null:this._unlinkedRecords.get(r,null);return i!==null?t=this._reinsertAfter(i,t._prev,o):t.currentIndex!=o&&(t.currentIndex=o,this._addToMoves(t,o)),t}_truncate(t){for(;t!==null;){let e=t._next;this._addToRemovals(this._unlink(t)),t=e}this._unlinkedRecords!==null&&this._unlinkedRecords.clear(),this._additionsTail!==null&&(this._additionsTail._nextAdded=null),this._movesTail!==null&&(this._movesTail._nextMoved=null),this._itTail!==null&&(this._itTail._next=null),this._removalsTail!==null&&(this._removalsTail._nextRemoved=null),this._identityChangesTail!==null&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(t,e,r){this._unlinkedRecords!==null&&this._unlinkedRecords.remove(t);let o=t._prevRemoved,i=t._nextRemoved;return o===null?this._removalsHead=i:o._nextRemoved=i,i===null?this._removalsTail=o:i._prevRemoved=o,this._insertAfter(t,e,r),this._addToMoves(t,r),t}_moveAfter(t,e,r){return this._unlink(t),this._insertAfter(t,e,r),this._addToMoves(t,r),t}_addAfter(t,e,r){return this._insertAfter(t,e,r),this._additionsTail===null?this._additionsTail=this._additionsHead=t:this._additionsTail=this._additionsTail._nextAdded=t,t}_insertAfter(t,e,r){let o=e===null?this._itHead:e._next;return t._next=o,t._prev=e,o===null?this._itTail=t:o._prev=t,e===null?this._itHead=t:e._next=t,this._linkedRecords===null&&(this._linkedRecords=new x_),this._linkedRecords.put(t),t.currentIndex=r,t}_remove(t){return this._addToRemovals(this._unlink(t))}_unlink(t){this._linkedRecords!==null&&this._linkedRecords.remove(t);let e=t._prev,r=t._next;return e===null?this._itHead=r:e._next=r,r===null?this._itTail=e:r._prev=e,t}_addToMoves(t,e){return t.previousIndex===e||(this._movesTail===null?this._movesTail=this._movesHead=t:this._movesTail=this._movesTail._nextMoved=t),t}_addToRemovals(t){return this._unlinkedRecords===null&&(this._unlinkedRecords=new x_),this._unlinkedRecords.put(t),t.currentIndex=null,t._nextRemoved=null,this._removalsTail===null?(this._removalsTail=this._removalsHead=t,t._prevRemoved=null):(t._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=t),t}_addIdentityChange(t,e){return t.item=e,this._identityChangesTail===null?this._identityChangesTail=this._identityChangesHead=t:this._identityChangesTail=this._identityChangesTail._nextIdentityChange=t,t}},J2=class{item;trackById;currentIndex=null;previousIndex=null;_nextPrevious=null;_prev=null;_next=null;_prevDup=null;_nextDup=null;_prevRemoved=null;_nextRemoved=null;_nextAdded=null;_nextMoved=null;_nextIdentityChange=null;constructor(t,e){this.item=t,this.trackById=e}},eR=class{_head=null;_tail=null;add(t){this._head===null?(this._head=this._tail=t,t._nextDup=null,t._prevDup=null):(this._tail._nextDup=t,t._prevDup=this._tail,t._nextDup=null,this._tail=t)}get(t,e){let r;for(r=this._head;r!==null;r=r._nextDup)if((e===null||e<=r.currentIndex)&&Object.is(r.trackById,t))return r;return null}remove(t){let e=t._prevDup,r=t._nextDup;return e===null?this._head=r:e._nextDup=r,r===null?this._tail=e:r._prevDup=e,this._head===null}},x_=class{map=new Map;put(t){let e=t.trackById,r=this.map.get(e);r||(r=new eR,this.map.set(e,r)),r.add(t)}get(t,e){let r=t,o=this.map.get(r);return o?o.get(t,e):null}remove(t){let e=t.trackById;return this.map.get(e).remove(t)&&this.map.delete(e),t}get isEmpty(){return this.map.size===0}clear(){this.map.clear()}};function dz(n,t,e){let r=n.previousIndex;if(r===null)return r;let o=0;return e&&r<e.length&&(o=e[r]),r+t+o}function pz(){return new V_([new Z2])}var V_=(()=>{class n{factories;static \u0275prov=Me({token:n,providedIn:"root",factory:pz});constructor(e){this.factories=e}static create(e,r){if(r!=null){let o=r.factories.slice();e=e.concat(o)}return new n(e)}static extend(e){return{provide:n,useFactory:r=>n.create(e,r||pz()),deps:[[n,new Tpe,new nR]]}}find(e){let r=this.factories.find(o=>o.supports(e));if(r!=null)return r;throw new nt(901,!1)}}return n})();function sW(n){try{let{rootComponent:t,appProviders:e,platformProviders:r}=n,o=Oye(r),i=[rW({}),{provide:Tg,useExisting:Tye},...e||[]],s=new m_({providers:i,parent:o,debugName:"",runEnvironmentInitializers:!1});return Nye({r3Injector:s.injector,platformInjector:o,rootComponent:t})}catch(t){return Promise.reject(t)}}function Ia(n){return typeof n=="boolean"?n:n!=null&&n!=="false"}function Lg(n,t){fp("NgSignals");let e=jV(n);return t?.equal&&(e[ss].equal=t.equal),e}function Os(n){let t=gn(null);try{return n()}finally{gn(t)}}var fz=class{[ss];constructor(t){this[ss]=t}destroy(){this[ss].destroy()}};function B_(n,t){let e=Bu(n),r=t.elementInjector||S_();return new Eh(e).create(r,t.projectableNodes,t.hostElement,t.environmentInjector)}function aW(n){let t=Bu(n);if(!t)return null;let e=new Eh(t);return{get selector(){return e.selector},get type(){return e.componentType},get inputs(){return e.inputs},get outputs(){return e.outputs},get ngContentSelectors(){return e.ngContentSelectors},get isStandalone(){return t.standalone},get isSignal(){return t.signals}}}var fW=null;function ed(){return fW}function hW(n){fW??=n}var z_=class{};var fn=new Ge(""),ZR=(()=>{class n{historyGo(e){throw new Error("")}static \u0275fac=function(r){return new(r||n)};static \u0275prov=Me({token:n,factory:()=>Q(Vye),providedIn:"platform"})}return n})(),mW=new Ge(""),Vye=(()=>{class n extends ZR{_location;_history;_doc=Q(fn);constructor(){super(),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return ed().getBaseHref(this._doc)}onPopState(e){let r=ed().getGlobalEventTarget(this._doc,"window");return r.addEventListener("popstate",e,!1),()=>r.removeEventListener("popstate",e)}onHashChange(e){let r=ed().getGlobalEventTarget(this._doc,"window");return r.addEventListener("hashchange",e,!1),()=>r.removeEventListener("hashchange",e)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(e){this._location.pathname=e}pushState(e,r,o){this._history.pushState(e,r,o)}replaceState(e,r,o){this._history.replaceState(e,r,o)}forward(){this._history.forward()}back(){this._history.back()}historyGo(e=0){this._history.go(e)}getState(){return this._history.state}static \u0275fac=function(r){return new(r||n)};static \u0275prov=Me({token:n,factory:()=>new n,providedIn:"platform"})}return n})();function QR(n,t){return n?t?n.endsWith("/")?t.startsWith("/")?n+t.slice(1):n+t:t.startsWith("/")?n+t:`${n}/${t}`:n:t}function lW(n){let t=n.match(/#|\?|$/),e=t&&t.index||n.length,r=e-(n[e-1]==="/"?1:0);return n.slice(0,r)+n.slice(e)}function Ju(n){return n&&n[0]!=="?"?"?"+n:n}var td=(()=>{class n{historyGo(e){throw new Error("")}static \u0275fac=function(r){return new(r||n)};static \u0275prov=Me({token:n,factory:()=>Q(JR),providedIn:"root"})}return n})(),gW=new Ge(""),JR=(()=>{class n extends td{_platformLocation;_baseHref;_removeListenerFns=[];constructor(e,r){super(),this._platformLocation=e,this._baseHref=r??this._platformLocation.getBaseHrefFromDOM()??Q(fn).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}prepareExternalUrl(e){return QR(this._baseHref,e)}path(e=!1){let r=this._platformLocation.pathname+Ju(this._platformLocation.search),o=this._platformLocation.hash;return o&&e?`${r}${o}`:r}pushState(e,r,o,i){let s=this.prepareExternalUrl(o+Ju(i));this._platformLocation.pushState(e,r,s)}replaceState(e,r,o,i){let s=this.prepareExternalUrl(o+Ju(i));this._platformLocation.replaceState(e,r,s)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(e=0){this._platformLocation.historyGo?.(e)}static \u0275fac=function(r){return new(r||n)(it(ZR),it(gW,8))};static \u0275prov=Me({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),yW=(()=>{class n extends td{_platformLocation;_baseHref="";_removeListenerFns=[];constructor(e,r){super(),this._platformLocation=e,r!=null&&(this._baseHref=r)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}path(e=!1){let r=this._platformLocation.hash??"#";return r.length>0?r.substring(1):r}prepareExternalUrl(e){let r=QR(this._baseHref,e);return r.length>0?"#"+r:r}pushState(e,r,o,i){let s=this.prepareExternalUrl(o+Ju(i));s.length==0&&(s=this._platformLocation.pathname),this._platformLocation.pushState(e,r,s)}replaceState(e,r,o,i){let s=this.prepareExternalUrl(o+Ju(i));s.length==0&&(s=this._platformLocation.pathname),this._platformLocation.replaceState(e,r,s)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(e=0){this._platformLocation.historyGo?.(e)}static \u0275fac=function(r){return new(r||n)(it(ZR),it(gW,8))};static \u0275prov=Me({token:n,factory:n.\u0275fac})}return n})(),gp=(()=>{class n{_subject=new zt;_basePath;_locationStrategy;_urlChangeListeners=[];_urlChangeSubscription=null;constructor(e){this._locationStrategy=e;let r=this._locationStrategy.getBaseHref();this._basePath=Uye(lW(cW(r))),this._locationStrategy.onPopState(o=>{this._subject.next({url:this.path(!0),pop:!0,state:o.state,type:o.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(e=!1){return this.normalize(this._locationStrategy.path(e))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(e,r=""){return this.path()==this.normalize(e+Ju(r))}normalize(e){return n.stripTrailingSlash(zye(this._basePath,cW(e)))}prepareExternalUrl(e){return e&&e[0]!=="/"&&(e="/"+e),this._locationStrategy.prepareExternalUrl(e)}go(e,r="",o=null){this._locationStrategy.pushState(o,"",e,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+Ju(r)),o)}replaceState(e,r="",o=null){this._locationStrategy.replaceState(o,"",e,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+Ju(r)),o)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(e=0){this._locationStrategy.historyGo?.(e)}onUrlChange(e){return this._urlChangeListeners.push(e),this._urlChangeSubscription??=this.subscribe(r=>{this._notifyUrlChangeListeners(r.url,r.state)}),()=>{let r=this._urlChangeListeners.indexOf(e);this._urlChangeListeners.splice(r,1),this._urlChangeListeners.length===0&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(e="",r){this._urlChangeListeners.forEach(o=>o(e,r))}subscribe(e,r,o){return this._subject.subscribe({next:e,error:r??void 0,complete:o??void 0})}static normalizeQueryParams=Ju;static joinWithSlash=QR;static stripTrailingSlash=lW;static \u0275fac=function(r){return new(r||n)(it(td))};static \u0275prov=Me({token:n,factory:()=>Bye(),providedIn:"root"})}return n})();function Bye(){return new gp(it(td))}function zye(n,t){if(!n||!t.startsWith(n))return t;let e=t.substring(n.length);return e===""||["/",";","?","#"].includes(e[0])?e:t}function cW(n){return n.replace(/\/index.html$/,"")}function Uye(n){if(new RegExp("^(https?:)?//").test(n)){let[,e]=n.split(/\/\/[^\/]+/);return e}return n}function U_(n,t){t=encodeURIComponent(t);for(let e of n.split(";")){let r=e.indexOf("="),[o,i]=r==-1?[e,""]:[e.slice(0,r),e.slice(r+1)];if(o.trim()===t)return decodeURIComponent(i)}return null}var HR=/\s+/,uW=[],yp=(()=>{class n{_ngEl;_renderer;initialClasses=uW;rawClass;stateMap=new Map;constructor(e,r){this._ngEl=e,this._renderer=r}set klass(e){this.initialClasses=e!=null?e.trim().split(HR):uW}set ngClass(e){this.rawClass=typeof e=="string"?e.trim().split(HR):e}ngDoCheck(){for(let r of this.initialClasses)this._updateState(r,!0);let e=this.rawClass;if(Array.isArray(e)||e instanceof Set)for(let r of e)this._updateState(r,!0);else if(e!=null)for(let r of Object.keys(e))this._updateState(r,!!e[r]);this._applyStateDiff()}_updateState(e,r){let o=this.stateMap.get(e);o!==void 0?(o.enabled!==r&&(o.changed=!0,o.enabled=r),o.touched=!0):this.stateMap.set(e,{enabled:r,changed:!0,touched:!0})}_applyStateDiff(){for(let e of this.stateMap){let r=e[0],o=e[1];o.changed?(this._toggleClass(r,o.enabled),o.changed=!1):o.touched||(o.enabled&&this._toggleClass(r,!1),this.stateMap.delete(r)),o.touched=!1}}_toggleClass(e,r){e=e.trim(),e.length>0&&e.split(HR).forEach(o=>{r?this._renderer.addClass(this._ngEl.nativeElement,o):this._renderer.removeClass(this._ngEl.nativeElement,o)})}static \u0275fac=function(r){return new(r||n)(Be(hr),Be(Mi))};static \u0275dir=yn({type:n,selectors:[["","ngClass",""]],inputs:{klass:[0,"class","klass"],ngClass:"ngClass"}})}return n})();var qR=class{$implicit;ngForOf;index;count;constructor(t,e,r,o){this.$implicit=t,this.ngForOf=e,this.index=r,this.count=o}get first(){return this.index===0}get last(){return this.index===this.count-1}get even(){return this.index%2===0}get odd(){return!this.even}},Er=(()=>{class n{_viewContainer;_template;_differs;set ngForOf(e){this._ngForOf=e,this._ngForOfDirty=!0}set ngForTrackBy(e){this._trackByFn=e}get ngForTrackBy(){return this._trackByFn}_ngForOf=null;_ngForOfDirty=!0;_differ=null;_trackByFn;constructor(e,r,o){this._viewContainer=e,this._template=r,this._differs=o}set ngForTemplate(e){e&&(this._template=e)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;let e=this._ngForOf;!this._differ&&e&&(this._differ=this._differs.find(e).create(this.ngForTrackBy))}if(this._differ){let e=this._differ.diff(this._ngForOf);e&&this._applyChanges(e)}}_applyChanges(e){let r=this._viewContainer;e.forEachOperation((o,i,s)=>{if(o.previousIndex==null)r.createEmbeddedView(this._template,new qR(o.item,this._ngForOf,-1,-1),s===null?void 0:s);else if(s==null)r.remove(i===null?void 0:i);else if(i!==null){let a=r.get(i);r.move(a,s),dW(a,o)}});for(let o=0,i=r.length;o<i;o++){let a=r.get(o).context;a.index=o,a.count=i,a.ngForOf=this._ngForOf}e.forEachIdentityChange(o=>{let i=r.get(o.currentIndex);dW(i,o)})}static ngTemplateContextGuard(e,r){return!0}static \u0275fac=function(r){return new(r||n)(Be(Rs),Be(ks),Be(V_))};static \u0275dir=yn({type:n,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}})}return n})();function dW(n,t){n.context.$implicit=t.item}var Ln=(()=>{class n{_viewContainer;_context=new KR;_thenTemplateRef=null;_elseTemplateRef=null;_thenViewRef=null;_elseViewRef=null;constructor(e,r){this._viewContainer=e,this._thenTemplateRef=r}set ngIf(e){this._context.$implicit=this._context.ngIf=e,this._updateView()}set ngIfThen(e){pW("ngIfThen",e),this._thenTemplateRef=e,this._thenViewRef=null,this._updateView()}set ngIfElse(e){pW("ngIfElse",e),this._elseTemplateRef=e,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngIfUseIfTypeGuard;static ngTemplateGuard_ngIf;static ngTemplateContextGuard(e,r){return!0}static \u0275fac=function(r){return new(r||n)(Be(Rs),Be(ks))};static \u0275dir=yn({type:n,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}})}return n})(),KR=class{$implicit=null;ngIf=null};function pW(n,t){if(!!!(!t||t.createEmbeddedView))throw new Error(`${n} must be a TemplateRef, but received '${ui(t)}'.`)}var eO="browser",Wye="server";function xW(n){return n===eO}function tO(n){return n===Wye}var vW=(()=>{class n{static \u0275prov=Me({token:n,providedIn:"root",factory:()=>new XR(Q(fn),window)})}return n})(),XR=class{document;window;offset=()=>[0,0];constructor(t,e){this.document=t,this.window=e}setOffset(t){Array.isArray(t)?this.offset=()=>t:this.offset=t}getScrollPosition(){return[this.window.scrollX,this.window.scrollY]}scrollToPosition(t){this.window.scrollTo(t[0],t[1])}scrollToAnchor(t){let e=Gye(this.document,t);e&&(this.scrollToElement(e),e.focus())}setHistoryScrollRestoration(t){this.window.history.scrollRestoration=t}scrollToElement(t){let e=t.getBoundingClientRect(),r=e.left+this.window.pageXOffset,o=e.top+this.window.pageYOffset,i=this.offset();this.window.scrollTo(r-i[0],o-i[1])}};function Gye(n,t){let e=n.getElementById(t)||n.getElementsByName(t)[0];if(e)return e;if(typeof n.createTreeWalker=="function"&&n.body&&typeof n.body.attachShadow=="function"){let r=n.createTreeWalker(n.body,NodeFilter.SHOW_ELEMENT),o=r.currentNode;for(;o;){let i=o.shadowRoot;if(i){let s=i.getElementById(t)||i.querySelector(`[name="${t}"]`);if(s)return s}o=r.nextNode()}}return null}var $g=class{};var g0=class{},G_=class{},Ah=class n{headers;normalizedNames=new Map;lazyInit;lazyUpdate=null;constructor(t){t?typeof t=="string"?this.lazyInit=()=>{this.headers=new Map,t.split(`
`).forEach(e=>{let r=e.indexOf(":");if(r>0){let o=e.slice(0,r),i=e.slice(r+1).trim();this.addHeaderEntry(o,i)}})}:typeof Headers<"u"&&t instanceof Headers?(this.headers=new Map,t.forEach((e,r)=>{this.addHeaderEntry(r,e)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(t).forEach(([e,r])=>{this.setHeaderEntries(e,r)})}:this.headers=new Map}has(t){return this.init(),this.headers.has(t.toLowerCase())}get(t){this.init();let e=this.headers.get(t.toLowerCase());return e&&e.length>0?e[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(t){return this.init(),this.headers.get(t.toLowerCase())||null}append(t,e){return this.clone({name:t,value:e,op:"a"})}set(t,e){return this.clone({name:t,value:e,op:"s"})}delete(t,e){return this.clone({name:t,value:e,op:"d"})}maybeSetNormalizedName(t,e){this.normalizedNames.has(e)||this.normalizedNames.set(e,t)}init(){this.lazyInit&&(this.lazyInit instanceof n?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(t=>this.applyUpdate(t)),this.lazyUpdate=null))}copyFrom(t){t.init(),Array.from(t.headers.keys()).forEach(e=>{this.headers.set(e,t.headers.get(e)),this.normalizedNames.set(e,t.normalizedNames.get(e))})}clone(t){let e=new n;return e.lazyInit=this.lazyInit&&this.lazyInit instanceof n?this.lazyInit:this,e.lazyUpdate=(this.lazyUpdate||[]).concat([t]),e}applyUpdate(t){let e=t.name.toLowerCase();switch(t.op){case"a":case"s":let r=t.value;if(typeof r=="string"&&(r=[r]),r.length===0)return;this.maybeSetNormalizedName(t.name,e);let o=(t.op==="a"?this.headers.get(e):void 0)||[];o.push(...r),this.headers.set(e,o);break;case"d":let i=t.value;if(!i)this.headers.delete(e),this.normalizedNames.delete(e);else{let s=this.headers.get(e);if(!s)return;s=s.filter(a=>i.indexOf(a)===-1),s.length===0?(this.headers.delete(e),this.normalizedNames.delete(e)):this.headers.set(e,s)}break}}addHeaderEntry(t,e){let r=t.toLowerCase();this.maybeSetNormalizedName(t,r),this.headers.has(r)?this.headers.get(r).push(e):this.headers.set(r,[e])}setHeaderEntries(t,e){let r=(Array.isArray(e)?e:[e]).map(i=>i.toString()),o=t.toLowerCase();this.headers.set(o,r),this.maybeSetNormalizedName(t,o)}forEach(t){this.init(),Array.from(this.normalizedNames.keys()).forEach(e=>t(this.normalizedNames.get(e),this.headers.get(e)))}};var rO=class{encodeKey(t){return wW(t)}encodeValue(t){return wW(t)}decodeKey(t){return decodeURIComponent(t)}decodeValue(t){return decodeURIComponent(t)}};function jye(n,t){let e=new Map;return n.length>0&&n.replace(/^\?/,"").split("&").forEach(o=>{let i=o.indexOf("="),[s,a]=i==-1?[t.decodeKey(o),""]:[t.decodeKey(o.slice(0,i)),t.decodeValue(o.slice(i+1))],l=e.get(s)||[];l.push(a),e.set(s,l)}),e}var Hye=/%(\d[a-f0-9])/gi,qye={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function wW(n){return encodeURIComponent(n).replace(Hye,(t,e)=>qye[e]??t)}function W_(n){return`${n}`}var xp=class n{map;encoder;updates=null;cloneFrom=null;constructor(t={}){if(this.encoder=t.encoder||new rO,t.fromString){if(t.fromObject)throw new nt(2805,!1);this.map=jye(t.fromString,this.encoder)}else t.fromObject?(this.map=new Map,Object.keys(t.fromObject).forEach(e=>{let r=t.fromObject[e],o=Array.isArray(r)?r.map(W_):[W_(r)];this.map.set(e,o)})):this.map=null}has(t){return this.init(),this.map.has(t)}get(t){this.init();let e=this.map.get(t);return e?e[0]:null}getAll(t){return this.init(),this.map.get(t)||null}keys(){return this.init(),Array.from(this.map.keys())}append(t,e){return this.clone({param:t,value:e,op:"a"})}appendAll(t){let e=[];return Object.keys(t).forEach(r=>{let o=t[r];Array.isArray(o)?o.forEach(i=>{e.push({param:r,value:i,op:"a"})}):e.push({param:r,value:o,op:"a"})}),this.clone(e)}set(t,e){return this.clone({param:t,value:e,op:"s"})}delete(t,e){return this.clone({param:t,value:e,op:"d"})}toString(){return this.init(),this.keys().map(t=>{let e=this.encoder.encodeKey(t);return this.map.get(t).map(r=>e+"="+this.encoder.encodeValue(r)).join("&")}).filter(t=>t!=="").join("&")}clone(t){let e=new n({encoder:this.encoder});return e.cloneFrom=this.cloneFrom||this,e.updates=(this.updates||[]).concat(t),e}init(){this.map===null&&(this.map=new Map),this.cloneFrom!==null&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(t=>this.map.set(t,this.cloneFrom.map.get(t))),this.updates.forEach(t=>{switch(t.op){case"a":case"s":let e=(t.op==="a"?this.map.get(t.param):void 0)||[];e.push(W_(t.value)),this.map.set(t.param,e);break;case"d":if(t.value!==void 0){let r=this.map.get(t.param)||[],o=r.indexOf(W_(t.value));o!==-1&&r.splice(o,1),r.length>0?this.map.set(t.param,r):this.map.delete(t.param)}else{this.map.delete(t.param);break}}}),this.cloneFrom=this.updates=null)}};var oO=class{map=new Map;set(t,e){return this.map.set(t,e),this}get(t){return this.map.has(t)||this.map.set(t,t.defaultValue()),this.map.get(t)}delete(t){return this.map.delete(t),this}has(t){return this.map.has(t)}keys(){return this.map.keys()}};function Kye(n){switch(n){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}function CW(n){return typeof ArrayBuffer<"u"&&n instanceof ArrayBuffer}function _W(n){return typeof Blob<"u"&&n instanceof Blob}function SW(n){return typeof FormData<"u"&&n instanceof FormData}function Xye(n){return typeof URLSearchParams<"u"&&n instanceof URLSearchParams}var IW="Content-Type",EW="Accept",kW="X-Request-URL",NW="text/plain",AW="application/json",Yye=`${AW}, ${NW}, */*`,m0=class n{url;body=null;headers;context;reportProgress=!1;withCredentials=!1;responseType="json";method;params;urlWithParams;transferCache;constructor(t,e,r,o){this.url=e,this.method=t.toUpperCase();let i;if(Kye(this.method)||o?(this.body=r!==void 0?r:null,i=o):i=r,i&&(this.reportProgress=!!i.reportProgress,this.withCredentials=!!i.withCredentials,i.responseType&&(this.responseType=i.responseType),i.headers&&(this.headers=i.headers),i.context&&(this.context=i.context),i.params&&(this.params=i.params),this.transferCache=i.transferCache),this.headers??=new Ah,this.context??=new oO,!this.params)this.params=new xp,this.urlWithParams=e;else{let s=this.params.toString();if(s.length===0)this.urlWithParams=e;else{let a=e.indexOf("?"),l=a===-1?"?":a<e.length-1?"&":"";this.urlWithParams=e+l+s}}}serializeBody(){return this.body===null?null:typeof this.body=="string"||CW(this.body)||_W(this.body)||SW(this.body)||Xye(this.body)?this.body:this.body instanceof xp?this.body.toString():typeof this.body=="object"||typeof this.body=="boolean"||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return this.body===null||SW(this.body)?null:_W(this.body)?this.body.type||null:CW(this.body)?null:typeof this.body=="string"?NW:this.body instanceof xp?"application/x-www-form-urlencoded;charset=UTF-8":typeof this.body=="object"||typeof this.body=="number"||typeof this.body=="boolean"?AW:null}clone(t={}){let e=t.method||this.method,r=t.url||this.url,o=t.responseType||this.responseType,i=t.transferCache??this.transferCache,s=t.body!==void 0?t.body:this.body,a=t.withCredentials??this.withCredentials,l=t.reportProgress??this.reportProgress,c=t.headers||this.headers,u=t.params||this.params,d=t.context??this.context;return t.setHeaders!==void 0&&(c=Object.keys(t.setHeaders).reduce((p,f)=>p.set(f,t.setHeaders[f]),c)),t.setParams&&(u=Object.keys(t.setParams).reduce((p,f)=>p.set(f,t.setParams[f]),u)),new n(e,r,s,{params:u,headers:c,context:d,reportProgress:l,responseType:o,withCredentials:a,transferCache:i})}},Vg=function(n){return n[n.Sent=0]="Sent",n[n.UploadProgress=1]="UploadProgress",n[n.ResponseHeader=2]="ResponseHeader",n[n.DownloadProgress=3]="DownloadProgress",n[n.Response=4]="Response",n[n.User=5]="User",n}(Vg||{}),y0=class{headers;status;statusText;url;ok;type;constructor(t,e=200,r="OK"){this.headers=t.headers||new Ah,this.status=t.status!==void 0?t.status:e,this.statusText=t.statusText||r,this.url=t.url||null,this.ok=this.status>=200&&this.status<300}},iO=class n extends y0{constructor(t={}){super(t)}type=Vg.ResponseHeader;clone(t={}){return new n({headers:t.headers||this.headers,status:t.status!==void 0?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}},j_=class n extends y0{body;constructor(t={}){super(t),this.body=t.body!==void 0?t.body:null}type=Vg.Response;clone(t={}){return new n({body:t.body!==void 0?t.body:this.body,headers:t.headers||this.headers,status:t.status!==void 0?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}},H_=class extends y0{name="HttpErrorResponse";message;error;ok=!1;constructor(t){super(t,0,"Unknown Error"),this.status>=200&&this.status<300?this.message=`Http failure during parsing for ${t.url||"(unknown url)"}`:this.message=`Http failure response for ${t.url||"(unknown url)"}: ${t.status} ${t.statusText}`,this.error=t.error||null}},Zye=200,Qye=204;function nO(n,t){return{body:t,headers:n.headers,context:n.context,observe:n.observe,params:n.params,reportProgress:n.reportProgress,responseType:n.responseType,withCredentials:n.withCredentials,transferCache:n.transferCache}}var Ea=(()=>{class n{handler;constructor(e){this.handler=e}request(e,r,o={}){let i;if(e instanceof m0)i=e;else{let l;o.headers instanceof Ah?l=o.headers:l=new Ah(o.headers);let c;o.params&&(o.params instanceof xp?c=o.params:c=new xp({fromObject:o.params})),i=new m0(e,r,o.body!==void 0?o.body:null,{headers:l,context:o.context,params:c,reportProgress:o.reportProgress,responseType:o.responseType||"json",withCredentials:o.withCredentials,transferCache:o.transferCache})}let s=ct(i).pipe($u(l=>this.handler.handle(l)));if(e instanceof m0||o.observe==="events")return s;let a=s.pipe(fr(l=>l instanceof j_));switch(o.observe||"body"){case"body":switch(i.responseType){case"arraybuffer":return a.pipe(Wt(l=>{if(l.body!==null&&!(l.body instanceof ArrayBuffer))throw new nt(2806,!1);return l.body}));case"blob":return a.pipe(Wt(l=>{if(l.body!==null&&!(l.body instanceof Blob))throw new nt(2807,!1);return l.body}));case"text":return a.pipe(Wt(l=>{if(l.body!==null&&typeof l.body!="string")throw new nt(2808,!1);return l.body}));case"json":default:return a.pipe(Wt(l=>l.body))}case"response":return a;default:throw new nt(2809,!1)}}delete(e,r={}){return this.request("DELETE",e,r)}get(e,r={}){return this.request("GET",e,r)}head(e,r={}){return this.request("HEAD",e,r)}jsonp(e,r){return this.request("JSONP",e,{params:new xp().append(r,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(e,r={}){return this.request("OPTIONS",e,r)}patch(e,r,o={}){return this.request("PATCH",e,nO(o,r))}post(e,r,o={}){return this.request("POST",e,nO(o,r))}put(e,r,o={}){return this.request("PUT",e,nO(o,r))}static \u0275fac=function(r){return new(r||n)(it(g0))};static \u0275prov=Me({token:n,factory:n.\u0275fac})}return n})();var Jye=new Ge("");function exe(n,t){return t(n)}function txe(n,t,e){return(r,o)=>Ai(e,()=>t(r,i=>n(i,o)))}var RW=new Ge(""),nxe=new Ge(""),rxe=new Ge("",{providedIn:"root",factory:()=>!0});var TW=(()=>{class n extends g0{backend;injector;chain=null;pendingTasks=Q(pp);contributeToStability=Q(rxe);constructor(e,r){super(),this.backend=e,this.injector=r}handle(e){if(this.chain===null){let r=Array.from(new Set([...this.injector.get(RW),...this.injector.get(nxe,[])]));this.chain=r.reduceRight((o,i)=>txe(o,i,this.injector),exe)}if(this.contributeToStability){let r=this.pendingTasks.add();return this.chain(e,o=>this.backend.handle(o)).pipe(xh(()=>this.pendingTasks.remove(r)))}else return this.chain(e,r=>this.backend.handle(r))}static \u0275fac=function(r){return new(r||n)(it(G_),it(lo))};static \u0275prov=Me({token:n,factory:n.\u0275fac})}return n})();var oxe=/^\)\]\}',?\n/,ixe=RegExp(`^${kW}:`,"m");function sxe(n){return"responseURL"in n&&n.responseURL?n.responseURL:ixe.test(n.getAllResponseHeaders())?n.getResponseHeader(kW):null}var DW=(()=>{class n{xhrFactory;constructor(e){this.xhrFactory=e}handle(e){if(e.method==="JSONP")throw new nt(-2800,!1);let r=this.xhrFactory;return(r.\u0275loadImpl?Hn(r.\u0275loadImpl()):ct(null)).pipe(li(()=>new on(i=>{let s=r.build();if(s.open(e.method,e.urlWithParams),e.withCredentials&&(s.withCredentials=!0),e.headers.forEach((m,g)=>s.setRequestHeader(m,g.join(","))),e.headers.has(EW)||s.setRequestHeader(EW,Yye),!e.headers.has(IW)){let m=e.detectContentTypeHeader();m!==null&&s.setRequestHeader(IW,m)}if(e.responseType){let m=e.responseType.toLowerCase();s.responseType=m!=="json"?m:"text"}let a=e.serializeBody(),l=null,c=()=>{if(l!==null)return l;let m=s.statusText||"OK",g=new Ah(s.getAllResponseHeaders()),y=sxe(s)||e.url;return l=new iO({headers:g,status:s.status,statusText:m,url:y}),l},u=()=>{let{headers:m,status:g,statusText:y,url:v}=c(),w=null;g!==Qye&&(w=typeof s.response>"u"?s.responseText:s.response),g===0&&(g=w?Zye:0);let C=g>=200&&g<300;if(e.responseType==="json"&&typeof w=="string"){let I=w;w=w.replace(oxe,"");try{w=w!==""?JSON.parse(w):null}catch(A){w=I,C&&(C=!1,w={error:A,text:w})}}C?(i.next(new j_({body:w,headers:m,status:g,statusText:y,url:v||void 0})),i.complete()):i.error(new H_({error:w,headers:m,status:g,statusText:y,url:v||void 0}))},d=m=>{let{url:g}=c(),y=new H_({error:m,status:s.status||0,statusText:s.statusText||"Unknown Error",url:g||void 0});i.error(y)},p=!1,f=m=>{p||(i.next(c()),p=!0);let g={type:Vg.DownloadProgress,loaded:m.loaded};m.lengthComputable&&(g.total=m.total),e.responseType==="text"&&s.responseText&&(g.partialText=s.responseText),i.next(g)},h=m=>{let g={type:Vg.UploadProgress,loaded:m.loaded};m.lengthComputable&&(g.total=m.total),i.next(g)};return s.addEventListener("load",u),s.addEventListener("error",d),s.addEventListener("timeout",d),s.addEventListener("abort",d),e.reportProgress&&(s.addEventListener("progress",f),a!==null&&s.upload&&s.upload.addEventListener("progress",h)),s.send(a),i.next({type:Vg.Sent}),()=>{s.removeEventListener("error",d),s.removeEventListener("abort",d),s.removeEventListener("load",u),s.removeEventListener("timeout",d),e.reportProgress&&(s.removeEventListener("progress",f),a!==null&&s.upload&&s.upload.removeEventListener("progress",h)),s.readyState!==s.DONE&&s.abort()}})))}static \u0275fac=function(r){return new(r||n)(it($g))};static \u0275prov=Me({token:n,factory:n.\u0275fac})}return n})(),OW=new Ge(""),axe="XSRF-TOKEN",lxe=new Ge("",{providedIn:"root",factory:()=>axe}),cxe="X-XSRF-TOKEN",uxe=new Ge("",{providedIn:"root",factory:()=>cxe}),q_=class{},dxe=(()=>{class n{doc;platform;cookieName;lastCookieString="";lastToken=null;parseCount=0;constructor(e,r,o){this.doc=e,this.platform=r,this.cookieName=o}getToken(){if(this.platform==="server")return null;let e=this.doc.cookie||"";return e!==this.lastCookieString&&(this.parseCount++,this.lastToken=U_(e,this.cookieName),this.lastCookieString=e),this.lastToken}static \u0275fac=function(r){return new(r||n)(it(fn),it(lc),it(lxe))};static \u0275prov=Me({token:n,factory:n.\u0275fac})}return n})();function pxe(n,t){let e=n.url.toLowerCase();if(!Q(OW)||n.method==="GET"||n.method==="HEAD"||e.startsWith("http://")||e.startsWith("https://"))return t(n);let r=Q(q_).getToken(),o=Q(uxe);return r!=null&&!n.headers.has(o)&&(n=n.clone({headers:n.headers.set(o,r)})),t(n)}function MW(...n){let t=[Ea,DW,TW,{provide:g0,useExisting:TW},{provide:G_,useFactory:()=>Q(Jye,{optional:!0})??Q(DW)},{provide:RW,useValue:pxe,multi:!0},{provide:OW,useValue:!0},{provide:q_,useClass:dxe}];for(let e of n)t.push(...e.\u0275providers);return Ng(t)}var aO=class extends z_{supportsDOMEvents=!0},lO=class n extends aO{static makeCurrent(){hW(new n)}onAndCancel(t,e,r,o){return t.addEventListener(e,r,o),()=>{t.removeEventListener(e,r,o)}}dispatchEvent(t,e){t.dispatchEvent(e)}remove(t){t.remove()}createElement(t,e){return e=e||this.getDefaultDocument(),e.createElement(t)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}isShadowRoot(t){return t instanceof DocumentFragment}getGlobalEventTarget(t,e){return e==="window"?window:e==="document"?t:e==="body"?t.body:null}getBaseHref(t){let e=fxe();return e==null?null:hxe(e)}resetBaseElement(){x0=null}getUserAgent(){return window.navigator.userAgent}getCookie(t){return U_(document.cookie,t)}},x0=null;function fxe(){return x0=x0||document.querySelector("base"),x0?x0.getAttribute("href"):null}function hxe(n){return new URL(n,document.baseURI).pathname}var mxe=(()=>{class n{build(){return new XMLHttpRequest}static \u0275fac=function(r){return new(r||n)};static \u0275prov=Me({token:n,factory:n.\u0275fac})}return n})(),cO=new Ge(""),zW=(()=>{class n{_zone;_plugins;_eventNameToPlugin=new Map;constructor(e,r){this._zone=r,e.forEach(o=>{o.manager=this}),this._plugins=e.slice().reverse()}addEventListener(e,r,o,i){return this._findPluginFor(r).addEventListener(e,r,o,i)}getZone(){return this._zone}_findPluginFor(e){let r=this._eventNameToPlugin.get(e);if(r)return r;if(r=this._plugins.find(i=>i.supports(e)),!r)throw new nt(5101,!1);return this._eventNameToPlugin.set(e,r),r}static \u0275fac=function(r){return new(r||n)(it(cO),it(ln))};static \u0275prov=Me({token:n,factory:n.\u0275fac})}return n})(),X_=class{_doc;constructor(t){this._doc=t}manager},K_="ng-app-id";function FW(n){for(let t of n)t.remove()}function LW(n,t){let e=t.createElement("style");return e.textContent=n,e}function gxe(n,t,e,r){let o=n.head?.querySelectorAll(`style[${K_}="${t}"],link[${K_}="${t}"]`);if(o)for(let i of o)i.removeAttribute(K_),i instanceof HTMLLinkElement?r.set(i.href.slice(i.href.lastIndexOf("/")+1),{usage:0,elements:[i]}):i.textContent&&e.set(i.textContent,{usage:0,elements:[i]})}function uO(n,t){let e=t.createElement("link");return e.setAttribute("rel","stylesheet"),e.setAttribute("href",n),e}var UW=(()=>{class n{doc;appId;nonce;inline=new Map;external=new Map;hosts=new Set;isServer;constructor(e,r,o,i={}){this.doc=e,this.appId=r,this.nonce=o,this.isServer=tO(i),gxe(e,r,this.inline,this.external),this.hosts.add(e.head)}addStyles(e,r){for(let o of e)this.addUsage(o,this.inline,LW);r?.forEach(o=>this.addUsage(o,this.external,uO))}removeStyles(e,r){for(let o of e)this.removeUsage(o,this.inline);r?.forEach(o=>this.removeUsage(o,this.external))}addUsage(e,r,o){let i=r.get(e);i?i.usage++:r.set(e,{usage:1,elements:[...this.hosts].map(s=>this.addElement(s,o(e,this.doc)))})}removeUsage(e,r){let o=r.get(e);o&&(o.usage--,o.usage<=0&&(FW(o.elements),r.delete(e)))}ngOnDestroy(){for(let[,{elements:e}]of[...this.inline,...this.external])FW(e);this.hosts.clear()}addHost(e){this.hosts.add(e);for(let[r,{elements:o}]of this.inline)o.push(this.addElement(e,LW(r,this.doc)));for(let[r,{elements:o}]of this.external)o.push(this.addElement(e,uO(r,this.doc)))}removeHost(e){this.hosts.delete(e)}addElement(e,r){return this.nonce&&r.setAttribute("nonce",this.nonce),this.isServer&&r.setAttribute(K_,this.appId),e.appendChild(r)}static \u0275fac=function(r){return new(r||n)(it(fn),it(d0),it(wR,8),it(lc))};static \u0275prov=Me({token:n,factory:n.\u0275fac})}return n})(),sO={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/Math/MathML"},pO=/%COMP%/g;var WW="%COMP%",yxe=`_nghost-${WW}`,xxe=`_ngcontent-${WW}`,vxe=!0,bxe=new Ge("",{providedIn:"root",factory:()=>vxe});function wxe(n){return xxe.replace(pO,n)}function Cxe(n){return yxe.replace(pO,n)}function GW(n,t){return t.map(e=>e.replace(pO,n))}var $W=(()=>{class n{eventManager;sharedStylesHost;appId;removeStylesOnCompDestroy;doc;platformId;ngZone;nonce;tracingService;rendererByCompId=new Map;defaultRenderer;platformIsServer;constructor(e,r,o,i,s,a,l,c=null,u=null){this.eventManager=e,this.sharedStylesHost=r,this.appId=o,this.removeStylesOnCompDestroy=i,this.doc=s,this.platformId=a,this.ngZone=l,this.nonce=c,this.tracingService=u,this.platformIsServer=tO(a),this.defaultRenderer=new v0(e,s,l,this.platformIsServer,this.tracingService)}createRenderer(e,r){if(!e||!r)return this.defaultRenderer;this.platformIsServer&&r.encapsulation===sc.ShadowDom&&(r=Ft(ke({},r),{encapsulation:sc.Emulated}));let o=this.getOrCreateRenderer(e,r);return o instanceof Y_?o.applyToHost(e):o instanceof b0&&o.applyStyles(),o}getOrCreateRenderer(e,r){let o=this.rendererByCompId,i=o.get(r.id);if(!i){let s=this.doc,a=this.ngZone,l=this.eventManager,c=this.sharedStylesHost,u=this.removeStylesOnCompDestroy,d=this.platformIsServer,p=this.tracingService;switch(r.encapsulation){case sc.Emulated:i=new Y_(l,c,r,this.appId,u,s,a,d,p);break;case sc.ShadowDom:return new dO(l,c,e,r,s,a,this.nonce,d,p);default:i=new b0(l,c,r,u,s,a,d,p);break}o.set(r.id,i)}return i}ngOnDestroy(){this.rendererByCompId.clear()}componentReplaced(e){this.rendererByCompId.delete(e)}static \u0275fac=function(r){return new(r||n)(it(zW),it(UW),it(d0),it(bxe),it(fn),it(lc),it(ln),it(wR),it(Mg,8))};static \u0275prov=Me({token:n,factory:n.\u0275fac})}return n})(),v0=class{eventManager;doc;ngZone;platformIsServer;tracingService;data=Object.create(null);throwOnSyntheticProps=!0;constructor(t,e,r,o,i){this.eventManager=t,this.doc=e,this.ngZone=r,this.platformIsServer=o,this.tracingService=i}destroy(){}destroyNode=null;createElement(t,e){return e?this.doc.createElementNS(sO[e]||e,t):this.doc.createElement(t)}createComment(t){return this.doc.createComment(t)}createText(t){return this.doc.createTextNode(t)}appendChild(t,e){(VW(t)?t.content:t).appendChild(e)}insertBefore(t,e,r){t&&(VW(t)?t.content:t).insertBefore(e,r)}removeChild(t,e){e.remove()}selectRootElement(t,e){let r=typeof t=="string"?this.doc.querySelector(t):t;if(!r)throw new nt(-5104,!1);return e||(r.textContent=""),r}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,e,r,o){if(o){e=o+":"+e;let i=sO[o];i?t.setAttributeNS(i,e,r):t.setAttribute(e,r)}else t.setAttribute(e,r)}removeAttribute(t,e,r){if(r){let o=sO[r];o?t.removeAttributeNS(o,e):t.removeAttribute(`${r}:${e}`)}else t.removeAttribute(e)}addClass(t,e){t.classList.add(e)}removeClass(t,e){t.classList.remove(e)}setStyle(t,e,r,o){o&(Hu.DashCase|Hu.Important)?t.style.setProperty(e,r,o&Hu.Important?"important":""):t.style[e]=r}removeStyle(t,e,r){r&Hu.DashCase?t.style.removeProperty(e):t.style[e]=""}setProperty(t,e,r){t!=null&&(t[e]=r)}setValue(t,e){t.nodeValue=e}listen(t,e,r,o){if(typeof t=="string"&&(t=ed().getGlobalEventTarget(this.doc,t),!t))throw new Error(`Unsupported event target ${t} for event ${e}`);let i=this.decoratePreventDefault(r);return this.tracingService!==null&&this.tracingService.wrapEventListener&&(i=this.tracingService.wrapEventListener(t,e,i)),this.eventManager.addEventListener(t,e,i,o)}decoratePreventDefault(t){return e=>{if(e==="__ngUnwrap__")return t;(this.platformIsServer?this.ngZone.runGuarded(()=>t(e)):t(e))===!1&&e.preventDefault()}}};function VW(n){return n.tagName==="TEMPLATE"&&n.content!==void 0}var dO=class extends v0{sharedStylesHost;hostEl;shadowRoot;constructor(t,e,r,o,i,s,a,l,c){super(t,i,s,l,c),this.sharedStylesHost=e,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let u=o.styles;u=GW(o.id,u);for(let p of u){let f=document.createElement("style");a&&f.setAttribute("nonce",a),f.textContent=p,this.shadowRoot.appendChild(f)}let d=o.getExternalStyles?.();if(d)for(let p of d){let f=uO(p,i);a&&f.setAttribute("nonce",a),this.shadowRoot.appendChild(f)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}appendChild(t,e){return super.appendChild(this.nodeOrShadowRoot(t),e)}insertBefore(t,e,r){return super.insertBefore(this.nodeOrShadowRoot(t),e,r)}removeChild(t,e){return super.removeChild(null,e)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},b0=class extends v0{sharedStylesHost;removeStylesOnCompDestroy;styles;styleUrls;constructor(t,e,r,o,i,s,a,l,c){super(t,i,s,a,l),this.sharedStylesHost=e,this.removeStylesOnCompDestroy=o;let u=r.styles;this.styles=c?GW(c,u):u,this.styleUrls=r.getExternalStyles?.(c)}applyStyles(){this.sharedStylesHost.addStyles(this.styles,this.styleUrls)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles,this.styleUrls)}},Y_=class extends b0{contentAttr;hostAttr;constructor(t,e,r,o,i,s,a,l,c){let u=o+"-"+r.id;super(t,e,r,i,s,a,l,c,u),this.contentAttr=wxe(u),this.hostAttr=Cxe(u)}applyToHost(t){this.applyStyles(),this.setAttribute(t,this.hostAttr,"")}createElement(t,e){let r=super.createElement(t,e);return super.setAttribute(r,this.contentAttr,""),r}},_xe=(()=>{class n extends X_{constructor(e){super(e)}supports(e){return!0}addEventListener(e,r,o,i){return e.addEventListener(r,o,i),()=>this.removeEventListener(e,r,o,i)}removeEventListener(e,r,o,i){return e.removeEventListener(r,o,i)}static \u0275fac=function(r){return new(r||n)(it(fn))};static \u0275prov=Me({token:n,factory:n.\u0275fac})}return n})(),BW=["alt","control","meta","shift"],Sxe={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Ixe={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey},Exe=(()=>{class n extends X_{constructor(e){super(e)}supports(e){return n.parseEventName(e)!=null}addEventListener(e,r,o,i){let s=n.parseEventName(r),a=n.eventCallback(s.fullKey,o,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>ed().onAndCancel(e,s.domEventName,a,i))}static parseEventName(e){let r=e.toLowerCase().split("."),o=r.shift();if(r.length===0||!(o==="keydown"||o==="keyup"))return null;let i=n._normalizeKey(r.pop()),s="",a=r.indexOf("code");if(a>-1&&(r.splice(a,1),s="code."),BW.forEach(c=>{let u=r.indexOf(c);u>-1&&(r.splice(u,1),s+=c+".")}),s+=i,r.length!=0||i.length===0)return null;let l={};return l.domEventName=o,l.fullKey=s,l}static matchEventFullKeyCode(e,r){let o=Sxe[e.key]||e.key,i="";return r.indexOf("code.")>-1&&(o=e.code,i="code."),o==null||!o?!1:(o=o.toLowerCase(),o===" "?o="space":o==="."&&(o="dot"),BW.forEach(s=>{if(s!==o){let a=Ixe[s];a(e)&&(i+=s+".")}}),i+=o,i===r)}static eventCallback(e,r,o){return i=>{n.matchEventFullKeyCode(i,e)&&o.runGuarded(()=>r(i))}}static _normalizeKey(e){return e==="esc"?"escape":e}static \u0275fac=function(r){return new(r||n)(it(fn))};static \u0275prov=Me({token:n,factory:n.\u0275fac})}return n})();function jW(n,t){return sW(ke({rootComponent:n},Txe(t)))}function Txe(n){return{appProviders:[...Rxe,...n?.providers??[]],platformProviders:Axe}}function Dxe(){lO.makeCurrent()}function kxe(){return new Gu}function Nxe(){return PU(document),document}var Axe=[{provide:lc,useValue:eO},{provide:bR,useValue:Dxe,multi:!0},{provide:fn,useFactory:Nxe,deps:[]}];var Rxe=[{provide:__,useValue:"root"},{provide:Gu,useFactory:kxe,deps:[]},{provide:cO,useClass:_xe,multi:!0,deps:[fn,ln,lc]},{provide:cO,useClass:Exe,multi:!0,deps:[fn]},$W,UW,zW,{provide:Ns,useExisting:$W},{provide:$g,useClass:mxe,deps:[]},[]];var HW=(()=>{class n{_doc;constructor(e){this._doc=e}getTitle(){return this._doc.title}setTitle(e){this._doc.title=e||""}static \u0275fac=function(r){return new(r||n)(it(fn))};static \u0275prov=Me({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var w0=(()=>{class n{static \u0275fac=function(r){return new(r||n)};static \u0275prov=Me({token:n,factory:function(r){let o=null;return r?o=new(r||n):o=it(Oxe),o},providedIn:"root"})}return n})(),Oxe=(()=>{class n extends w0{_doc;constructor(e){super(),this._doc=e}sanitize(e,r){if(r==null)return null;switch(e){case ba.NONE:return r;case ba.HTML:return Xu(r,"HTML")?As(r):SR(this._doc,String(r)).toString();case ba.STYLE:return Xu(r,"Style")?As(r):r;case ba.SCRIPT:if(Xu(r,"Script"))return As(r);throw new nt(5200,!1);case ba.URL:return Xu(r,"URL")?As(r):A_(String(r));case ba.RESOURCE_URL:if(Xu(r,"ResourceURL"))return As(r);throw new nt(5201,!1);default:throw new nt(5202,!1)}}bypassSecurityTrustHtml(e){return GU(e)}bypassSecurityTrustStyle(e){return jU(e)}bypassSecurityTrustScript(e){return HU(e)}bypassSecurityTrustUrl(e){return qU(e)}bypassSecurityTrustResourceUrl(e){return KU(e)}static \u0275fac=function(r){return new(r||n)(it(fn))};static \u0275prov=Me({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var Ht="primary",P0=Symbol("RouteTitle"),yO=class{params;constructor(t){this.params=t||{}}has(t){return Object.prototype.hasOwnProperty.call(this.params,t)}get(t){if(this.has(t)){let e=this.params[t];return Array.isArray(e)?e[0]:e}return null}getAll(t){if(this.has(t)){let e=this.params[t];return Array.isArray(e)?e:[e]}return[]}get keys(){return Object.keys(this.params)}};function jg(n){return new yO(n)}function Pxe(n,t,e){let r=e.path.split("/");if(r.length>n.length||e.pathMatch==="full"&&(t.hasChildren()||r.length<n.length))return null;let o={};for(let i=0;i<r.length;i++){let s=r[i],a=n[i];if(s[0]===":")o[s.substring(1)]=a;else if(s!==a.path)return null}return{consumed:n.slice(0,r.length),posParams:o}}function Fxe(n,t){if(n.length!==t.length)return!1;for(let e=0;e<n.length;++e)if(!pc(n[e],t[e]))return!1;return!0}function pc(n,t){let e=n?xO(n):void 0,r=t?xO(t):void 0;if(!e||!r||e.length!=r.length)return!1;let o;for(let i=0;i<e.length;i++)if(o=e[i],!nG(n[o],t[o]))return!1;return!0}function xO(n){return[...Object.keys(n),...Object.getOwnPropertySymbols(n)]}function nG(n,t){if(Array.isArray(n)&&Array.isArray(t)){if(n.length!==t.length)return!1;let e=[...n].sort(),r=[...t].sort();return e.every((o,i)=>r[i]===o)}else return n===t}function rG(n){return n.length>0?n[n.length-1]:null}function bp(n){return zv(n)?n:Nh(n)?Hn(Promise.resolve(n)):ct(n)}var Lxe={exact:iG,subset:sG},oG={exact:$xe,subset:Vxe,ignored:()=>!0};function qW(n,t,e){return Lxe[e.paths](n.root,t.root,e.matrixParams)&&oG[e.queryParams](n.queryParams,t.queryParams)&&!(e.fragment==="exact"&&n.fragment!==t.fragment)}function $xe(n,t){return pc(n,t)}function iG(n,t,e){if(!Oh(n.segments,t.segments)||!J_(n.segments,t.segments,e)||n.numberOfChildren!==t.numberOfChildren)return!1;for(let r in t.children)if(!n.children[r]||!iG(n.children[r],t.children[r],e))return!1;return!0}function Vxe(n,t){return Object.keys(t).length<=Object.keys(n).length&&Object.keys(t).every(e=>nG(n[e],t[e]))}function sG(n,t,e){return aG(n,t,t.segments,e)}function aG(n,t,e,r){if(n.segments.length>e.length){let o=n.segments.slice(0,e.length);return!(!Oh(o,e)||t.hasChildren()||!J_(o,e,r))}else if(n.segments.length===e.length){if(!Oh(n.segments,e)||!J_(n.segments,e,r))return!1;for(let o in t.children)if(!n.children[o]||!sG(n.children[o],t.children[o],r))return!1;return!0}else{let o=e.slice(0,n.segments.length),i=e.slice(n.segments.length);return!Oh(n.segments,o)||!J_(n.segments,o,r)||!n.children[Ht]?!1:aG(n.children[Ht],t,i,r)}}function J_(n,t,e){return t.every((r,o)=>oG[e](n[o].parameters,r.parameters))}var rd=class{root;queryParams;fragment;_queryParamMap;constructor(t=new $n([],{}),e={},r=null){this.root=t,this.queryParams=e,this.fragment=r}get queryParamMap(){return this._queryParamMap??=jg(this.queryParams),this._queryParamMap}toString(){return Uxe.serialize(this)}},$n=class{segments;children;parent=null;constructor(t,e){this.segments=t,this.children=e,Object.values(e).forEach(r=>r.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return eS(this)}},Rh=class{path;parameters;_parameterMap;constructor(t,e){this.path=t,this.parameters=e}get parameterMap(){return this._parameterMap??=jg(this.parameters),this._parameterMap}toString(){return cG(this)}};function Bxe(n,t){return Oh(n,t)&&n.every((e,r)=>pc(e.parameters,t[r].parameters))}function Oh(n,t){return n.length!==t.length?!1:n.every((e,r)=>e.path===t[r].path)}function zxe(n,t){let e=[];return Object.entries(n.children).forEach(([r,o])=>{r===Ht&&(e=e.concat(t(o,r)))}),Object.entries(n.children).forEach(([r,o])=>{r!==Ht&&(e=e.concat(t(o,r)))}),e}var F0=(()=>{class n{static \u0275fac=function(r){return new(r||n)};static \u0275prov=Me({token:n,factory:()=>new Hg,providedIn:"root"})}return n})(),Hg=class{parse(t){let e=new bO(t);return new rd(e.parseRootSegment(),e.parseQueryParams(),e.parseFragment())}serialize(t){let e=`/${C0(t.root,!0)}`,r=jxe(t.queryParams),o=typeof t.fragment=="string"?`#${Wxe(t.fragment)}`:"";return`${e}${r}${o}`}},Uxe=new Hg;function eS(n){return n.segments.map(t=>cG(t)).join("/")}function C0(n,t){if(!n.hasChildren())return eS(n);if(t){let e=n.children[Ht]?C0(n.children[Ht],!1):"",r=[];return Object.entries(n.children).forEach(([o,i])=>{o!==Ht&&r.push(`${o}:${C0(i,!1)}`)}),r.length>0?`${e}(${r.join("//")})`:e}else{let e=zxe(n,(r,o)=>o===Ht?[C0(n.children[Ht],!1)]:[`${o}:${C0(r,!1)}`]);return Object.keys(n.children).length===1&&n.children[Ht]!=null?`${eS(n)}/${e[0]}`:`${eS(n)}/(${e.join("//")})`}}function lG(n){return encodeURIComponent(n).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Z_(n){return lG(n).replace(/%3B/gi,";")}function Wxe(n){return encodeURI(n)}function vO(n){return lG(n).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function tS(n){return decodeURIComponent(n)}function KW(n){return tS(n.replace(/\+/g,"%20"))}function cG(n){return`${vO(n.path)}${Gxe(n.parameters)}`}function Gxe(n){return Object.entries(n).map(([t,e])=>`;${vO(t)}=${vO(e)}`).join("")}function jxe(n){let t=Object.entries(n).map(([e,r])=>Array.isArray(r)?r.map(o=>`${Z_(e)}=${Z_(o)}`).join("&"):`${Z_(e)}=${Z_(r)}`).filter(e=>e);return t.length?`?${t.join("&")}`:""}var Hxe=/^[^\/()?;#]+/;function fO(n){let t=n.match(Hxe);return t?t[0]:""}var qxe=/^[^\/()?;=#]+/;function Kxe(n){let t=n.match(qxe);return t?t[0]:""}var Xxe=/^[^=?&#]+/;function Yxe(n){let t=n.match(Xxe);return t?t[0]:""}var Zxe=/^[^&#]+/;function Qxe(n){let t=n.match(Zxe);return t?t[0]:""}var bO=class{url;remaining;constructor(t){this.url=t,this.remaining=t}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new $n([],{}):new $n([],this.parseChildren())}parseQueryParams(){let t={};if(this.consumeOptional("?"))do this.parseQueryParam(t);while(this.consumeOptional("&"));return t}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let t=[];for(this.peekStartsWith("(")||t.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),t.push(this.parseSegment());let e={};this.peekStartsWith("/(")&&(this.capture("/"),e=this.parseParens(!0));let r={};return this.peekStartsWith("(")&&(r=this.parseParens(!1)),(t.length>0||Object.keys(e).length>0)&&(r[Ht]=new $n(t,e)),r}parseSegment(){let t=fO(this.remaining);if(t===""&&this.peekStartsWith(";"))throw new nt(4009,!1);return this.capture(t),new Rh(tS(t),this.parseMatrixParams())}parseMatrixParams(){let t={};for(;this.consumeOptional(";");)this.parseParam(t);return t}parseParam(t){let e=Kxe(this.remaining);if(!e)return;this.capture(e);let r="";if(this.consumeOptional("=")){let o=fO(this.remaining);o&&(r=o,this.capture(r))}t[tS(e)]=tS(r)}parseQueryParam(t){let e=Yxe(this.remaining);if(!e)return;this.capture(e);let r="";if(this.consumeOptional("=")){let s=Qxe(this.remaining);s&&(r=s,this.capture(r))}let o=KW(e),i=KW(r);if(t.hasOwnProperty(o)){let s=t[o];Array.isArray(s)||(s=[s],t[o]=s),s.push(i)}else t[o]=i}parseParens(t){let e={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let r=fO(this.remaining),o=this.remaining[r.length];if(o!=="/"&&o!==")"&&o!==";")throw new nt(4010,!1);let i;r.indexOf(":")>-1?(i=r.slice(0,r.indexOf(":")),this.capture(i),this.capture(":")):t&&(i=Ht);let s=this.parseChildren();e[i]=Object.keys(s).length===1?s[Ht]:new $n([],s),this.consumeOptional("//")}return e}peekStartsWith(t){return this.remaining.startsWith(t)}consumeOptional(t){return this.peekStartsWith(t)?(this.remaining=this.remaining.substring(t.length),!0):!1}capture(t){if(!this.consumeOptional(t))throw new nt(4011,!1)}};function uG(n){return n.segments.length>0?new $n([],{[Ht]:n}):n}function dG(n){let t={};for(let[r,o]of Object.entries(n.children)){let i=dG(o);if(r===Ht&&i.segments.length===0&&i.hasChildren())for(let[s,a]of Object.entries(i.children))t[s]=a;else(i.segments.length>0||i.hasChildren())&&(t[r]=i)}let e=new $n(n.segments,t);return Jxe(e)}function Jxe(n){if(n.numberOfChildren===1&&n.children[Ht]){let t=n.children[Ht];return new $n(n.segments.concat(t.segments),t.children)}return n}function Mh(n){return n instanceof rd}function eve(n,t,e=null,r=null){let o=pG(n);return fG(o,t,e,r)}function pG(n){let t;function e(i){let s={};for(let l of i.children){let c=e(l);s[l.outlet]=c}let a=new $n(i.url,s);return i===n&&(t=a),a}let r=e(n.root),o=uG(r);return t??o}function fG(n,t,e,r){let o=n;for(;o.parent;)o=o.parent;if(t.length===0)return hO(o,o,o,e,r);let i=tve(t);if(i.toRoot())return hO(o,o,new $n([],{}),e,r);let s=nve(i,o,n),a=s.processChildren?S0(s.segmentGroup,s.index,i.commands):mG(s.segmentGroup,s.index,i.commands);return hO(o,s.segmentGroup,a,e,r)}function nS(n){return typeof n=="object"&&n!=null&&!n.outlets&&!n.segmentPath}function T0(n){return typeof n=="object"&&n!=null&&n.outlets}function hO(n,t,e,r,o){let i={};r&&Object.entries(r).forEach(([l,c])=>{i[l]=Array.isArray(c)?c.map(u=>`${u}`):`${c}`});let s;n===t?s=e:s=hG(n,t,e);let a=uG(dG(s));return new rd(a,i,o)}function hG(n,t,e){let r={};return Object.entries(n.children).forEach(([o,i])=>{i===t?r[o]=e:r[o]=hG(i,t,e)}),new $n(n.segments,r)}var rS=class{isAbsolute;numberOfDoubleDots;commands;constructor(t,e,r){if(this.isAbsolute=t,this.numberOfDoubleDots=e,this.commands=r,t&&r.length>0&&nS(r[0]))throw new nt(4003,!1);let o=r.find(T0);if(o&&o!==rG(r))throw new nt(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function tve(n){if(typeof n[0]=="string"&&n.length===1&&n[0]==="/")return new rS(!0,0,n);let t=0,e=!1,r=n.reduce((o,i,s)=>{if(typeof i=="object"&&i!=null){if(i.outlets){let a={};return Object.entries(i.outlets).forEach(([l,c])=>{a[l]=typeof c=="string"?c.split("/"):c}),[...o,{outlets:a}]}if(i.segmentPath)return[...o,i.segmentPath]}return typeof i!="string"?[...o,i]:s===0?(i.split("/").forEach((a,l)=>{l==0&&a==="."||(l==0&&a===""?e=!0:a===".."?t++:a!=""&&o.push(a))}),o):[...o,i]},[]);return new rS(e,t,r)}var Ug=class{segmentGroup;processChildren;index;constructor(t,e,r){this.segmentGroup=t,this.processChildren=e,this.index=r}};function nve(n,t,e){if(n.isAbsolute)return new Ug(t,!0,0);if(!e)return new Ug(t,!1,NaN);if(e.parent===null)return new Ug(e,!0,0);let r=nS(n.commands[0])?0:1,o=e.segments.length-1+r;return rve(e,o,n.numberOfDoubleDots)}function rve(n,t,e){let r=n,o=t,i=e;for(;i>o;){if(i-=o,r=r.parent,!r)throw new nt(4005,!1);o=r.segments.length}return new Ug(r,!1,o-i)}function ove(n){return T0(n[0])?n[0].outlets:{[Ht]:n}}function mG(n,t,e){if(n??=new $n([],{}),n.segments.length===0&&n.hasChildren())return S0(n,t,e);let r=ive(n,t,e),o=e.slice(r.commandIndex);if(r.match&&r.pathIndex<n.segments.length){let i=new $n(n.segments.slice(0,r.pathIndex),{});return i.children[Ht]=new $n(n.segments.slice(r.pathIndex),n.children),S0(i,0,o)}else return r.match&&o.length===0?new $n(n.segments,{}):r.match&&!n.hasChildren()?wO(n,t,e):r.match?S0(n,0,o):wO(n,t,e)}function S0(n,t,e){if(e.length===0)return new $n(n.segments,{});{let r=ove(e),o={};if(Object.keys(r).some(i=>i!==Ht)&&n.children[Ht]&&n.numberOfChildren===1&&n.children[Ht].segments.length===0){let i=S0(n.children[Ht],t,e);return new $n(n.segments,i.children)}return Object.entries(r).forEach(([i,s])=>{typeof s=="string"&&(s=[s]),s!==null&&(o[i]=mG(n.children[i],t,s))}),Object.entries(n.children).forEach(([i,s])=>{r[i]===void 0&&(o[i]=s)}),new $n(n.segments,o)}}function ive(n,t,e){let r=0,o=t,i={match:!1,pathIndex:0,commandIndex:0};for(;o<n.segments.length;){if(r>=e.length)return i;let s=n.segments[o],a=e[r];if(T0(a))break;let l=`${a}`,c=r<e.length-1?e[r+1]:null;if(o>0&&l===void 0)break;if(l&&c&&typeof c=="object"&&c.outlets===void 0){if(!YW(l,c,s))return i;r+=2}else{if(!YW(l,{},s))return i;r++}o++}return{match:!0,pathIndex:o,commandIndex:r}}function wO(n,t,e){let r=n.segments.slice(0,t),o=0;for(;o<e.length;){let i=e[o];if(T0(i)){let l=sve(i.outlets);return new $n(r,l)}if(o===0&&nS(e[0])){let l=n.segments[t];r.push(new Rh(l.path,XW(e[0]))),o++;continue}let s=T0(i)?i.outlets[Ht]:`${i}`,a=o<e.length-1?e[o+1]:null;s&&a&&nS(a)?(r.push(new Rh(s,XW(a))),o+=2):(r.push(new Rh(s,{})),o++)}return new $n(r,{})}function sve(n){let t={};return Object.entries(n).forEach(([e,r])=>{typeof r=="string"&&(r=[r]),r!==null&&(t[e]=wO(new $n([],{}),0,r))}),t}function XW(n){let t={};return Object.entries(n).forEach(([e,r])=>t[e]=`${r}`),t}function YW(n,t,e){return n==e.path&&pc(t,e.parameters)}var I0="imperative",yo=function(n){return n[n.NavigationStart=0]="NavigationStart",n[n.NavigationEnd=1]="NavigationEnd",n[n.NavigationCancel=2]="NavigationCancel",n[n.NavigationError=3]="NavigationError",n[n.RoutesRecognized=4]="RoutesRecognized",n[n.ResolveStart=5]="ResolveStart",n[n.ResolveEnd=6]="ResolveEnd",n[n.GuardsCheckStart=7]="GuardsCheckStart",n[n.GuardsCheckEnd=8]="GuardsCheckEnd",n[n.RouteConfigLoadStart=9]="RouteConfigLoadStart",n[n.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",n[n.ChildActivationStart=11]="ChildActivationStart",n[n.ChildActivationEnd=12]="ChildActivationEnd",n[n.ActivationStart=13]="ActivationStart",n[n.ActivationEnd=14]="ActivationEnd",n[n.Scroll=15]="Scroll",n[n.NavigationSkipped=16]="NavigationSkipped",n}(yo||{}),Ms=class{id;url;constructor(t,e){this.id=t,this.url=e}},qg=class extends Ms{type=yo.NavigationStart;navigationTrigger;restoredState;constructor(t,e,r="imperative",o=null){super(t,e),this.navigationTrigger=r,this.restoredState=o}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},Da=class extends Ms{urlAfterRedirects;type=yo.NavigationEnd;constructor(t,e,r){super(t,e),this.urlAfterRedirects=r}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},ds=function(n){return n[n.Redirect=0]="Redirect",n[n.SupersededByNewNavigation=1]="SupersededByNewNavigation",n[n.NoDataFromResolver=2]="NoDataFromResolver",n[n.GuardRejected=3]="GuardRejected",n}(ds||{}),oS=function(n){return n[n.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",n[n.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",n}(oS||{}),nd=class extends Ms{reason;code;type=yo.NavigationCancel;constructor(t,e,r,o){super(t,e),this.reason=r,this.code=o}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},vp=class extends Ms{reason;code;type=yo.NavigationSkipped;constructor(t,e,r,o){super(t,e),this.reason=r,this.code=o}},D0=class extends Ms{error;target;type=yo.NavigationError;constructor(t,e,r,o){super(t,e),this.error=r,this.target=o}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},iS=class extends Ms{urlAfterRedirects;state;type=yo.RoutesRecognized;constructor(t,e,r,o){super(t,e),this.urlAfterRedirects=r,this.state=o}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},CO=class extends Ms{urlAfterRedirects;state;type=yo.GuardsCheckStart;constructor(t,e,r,o){super(t,e),this.urlAfterRedirects=r,this.state=o}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},_O=class extends Ms{urlAfterRedirects;state;shouldActivate;type=yo.GuardsCheckEnd;constructor(t,e,r,o,i){super(t,e),this.urlAfterRedirects=r,this.state=o,this.shouldActivate=i}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},SO=class extends Ms{urlAfterRedirects;state;type=yo.ResolveStart;constructor(t,e,r,o){super(t,e),this.urlAfterRedirects=r,this.state=o}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},IO=class extends Ms{urlAfterRedirects;state;type=yo.ResolveEnd;constructor(t,e,r,o){super(t,e),this.urlAfterRedirects=r,this.state=o}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},EO=class{route;type=yo.RouteConfigLoadStart;constructor(t){this.route=t}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},TO=class{route;type=yo.RouteConfigLoadEnd;constructor(t){this.route=t}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},DO=class{snapshot;type=yo.ChildActivationStart;constructor(t){this.snapshot=t}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},kO=class{snapshot;type=yo.ChildActivationEnd;constructor(t){this.snapshot=t}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},NO=class{snapshot;type=yo.ActivationStart;constructor(t){this.snapshot=t}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},AO=class{snapshot;type=yo.ActivationEnd;constructor(t){this.snapshot=t}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},sS=class{routerEvent;position;anchor;type=yo.Scroll;constructor(t,e,r){this.routerEvent=t,this.position=e,this.anchor=r}toString(){let t=this.position?`${this.position[0]}, ${this.position[1]}`:null;return`Scroll(anchor: '${this.anchor}', position: '${t}')`}},k0=class{},Kg=class{url;navigationBehaviorOptions;constructor(t,e){this.url=t,this.navigationBehaviorOptions=e}};function ave(n,t){return n.providers&&!n._injector&&(n._injector=P_(n.providers,t,`Route: ${n.path}`)),n._injector??t}function Ta(n){return n.outlet||Ht}function lve(n,t){let e=n.filter(r=>Ta(r)===t);return e.push(...n.filter(r=>Ta(r)!==t)),e}function L0(n){if(!n)return null;if(n.routeConfig?._injector)return n.routeConfig._injector;for(let t=n.parent;t;t=t.parent){let e=t.routeConfig;if(e?._loadedInjector)return e._loadedInjector;if(e?._injector)return e._injector}return null}var RO=class{rootInjector;outlet=null;route=null;children;attachRef=null;get injector(){return L0(this.route?.snapshot)??this.rootInjector}constructor(t){this.rootInjector=t,this.children=new $0(this.rootInjector)}},$0=(()=>{class n{rootInjector;contexts=new Map;constructor(e){this.rootInjector=e}onChildOutletCreated(e,r){let o=this.getOrCreateContext(e);o.outlet=r,this.contexts.set(e,o)}onChildOutletDestroyed(e){let r=this.getContext(e);r&&(r.outlet=null,r.attachRef=null)}onOutletDeactivated(){let e=this.contexts;return this.contexts=new Map,e}onOutletReAttached(e){this.contexts=e}getOrCreateContext(e){let r=this.getContext(e);return r||(r=new RO(this.rootInjector),this.contexts.set(e,r)),r}getContext(e){return this.contexts.get(e)||null}static \u0275fac=function(r){return new(r||n)(it(lo))};static \u0275prov=Me({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),aS=class{_root;constructor(t){this._root=t}get root(){return this._root.value}parent(t){let e=this.pathFromRoot(t);return e.length>1?e[e.length-2]:null}children(t){let e=OO(t,this._root);return e?e.children.map(r=>r.value):[]}firstChild(t){let e=OO(t,this._root);return e&&e.children.length>0?e.children[0].value:null}siblings(t){let e=MO(t,this._root);return e.length<2?[]:e[e.length-2].children.map(o=>o.value).filter(o=>o!==t)}pathFromRoot(t){return MO(t,this._root).map(e=>e.value)}};function OO(n,t){if(n===t.value)return t;for(let e of t.children){let r=OO(n,e);if(r)return r}return null}function MO(n,t){if(n===t.value)return[t];for(let e of t.children){let r=MO(n,e);if(r.length)return r.unshift(t),r}return[]}var us=class{value;children;constructor(t,e){this.value=t,this.children=e}toString(){return`TreeNode(${this.value})`}};function zg(n){let t={};return n&&n.children.forEach(e=>t[e.value.outlet]=e),t}var lS=class extends aS{snapshot;constructor(t,e){super(t),this.snapshot=e,WO(this,t)}toString(){return this.snapshot.toString()}};function gG(n){let t=cve(n),e=new Wr([new Rh("",{})]),r=new Wr({}),o=new Wr({}),i=new Wr({}),s=new Wr(""),a=new jo(e,r,i,s,o,Ht,n,t.root);return a.snapshot=t.root,new lS(new us(a,[]),t)}function cve(n){let t={},e={},r={},o="",i=new Wg([],t,r,o,e,Ht,n,null,{});return new uS("",new us(i,[]))}var jo=class{urlSubject;paramsSubject;queryParamsSubject;fragmentSubject;dataSubject;outlet;component;snapshot;_futureSnapshot;_routerState;_paramMap;_queryParamMap;title;url;params;queryParams;fragment;data;constructor(t,e,r,o,i,s,a,l){this.urlSubject=t,this.paramsSubject=e,this.queryParamsSubject=r,this.fragmentSubject=o,this.dataSubject=i,this.outlet=s,this.component=a,this._futureSnapshot=l,this.title=this.dataSubject?.pipe(Wt(c=>c[P0]))??ct(void 0),this.url=t,this.params=e,this.queryParams=r,this.fragment=o,this.data=i}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(Wt(t=>jg(t))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(Wt(t=>jg(t))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function cS(n,t,e="emptyOnly"){let r,{routeConfig:o}=n;return t!==null&&(e==="always"||o?.path===""||!t.component&&!t.routeConfig?.loadComponent)?r={params:ke(ke({},t.params),n.params),data:ke(ke({},t.data),n.data),resolve:ke(ke(ke(ke({},n.data),t.data),o?.data),n._resolvedData)}:r={params:ke({},n.params),data:ke({},n.data),resolve:ke(ke({},n.data),n._resolvedData??{})},o&&xG(o)&&(r.resolve[P0]=o.title),r}var Wg=class{url;params;queryParams;fragment;data;outlet;component;routeConfig;_resolve;_resolvedData;_routerState;_paramMap;_queryParamMap;get title(){return this.data?.[P0]}constructor(t,e,r,o,i,s,a,l,c){this.url=t,this.params=e,this.queryParams=r,this.fragment=o,this.data=i,this.outlet=s,this.component=a,this.routeConfig=l,this._resolve=c}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=jg(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=jg(this.queryParams),this._queryParamMap}toString(){let t=this.url.map(r=>r.toString()).join("/"),e=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${t}', path:'${e}')`}},uS=class extends aS{url;constructor(t,e){super(e),this.url=t,WO(this,e)}toString(){return yG(this._root)}};function WO(n,t){t.value._routerState=n,t.children.forEach(e=>WO(n,e))}function yG(n){let t=n.children.length>0?` { ${n.children.map(yG).join(", ")} } `:"";return`${n.value}${t}`}function mO(n){if(n.snapshot){let t=n.snapshot,e=n._futureSnapshot;n.snapshot=e,pc(t.queryParams,e.queryParams)||n.queryParamsSubject.next(e.queryParams),t.fragment!==e.fragment&&n.fragmentSubject.next(e.fragment),pc(t.params,e.params)||n.paramsSubject.next(e.params),Fxe(t.url,e.url)||n.urlSubject.next(e.url),pc(t.data,e.data)||n.dataSubject.next(e.data)}else n.snapshot=n._futureSnapshot,n.dataSubject.next(n._futureSnapshot.data)}function PO(n,t){let e=pc(n.params,t.params)&&Bxe(n.url,t.url),r=!n.parent!=!t.parent;return e&&!r&&(!n.parent||PO(n.parent,t.parent))}function xG(n){return typeof n.title=="string"||n.title===null}var uve=new Ge(""),GO=(()=>{class n{activated=null;get activatedComponentRef(){return this.activated}_activatedRoute=null;name=Ht;activateEvents=new Un;deactivateEvents=new Un;attachEvents=new Un;detachEvents=new Un;routerOutletData=EU(void 0);parentContexts=Q($0);location=Q(Rs);changeDetector=Q(Sa);inputBinder=Q(hS,{optional:!0});supportsBindingToComponentInputs=!0;ngOnChanges(e){if(e.name){let{firstChange:r,previousValue:o}=e.name;if(r)return;this.isTrackedInParentContexts(o)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(o)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(e){return this.parentContexts.getContext(e)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let e=this.parentContexts.getContext(this.name);e?.route&&(e.attachRef?this.attach(e.attachRef,e.route):this.activateWith(e.route,e.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new nt(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new nt(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new nt(4012,!1);this.location.detach();let e=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(e.instance),e}attach(e,r){this.activated=e,this._activatedRoute=r,this.location.insert(e.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(e.instance)}deactivate(){if(this.activated){let e=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(e)}}activateWith(e,r){if(this.isActivated)throw new nt(4013,!1);this._activatedRoute=e;let o=this.location,s=e.snapshot.component,a=this.parentContexts.getOrCreateContext(this.name).children,l=new FO(e,a,o.injector,this.routerOutletData);this.activated=o.createComponent(s,{index:o.length,injector:l,environmentInjector:r}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static \u0275fac=function(r){return new(r||n)};static \u0275dir=yn({type:n,selectors:[["router-outlet"]],inputs:{name:"name",routerOutletData:[1,"routerOutletData"]},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],features:[Ri]})}return n})(),FO=class n{route;childContexts;parent;outletData;__ngOutletInjector(t){return new n(this.route,this.childContexts,t,this.outletData)}constructor(t,e,r,o){this.route=t,this.childContexts=e,this.parent=r,this.outletData=o}get(t,e){return t===jo?this.route:t===$0?this.childContexts:t===uve?this.outletData:this.parent.get(t,e)}},hS=new Ge(""),ZW=(()=>{class n{outletDataSubscriptions=new Map;bindActivatedRouteToOutletComponent(e){this.unsubscribeFromRouteData(e),this.subscribeToRouteData(e)}unsubscribeFromRouteData(e){this.outletDataSubscriptions.get(e)?.unsubscribe(),this.outletDataSubscriptions.delete(e)}subscribeToRouteData(e){let{activatedRoute:r}=e,o=Uv([r.queryParams,r.params,r.data]).pipe(li(([i,s,a],l)=>(a=ke(ke(ke({},i),s),a),l===0?ct(a):Promise.resolve(a)))).subscribe(i=>{if(!e.isActivated||!e.activatedComponentRef||e.activatedRoute!==r||r.component===null){this.unsubscribeFromRouteData(e);return}let s=aW(r.component);if(!s){this.unsubscribeFromRouteData(e);return}for(let{templateName:a}of s.inputs)e.activatedComponentRef.setInput(a,i[a])});this.outletDataSubscriptions.set(e,o)}static \u0275fac=function(r){return new(r||n)};static \u0275prov=Me({token:n,factory:n.\u0275fac})}return n})();function dve(n,t,e){let r=N0(n,t._root,e?e._root:void 0);return new lS(r,t)}function N0(n,t,e){if(e&&n.shouldReuseRoute(t.value,e.value.snapshot)){let r=e.value;r._futureSnapshot=t.value;let o=pve(n,t,e);return new us(r,o)}else{if(n.shouldAttach(t.value)){let i=n.retrieve(t.value);if(i!==null){let s=i.route;return s.value._futureSnapshot=t.value,s.children=t.children.map(a=>N0(n,a)),s}}let r=fve(t.value),o=t.children.map(i=>N0(n,i));return new us(r,o)}}function pve(n,t,e){return t.children.map(r=>{for(let o of e.children)if(n.shouldReuseRoute(r.value,o.value.snapshot))return N0(n,r,o);return N0(n,r)})}function fve(n){return new jo(new Wr(n.url),new Wr(n.params),new Wr(n.queryParams),new Wr(n.fragment),new Wr(n.data),n.outlet,n.component,n)}var A0=class{redirectTo;navigationBehaviorOptions;constructor(t,e){this.redirectTo=t,this.navigationBehaviorOptions=e}},vG="ngNavigationCancelingError";function dS(n,t){let{redirectTo:e,navigationBehaviorOptions:r}=Mh(t)?{redirectTo:t,navigationBehaviorOptions:void 0}:t,o=bG(!1,ds.Redirect);return o.url=e,o.navigationBehaviorOptions=r,o}function bG(n,t){let e=new Error(`NavigationCancelingError: ${n||""}`);return e[vG]=!0,e.cancellationCode=t,e}function hve(n){return wG(n)&&Mh(n.url)}function wG(n){return!!n&&n[vG]}var mve=(n,t,e,r)=>Wt(o=>(new LO(t,o.targetRouterState,o.currentRouterState,e,r).activate(n),o)),LO=class{routeReuseStrategy;futureState;currState;forwardEvent;inputBindingEnabled;constructor(t,e,r,o,i){this.routeReuseStrategy=t,this.futureState=e,this.currState=r,this.forwardEvent=o,this.inputBindingEnabled=i}activate(t){let e=this.futureState._root,r=this.currState?this.currState._root:null;this.deactivateChildRoutes(e,r,t),mO(this.futureState.root),this.activateChildRoutes(e,r,t)}deactivateChildRoutes(t,e,r){let o=zg(e);t.children.forEach(i=>{let s=i.value.outlet;this.deactivateRoutes(i,o[s],r),delete o[s]}),Object.values(o).forEach(i=>{this.deactivateRouteAndItsChildren(i,r)})}deactivateRoutes(t,e,r){let o=t.value,i=e?e.value:null;if(o===i)if(o.component){let s=r.getContext(o.outlet);s&&this.deactivateChildRoutes(t,e,s.children)}else this.deactivateChildRoutes(t,e,r);else i&&this.deactivateRouteAndItsChildren(e,r)}deactivateRouteAndItsChildren(t,e){t.value.component&&this.routeReuseStrategy.shouldDetach(t.value.snapshot)?this.detachAndStoreRouteSubtree(t,e):this.deactivateRouteAndOutlet(t,e)}detachAndStoreRouteSubtree(t,e){let r=e.getContext(t.value.outlet),o=r&&t.value.component?r.children:e,i=zg(t);for(let s of Object.values(i))this.deactivateRouteAndItsChildren(s,o);if(r&&r.outlet){let s=r.outlet.detach(),a=r.children.onOutletDeactivated();this.routeReuseStrategy.store(t.value.snapshot,{componentRef:s,route:t,contexts:a})}}deactivateRouteAndOutlet(t,e){let r=e.getContext(t.value.outlet),o=r&&t.value.component?r.children:e,i=zg(t);for(let s of Object.values(i))this.deactivateRouteAndItsChildren(s,o);r&&(r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated()),r.attachRef=null,r.route=null)}activateChildRoutes(t,e,r){let o=zg(e);t.children.forEach(i=>{this.activateRoutes(i,o[i.value.outlet],r),this.forwardEvent(new AO(i.value.snapshot))}),t.children.length&&this.forwardEvent(new kO(t.value.snapshot))}activateRoutes(t,e,r){let o=t.value,i=e?e.value:null;if(mO(o),o===i)if(o.component){let s=r.getOrCreateContext(o.outlet);this.activateChildRoutes(t,e,s.children)}else this.activateChildRoutes(t,e,r);else if(o.component){let s=r.getOrCreateContext(o.outlet);if(this.routeReuseStrategy.shouldAttach(o.snapshot)){let a=this.routeReuseStrategy.retrieve(o.snapshot);this.routeReuseStrategy.store(o.snapshot,null),s.children.onOutletReAttached(a.contexts),s.attachRef=a.componentRef,s.route=a.route.value,s.outlet&&s.outlet.attach(a.componentRef,a.route.value),mO(a.route.value),this.activateChildRoutes(t,null,s.children)}else s.attachRef=null,s.route=o,s.outlet&&s.outlet.activateWith(o,s.injector),this.activateChildRoutes(t,null,s.children)}else this.activateChildRoutes(t,null,r)}},pS=class{path;route;constructor(t){this.path=t,this.route=this.path[this.path.length-1]}},Gg=class{component;route;constructor(t,e){this.component=t,this.route=e}};function gve(n,t,e){let r=n._root,o=t?t._root:null;return _0(r,o,e,[r.value])}function yve(n){let t=n.routeConfig?n.routeConfig.canActivateChild:null;return!t||t.length===0?null:{node:n,guards:t}}function Yg(n,t){let e=Symbol(),r=t.get(n,e);return r===e?typeof n=="function"&&!vz(n)?n:t.get(n):r}function _0(n,t,e,r,o={canDeactivateChecks:[],canActivateChecks:[]}){let i=zg(t);return n.children.forEach(s=>{xve(s,i[s.value.outlet],e,r.concat([s.value]),o),delete i[s.value.outlet]}),Object.entries(i).forEach(([s,a])=>E0(a,e.getContext(s),o)),o}function xve(n,t,e,r,o={canDeactivateChecks:[],canActivateChecks:[]}){let i=n.value,s=t?t.value:null,a=e?e.getContext(n.value.outlet):null;if(s&&i.routeConfig===s.routeConfig){let l=vve(s,i,i.routeConfig.runGuardsAndResolvers);l?o.canActivateChecks.push(new pS(r)):(i.data=s.data,i._resolvedData=s._resolvedData),i.component?_0(n,t,a?a.children:null,r,o):_0(n,t,e,r,o),l&&a&&a.outlet&&a.outlet.isActivated&&o.canDeactivateChecks.push(new Gg(a.outlet.component,s))}else s&&E0(t,a,o),o.canActivateChecks.push(new pS(r)),i.component?_0(n,null,a?a.children:null,r,o):_0(n,null,e,r,o);return o}function vve(n,t,e){if(typeof e=="function")return e(n,t);switch(e){case"pathParamsChange":return!Oh(n.url,t.url);case"pathParamsOrQueryParamsChange":return!Oh(n.url,t.url)||!pc(n.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!PO(n,t)||!pc(n.queryParams,t.queryParams);case"paramsChange":default:return!PO(n,t)}}function E0(n,t,e){let r=zg(n),o=n.value;Object.entries(r).forEach(([i,s])=>{o.component?t?E0(s,t.children.getContext(i),e):E0(s,null,e):E0(s,t,e)}),o.component?t&&t.outlet&&t.outlet.isActivated?e.canDeactivateChecks.push(new Gg(t.outlet.component,o)):e.canDeactivateChecks.push(new Gg(null,o)):e.canDeactivateChecks.push(new Gg(null,o))}function V0(n){return typeof n=="function"}function bve(n){return typeof n=="boolean"}function wve(n){return n&&V0(n.canLoad)}function Cve(n){return n&&V0(n.canActivate)}function _ve(n){return n&&V0(n.canActivateChild)}function Sve(n){return n&&V0(n.canDeactivate)}function Ive(n){return n&&V0(n.canMatch)}function CG(n){return n instanceof Lu||n?.name==="EmptyError"}var Q_=Symbol("INITIAL_VALUE");function Xg(){return li(n=>Uv(n.map(t=>t.pipe(Ti(1),sp(Q_)))).pipe(Wt(t=>{for(let e of t)if(e!==!0){if(e===Q_)return Q_;if(e===!1||Eve(e))return e}return!0}),fr(t=>t!==Q_),Ti(1)))}function Eve(n){return Mh(n)||n instanceof A0}function Tve(n,t){return Kr(e=>{let{targetSnapshot:r,currentSnapshot:o,guards:{canActivateChecks:i,canDeactivateChecks:s}}=e;return s.length===0&&i.length===0?ct(Ft(ke({},e),{guardsResult:!0})):Dve(s,r,o,n).pipe(Kr(a=>a&&bve(a)?kve(r,i,n,t):ct(a)),Wt(a=>Ft(ke({},e),{guardsResult:a})))})}function Dve(n,t,e,r){return Hn(n).pipe(Kr(o=>Mve(o.component,o.route,e,t,r)),Vu(o=>o!==!0,!0))}function kve(n,t,e,r){return Hn(t).pipe($u(o=>fg(Ave(o.route.parent,r),Nve(o.route,r),Ove(n,o.path,e),Rve(n,o.route,e))),Vu(o=>o!==!0,!0))}function Nve(n,t){return n!==null&&t&&t(new NO(n)),ct(!0)}function Ave(n,t){return n!==null&&t&&t(new DO(n)),ct(!0)}function Rve(n,t,e){let r=t.routeConfig?t.routeConfig.canActivate:null;if(!r||r.length===0)return ct(!0);let o=r.map(i=>rp(()=>{let s=L0(t)??e,a=Yg(i,s),l=Cve(a)?a.canActivate(t,n):Ai(s,()=>a(t,n));return bp(l).pipe(Vu())}));return ct(o).pipe(Xg())}function Ove(n,t,e){let r=t[t.length-1],i=t.slice(0,t.length-1).reverse().map(s=>yve(s)).filter(s=>s!==null).map(s=>rp(()=>{let a=s.guards.map(l=>{let c=L0(s.node)??e,u=Yg(l,c),d=_ve(u)?u.canActivateChild(r,n):Ai(c,()=>u(r,n));return bp(d).pipe(Vu())});return ct(a).pipe(Xg())}));return ct(i).pipe(Xg())}function Mve(n,t,e,r,o){let i=t&&t.routeConfig?t.routeConfig.canDeactivate:null;if(!i||i.length===0)return ct(!0);let s=i.map(a=>{let l=L0(t)??o,c=Yg(a,l),u=Sve(c)?c.canDeactivate(n,t,e,r):Ai(l,()=>c(n,t,e,r));return bp(u).pipe(Vu())});return ct(s).pipe(Xg())}function Pve(n,t,e,r){let o=t.canLoad;if(o===void 0||o.length===0)return ct(!0);let i=o.map(s=>{let a=Yg(s,n),l=wve(a)?a.canLoad(t,e):Ai(n,()=>a(t,e));return bp(l)});return ct(i).pipe(Xg(),_G(r))}function _G(n){return kA(ao(t=>{if(typeof t!="boolean")throw dS(n,t)}),Wt(t=>t===!0))}function Fve(n,t,e,r){let o=t.canMatch;if(!o||o.length===0)return ct(!0);let i=o.map(s=>{let a=Yg(s,n),l=Ive(a)?a.canMatch(t,e):Ai(n,()=>a(t,e));return bp(l)});return ct(i).pipe(Xg(),_G(r))}var R0=class{segmentGroup;constructor(t){this.segmentGroup=t||null}},O0=class extends Error{urlTree;constructor(t){super(),this.urlTree=t}};function Bg(n){return pg(new R0(n))}function Lve(n){return pg(new nt(4e3,!1))}function $ve(n){return pg(bG(!1,ds.GuardRejected))}var $O=class{urlSerializer;urlTree;constructor(t,e){this.urlSerializer=t,this.urlTree=e}lineralizeSegments(t,e){let r=[],o=e.root;for(;;){if(r=r.concat(o.segments),o.numberOfChildren===0)return ct(r);if(o.numberOfChildren>1||!o.children[Ht])return Lve(`${t.redirectTo}`);o=o.children[Ht]}}applyRedirectCommands(t,e,r,o,i){if(typeof e!="string"){let a=e,{queryParams:l,fragment:c,routeConfig:u,url:d,outlet:p,params:f,data:h,title:m}=o,g=Ai(i,()=>a({params:f,data:h,queryParams:l,fragment:c,routeConfig:u,url:d,outlet:p,title:m}));if(g instanceof rd)throw new O0(g);e=g}let s=this.applyRedirectCreateUrlTree(e,this.urlSerializer.parse(e),t,r);if(e[0]==="/")throw new O0(s);return s}applyRedirectCreateUrlTree(t,e,r,o){let i=this.createSegmentGroup(t,e.root,r,o);return new rd(i,this.createQueryParams(e.queryParams,this.urlTree.queryParams),e.fragment)}createQueryParams(t,e){let r={};return Object.entries(t).forEach(([o,i])=>{if(typeof i=="string"&&i[0]===":"){let a=i.substring(1);r[o]=e[a]}else r[o]=i}),r}createSegmentGroup(t,e,r,o){let i=this.createSegments(t,e.segments,r,o),s={};return Object.entries(e.children).forEach(([a,l])=>{s[a]=this.createSegmentGroup(t,l,r,o)}),new $n(i,s)}createSegments(t,e,r,o){return e.map(i=>i.path[0]===":"?this.findPosParam(t,i,o):this.findOrReturn(i,r))}findPosParam(t,e,r){let o=r[e.path.substring(1)];if(!o)throw new nt(4001,!1);return o}findOrReturn(t,e){let r=0;for(let o of e){if(o.path===t.path)return e.splice(r),o;r++}return t}},VO={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function Vve(n,t,e,r,o){let i=SG(n,t,e);return i.matched?(r=ave(t,r),Fve(r,t,e,o).pipe(Wt(s=>s===!0?i:ke({},VO)))):ct(i)}function SG(n,t,e){if(t.path==="**")return Bve(e);if(t.path==="")return t.pathMatch==="full"&&(n.hasChildren()||e.length>0)?ke({},VO):{matched:!0,consumedSegments:[],remainingSegments:e,parameters:{},positionalParamSegments:{}};let o=(t.matcher||Pxe)(e,n,t);if(!o)return ke({},VO);let i={};Object.entries(o.posParams??{}).forEach(([a,l])=>{i[a]=l.path});let s=o.consumed.length>0?ke(ke({},i),o.consumed[o.consumed.length-1].parameters):i;return{matched:!0,consumedSegments:o.consumed,remainingSegments:e.slice(o.consumed.length),parameters:s,positionalParamSegments:o.posParams??{}}}function Bve(n){return{matched:!0,parameters:n.length>0?rG(n).parameters:{},consumedSegments:n,remainingSegments:[],positionalParamSegments:{}}}function QW(n,t,e,r){return e.length>0&&Wve(n,e,r)?{segmentGroup:new $n(t,Uve(r,new $n(e,n.children))),slicedSegments:[]}:e.length===0&&Gve(n,e,r)?{segmentGroup:new $n(n.segments,zve(n,e,r,n.children)),slicedSegments:e}:{segmentGroup:new $n(n.segments,n.children),slicedSegments:e}}function zve(n,t,e,r){let o={};for(let i of e)if(mS(n,t,i)&&!r[Ta(i)]){let s=new $n([],{});o[Ta(i)]=s}return ke(ke({},r),o)}function Uve(n,t){let e={};e[Ht]=t;for(let r of n)if(r.path===""&&Ta(r)!==Ht){let o=new $n([],{});e[Ta(r)]=o}return e}function Wve(n,t,e){return e.some(r=>mS(n,t,r)&&Ta(r)!==Ht)}function Gve(n,t,e){return e.some(r=>mS(n,t,r))}function mS(n,t,e){return(n.hasChildren()||t.length>0)&&e.pathMatch==="full"?!1:e.path===""}function jve(n,t,e){return t.length===0&&!n.children[e]}var BO=class{};function Hve(n,t,e,r,o,i,s="emptyOnly"){return new zO(n,t,e,r,o,s,i).recognize()}var qve=31,zO=class{injector;configLoader;rootComponentType;config;urlTree;paramsInheritanceStrategy;urlSerializer;applyRedirects;absoluteRedirectCount=0;allowRedirects=!0;constructor(t,e,r,o,i,s,a){this.injector=t,this.configLoader=e,this.rootComponentType=r,this.config=o,this.urlTree=i,this.paramsInheritanceStrategy=s,this.urlSerializer=a,this.applyRedirects=new $O(this.urlSerializer,this.urlTree)}noMatchError(t){return new nt(4002,`'${t.segmentGroup}'`)}recognize(){let t=QW(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(t).pipe(Wt(({children:e,rootSnapshot:r})=>{let o=new us(r,e),i=new uS("",o),s=eve(r,[],this.urlTree.queryParams,this.urlTree.fragment);return s.queryParams=this.urlTree.queryParams,i.url=this.urlSerializer.serialize(s),{state:i,tree:s}}))}match(t){let e=new Wg([],Object.freeze({}),Object.freeze(ke({},this.urlTree.queryParams)),this.urlTree.fragment,Object.freeze({}),Ht,this.rootComponentType,null,{});return this.processSegmentGroup(this.injector,this.config,t,Ht,e).pipe(Wt(r=>({children:r,rootSnapshot:e})),op(r=>{if(r instanceof O0)return this.urlTree=r.urlTree,this.match(r.urlTree.root);throw r instanceof R0?this.noMatchError(r):r}))}processSegmentGroup(t,e,r,o,i){return r.segments.length===0&&r.hasChildren()?this.processChildren(t,e,r,i):this.processSegment(t,e,r,r.segments,o,!0,i).pipe(Wt(s=>s instanceof us?[s]:[]))}processChildren(t,e,r,o){let i=[];for(let s of Object.keys(r.children))s==="primary"?i.unshift(s):i.push(s);return Hn(i).pipe($u(s=>{let a=r.children[s],l=lve(e,s);return this.processSegmentGroup(t,l,a,s,o)}),$A((s,a)=>(s.push(...a),s)),ip(null),LA(),Kr(s=>{if(s===null)return Bg(r);let a=IG(s);return Kve(a),ct(a)}))}processSegment(t,e,r,o,i,s,a){return Hn(e).pipe($u(l=>this.processSegmentAgainstRoute(l._injector??t,e,l,r,o,i,s,a).pipe(op(c=>{if(c instanceof R0)return ct(null);throw c}))),Vu(l=>!!l),op(l=>{if(CG(l))return jve(r,o,i)?ct(new BO):Bg(r);throw l}))}processSegmentAgainstRoute(t,e,r,o,i,s,a,l){return Ta(r)!==s&&(s===Ht||!mS(o,i,r))?Bg(o):r.redirectTo===void 0?this.matchSegmentAgainstRoute(t,o,r,i,s,l):this.allowRedirects&&a?this.expandSegmentAgainstRouteUsingRedirect(t,o,e,r,i,s,l):Bg(o)}expandSegmentAgainstRouteUsingRedirect(t,e,r,o,i,s,a){let{matched:l,parameters:c,consumedSegments:u,positionalParamSegments:d,remainingSegments:p}=SG(e,o,i);if(!l)return Bg(e);typeof o.redirectTo=="string"&&o.redirectTo[0]==="/"&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>qve&&(this.allowRedirects=!1));let f=new Wg(i,c,Object.freeze(ke({},this.urlTree.queryParams)),this.urlTree.fragment,JW(o),Ta(o),o.component??o._loadedComponent??null,o,eG(o)),h=cS(f,a,this.paramsInheritanceStrategy);f.params=Object.freeze(h.params),f.data=Object.freeze(h.data);let m=this.applyRedirects.applyRedirectCommands(u,o.redirectTo,d,f,t);return this.applyRedirects.lineralizeSegments(o,m).pipe(Kr(g=>this.processSegment(t,r,e,g.concat(p),s,!1,a)))}matchSegmentAgainstRoute(t,e,r,o,i,s){let a=Vve(e,r,o,t,this.urlSerializer);return r.path==="**"&&(e.children={}),a.pipe(li(l=>l.matched?(t=r._injector??t,this.getChildConfig(t,r,o).pipe(li(({routes:c})=>{let u=r._loadedInjector??t,{parameters:d,consumedSegments:p,remainingSegments:f}=l,h=new Wg(p,d,Object.freeze(ke({},this.urlTree.queryParams)),this.urlTree.fragment,JW(r),Ta(r),r.component??r._loadedComponent??null,r,eG(r)),m=cS(h,s,this.paramsInheritanceStrategy);h.params=Object.freeze(m.params),h.data=Object.freeze(m.data);let{segmentGroup:g,slicedSegments:y}=QW(e,p,f,c);if(y.length===0&&g.hasChildren())return this.processChildren(u,c,g,h).pipe(Wt(w=>new us(h,w)));if(c.length===0&&y.length===0)return ct(new us(h,[]));let v=Ta(r)===i;return this.processSegment(u,c,g,y,v?Ht:i,!0,h).pipe(Wt(w=>new us(h,w instanceof us?[w]:[])))}))):Bg(e)))}getChildConfig(t,e,r){return e.children?ct({routes:e.children,injector:t}):e.loadChildren?e._loadedRoutes!==void 0?ct({routes:e._loadedRoutes,injector:e._loadedInjector}):Pve(t,e,r,this.urlSerializer).pipe(Kr(o=>o?this.configLoader.loadChildren(t,e).pipe(ao(i=>{e._loadedRoutes=i.routes,e._loadedInjector=i.injector})):$ve(e))):ct({routes:[],injector:t})}};function Kve(n){n.sort((t,e)=>t.value.outlet===Ht?-1:e.value.outlet===Ht?1:t.value.outlet.localeCompare(e.value.outlet))}function Xve(n){let t=n.value.routeConfig;return t&&t.path===""}function IG(n){let t=[],e=new Set;for(let r of n){if(!Xve(r)){t.push(r);continue}let o=t.find(i=>r.value.routeConfig===i.value.routeConfig);o!==void 0?(o.children.push(...r.children),e.add(o)):t.push(r)}for(let r of e){let o=IG(r.children);t.push(new us(r.value,o))}return t.filter(r=>!e.has(r))}function JW(n){return n.data||{}}function eG(n){return n.resolve||{}}function Yve(n,t,e,r,o,i){return Kr(s=>Hve(n,t,e,r,s.extractedUrl,o,i).pipe(Wt(({state:a,tree:l})=>Ft(ke({},s),{targetSnapshot:a,urlAfterRedirects:l}))))}function Zve(n,t){return Kr(e=>{let{targetSnapshot:r,guards:{canActivateChecks:o}}=e;if(!o.length)return ct(e);let i=new Set(o.map(l=>l.route)),s=new Set;for(let l of i)if(!s.has(l))for(let c of EG(l))s.add(c);let a=0;return Hn(s).pipe($u(l=>i.has(l)?Qve(l,r,n,t):(l.data=cS(l,l.parent,n).resolve,ct(void 0))),ao(()=>a++),hg(1),Kr(l=>a===s.size?ct(e):Uo))})}function EG(n){let t=n.children.map(e=>EG(e)).flat();return[n,...t]}function Qve(n,t,e,r){let o=n.routeConfig,i=n._resolve;return o?.title!==void 0&&!xG(o)&&(i[P0]=o.title),Jve(i,n,t,r).pipe(Wt(s=>(n._resolvedData=s,n.data=cS(n,n.parent,e).resolve,null)))}function Jve(n,t,e,r){let o=xO(n);if(o.length===0)return ct({});let i={};return Hn(o).pipe(Kr(s=>e0e(n[s],t,e,r).pipe(Vu(),ao(a=>{if(a instanceof A0)throw dS(new Hg,a);i[s]=a}))),hg(1),Wt(()=>i),op(s=>CG(s)?Uo:pg(s)))}function e0e(n,t,e,r){let o=L0(t)??r,i=Yg(n,o),s=i.resolve?i.resolve(t,e):Ai(o,()=>i(t,e));return bp(s)}function gO(n){return li(t=>{let e=n(t);return e?Hn(e).pipe(Wt(()=>t)):ct(t)})}var TG=(()=>{class n{buildTitle(e){let r,o=e.root;for(;o!==void 0;)r=this.getResolvedTitleForRoute(o)??r,o=o.children.find(i=>i.outlet===Ht);return r}getResolvedTitleForRoute(e){return e.data[P0]}static \u0275fac=function(r){return new(r||n)};static \u0275prov=Me({token:n,factory:()=>Q(t0e),providedIn:"root"})}return n})(),t0e=(()=>{class n extends TG{title;constructor(e){super(),this.title=e}updateTitle(e){let r=this.buildTitle(e);r!==void 0&&this.title.setTitle(r)}static \u0275fac=function(r){return new(r||n)(it(HW))};static \u0275prov=Me({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),B0=new Ge("",{providedIn:"root",factory:()=>({})}),n0e=(()=>{class n{static \u0275fac=function(r){return new(r||n)};static \u0275cmp=Ct({type:n,selectors:[["ng-component"]],exportAs:["emptyRouterOutlet"],decls:1,vars:0,template:function(r,o){r&1&&ce(0,"router-outlet")},dependencies:[GO],encapsulation:2})}return n})();function jO(n){let t=n.children&&n.children.map(jO),e=t?Ft(ke({},n),{children:t}):ke({},n);return!e.component&&!e.loadComponent&&(t||e.loadChildren)&&e.outlet&&e.outlet!==Ht&&(e.component=n0e),e}var M0=new Ge(""),HO=(()=>{class n{componentLoaders=new WeakMap;childrenLoaders=new WeakMap;onLoadStartListener;onLoadEndListener;compiler=Q($_);loadComponent(e){if(this.componentLoaders.get(e))return this.componentLoaders.get(e);if(e._loadedComponent)return ct(e._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(e);let r=bp(e.loadComponent()).pipe(Wt(DG),ao(i=>{this.onLoadEndListener&&this.onLoadEndListener(e),e._loadedComponent=i}),xh(()=>{this.componentLoaders.delete(e)})),o=new ug(r,()=>new zt).pipe(cg());return this.componentLoaders.set(e,o),o}loadChildren(e,r){if(this.childrenLoaders.get(r))return this.childrenLoaders.get(r);if(r._loadedRoutes)return ct({routes:r._loadedRoutes,injector:r._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(r);let i=r0e(r,this.compiler,e,this.onLoadEndListener).pipe(xh(()=>{this.childrenLoaders.delete(r)})),s=new ug(i,()=>new zt).pipe(cg());return this.childrenLoaders.set(r,s),s}static \u0275fac=function(r){return new(r||n)};static \u0275prov=Me({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function r0e(n,t,e,r){return bp(n.loadChildren()).pipe(Wt(DG),Kr(o=>o instanceof e0||Array.isArray(o)?ct(o):Hn(t.compileModuleAsync(o))),Wt(o=>{r&&r(n);let i,s,a=!1;return Array.isArray(o)?(s=o,a=!0):(i=o.create(e).injector,s=i.get(M0,[],{optional:!0,self:!0}).flat()),{routes:s.map(jO),injector:i}}))}function o0e(n){return n&&typeof n=="object"&&"default"in n}function DG(n){return o0e(n)?n.default:n}var qO=(()=>{class n{static \u0275fac=function(r){return new(r||n)};static \u0275prov=Me({token:n,factory:()=>Q(i0e),providedIn:"root"})}return n})(),i0e=(()=>{class n{shouldProcessUrl(e){return!0}extract(e){return e}merge(e,r){return e}static \u0275fac=function(r){return new(r||n)};static \u0275prov=Me({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),kG=new Ge(""),NG=new Ge("");function s0e(n,t,e){let r=n.get(NG),o=n.get(fn);return n.get(ln).runOutsideAngular(()=>{if(!o.startViewTransition||r.skipNextTransition)return r.skipNextTransition=!1,new Promise(c=>setTimeout(c));let i,s=new Promise(c=>{i=c}),a=o.startViewTransition(()=>(i(),a0e(n))),{onViewTransitionCreated:l}=r;return l&&Ai(n,()=>l({transition:a,from:t,to:e})),s})}function a0e(n){return new Promise(t=>{cc({read:()=>setTimeout(t)},{injector:n})})}var AG=new Ge(""),KO=(()=>{class n{currentNavigation=null;currentTransition=null;lastSuccessfulNavigation=null;events=new zt;transitionAbortSubject=new zt;configLoader=Q(HO);environmentInjector=Q(lo);destroyRef=Q(u0);urlSerializer=Q(F0);rootContexts=Q($0);location=Q(gp);inputBindingEnabled=Q(hS,{optional:!0})!==null;titleStrategy=Q(TG);options=Q(B0,{optional:!0})||{};paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly";urlHandlingStrategy=Q(qO);createViewTransition=Q(kG,{optional:!0});navigationErrorHandler=Q(AG,{optional:!0});navigationId=0;get hasRequestedNavigation(){return this.navigationId!==0}transitions;afterPreactivation=()=>ct(void 0);rootComponentType=null;destroyed=!1;constructor(){let e=o=>this.events.next(new EO(o)),r=o=>this.events.next(new TO(o));this.configLoader.onLoadEndListener=r,this.configLoader.onLoadStartListener=e,this.destroyRef.onDestroy(()=>{this.destroyed=!0})}complete(){this.transitions?.complete()}handleNavigationRequest(e){let r=++this.navigationId;this.transitions?.next(Ft(ke(ke({},this.transitions.value),e),{id:r}))}setupNavigations(e,r,o){return this.transitions=new Wr({id:0,currentUrlTree:r,currentRawUrl:r,extractedUrl:this.urlHandlingStrategy.extract(r),urlAfterRedirects:this.urlHandlingStrategy.extract(r),rawUrl:r,extras:{},resolve:()=>{},reject:()=>{},promise:Promise.resolve(!0),source:I0,restoredState:null,currentSnapshot:o.snapshot,targetSnapshot:null,currentRouterState:o,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(fr(i=>i.id!==0),Wt(i=>Ft(ke({},i),{extractedUrl:this.urlHandlingStrategy.extract(i.rawUrl)})),li(i=>{let s=!1,a=!1;return ct(i).pipe(li(l=>{if(this.navigationId>i.id)return this.cancelNavigationTransition(i,"",ds.SupersededByNewNavigation),Uo;this.currentTransition=i,this.currentNavigation={id:l.id,initialUrl:l.rawUrl,extractedUrl:l.extractedUrl,targetBrowserUrl:typeof l.extras.browserUrl=="string"?this.urlSerializer.parse(l.extras.browserUrl):l.extras.browserUrl,trigger:l.source,extras:l.extras,previousNavigation:this.lastSuccessfulNavigation?Ft(ke({},this.lastSuccessfulNavigation),{previousNavigation:null}):null};let c=!e.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),u=l.extras.onSameUrlNavigation??e.onSameUrlNavigation;if(!c&&u!=="reload"){let d="";return this.events.next(new vp(l.id,this.urlSerializer.serialize(l.rawUrl),d,oS.IgnoredSameUrlNavigation)),l.resolve(!1),Uo}if(this.urlHandlingStrategy.shouldProcessUrl(l.rawUrl))return ct(l).pipe(li(d=>{let p=this.transitions?.getValue();return this.events.next(new qg(d.id,this.urlSerializer.serialize(d.extractedUrl),d.source,d.restoredState)),p!==this.transitions?.getValue()?Uo:Promise.resolve(d)}),Yve(this.environmentInjector,this.configLoader,this.rootComponentType,e.config,this.urlSerializer,this.paramsInheritanceStrategy),ao(d=>{i.targetSnapshot=d.targetSnapshot,i.urlAfterRedirects=d.urlAfterRedirects,this.currentNavigation=Ft(ke({},this.currentNavigation),{finalUrl:d.urlAfterRedirects});let p=new iS(d.id,this.urlSerializer.serialize(d.extractedUrl),this.urlSerializer.serialize(d.urlAfterRedirects),d.targetSnapshot);this.events.next(p)}));if(c&&this.urlHandlingStrategy.shouldProcessUrl(l.currentRawUrl)){let{id:d,extractedUrl:p,source:f,restoredState:h,extras:m}=l,g=new qg(d,this.urlSerializer.serialize(p),f,h);this.events.next(g);let y=gG(this.rootComponentType).snapshot;return this.currentTransition=i=Ft(ke({},l),{targetSnapshot:y,urlAfterRedirects:p,extras:Ft(ke({},m),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=p,ct(i)}else{let d="";return this.events.next(new vp(l.id,this.urlSerializer.serialize(l.extractedUrl),d,oS.IgnoredByUrlHandlingStrategy)),l.resolve(!1),Uo}}),ao(l=>{let c=new CO(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot);this.events.next(c)}),Wt(l=>(this.currentTransition=i=Ft(ke({},l),{guards:gve(l.targetSnapshot,l.currentSnapshot,this.rootContexts)}),i)),Tve(this.environmentInjector,l=>this.events.next(l)),ao(l=>{if(i.guardsResult=l.guardsResult,l.guardsResult&&typeof l.guardsResult!="boolean")throw dS(this.urlSerializer,l.guardsResult);let c=new _O(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot,!!l.guardsResult);this.events.next(c)}),fr(l=>l.guardsResult?!0:(this.cancelNavigationTransition(l,"",ds.GuardRejected),!1)),gO(l=>{if(l.guards.canActivateChecks.length)return ct(l).pipe(ao(c=>{let u=new SO(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects),c.targetSnapshot);this.events.next(u)}),li(c=>{let u=!1;return ct(c).pipe(Zve(this.paramsInheritanceStrategy,this.environmentInjector),ao({next:()=>u=!0,complete:()=>{u||this.cancelNavigationTransition(c,"",ds.NoDataFromResolver)}}))}),ao(c=>{let u=new IO(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects),c.targetSnapshot);this.events.next(u)}))}),gO(l=>{let c=u=>{let d=[];u.routeConfig?.loadComponent&&!u.routeConfig._loadedComponent&&d.push(this.configLoader.loadComponent(u.routeConfig).pipe(ao(p=>{u.component=p}),Wt(()=>{})));for(let p of u.children)d.push(...c(p));return d};return Uv(c(l.targetSnapshot.root)).pipe(ip(null),Ti(1))}),gO(()=>this.afterPreactivation()),li(()=>{let{currentSnapshot:l,targetSnapshot:c}=i,u=this.createViewTransition?.(this.environmentInjector,l.root,c.root);return u?Hn(u).pipe(Wt(()=>i)):ct(i)}),Wt(l=>{let c=dve(e.routeReuseStrategy,l.targetSnapshot,l.currentRouterState);return this.currentTransition=i=Ft(ke({},l),{targetRouterState:c}),this.currentNavigation.targetRouterState=c,i}),ao(()=>{this.events.next(new k0)}),mve(this.rootContexts,e.routeReuseStrategy,l=>this.events.next(l),this.inputBindingEnabled),Ti(1),ao({next:l=>{s=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new Da(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects))),this.titleStrategy?.updateTitle(l.targetRouterState.snapshot),l.resolve(!0)},complete:()=>{s=!0}}),ap(this.transitionAbortSubject.pipe(ao(l=>{throw l}))),xh(()=>{!s&&!a&&this.cancelNavigationTransition(i,"",ds.SupersededByNewNavigation),this.currentTransition?.id===i.id&&(this.currentNavigation=null,this.currentTransition=null)}),op(l=>{if(this.destroyed)return i.resolve(!1),Uo;if(a=!0,wG(l))this.events.next(new nd(i.id,this.urlSerializer.serialize(i.extractedUrl),l.message,l.cancellationCode)),hve(l)?this.events.next(new Kg(l.url,l.navigationBehaviorOptions)):i.resolve(!1);else{let c=new D0(i.id,this.urlSerializer.serialize(i.extractedUrl),l,i.targetSnapshot??void 0);try{let u=Ai(this.environmentInjector,()=>this.navigationErrorHandler?.(c));if(u instanceof A0){let{message:d,cancellationCode:p}=dS(this.urlSerializer,u);this.events.next(new nd(i.id,this.urlSerializer.serialize(i.extractedUrl),d,p)),this.events.next(new Kg(u.redirectTo,u.navigationBehaviorOptions))}else throw this.events.next(c),l}catch(u){this.options.resolveNavigationPromiseOnError?i.resolve(!1):i.reject(u)}}return Uo}))}))}cancelNavigationTransition(e,r,o){let i=new nd(e.id,this.urlSerializer.serialize(e.extractedUrl),r,o);this.events.next(i),e.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){let e=this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))),r=this.currentNavigation?.targetBrowserUrl??this.currentNavigation?.extractedUrl;return e.toString()!==r?.toString()&&!this.currentNavigation?.extras.skipLocationChange}static \u0275fac=function(r){return new(r||n)};static \u0275prov=Me({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function l0e(n){return n!==I0}var c0e=(()=>{class n{static \u0275fac=function(r){return new(r||n)};static \u0275prov=Me({token:n,factory:()=>Q(u0e),providedIn:"root"})}return n})(),UO=class{shouldDetach(t){return!1}store(t,e){}shouldAttach(t){return!1}retrieve(t){return null}shouldReuseRoute(t,e){return t.routeConfig===e.routeConfig}},u0e=(()=>{class n extends UO{static \u0275fac=(()=>{let e;return function(o){return(e||(e=Go(n)))(o||n)}})();static \u0275prov=Me({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),RG=(()=>{class n{static \u0275fac=function(r){return new(r||n)};static \u0275prov=Me({token:n,factory:()=>Q(d0e),providedIn:"root"})}return n})(),d0e=(()=>{class n extends RG{location=Q(gp);urlSerializer=Q(F0);options=Q(B0,{optional:!0})||{};canceledNavigationResolution=this.options.canceledNavigationResolution||"replace";urlHandlingStrategy=Q(qO);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";currentUrlTree=new rd;getCurrentUrlTree(){return this.currentUrlTree}rawUrlTree=this.currentUrlTree;getRawUrlTree(){return this.rawUrlTree}currentPageId=0;lastSuccessfulId=-1;restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}routerState=gG(null);getRouterState(){return this.routerState}stateMemento=this.createStateMemento();createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(e){return this.location.subscribe(r=>{r.type==="popstate"&&e(r.url,r.state)})}handleRouterEvent(e,r){if(e instanceof qg)this.stateMemento=this.createStateMemento();else if(e instanceof vp)this.rawUrlTree=r.initialUrl;else if(e instanceof iS){if(this.urlUpdateStrategy==="eager"&&!r.extras.skipLocationChange){let o=this.urlHandlingStrategy.merge(r.finalUrl,r.initialUrl);this.setBrowserUrl(r.targetBrowserUrl??o,r)}}else e instanceof k0?(this.currentUrlTree=r.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(r.finalUrl,r.initialUrl),this.routerState=r.targetRouterState,this.urlUpdateStrategy==="deferred"&&!r.extras.skipLocationChange&&this.setBrowserUrl(r.targetBrowserUrl??this.rawUrlTree,r)):e instanceof nd&&(e.code===ds.GuardRejected||e.code===ds.NoDataFromResolver)?this.restoreHistory(r):e instanceof D0?this.restoreHistory(r,!0):e instanceof Da&&(this.lastSuccessfulId=e.id,this.currentPageId=this.browserPageId)}setBrowserUrl(e,r){let o=e instanceof rd?this.urlSerializer.serialize(e):e;if(this.location.isCurrentPathEqualTo(o)||r.extras.replaceUrl){let i=this.browserPageId,s=ke(ke({},r.extras.state),this.generateNgRouterState(r.id,i));this.location.replaceState(o,"",s)}else{let i=ke(ke({},r.extras.state),this.generateNgRouterState(r.id,this.browserPageId+1));this.location.go(o,"",i)}}restoreHistory(e,r=!1){if(this.canceledNavigationResolution==="computed"){let o=this.browserPageId,i=this.currentPageId-o;i!==0?this.location.historyGo(i):this.currentUrlTree===e.finalUrl&&i===0&&(this.resetState(e),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(r&&this.resetState(e),this.resetUrlToCurrentUrlTree())}resetState(e){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,e.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(e,r){return this.canceledNavigationResolution==="computed"?{navigationId:e,\u0275routerPageId:r}:{navigationId:e}}static \u0275fac=(()=>{let e;return function(o){return(e||(e=Go(n)))(o||n)}})();static \u0275prov=Me({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function OG(n,t){n.events.pipe(fr(e=>e instanceof Da||e instanceof nd||e instanceof D0||e instanceof vp),Wt(e=>e instanceof Da||e instanceof vp?0:(e instanceof nd?e.code===ds.Redirect||e.code===ds.SupersededByNewNavigation:!1)?2:1),fr(e=>e!==2),Ti(1)).subscribe(()=>{t()})}var p0e={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},f0e={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},Ut=(()=>{class n{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}disposed=!1;nonRouterCurrentEntryChangeSubscription;console=Q(BR);stateManager=Q(RG);options=Q(B0,{optional:!0})||{};pendingTasks=Q(pp);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";navigationTransitions=Q(KO);urlSerializer=Q(F0);location=Q(gp);urlHandlingStrategy=Q(qO);_events=new zt;get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}navigated=!1;routeReuseStrategy=Q(c0e);onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore";config=Q(M0,{optional:!0})?.flat()??[];componentInputBindingEnabled=!!Q(hS,{optional:!0});constructor(){this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:e=>{this.console.warn(e)}}),this.subscribeToNavigationEvents()}eventsSubscription=new Jn;subscribeToNavigationEvents(){let e=this.navigationTransitions.events.subscribe(r=>{try{let o=this.navigationTransitions.currentTransition,i=this.navigationTransitions.currentNavigation;if(o!==null&&i!==null){if(this.stateManager.handleRouterEvent(r,i),r instanceof nd&&r.code!==ds.Redirect&&r.code!==ds.SupersededByNewNavigation)this.navigated=!0;else if(r instanceof Da)this.navigated=!0;else if(r instanceof Kg){let s=r.navigationBehaviorOptions,a=this.urlHandlingStrategy.merge(r.url,o.currentRawUrl),l=ke({browserUrl:o.extras.browserUrl,info:o.extras.info,skipLocationChange:o.extras.skipLocationChange,replaceUrl:o.extras.replaceUrl||this.urlUpdateStrategy==="eager"||l0e(o.source)},s);this.scheduleNavigation(a,I0,null,l,{resolve:o.resolve,reject:o.reject,promise:o.promise})}}m0e(r)&&this._events.next(r)}catch(o){this.navigationTransitions.transitionAbortSubject.next(o)}});this.eventsSubscription.add(e)}resetRootComponentType(e){this.routerState.root.component=e,this.navigationTransitions.rootComponentType=e}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),I0,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((e,r)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(e,"popstate",r)},0)})}navigateToSyncWithBrowser(e,r,o){let i={replaceUrl:!0},s=o?.navigationId?o:null;if(o){let l=ke({},o);delete l.navigationId,delete l.\u0275routerPageId,Object.keys(l).length!==0&&(i.state=l)}let a=this.parseUrl(e);this.scheduleNavigation(a,r,s,i)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(e){this.config=e.map(jO),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this._events.unsubscribe(),this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(e,r={}){let{relativeTo:o,queryParams:i,fragment:s,queryParamsHandling:a,preserveFragment:l}=r,c=l?this.currentUrlTree.fragment:s,u=null;switch(a??this.options.defaultQueryParamsHandling){case"merge":u=ke(ke({},this.currentUrlTree.queryParams),i);break;case"preserve":u=this.currentUrlTree.queryParams;break;default:u=i||null}u!==null&&(u=this.removeEmptyProps(u));let d;try{let p=o?o.snapshot:this.routerState.snapshot.root;d=pG(p)}catch{(typeof e[0]!="string"||e[0][0]!=="/")&&(e=[]),d=this.currentUrlTree.root}return fG(d,e,u,c??null)}navigateByUrl(e,r={skipLocationChange:!1}){let o=Mh(e)?e:this.parseUrl(e),i=this.urlHandlingStrategy.merge(o,this.rawUrlTree);return this.scheduleNavigation(i,I0,null,r)}navigate(e,r={skipLocationChange:!1}){return h0e(e),this.navigateByUrl(this.createUrlTree(e,r),r)}serializeUrl(e){return this.urlSerializer.serialize(e)}parseUrl(e){try{return this.urlSerializer.parse(e)}catch{return this.urlSerializer.parse("/")}}isActive(e,r){let o;if(r===!0?o=ke({},p0e):r===!1?o=ke({},f0e):o=r,Mh(e))return qW(this.currentUrlTree,e,o);let i=this.parseUrl(e);return qW(this.currentUrlTree,i,o)}removeEmptyProps(e){return Object.entries(e).reduce((r,[o,i])=>(i!=null&&(r[o]=i),r),{})}scheduleNavigation(e,r,o,i,s){if(this.disposed)return Promise.resolve(!1);let a,l,c;s?(a=s.resolve,l=s.reject,c=s.promise):c=new Promise((d,p)=>{a=d,l=p});let u=this.pendingTasks.add();return OG(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(u))}),this.navigationTransitions.handleNavigationRequest({source:r,restoredState:o,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:e,extras:i,resolve:a,reject:l,promise:c,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),c.catch(d=>Promise.reject(d))}static \u0275fac=function(r){return new(r||n)};static \u0275prov=Me({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function h0e(n){for(let t=0;t<n.length;t++)if(n[t]==null)throw new nt(4008,!1)}function m0e(n){return!(n instanceof k0)&&!(n instanceof Kg)}var Li=(()=>{class n{router;route;tabIndexAttribute;renderer;el;locationStrategy;href=null;target;queryParams;fragment;queryParamsHandling;state;info;relativeTo;isAnchorElement;subscription;onChanges=new zt;constructor(e,r,o,i,s,a){this.router=e,this.route=r,this.tabIndexAttribute=o,this.renderer=i,this.el=s,this.locationStrategy=a;let l=s.nativeElement.tagName?.toLowerCase();this.isAnchorElement=l==="a"||l==="area",this.isAnchorElement?this.subscription=e.events.subscribe(c=>{c instanceof Da&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}preserveFragment=!1;skipLocationChange=!1;replaceUrl=!1;setTabIndexIfNotOnNativeEl(e){this.tabIndexAttribute!=null||this.isAnchorElement||this.applyAttributeValue("tabindex",e)}ngOnChanges(e){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}routerLinkInput=null;set routerLink(e){e==null?(this.routerLinkInput=null,this.setTabIndexIfNotOnNativeEl(null)):(Mh(e)?this.routerLinkInput=e:this.routerLinkInput=Array.isArray(e)?e:[e],this.setTabIndexIfNotOnNativeEl("0"))}onClick(e,r,o,i,s){let a=this.urlTree;if(a===null||this.isAnchorElement&&(e!==0||r||o||i||s||typeof this.target=="string"&&this.target!="_self"))return!0;let l={skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state,info:this.info};return this.router.navigateByUrl(a,l),!this.isAnchorElement}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){let e=this.urlTree;this.href=e!==null&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(e)):null;let r=this.href===null?null:t4(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",r)}applyAttributeValue(e,r){let o=this.renderer,i=this.el.nativeElement;r!==null?o.setAttribute(i,e,r):o.removeAttribute(i,e)}get urlTree(){return this.routerLinkInput===null?null:Mh(this.routerLinkInput)?this.routerLinkInput:this.router.createUrlTree(this.routerLinkInput,{relativeTo:this.relativeTo!==void 0?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}static \u0275fac=function(r){return new(r||n)(Be(Ut),Be(jo),yR("tabindex"),Be(Mi),Be(hr),Be(td))};static \u0275dir=yn({type:n,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(r,o){r&1&&_e("click",function(s){return o.onClick(s.button,s.ctrlKey,s.shiftKey,s.altKey,s.metaKey)}),r&2&&wa("target",o.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",info:"info",relativeTo:"relativeTo",preserveFragment:[2,"preserveFragment","preserveFragment",Ia],skipLocationChange:[2,"skipLocationChange","skipLocationChange",Ia],replaceUrl:[2,"replaceUrl","replaceUrl",Ia],routerLink:"routerLink"},features:[Pg,Ri]})}return n})(),MG=(()=>{class n{router;element;renderer;cdr;link;links;classes=[];routerEventsSubscription;linkInputChangesSubscription;_isActive=!1;get isActive(){return this._isActive}routerLinkActiveOptions={exact:!1};ariaCurrentWhenActive;isActiveChange=new Un;constructor(e,r,o,i,s){this.router=e,this.element=r,this.renderer=o,this.cdr=i,this.link=s,this.routerEventsSubscription=e.events.subscribe(a=>{a instanceof Da&&this.update()})}ngAfterContentInit(){ct(this.links.changes,ct(null)).pipe(ec()).subscribe(e=>{this.update(),this.subscribeToEachLinkOnChanges()})}subscribeToEachLinkOnChanges(){this.linkInputChangesSubscription?.unsubscribe();let e=[...this.links.toArray(),this.link].filter(r=>!!r).map(r=>r.onChanges);this.linkInputChangesSubscription=Hn(e).pipe(ec()).subscribe(r=>{this._isActive!==this.isLinkActive(this.router)(r)&&this.update()})}set routerLinkActive(e){let r=Array.isArray(e)?e:e.split(" ");this.classes=r.filter(o=>!!o)}ngOnChanges(e){this.update()}ngOnDestroy(){this.routerEventsSubscription.unsubscribe(),this.linkInputChangesSubscription?.unsubscribe()}update(){!this.links||!this.router.navigated||queueMicrotask(()=>{let e=this.hasActiveLinks();this.classes.forEach(r=>{e?this.renderer.addClass(this.element.nativeElement,r):this.renderer.removeClass(this.element.nativeElement,r)}),e&&this.ariaCurrentWhenActive!==void 0?this.renderer.setAttribute(this.element.nativeElement,"aria-current",this.ariaCurrentWhenActive.toString()):this.renderer.removeAttribute(this.element.nativeElement,"aria-current"),this._isActive!==e&&(this._isActive=e,this.cdr.markForCheck(),this.isActiveChange.emit(e))})}isLinkActive(e){let r=g0e(this.routerLinkActiveOptions)?this.routerLinkActiveOptions:this.routerLinkActiveOptions.exact||!1;return o=>{let i=o.urlTree;return i?e.isActive(i,r):!1}}hasActiveLinks(){let e=this.isLinkActive(this.router);return this.link&&e(this.link)||this.links.some(e)}static \u0275fac=function(r){return new(r||n)(Be(Ut),Be(hr),Be(Mi),Be(Sa),Be(Li,8))};static \u0275dir=yn({type:n,selectors:[["","routerLinkActive",""]],contentQueries:function(r,o,i){if(r&1&&eW(i,Li,5),r&2){let s;uc(s=dc())&&(o.links=s)}},inputs:{routerLinkActiveOptions:"routerLinkActiveOptions",ariaCurrentWhenActive:"ariaCurrentWhenActive",routerLinkActive:"routerLinkActive"},outputs:{isActiveChange:"isActiveChange"},exportAs:["routerLinkActive"],features:[Ri]})}return n})();function g0e(n){return!!n.paths}var fS=class{};var y0e=(()=>{class n{router;injector;preloadingStrategy;loader;subscription;constructor(e,r,o,i,s){this.router=e,this.injector=o,this.preloadingStrategy=i,this.loader=s}setUpPreloading(){this.subscription=this.router.events.pipe(fr(e=>e instanceof Da),$u(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(e,r){let o=[];for(let i of r){i.providers&&!i._injector&&(i._injector=P_(i.providers,e,`Route: ${i.path}`));let s=i._injector??e,a=i._loadedInjector??s;(i.loadChildren&&!i._loadedRoutes&&i.canLoad===void 0||i.loadComponent&&!i._loadedComponent)&&o.push(this.preloadConfig(s,i)),(i.children||i._loadedRoutes)&&o.push(this.processRoutes(a,i.children??i._loadedRoutes))}return Hn(o).pipe(ec())}preloadConfig(e,r){return this.preloadingStrategy.preload(r,()=>{let o;r.loadChildren&&r.canLoad===void 0?o=this.loader.loadChildren(e,r):o=ct(null);let i=o.pipe(Kr(s=>s===null?ct(void 0):(r._loadedRoutes=s.routes,r._loadedInjector=s.injector,this.processRoutes(s.injector??e,s.routes))));if(r.loadComponent&&!r._loadedComponent){let s=this.loader.loadComponent(r);return Hn([i,s]).pipe(ec())}else return i})}static \u0275fac=function(r){return new(r||n)(it(Ut),it($_),it(lo),it(fS),it(HO))};static \u0275prov=Me({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),PG=new Ge(""),x0e=(()=>{class n{urlSerializer;transitions;viewportScroller;zone;options;routerEventsSubscription;scrollEventsSubscription;lastId=0;lastSource="imperative";restoredId=0;store={};constructor(e,r,o,i,s={}){this.urlSerializer=e,this.transitions=r,this.viewportScroller=o,this.zone=i,this.options=s,s.scrollPositionRestoration||="disabled",s.anchorScrolling||="disabled"}init(){this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(e=>{e instanceof qg?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=e.navigationTrigger,this.restoredId=e.restoredState?e.restoredState.navigationId:0):e instanceof Da?(this.lastId=e.id,this.scheduleScrollEvent(e,this.urlSerializer.parse(e.urlAfterRedirects).fragment)):e instanceof vp&&e.code===oS.IgnoredSameUrlNavigation&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(e,this.urlSerializer.parse(e.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(e=>{e instanceof sS&&(e.position?this.options.scrollPositionRestoration==="top"?this.viewportScroller.scrollToPosition([0,0]):this.options.scrollPositionRestoration==="enabled"&&this.viewportScroller.scrollToPosition(e.position):e.anchor&&this.options.anchorScrolling==="enabled"?this.viewportScroller.scrollToAnchor(e.anchor):this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(e,r){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new sS(e,this.lastSource==="popstate"?this.store[this.restoredId]:null,r))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}static \u0275fac=function(r){l4()};static \u0275prov=Me({token:n,factory:n.\u0275fac})}return n})();function FG(n,...t){return Ng([{provide:M0,multi:!0,useValue:n},[],{provide:jo,useFactory:LG,deps:[Ut]},{provide:h0,multi:!0,useFactory:$G},t.map(e=>e.\u0275providers)])}function LG(n){return n.routerState.root}function z0(n,t){return{\u0275kind:n,\u0275providers:t}}function $G(){let n=Q(qn);return t=>{let e=n.get(cs);if(t!==e.components[0])return;let r=n.get(Ut),o=n.get(VG);n.get(XO)===1&&r.initialNavigation(),n.get(BG,null,Qt.Optional)?.setUpPreloading(),n.get(PG,null,Qt.Optional)?.init(),r.resetRootComponentType(e.componentTypes[0]),o.closed||(o.next(),o.complete(),o.unsubscribe())}}var VG=new Ge("",{factory:()=>new zt}),XO=new Ge("",{providedIn:"root",factory:()=>1});function v0e(){return z0(2,[{provide:XO,useValue:0},{provide:F_,multi:!0,deps:[qn],useFactory:t=>{let e=t.get(mW,Promise.resolve());return()=>e.then(()=>new Promise(r=>{let o=t.get(Ut),i=t.get(VG);OG(o,()=>{r(!0)}),t.get(KO).afterPreactivation=()=>(r(!0),i.closed?ct(void 0):i),o.initialNavigation()}))}}])}function b0e(){return z0(3,[{provide:F_,multi:!0,useFactory:()=>{let t=Q(Ut);return()=>{t.setUpLocationChangeListener()}}},{provide:XO,useValue:2}])}var BG=new Ge("");function w0e(n){return z0(0,[{provide:BG,useExisting:y0e},{provide:fS,useExisting:n}])}function C0e(){return z0(8,[ZW,{provide:hS,useExisting:ZW}])}function _0e(n){let t=[{provide:kG,useValue:s0e},{provide:NG,useValue:ke({skipNextTransition:!!n?.skipInitialTransition},n)}];return z0(9,t)}var S0e=[gp,{provide:F0,useClass:Hg},Ut,$0,{provide:jo,useFactory:LG,deps:[Ut]},HO,[]],Zg=(()=>{class n{constructor(){}static forRoot(e,r){return{ngModule:n,providers:[S0e,[],{provide:M0,multi:!0,useValue:e},[],r?.errorHandler?{provide:AG,useValue:r.errorHandler}:[],{provide:B0,useValue:r||{}},r?.useHash?E0e():T0e(),I0e(),r?.preloadingStrategy?w0e(r.preloadingStrategy).\u0275providers:[],r?.initialNavigation?D0e(r):[],r?.bindToComponentInputs?C0e().\u0275providers:[],r?.enableViewTransitions?_0e().\u0275providers:[],k0e()]}}static forChild(e){return{ngModule:n,providers:[{provide:M0,multi:!0,useValue:e}]}}static \u0275fac=function(r){return new(r||n)};static \u0275mod=Oo({type:n});static \u0275inj=Ao({})}return n})();function I0e(){return{provide:PG,useFactory:()=>{let n=Q(vW),t=Q(ln),e=Q(B0),r=Q(KO),o=Q(F0);return e.scrollOffset&&n.setOffset(e.scrollOffset),new x0e(o,r,n,t,e)}}}function E0e(){return{provide:td,useClass:yW}}function T0e(){return{provide:td,useClass:JR}}function D0e(n){return[n.initialNavigation==="disabled"?b0e().\u0275providers:[],n.initialNavigation==="enabledBlocking"?v0e().\u0275providers:[]]}var tG=new Ge("");function k0e(){return[{provide:tG,useFactory:$G},{provide:h0,multi:!0,useExisting:tG}]}var xn=class n{constructor(t){this.http=t}pythonUrl="http://localhost:8000";apiUrl="https://shared-server-cxer.onrender.com/fitgenie/routes";sendMessageForm(t,e,r){return this.http.post(`${this.apiUrl}/contact-form`,{name:t,email:e,message:r})}bookEmergencyAppointment(t){return this.http.post(`${this.apiUrl}/book-emergency-appointment`,t)}signup(t){return this.http.post(`${this.apiUrl}/signup`,t)}verifyOtp(t){return this.http.post(`${this.apiUrl}/verify-otp`,t)}login(t){return this.http.post(`${this.apiUrl}/login`,t)}verifyLoginOtp(t){return this.http.post(`${this.apiUrl}/verify-login-otp`,t)}googleSignup(t){return this.http.post(`${this.apiUrl}/google-signup`,t)}logout(t){return this.http.post(`${this.apiUrl}/logout`,{email:t})}sendOtp(t){return this.http.post(`${this.apiUrl}/forgot-password`,{email:t})}verifyForgotPasswordOtp(t,e){return this.http.post(`${this.apiUrl}/verify-forgotp-otp`,{email:t,otp:e})}resetPassword(t,e){return this.http.post(`${this.apiUrl}/reset-password`,{email:t,password:e})}isLoggedIn(){return!!localStorage.getItem("token")}getUserName(t){return this.http.post(`${this.apiUrl}/getUserName`,{email:t})}verifySecretKey(t){return this.http.post(`${this.apiUrl}/verifySecretKey`,{secretKey:t})}userType(t){return this.http.post(`${this.apiUrl}/user-type`,{email:t})}generateResponse(t){return this.http.post(`${this.apiUrl}/chatbot`,{prompt:t})}addGymDetails(t){return this.http.post(`${this.apiUrl}/addGymCenter`,t)}gymRegistered(t){return this.http.post(`${this.apiUrl}/isRegistered`,{email:t})}fetchUnverifiedCentres(){return this.http.get(`${this.apiUrl}/unverifiedCentres`)}verifyGymCenter(t){return this.http.post(`${this.apiUrl}/verifyCenter`,{centerId:t})}getHealthData(){return this.http.get(`${this.apiUrl}/getFitData`)}fetchFilteredCenterDetails(t){return this.http.post(`${this.apiUrl}/fetch-filtered-gym-details`,t)}loadGymDetails(t){return this.http.post(`${this.apiUrl}/fetch-gym-details`,{centerId:t})}updateGymDetails(t,e){return this.http.put(`${this.apiUrl}/gym/${t}`,ke({},e))}addToWishlist(t,e){return this.http.post(`${this.apiUrl}/add-to-wishlist`,{email:t,gymId:e})}checkInWishlist(t,e){return this.http.post(`${this.apiUrl}/is-gym-in-wishlist`,{email:t,gymId:e})}createPost(t,e,r,o){return this.http.post(`${this.apiUrl}/create-post`,{userId:t,content:e,userType:r,email:o})}fetchPosts(){return this.http.get(`${this.apiUrl}/fetch-posts`)}likePost(t,e){return this.http.post(`${this.apiUrl}/like-post`,{postId:t,userId:e})}commentPost(t,e,r,o,i,s){return this.http.post(`${this.apiUrl}/comment-post`,{postId:t,comment:e,userId:r,userType:o,email:i,parentCommentId:s})}likeComment(t,e){return this.http.post(`${this.apiUrl}/like-comment`,{commentId:t,userId:e})}deletePost(t){return this.http.delete(`${this.apiUrl}/delete-post/${t}`)}deleteComment(t){return this.http.delete(`${this.apiUrl}/delete-comment/${t}`)}calculateBmi(t,e){return this.http.post(`${this.apiUrl}/bmicalculator`,{weight:t,height:e})}fetchWishlistItems(t){return this.http.post(`${this.apiUrl}/fetch-wishlist-items`,{email:t})}addExercise(t){return console.log(t),this.http.post(`${this.apiUrl}/add-exercise`,{exerciseData:t})}fetchExercises(){return this.http.get(`${this.apiUrl}/exercises`)}getExerciseRecommendations(t){return this.http.post(`${this.pythonUrl}/recommend`,t)}findExerciseById(t){return this.http.post(`${this.apiUrl}/fetchExerciseByID`,{exerciseId:t})}addExerciseData(t,e){return this.http.post(`${this.apiUrl}/saveExerciseData`,{email:t,exerciseData:e})}addActivity(t,e){return this.http.post(`${this.apiUrl}/logEcoFriendlyActivity`,{email:t,activity:e})}fetchActivityLogs(t){return this.http.post(`${this.apiUrl}/fetchUserActivityLogs`,{email:t})}fetchExercisesByEmail(t){return this.http.post(`${this.apiUrl}/fetchExercisesByUserEmail`,{email:t})}static \u0275fac=function(e){return new(e||n)(it(Ea))};static \u0275prov=Me({token:n,factory:n.\u0275fac,providedIn:"root"})};var Vn=class n{notificationSubject=new Wr(null);notification$=this.notificationSubject.asObservable();constructor(){}showNotification(t,e="info"){this.notificationSubject.next({message:t,type:e}),setTimeout(()=>{this.clearNotification()},4e3)}clearNotification(){this.notificationSubject.next(null)}static \u0275fac=function(e){return new(e||n)};static \u0275prov=Me({token:n,factory:n.\u0275fac,providedIn:"root"})};var N0e=()=>["/centers"],A0e=()=>["/exercises"],R0e=()=>["/wishList"];function O0e(n,t){if(n&1){let e=et();E(0,"div")(1,"button",18),_e("click",function(){ve(e);let o=le();return be(o.router.navigate(["/login"]))}),O(2,"Login"),S(),E(3,"button",19),_e("click",function(){ve(e);let o=le();return be(o.router.navigate(["/signup"]))}),O(4,"Register"),S()()}}function M0e(n,t){if(n&1){let e=et();E(0,"div")(1,"button",18),_e("click",function(){ve(e);let o=le();return be(o.navigate())}),ce(2,"i",20),O(3,"\xA0Dashboard"),S(),E(4,"button",19),_e("click",function(){ve(e);let o=le();return be(o.logout())}),O(5,"Logout\xA0"),ce(6,"i",21),S()()}}function P0e(n,t){if(n&1){let e=et();E(0,"div")(1,"button",5),_e("click",function(){ve(e);let o=le();return be(o.router.navigate(["/login"]))}),O(2,"Login\xA0"),ce(3,"i",22),S()()}}function F0e(n,t){if(n&1){let e=et();E(0,"div",23)(1,"button",5),_e("click",function(){ve(e);let o=le();return be(o.logout())}),O(2,"Logout"),S()()}}var Xr=class n{constructor(t,e,r){this.authService=t;this.router=e;this.notification=r}loggedIn=!1;isAdmin=!1;activeMenu="home";token=localStorage.getItem("token");showBookmarkBtn=!1;ngOnInit(){this.checkLoggedInStatus(),this.token&&(this.showBookmarkBtn=!0)}setActive(t,e){this.activeMenu=t,this.router.navigate([e])}checkLoggedInStatus(){localStorage.getItem("token")?(this.loggedIn=!0,this.isAdmin=localStorage.getItem("isAdmin")==="true"):this.loggedIn=!1}navigate(){localStorage.getItem("isAdmin")?this.router.navigate(["/admin"]):localStorage.getItem("isFitnessCenter")?this.router.navigate(["/center"]):this.router.navigate(["/user"])}logout(){let t=localStorage.getItem("email");t&&this.authService.logout(t).subscribe(e=>{localStorage.clear(),this.loggedIn=!1,this.isAdmin=!1,this.router.navigate(["/login"]),this.notification.showNotification(`${e.msg}`,"success")},e=>{this.notification.showNotification(`${e.error.msg}`,"error")})}goToSection(t){if(this.router.navigate([""],{fragment:`${t}`}),this.router.url==="/"){let e=document.getElementById(t);e&&e.scrollIntoView({behavior:"smooth",block:"start"})}else this.router.navigate(["/"]).then(()=>{let e=document.getElementById(t);e&&e.scrollIntoView({behavior:"smooth",block:"start"})})}displayNavMobile(){let t=document.getElementById("navMobile");t&&(t.style.display=t.style.display==="flex"?"none":"flex")}closeNav(){let t=document.getElementById("navMobile");t&&(t.style.display="none")}static \u0275fac=function(e){return new(e||n)(Be(xn),Be(Ut),Be(Vn))};static \u0275cmp=Ct({type:n,selectors:[["app-navbar"]],decls:42,vars:10,consts:[[1,"logo"],["href",""],[2,"color","#fff"],[2,"color","var(--shade-1)"],[1,"menu"],[3,"click"],["routerLinkActive","router-link-active",3,"routerLink"],[2,"color","#ff0000"],[1,"fa-solid","fa-heart"],[1,"buttonContainer"],[4,"ngIf"],[1,"nav-mobile"],[1,"toggleNav",3,"click"],[1,"fa-solid","fa-bars-staggered"],["id","navMobile",1,"nav-elements"],[1,"closeNav",2,"text-align","right","color","#ffacac",3,"click"],[1,"fa-solid","fa-xmark"],["class","userBtn",4,"ngIf"],["id","a",1,"AuthButtons",3,"click"],["id","b",1,"AuthButtons",3,"click"],[1,"fa-solid","fa-user"],[1,"fa-solid","fa-right-from-bracket"],[1,"fa-solid","fa-right-to-bracket"],[1,"userBtn"]],template:function(e,r){e&1&&(E(0,"nav")(1,"div",0)(2,"a",1)(3,"span",2)(4,"span",3),O(5,"FIT"),S(),O(6,"GENIE"),S()()(),E(7,"div",4)(8,"a",5),_e("click",function(){return r.goToSection("plans")}),E(9,"p"),O(10,"Plans"),S()(),E(11,"a",6)(12,"p"),O(13,"Centers"),S()(),E(14,"a",6)(15,"p"),O(16,"Exercises"),S()(),E(17,"a",5),_e("click",function(){return r.goToSection("contact")}),E(18,"p"),O(19,"Contact Us"),S()(),E(20,"a",6)(21,"p",7),ce(22,"i",8),S()(),E(23,"div",9),Ne(24,O0e,5,0,"div",10)(25,M0e,7,0,"div",10),S()()(),E(26,"div",11),ce(27,"a",1),E(28,"button",12),_e("click",function(){return r.displayNavMobile()}),ce(29,"i",13),S(),E(30,"div",14)(31,"span",15),_e("click",function(){return r.closeNav()}),ce(32,"i",16),S(),E(33,"a",5),_e("click",function(){return r.goToSection("")}),O(34,"Home"),S(),E(35,"a",5),_e("click",function(){return r.goToSection("about")}),O(36,"About"),S(),E(37,"a",5),_e("click",function(){return r.goToSection("contact")}),O(38,"Contact"),S(),E(39,"div",9),Ne(40,P0e,4,0,"div",10)(41,F0e,3,0,"div",17),S()()()),e&2&&(z(11),re("routerLink",Fi(7,N0e)),z(3),re("routerLink",Fi(8,A0e)),z(6),re("routerLink",Fi(9,R0e)),z(4),re("ngIf",!r.loggedIn),z(),re("ngIf",r.loggedIn),z(15),re("ngIf",!r.loggedIn),z(),re("ngIf",r.loggedIn))},dependencies:[Ln,Li,Zg,MG],styles:["[_nghost-%COMP%]{display:block;width:100%}nav[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding-bottom:0;width:90%;max-width:1800px;border-radius:16px;margin:4px auto}nav[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{color:var(--dark);font-size:38px;font-weight:600;max-height:50px;text-align:center}.logo[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin:0;font-weight:600;font-size:36px}.search[_ngcontent-%COMP%]{display:flex;justify-content:center;border:1px solid #ccc;border-radius:8px}.search-bar[_ngcontent-%COMP%]{width:500px;height:40px;padding:5px 10px;font-size:medium;border:none;border-radius:8px 0 0 8px;margin:0}.mic-button[_ngcontent-%COMP%]{width:45px;border:none;color:#0f2167;font-size:x-large;font-weight:600;border-right:.5px solid rgba(0,0,0,0)}.search-button[_ngcontent-%COMP%]{width:45px;border:none;color:#0f2167;font-size:x-large;font-weight:600;border-radius:0 8px 8px 0}.search-button[_ngcontent-%COMP%]:hover{background-color:#00275a;color:#fff}.search-bar[_ngcontent-%COMP%]:focus{border:none;outline:1px #00275a}.menu[_ngcontent-%COMP%]{display:flex;gap:16px;align-items:center;justify-content:center}.menu[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{list-style:none;text-decoration:none;cursor:pointer;font-size:18px;font-weight:500!important;color:var(--light);margin:0}.menu[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0}.active[_ngcontent-%COMP%]{border-bottom:2px solid #ffbf00}.AuthButtons[_ngcontent-%COMP%]{border:none;outline:none;background-color:transparent;color:var(--dark);background-color:var(--shade-1);padding:6px 18px;margin:0 8px;border-radius:4px;font-size:medium;font-weight:500}.nav-mobile[_ngcontent-%COMP%]{display:none}#b[_ngcontent-%COMP%]{background-color:transparent;border:1px solid var(--shade-1);color:var(--shade-1)}#b[_ngcontent-%COMP%]:hover{background-color:var(--shade-1);color:var(--dark)}@media (max-width: 767px){.logo[_ngcontent-%COMP%]{left:10px}.navbar[_ngcontent-%COMP%]{gap:10px}}@media (max-width: 750px){.navbar[_ngcontent-%COMP%]{gap:8px}.buttonContainer[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:0;margin:0}.buttonContainer[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:first-child{margin-right:8px}}@media (max-width: 650px){nav[_ngcontent-%COMP%]{display:none}.nav-mobile[_ngcontent-%COMP%]{background-color:#0000003c;display:flex;justify-content:center;align-items:center;padding:0 10px;width:100%}.nav-mobile[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{height:60px}#navMobile[_ngcontent-%COMP%]{display:none;flex-direction:column;background-color:#000000e8;height:100vh;z-index:3;font-size:large;font-weight:600;position:fixed;right:0;width:200px;text-decoration:none;top:0;bottom:0;padding:10px 10px 10px 18px}.logoMobile[_ngcontent-%COMP%]{font-size:large;font-weight:600;text-decoration:none}.toggleNav[_ngcontent-%COMP%]{border:none;color:#fff;background-color:transparent;font-size:30px;position:absolute;right:10px}.buttonContainer[_ngcontent-%COMP%]{position:relative}.userBtn[_ngcontent-%COMP%]{display:flex;align-items:flex-start;flex-direction:column!important}.buttonContainer[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{color:#fff;text-decoration:none;padding:8px 6px}#navMobile[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#fff;text-decoration:none;margin:6px 0}}"]})};var Kn=class n{static \u0275fac=function(e){return new(e||n)};static \u0275cmp=Ct({type:n,selectors:[["app-footer"]],decls:79,vars:0,consts:[[1,"footer-container"],[1,"footer-company-box"],["href","#",1,"logo"],[2,"color","#fff"],[2,"color","var(--shade-1)"],[1,"footer-social"],["href","#"],[1,"fa-brands","fa-facebook-f"],[1,"fa-brands","fa-instagram"],[1,"fa-brands","fa-twitter"],[1,"fa-brands","fa-youtube"],[1,"footer-link-box"],[1,"footer-bottom"],[1,"footer-owner"],[1,"copyright"]],template:function(e,r){e&1&&(E(0,"footer")(1,"div",0)(2,"div",1)(3,"a",2)(4,"span",3)(5,"span",4),O(6,"FIT"),S(),O(7,"GENIE"),S()(),E(8,"p"),O(9,"Empowering healthier lives through accessible and innovative healthcare solutions, Fitgenie is your trusted partner in wellness."),S(),E(10,"div",5)(11,"a",6),ce(12,"i",7),S(),E(13,"a",6),ce(14,"i",8),S(),E(15,"a",6),ce(16,"i",9),S(),E(17,"a",6),ce(18,"i",10),S()()(),E(19,"div",11)(20,"strong"),O(21,"Main Links"),S(),E(22,"ul")(23,"li")(24,"a",6),O(25,"Home"),S()(),E(26,"li")(27,"a",6),O(28,"About"),S()(),E(29,"li")(30,"a",6),O(31,"Contact"),S()(),E(32,"li")(33,"a",6),O(34,"Services"),S()()()(),E(35,"div",11)(36,"strong"),O(37,"External Links"),S(),E(38,"ul")(39,"li")(40,"a",6),O(41,"Our Product's"),S()(),E(42,"li")(43,"a",6),O(44,"Privacy Policy"),S()(),E(45,"li")(46,"a",6),O(47,"Disclaimer"),S()(),E(48,"li")(49,"a",6),O(50,"Trem's and Condition's"),S()()()(),E(51,"div",11)(52,"strong"),O(53,"External Links"),S(),E(54,"ul")(55,"li")(56,"a",6),O(57,"Our Product's"),S()(),E(58,"li")(59,"a",6),O(60,"Privacy Policy"),S()(),E(61,"li")(62,"a",6),O(63,"Disclaimer"),S()(),E(64,"li")(65,"a",6),O(66,"Trem's and Condition's"),S()()()()(),E(67,"div",12)(68,"span",13)(69,"span",3)(70,"span",4),O(71,"FIT"),S(),O(72,"GENIE"),S()(),E(73,"span",14),O(74,"\xA9 Copyright 2025 - "),E(75,"span",3)(76,"span",4),O(77,"FIT"),S(),O(78,"GENIE"),S()()()())},styles:[".logo[_ngcontent-%COMP%]{color:var(--light);font-size:1.7rem;font-weight:600}footer[_ngcontent-%COMP%]{width:100%;background-color:var(--shade-3)}.footer-container[_ngcontent-%COMP%]{max-width:1200px;width:90%;margin:0 auto;padding:50px 0;display:flex;justify-content:space-between;align-items:flex-start}.footer-company-box[_ngcontent-%COMP%]{max-width:330px}.footer-company-box[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--light);margin:5px 0;font-size:.9rem;letter-spacing:.3px;line-height:1.4rem}.footer-social[_ngcontent-%COMP%]{display:flex;align-items:center;flex-wrap:wrap}.footer-social[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{margin-top:10px;margin-right:10px;width:40px;height:40px;border-radius:50%;display:flex;justify-content:center;align-items:center;background-color:var(--shade-1);color:var(--dark);font-size:1.4rem;transition:all ease .3s}.footer-social[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{background-color:#122853;color:#fff}.footer-link-box[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-size:1.2rem;color:var(--shade-1);font-weight:600}.footer-link-box[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{margin-top:5px;padding-left:0}.footer-container[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--light);font-size:.9rem;margin-bottom:5px;display:flex;transition:all ease .3s}.footer-container[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:#122853}.footer-bottom[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;grid-gap:10px;border-top:1px solid #b6b6b6;padding:20px 0;width:90%;margin:auto}.footer-bottom[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:var(--light);font-size:.9rem}"]})};var YG=(()=>{class n{_renderer;_elementRef;onChange=e=>{};onTouched=()=>{};constructor(e,r){this._renderer=e,this._elementRef=r}setProperty(e,r){this._renderer.setProperty(this._elementRef.nativeElement,e,r)}registerOnTouched(e){this.onTouched=e}registerOnChange(e){this.onChange=e}setDisabledState(e){this.setProperty("disabled",e)}static \u0275fac=function(r){return new(r||n)(Be(Mi),Be(hr))};static \u0275dir=yn({type:n})}return n})(),ES=(()=>{class n extends YG{static \u0275fac=(()=>{let e;return function(o){return(e||(e=Go(n)))(o||n)}})();static \u0275dir=yn({type:n,features:[Or]})}return n})(),ny=new Ge("");var L0e={provide:ny,useExisting:Ni(()=>vo),multi:!0};function $0e(){let n=ed()?ed().getUserAgent():"";return/android (\d+)/.test(n.toLowerCase())}var V0e=new Ge(""),vo=(()=>{class n extends YG{_compositionMode;_composing=!1;constructor(e,r,o){super(e,r),this._compositionMode=o,this._compositionMode==null&&(this._compositionMode=!$0e())}writeValue(e){let r=e??"";this.setProperty("value",r)}_handleInput(e){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(e)}_compositionStart(){this._composing=!0}_compositionEnd(e){this._composing=!1,this._compositionMode&&this.onChange(e)}static \u0275fac=function(r){return new(r||n)(Be(Mi),Be(hr),Be(V0e,8))};static \u0275dir=yn({type:n,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(r,o){r&1&&_e("input",function(s){return o._handleInput(s.target.value)})("blur",function(){return o.onTouched()})("compositionstart",function(){return o._compositionStart()})("compositionend",function(s){return o._compositionEnd(s.target.value)})},standalone:!1,features:[Pi([L0e]),Or]})}return n})();function wp(n){return n==null||(typeof n=="string"||Array.isArray(n))&&n.length===0}function ZG(n){return n!=null&&typeof n.length=="number"}var ry=new Ge(""),TS=new Ge(""),B0e=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,tr=class{static min(t){return QG(t)}static max(t){return z0e(t)}static required(t){return JG(t)}static requiredTrue(t){return U0e(t)}static email(t){return W0e(t)}static minLength(t){return G0e(t)}static maxLength(t){return j0e(t)}static pattern(t){return H0e(t)}static nullValidator(t){return xS(t)}static compose(t){return ij(t)}static composeAsync(t){return sj(t)}};function QG(n){return t=>{if(wp(t.value)||wp(n))return null;let e=parseFloat(t.value);return!isNaN(e)&&e<n?{min:{min:n,actual:t.value}}:null}}function z0e(n){return t=>{if(wp(t.value)||wp(n))return null;let e=parseFloat(t.value);return!isNaN(e)&&e>n?{max:{max:n,actual:t.value}}:null}}function JG(n){return wp(n.value)?{required:!0}:null}function U0e(n){return n.value===!0?null:{required:!0}}function W0e(n){return wp(n.value)||B0e.test(n.value)?null:{email:!0}}function G0e(n){return t=>wp(t.value)||!ZG(t.value)?null:t.value.length<n?{minlength:{requiredLength:n,actualLength:t.value.length}}:null}function j0e(n){return t=>ZG(t.value)&&t.value.length>n?{maxlength:{requiredLength:n,actualLength:t.value.length}}:null}function H0e(n){if(!n)return xS;let t,e;return typeof n=="string"?(e="",n.charAt(0)!=="^"&&(e+="^"),e+=n,n.charAt(n.length-1)!=="$"&&(e+="$"),t=new RegExp(e)):(e=n.toString(),t=n),r=>{if(wp(r.value))return null;let o=r.value;return t.test(o)?null:{pattern:{requiredPattern:e,actualValue:o}}}}function xS(n){return null}function ej(n){return n!=null}function tj(n){return Nh(n)?Hn(n):n}function nj(n){let t={};return n.forEach(e=>{t=e!=null?ke(ke({},t),e):t}),Object.keys(t).length===0?null:t}function rj(n,t){return t.map(e=>e(n))}function q0e(n){return!n.validate}function oj(n){return n.map(t=>q0e(t)?t:e=>t.validate(e))}function ij(n){if(!n)return null;let t=n.filter(ej);return t.length==0?null:function(e){return nj(rj(e,t))}}function tM(n){return n!=null?ij(oj(n)):null}function sj(n){if(!n)return null;let t=n.filter(ej);return t.length==0?null:function(e){let r=rj(e,t).map(tj);return FA(r).pipe(Wt(nj))}}function nM(n){return n!=null?sj(oj(n)):null}function zG(n,t){return n===null?[t]:Array.isArray(n)?[...n,t]:[n,t]}function aj(n){return n._rawValidators}function lj(n){return n._rawAsyncValidators}function YO(n){return n?Array.isArray(n)?n:[n]:[]}function vS(n,t){return Array.isArray(n)?n.includes(t):n===t}function UG(n,t){let e=YO(t);return YO(n).forEach(o=>{vS(e,o)||e.push(o)}),e}function WG(n,t){return YO(t).filter(e=>!vS(n,e))}var bS=class{get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators=[];_rawAsyncValidators=[];_setValidators(t){this._rawValidators=t||[],this._composedValidatorFn=tM(this._rawValidators)}_setAsyncValidators(t){this._rawAsyncValidators=t||[],this._composedAsyncValidatorFn=nM(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_onDestroyCallbacks=[];_registerOnDestroy(t){this._onDestroyCallbacks.push(t)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(t=>t()),this._onDestroyCallbacks=[]}reset(t=void 0){this.control&&this.control.reset(t)}hasError(t,e){return this.control?this.control.hasError(t,e):!1}getError(t,e){return this.control?this.control.getError(t,e):null}},id=class extends bS{name;get formDirective(){return null}get path(){return null}},Ph=class extends bS{_parent=null;name=null;valueAccessor=null},wS=class{_cd;constructor(t){this._cd=t}get isTouched(){return this._cd?.control?._touched?.(),!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return this._cd?.control?._pristine?.(),!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return this._cd?.control?._status?.(),!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return this._cd?._submitted?.(),!!this._cd?.submitted}},K0e={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},yZe=Ft(ke({},K0e),{"[class.ng-submitted]":"isSubmitted"}),Ho=(()=>{class n extends wS{constructor(e){super(e)}static \u0275fac=function(r){return new(r||n)(Be(Ph,2))};static \u0275dir=yn({type:n,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(r,o){r&2&&Zu("ng-untouched",o.isUntouched)("ng-touched",o.isTouched)("ng-pristine",o.isPristine)("ng-dirty",o.isDirty)("ng-valid",o.isValid)("ng-invalid",o.isInvalid)("ng-pending",o.isPending)},standalone:!1,features:[Or]})}return n})(),$i=(()=>{class n extends wS{constructor(e){super(e)}static \u0275fac=function(r){return new(r||n)(Be(id,10))};static \u0275dir=yn({type:n,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(r,o){r&2&&Zu("ng-untouched",o.isUntouched)("ng-touched",o.isTouched)("ng-pristine",o.isPristine)("ng-dirty",o.isDirty)("ng-valid",o.isValid)("ng-invalid",o.isInvalid)("ng-pending",o.isPending)("ng-submitted",o.isSubmitted)},standalone:!1,features:[Or]})}return n})();var W0="VALID",yS="INVALID",Qg="PENDING",G0="DISABLED",Cp=class{},CS=class extends Cp{value;source;constructor(t,e){super(),this.value=t,this.source=e}},H0=class extends Cp{pristine;source;constructor(t,e){super(),this.pristine=t,this.source=e}},q0=class extends Cp{touched;source;constructor(t,e){super(),this.touched=t,this.source=e}},Jg=class extends Cp{status;source;constructor(t,e){super(),this.status=t,this.source=e}},ZO=class extends Cp{source;constructor(t){super(),this.source=t}},QO=class extends Cp{source;constructor(t){super(),this.source=t}};function rM(n){return(DS(n)?n.validators:n)||null}function X0e(n){return Array.isArray(n)?tM(n):n||null}function oM(n,t){return(DS(t)?t.asyncValidators:n)||null}function Y0e(n){return Array.isArray(n)?nM(n):n||null}function DS(n){return n!=null&&!Array.isArray(n)&&typeof n=="object"}function cj(n,t,e){let r=n.controls;if(!(t?Object.keys(r):r).length)throw new nt(1e3,"");if(!r[e])throw new nt(1001,"")}function uj(n,t,e){n._forEachChild((r,o)=>{if(e[o]===void 0)throw new nt(1002,"")})}var ey=class{_pendingDirty=!1;_hasOwnPendingAsyncValidator=null;_pendingTouched=!1;_onCollectionChange=()=>{};_updateOn;_parent=null;_asyncValidationSubscription;_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators;_rawAsyncValidators;value;constructor(t,e){this._assignValidators(t),this._assignAsyncValidators(e)}get validator(){return this._composedValidatorFn}set validator(t){this._rawValidators=this._composedValidatorFn=t}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(t){this._rawAsyncValidators=this._composedAsyncValidatorFn=t}get parent(){return this._parent}get status(){return Os(this.statusReactive)}set status(t){Os(()=>this.statusReactive.set(t))}_status=Lg(()=>this.statusReactive());statusReactive=kh(void 0);get valid(){return this.status===W0}get invalid(){return this.status===yS}get pending(){return this.status==Qg}get disabled(){return this.status===G0}get enabled(){return this.status!==G0}errors;get pristine(){return Os(this.pristineReactive)}set pristine(t){Os(()=>this.pristineReactive.set(t))}_pristine=Lg(()=>this.pristineReactive());pristineReactive=kh(!0);get dirty(){return!this.pristine}get touched(){return Os(this.touchedReactive)}set touched(t){Os(()=>this.touchedReactive.set(t))}_touched=Lg(()=>this.touchedReactive());touchedReactive=kh(!1);get untouched(){return!this.touched}_events=new zt;events=this._events.asObservable();valueChanges;statusChanges;get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(t){this._assignValidators(t)}setAsyncValidators(t){this._assignAsyncValidators(t)}addValidators(t){this.setValidators(UG(t,this._rawValidators))}addAsyncValidators(t){this.setAsyncValidators(UG(t,this._rawAsyncValidators))}removeValidators(t){this.setValidators(WG(t,this._rawValidators))}removeAsyncValidators(t){this.setAsyncValidators(WG(t,this._rawAsyncValidators))}hasValidator(t){return vS(this._rawValidators,t)}hasAsyncValidator(t){return vS(this._rawAsyncValidators,t)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(t={}){let e=this.touched===!1;this.touched=!0;let r=t.sourceControl??this;this._parent&&!t.onlySelf&&this._parent.markAsTouched(Ft(ke({},t),{sourceControl:r})),e&&t.emitEvent!==!1&&this._events.next(new q0(!0,r))}markAllAsTouched(t={}){this.markAsTouched({onlySelf:!0,emitEvent:t.emitEvent,sourceControl:this}),this._forEachChild(e=>e.markAllAsTouched(t))}markAsUntouched(t={}){let e=this.touched===!0;this.touched=!1,this._pendingTouched=!1;let r=t.sourceControl??this;this._forEachChild(o=>{o.markAsUntouched({onlySelf:!0,emitEvent:t.emitEvent,sourceControl:r})}),this._parent&&!t.onlySelf&&this._parent._updateTouched(t,r),e&&t.emitEvent!==!1&&this._events.next(new q0(!1,r))}markAsDirty(t={}){let e=this.pristine===!0;this.pristine=!1;let r=t.sourceControl??this;this._parent&&!t.onlySelf&&this._parent.markAsDirty(Ft(ke({},t),{sourceControl:r})),e&&t.emitEvent!==!1&&this._events.next(new H0(!1,r))}markAsPristine(t={}){let e=this.pristine===!1;this.pristine=!0,this._pendingDirty=!1;let r=t.sourceControl??this;this._forEachChild(o=>{o.markAsPristine({onlySelf:!0,emitEvent:t.emitEvent})}),this._parent&&!t.onlySelf&&this._parent._updatePristine(t,r),e&&t.emitEvent!==!1&&this._events.next(new H0(!0,r))}markAsPending(t={}){this.status=Qg;let e=t.sourceControl??this;t.emitEvent!==!1&&(this._events.next(new Jg(this.status,e)),this.statusChanges.emit(this.status)),this._parent&&!t.onlySelf&&this._parent.markAsPending(Ft(ke({},t),{sourceControl:e}))}disable(t={}){let e=this._parentMarkedDirty(t.onlySelf);this.status=G0,this.errors=null,this._forEachChild(o=>{o.disable(Ft(ke({},t),{onlySelf:!0}))}),this._updateValue();let r=t.sourceControl??this;t.emitEvent!==!1&&(this._events.next(new CS(this.value,r)),this._events.next(new Jg(this.status,r)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Ft(ke({},t),{skipPristineCheck:e}),this),this._onDisabledChange.forEach(o=>o(!0))}enable(t={}){let e=this._parentMarkedDirty(t.onlySelf);this.status=W0,this._forEachChild(r=>{r.enable(Ft(ke({},t),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent}),this._updateAncestors(Ft(ke({},t),{skipPristineCheck:e}),this),this._onDisabledChange.forEach(r=>r(!1))}_updateAncestors(t,e){this._parent&&!t.onlySelf&&(this._parent.updateValueAndValidity(t),t.skipPristineCheck||this._parent._updatePristine({},e),this._parent._updateTouched({},e))}setParent(t){this._parent=t}getRawValue(){return this.value}updateValueAndValidity(t={}){if(this._setInitialStatus(),this._updateValue(),this.enabled){let r=this._cancelExistingSubscription();this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===W0||this.status===Qg)&&this._runAsyncValidator(r,t.emitEvent)}let e=t.sourceControl??this;t.emitEvent!==!1&&(this._events.next(new CS(this.value,e)),this._events.next(new Jg(this.status,e)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!t.onlySelf&&this._parent.updateValueAndValidity(Ft(ke({},t),{sourceControl:e}))}_updateTreeValidity(t={emitEvent:!0}){this._forEachChild(e=>e._updateTreeValidity(t)),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?G0:W0}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(t,e){if(this.asyncValidator){this.status=Qg,this._hasOwnPendingAsyncValidator={emitEvent:e!==!1};let r=tj(this.asyncValidator(this));this._asyncValidationSubscription=r.subscribe(o=>{this._hasOwnPendingAsyncValidator=null,this.setErrors(o,{emitEvent:e,shouldHaveEmitted:t})})}}_cancelExistingSubscription(){if(this._asyncValidationSubscription){this._asyncValidationSubscription.unsubscribe();let t=this._hasOwnPendingAsyncValidator?.emitEvent??!1;return this._hasOwnPendingAsyncValidator=null,t}return!1}setErrors(t,e={}){this.errors=t,this._updateControlsErrors(e.emitEvent!==!1,this,e.shouldHaveEmitted)}get(t){let e=t;return e==null||(Array.isArray(e)||(e=e.split(".")),e.length===0)?null:e.reduce((r,o)=>r&&r._find(o),this)}getError(t,e){let r=e?this.get(e):this;return r&&r.errors?r.errors[t]:null}hasError(t,e){return!!this.getError(t,e)}get root(){let t=this;for(;t._parent;)t=t._parent;return t}_updateControlsErrors(t,e,r){this.status=this._calculateStatus(),t&&this.statusChanges.emit(this.status),(t||r)&&this._events.next(new Jg(this.status,e)),this._parent&&this._parent._updateControlsErrors(t,e,r)}_initObservables(){this.valueChanges=new Un,this.statusChanges=new Un}_calculateStatus(){return this._allControlsDisabled()?G0:this.errors?yS:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Qg)?Qg:this._anyControlsHaveStatus(yS)?yS:W0}_anyControlsHaveStatus(t){return this._anyControls(e=>e.status===t)}_anyControlsDirty(){return this._anyControls(t=>t.dirty)}_anyControlsTouched(){return this._anyControls(t=>t.touched)}_updatePristine(t,e){let r=!this._anyControlsDirty(),o=this.pristine!==r;this.pristine=r,this._parent&&!t.onlySelf&&this._parent._updatePristine(t,e),o&&this._events.next(new H0(this.pristine,e))}_updateTouched(t={},e){this.touched=this._anyControlsTouched(),this._events.next(new q0(this.touched,e)),this._parent&&!t.onlySelf&&this._parent._updateTouched(t,e)}_onDisabledChange=[];_registerOnCollectionChange(t){this._onCollectionChange=t}_setUpdateStrategy(t){DS(t)&&t.updateOn!=null&&(this._updateOn=t.updateOn)}_parentMarkedDirty(t){let e=this._parent&&this._parent.dirty;return!t&&!!e&&!this._parent._anyControlsDirty()}_find(t){return null}_assignValidators(t){this._rawValidators=Array.isArray(t)?t.slice():t,this._composedValidatorFn=X0e(this._rawValidators)}_assignAsyncValidators(t){this._rawAsyncValidators=Array.isArray(t)?t.slice():t,this._composedAsyncValidatorFn=Y0e(this._rawAsyncValidators)}},ty=class extends ey{constructor(t,e,r){super(rM(e),oM(r,e)),this.controls=t,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}controls;registerControl(t,e){return this.controls[t]?this.controls[t]:(this.controls[t]=e,e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange),e)}addControl(t,e,r={}){this.registerControl(t,e),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}removeControl(t,e={}){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],this.updateValueAndValidity({emitEvent:e.emitEvent}),this._onCollectionChange()}setControl(t,e,r={}){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],e&&this.registerControl(t,e),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}contains(t){return this.controls.hasOwnProperty(t)&&this.controls[t].enabled}setValue(t,e={}){uj(this,!0,t),Object.keys(t).forEach(r=>{cj(this,!0,r),this.controls[r].setValue(t[r],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(t,e={}){t!=null&&(Object.keys(t).forEach(r=>{let o=this.controls[r];o&&o.patchValue(t[r],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e))}reset(t={},e={}){this._forEachChild((r,o)=>{r.reset(t?t[o]:null,{onlySelf:!0,emitEvent:e.emitEvent})}),this._updatePristine(e,this),this._updateTouched(e,this),this.updateValueAndValidity(e)}getRawValue(){return this._reduceChildren({},(t,e,r)=>(t[r]=e.getRawValue(),t))}_syncPendingControls(){let t=this._reduceChildren(!1,(e,r)=>r._syncPendingControls()?!0:e);return t&&this.updateValueAndValidity({onlySelf:!0}),t}_forEachChild(t){Object.keys(this.controls).forEach(e=>{let r=this.controls[e];r&&t(r,e)})}_setUpControls(){this._forEachChild(t=>{t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(t){for(let[e,r]of Object.entries(this.controls))if(this.contains(e)&&t(r))return!0;return!1}_reduceValue(){let t={};return this._reduceChildren(t,(e,r,o)=>((r.enabled||this.disabled)&&(e[o]=r.value),e))}_reduceChildren(t,e){let r=t;return this._forEachChild((o,i)=>{r=e(r,o,i)}),r}_allControlsDisabled(){for(let t of Object.keys(this.controls))if(this.controls[t].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(t){return this.controls.hasOwnProperty(t)?this.controls[t]:null}};var JO=class extends ty{};var X0=new Ge("",{providedIn:"root",factory:()=>kS}),kS="always";function dj(n,t){return[...t.path,n]}function _S(n,t,e=kS){iM(n,t),t.valueAccessor.writeValue(n.value),(n.disabled||e==="always")&&t.valueAccessor.setDisabledState?.(n.disabled),Q0e(n,t),ebe(n,t),J0e(n,t),Z0e(n,t)}function GG(n,t,e=!0){let r=()=>{};t.valueAccessor&&(t.valueAccessor.registerOnChange(r),t.valueAccessor.registerOnTouched(r)),IS(n,t),n&&(t._invokeOnDestroyCallbacks(),n._registerOnCollectionChange(()=>{}))}function SS(n,t){n.forEach(e=>{e.registerOnValidatorChange&&e.registerOnValidatorChange(t)})}function Z0e(n,t){if(t.valueAccessor.setDisabledState){let e=r=>{t.valueAccessor.setDisabledState(r)};n.registerOnDisabledChange(e),t._registerOnDestroy(()=>{n._unregisterOnDisabledChange(e)})}}function iM(n,t){let e=aj(n);t.validator!==null?n.setValidators(zG(e,t.validator)):typeof e=="function"&&n.setValidators([e]);let r=lj(n);t.asyncValidator!==null?n.setAsyncValidators(zG(r,t.asyncValidator)):typeof r=="function"&&n.setAsyncValidators([r]);let o=()=>n.updateValueAndValidity();SS(t._rawValidators,o),SS(t._rawAsyncValidators,o)}function IS(n,t){let e=!1;if(n!==null){if(t.validator!==null){let o=aj(n);if(Array.isArray(o)&&o.length>0){let i=o.filter(s=>s!==t.validator);i.length!==o.length&&(e=!0,n.setValidators(i))}}if(t.asyncValidator!==null){let o=lj(n);if(Array.isArray(o)&&o.length>0){let i=o.filter(s=>s!==t.asyncValidator);i.length!==o.length&&(e=!0,n.setAsyncValidators(i))}}}let r=()=>{};return SS(t._rawValidators,r),SS(t._rawAsyncValidators,r),e}function Q0e(n,t){t.valueAccessor.registerOnChange(e=>{n._pendingValue=e,n._pendingChange=!0,n._pendingDirty=!0,n.updateOn==="change"&&pj(n,t)})}function J0e(n,t){t.valueAccessor.registerOnTouched(()=>{n._pendingTouched=!0,n.updateOn==="blur"&&n._pendingChange&&pj(n,t),n.updateOn!=="submit"&&n.markAsTouched()})}function pj(n,t){n._pendingDirty&&n.markAsDirty(),n.setValue(n._pendingValue,{emitModelToViewChange:!1}),t.viewToModelUpdate(n._pendingValue),n._pendingChange=!1}function ebe(n,t){let e=(r,o)=>{t.valueAccessor.writeValue(r),o&&t.viewToModelUpdate(r)};n.registerOnChange(e),t._registerOnDestroy(()=>{n._unregisterOnChange(e)})}function fj(n,t){n==null,iM(n,t)}function tbe(n,t){return IS(n,t)}function hj(n,t){if(!n.hasOwnProperty("model"))return!1;let e=n.model;return e.isFirstChange()?!0:!Object.is(t,e.currentValue)}function nbe(n){return Object.getPrototypeOf(n.constructor)===ES}function mj(n,t){n._syncPendingControls(),t.forEach(e=>{let r=e.control;r.updateOn==="submit"&&r._pendingChange&&(e.viewToModelUpdate(r._pendingValue),r._pendingChange=!1)})}function gj(n,t){if(!t)return null;Array.isArray(t);let e,r,o;return t.forEach(i=>{i.constructor===vo?e=i:nbe(i)?r=i:o=i}),o||r||e||null}function rbe(n,t){let e=n.indexOf(t);e>-1&&n.splice(e,1)}var obe={provide:id,useExisting:Ni(()=>sd)},j0=Promise.resolve(),sd=(()=>{class n extends id{callSetDisabledState;get submitted(){return Os(this.submittedReactive)}_submitted=Lg(()=>this.submittedReactive());submittedReactive=kh(!1);_directives=new Set;form;ngSubmit=new Un;options;constructor(e,r,o){super(),this.callSetDisabledState=o,this.form=new ty({},tM(e),nM(r))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(e){j0.then(()=>{let r=this._findContainer(e.path);e.control=r.registerControl(e.name,e.control),_S(e.control,e,this.callSetDisabledState),e.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(e)})}getControl(e){return this.form.get(e.path)}removeControl(e){j0.then(()=>{let r=this._findContainer(e.path);r&&r.removeControl(e.name),this._directives.delete(e)})}addFormGroup(e){j0.then(()=>{let r=this._findContainer(e.path),o=new ty({});fj(o,e),r.registerControl(e.name,o),o.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(e){j0.then(()=>{let r=this._findContainer(e.path);r&&r.removeControl(e.name)})}getFormGroup(e){return this.form.get(e.path)}updateModel(e,r){j0.then(()=>{this.form.get(e.path).setValue(r)})}setValue(e){this.control.setValue(e)}onSubmit(e){return this.submittedReactive.set(!0),mj(this.form,this._directives),this.ngSubmit.emit(e),e?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(e=void 0){this.form.reset(e),this.submittedReactive.set(!1)}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.form._updateOn=this.options.updateOn)}_findContainer(e){return e.pop(),e.length?this.form.get(e):this.form}static \u0275fac=function(r){return new(r||n)(Be(ry,10),Be(TS,10),Be(X0,8))};static \u0275dir=yn({type:n,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(r,o){r&1&&_e("submit",function(s){return o.onSubmit(s)})("reset",function(){return o.onReset()})},inputs:{options:[0,"ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],standalone:!1,features:[Pi([obe]),Or]})}return n})();function jG(n,t){let e=n.indexOf(t);e>-1&&n.splice(e,1)}function HG(n){return typeof n=="object"&&n!==null&&Object.keys(n).length===2&&"value"in n&&"disabled"in n}var K0=class extends ey{defaultValue=null;_onChange=[];_pendingValue;_pendingChange=!1;constructor(t=null,e,r){super(rM(e),oM(r,e)),this._applyFormState(t),this._setUpdateStrategy(e),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),DS(e)&&(e.nonNullable||e.initialValueIsDefault)&&(HG(t)?this.defaultValue=t.value:this.defaultValue=t)}setValue(t,e={}){this.value=this._pendingValue=t,this._onChange.length&&e.emitModelToViewChange!==!1&&this._onChange.forEach(r=>r(this.value,e.emitViewToModelChange!==!1)),this.updateValueAndValidity(e)}patchValue(t,e={}){this.setValue(t,e)}reset(t=this.defaultValue,e={}){this._applyFormState(t),this.markAsPristine(e),this.markAsUntouched(e),this.setValue(this.value,e),this._pendingChange=!1}_updateValue(){}_anyControls(t){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(t){this._onChange.push(t)}_unregisterOnChange(t){jG(this._onChange,t)}registerOnDisabledChange(t){this._onDisabledChange.push(t)}_unregisterOnDisabledChange(t){jG(this._onDisabledChange,t)}_forEachChild(t){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(t){HG(t)?(this.value=this._pendingValue=t.value,t.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=t}};var ibe=n=>n instanceof K0;var sbe={provide:Ph,useExisting:Ni(()=>ka)},qG=Promise.resolve(),ka=(()=>{class n extends Ph{_changeDetectorRef;callSetDisabledState;control=new K0;static ngAcceptInputType_isDisabled;_registered=!1;viewModel;name="";isDisabled;model;options;update=new Un;constructor(e,r,o,i,s,a){super(),this._changeDetectorRef=s,this.callSetDisabledState=a,this._parent=e,this._setValidators(r),this._setAsyncValidators(o),this.valueAccessor=gj(this,i)}ngOnChanges(e){if(this._checkForErrors(),!this._registered||"name"in e){if(this._registered&&(this._checkName(),this.formDirective)){let r=e.name.previousValue;this.formDirective.removeControl({name:r,path:this._getPath(r)})}this._setUpControl()}"isDisabled"in e&&this._updateDisabled(e),hj(e,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){_S(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(e){qG.then(()=>{this.control.setValue(e,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(e){let r=e.isDisabled.currentValue,o=r!==0&&Ia(r);qG.then(()=>{o&&!this.control.disabled?this.control.disable():!o&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(e){return this._parent?dj(e,this._parent):[e]}static \u0275fac=function(r){return new(r||n)(Be(id,9),Be(ry,10),Be(TS,10),Be(ny,10),Be(Sa,8),Be(X0,8))};static \u0275dir=yn({type:n,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"],options:[0,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],standalone:!1,features:[Pi([sbe]),Or,Ri]})}return n})(),Vi=(()=>{class n{static \u0275fac=function(r){return new(r||n)};static \u0275dir=yn({type:n,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""],standalone:!1})}return n})(),abe={provide:ny,useExisting:Ni(()=>Y0),multi:!0},Y0=(()=>{class n extends ES{writeValue(e){let r=e??"";this.setProperty("value",r)}registerOnChange(e){this.onChange=r=>{e(r==""?null:parseFloat(r))}}static \u0275fac=(()=>{let e;return function(o){return(e||(e=Go(n)))(o||n)}})();static \u0275dir=yn({type:n,selectors:[["input","type","number","formControlName",""],["input","type","number","formControl",""],["input","type","number","ngModel",""]],hostBindings:function(r,o){r&1&&_e("input",function(s){return o.onChange(s.target.value)})("blur",function(){return o.onTouched()})},standalone:!1,features:[Pi([abe]),Or]})}return n})();var yj=new Ge("");var lbe={provide:id,useExisting:Ni(()=>Fh)},Fh=(()=>{class n extends id{callSetDisabledState;get submitted(){return Os(this._submittedReactive)}set submitted(e){this._submittedReactive.set(e)}_submitted=Lg(()=>this._submittedReactive());_submittedReactive=kh(!1);_oldForm;_onCollectionChange=()=>this._updateDomValue();directives=[];form=null;ngSubmit=new Un;constructor(e,r,o){super(),this.callSetDisabledState=o,this._setValidators(e),this._setAsyncValidators(r)}ngOnChanges(e){this._checkFormPresent(),e.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(IS(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(e){let r=this.form.get(e.path);return _S(r,e,this.callSetDisabledState),r.updateValueAndValidity({emitEvent:!1}),this.directives.push(e),r}getControl(e){return this.form.get(e.path)}removeControl(e){GG(e.control||null,e,!1),rbe(this.directives,e)}addFormGroup(e){this._setUpFormContainer(e)}removeFormGroup(e){this._cleanUpFormContainer(e)}getFormGroup(e){return this.form.get(e.path)}addFormArray(e){this._setUpFormContainer(e)}removeFormArray(e){this._cleanUpFormContainer(e)}getFormArray(e){return this.form.get(e.path)}updateModel(e,r){this.form.get(e.path).setValue(r)}onSubmit(e){return this._submittedReactive.set(!0),mj(this.form,this.directives),this.ngSubmit.emit(e),this.form._events.next(new ZO(this.control)),e?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(e=void 0){this.form.reset(e),this._submittedReactive.set(!1),this.form._events.next(new QO(this.form))}_updateDomValue(){this.directives.forEach(e=>{let r=e.control,o=this.form.get(e.path);r!==o&&(GG(r||null,e),ibe(o)&&(_S(o,e,this.callSetDisabledState),e.control=o))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(e){let r=this.form.get(e.path);fj(r,e),r.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(e){if(this.form){let r=this.form.get(e.path);r&&tbe(r,e)&&r.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){iM(this.form,this),this._oldForm&&IS(this._oldForm,this)}_checkFormPresent(){this.form}static \u0275fac=function(r){return new(r||n)(Be(ry,10),Be(TS,10),Be(X0,8))};static \u0275dir=yn({type:n,selectors:[["","formGroup",""]],hostBindings:function(r,o){r&1&&_e("submit",function(s){return o.onSubmit(s)})("reset",function(){return o.onReset()})},inputs:{form:[0,"formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],standalone:!1,features:[Pi([lbe]),Or,Ri]})}return n})();var cbe={provide:Ph,useExisting:Ni(()=>Lh)},Lh=(()=>{class n extends Ph{_ngModelWarningConfig;_added=!1;viewModel;control;name=null;set isDisabled(e){}model;update=new Un;static _ngModelWarningSentOnce=!1;_ngModelWarningSent=!1;constructor(e,r,o,i,s){super(),this._ngModelWarningConfig=s,this._parent=e,this._setValidators(r),this._setAsyncValidators(o),this.valueAccessor=gj(this,i)}ngOnChanges(e){this._added||this._setUpControl(),hj(e,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}get path(){return dj(this.name==null?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this.control=this.formDirective.addControl(this),this._added=!0}static \u0275fac=function(r){return new(r||n)(Be(id,13),Be(ry,10),Be(TS,10),Be(ny,10),Be(yj,8))};static \u0275dir=yn({type:n,selectors:[["","formControlName",""]],inputs:{name:[0,"formControlName","name"],isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"]},outputs:{update:"ngModelChange"},standalone:!1,features:[Pi([cbe]),Or,Ri]})}return n})(),ube={provide:ny,useExisting:Ni(()=>Ps),multi:!0};function xj(n,t){return n==null?`${t}`:(t&&typeof t=="object"&&(t="Object"),`${n}: ${t}`.slice(0,50))}function dbe(n){return n.split(":")[0]}var Ps=(()=>{class n extends ES{value;_optionMap=new Map;_idCounter=0;set compareWith(e){this._compareWith=e}_compareWith=Object.is;writeValue(e){this.value=e;let r=this._getOptionId(e),o=xj(r,e);this.setProperty("value",o)}registerOnChange(e){this.onChange=r=>{this.value=this._getOptionValue(r),e(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(e){for(let r of this._optionMap.keys())if(this._compareWith(this._optionMap.get(r),e))return r;return null}_getOptionValue(e){let r=dbe(e);return this._optionMap.has(r)?this._optionMap.get(r):e}static \u0275fac=(()=>{let e;return function(o){return(e||(e=Go(n)))(o||n)}})();static \u0275dir=yn({type:n,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(r,o){r&1&&_e("change",function(s){return o.onChange(s.target.value)})("blur",function(){return o.onTouched()})},inputs:{compareWith:"compareWith"},standalone:!1,features:[Pi([ube]),Or]})}return n})(),fc=(()=>{class n{_element;_renderer;_select;id;constructor(e,r,o){this._element=e,this._renderer=r,this._select=o,this._select&&(this.id=this._select._registerOption())}set ngValue(e){this._select!=null&&(this._select._optionMap.set(this.id,e),this._setElementValue(xj(this.id,e)),this._select.writeValue(this._select.value))}set value(e){this._setElementValue(e),this._select&&this._select.writeValue(this._select.value)}_setElementValue(e){this._renderer.setProperty(this._element.nativeElement,"value",e)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static \u0275fac=function(r){return new(r||n)(Be(hr),Be(Mi),Be(Ps,9))};static \u0275dir=yn({type:n,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"},standalone:!1})}return n})(),pbe={provide:ny,useExisting:Ni(()=>vj),multi:!0};function KG(n,t){return n==null?`${t}`:(typeof t=="string"&&(t=`'${t}'`),t&&typeof t=="object"&&(t="Object"),`${n}: ${t}`.slice(0,50))}function fbe(n){return n.split(":")[0]}var vj=(()=>{class n extends ES{value;_optionMap=new Map;_idCounter=0;set compareWith(e){this._compareWith=e}_compareWith=Object.is;writeValue(e){this.value=e;let r;if(Array.isArray(e)){let o=e.map(i=>this._getOptionId(i));r=(i,s)=>{i._setSelected(o.indexOf(s.toString())>-1)}}else r=(o,i)=>{o._setSelected(!1)};this._optionMap.forEach(r)}registerOnChange(e){this.onChange=r=>{let o=[],i=r.selectedOptions;if(i!==void 0){let s=i;for(let a=0;a<s.length;a++){let l=s[a],c=this._getOptionValue(l.value);o.push(c)}}else{let s=r.options;for(let a=0;a<s.length;a++){let l=s[a];if(l.selected){let c=this._getOptionValue(l.value);o.push(c)}}}this.value=o,e(o)}}_registerOption(e){let r=(this._idCounter++).toString();return this._optionMap.set(r,e),r}_getOptionId(e){for(let r of this._optionMap.keys())if(this._compareWith(this._optionMap.get(r)._value,e))return r;return null}_getOptionValue(e){let r=fbe(e);return this._optionMap.has(r)?this._optionMap.get(r)._value:e}static \u0275fac=(()=>{let e;return function(o){return(e||(e=Go(n)))(o||n)}})();static \u0275dir=yn({type:n,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(r,o){r&1&&_e("change",function(s){return o.onChange(s.target)})("blur",function(){return o.onTouched()})},inputs:{compareWith:"compareWith"},standalone:!1,features:[Pi([pbe]),Or]})}return n})(),hc=(()=>{class n{_element;_renderer;_select;id;_value;constructor(e,r,o){this._element=e,this._renderer=r,this._select=o,this._select&&(this.id=this._select._registerOption(this))}set ngValue(e){this._select!=null&&(this._value=e,this._setElementValue(KG(this.id,e)),this._select.writeValue(this._select.value))}set value(e){this._select?(this._value=e,this._setElementValue(KG(this.id,e)),this._select.writeValue(this._select.value)):this._setElementValue(e)}_setElementValue(e){this._renderer.setProperty(this._element.nativeElement,"value",e)}_setSelected(e){this._renderer.setProperty(this._element.nativeElement,"selected",e)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static \u0275fac=function(r){return new(r||n)(Be(hr),Be(Mi),Be(vj,9))};static \u0275dir=yn({type:n,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"},standalone:!1})}return n})();function hbe(n){return typeof n=="number"?n:parseFloat(n)}var bj=(()=>{class n{_validator=xS;_onChange;_enabled;ngOnChanges(e){if(this.inputName in e){let r=this.normalizeInput(e[this.inputName].currentValue);this._enabled=this.enabled(r),this._validator=this._enabled?this.createValidator(r):xS,this._onChange&&this._onChange()}}validate(e){return this._validator(e)}registerOnValidatorChange(e){this._onChange=e}enabled(e){return e!=null}static \u0275fac=function(r){return new(r||n)};static \u0275dir=yn({type:n,features:[Ri]})}return n})();var mbe={provide:ry,useExisting:Ni(()=>sM),multi:!0},sM=(()=>{class n extends bj{min;inputName="min";normalizeInput=e=>hbe(e);createValidator=e=>QG(e);static \u0275fac=(()=>{let e;return function(o){return(e||(e=Go(n)))(o||n)}})();static \u0275dir=yn({type:n,selectors:[["input","type","number","min","","formControlName",""],["input","type","number","min","","formControl",""],["input","type","number","min","","ngModel",""]],hostVars:1,hostBindings:function(r,o){r&2&&wa("min",o._enabled?o.min:null)},inputs:{min:"min"},standalone:!1,features:[Pi([mbe]),Or]})}return n})(),gbe={provide:ry,useExisting:Ni(()=>ad),multi:!0};var ad=(()=>{class n extends bj{required;inputName="required";normalizeInput=Ia;createValidator=e=>JG;enabled(e){return e}static \u0275fac=(()=>{let e;return function(o){return(e||(e=Go(n)))(o||n)}})();static \u0275dir=yn({type:n,selectors:[["","required","","formControlName","",3,"type","checkbox"],["","required","","formControl","",3,"type","checkbox"],["","required","","ngModel","",3,"type","checkbox"]],hostVars:1,hostBindings:function(r,o){r&2&&wa("required",o._enabled?"":null)},inputs:{required:"required"},standalone:!1,features:[Pi([gbe]),Or]})}return n})();var wj=(()=>{class n{static \u0275fac=function(r){return new(r||n)};static \u0275mod=Oo({type:n});static \u0275inj=Ao({})}return n})(),eM=class extends ey{constructor(t,e,r){super(rM(e),oM(r,e)),this.controls=t,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}controls;at(t){return this.controls[this._adjustIndex(t)]}push(t,e={}){this.controls.push(t),this._registerControl(t),this.updateValueAndValidity({emitEvent:e.emitEvent}),this._onCollectionChange()}insert(t,e,r={}){this.controls.splice(t,0,e),this._registerControl(e),this.updateValueAndValidity({emitEvent:r.emitEvent})}removeAt(t,e={}){let r=this._adjustIndex(t);r<0&&(r=0),this.controls[r]&&this.controls[r]._registerOnCollectionChange(()=>{}),this.controls.splice(r,1),this.updateValueAndValidity({emitEvent:e.emitEvent})}setControl(t,e,r={}){let o=this._adjustIndex(t);o<0&&(o=0),this.controls[o]&&this.controls[o]._registerOnCollectionChange(()=>{}),this.controls.splice(o,1),e&&(this.controls.splice(o,0,e),this._registerControl(e)),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(t,e={}){uj(this,!1,t),t.forEach((r,o)=>{cj(this,!1,o),this.at(o).setValue(r,{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(t,e={}){t!=null&&(t.forEach((r,o)=>{this.at(o)&&this.at(o).patchValue(r,{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e))}reset(t=[],e={}){this._forEachChild((r,o)=>{r.reset(t[o],{onlySelf:!0,emitEvent:e.emitEvent})}),this._updatePristine(e,this),this._updateTouched(e,this),this.updateValueAndValidity(e)}getRawValue(){return this.controls.map(t=>t.getRawValue())}clear(t={}){this.controls.length<1||(this._forEachChild(e=>e._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:t.emitEvent}))}_adjustIndex(t){return t<0?t+this.length:t}_syncPendingControls(){let t=this.controls.reduce((e,r)=>r._syncPendingControls()?!0:e,!1);return t&&this.updateValueAndValidity({onlySelf:!0}),t}_forEachChild(t){this.controls.forEach((e,r)=>{t(e,r)})}_updateValue(){this.value=this.controls.filter(t=>t.enabled||this.disabled).map(t=>t.value)}_anyControls(t){return this.controls.some(e=>e.enabled&&t(e))}_setUpControls(){this._forEachChild(t=>this._registerControl(t))}_allControlsDisabled(){for(let t of this.controls)if(t.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(t){t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange)}_find(t){return this.at(t)??null}};function XG(n){return!!n&&(n.asyncValidators!==void 0||n.validators!==void 0||n.updateOn!==void 0)}var oy=(()=>{class n{useNonNullable=!1;get nonNullable(){let e=new n;return e.useNonNullable=!0,e}group(e,r=null){let o=this._reduceControls(e),i={};return XG(r)?i=r:r!==null&&(i.validators=r.validator,i.asyncValidators=r.asyncValidator),new ty(o,i)}record(e,r=null){let o=this._reduceControls(e);return new JO(o,r)}control(e,r,o){let i={};return this.useNonNullable?(XG(r)?i=r:(i.validators=r,i.asyncValidators=o),new K0(e,Ft(ke({},i),{nonNullable:!0}))):new K0(e,r,o)}array(e,r,o){let i=e.map(s=>this._createControl(s));return new eM(i,r,o)}_reduceControls(e){let r={};return Object.keys(e).forEach(o=>{r[o]=this._createControl(e[o])}),r}_createControl(e){if(e instanceof K0)return e;if(e instanceof ey)return e;if(Array.isArray(e)){let r=e[0],o=e.length>1?e[1]:null,i=e.length>2?e[2]:null;return this.control(r,o,i)}else return this.control(e)}static \u0275fac=function(r){return new(r||n)};static \u0275prov=Me({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var Fs=(()=>{class n{static withConfig(e){return{ngModule:n,providers:[{provide:X0,useValue:e.callSetDisabledState??kS}]}}static \u0275fac=function(r){return new(r||n)};static \u0275mod=Oo({type:n});static \u0275inj=Ao({imports:[wj]})}return n})(),Ls=(()=>{class n{static withConfig(e){return{ngModule:n,providers:[{provide:yj,useValue:e.warnOnNgModelWithFormControl??"always"},{provide:X0,useValue:e.callSetDisabledState??kS}]}}static \u0275fac=function(r){return new(r||n)};static \u0275mod=Oo({type:n});static \u0275inj=Ao({imports:[wj]})}return n})();var ybe=()=>["/community"];function xbe(n,t){if(n&1&&(E(0,"div",57)(1,"div",58),ce(2,"i",17),S(),E(3,"h5"),O(4),S(),E(5,"p"),O(6),S()()),n&2){let e=t.$implicit;z(2),j4(e.icon),z(2),Ye(e.title),z(2),Tt(" ",e.description," ")}}function vbe(n,t){if(n&1&&(E(0,"div",59)(1,"h1"),O(2),S(),E(3,"p"),O(4),S()()),n&2){let e=t.$implicit;z(2),Ye(e.text1),z(2),Ye(e.text2)}}var NS=class n{authService=Q(xn);notificationService=Q(Vn);router=Q(Ut);email=localStorage.getItem("email");userName=localStorage.getItem("userName");isAdmin=localStorage.getItem("isAdmin");isFitnessCenter=localStorage.getItem("isFitnessCenter");getStarted(){this.email?this.isAdmin?this.router.navigate(["/admin"]):this.isFitnessCenter?this.router.navigate(["/center"]):this.router.navigate(["/user"]):this.router.navigate(["/login"])}features=[{text1:"98%",text2:"Satisfied Users"},{text1:"500+",text2:"Registered Clubs"},{text1:"2500+",text2:"Members"}];services=[{title:"Customized Training Programs",description:"Personal trainers create tailored programs based on your goals.",icon:"fa fa-dumbbell"},{title:"Personalized Nutrition",description:"Certified nutritionists offer guidance to meet your fitness objectives.",icon:"fa-solid fa-weight-hanging"},{title:"Flexible Scheduling",description:"Schedule appointments to suit your needs.",icon:"fa fa-calendar-alt"},{title:"Step-by-Step Training",description:"Training sessions tailored to ensure an effective fitness journey.",icon:"fa fa-running"}];static \u0275fac=function(e){return new(e||n)};static \u0275cmp=Ct({type:n,selectors:[["app-home"]],decls:222,vars:4,consts:[[1,"navbar"],[1,"main"],[1,"hero-outer"],[1,"hero"],[1,"hero-left"],[1,"s"],[1,"hero-button",3,"click"],[1,"fas","fa-angle-right"],[1,"hero-right"],["src","https://pngimg.com/d/bodybuilding_PNG83.png","alt",""],[1,"hero-inner"],[1,"hero-text"],[1,"content"],[1,"fa-brands","fa-slack"],[1,"about-us"],[1,"about-us-left"],[2,"color","#fff"],[2,"color","var(--shade-1)"],[1,"about-us-right"],["src","i1.png","alt",""],[1,"community-container"],[1,"community-upper"],[1,"cu1-content"],[3,"routerLink"],[1,"community-lower"],[1,"cl1"],[1,"cl1-inner"],[1,"cl2"],[1,"cl2-content"],["src","https://formagym.com/wp-content/uploads/2019/03/shutterstock_1065905168-1.jpg","alt",""],[1,"service-content"],[2,"color","var(--shade-1)","margin","0"],[2,"color","var(--light)"],[1,"services"],["class","service",4,"ngFor","ngForOf"],["id","plans",1,"container_sub"],[1,"sub-top"],[1,"subscription-plans"],[1,"plan","basic"],[1,"price",2,"font-weight","normal","margin","0px","font-size","19px"],[2,"font-family","'Times New Roman', Times, serif"],[1,"price",2,"margin","0px"],[1,"subscribe-btn"],[1,"plan","standard"],[1,"plan","premium"],[1,"faq-container"],["id","contact",1,"contacts"],[1,"contact-outer"],["class","feature",4,"ngFor","ngForOf"],[1,"contact-inner"],[1,"contact-left"],["type","text","placeholder","Name"],["type","text","placeholder","Email"],["placeholder","Message"],[1,"submit-btn"],[1,"contact-right"],["src","https://th.bing.com/th/id/OIP.Q5-7VFX0tplomNxMpkZq2wEgDY?rs=1&pid=ImgDetMain","alt",""],[1,"service"],[1,"service-logo"],[1,"feature"]],template:function(e,r){e&1&&(E(0,"div",0),ce(1,"app-navbar"),S(),E(2,"div",1)(3,"div",2)(4,"div",3)(5,"div",4)(6,"h1"),O(7," SHAPE YOUR "),E(8,"span",5),O(9,"IDEAL BODY"),S(),ce(10,"br"),O(11," WITH OUR "),E(12,"span"),O(13,"PERSONALIZED"),S(),ce(14,"br"),E(15,"span",5),O(16," FITNESS COMPANION"),S()(),E(17,"p"),O(18," Explore a holistic approach to fitness and wellness with FitGenie. Dive into a personalized journey combining AI-driven workout plans, immersive VR sessions, and AR-based challenges. Engage with interactive diet plans, mental wellness tools, and community-driven fitness goals\u2014all on a single platform. "),S(),E(19,"button",6),_e("click",function(){return r.getStarted()}),O(20,"Get Started\xA0"),ce(21,"i",7),S()(),E(22,"div",8),ce(23,"img",9),S()(),E(24,"div",10)(25,"div",11)(26,"span"),O(27,"NO PAIN NO GAIN"),S()(),E(28,"div",12)(29,"ul")(30,"li"),ce(31,"i",13),O(32,"\xA0BEGINNER FRIENDLY\xA0 "),S(),E(33,"li"),ce(34,"i",13),O(35,"\xA0PERSONALIZED WORKOUT PLANS\xA0 "),S(),E(36,"li"),ce(37,"i",13),O(38,"\xA0NUTRITION GUIDANCE\xA0 "),S(),E(39,"li"),ce(40,"i",13),O(41,"\xA0PROGRESS TRACKING\xA0 "),S(),E(42,"li"),ce(43,"i",13),O(44,"\xA0COMMUNITY SUPPORT\xA0 "),S()()()()(),E(45,"div",14)(46,"div",15)(47,"section"),O(48,"ABOUT US"),S(),E(49,"p"),O(50," Welcome to "),E(51,"span",16)(52,"span",17),O(53,"FIT"),S(),O(54,"GENIE"),S(),O(55,", where your fitness journey is our top priority. Our mission is to empower individuals to achieve their health and wellness goals through personalized workout plans, expert nutrition guidance, and progress tracking tools. With access to virtual classes led by professional trainers and a supportive community of fitness enthusiasts, you'll find the motivation and resources you need to succeed. Our state-of-the-art facilities and innovative approach to fitness ensure that everyone, regardless of experience level, can enjoy a fulfilling and effective fitness journey. Join us today and take the first step towards a healthier, happier you! "),S()(),E(56,"div",18),ce(57,"img",19),S()(),E(58,"div",20)(59,"div",21)(60,"div",22)(61,"h1"),O(62,"Connect, "),E(63,"span",17),O(64,"Collaborate"),S(),O(65,", Grow \u2013 The Power of Community!"),S(),E(66,"p"),O(67," Connect with like-minded individuals, share your fitness journey, and discover new opportunities. Join our growing community of fitness enthusiasts, and discover how FitGenie can help you stay motivated, focused, and healthy. "),S(),E(68,"a",23)(69,"button"),O(70,"JOIN NOW"),S()()()(),E(71,"div",24)(72,"section",25),ce(73,"div",26),S(),E(74,"section",27)(75,"div",28),ce(76,"img",29),S()()()(),E(77,"div",30)(78,"p",31),O(79,"\u2500\u2500 Our Services"),S(),E(80,"h2",32),O(81,"Our Services For You"),S(),E(82,"div",33),Ne(83,xbe,7,5,"div",34),S()(),E(84,"div",35)(85,"div",36)(86,"h1"),O(87," Subscription"),ce(88,"br"),O(89," Plans "),S(),E(90,"p"),O(91," Choose the subscription plan that fits you the best, offering the perfect balance of features, affordability, and flexibility to meet your needs. "),S()(),E(92,"div",37)(93,"div",38)(94,"h3"),O(95,"Basic Plan"),S(),E(96,"p",39)(97,"span",40),O(98,"\u20B9"),S(),E(99,"s"),O(100,"399"),S(),O(101,"/month "),S(),E(102,"p",41)(103,"span",40),O(104,"\u20B9"),S(),O(105," 249/month "),S(),E(106,"ul")(107,"li"),O(108,"Access to Home Workouts"),S(),E(109,"li"),O(110,"AI-Powered Diet Plans"),S(),E(111,"li"),O(112,"Progress Tracking"),S(),E(113,"li"),O(114,"Basic support"),S(),E(115,"li"),O(116,"Community access"),S()(),E(117,"button",42),O(118,"Choose Plan"),S()(),E(119,"div",43)(120,"h3"),O(121,"Standard Plan"),S(),E(122,"p",39)(123,"span",40),O(124,"\u20B9"),S(),E(125,"s"),O(126,"699"),S(),O(127,"/month "),S(),E(128,"p",41)(129,"span",40),O(130,"\u20B9"),S(),O(131," 499/month "),S(),E(132,"ul")(133,"li"),O(134,"All Basic Plan Features"),S(),E(135,"li"),O(136,"Access to Partner Gyms"),S(),E(137,"li"),O(138,"Live Virtual Classes"),S(),E(139,"li"),O(140,"Priority support"),S(),E(141,"li"),O(142,"Exclusive community events"),S()(),E(143,"button",42),O(144,"Choose Plan"),S()(),E(145,"div",44)(146,"h3"),O(147,"Premium Plan"),S(),E(148,"p",39)(149,"span",40),O(150,"\u20B9"),S(),E(151,"s"),O(152,"1499"),S(),O(153,"/month "),S(),E(154,"p",41)(155,"span",40),O(156,"\u20B9"),S(),O(157," 999/month "),S(),E(158,"ul")(159,"li"),O(160,"All Standard Plan Features"),S(),E(161,"li"),O(162,"Personalized Coaching"),S(),E(163,"li"),O(164,"Advanced Health Analytics"),S(),E(165,"li"),O(166,"24/7 dedicated support"),S(),E(167,"li"),O(168,"Exclusive Discounts"),S()(),E(169,"button",42),O(170,"Choose Plan"),S()()()(),E(171,"div",45)(172,"h2"),O(173,"Frequently Asked Questions"),S(),E(174,"details")(175,"summary"),O(176,"How can I pay for my subscription?"),S(),E(177,"p"),O(178," We accept various payment methods including credit/debit cards and online payment gateways. You can choose the payment method that is most convenient for you during the checkout process. "),S()(),E(179,"details")(180,"summary"),O(181,"Can I cancel or reschedule my training session?"),S(),E(182,"p"),O(183," Yes, you can cancel or reschedule your training session by contacting our customer support team or using our online session management system. Please make sure to notify us at least 24 hours in advance to avoid any cancellation fees. "),S()(),E(184,"details")(185,"summary"),O(186,"Do you have subscription plans?"),S(),E(187,"p"),O(188," Yes, we offer a variety of subscription plans to suit your needs. Please refer to our subscription plans section for detailed information or contact our support team for assistance. "),S()(),E(189,"details")(190,"summary"),O(191,"What fitness services do you offer?"),S(),E(192,"p"),O(193," We offer a wide range of fitness services including personalized training programs, nutrition guidance, virtual classes, and progress tracking. Please refer to our Services section for more details. "),S()(),E(194,"details")(195,"summary"),O(196,"How do I book a training session?"),S(),E(197,"p"),O(198,' To book a training session, simply click on the "Book Session" button on our homepage. You will be directed to our booking system where you can choose your preferred date and time. '),S()(),E(199,"details")(200,"summary"),O(201,"Is my personal information secure?"),S(),E(202,"p"),O(203," Yes, we take the security of your personal information very seriously. Our platform uses the latest encryption technology to ensure that your data is protected at all times. "),S()()(),E(204,"div",46)(205,"div",47),Ne(206,vbe,5,2,"div",48),S(),E(207,"div",49)(208,"div",50)(209,"h1"),O(210,"CONTACT US"),S(),E(211,"p"),O(212," Feel free to reach out to us at our contact form or email address. "),S(),E(213,"form"),ce(214,"input",51)(215,"input",52)(216,"textarea",53),E(217,"button",54),O(218,"Submit"),S()()(),E(219,"div",55),ce(220,"img",56),S()()()(),ce(221,"app-footer")),e&2&&(z(68),re("routerLink",Fi(3,ybe)),z(15),re("ngForOf",r.services),z(123),re("ngForOf",r.features))},dependencies:[Xr,Er,Kn,Li,Fs,Vi,$i,sd],styles:[".hero[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.hero-left[_ngcontent-%COMP%]{width:50%;margin-right:16px;font-size:larger}.hero-left[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--light);margin:22px 0;text-align:justify}button[_ngcontent-%COMP%]{border:none;background-color:transparent;color:var(--light);font-weight:600;padding:10px 20px;border-radius:4px;font-size:larger;border:1px solid var(--light)}.hero-button[_ngcontent-%COMP%]:hover{background-color:var(--shade-1);color:var(--dark);border:none}.s[_ngcontent-%COMP%]{color:var(--shade-1)}.hero-left[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{color:#dadada}.hero-right[_ngcontent-%COMP%]{height:500px}.hero-right[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.hero-outer[_ngcontent-%COMP%]{display:flex;flex-direction:column}.hero-inner[_ngcontent-%COMP%]{width:100%;height:100px;background-color:var(--dark);display:flex;position:relative}.hero-text[_ngcontent-%COMP%]{color:#252525;overflow:hidden;display:flex;align-items:center;justify-content:center;width:100%}.hero-text[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:10vw;font-weight:700;white-space:nowrap}.content[_ngcontent-%COMP%]{position:absolute;bottom:45px;width:100%;height:40px;background-color:var(--shade-1);transform:rotate(-3deg);padding:0 12px;display:flex;align-items:center;justify-content:center;z-index:1}.content[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{margin:0;padding:0;display:flex;gap:32px;justify-content:center;align-items:center}.content[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{color:var(--dark);font-size:larger;font-weight:600}.about-us[_ngcontent-%COMP%]{display:flex;flex-direction:row-reverse;padding:20px;margin:40px auto;gap:20px;justify-content:center;align-items:center}.about-us-left[_ngcontent-%COMP%]{width:50%;text-align:justify;color:var(--light);font-size:larger}.about-us-left[_ngcontent-%COMP%]   section[_ngcontent-%COMP%]{border:1px solid var(--shade-1);padding:10px 20px;margin-bottom:20px;font-size:larger;width:max-content;color:var(--shade-1)}.about-us-right[_ngcontent-%COMP%]{height:350px}.about-us-right[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:auto;height:100%;object-fit:cover}.service-content[_ngcontent-%COMP%]{width:100%;max-width:1365px;margin:30px auto;padding:18px;background-image:url(https://www.pngmart.com/files/13/Elegant-Pattern-PNG-Transparent-Image.png)}.services[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;gap:18px;padding:40px 0 20px}.service[_ngcontent-%COMP%]{background-color:#1c2123;border-radius:12px;width:240px;height:180px;padding:40px 10px 10px;position:relative}.service[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{color:var(--light)}.service[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#a8a8a8;font-size:13px;font-weight:600}.service-logo[_ngcontent-%COMP%]{background-color:#1c2123;border:4px solid #646464;padding:8px 10px;border-radius:50%;position:absolute;top:-20px}.service-logo[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:larger;font-weight:700;color:var(--light)}.container_sub[_ngcontent-%COMP%]{color:var(--light)}.sub-top[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:12px;max-width:1400px;margin:0 auto}.sub-top[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{color:var(--shade-1)}.sub-top[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{width:460px;font-weight:600}.subscription-plans[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;gap:18px;padding:18px 0}.plan[_ngcontent-%COMP%]{font-family:Poppins,sans-serif;width:320px;height:350px;padding:16px;background-color:var(--grey);color:var(--light);display:flex;flex-direction:column;justify-content:space-between;align-items:center;border-radius:8px;font-weight:500;box-shadow:4px 4px 10px #99999926;transition:all ease 1.2s}.plan[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{list-style:inside}.standard[_ngcontent-%COMP%]{background-color:var(--shade-1);color:var(--dark);height:400px}.standard[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border:1px solid var(--dark);color:var(--dark)}.price[_ngcontent-%COMP%]{font-size:x-large;font-weight:600}.plan[_ngcontent-%COMP%]:hover{transform:scale(1.07)}.contacts[_ngcontent-%COMP%]{display:flex;position:relative;margin:30px 0}.contact-outer[_ngcontent-%COMP%]{position:absolute;top:0;left:0;background-color:var(--shade-1);width:60%;height:100px;display:flex;justify-content:center;align-items:center;gap:30px}.feature[_ngcontent-%COMP%]{display:flex;gap:8px;flex-direction:column;align-items:center;color:var(--dark);font-weight:600}.feature[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-weight:700}.feature[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:larger;font-weight:600}.contact-inner[_ngcontent-%COMP%]{max-width:1000px;margin:0 auto;display:flex;justify-content:center;align-items:center;gap:20px;padding-top:25px}.contact-left[_ngcontent-%COMP%]{color:var(--light);padding-top:100px}.contact-left[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px;padding:20px 0}.contact-left[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:larger;font-weight:600}.contact-left[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   :is(input[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%]){width:100%;padding:10px;border:none;border-radius:4px;color:var(--light);border:1px solid var(--light);background-color:transparent}.contact-left[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{height:140px;resize:none}.contact-left[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border:none;background-color:var(--shade-1);color:var(--dark);padding:10px 20px;border-radius:4px;font-size:larger;font-weight:600;margin-top:10px}.contact-right[_ngcontent-%COMP%]{width:50%;height:500px}.contact-right[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.faq-container[_ngcontent-%COMP%]{max-width:1400px;margin:90px auto}.faq-container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:20px auto;color:var(--shade-4)}details[_ngcontent-%COMP%]{border:1px solid var(--shade-1);color:var(--light);margin:20px auto;padding:15px;cursor:pointer;border-radius:8px}details[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{padding:10px 0 0 20px}summary[_ngcontent-%COMP%]{font-weight:700;font-size:1.2rem}details[open][_ngcontent-%COMP%]{border:1px solid var(--light)}.community-container[_ngcontent-%COMP%]{display:flex;position:relative;height:350px}.community-lower[_ngcontent-%COMP%]{display:flex;width:100%;justify-content:space-between;background-color:var(--shade-1)}.cl1[_ngcontent-%COMP%]{background-image:url(https://www.pngarts.com/files/6/Vector-Fitness-PNG-Photo.png);background-color:#101010;height:100%;width:50%;clip-path:polygon(0 0,60% 0,90% 100%,0% 100%)}.cl1-inner[_ngcontent-%COMP%]{background-color:#a0a0a0e8;-webkit-backdrop-filter:blr(12px);backdrop-filter:blr(12px);width:100%;height:100%}.cu1-content[_ngcontent-%COMP%]{width:40%;height:100%;display:flex;flex-direction:column;justify-content:center;gap:20px;color:var(--dark);font-weight:600;padding:16px}.cu1-content[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:2.5rem;font-weight:700}.cu1-content[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:max-content;background-color:var(--shade-3);border:none;color:var(--shade-1)}.community-upper[_ngcontent-%COMP%]{position:absolute;inset:0;z-index:1;display:flex;justify-content:space-between}.cl2[_ngcontent-%COMP%]{background-color:#202020;height:100%;width:50%;clip-path:polygon(0 0,100% 0,100% 100%,30% 100%)}.cl2-content[_ngcontent-%COMP%]{width:100%}.cl2-content[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:contain}.bmiForm[_ngcontent-%COMP%]{padding:18px;background-color:var(--shade-2);color:var(--light);display:flex;flex-direction:column;justify-content:center;align-items:center}.bmiCalculator[_ngcontent-%COMP%]{display:flex;gap:12px;padding:12px 0}@media (max-width:1420px){.faq-container[_ngcontent-%COMP%]{max-width:90%}}@media (max-width:1400px){.hero-inner[_ngcontent-%COMP%]{display:none}}@media (max-width:1335px){.hero-right[_ngcontent-%COMP%]{display:none}.hero-left[_ngcontent-%COMP%]{padding:16px;width:100%;text-align:center}.hero-left[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{text-align:center}}"]})};var bbe=n=>({"disabled-btn":n});function wbe(n,t){if(n&1&&(E(0,"option",21),O(1),S()),n&2){let e=t.$implicit;re("value",e.value),z(),Ye(e.name)}}function Cbe(n,t){n&1&&(E(0,"span"),O(1,"Login"),S())}function _be(n,t){n&1&&ce(0,"span",22)}var AS=class n{constructor(t,e,r,o){this.fb=t;this.authService=e;this.router=r;this.notification=o;this.loginForm=this.fb.group({email:["",[tr.required,tr.email]],password:["",[tr.required,tr.minLength(8)]],userType:["",[tr.required]]})}loading=!1;otpSent=!1;loginForm;userName="";roles=[{value:"fitness_center",name:"Fitness Center"},{value:"admin",name:"Admin"},{value:"user",name:"User"}];onSubmit(){this.loginForm.invalid||(this.loading=!0,this.authService.login(this.loginForm.value).subscribe(t=>{t.error?(this.notification.showNotification(`${t.msg}`,"error"),this.loading=!1):(this.loading=!1,localStorage.setItem("email",this.loginForm.value.email),this.loginForm.value.email&&this.authService.getUserName(this.loginForm.value.email).subscribe(e=>{this.userName=e.name,localStorage.setItem("userName",this.userName)}),localStorage.setItem("userId",t.userId),t.isAdmin?(localStorage.setItem("token",t.token),localStorage.setItem("isAdmin",t.isAdmin.toString()),this.router.navigate(["/"])):t.isFitnessCenter?(localStorage.setItem("token",t.token),localStorage.setItem("isFitnessCenter",t.isFitnessCenter.toString()),this.router.navigate(["/"])):(localStorage.setItem("token",t.token),this.router.navigate(["/"])),this.notification.showNotification(`${t.msg}`,"success"))},t=>{this.loading=!1,this.notification.showNotification(t.error,"error")}))}static \u0275fac=function(e){return new(e||n)(Be(oy),Be(xn),Be(Ut),Be(Vn))};static \u0275cmp=Ct({type:n,selectors:[["app-login"]],decls:29,vars:8,consts:[[1,"authMain"],[1,"navbar"],[1,"container1"],["id","fs1",1,"formContainer"],[1,"fcLeft"],["src","https://img.freepik.com/free-photo/exercise-weights-iron-dumbbell-with-extra-plates_1423-223.jpg?ga=GA1.1.1601277494.1732954128&semt=ais_hybrid","alt",""],[1,"fcRight"],[1,"f1",3,"ngSubmit","formGroup"],[2,"font-weight","600"],["formControlName","email","placeholder","Email"],["type","password","formControlName","password","placeholder","Password"],["name","role","formControlName","userType"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"fb1",3,"disabled","ngClass"],[4,"ngIf"],["class","spinner",4,"ngIf"],[1,"google-signin"],["src","https://developers.google.com/identity/images/g-logo.png","alt","Google Logo"],["href","/forgot-password"],["href","/signup"],[3,"value"],[1,"spinner"]],template:function(e,r){e&1&&(E(0,"div",0)(1,"div",1),ce(2,"app-navbar"),S(),E(3,"div",2)(4,"div",3)(5,"div",4),ce(6,"img",5),S(),E(7,"div",6)(8,"form",7),_e("ngSubmit",function(){return r.onSubmit()}),E(9,"p",8),O(10,"Login Form"),S(),ce(11,"input",9)(12,"input",10),E(13,"select",11)(14,"option",12),O(15,"Select User Role"),S(),Ne(16,wbe,2,2,"option",13),S(),E(17,"button",14),Ne(18,Cbe,2,0,"span",15)(19,_be,1,0,"span",16),S()(),E(20,"button",17),ce(21,"img",18),O(22," Sign in with Google "),S(),E(23,"a",19),O(24,"Forgot Your Password? Reset Password"),S(),ce(25,"br"),E(26,"a",20),O(27,"Don't Have An Acount? Sign Up"),S()()()()(),ce(28,"app-footer")),e&2&&(z(8),re("formGroup",r.loginForm),z(8),re("ngForOf",r.roles),z(),re("disabled",r.loginForm.invalid)("ngClass",Qu(6,bbe,r.loading||r.loginForm.invalid)),z(),re("ngIf",!r.loading),z(),re("ngIf",r.loading))},dependencies:[Xr,Ls,Vi,fc,hc,vo,Ps,Ho,$i,Fh,Lh,Ln,yp,Er,Kn],styles:[".google-signin[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;background:#fff;border:1px solid #ddd;padding:10px;cursor:pointer;border-radius:9999px;margin:16px auto}.google-signin[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:20px;margin-right:10px}#fs1[_ngcontent-%COMP%]{max-height:500px}"]})};var _j=function(n){let t=[],e=0;for(let r=0;r<n.length;r++){let o=n.charCodeAt(r);o<128?t[e++]=o:o<2048?(t[e++]=o>>6|192,t[e++]=o&63|128):(o&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(o=65536+((o&1023)<<10)+(n.charCodeAt(++r)&1023),t[e++]=o>>18|240,t[e++]=o>>12&63|128,t[e++]=o>>6&63|128,t[e++]=o&63|128):(t[e++]=o>>12|224,t[e++]=o>>6&63|128,t[e++]=o&63|128)}return t},Sbe=function(n){let t=[],e=0,r=0;for(;e<n.length;){let o=n[e++];if(o<128)t[r++]=String.fromCharCode(o);else if(o>191&&o<224){let i=n[e++];t[r++]=String.fromCharCode((o&31)<<6|i&63)}else if(o>239&&o<365){let i=n[e++],s=n[e++],a=n[e++],l=((o&7)<<18|(i&63)<<12|(s&63)<<6|a&63)-65536;t[r++]=String.fromCharCode(55296+(l>>10)),t[r++]=String.fromCharCode(56320+(l&1023))}else{let i=n[e++],s=n[e++];t[r++]=String.fromCharCode((o&15)<<12|(i&63)<<6|s&63)}}return t.join("")},Sj={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,t){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();let e=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let o=0;o<n.length;o+=3){let i=n[o],s=o+1<n.length,a=s?n[o+1]:0,l=o+2<n.length,c=l?n[o+2]:0,u=i>>2,d=(i&3)<<4|a>>4,p=(a&15)<<2|c>>6,f=c&63;l||(f=64,s||(p=64)),r.push(e[u],e[d],e[p],e[f])}return r.join("")},encodeString(n,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(n):this.encodeByteArray(_j(n),t)},decodeString(n,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(n):Sbe(this.decodeStringToByteArray(n,t))},decodeStringToByteArray(n,t){this.init_();let e=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let o=0;o<n.length;){let i=e[n.charAt(o++)],a=o<n.length?e[n.charAt(o)]:0;++o;let c=o<n.length?e[n.charAt(o)]:64;++o;let d=o<n.length?e[n.charAt(o)]:64;if(++o,i==null||a==null||c==null||d==null)throw new lM;let p=i<<2|a>>4;if(r.push(p),c!==64){let f=a<<4&240|c>>2;if(r.push(f),d!==64){let h=c<<6&192|d;r.push(h)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}},lM=class extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}},Ibe=function(n){let t=_j(n);return Sj.encodeByteArray(t,!0)},uM=function(n){return Ibe(n).replace(/\./g,"")},dM=function(n){try{return Sj.decodeString(n,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function Ebe(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}var Tbe=()=>Ebe().__FIREBASE_DEFAULTS__,Dbe=()=>{if(typeof process>"u"||typeof process.env>"u")return;let n=process.env.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},kbe=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}let t=n&&dM(n[1]);return t&&JSON.parse(t)},pM=()=>{try{return Tbe()||Dbe()||kbe()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Ij=n=>{var t,e;return(e=(t=pM())===null||t===void 0?void 0:t.emulatorHosts)===null||e===void 0?void 0:e[n]};var fM=()=>{var n;return(n=pM())===null||n===void 0?void 0:n.config},hM=n=>{var t;return(t=pM())===null||t===void 0?void 0:t[`_${n}`]};var RS=class{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}wrapCallback(t){return(e,r)=>{e?this.reject(e):this.resolve(r),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(e):t(e,r))}}};function qo(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Ej(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(qo())}function Tj(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function Dj(){let n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function kj(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Nj(){let n=qo();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function Aj(){try{return typeof indexedDB=="object"}catch{return!1}}function Rj(){return new Promise((n,t)=>{try{let e=!0,r="validate-browser-context-for-indexeddb-analytics-module",o=self.indexedDB.open(r);o.onsuccess=()=>{o.result.close(),e||self.indexedDB.deleteDatabase(r),n(!0)},o.onupgradeneeded=()=>{e=!1},o.onerror=()=>{var i;t(((i=o.error)===null||i===void 0?void 0:i.message)||"")}}catch(e){t(e)}})}var Nbe="FirebaseError",Na=class n extends Error{constructor(t,e,r){super(e),this.code=t,this.customData=r,this.name=Nbe,Object.setPrototypeOf(this,n.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,cd.prototype.create)}},cd=class{constructor(t,e,r){this.service=t,this.serviceName=e,this.errors=r}create(t,...e){let r=e[0]||{},o=`${this.service}/${t}`,i=this.errors[t],s=i?Abe(i,r):"Error",a=`${this.serviceName}: ${s} (${o}).`;return new Na(o,a,r)}};function Abe(n,t){return n.replace(Rbe,(e,r)=>{let o=t[r];return o!=null?String(o):`<${r}?>`})}var Rbe=/\{\$([^}]+)}/g;function Oj(n){for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t))return!1;return!0}function iy(n,t){if(n===t)return!0;let e=Object.keys(n),r=Object.keys(t);for(let o of e){if(!r.includes(o))return!1;let i=n[o],s=t[o];if(Cj(i)&&Cj(s)){if(!iy(i,s))return!1}else if(i!==s)return!1}for(let o of r)if(!e.includes(o))return!1;return!0}function Cj(n){return n!==null&&typeof n=="object"}function sy(n){let t=[];for(let[e,r]of Object.entries(n))Array.isArray(r)?r.forEach(o=>{t.push(encodeURIComponent(e)+"="+encodeURIComponent(o))}):t.push(encodeURIComponent(e)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function Mj(n,t){let e=new cM(n,t);return e.subscribe.bind(e)}var cM=class{constructor(t,e){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then(()=>{t(this)}).catch(r=>{this.error(r)})}next(t){this.forEachObserver(e=>{e.next(t)})}error(t){this.forEachObserver(e=>{e.error(t)}),this.close(t)}complete(){this.forEachObserver(t=>{t.complete()}),this.close()}subscribe(t,e,r){let o;if(t===void 0&&e===void 0&&r===void 0)throw new Error("Missing Observer.");Obe(t,["next","error","complete"])?o=t:o={next:t,error:e,complete:r},o.next===void 0&&(o.next=aM),o.error===void 0&&(o.error=aM),o.complete===void 0&&(o.complete=aM);let i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?o.error(this.finalError):o.complete()}catch{}}),this.observers.push(o),i}unsubscribeOne(t){this.observers===void 0||this.observers[t]===void 0||(delete this.observers[t],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let e=0;e<this.observers.length;e++)this.sendOne(e,t)}sendOne(t,e){this.task.then(()=>{if(this.observers!==void 0&&this.observers[t]!==void 0)try{e(this.observers[t])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(t){this.finalized||(this.finalized=!0,t!==void 0&&(this.finalError=t),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}};function Obe(n,t){if(typeof n!="object"||n===null)return!1;for(let e of t)if(e in n&&typeof n[e]=="function")return!0;return!1}function aM(){}var VZe=4*60*60*1e3;function $h(n){return n&&n._delegate?n._delegate:n}var mc=class{constructor(t,e,r){this.name=t,this.instanceFactory=e,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}};var Vh="[DEFAULT]";var mM=class{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){let e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){let r=new RS;if(this.instancesDeferred.set(e,r),this.isInitialized(e)||this.shouldAutoInitialize())try{let o=this.getOrInitializeService({instanceIdentifier:e});o&&r.resolve(o)}catch{}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;let r=this.normalizeInstanceIdentifier(t?.identifier),o=(e=t?.optional)!==null&&e!==void 0?e:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(i){if(o)return null;throw i}else{if(o)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(Pbe(t))try{this.getOrInitializeService({instanceIdentifier:Vh})}catch{}for(let[e,r]of this.instancesDeferred.entries()){let o=this.normalizeInstanceIdentifier(e);try{let i=this.getOrInitializeService({instanceIdentifier:o});r.resolve(i)}catch{}}}}clearInstance(t=Vh){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}delete(){return B(this,null,function*(){let t=Array.from(this.instances.values());yield Promise.all([...t.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...t.filter(e=>"_delete"in e).map(e=>e._delete())])})}isComponentSet(){return this.component!=null}isInitialized(t=Vh){return this.instances.has(t)}getOptions(t=Vh){return this.instancesOptions.get(t)||{}}initialize(t={}){let{options:e={}}=t,r=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let o=this.getOrInitializeService({instanceIdentifier:r,options:e});for(let[i,s]of this.instancesDeferred.entries()){let a=this.normalizeInstanceIdentifier(i);r===a&&s.resolve(o)}return o}onInit(t,e){var r;let o=this.normalizeInstanceIdentifier(e),i=(r=this.onInitCallbacks.get(o))!==null&&r!==void 0?r:new Set;i.add(t),this.onInitCallbacks.set(o,i);let s=this.instances.get(o);return s&&t(s,o),()=>{i.delete(t)}}invokeOnInitCallbacks(t,e){let r=this.onInitCallbacks.get(e);if(r)for(let o of r)try{o(t,e)}catch{}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let r=this.instances.get(t);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:Mbe(t),options:e}),this.instances.set(t,r),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(r,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,r)}catch{}return r||null}normalizeInstanceIdentifier(t=Vh){return this.component?this.component.multipleInstances?t:Vh:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};function Mbe(n){return n===Vh?void 0:n}function Pbe(n){return n.instantiationMode==="EAGER"}var OS=class{constructor(t){this.name=t,this.providers=new Map}addComponent(t){let e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);let e=new mM(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}};var Fbe=[],nr=function(n){return n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT",n}(nr||{}),Lbe={debug:nr.DEBUG,verbose:nr.VERBOSE,info:nr.INFO,warn:nr.WARN,error:nr.ERROR,silent:nr.SILENT},$be=nr.INFO,Vbe={[nr.DEBUG]:"log",[nr.VERBOSE]:"log",[nr.INFO]:"info",[nr.WARN]:"warn",[nr.ERROR]:"error"},Bbe=(n,t,...e)=>{if(t<n.logLevel)return;let r=new Date().toISOString(),o=Vbe[t];if(o)console[o](`[${r}]  ${n.name}:`,...e);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)},ay=class{constructor(t){this.name=t,this._logLevel=$be,this._logHandler=Bbe,this._userLogHandler=null,Fbe.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in nr))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?Lbe[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,nr.DEBUG,...t),this._logHandler(this,nr.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,nr.VERBOSE,...t),this._logHandler(this,nr.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,nr.INFO,...t),this._logHandler(this,nr.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,nr.WARN,...t),this._logHandler(this,nr.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,nr.ERROR,...t),this._logHandler(this,nr.ERROR,...t)}};var zbe=(n,t)=>t.some(e=>n instanceof e),Pj,Fj;function Ube(){return Pj||(Pj=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Wbe(){return Fj||(Fj=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var Lj=new WeakMap,yM=new WeakMap,$j=new WeakMap,gM=new WeakMap,vM=new WeakMap;function Gbe(n){let t=new Promise((e,r)=>{let o=()=>{n.removeEventListener("success",i),n.removeEventListener("error",s)},i=()=>{e(gc(n.result)),o()},s=()=>{r(n.error),o()};n.addEventListener("success",i),n.addEventListener("error",s)});return t.then(e=>{e instanceof IDBCursor&&Lj.set(e,n)}).catch(()=>{}),vM.set(t,n),t}function jbe(n){if(yM.has(n))return;let t=new Promise((e,r)=>{let o=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",s),n.removeEventListener("abort",s)},i=()=>{e(),o()},s=()=>{r(n.error||new DOMException("AbortError","AbortError")),o()};n.addEventListener("complete",i),n.addEventListener("error",s),n.addEventListener("abort",s)});yM.set(n,t)}var xM={get(n,t,e){if(n instanceof IDBTransaction){if(t==="done")return yM.get(n);if(t==="objectStoreNames")return n.objectStoreNames||$j.get(n);if(t==="store")return e.objectStoreNames[1]?void 0:e.objectStore(e.objectStoreNames[0])}return gc(n[t])},set(n,t,e){return n[t]=e,!0},has(n,t){return n instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in n}};function Vj(n){xM=n(xM)}function Hbe(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...e){let r=n.call(MS(this),t,...e);return $j.set(r,t.sort?t.sort():[t]),gc(r)}:Wbe().includes(n)?function(...t){return n.apply(MS(this),t),gc(Lj.get(this))}:function(...t){return gc(n.apply(MS(this),t))}}function qbe(n){return typeof n=="function"?Hbe(n):(n instanceof IDBTransaction&&jbe(n),zbe(n,Ube())?new Proxy(n,xM):n)}function gc(n){if(n instanceof IDBRequest)return Gbe(n);if(gM.has(n))return gM.get(n);let t=qbe(n);return t!==n&&(gM.set(n,t),vM.set(t,n)),t}var MS=n=>vM.get(n);function zj(n,t,{blocked:e,upgrade:r,blocking:o,terminated:i}={}){let s=indexedDB.open(n,t),a=gc(s);return r&&s.addEventListener("upgradeneeded",l=>{r(gc(s.result),l.oldVersion,l.newVersion,gc(s.transaction),l)}),e&&s.addEventListener("blocked",l=>e(l.oldVersion,l.newVersion,l)),a.then(l=>{i&&l.addEventListener("close",()=>i()),o&&l.addEventListener("versionchange",c=>o(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}var Kbe=["get","getKey","getAll","getAllKeys","count"],Xbe=["put","add","delete","clear"],bM=new Map;function Bj(n,t){if(!(n instanceof IDBDatabase&&!(t in n)&&typeof t=="string"))return;if(bM.get(t))return bM.get(t);let e=t.replace(/FromIndex$/,""),r=t!==e,o=Xbe.includes(e);if(!(e in(r?IDBIndex:IDBObjectStore).prototype)||!(o||Kbe.includes(e)))return;let i=function(s,...a){return B(this,null,function*(){let l=this.transaction(s,o?"readwrite":"readonly"),c=l.store;return r&&(c=c.index(a.shift())),(yield Promise.all([c[e](...a),o&&l.done]))[0]})};return bM.set(t,i),i}Vj(n=>Ft(ke({},n),{get:(t,e,r)=>Bj(t,e)||n.get(t,e,r),has:(t,e)=>!!Bj(t,e)||n.has(t,e)}));var CM=class{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(Ybe(e)){let r=e.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(e=>e).join(" ")}};function Ybe(n){let t=n.getComponent();return t?.type==="VERSION"}var _M="@firebase/app",Uj="0.10.18";var ud=new ay("@firebase/app"),Zbe="@firebase/app-compat",Qbe="@firebase/analytics-compat",Jbe="@firebase/analytics",ewe="@firebase/app-check-compat",twe="@firebase/app-check",nwe="@firebase/auth",rwe="@firebase/auth-compat",owe="@firebase/database",iwe="@firebase/data-connect",swe="@firebase/database-compat",awe="@firebase/functions",lwe="@firebase/functions-compat",cwe="@firebase/installations",uwe="@firebase/installations-compat",dwe="@firebase/messaging",pwe="@firebase/messaging-compat",fwe="@firebase/performance",hwe="@firebase/performance-compat",mwe="@firebase/remote-config",gwe="@firebase/remote-config-compat",ywe="@firebase/storage",xwe="@firebase/storage-compat",vwe="@firebase/firestore",bwe="@firebase/vertexai",wwe="@firebase/firestore-compat",Cwe="firebase",_we="11.2.0";var SM="[DEFAULT]",Swe={[_M]:"fire-core",[Zbe]:"fire-core-compat",[Jbe]:"fire-analytics",[Qbe]:"fire-analytics-compat",[twe]:"fire-app-check",[ewe]:"fire-app-check-compat",[nwe]:"fire-auth",[rwe]:"fire-auth-compat",[owe]:"fire-rtdb",[iwe]:"fire-data-connect",[swe]:"fire-rtdb-compat",[awe]:"fire-fn",[lwe]:"fire-fn-compat",[cwe]:"fire-iid",[uwe]:"fire-iid-compat",[dwe]:"fire-fcm",[pwe]:"fire-fcm-compat",[fwe]:"fire-perf",[hwe]:"fire-perf-compat",[mwe]:"fire-rc",[gwe]:"fire-rc-compat",[ywe]:"fire-gcs",[xwe]:"fire-gcs-compat",[vwe]:"fire-fst",[wwe]:"fire-fst-compat",[bwe]:"fire-vertex","fire-js":"fire-js",[Cwe]:"fire-js-all"};var PS=new Map,Iwe=new Map,IM=new Map;function Wj(n,t){try{n.container.addComponent(t)}catch(e){ud.debug(`Component ${t.name} failed to register with FirebaseApp ${n.name}`,e)}}function cy(n){let t=n.name;if(IM.has(t))return ud.debug(`There were multiple attempts to register component ${t}.`),!1;IM.set(t,n);for(let e of PS.values())Wj(e,n);for(let e of Iwe.values())Wj(e,n);return!0}function kM(n,t){let e=n.container.getProvider("heartbeat").getImmediate({optional:!0});return e&&e.triggerHeartbeat(),n.container.getProvider(t)}function yc(n){return n.settings!==void 0}var Ewe={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},_p=new cd("app","Firebase",Ewe);var EM=class{constructor(t,e,r){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new mc("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw _p.create("app-deleted",{appName:this._name})}};var uy=_we;function Twe(n,t={}){let e=n;typeof t!="object"&&(t={name:t});let r=Object.assign({name:SM,automaticDataCollectionEnabled:!1},t),o=r.name;if(typeof o!="string"||!o)throw _p.create("bad-app-name",{appName:String(o)});if(e||(e=fM()),!e)throw _p.create("no-options");let i=PS.get(o);if(i){if(iy(e,i.options)&&iy(r,i.config))return i;throw _p.create("duplicate-app",{appName:o})}let s=new OS(o);for(let l of IM.values())s.addComponent(l);let a=new EM(e,r,s);return PS.set(o,a),a}function qj(n=SM){let t=PS.get(n);if(!t&&n===SM&&fM())return Twe();if(!t)throw _p.create("no-app",{appName:n});return t}function ly(n,t,e){var r;let o=(r=Swe[n])!==null&&r!==void 0?r:n;e&&(o+=`-${e}`);let i=o.match(/\s|\//),s=t.match(/\s|\//);if(i||s){let a=[`Unable to register library "${o}" with version "${t}":`];i&&a.push(`library name "${o}" contains illegal characters (whitespace or "/")`),i&&s&&a.push("and"),s&&a.push(`version name "${t}" contains illegal characters (whitespace or "/")`),ud.warn(a.join(" "));return}cy(new mc(`${o}-version`,()=>({library:o,version:t}),"VERSION"))}var Dwe="firebase-heartbeat-database",kwe=1,Z0="firebase-heartbeat-store",wM=null;function Kj(){return wM||(wM=zj(Dwe,kwe,{upgrade:(n,t)=>{switch(t){case 0:try{n.createObjectStore(Z0)}catch(e){console.warn(e)}}}}).catch(n=>{throw _p.create("idb-open",{originalErrorMessage:n.message})})),wM}function Nwe(n){return B(this,null,function*(){try{let e=(yield Kj()).transaction(Z0),r=yield e.objectStore(Z0).get(Xj(n));return yield e.done,r}catch(t){if(t instanceof Na)ud.warn(t.message);else{let e=_p.create("idb-get",{originalErrorMessage:t?.message});ud.warn(e.message)}}})}function Gj(n,t){return B(this,null,function*(){try{let r=(yield Kj()).transaction(Z0,"readwrite");yield r.objectStore(Z0).put(t,Xj(n)),yield r.done}catch(e){if(e instanceof Na)ud.warn(e.message);else{let r=_p.create("idb-set",{originalErrorMessage:e?.message});ud.warn(r.message)}}})}function Xj(n){return`${n.name}!${n.options.appId}`}var Awe=1024,Rwe=30*24*60*60*1e3,TM=class{constructor(t){this.container=t,this._heartbeatsCache=null;let e=this.container.getProvider("app").getImmediate();this._storage=new DM(e),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}triggerHeartbeat(){return B(this,null,function*(){var t,e;try{let o=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=jj();return((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null&&(this._heartbeatsCache=yield this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(s=>s.date===i)?void 0:(this._heartbeatsCache.heartbeats.push({date:i,agent:o}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(s=>{let a=new Date(s.date).valueOf();return Date.now()-a<=Rwe}),this._storage.overwrite(this._heartbeatsCache))}catch(r){ud.warn(r)}})}getHeartbeatsHeader(){return B(this,null,function*(){var t;try{if(this._heartbeatsCache===null&&(yield this._heartbeatsCachePromise),((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";let e=jj(),{heartbeatsToSend:r,unsentEntries:o}=Owe(this._heartbeatsCache.heartbeats),i=uM(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=e,o.length>0?(this._heartbeatsCache.heartbeats=o,yield this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return ud.warn(e),""}})}};function jj(){return new Date().toISOString().substring(0,10)}function Owe(n,t=Awe){let e=[],r=n.slice();for(let o of n){let i=e.find(s=>s.agent===o.agent);if(i){if(i.dates.push(o.date),Hj(e)>t){i.dates.pop();break}}else if(e.push({agent:o.agent,dates:[o.date]}),Hj(e)>t){e.pop();break}r=r.slice(1)}return{heartbeatsToSend:e,unsentEntries:r}}var DM=class{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return B(this,null,function*(){return Aj()?Rj().then(()=>!0).catch(()=>!1):!1})}read(){return B(this,null,function*(){if(yield this._canUseIndexedDBPromise){let e=yield Nwe(this.app);return e?.heartbeats?e:{heartbeats:[]}}else return{heartbeats:[]}})}overwrite(t){return B(this,null,function*(){var e;if(yield this._canUseIndexedDBPromise){let o=yield this.read();return Gj(this.app,{lastSentHeartbeatDate:(e=t.lastSentHeartbeatDate)!==null&&e!==void 0?e:o.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return})}add(t){return B(this,null,function*(){var e;if(yield this._canUseIndexedDBPromise){let o=yield this.read();return Gj(this.app,{lastSentHeartbeatDate:(e=t.lastSentHeartbeatDate)!==null&&e!==void 0?e:o.lastSentHeartbeatDate,heartbeats:[...o.heartbeats,...t.heartbeats]})}else return})}};function Hj(n){return uM(JSON.stringify({version:2,heartbeats:n})).length}function Mwe(n){cy(new mc("platform-logger",t=>new CM(t),"PRIVATE")),cy(new mc("heartbeat",t=>new TM(t),"PRIVATE")),ly(_M,Uj,n),ly(_M,Uj,"esm2017"),ly("fire-js","")}Mwe("");function uH(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}var dH=uH,pH=new cd("auth","Firebase",uH());var zS=new ay("@firebase/auth");function Pwe(n,...t){zS.logLevel<=nr.WARN&&zS.warn(`Auth (${uy}): ${n}`,...t)}function LS(n,...t){zS.logLevel<=nr.ERROR&&zS.error(`Auth (${uy}): ${n}`,...t)}function vc(n,...t){throw qM(n,...t)}function Aa(n,...t){return qM(n,...t)}function HM(n,t,e){let r=Object.assign(Object.assign({},dH()),{[t]:e});return new cd("auth","Firebase",r).create(t,{appName:n.name})}function Bh(n){return HM(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Fwe(n,t,e){let r=e;if(!(t instanceof r))throw r.name!==t.constructor.name&&vc(n,"argument-error"),HM(n,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function qM(n,...t){if(typeof n!="string"){let e=t[0],r=[...t.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(e,...r)}return pH.create(n,...t)}function Ot(n,t,...e){if(!n)throw qM(t,...e)}function dd(n){let t="INTERNAL ASSERTION FAILED: "+n;throw LS(t),new Error(t)}function fd(n,t){n||dd(t)}function RM(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function Lwe(){return Yj()==="http:"||Yj()==="https:"}function Yj(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}function $we(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Lwe()||Dj()||"connection"in navigator)?navigator.onLine:!0}function Vwe(){if(typeof navigator>"u")return null;let n=navigator;return n.languages&&n.languages[0]||n.language||null}var zh=class{constructor(t,e){this.shortDelay=t,this.longDelay=e,fd(e>t,"Short delay should be less than long delay!"),this.isMobile=Ej()||kj()}get(){return $we()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}};function KM(n,t){fd(n.emulator,"Emulator should always be set here");let{url:e}=n.emulator;return t?`${e}${t.startsWith("/")?t.slice(1):t}`:e}var US=class{static initialize(t,e,r){this.fetchImpl=t,e&&(this.headersImpl=e),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;dd("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;dd("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;dd("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}};var Bwe={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};var zwe=new zh(3e4,6e4);function XM(n,t){return n.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:n.tenantId}):t}function fy(i,s,a,l){return B(this,arguments,function*(n,t,e,r,o={}){return fH(n,o,()=>B(this,null,function*(){let c={},u={};r&&(t==="GET"?u=r:c={body:JSON.stringify(r)});let d=sy(Object.assign({key:n.config.apiKey},u)).slice(1),p=yield n._getAdditionalHeaders();p["Content-Type"]="application/json",n.languageCode&&(p["X-Firebase-Locale"]=n.languageCode);let f=Object.assign({method:t,headers:p},c);return Tj()||(f.referrerPolicy="no-referrer"),US.fetch()(hH(n,n.config.apiHost,e,d),f)}))})}function fH(n,t,e){return B(this,null,function*(){n._canInitEmulator=!1;let r=Object.assign(Object.assign({},Bwe),t);try{let o=new OM(n),i=yield Promise.race([e(),o.promise]);o.clearNetworkTimeout();let s=yield i.json();if("needConfirmation"in s)throw FS(n,"account-exists-with-different-credential",s);if(i.ok&&!("errorMessage"in s))return s;{let a=i.ok?s.errorMessage:s.error.message,[l,c]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw FS(n,"credential-already-in-use",s);if(l==="EMAIL_EXISTS")throw FS(n,"email-already-in-use",s);if(l==="USER_DISABLED")throw FS(n,"user-disabled",s);let u=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(c)throw HM(n,u,c);vc(n,u)}}catch(o){if(o instanceof Na)throw o;vc(n,"network-request-failed",{message:String(o)})}})}function Uwe(i,s,a,l){return B(this,arguments,function*(n,t,e,r,o={}){let c=yield fy(n,t,e,r,o);return"mfaPendingCredential"in c&&vc(n,"multi-factor-auth-required",{_serverResponse:c}),c})}function hH(n,t,e,r){let o=`${t}${e}?${r}`;return n.config.emulator?KM(n.config,o):`${n.config.apiScheme}://${o}`}var OM=class{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(t){this.auth=t,this.timer=null,this.promise=new Promise((e,r)=>{this.timer=setTimeout(()=>r(Aa(this.auth,"network-request-failed")),zwe.get())})}};function FS(n,t,e){let r={appName:n.name};e.email&&(r.email=e.email),e.phoneNumber&&(r.phoneNumber=e.phoneNumber);let o=Aa(n,t,r);return o.customData._tokenResponse=e,o}function Wwe(n,t){return B(this,null,function*(){return fy(n,"POST","/v1/accounts:delete",t)})}function mH(n,t){return B(this,null,function*(){return fy(n,"POST","/v1/accounts:lookup",t)})}function Q0(n){if(n)try{let t=new Date(Number(n));if(!isNaN(t.getTime()))return t.toUTCString()}catch{}}function gH(n,t=!1){return B(this,null,function*(){let e=$h(n),r=yield e.getIdToken(t),o=YM(r);Ot(o&&o.exp&&o.auth_time&&o.iat,e.auth,"internal-error");let i=typeof o.firebase=="object"?o.firebase:void 0,s=i?.sign_in_provider;return{claims:o,token:r,authTime:Q0(NM(o.auth_time)),issuedAtTime:Q0(NM(o.iat)),expirationTime:Q0(NM(o.exp)),signInProvider:s||null,signInSecondFactor:i?.sign_in_second_factor||null}})}function NM(n){return Number(n)*1e3}function YM(n){let[t,e,r]=n.split(".");if(t===void 0||e===void 0||r===void 0)return LS("JWT malformed, contained fewer than 3 sections"),null;try{let o=dM(e);return o?JSON.parse(o):(LS("Failed to decode base64 JWT payload"),null)}catch(o){return LS("Caught error parsing JWT payload as JSON",o?.toString()),null}}function Zj(n){let t=YM(n);return Ot(t,"internal-error"),Ot(typeof t.exp<"u","internal-error"),Ot(typeof t.iat<"u","internal-error"),Number(t.exp)-Number(t.iat)}function eb(n,t,e=!1){return B(this,null,function*(){if(e)return t;try{return yield t}catch(r){throw r instanceof Na&&Gwe(r)&&n.auth.currentUser===n&&(yield n.auth.signOut()),r}})}function Gwe({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}var MM=class{constructor(t){this.user=t,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(t){var e;if(t){let r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;let o=((e=this.user.stsTokenManager.expirationTime)!==null&&e!==void 0?e:0)-Date.now()-3e5;return Math.max(0,o)}}schedule(t=!1){if(!this.isRunning)return;let e=this.getInterval(t);this.timerId=setTimeout(()=>B(this,null,function*(){yield this.iteration()}),e)}iteration(){return B(this,null,function*(){try{yield this.user.getIdToken(!0)}catch(t){t?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()})}};var tb=class{constructor(t,e){this.createdAt=t,this.lastLoginAt=e,this._initializeTime()}_initializeTime(){this.lastSignInTime=Q0(this.lastLoginAt),this.creationTime=Q0(this.createdAt)}_copy(t){this.createdAt=t.createdAt,this.lastLoginAt=t.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}};function WS(n){return B(this,null,function*(){var t;let e=n.auth,r=yield n.getIdToken(),o=yield eb(n,mH(e,{idToken:r}));Ot(o?.users.length,e,"internal-error");let i=o.users[0];n._notifyReloadListener(i);let s=!((t=i.providerUserInfo)===null||t===void 0)&&t.length?xH(i.providerUserInfo):[],a=jwe(n.providerData,s),l=n.isAnonymous,c=!(n.email&&i.passwordHash)&&!a?.length,u=l?c:!1,d={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:a,metadata:new tb(i.createdAt,i.lastLoginAt),isAnonymous:u};Object.assign(n,d)})}function yH(n){return B(this,null,function*(){let t=$h(n);yield WS(t),yield t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)})}function jwe(n,t){return[...n.filter(r=>!t.some(o=>o.providerId===r.providerId)),...t]}function xH(n){return n.map(t=>{var{providerId:e}=t,r=yC(t,["providerId"]);return{providerId:e,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}function Hwe(n,t){return B(this,null,function*(){let e=yield fH(n,{},()=>B(this,null,function*(){let r=sy({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:o,apiKey:i}=n.config,s=hH(n,o,"/v1/token",`key=${i}`),a=yield n._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",US.fetch()(s,{method:"POST",headers:a,body:r})}));return{accessToken:e.access_token,expiresIn:e.expires_in,refreshToken:e.refresh_token}})}function qwe(n,t){return B(this,null,function*(){return fy(n,"POST","/v2/accounts:revokeToken",XM(n,t))})}var J0=class n{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(t){Ot(t.idToken,"internal-error"),Ot(typeof t.idToken<"u","internal-error"),Ot(typeof t.refreshToken<"u","internal-error");let e="expiresIn"in t&&typeof t.expiresIn<"u"?Number(t.expiresIn):Zj(t.idToken);this.updateTokensAndExpiration(t.idToken,t.refreshToken,e)}updateFromIdToken(t){Ot(t.length!==0,"internal-error");let e=Zj(t);this.updateTokensAndExpiration(t,null,e)}getToken(t,e=!1){return B(this,null,function*(){return!e&&this.accessToken&&!this.isExpired?this.accessToken:(Ot(this.refreshToken,t,"user-token-expired"),this.refreshToken?(yield this.refresh(t,this.refreshToken),this.accessToken):null)})}clearRefreshToken(){this.refreshToken=null}refresh(t,e){return B(this,null,function*(){let{accessToken:r,refreshToken:o,expiresIn:i}=yield Hwe(t,e);this.updateTokensAndExpiration(r,o,Number(i))})}updateTokensAndExpiration(t,e,r){this.refreshToken=e||null,this.accessToken=t||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(t,e){let{refreshToken:r,accessToken:o,expirationTime:i}=e,s=new n;return r&&(Ot(typeof r=="string","internal-error",{appName:t}),s.refreshToken=r),o&&(Ot(typeof o=="string","internal-error",{appName:t}),s.accessToken=o),i&&(Ot(typeof i=="number","internal-error",{appName:t}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(t){this.accessToken=t.accessToken,this.refreshToken=t.refreshToken,this.expirationTime=t.expirationTime}_clone(){return Object.assign(new n,this.toJSON())}_performRefresh(){return dd("not implemented")}};function Sp(n,t){Ot(typeof n=="string"||typeof n>"u","internal-error",{appName:t})}var py=class n{constructor(t){var{uid:e,auth:r,stsTokenManager:o}=t,i=yC(t,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new MM(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=r,this.stsTokenManager=o,this.accessToken=o.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new tb(i.createdAt||void 0,i.lastLoginAt||void 0)}getIdToken(t){return B(this,null,function*(){let e=yield eb(this,this.stsTokenManager.getToken(this.auth,t));return Ot(e,this.auth,"internal-error"),this.accessToken!==e&&(this.accessToken=e,yield this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),e})}getIdTokenResult(t){return gH(this,t)}reload(){return yH(this)}_assign(t){this!==t&&(Ot(this.uid===t.uid,this.auth,"internal-error"),this.displayName=t.displayName,this.photoURL=t.photoURL,this.email=t.email,this.emailVerified=t.emailVerified,this.phoneNumber=t.phoneNumber,this.isAnonymous=t.isAnonymous,this.tenantId=t.tenantId,this.providerData=t.providerData.map(e=>Object.assign({},e)),this.metadata._copy(t.metadata),this.stsTokenManager._assign(t.stsTokenManager))}_clone(t){let e=new n(Object.assign(Object.assign({},this),{auth:t,stsTokenManager:this.stsTokenManager._clone()}));return e.metadata._copy(this.metadata),e}_onReload(t){Ot(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=t,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(t){this.reloadListener?this.reloadListener(t):this.reloadUserInfo=t}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(t,e=!1){return B(this,null,function*(){let r=!1;t.idToken&&t.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(t),r=!0),e&&(yield WS(this)),yield this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)})}delete(){return B(this,null,function*(){if(yc(this.auth.app))return Promise.reject(Bh(this.auth));let t=yield this.getIdToken();return yield eb(this,Wwe(this.auth,{idToken:t})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()})}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(t=>Object.assign({},t)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(t,e){var r,o,i,s,a,l,c,u;let d=(r=e.displayName)!==null&&r!==void 0?r:void 0,p=(o=e.email)!==null&&o!==void 0?o:void 0,f=(i=e.phoneNumber)!==null&&i!==void 0?i:void 0,h=(s=e.photoURL)!==null&&s!==void 0?s:void 0,m=(a=e.tenantId)!==null&&a!==void 0?a:void 0,g=(l=e._redirectEventId)!==null&&l!==void 0?l:void 0,y=(c=e.createdAt)!==null&&c!==void 0?c:void 0,v=(u=e.lastLoginAt)!==null&&u!==void 0?u:void 0,{uid:w,emailVerified:C,isAnonymous:I,providerData:A,stsTokenManager:M}=e;Ot(w&&M,t,"internal-error");let $=J0.fromJSON(this.name,M);Ot(typeof w=="string",t,"internal-error"),Sp(d,t.name),Sp(p,t.name),Ot(typeof C=="boolean",t,"internal-error"),Ot(typeof I=="boolean",t,"internal-error"),Sp(f,t.name),Sp(h,t.name),Sp(m,t.name),Sp(g,t.name),Sp(y,t.name),Sp(v,t.name);let V=new n({uid:w,auth:t,email:p,emailVerified:C,displayName:d,isAnonymous:I,photoURL:h,phoneNumber:f,tenantId:m,stsTokenManager:$,createdAt:y,lastLoginAt:v});return A&&Array.isArray(A)&&(V.providerData=A.map(W=>Object.assign({},W))),g&&(V._redirectEventId=g),V}static _fromIdTokenResponse(t,e,r=!1){return B(this,null,function*(){let o=new J0;o.updateFromServerResponse(e);let i=new n({uid:e.localId,auth:t,stsTokenManager:o,isAnonymous:r});return yield WS(i),i})}static _fromGetAccountInfoResponse(t,e,r){return B(this,null,function*(){let o=e.users[0];Ot(o.localId!==void 0,"internal-error");let i=o.providerUserInfo!==void 0?xH(o.providerUserInfo):[],s=!(o.email&&o.passwordHash)&&!i?.length,a=new J0;a.updateFromIdToken(r);let l=new n({uid:o.localId,auth:t,stsTokenManager:a,isAnonymous:s}),c={uid:o.localId,displayName:o.displayName||null,photoURL:o.photoUrl||null,email:o.email||null,emailVerified:o.emailVerified||!1,phoneNumber:o.phoneNumber||null,tenantId:o.tenantId||null,providerData:i,metadata:new tb(o.createdAt,o.lastLoginAt),isAnonymous:!(o.email&&o.passwordHash)&&!i?.length};return Object.assign(l,c),l})}};var Qj=new Map;function pd(n){fd(n instanceof Function,"Expected a class definition");let t=Qj.get(n);return t?(fd(t instanceof n,"Instance stored in cache mismatched with class"),t):(t=new n,Qj.set(n,t),t)}var Kwe=(()=>{class n{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return B(this,null,function*(){return!0})}_set(e,r){return B(this,null,function*(){this.storage[e]=r})}_get(e){return B(this,null,function*(){let r=this.storage[e];return r===void 0?null:r})}_remove(e){return B(this,null,function*(){delete this.storage[e]})}_addListener(e,r){}_removeListener(e,r){}}return n.type="NONE",n})(),PM=Kwe;function $S(n,t,e){return`firebase:${n}:${t}:${e}`}var GS=class n{constructor(t,e,r){this.persistence=t,this.auth=e,this.userKey=r;let{config:o,name:i}=this.auth;this.fullUserKey=$S(this.userKey,o.apiKey,i),this.fullPersistenceKey=$S("persistence",o.apiKey,i),this.boundEventHandler=e._onStorageEvent.bind(e),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(t){return this.persistence._set(this.fullUserKey,t.toJSON())}getCurrentUser(){return B(this,null,function*(){let t=yield this.persistence._get(this.fullUserKey);return t?py._fromJSON(this.auth,t):null})}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(t){return B(this,null,function*(){if(this.persistence===t)return;let e=yield this.getCurrentUser();if(yield this.removeCurrentUser(),this.persistence=t,e)return this.setCurrentUser(e)})}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(t,e,r="authUser"){return B(this,null,function*(){if(!e.length)return new n(pd(PM),t,r);let o=(yield Promise.all(e.map(c=>B(this,null,function*(){if(yield c._isAvailable())return c})))).filter(c=>c),i=o[0]||pd(PM),s=$S(r,t.config.apiKey,t.name),a=null;for(let c of e)try{let u=yield c._get(s);if(u){let d=py._fromJSON(t,u);c!==i&&(a=d),i=c;break}}catch{}let l=o.filter(c=>c._shouldAllowMigration);return!i._shouldAllowMigration||!l.length?new n(i,t,r):(i=l[0],a&&(yield i._set(s,a.toJSON())),yield Promise.all(e.map(c=>B(this,null,function*(){if(c!==i)try{yield c._remove(s)}catch{}}))),new n(i,t,r))})}};function Jj(n){let t=n.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(CH(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(vH(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(SH(t))return"Blackberry";if(IH(t))return"Webos";if(bH(t))return"Safari";if((t.includes("chrome/")||wH(t))&&!t.includes("edge/"))return"Chrome";if(_H(t))return"Android";{let e=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(e);if(r?.length===2)return r[1]}return"Other"}function vH(n=qo()){return/firefox\//i.test(n)}function bH(n=qo()){let t=n.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function wH(n=qo()){return/crios\//i.test(n)}function CH(n=qo()){return/iemobile/i.test(n)}function _H(n=qo()){return/android/i.test(n)}function SH(n=qo()){return/blackberry/i.test(n)}function IH(n=qo()){return/webos/i.test(n)}function ZM(n=qo()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function Xwe(n=qo()){var t;return ZM(n)&&!!(!((t=window.navigator)===null||t===void 0)&&t.standalone)}function Ywe(){return Nj()&&document.documentMode===10}function EH(n=qo()){return ZM(n)||_H(n)||IH(n)||SH(n)||/windows phone/i.test(n)||CH(n)}function TH(n,t=[]){let e;switch(n){case"Browser":e=Jj(qo());break;case"Worker":e=`${Jj(qo())}-${n}`;break;default:e=n}let r=t.length?t.join(","):"FirebaseCore-web";return`${e}/JsCore/${uy}/${r}`}var FM=class{constructor(t){this.auth=t,this.queue=[]}pushCallback(t,e){let r=i=>new Promise((s,a)=>{try{let l=t(i);s(l)}catch(l){a(l)}});r.onAbort=e,this.queue.push(r);let o=this.queue.length-1;return()=>{this.queue[o]=()=>Promise.resolve()}}runMiddleware(t){return B(this,null,function*(){if(this.auth.currentUser===t)return;let e=[];try{for(let r of this.queue)yield r(t),r.onAbort&&e.push(r.onAbort)}catch(r){e.reverse();for(let o of e)try{o()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}})}};function Zwe(e){return B(this,arguments,function*(n,t={}){return fy(n,"GET","/v2/passwordPolicy",XM(n,t))})}var Qwe=6,LM=class{constructor(t){var e,r,o,i;let s=t.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(e=s.minPasswordLength)!==null&&e!==void 0?e:Qwe,s.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=s.maxPasswordLength),s.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=s.containsLowercaseCharacter),s.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=s.containsUppercaseCharacter),s.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=s.containsNumericCharacter),s.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=s.containsNonAlphanumericCharacter),this.enforcementState=t.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(o=(r=t.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&o!==void 0?o:"",this.forceUpgradeOnSignin=(i=t.forceUpgradeOnSignin)!==null&&i!==void 0?i:!1,this.schemaVersion=t.schemaVersion}validatePassword(t){var e,r,o,i,s,a;let l={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(t,l),this.validatePasswordCharacterOptions(t,l),l.isValid&&(l.isValid=(e=l.meetsMinPasswordLength)!==null&&e!==void 0?e:!0),l.isValid&&(l.isValid=(r=l.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),l.isValid&&(l.isValid=(o=l.containsLowercaseLetter)!==null&&o!==void 0?o:!0),l.isValid&&(l.isValid=(i=l.containsUppercaseLetter)!==null&&i!==void 0?i:!0),l.isValid&&(l.isValid=(s=l.containsNumericCharacter)!==null&&s!==void 0?s:!0),l.isValid&&(l.isValid=(a=l.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),l}validatePasswordLengthOptions(t,e){let r=this.customStrengthOptions.minPasswordLength,o=this.customStrengthOptions.maxPasswordLength;r&&(e.meetsMinPasswordLength=t.length>=r),o&&(e.meetsMaxPasswordLength=t.length<=o)}validatePasswordCharacterOptions(t,e){this.updatePasswordCharacterOptionsStatuses(e,!1,!1,!1,!1);let r;for(let o=0;o<t.length;o++)r=t.charAt(o),this.updatePasswordCharacterOptionsStatuses(e,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(t,e,r,o,i){this.customStrengthOptions.containsLowercaseLetter&&(t.containsLowercaseLetter||(t.containsLowercaseLetter=e)),this.customStrengthOptions.containsUppercaseLetter&&(t.containsUppercaseLetter||(t.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(t.containsNumericCharacter||(t.containsNumericCharacter=o)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(t.containsNonAlphanumericCharacter||(t.containsNonAlphanumericCharacter=i))}};var $M=class{constructor(t,e,r,o){this.app=t,this.heartbeatServiceProvider=e,this.appCheckServiceProvider=r,this.config=o,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new jS(this),this.idTokenSubscription=new jS(this),this.beforeStateQueue=new FM(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=pH,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=t.name,this.clientVersion=o.sdkClientVersion}_initializeWithPersistence(t,e){return e&&(this._popupRedirectResolver=pd(e)),this._initializationPromise=this.queue(()=>B(this,null,function*(){var r,o;if(!this._deleted&&(this.persistenceManager=yield GS.create(this,t),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{yield this._popupRedirectResolver._initialize(this)}catch{}yield this.initializeCurrentUser(e),this.lastNotifiedUid=((o=this.currentUser)===null||o===void 0?void 0:o.uid)||null,!this._deleted&&(this._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){return B(this,null,function*(){if(this._deleted)return;let t=yield this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!t)){if(this.currentUser&&t&&this.currentUser.uid===t.uid){this._currentUser._assign(t),yield this.currentUser.getIdToken();return}yield this._updateCurrentUser(t,!0)}})}initializeCurrentUserFromIdToken(t){return B(this,null,function*(){try{let e=yield mH(this,{idToken:t}),r=yield py._fromGetAccountInfoResponse(this,e,t);yield this.directlySetCurrentUser(r)}catch(e){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",e),yield this.directlySetCurrentUser(null)}})}initializeCurrentUser(t){return B(this,null,function*(){var e;if(yc(this.app)){let s=this.app.settings.authIdToken;return s?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(s).then(a,a))}):this.directlySetCurrentUser(null)}let r=yield this.assertedPersistence.getCurrentUser(),o=r,i=!1;if(t&&this.config.authDomain){yield this.getOrInitRedirectPersistenceManager();let s=(e=this.redirectUser)===null||e===void 0?void 0:e._redirectEventId,a=o?._redirectEventId,l=yield this.tryRedirectSignIn(t);(!s||s===a)&&l?.user&&(o=l.user,i=!0)}if(!o)return this.directlySetCurrentUser(null);if(!o._redirectEventId){if(i)try{yield this.beforeStateQueue.runMiddleware(o)}catch(s){o=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(s))}return o?this.reloadAndSetCurrentUserOrClear(o):this.directlySetCurrentUser(null)}return Ot(this._popupRedirectResolver,this,"argument-error"),yield this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===o._redirectEventId?this.directlySetCurrentUser(o):this.reloadAndSetCurrentUserOrClear(o)})}tryRedirectSignIn(t){return B(this,null,function*(){let e=null;try{e=yield this._popupRedirectResolver._completeRedirectFn(this,t,!0)}catch{yield this._setRedirectUser(null)}return e})}reloadAndSetCurrentUserOrClear(t){return B(this,null,function*(){try{yield WS(t)}catch(e){if(e?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(t)})}useDeviceLanguage(){this.languageCode=Vwe()}_delete(){return B(this,null,function*(){this._deleted=!0})}updateCurrentUser(t){return B(this,null,function*(){if(yc(this.app))return Promise.reject(Bh(this));let e=t?$h(t):null;return e&&Ot(e.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(e&&e._clone(this))})}_updateCurrentUser(t,e=!1){return B(this,null,function*(){if(!this._deleted)return t&&Ot(this.tenantId===t.tenantId,this,"tenant-id-mismatch"),e||(yield this.beforeStateQueue.runMiddleware(t)),this.queue(()=>B(this,null,function*(){yield this.directlySetCurrentUser(t),this.notifyAuthListeners()}))})}signOut(){return B(this,null,function*(){return yc(this.app)?Promise.reject(Bh(this)):(yield this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&(yield this._setRedirectUser(null)),this._updateCurrentUser(null,!0))})}setPersistence(t){return yc(this.app)?Promise.reject(Bh(this)):this.queue(()=>B(this,null,function*(){yield this.assertedPersistence.setPersistence(pd(t))}))}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}validatePassword(t){return B(this,null,function*(){this._getPasswordPolicyInternal()||(yield this._updatePasswordPolicy());let e=this._getPasswordPolicyInternal();return e.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):e.validatePassword(t)})}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}_updatePasswordPolicy(){return B(this,null,function*(){let t=yield Zwe(this),e=new LM(t);this.tenantId===null?this._projectPasswordPolicy=e:this._tenantPasswordPolicies[this.tenantId]=e})}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(t){this._errorFactory=new cd("auth","Firebase",t())}onAuthStateChanged(t,e,r){return this.registerStateListener(this.authStateSubscription,t,e,r)}beforeAuthStateChanged(t,e){return this.beforeStateQueue.pushCallback(t,e)}onIdTokenChanged(t,e,r){return this.registerStateListener(this.idTokenSubscription,t,e,r)}authStateReady(){return new Promise((t,e)=>{if(this.currentUser)t();else{let r=this.onAuthStateChanged(()=>{r(),t()},e)}})}revokeAccessToken(t){return B(this,null,function*(){if(this.currentUser){let e=yield this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:t,idToken:e};this.tenantId!=null&&(r.tenantId=this.tenantId),yield qwe(this,r)}})}toJSON(){var t;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(t=this._currentUser)===null||t===void 0?void 0:t.toJSON()}}_setRedirectUser(t,e){return B(this,null,function*(){let r=yield this.getOrInitRedirectPersistenceManager(e);return t===null?r.removeCurrentUser():r.setCurrentUser(t)})}getOrInitRedirectPersistenceManager(t){return B(this,null,function*(){if(!this.redirectPersistenceManager){let e=t&&pd(t)||this._popupRedirectResolver;Ot(e,this,"argument-error"),this.redirectPersistenceManager=yield GS.create(this,[pd(e._redirectPersistence)],"redirectUser"),this.redirectUser=yield this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager})}_redirectUserForId(t){return B(this,null,function*(){var e,r;return this._isInitialized&&(yield this.queue(()=>B(this,null,function*(){}))),((e=this._currentUser)===null||e===void 0?void 0:e._redirectEventId)===t?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===t?this.redirectUser:null})}_persistUserIfCurrent(t){return B(this,null,function*(){if(t===this.currentUser)return this.queue(()=>B(this,null,function*(){return this.directlySetCurrentUser(t)}))})}_notifyListenersIfCurrent(t){t===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t,e;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let r=(e=(t=this.currentUser)===null||t===void 0?void 0:t.uid)!==null&&e!==void 0?e:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(t,e,r,o){if(this._deleted)return()=>{};let i=typeof e=="function"?e:e.next.bind(e),s=!1,a=this._isInitialized?Promise.resolve():this._initializationPromise;if(Ot(a,this,"internal-error"),a.then(()=>{s||i(this.currentUser)}),typeof e=="function"){let l=t.addObserver(e,r,o);return()=>{s=!0,l()}}else{let l=t.addObserver(e);return()=>{s=!0,l()}}}directlySetCurrentUser(t){return B(this,null,function*(){this.currentUser&&this.currentUser!==t&&this._currentUser._stopProactiveRefresh(),t&&this.isProactiveRefreshEnabled&&t._startProactiveRefresh(),this.currentUser=t,t?yield this.assertedPersistence.setCurrentUser(t):yield this.assertedPersistence.removeCurrentUser()})}queue(t){return this.operations=this.operations.then(t,t),this.operations}get assertedPersistence(){return Ot(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(t){!t||this.frameworks.includes(t)||(this.frameworks.push(t),this.frameworks.sort(),this.clientVersion=TH(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){return B(this,null,function*(){var t;let e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);let r=yield(t=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||t===void 0?void 0:t.getHeartbeatsHeader();r&&(e["X-Firebase-Client"]=r);let o=yield this._getAppCheckToken();return o&&(e["X-Firebase-AppCheck"]=o),e})}_getAppCheckToken(){return B(this,null,function*(){var t;let e=yield(t=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||t===void 0?void 0:t.getToken();return e?.error&&Pwe(`Error while retrieving App Check token: ${e.error}`),e?.token})}};function JS(n){return $h(n)}var jS=class{constructor(t){this.auth=t,this.observer=null,this.addObserver=Mj(e=>this.observer=e)}get next(){return Ot(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}};var QM={loadJS(){return B(this,null,function*(){throw new Error("Unable to load external scripts")})},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Jwe(n){QM=n}function eCe(n){return QM.loadJS(n)}function tCe(){return QM.gapiScript}function DH(n){return`__${n}${Math.floor(Math.random()*1e6)}`}function kH(n,t){let e=kM(n,"auth");if(e.isInitialized()){let o=e.getImmediate(),i=e.getOptions();if(iy(i,t??{}))return o;vc(o,"already-initialized")}return e.initialize({options:t})}function nCe(n,t){let e=t?.persistence||[],r=(Array.isArray(e)?e:[e]).map(pd);t?.errorMap&&n._updateErrorMap(t.errorMap),n._initializeWithPersistence(r,t?.popupRedirectResolver)}function NH(n,t,e){let r=JS(n);Ot(r._canInitEmulator,r,"emulator-config-failed"),Ot(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");let o=!!e?.disableWarnings,i=AH(t),{host:s,port:a}=rCe(t),l=a===null?"":`:${a}`;r.config.emulator={url:`${i}//${s}${l}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:s,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:o})}),o||oCe()}function AH(n){let t=n.indexOf(":");return t<0?"":n.substr(0,t+1)}function rCe(n){let t=AH(n),e=/(\/\/)?([^?#/]+)/.exec(n.substr(t.length));if(!e)return{host:"",port:null};let r=e[2].split("@").pop()||"",o=/^(\[[^\]]+\])(:|$)/.exec(r);if(o){let i=o[1];return{host:i,port:eH(r.substr(i.length+1))}}else{let[i,s]=r.split(":");return{host:i,port:eH(s)}}}function eH(n){if(!n)return null;let t=Number(n);return isNaN(t)?null:t}function oCe(){function n(){let t=document.createElement("p"),e=t.style;t.innerText="Running in emulator mode. Do not use with production credentials.",e.position="fixed",e.width="100%",e.backgroundColor="#ffffff",e.border=".1em solid #000000",e.color="#b50000",e.bottom="0px",e.left="0px",e.margin="0px",e.zIndex="10000",e.textAlign="center",t.classList.add("firebase-emulator-warning"),document.body.appendChild(t)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}var nb=class{constructor(t,e){this.providerId=t,this.signInMethod=e}toJSON(){return dd("not implemented")}_getIdTokenResponse(t){return dd("not implemented")}_linkToIdToken(t,e){return dd("not implemented")}_getReauthenticationResolver(t){return dd("not implemented")}};function dy(n,t){return B(this,null,function*(){return Uwe(n,"POST","/v1/accounts:signInWithIdp",XM(n,t))})}var iCe="http://localhost",HS=class n extends nb{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(t){let e=new n(t.providerId,t.signInMethod);return t.idToken||t.accessToken?(t.idToken&&(e.idToken=t.idToken),t.accessToken&&(e.accessToken=t.accessToken),t.nonce&&!t.pendingToken&&(e.nonce=t.nonce),t.pendingToken&&(e.pendingToken=t.pendingToken)):t.oauthToken&&t.oauthTokenSecret?(e.accessToken=t.oauthToken,e.secret=t.oauthTokenSecret):vc("argument-error"),e}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(t){let e=typeof t=="string"?JSON.parse(t):t,{providerId:r,signInMethod:o}=e,i=yC(e,["providerId","signInMethod"]);if(!r||!o)return null;let s=new n(r,o);return s.idToken=i.idToken||void 0,s.accessToken=i.accessToken||void 0,s.secret=i.secret,s.nonce=i.nonce,s.pendingToken=i.pendingToken||null,s}_getIdTokenResponse(t){let e=this.buildRequest();return dy(t,e)}_linkToIdToken(t,e){let r=this.buildRequest();return r.idToken=e,dy(t,r)}_getReauthenticationResolver(t){let e=this.buildRequest();return e.autoCreate=!1,dy(t,e)}buildRequest(){let t={requestUri:iCe,returnSecureToken:!0};if(this.pendingToken)t.pendingToken=this.pendingToken;else{let e={};this.idToken&&(e.id_token=this.idToken),this.accessToken&&(e.access_token=this.accessToken),this.secret&&(e.oauth_token_secret=this.secret),e.providerId=this.providerId,this.nonce&&!this.pendingToken&&(e.nonce=this.nonce),t.postBody=sy(e)}return t}};var rb=class{constructor(t){this.providerId=t,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(t){this.defaultLanguageCode=t}setCustomParameters(t){return this.customParameters=t,this}getCustomParameters(){return this.customParameters}};var qS=class extends rb{constructor(){super(...arguments),this.scopes=[]}addScope(t){return this.scopes.includes(t)||this.scopes.push(t),this}getScopes(){return[...this.scopes]}};var JM=(()=>{class n extends qS{constructor(){super("google.com"),this.addScope("profile")}static credential(e,r){return HS._fromParams({providerId:n.PROVIDER_ID,signInMethod:n.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:r})}static credentialFromResult(e){return n.credentialFromTaggedObject(e)}static credentialFromError(e){return n.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthIdToken:r,oauthAccessToken:o}=e;if(!r&&!o)return null;try{return n.credential(r,o)}catch{return null}}}n.GOOGLE_SIGN_IN_METHOD="google.com",n.PROVIDER_ID="google.com";return n})();var ob=class n{constructor(t){this.user=t.user,this.providerId=t.providerId,this._tokenResponse=t._tokenResponse,this.operationType=t.operationType}static _fromIdTokenResponse(t,e,r,o=!1){return B(this,null,function*(){let i=yield py._fromIdTokenResponse(t,r,o),s=tH(r);return new n({user:i,providerId:s,_tokenResponse:r,operationType:e})})}static _forOperation(t,e,r){return B(this,null,function*(){yield t._updateTokensIfNecessary(r,!0);let o=tH(r);return new n({user:t,providerId:o,_tokenResponse:r,operationType:e})})}};function tH(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}var VM=class n extends Na{constructor(t,e,r,o){var i;super(e.code,e.message),this.operationType=r,this.user=o,Object.setPrototypeOf(this,n.prototype),this.customData={appName:t.name,tenantId:(i=t.tenantId)!==null&&i!==void 0?i:void 0,_serverResponse:e.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(t,e,r,o){return new n(t,e,r,o)}};function RH(n,t,e,r){return(t==="reauthenticate"?e._getReauthenticationResolver(n):e._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?VM._fromErrorAndOperation(n,i,t,r):i})}function sCe(n,t,e=!1){return B(this,null,function*(){let r=yield eb(n,t._linkToIdToken(n.auth,yield n.getIdToken()),e);return ob._forOperation(n,"link",r)})}function aCe(n,t,e=!1){return B(this,null,function*(){let{auth:r}=n;if(yc(r.app))return Promise.reject(Bh(r));let o="reauthenticate";try{let i=yield eb(n,RH(r,o,t,n),e);Ot(i.idToken,r,"internal-error");let s=YM(i.idToken);Ot(s,r,"internal-error");let{sub:a}=s;return Ot(n.uid===a,r,"user-mismatch"),ob._forOperation(n,o,i)}catch(i){throw i?.code==="auth/user-not-found"&&vc(r,"user-mismatch"),i}})}function lCe(n,t,e=!1){return B(this,null,function*(){if(yc(n.app))return Promise.reject(Bh(n));let r="signIn",o=yield RH(n,r,t),i=yield ob._fromIdTokenResponse(n,r,o);return e||(yield n._updateCurrentUser(i.user)),i})}function OH(n,t,e,r){return $h(n).onIdTokenChanged(t,e,r)}function MH(n,t,e){return $h(n).beforeAuthStateChanged(t,e)}var KS="__sak";var XS=class{constructor(t,e){this.storageRetriever=t,this.type=e}_isAvailable(){try{return this.storage?(this.storage.setItem(KS,"1"),this.storage.removeItem(KS),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(t,e){return this.storage.setItem(t,JSON.stringify(e)),Promise.resolve()}_get(t){let e=this.storage.getItem(t);return Promise.resolve(e?JSON.parse(e):null)}_remove(t){return this.storage.removeItem(t),Promise.resolve()}get storage(){return this.storageRetriever()}};var cCe=1e3,uCe=10,dCe=(()=>{class n extends XS{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,r)=>this.onStorageEvent(e,r),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=EH(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(let r of Object.keys(this.listeners)){let o=this.storage.getItem(r),i=this.localCache[r];o!==i&&e(r,i,o)}}onStorageEvent(e,r=!1){if(!e.key){this.forAllChangedKeys((a,l,c)=>{this.notifyListeners(a,c)});return}let o=e.key;r?this.detachListener():this.stopPolling();let i=()=>{let a=this.storage.getItem(o);!r&&this.localCache[o]===a||this.notifyListeners(o,a)},s=this.storage.getItem(o);Ywe()&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,uCe):i()}notifyListeners(e,r){this.localCache[e]=r;let o=this.listeners[e];if(o)for(let i of Array.from(o))i(r&&JSON.parse(r))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,r,o)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:r,newValue:o}),!0)})},cCe)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,r){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(r)}_removeListener(e,r){this.listeners[e]&&(this.listeners[e].delete(r),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}_set(e,r){return B(this,null,function*(){yield fh(n.prototype,this,"_set").call(this,e,r),this.localCache[e]=JSON.stringify(r)})}_get(e){return B(this,null,function*(){let r=yield fh(n.prototype,this,"_get").call(this,e);return this.localCache[e]=JSON.stringify(r),r})}_remove(e){return B(this,null,function*(){yield fh(n.prototype,this,"_remove").call(this,e),delete this.localCache[e]})}}return n.type="LOCAL",n})(),PH=dCe;var pCe=(()=>{class n extends XS{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,r){}_removeListener(e,r){}}return n.type="SESSION",n})(),eP=pCe;function fCe(n){return Promise.all(n.map(t=>B(this,null,function*(){try{return{fulfilled:!0,value:yield t}}catch(e){return{fulfilled:!1,reason:e}}})))}var hCe=(()=>{class n{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){let r=this.receivers.find(i=>i.isListeningto(e));if(r)return r;let o=new n(e);return this.receivers.push(o),o}isListeningto(e){return this.eventTarget===e}handleEvent(e){return B(this,null,function*(){let r=e,{eventId:o,eventType:i,data:s}=r.data,a=this.handlersMap[i];if(!a?.size)return;r.ports[0].postMessage({status:"ack",eventId:o,eventType:i});let l=Array.from(a).map(u=>B(this,null,function*(){return u(r.origin,s)})),c=yield fCe(l);r.ports[0].postMessage({status:"done",eventId:o,eventType:i,response:c})})}_subscribe(e,r){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(r)}_unsubscribe(e,r){this.handlersMap[e]&&r&&this.handlersMap[e].delete(r),(!r||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}n.receivers=[];return n})();function tP(n="",t=10){let e="";for(let r=0;r<t;r++)e+=Math.floor(Math.random()*10);return n+e}var BM=class{constructor(t){this.target=t,this.handlers=new Set}removeMessageHandler(t){t.messageChannel&&(t.messageChannel.port1.removeEventListener("message",t.onMessage),t.messageChannel.port1.close()),this.handlers.delete(t)}_send(t,e,r=50){return B(this,null,function*(){let o=typeof MessageChannel<"u"?new MessageChannel:null;if(!o)throw new Error("connection_unavailable");let i,s;return new Promise((a,l)=>{let c=tP("",20);o.port1.start();let u=setTimeout(()=>{l(new Error("unsupported_event"))},r);s={messageChannel:o,onMessage(d){let p=d;if(p.data.eventId===c)switch(p.data.status){case"ack":clearTimeout(u),i=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(p.data.response);break;default:clearTimeout(u),clearTimeout(i),l(new Error("invalid_response"));break}}},this.handlers.add(s),o.port1.addEventListener("message",s.onMessage),this.target.postMessage({eventType:t,eventId:c,data:e},[o.port2])}).finally(()=>{s&&this.removeMessageHandler(s)})})}};function xc(){return window}function mCe(n){xc().location.href=n}function FH(){return typeof xc().WorkerGlobalScope<"u"&&typeof xc().importScripts=="function"}function gCe(){return B(this,null,function*(){if(!navigator?.serviceWorker)return null;try{return(yield navigator.serviceWorker.ready).active}catch{return null}})}function yCe(){var n;return((n=navigator?.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function xCe(){return FH()?self:null}var LH="firebaseLocalStorageDb",vCe=1,YS="firebaseLocalStorage",$H="fbase_key",Uh=class{constructor(t){this.request=t}toPromise(){return new Promise((t,e)=>{this.request.addEventListener("success",()=>{t(this.request.result)}),this.request.addEventListener("error",()=>{e(this.request.error)})})}};function eI(n,t){return n.transaction([YS],t?"readwrite":"readonly").objectStore(YS)}function bCe(){let n=indexedDB.deleteDatabase(LH);return new Uh(n).toPromise()}function zM(){let n=indexedDB.open(LH,vCe);return new Promise((t,e)=>{n.addEventListener("error",()=>{e(n.error)}),n.addEventListener("upgradeneeded",()=>{let r=n.result;try{r.createObjectStore(YS,{keyPath:$H})}catch(o){e(o)}}),n.addEventListener("success",()=>B(this,null,function*(){let r=n.result;r.objectStoreNames.contains(YS)?t(r):(r.close(),yield bCe(),t(yield zM()))}))})}function nH(n,t,e){return B(this,null,function*(){let r=eI(n,!0).put({[$H]:t,value:e});return new Uh(r).toPromise()})}function wCe(n,t){return B(this,null,function*(){let e=eI(n,!1).get(t),r=yield new Uh(e).toPromise();return r===void 0?null:r.value})}function rH(n,t){let e=eI(n,!0).delete(t);return new Uh(e).toPromise()}var CCe=800,_Ce=3,SCe=(()=>{class n{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){return B(this,null,function*(){return this.db?this.db:(this.db=yield zM(),this.db)})}_withRetries(e){return B(this,null,function*(){let r=0;for(;;)try{let o=yield this._openDb();return yield e(o)}catch(o){if(r++>_Ce)throw o;this.db&&(this.db.close(),this.db=void 0)}})}initializeServiceWorkerMessaging(){return B(this,null,function*(){return FH()?this.initializeReceiver():this.initializeSender()})}initializeReceiver(){return B(this,null,function*(){this.receiver=hCe._getInstance(xCe()),this.receiver._subscribe("keyChanged",(e,r)=>B(this,null,function*(){return{keyProcessed:(yield this._poll()).includes(r.key)}})),this.receiver._subscribe("ping",(e,r)=>B(this,null,function*(){return["keyChanged"]}))})}initializeSender(){return B(this,null,function*(){var e,r;if(this.activeServiceWorker=yield gCe(),!this.activeServiceWorker)return;this.sender=new BM(this.activeServiceWorker);let o=yield this.sender._send("ping",{},800);o&&!((e=o[0])===null||e===void 0)&&e.fulfilled&&!((r=o[0])===null||r===void 0)&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)})}notifyServiceWorker(e){return B(this,null,function*(){if(!(!this.sender||!this.activeServiceWorker||yCe()!==this.activeServiceWorker))try{yield this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}})}_isAvailable(){return B(this,null,function*(){try{if(!indexedDB)return!1;let e=yield zM();return yield nH(e,KS,"1"),yield rH(e,KS),!0}catch{}return!1})}_withPendingWrite(e){return B(this,null,function*(){this.pendingWrites++;try{yield e()}finally{this.pendingWrites--}})}_set(e,r){return B(this,null,function*(){return this._withPendingWrite(()=>B(this,null,function*(){return yield this._withRetries(o=>nH(o,e,r)),this.localCache[e]=r,this.notifyServiceWorker(e)}))})}_get(e){return B(this,null,function*(){let r=yield this._withRetries(o=>wCe(o,e));return this.localCache[e]=r,r})}_remove(e){return B(this,null,function*(){return this._withPendingWrite(()=>B(this,null,function*(){return yield this._withRetries(r=>rH(r,e)),delete this.localCache[e],this.notifyServiceWorker(e)}))})}_poll(){return B(this,null,function*(){let e=yield this._withRetries(i=>{let s=eI(i,!1).getAll();return new Uh(s).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];let r=[],o=new Set;if(e.length!==0)for(let{fbase_key:i,value:s}of e)o.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(s)&&(this.notifyListeners(i,s),r.push(i));for(let i of Object.keys(this.localCache))this.localCache[i]&&!o.has(i)&&(this.notifyListeners(i,null),r.push(i));return r})}notifyListeners(e,r){this.localCache[e]=r;let o=this.listeners[e];if(o)for(let i of Array.from(o))i(r)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>B(this,null,function*(){return this._poll()}),CCe)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,r){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(r)}_removeListener(e,r){this.listeners[e]&&(this.listeners[e].delete(r),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}return n.type="LOCAL",n})(),VH=SCe;var hQe=DH("rcb"),mQe=new zh(3e4,6e4);function BH(n,t){return t?pd(t):(Ot(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}var ib=class extends nb{constructor(t){super("custom","custom"),this.params=t}_getIdTokenResponse(t){return dy(t,this._buildIdpRequest())}_linkToIdToken(t,e){return dy(t,this._buildIdpRequest(e))}_getReauthenticationResolver(t){return dy(t,this._buildIdpRequest())}_buildIdpRequest(t){let e={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return t&&(e.idToken=t),e}};function ICe(n){return lCe(n.auth,new ib(n),n.bypassAuthState)}function ECe(n){let{auth:t,user:e}=n;return Ot(e,t,"internal-error"),aCe(e,new ib(n),n.bypassAuthState)}function TCe(n){return B(this,null,function*(){let{auth:t,user:e}=n;return Ot(e,t,"internal-error"),sCe(e,new ib(n),n.bypassAuthState)})}var ZS=class{constructor(t,e,r,o,i=!1){this.auth=t,this.resolver=r,this.user=o,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(e)?e:[e]}execute(){return new Promise((t,e)=>B(this,null,function*(){this.pendingPromise={resolve:t,reject:e};try{this.eventManager=yield this.resolver._initialize(this.auth),yield this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}}))}onAuthEvent(t){return B(this,null,function*(){let{urlResponse:e,sessionId:r,postBody:o,tenantId:i,error:s,type:a}=t;if(s){this.reject(s);return}let l={auth:this.auth,requestUri:e,sessionId:r,tenantId:i||void 0,postBody:o||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(yield this.getIdpTask(a)(l))}catch(c){this.reject(c)}})}onError(t){this.reject(t)}getIdpTask(t){switch(t){case"signInViaPopup":case"signInViaRedirect":return ICe;case"linkViaPopup":case"linkViaRedirect":return TCe;case"reauthViaPopup":case"reauthViaRedirect":return ECe;default:vc(this.auth,"internal-error")}}resolve(t){fd(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(t),this.unregisterAndCleanUp()}reject(t){fd(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(t),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}};var DCe=new zh(2e3,1e4);function nP(n,t,e){return B(this,null,function*(){if(yc(n.app))return Promise.reject(Aa(n,"operation-not-supported-in-this-environment"));let r=JS(n);Fwe(n,t,rb);let o=BH(r,e);return new kCe(r,"signInViaPopup",t,o).executeNotNull()})}var kCe=(()=>{class n extends ZS{constructor(e,r,o,i,s){super(e,r,i,s),this.provider=o,this.authWindow=null,this.pollId=null,n.currentPopupAction&&n.currentPopupAction.cancel(),n.currentPopupAction=this}executeNotNull(){return B(this,null,function*(){let e=yield this.execute();return Ot(e,this.auth,"internal-error"),e})}onExecution(){return B(this,null,function*(){fd(this.filter.length===1,"Popup operations only handle one event");let e=tP();this.authWindow=yield this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(r=>{this.reject(r)}),this.resolver._isIframeWebStorageSupported(this.auth,r=>{r||this.reject(Aa(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()})}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(Aa(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,n.currentPopupAction=null}pollUserCancellation(){let e=()=>{var r,o;if(!((o=(r=this.authWindow)===null||r===void 0?void 0:r.window)===null||o===void 0)&&o.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Aa(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,DCe.get())};e()}}n.currentPopupAction=null;return n})(),NCe="pendingRedirect",VS=new Map,UM=class n extends ZS{constructor(t,e,r=!1){super(t,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],e,void 0,r),this.eventId=null}execute(){return B(this,null,function*(){let t=VS.get(this.auth._key());if(!t){try{let r=(yield ACe(this.resolver,this.auth))?yield fh(n.prototype,this,"execute").call(this):null;t=()=>Promise.resolve(r)}catch(e){t=()=>Promise.reject(e)}VS.set(this.auth._key(),t)}return this.bypassAuthState||VS.set(this.auth._key(),()=>Promise.resolve(null)),t()})}onAuthEvent(t){return B(this,null,function*(){if(t.type==="signInViaRedirect")return fh(n.prototype,this,"onAuthEvent").call(this,t);if(t.type==="unknown"){this.resolve(null);return}if(t.eventId){let e=yield this.auth._redirectUserForId(t.eventId);if(e)return this.user=e,fh(n.prototype,this,"onAuthEvent").call(this,t);this.resolve(null)}})}onExecution(){return B(this,null,function*(){})}cleanUp(){}};function ACe(n,t){return B(this,null,function*(){let e=MCe(t),r=OCe(n);if(!(yield r._isAvailable()))return!1;let o=(yield r._get(e))==="true";return yield r._remove(e),o})}function RCe(n,t){VS.set(n._key(),t)}function OCe(n){return pd(n._redirectPersistence)}function MCe(n){return $S(NCe,n.config.apiKey,n.name)}function PCe(n,t,e=!1){return B(this,null,function*(){if(yc(n.app))return Promise.reject(Bh(n));let r=JS(n),o=BH(r,t),s=yield new UM(r,o,e).execute();return s&&!e&&(delete s.user._redirectEventId,yield r._persistUserIfCurrent(s.user),yield r._setRedirectUser(null,t)),s})}var FCe=10*60*1e3,WM=class{constructor(t){this.auth=t,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(t){this.consumers.add(t),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,t)&&(this.sendToConsumer(this.queuedRedirectEvent,t),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(t){this.consumers.delete(t)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let e=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(t,r)&&(e=!0,this.sendToConsumer(t,r),this.saveEventToCache(t))}),this.hasHandledPotentialRedirect||!LCe(t)||(this.hasHandledPotentialRedirect=!0,e||(this.queuedRedirectEvent=t,e=!0)),e}sendToConsumer(t,e){var r;if(t.error&&!zH(t)){let o=((r=t.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";e.onError(Aa(this.auth,o))}else e.onAuthEvent(t)}isEventForConsumer(t,e){let r=e.eventId===null||!!t.eventId&&t.eventId===e.eventId;return e.filter.includes(t.type)&&r}hasEventBeenHandled(t){return Date.now()-this.lastProcessedEventTime>=FCe&&this.cachedEventUids.clear(),this.cachedEventUids.has(oH(t))}saveEventToCache(t){this.cachedEventUids.add(oH(t)),this.lastProcessedEventTime=Date.now()}};function oH(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(t=>t).join("-")}function zH({type:n,error:t}){return n==="unknown"&&t?.code==="auth/no-auth-event"}function LCe(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return zH(n);default:return!1}}function $Ce(e){return B(this,arguments,function*(n,t={}){return fy(n,"GET","/v1/projects",t)})}var VCe=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,BCe=/^https?/;function zCe(n){return B(this,null,function*(){if(n.config.emulator)return;let{authorizedDomains:t}=yield $Ce(n);for(let e of t)try{if(UCe(e))return}catch{}vc(n,"unauthorized-domain")})}function UCe(n){let t=RM(),{protocol:e,hostname:r}=new URL(t);if(n.startsWith("chrome-extension://")){let s=new URL(n);return s.hostname===""&&r===""?e==="chrome-extension:"&&n.replace("chrome-extension://","")===t.replace("chrome-extension://",""):e==="chrome-extension:"&&s.hostname===r}if(!BCe.test(e))return!1;if(VCe.test(n))return r===n;let o=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+o+"|"+o+")$","i").test(r)}var WCe=new zh(3e4,6e4);function iH(){let n=xc().___jsl;if(n?.H){for(let t of Object.keys(n.H))if(n.H[t].r=n.H[t].r||[],n.H[t].L=n.H[t].L||[],n.H[t].r=[...n.H[t].L],n.CP)for(let e=0;e<n.CP.length;e++)n.CP[e]=null}}function GCe(n){return new Promise((t,e)=>{var r,o,i;function s(){iH(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{iH(),e(Aa(n,"network-request-failed"))},timeout:WCe.get()})}if(!((o=(r=xc().gapi)===null||r===void 0?void 0:r.iframes)===null||o===void 0)&&o.Iframe)t(gapi.iframes.getContext());else if(!((i=xc().gapi)===null||i===void 0)&&i.load)s();else{let a=DH("iframefcb");return xc()[a]=()=>{gapi.load?s():e(Aa(n,"network-request-failed"))},eCe(`${tCe()}?onload=${a}`).catch(l=>e(l))}}).catch(t=>{throw BS=null,t})}var BS=null;function jCe(n){return BS=BS||GCe(n),BS}var HCe=new zh(5e3,15e3),qCe="__/auth/iframe",KCe="emulator/auth/iframe",XCe={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},YCe=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function ZCe(n){let t=n.config;Ot(t.authDomain,n,"auth-domain-config-required");let e=t.emulator?KM(t,KCe):`https://${n.config.authDomain}/${qCe}`,r={apiKey:t.apiKey,appName:n.name,v:uy},o=YCe.get(n.config.apiHost);o&&(r.eid=o);let i=n._getFrameworks();return i.length&&(r.fw=i.join(",")),`${e}?${sy(r).slice(1)}`}function QCe(n){return B(this,null,function*(){let t=yield jCe(n),e=xc().gapi;return Ot(e,n,"internal-error"),t.open({where:document.body,url:ZCe(n),messageHandlersFilter:e.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:XCe,dontclear:!0},r=>new Promise((o,i)=>B(this,null,function*(){yield r.restyle({setHideOnLeave:!1});let s=Aa(n,"network-request-failed"),a=xc().setTimeout(()=>{i(s)},HCe.get());function l(){xc().clearTimeout(a),o(r)}r.ping(l).then(l,()=>{i(s)})})))})}var JCe={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},e_e=500,t_e=600,n_e="_blank",r_e="http://localhost",QS=class{constructor(t){this.window=t,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}};function o_e(n,t,e,r=e_e,o=t_e){let i=Math.max((window.screen.availHeight-o)/2,0).toString(),s=Math.max((window.screen.availWidth-r)/2,0).toString(),a="",l=Object.assign(Object.assign({},JCe),{width:r.toString(),height:o.toString(),top:i,left:s}),c=qo().toLowerCase();e&&(a=wH(c)?n_e:e),vH(c)&&(t=t||r_e,l.scrollbars="yes");let u=Object.entries(l).reduce((p,[f,h])=>`${p}${f}=${h},`,"");if(Xwe(c)&&a!=="_self")return i_e(t||"",a),new QS(null);let d=window.open(t||"",a,u);Ot(d,n,"popup-blocked");try{d.focus()}catch{}return new QS(d)}function i_e(n,t){let e=document.createElement("a");e.href=n,e.target=t;let r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),e.dispatchEvent(r)}var s_e="__/auth/handler",a_e="emulator/auth/handler",l_e=encodeURIComponent("fac");function sH(n,t,e,r,o,i){return B(this,null,function*(){Ot(n.config.authDomain,n,"auth-domain-config-required"),Ot(n.config.apiKey,n,"invalid-api-key");let s={apiKey:n.config.apiKey,appName:n.name,authType:e,redirectUrl:r,v:uy,eventId:o};if(t instanceof rb){t.setDefaultLanguage(n.languageCode),s.providerId=t.providerId||"",Oj(t.getCustomParameters())||(s.customParameters=JSON.stringify(t.getCustomParameters()));for(let[u,d]of Object.entries(i||{}))s[u]=d}if(t instanceof qS){let u=t.getScopes().filter(d=>d!=="");u.length>0&&(s.scopes=u.join(","))}n.tenantId&&(s.tid=n.tenantId);let a=s;for(let u of Object.keys(a))a[u]===void 0&&delete a[u];let l=yield n._getAppCheckToken(),c=l?`#${l_e}=${encodeURIComponent(l)}`:"";return`${c_e(n)}?${sy(a).slice(1)}${c}`})}function c_e({config:n}){return n.emulator?KM(n,a_e):`https://${n.authDomain}/${s_e}`}var AM="webStorageSupport",GM=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=eP,this._completeRedirectFn=PCe,this._overrideRedirectResult=RCe}_openPopup(t,e,r,o){return B(this,null,function*(){var i;fd((i=this.eventManagers[t._key()])===null||i===void 0?void 0:i.manager,"_initialize() not called before _openPopup()");let s=yield sH(t,e,r,RM(),o);return o_e(t,s,tP())})}_openRedirect(t,e,r,o){return B(this,null,function*(){yield this._originValidation(t);let i=yield sH(t,e,r,RM(),o);return mCe(i),new Promise(()=>{})})}_initialize(t){let e=t._key();if(this.eventManagers[e]){let{manager:o,promise:i}=this.eventManagers[e];return o?Promise.resolve(o):(fd(i,"If manager is not set, promise should be"),i)}let r=this.initAndGetManager(t);return this.eventManagers[e]={promise:r},r.catch(()=>{delete this.eventManagers[e]}),r}initAndGetManager(t){return B(this,null,function*(){let e=yield QCe(t),r=new WM(t);return e.register("authEvent",o=>(Ot(o?.authEvent,t,"invalid-auth-event"),{status:r.onEvent(o.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:r},this.iframes[t._key()]=e,r})}_isIframeWebStorageSupported(t,e){this.iframes[t._key()].send(AM,{type:AM},o=>{var i;let s=(i=o?.[0])===null||i===void 0?void 0:i[AM];s!==void 0&&e(!!s),vc(t,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(t){let e=t._key();return this.originValidationPromises[e]||(this.originValidationPromises[e]=zCe(t)),this.originValidationPromises[e]}get _shouldInitProactively(){return EH()||bH()||ZM()}},UH=GM;var aH="@firebase/auth",lH="1.8.2";var jM=class{constructor(t){this.auth=t,this.internalListeners=new Map}getUid(){var t;return this.assertAuthConfigured(),((t=this.auth.currentUser)===null||t===void 0?void 0:t.uid)||null}getToken(t){return B(this,null,function*(){return this.assertAuthConfigured(),yield this.auth._initializationPromise,this.auth.currentUser?{accessToken:yield this.auth.currentUser.getIdToken(t)}:null})}addAuthTokenListener(t){if(this.assertAuthConfigured(),this.internalListeners.has(t))return;let e=this.auth.onIdTokenChanged(r=>{t(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(t,e),this.updateProactiveRefresh()}removeAuthTokenListener(t){this.assertAuthConfigured();let e=this.internalListeners.get(t);e&&(this.internalListeners.delete(t),e(),this.updateProactiveRefresh())}assertAuthConfigured(){Ot(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}};function u_e(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function d_e(n){cy(new mc("auth",(t,{options:e})=>{let r=t.getProvider("app").getImmediate(),o=t.getProvider("heartbeat"),i=t.getProvider("app-check-internal"),{apiKey:s,authDomain:a}=r.options;Ot(s&&!s.includes(":"),"invalid-api-key",{appName:r.name});let l={apiKey:s,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:TH(n)},c=new $M(r,o,i,l);return nCe(c,e),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((t,e,r)=>{t.getProvider("auth-internal").initialize()})),cy(new mc("auth-internal",t=>{let e=JS(t.getProvider("auth").getImmediate());return(r=>new jM(r))(e)},"PRIVATE").setInstantiationMode("EXPLICIT")),ly(aH,lH,u_e(n)),ly(aH,lH,"esm2017")}var p_e=5*60,f_e=hM("authIdTokenMaxAge")||p_e,cH=null,h_e=n=>t=>B(void 0,null,function*(){let e=t&&(yield t.getIdTokenResult()),r=e&&(new Date().getTime()-Date.parse(e.issuedAtTime))/1e3;if(r&&r>f_e)return;let o=e?.token;cH!==o&&(cH=o,yield fetch(n,{method:o?"POST":"DELETE",headers:o?{Authorization:`Bearer ${o}`}:{}}))});function rP(n=qj()){let t=kM(n,"auth");if(t.isInitialized())return t.getImmediate();let e=kH(n,{popupRedirectResolver:UH,persistence:[VH,PH,eP]}),r=hM("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){let i=new URL(r,location.origin);if(location.origin===i.origin){let s=h_e(i.toString());MH(e,s,()=>s(e.currentUser)),OH(e,a=>s(a))}}let o=Ij("auth");return o&&NH(e,`http://${o}`),e}function m_e(){var n,t;return(t=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&t!==void 0?t:document}Jwe({loadJS(n){return new Promise((t,e)=>{let r=document.createElement("script");r.setAttribute("src",n),r.onload=t,r.onerror=o=>{let i=Aa("internal-error");i.customData=o,e(i)},r.type="text/javascript",r.charset="UTF-8",m_e().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});d_e("Browser");var g_e=n=>({"disabled-btn":n}),y_e=n=>({notdisplay:n}),sb=(n,t)=>({valid:n,invalid:t});function x_e(n,t){n&1&&(E(0,"div",27),O(1," Email ID is invalid "),S())}function v_e(n,t){if(n&1&&(E(0,"div",28)(1,"ul",29)(2,"li",29),O(3," Password must be 8-16 characters long "),S(),E(4,"li",29),O(5," At least one number must be present "),S(),E(6,"li",29),O(7," At least one capital letter must be present "),S(),E(8,"li",29),O(9," At least one small letter must be present "),S(),E(10,"li",29),O(11," At least one special symbol must be present "),S()()()),n&2){let e=le();z(),re("ngClass",Qu(6,y_e,e.togglePasswordRules())),z(),re("ngClass",mp(8,sb,e.isValidPasswordLength(),!e.isValidPasswordLength())),z(2),re("ngClass",mp(11,sb,e.containsNumber(),!e.containsNumber())),z(2),re("ngClass",mp(14,sb,e.containsUpperCase(),!e.containsUpperCase())),z(2),re("ngClass",mp(17,sb,e.containsLowerCase(),!e.containsLowerCase())),z(2),re("ngClass",mp(20,sb,e.containsSpecialCharacter(),!e.containsSpecialCharacter()))}}function b_e(n,t){n&1&&(E(0,"div",30),O(1," Password mismatch "),S())}function w_e(n,t){n&1&&ce(0,"input",31)}function C_e(n,t){if(n&1&&(E(0,"span"),O(1),S()),n&2){let e=le();z(),Ye(e.otpSent?"Verify OTP":"Signup")}}function __e(n,t){n&1&&ce(0,"span",32)}var tI=class n{constructor(t,e,r,o){this.fb=t;this.authService=e;this.router=r;this.notification=o;this.signupForm=this.fb.group({userName:["",[tr.required]],email:["",[tr.required,tr.email]],password:["",[tr.required,tr.minLength(8),tr.maxLength(16),tr.pattern("^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?=.*[#@$!%*?&])[A-Za-z\\d#@$!%*?&].{8,16}$")]],confirmPassword:["",[tr.required]],userType:["",[tr.required]],otp:[""]},{validator:this.passwordMatchValidator})}loading=!1;otpSent=!1;signupForm;showPasswordRules=!1;passwordMatchValidator(t){return t.get("password")?.value===t.get("confirmPassword")?.value?null:{mismatch:!0}}onSubmit(){if(this.otpSent)this.loading=!0,this.authService.verifyOtp(this.signupForm.value).subscribe(t=>{if(this.loading=!1,t.error){this.notification.showNotification(t.msg,"error");return}this.router.navigate(["login"]),this.notification.showNotification(t.msg,"success")},t=>{this.loading=!1,this.notification.showNotification(t.error?.msg||"OTP verification failed. Please try again.","error")});else{if(this.signupForm.invalid)return;this.loading=!0,this.authService.signup(this.signupForm.value).subscribe(t=>{if(t.error){this.loading=!1,this.notification.showNotification(t.msg,"error");return}this.loading=!1,this.otpSent=!0,this.notification.showNotification(t.msg,"success")},t=>{this.loading=!1,this.notification.showNotification(t.error?.msg||"Signup failed. Please try again.","error")})}}signUpWithGoogle(){return B(this,null,function*(){let t=rP(),e=new JM;try{let o=(yield nP(t,e)).user,i={name:o.displayName,email:o.email,verificationType:"google"};this.authService.googleSignup(i).subscribe(s=>{s.error?this.notification.showNotification(s.msg,"error"):(this.router.navigate(["/dashboard"]),this.notification.showNotification("Signup Successful!","success"))},s=>{this.notification.showNotification(s.error?.msg||"Signup failed","error")})}catch(r){console.error("Google Signup Error:",r),this.notification.showNotification("Google Signup failed","error")}})}isValidPasswordLength(){let t=this.signupForm.get("password")?.value;return t&&t.length>=8&&t.length<=16}containsNumber(){let t=this.signupForm.get("password")?.value;return/\d/.test(t)}containsUpperCase(){let t=this.signupForm.get("password")?.value;return/[A-Z]/.test(t)}containsLowerCase(){let t=this.signupForm.get("password")?.value;return/[a-z]/.test(t)}containsSpecialCharacter(){let t=this.signupForm.get("password")?.value;return/[#@$!%*?&]/.test(t)}togglePasswordRules(){return this.containsLowerCase()&&this.containsSpecialCharacter()&&this.containsUpperCase()&&this.containsNumber()}static \u0275fac=function(e){return new(e||n)(Be(oy),Be(xn),Be(Ut),Be(Vn))};static \u0275cmp=Ct({type:n,selectors:[["app-signup"]],decls:36,vars:11,consts:[[1,"authMain"],[1,"navbar"],[1,"container1"],["id","form1",1,"formContainer"],[1,"fcLeft"],["src","https://www.shutterstock.com/shutterstock/photos/2462169757/display_1500/stock-photo-sport-collage-energetic-athletes-from-diverse-sports-leap-and-compete-shows-spectrum-of-2462169757.jpg","alt",""],[1,"fcRight"],[2,"margin-bottom","18px","font-weight","600"],[1,"f1",3,"ngSubmit","formGroup"],["formControlName","userName","placeholder","Name","required",""],["formControlName","email","placeholder","Email","required",""],["style","color: red; margin: 0",4,"ngIf"],["formControlName","password","placeholder","Password","type","password","required","",3,"focus"],["class","checks",4,"ngIf"],["formControlName","confirmPassword","placeholder","Confirm Password","type","password","required",""],["style","color: red",4,"ngIf"],["formControlName","userType","required",""],["value",""],["value","fitness_center"],["value","user"],["formControlName","otp","placeholder","Enter OTP","required","",4,"ngIf"],["type","submit",1,"fb1",3,"disabled","ngClass"],[4,"ngIf"],["class","spinner",4,"ngIf"],[1,"google-signup",3,"click"],["src","https://developers.google.com/identity/images/g-logo.png","alt","Google Logo"],["href","/login"],[2,"color","red","margin","0"],[1,"checks"],[3,"ngClass"],[2,"color","red"],["formControlName","otp","placeholder","Enter OTP","required",""],[1,"spinner"]],template:function(e,r){if(e&1&&(E(0,"div",0)(1,"div",1),ce(2,"app-navbar"),S(),E(3,"div",2)(4,"div",3)(5,"div",4),ce(6,"img",5),S(),E(7,"div",6)(8,"p",7),O(9,"Signup Form"),S(),E(10,"form",8),_e("ngSubmit",function(){return r.onSubmit()}),ce(11,"input",9)(12,"input",10),Ne(13,x_e,2,0,"div",11),E(14,"input",12),_e("focus",function(){return r.showPasswordRules=!0}),S(),Ne(15,v_e,12,23,"div",13),ce(16,"input",14),Ne(17,b_e,2,0,"div",15),E(18,"select",16)(19,"option",17),O(20,"Select User Type"),S(),E(21,"option",18),O(22,"Fitness Center"),S(),E(23,"option",19),O(24,"User"),S()(),Ne(25,w_e,1,0,"input",20),E(26,"button",21),Ne(27,C_e,2,1,"span",22)(28,__e,1,0,"span",23),S()(),E(29,"button",24),_e("click",function(){return r.signUpWithGoogle()}),ce(30,"img",25),O(31," Signup with Google "),S(),ce(32,"br"),E(33,"a",26),O(34,"Already Have An Account? Login"),S()()()()(),ce(35,"app-footer")),e&2){let o,i;z(10),re("formGroup",r.signupForm),z(3),re("ngIf",((o=r.signupForm.get("email"))==null?null:o.invalid)&&((o=r.signupForm.get("email"))==null?null:o.touched)),z(2),re("ngIf",r.showPasswordRules),z(2),re("ngIf",(r.signupForm.errors==null?null:r.signupForm.errors.mismatch)&&((i=r.signupForm.get("confirmPassword"))==null?null:i.touched)),z(8),re("ngIf",r.otpSent),z(),re("disabled",r.loading||r.signupForm.invalid)("ngClass",Qu(9,g_e,r.loading||r.signupForm.invalid)),z(),re("ngIf",!r.loading),z(),re("ngIf",r.loading)}},dependencies:[Xr,Ln,yp,Ls,Vi,fc,hc,vo,Ps,Ho,$i,ad,Fh,Lh,Kn],styles:[".valid[_ngcontent-%COMP%]{color:green}.invalid[_ngcontent-%COMP%]{color:red}.checks[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{font-size:small;list-style:none;text-align:left;width:100%}.checks[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{padding-left:0}.notdisplay[_ngcontent-%COMP%]{display:none}#form1[_ngcontent-%COMP%]{height:550px!important}.google-signup[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;background:#fff;border:1px solid #ddd;padding:10px;cursor:pointer;border-radius:9999px;margin:16px auto}.google-signup[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:20px;margin-right:10px}"]})};var oP=n=>({"disabled-btn":n});function S_e(n,t){n&1&&(E(0,"span"),O(1,"Send OTP"),S())}function I_e(n,t){n&1&&ce(0,"span",14)}function E_e(n,t){if(n&1){let e=et();E(0,"div")(1,"form",10),_e("ngSubmit",function(){ve(e);let o=le();return be(o.onSubmitEmail())}),ce(2,"input",11),E(3,"button",12),Ne(4,S_e,2,0,"span",8)(5,I_e,1,0,"span",13),S()()()}if(n&2){let e=le();z(),re("formGroup",e.forgotPasswordForm),z(2),re("disabled",e.forgotPasswordForm.invalid||e.loading)("ngClass",Qu(5,oP,e.loading||e.forgotPasswordForm.invalid)),z(),re("ngIf",!e.loading),z(),re("ngIf",e.loading)}}function T_e(n,t){n&1&&(E(0,"span"),O(1,"Verify OTP"),S())}function D_e(n,t){n&1&&ce(0,"span",14)}function k_e(n,t){if(n&1){let e=et();E(0,"div")(1,"form",10),_e("ngSubmit",function(){ve(e);let o=le();return be(o.onSubmitOtp())}),ce(2,"input",15),E(3,"button",12),Ne(4,T_e,2,0,"span",8)(5,D_e,1,0,"span",13),S()()()}if(n&2){let e=le();z(),re("formGroup",e.otpForm),z(2),re("disabled",e.otpForm.invalid||e.loading)("ngClass",Qu(5,oP,e.loading||e.forgotPasswordForm.invalid)),z(),re("ngIf",!e.loading),z(),re("ngIf",e.loading)}}function N_e(n,t){n&1&&(E(0,"span"),O(1,"Change Password"),S())}function A_e(n,t){n&1&&ce(0,"span",14)}function R_e(n,t){if(n&1){let e=et();E(0,"div")(1,"form",10),_e("ngSubmit",function(){ve(e);let o=le();return be(o.onSubmitPassword())}),ce(2,"input",16)(3,"input",17),E(4,"button",12),Ne(5,N_e,2,0,"span",8)(6,A_e,1,0,"span",13),S()()()}if(n&2){let e=le();z(),re("formGroup",e.passwordForm),z(3),re("disabled",e.passwordForm.invalid||e.loading)("ngClass",Qu(5,oP,e.loading||e.forgotPasswordForm.invalid)),z(),re("ngIf",!e.loading),z(),re("ngIf",e.loading)}}var nI=class n{constructor(t,e,r){this.fb=t;this.authService=e;this.router=r;this.forgotPasswordForm=this.fb.group({email:["",[tr.required,tr.email]]}),this.otpForm=this.fb.group({otp:["",[tr.required,tr.minLength(6),tr.maxLength(6)]]}),this.passwordForm=this.fb.group({password:["",[tr.required,tr.minLength(8)]],confirmPassword:["",[tr.required]]},{validator:this.checkPasswords})}forgotPasswordForm;otpForm;passwordForm;step=1;loading=!1;email="";notificationService=Q(Vn);checkPasswords(t){let e=t.controls.password.value,r=t.controls.confirmPassword.value;return e===r?null:{notSame:!0}}onSubmitEmail(){this.forgotPasswordForm.invalid||(this.loading=!0,this.authService.sendOtp(this.forgotPasswordForm.value.email).subscribe(t=>{this.loading=!1,this.email=this.forgotPasswordForm.value.email,this.step=2,this.notificationService.showNotification(`${t.msg}`,"success")},t=>{this.loading=!1,this.notificationService.showNotification(`${t.error.msg}`,"error")}))}onSubmitOtp(){this.otpForm.invalid||(this.loading=!0,this.authService.verifyForgotPasswordOtp(this.email,this.otpForm.value.otp).subscribe(t=>{this.loading=!1,this.step=3,this.notificationService.showNotification(`${t.msg}`,"success")},t=>{this.loading=!1,this.notificationService.showNotification(`${t.error.msg}`,"error")}))}onSubmitPassword(){if(this.passwordForm.invalid)return;this.loading=!0;let{password:t}=this.passwordForm.value;this.authService.resetPassword(this.email,t).subscribe(e=>{this.loading=!1,this.notificationService.showNotification(`${e.msg}`,"success"),this.router.navigate(["/login"])},e=>{this.loading=!1,this.notificationService.showNotification(`${e.error.msg}`,"error")})}static \u0275fac=function(e){return new(e||n)(Be(oy),Be(xn),Be(Ut))};static \u0275cmp=Ct({type:n,selectors:[["app-forgot-password"]],decls:16,vars:3,consts:[[1,"authMain"],[1,"navbar"],[1,"container1"],[1,"formContainer"],[1,"fcLeft"],["src","https://th.bing.com/th/id/OIP.O_8rSHuOJE_WcXkJk7bvrQHaEK?rs=1&pid=ImgDetMain","alt",""],[1,"fcRight"],[2,"margin-bottom","18px","font-weight","600"],[4,"ngIf"],["href","/login"],[1,"f1",3,"ngSubmit","formGroup"],["formControlName","email","placeholder","Enter your email"],[1,"fb1",3,"disabled","ngClass"],["class","spinner",4,"ngIf"],[1,"spinner"],["formControlName","otp","placeholder","Enter the OTP"],["formControlName","password","type","password","placeholder","Enter new password"],["formControlName","confirmPassword","type","password","placeholder","Confirm new password"]],template:function(e,r){e&1&&(E(0,"div",0)(1,"div",1),ce(2,"app-navbar"),S(),E(3,"div",2)(4,"div",3)(5,"div",4),ce(6,"img",5),S(),E(7,"div",6)(8,"p",7),O(9,"Forgot Password"),S(),Ne(10,E_e,6,7,"div",8)(11,k_e,6,7,"div",8)(12,R_e,7,7,"div",8),E(13,"a",9),O(14,"Already Have An Account? Login"),S()()()(),ce(15,"app-footer"),S()),e&2&&(z(10),re("ngIf",r.step===1),z(),re("ngIf",r.step===2),z(),re("ngIf",r.step===3))},dependencies:[Xr,Kn,yp,Ln,Ls,Vi,vo,Ho,$i,Fh,Lh],encapsulation:2})};var O_e=()=>[""];function M_e(n,t){if(n&1){let e=et();E(0,"tr")(1,"td"),O(2),S(),E(3,"td"),O(4),S(),E(5,"td"),O(6),S(),E(7,"td")(8,"button",12),_e("click",function(){let o=ve(e).$implicit,i=le();return be(i.showDetails(o._id))}),O(9,"View"),S()()()}if(n&2){let e=t.$implicit,r=t.index;z(2),Ye(r+1),z(2),Ye(e.centerName),z(2),Ye(e.centerHeadEmail)}}function P_e(n,t){if(n&1){let e=et();E(0,"div",22)(1,"div",23)(2,"h4"),O(3,"Gym Details"),S(),E(4,"p"),O(5),S(),E(6,"p"),O(7),S(),E(8,"p"),O(9),S(),E(10,"p"),O(11),S(),E(12,"p"),O(13),S(),E(14,"button",12),_e("click",function(){ve(e);let o=le();return be(o.verifyGym(o.selectedGym._id))}),O(15,"Verify"),S(),E(16,"button",12),_e("click",function(){ve(e);let o=le();return be(o.closeDetails())}),O(17,"Close"),S()()()}if(n&2){let e=le();z(5),Tt("Name: ",e.selectedGym.centerName,""),z(2),Tt("Address: ",e.selectedGym.address,""),z(2),Tt("Phone Number: ",e.selectedGym.contactNumber,""),z(2),Tt("Description: ",e.selectedGym.details,""),z(2),Tt("Registration Number: ",e.selectedGym.registrationNumber,"")}}function F_e(n,t){if(n&1){let e=et();E(0,"div",56)(1,"input",57),ht("ngModelChange",function(o){let i=ve(e).index,s=le(2);return gt(s.exerciseData.equipments[i],o)||(s.exerciseData.equipments[i]=o),be(o)}),S(),E(2,"button",45),_e("click",function(){let o=ve(e).index,i=le(2);return be(i.removeField("equipments",o))}),O(3,"Remove"),S()()}if(n&2){let e=t.index,r=le(2);z(),Ca("name","equipments",e,""),ft("ngModel",r.exerciseData.equipments[e])}}function L_e(n,t){if(n&1){let e=et();E(0,"div",56)(1,"input",58),ht("ngModelChange",function(o){let i=ve(e).index,s=le(2);return gt(s.exerciseData.images[i],o)||(s.exerciseData.images[i]=o),be(o)}),S(),E(2,"button",45),_e("click",function(){let o=ve(e).index,i=le(2);return be(i.removeField("images",o))}),O(3,"Remove"),S()()}if(n&2){let e=t.index,r=le(2);z(),Ca("name","images",e,""),ft("ngModel",r.exerciseData.images[e])}}function $_e(n,t){if(n&1){let e=et();E(0,"div",56)(1,"input",59),ht("ngModelChange",function(o){let i=ve(e).index,s=le(2);return gt(s.exerciseData.videos[i],o)||(s.exerciseData.videos[i]=o),be(o)}),S(),E(2,"button",45),_e("click",function(){let o=ve(e).index,i=le(2);return be(i.removeField("videos",o))}),O(3,"Remove"),S()()}if(n&2){let e=t.index,r=le(2);z(),Ca("name","videos",e,""),ft("ngModel",r.exerciseData.videos[e])}}function V_e(n,t){if(n&1){let e=et();E(0,"div",56)(1,"input",60),ht("ngModelChange",function(o){let i=ve(e).index,s=le(2);return gt(s.exerciseData.procedures[i],o)||(s.exerciseData.procedures[i]=o),be(o)}),S(),E(2,"button",45),_e("click",function(){let o=ve(e).index,i=le(2);return be(i.removeField("procedures",o))}),O(3,"Remove"),S()()}if(n&2){let e=t.index,r=le(2);z(),Ca("name","procedures",e,""),ft("ngModel",r.exerciseData.procedures[e])}}function B_e(n,t){if(n&1){let e=et();E(0,"div",24)(1,"span",25),O(2,"Add New Exercise Details"),S(),ce(3,"div",15),E(4,"form",26,0),_e("ngSubmit",function(){ve(e);let o=le();return be(o.submitExercise())}),E(6,"div",27)(7,"label",28),O(8,"Exercise Name:"),S(),E(9,"input",29),ht("ngModelChange",function(o){ve(e);let i=le();return gt(i.exerciseData.exerciseName,o)||(i.exerciseData.exerciseName=o),be(o)}),S()(),E(10,"div",27)(11,"label",30),O(12,"Exercise Type:"),S(),E(13,"input",31),ht("ngModelChange",function(o){ve(e);let i=le();return gt(i.exerciseData.exerciseType,o)||(i.exerciseData.exerciseType=o),be(o)}),S()(),E(14,"div",27)(15,"label",32),O(16,"Duration (minutes):"),S(),E(17,"input",33),ht("ngModelChange",function(o){ve(e);let i=le();return gt(i.exerciseData.exerciseDuration,o)||(i.exerciseData.exerciseDuration=o),be(o)}),S()(),E(18,"div",27)(19,"label",34),O(20,"Muscle Group:"),S(),E(21,"input",35),ht("ngModelChange",function(o){ve(e);let i=le();return gt(i.exerciseData.exerciseMuscleGroup,o)||(i.exerciseData.exerciseMuscleGroup=o),be(o)}),S()(),E(22,"div",27)(23,"label",36),O(24,"Difficulty Level:"),S(),E(25,"select",37),ht("ngModelChange",function(o){ve(e);let i=le();return gt(i.exerciseData.difficultyLevel,o)||(i.exerciseData.difficultyLevel=o),be(o)}),E(26,"option",38),O(27,"Select Difficulty"),S(),E(28,"option",39),O(29,"Easy"),S(),E(30,"option",40),O(31,"Medium"),S(),E(32,"option",41),O(33,"Hard"),S()()(),E(34,"div",27)(35,"label",42),O(36,"Exercise Category:"),S(),E(37,"input",43),ht("ngModelChange",function(o){ve(e);let i=le();return gt(i.exerciseData.exerciseCategory,o)||(i.exerciseData.exerciseCategory=o),be(o)}),S()(),E(38,"div")(39,"div",44)(40,"label"),O(41,"equipments:"),S(),E(42,"button",45),_e("click",function(){ve(e);let o=le();return be(o.addField("equipments"))}),O(43,"Add Equipment"),S()(),Ne(44,F_e,4,3,"div",46),S(),E(45,"div",27)(46,"label",47),O(47,"Details:"),S(),E(48,"textarea",48),ht("ngModelChange",function(o){ve(e);let i=le();return gt(i.exerciseData.details,o)||(i.exerciseData.details=o),be(o)}),S()(),E(49,"div",27)(50,"label",49),O(51,"Benefits:"),S(),E(52,"textarea",50),ht("ngModelChange",function(o){ve(e);let i=le();return gt(i.exerciseData.benefits,o)||(i.exerciseData.benefits=o),be(o)}),S()(),E(53,"div",27)(54,"label",51),O(55,"Limitations:"),S(),E(56,"textarea",52),ht("ngModelChange",function(o){ve(e);let i=le();return gt(i.exerciseData.limitations,o)||(i.exerciseData.limitations=o),be(o)}),S()(),E(57,"div")(58,"div",44)(59,"label"),O(60,"Images (URLs):"),S(),E(61,"button",45),_e("click",function(){ve(e);let o=le();return be(o.addField("images"))}),O(62,"Add Image"),S()(),Ne(63,L_e,4,3,"div",46),S(),E(64,"div")(65,"div",44)(66,"label"),O(67,"Videos (URLs):"),S(),E(68,"button",45),_e("click",function(){ve(e);let o=le();return be(o.addField("videos"))}),O(69,"Add Video"),S()(),Ne(70,$_e,4,3,"div",46),S(),E(71,"div")(72,"div",44)(73,"label"),O(74,"procedures:"),S(),E(75,"button",45),_e("click",function(){ve(e);let o=le();return be(o.addField("procedures"))}),O(76,"Add procedure"),S()(),Ne(77,V_e,4,3,"div",46),S(),E(78,"div",27)(79,"label",53),O(80,"Precautions:"),S(),E(81,"textarea",54),ht("ngModelChange",function(o){ve(e);let i=le();return gt(i.exerciseData.precautions,o)||(i.exerciseData.precautions=o),be(o)}),S()(),E(82,"button",55),O(83,"Submit"),S()()()}if(n&2){let e=Fg(5),r=le();z(9),ft("ngModel",r.exerciseData.exerciseName),z(4),ft("ngModel",r.exerciseData.exerciseType),z(4),ft("ngModel",r.exerciseData.exerciseDuration),z(4),ft("ngModel",r.exerciseData.exerciseMuscleGroup),z(4),ft("ngModel",r.exerciseData.difficultyLevel),z(12),ft("ngModel",r.exerciseData.exerciseCategory),z(7),re("ngForOf",r.exerciseData.equipments)("ngForTrackBy",r.trackByIndex),z(4),ft("ngModel",r.exerciseData.details),z(4),ft("ngModel",r.exerciseData.benefits),z(4),ft("ngModel",r.exerciseData.limitations),z(7),re("ngForOf",r.exerciseData.images)("ngForTrackBy",r.trackByIndex),z(7),re("ngForOf",r.exerciseData.videos)("ngForTrackBy",r.trackByIndex),z(7),re("ngForOf",r.exerciseData.procedures)("ngForTrackBy",r.trackByIndex),z(4),ft("ngModel",r.exerciseData.precautions),z(),re("disabled",!e.form.valid)}}var rI=class n{loggedIn=!1;isAdmin=!1;isExerciseForm=!1;email=localStorage.getItem("email");userName=localStorage.getItem("userName");unVerifiedCentres=[];selectedGym={_id:"",centerHeadEmail:"",centerName:"",centerType:"",registrationNumber:"",address:"",state:"",city:"",pincode:"",contactNumber:"",trainerCount:"",details:""};isGettingCenters=!1;isDetails=!1;exerciseData={exerciseName:"",exerciseType:"",exerciseDuration:"",exerciseMuscleGroup:"",difficultyLevel:"",images:[""],videos:[""],equipments:[""],details:"",exerciseCategory:"",benefits:"",limitations:"",procedures:[""],precautions:""};http=Q(Ea);authService=Q(xn);router=Q(Ut);notification=Q(Vn);ngOnInit(){this.isGettingCenters=!0,this.authService.fetchUnverifiedCentres().subscribe(t=>{this.unVerifiedCentres=t,this.isGettingCenters=!1},t=>{this.notification.showNotification(`${t.error.msg}`,"error"),this.isGettingCenters=!1})}addField(t){this.exerciseData[t][this.exerciseData[t].length-1]!==""&&(this.exerciseData[t].push(""),setTimeout(()=>{let e=document.querySelectorAll(`input[name=${t}${this.exerciseData[t].length-1}]`);e.length>0&&e[0].focus()}))}removeField(t,e){this.exerciseData[t].length>1&&this.exerciseData[t].splice(e,1)}trackByIndex(t,e){return t}submitExercise(){this.authService.addExercise(this.exerciseData).subscribe(t=>{this.notification.showNotification(t.message,"success"),this.resetForm()},t=>{this.notification.showNotification(t.err.message,"error")})}resetForm(){this.exerciseData={exerciseName:"",exerciseType:"",exerciseDuration:"",exerciseMuscleGroup:"",difficultyLevel:"",images:[""],videos:[""],equipments:[""],details:"",exerciseCategory:"",benefits:"",limitations:"",procedures:[""],precautions:""}}showExerciseForm(){this.isExerciseForm=!this.isExerciseForm}showDetails(t){this.isDetails=!0,this.selectedGym=this.unVerifiedCentres.find(e=>e._id===t)||{_id:"",centerHeadEmail:"",centerName:"",centerType:"",registrationNumber:"",address:"",state:"",city:"",pincode:"",contactNumber:"",trainerCount:"",details:""}}closeDetails(){this.isDetails=!1,this.selectedGym={_id:"",centerHeadEmail:"",centerName:"",centerType:"",registrationNumber:"",address:"",state:"",city:"",pincode:"",contactNumber:"",trainerCount:"",details:""}}verifyGym(t){this.authService.verifyGymCenter(t).subscribe(e=>{this.notification.showNotification("Succesfully Verified","success"),this.closeDetails(),this.ngOnInit()},e=>{this.notification.showNotification(`${e.error.msg}`,"error")})}logout(){let t=localStorage.getItem("email");t&&this.authService.logout(t).subscribe(e=>{localStorage.clear(),this.loggedIn=!1,this.isAdmin=!1,this.router.navigate(["/login"]),this.notification.showNotification(`${e.msg}`,"success")},e=>{this.notification.showNotification(`${e.error.msg}`,"error")})}goToSection(t){if(this.router.navigate([""],{fragment:`${t}`}),this.router.url==="/"){let e=document.getElementById(t);e&&e.scrollIntoView({behavior:"smooth",block:"start"})}else this.router.navigate(["/"]).then(()=>{let e=document.getElementById(t);e&&e.scrollIntoView({behavior:"smooth",block:"start"})})}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=Ct({type:n,selectors:[["app-admin"]],decls:57,vars:6,consts:[["exerciseForm","ngForm"],[1,"main"],[1,"left-section"],[1,"logo"],[2,"color","#fff"],[2,"color","var(--shade-1)"],[1,"menu"],[1,"welcome"],[1,"dashboard-active"],["src","dashboard.png","alt","","width","20px"],[3,"routerLink"],[1,"fa-solid","fa-house"],[3,"click"],[1,"fa-solid","fa-power-off"],[1,"right-section"],[1,"line"],[1,"unVerifiedGymCentres"],[2,"color","var(--light)"],[4,"ngFor","ngForOf"],["class","detailsPopup",4,"ngIf"],[1,"add-exercise",3,"click"],["class","registrationForm",4,"ngIf"],[1,"detailsPopup"],[1,"popupContent"],[1,"registrationForm"],[1,"cr"],[1,"registrationForm",3,"ngSubmit"],[1,"form-group"],["for","exerciseName"],["type","text","id","exerciseName","name","exerciseName","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","exerciseType"],["type","text","id","exerciseType","name","exerciseType","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","exerciseDuration"],["type","number","id","exerciseDuration","name","exerciseDuration","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","exerciseMuscleGroup"],["type","text","id","exerciseMuscleGroup","name","exerciseMuscleGroup","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","difficultyLevel"],["id","difficultyLevel","name","difficultyLevel","required","",1,"form-control",3,"ngModelChange","ngModel"],["value",""],["value","Easy"],["value","Medium"],["value","Hard"],["for","exerciseCategory"],["type","text","id","exerciseCategory","name","exerciseCategory","required","",1,"form-control",3,"ngModelChange","ngModel"],[1,"form-group-array"],["type","button",3,"click"],["class","form-group fg1",4,"ngFor","ngForOf","ngForTrackBy"],["for","details"],["id","details","name","details",1,"form-control",3,"ngModelChange","ngModel"],["for","benefits"],["id","benefits","name","benefits",1,"form-control",3,"ngModelChange","ngModel"],["for","limitations"],["id","limitations","name","limitations",1,"form-control",3,"ngModelChange","ngModel"],["for","precautions"],["id","precautions","name","precautions",1,"form-control",3,"ngModelChange","ngModel"],["type","submit",1,"submit-btn",3,"disabled"],[1,"form-group","fg1"],["type","text","placeholder","Equipment URL","required","",1,"form-control",3,"ngModelChange","ngModel","name"],["type","text","placeholder","Image URL","required","",1,"form-control",3,"ngModelChange","ngModel","name"],["type","text","placeholder","Video URL","required","",1,"form-control",3,"ngModelChange","ngModel","name"],["type","text","placeholder","Procedure","required","",1,"form-control",3,"ngModelChange","ngModel","name"]],template:function(e,r){e&1&&(E(0,"div",1)(1,"div",2)(2,"div",3)(3,"span",4)(4,"span",5),O(5,"FIT"),S(),O(6,"GENIE"),S()(),E(7,"div",6)(8,"div",7)(9,"span"),O(10,"Welcome,"),ce(11,"br"),E(12,"span",5),O(13),S()()(),E(14,"li",8),ce(15,"img",9),O(16,"\xA0\xA0 "),E(17,"p"),O(18,"Dashboard"),S()(),E(19,"a",10)(20,"li"),ce(21,"i",11),O(22,"\xA0\xA0 "),E(23,"p"),O(24,"Home"),S()()(),E(25,"li",12),_e("click",function(){return r.logout()}),ce(26,"i",13),O(27,"\xA0\xA0 "),E(28,"p"),O(29,"Log Out"),S()()(),ce(30,"hr"),S(),E(31,"div",14)(32,"div",7)(33,"h3"),O(34,"Welcome to your admin dashboard!"),S()(),ce(35,"div",15),E(36,"div",16)(37,"h4",17),O(38,"Unverified Gym Centres"),S(),E(39,"table")(40,"thead")(41,"tr")(42,"th"),O(43,"S No"),S(),E(44,"th"),O(45,"Center Name"),S(),E(46,"th"),O(47,"Center Head Email"),S(),E(48,"th"),O(49,"Actions"),S()()(),E(50,"tbody"),Ne(51,M_e,10,3,"tr",18),S()(),Ne(52,P_e,18,5,"div",19),S(),E(53,"button",20),_e("click",function(){return r.showExerciseForm()}),O(54,"Add Exercise Details"),S(),Ne(55,B_e,84,19,"div",21),S()(),ce(56,"app-footer")),e&2&&(z(13),Ye(r.userName),z(6),re("routerLink",Fi(5,O_e)),z(32),re("ngForOf",r.unVerifiedCentres),z(),re("ngIf",r.isDetails),z(3),re("ngIf",r.isExerciseForm))},dependencies:[Kn,Fs,Vi,fc,hc,vo,Y0,Ps,Ho,$i,ad,ka,sd,Li,Er,Ln],styles:['.main[_ngcontent-%COMP%]{min-height:100vh;background-color:var(--dark);display:flex;font-family:Poppins,sans-serif;width:100%;max-width:1500px;margin:0 auto}.logo[_ngcontent-%COMP%]{font-size:25px;font-weight:600;margin:20px 20px 30px;color:var(--light)}.welcome[_ngcontent-%COMP%]{color:var(--light)}.left-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;width:240px;background-color:var(--shade-2)}.menu[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:18px}.menu[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:flex;text-align:left;align-items:center;white-space:nowrap;font-size:larger;font-weight:500;color:var(--light);cursor:pointer;margin-bottom:18px}.menu[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0}.left-section[_ngcontent-%COMP%]   hr[_ngcontent-%COMP%]{width:100%;background-color:#e7e7e7;height:2px}.contact-section[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-end;position:relative;margin-top:50px;padding:90px 0}.contact-section[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:120px;position:absolute;left:0}.contact-text[_ngcontent-%COMP%]{height:max-content;background-color:bisque;padding:4px;width:150px;z-index:2}.contact-text[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border:none;outline:none;border-radius:9999px;padding:5px 10px;background-color:#16331b;color:var(--light);font-weight:600}.dashboard-active[_ngcontent-%COMP%]{display:flex;align-items:center;text-align:center;margin-bottom:16px;border-radius:8px}.dashboard-active[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-bottom:0}.right-section[_ngcontent-%COMP%]{width:calc(100% - 240px);padding:16px}.line[_ngcontent-%COMP%]{height:2px;border-radius:6px;margin:18px auto;background-color:#16331b}.verify-shops-list[_ngcontent-%COMP%]{border-radius:8px;max-height:500px;overflow-y:auto;background-color:#efefefde;border:1px solid #a5a5a5b4;padding:10px;display:flex;flex-direction:column;gap:8px}.welcome[_ngcontent-%COMP%]{text-align:center;margin-bottom:18px}.welcome[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:600;color:var(--shade-4);font-size:20px}.heading[_ngcontent-%COMP%]{padding:10px 18px;background-color:var(--shade-2);text-align:center;border-radius:4px;color:var(--light);font-weight:600;font-size:larger}.registrationForm[_ngcontent-%COMP%]{background-color:var(--light);padding:12px;border-radius:4px;margin:20px 0}.cr[_ngcontent-%COMP%]{margin:0;color:var(--light);font-weight:600}.detailsPopup[_ngcontent-%COMP%]{position:fixed;z-index:1;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:#4d4d4dd8;display:flex;justify-content:center;align-items:center}.popupContent[_ngcontent-%COMP%]{padding:18px;border-radius:4px;background-color:var(--dark);width:700px;color:var(--light)}.popupContent[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-top:16px;border:none;outline:none;border-radius:4px;padding:8px 18px;background-color:var(--shade-1);color:var(--dark);margin-right:16px;font-weight:600}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;margin-top:20px;background-color:var(--shade-2);height:100px;max-height:400px;overflow-y:auto}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{border:1px solid var(--dark);padding:10px;text-align:left}th[_ngcontent-%COMP%]{background-color:var(--shade-1);color:var(--dark)}tr[_ngcontent-%COMP%]{color:var(--light);border:1px solid var(--light)}tr[_ngcontent-%COMP%]:nth-child(2n){background-color:var(--shade-2)}tr[_ngcontent-%COMP%]:hover{background-color:var(--dark)}button[_ngcontent-%COMP%]{background-color:var(--shade-1);color:var(--dark);border:none;padding:5px 10px;cursor:pointer;border-radius:5px}button[_ngcontent-%COMP%]:hover{background-color:#b1f100}.form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px;margin-bottom:12px}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{color:var(--light)}.g1[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{background-color:#c5c5c5;border:none}.form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{height:100px;resize:none}.disabled[_ngcontent-%COMP%]{background-color:#7a7a7a!important;cursor:not-allowed}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]:after{padding:0 4px;content:"*";color:#c40000}button[_ngcontent-%COMP%]:disabled{color:#626262;cursor:not-allowed}.btnSubmit[_ngcontent-%COMP%]{border-radius:4px;border:none;background-color:var(--shade-1);padding:8px 18px;font-weight:600;color:var(--dark)}.form-group-array[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;color:var(--light);padding:8px 0}.form-group-array[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border:none;outline:none;border-radius:4px;padding:5px 10px;background-color:#ffffff3f;color:var(--light);font-weight:600;cursor:pointer}.fg1[_ngcontent-%COMP%]{display:flex!important;flex-direction:row}.fg1[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:4px 8px;border:none;border-radius:4px;font-weight:600}.form-group-array[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]:after{padding:0 4px;content:"*";color:#c40000}.registrationForm[_ngcontent-%COMP%]{background-color:var(--shade-2);padding:12px;border-radius:4px;margin:20px 0;color:var(--light)}.add-exercise[_ngcontent-%COMP%]{width:100%;padding:12px 0;margin:16px 0;font-size:larger;font-weight:600;background-color:transparent;border:1px solid var(--shade-1);color:var(--light);border-radius:4px}.add-exercise[_ngcontent-%COMP%]:hover{color:var(--dark)}.submit-btn[_ngcontent-%COMP%]{border:none;outline:none;border-radius:4px;padding:8px 28px;width:350px;background-color:var(--shade-1);color:var(--dark);margin-right:16px;font-weight:600}']})};var z_e=()=>[""];function U_e(n,t){if(n&1&&(E(0,"ul")(1,"li"),O(2),S()()),n&2){let e=t.$implicit;z(2),Ye(e)}}function W_e(n,t){if(n&1){let e=et();E(0,"div",66)(1,"div",67)(2,"h4"),O(3,"Achievements"),S(),ce(4,"div",33),Ne(5,U_e,3,1,"ul",68),E(6,"button",12),_e("click",function(){ve(e);let o=le();return be(o.closeDetails())}),O(7,"Close"),S()()()}if(n&2){let e=le();z(5),re("ngForOf",e.userActivaties)}}function G_e(n,t){n&1&&ce(0,"div",69)}function j_e(n,t){n&1&&ce(0,"img",70)}function H_e(n,t){n&1&&(E(0,"p"),O(1," You are underweight. Consider seeking medical attention. "),S())}function q_e(n,t){n&1&&(E(0,"p"),O(1," You are normal weight. You are in a healthy range. "),S())}function K_e(n,t){n&1&&(E(0,"p"),O(1," You are overweight. Consider seeking medical attention. "),S())}function X_e(n,t){n&1&&(E(0,"p"),O(1," You are obese. Consider seeking medical attention. "),S())}function Y_e(n,t){if(n&1&&(E(0,"div",71)(1,"h3",72),O(2),S(),Ne(3,H_e,2,0,"p",53)(4,q_e,2,0,"p",53)(5,K_e,2,0,"p",53)(6,X_e,2,0,"p",53),S()),n&2){let e=le();z(2),Tt("Your BMI is: ",e.bmiResult,""),z(),re("ngIf",e.bmiResult<18.5),z(),re("ngIf",e.bmiResult>=18.5&&e.bmiResult<25),z(),re("ngIf",e.bmiResult>=25&&e.bmiResult<30),z(),re("ngIf",e.bmiResult>=30)}}function Z_e(n,t){n&1&&ce(0,"div",69)}function Q_e(n,t){n&1&&(E(0,"span"),O(1,"Predict Workout"),S())}function J_e(n,t){if(n&1&&(E(0,"li")(1,"strong"),O(2),S(),ce(3,"br"),O(4),ce(5,"br"),O(6),ce(7,"br"),O(8),S()),n&2){let e=t.$implicit;z(2),Ye(e.recommended_workout),z(2),Tt("Duration: ",e.session_duration," hours "),z(2),Tt("Calories Burned: ",e.calories_burned," cal "),z(2),Tt("Water Intake: ",e.water_intake," liters ")}}function eSe(n,t){if(n&1&&(E(0,"div",74)(1,"h3"),O(2,"Recommended Workouts"),S(),E(3,"ul"),Ne(4,J_e,9,4,"li",68),S()()),n&2){let e=le(2);z(4),re("ngForOf",e.recommendations)}}function tSe(n,t){if(n&1&&(E(0,"div"),Ne(1,eSe,5,1,"div",73),S()),n&2){let e=le();z(),re("ngIf",e.recommendations.length)}}function nSe(n,t){if(n&1&&(E(0,"option",75),O(1),S()),n&2){let e=t.$implicit;re("ngValue",e),z(),_a(" ",e.name," (",e.unit,") ")}}function rSe(n,t){if(n&1&&(E(0,"li"),O(1),E(2,"strong"),O(3),S(),O(4," CO\u2082 "),S()),n&2){let e=t.$implicit;z(),WR(" \u2705 ",e.activity," - ",e.quantity," ",e.activity.includes("trees")?"trees":"km"," \u2192 Saved "),z(2),Tt("",e.reduction.toFixed(2)," kg")}}function oSe(n,t){if(n&1&&(E(0,"div")(1,"h4"),O(2,"Logged Activities"),S(),E(3,"ul"),Ne(4,rSe,5,4,"li",68),S()()),n&2){let e=le();z(4),re("ngForOf",e.logs)}}var oI=class n{userName=localStorage.getItem("userName");email=localStorage.getItem("email");authService=Q(xn);router=Q(Ut);notification=Q(Vn);http=Q(Ea);loggedIn=!1;recommendation=null;loading=!1;isShowing=!1;isbmiLoading=!1;showBMIForm=!1;isBMILoaded=!1;bmiResult=null;recommendations=[];isDetails=!1;openDetails(){this.isDetails=!0}closeDetails(){this.isDetails=!1}userActivaties=[];userInput={age:null,gender:"",weight:null,height:null,avg_bpm:null,experience_level:null,workout_frequency:null,bmi:0};activities=[{name:"Cycling instead of driving",unit:"km",reductionPerUnit:.21},{name:"Walking instead of driving",unit:"km",reductionPerUnit:.17},{name:"Using public transport",unit:"km",reductionPerUnit:.1},{name:"Carpooling",unit:"km",reductionPerUnit:.12},{name:"Planting trees",unit:"trees",reductionPerUnit:22},{name:"Using reusable bottles",unit:"bottles",reductionPerUnit:.02}];selectedActivity=null;quantity=null;logs=[];totalReduction=0;ngOnInit(){this.fetchActivity()}fetchActivity(){this.email&&this.authService.fetchActivityLogs(this.email).subscribe(t=>{this.userActivaties=t},t=>{console.error("Error fetching activity logs:",t)})}addActivity(){if(!this.selectedActivity||!this.quantity||this.quantity<=0){alert("Please select an activity and enter a valid quantity.");return}let t=this.quantity*this.selectedActivity.reductionPerUnit;this.logs.push({activity:this.selectedActivity.name,quantity:this.quantity,reduction:t});let e=this.logs.map(r=>`Activity: ${r.activity}, Quantity: ${r.quantity}, CO2 Saved: ${r.reduction.toFixed(2)} kg`).join(`
`);this.email&&this.authService.addActivity(this.email,e).subscribe(r=>{this.notification.showNotification(r,"success")},r=>{this.notification.showNotification("Failed to log activity. Please try again.","error"),console.error("Error logging activity:",r)}),this.totalReduction+=t,this.quantity=null}getRecommendations(t){if(t.preventDefault(),!this.userInput.height||!this.userInput.weight){this.notification.showNotification("Please enter valid height and weight!","error");return}let e=this.userInput.height/100;this.userInput.bmi=parseFloat((this.userInput.weight/(e*e)).toFixed(2)),console.log("Final Request Payload:",this.userInput);let r=ke({},this.userInput);delete r.medicalCondition,this.loading=!0,this.authService.getExerciseRecommendations(r).subscribe(o=>{this.recommendations=o.recommendations||[],this.addDiseaseBasedRecommendations(),console.log("Final Recommendations:",this.recommendations),this.loading=!1,this.isShowing=!0},o=>{console.error("Error fetching recommendations",o),this.notification.showNotification("Failed to fetch recommendations. Please try again.","error"),this.loading=!1})}addDiseaseBasedRecommendations(){let t=this.userInput.medicalCondition?.toLowerCase();if(!t)return;let e={"heart disease":["Yoga","Cardio"],diabetes:["Yoga","Strength"],hypertension:["Yoga","Cardio"],osteoarthritis:["Yoga","Strength"],copd:["Yoga","Cardio"],diverticulosis:["Yoga","HIIT"]};e[t]&&(this.recommendations=this.recommendations.map(r=>e[t].includes(r.recommended_workout)?Ft(ke({},r),{recommended_workout:`Recommended for you: ${r.recommended_workout}`}):r))}bmiCalculate(){if(!this.userInput.weight||!this.userInput.height){this.notification.showNotification("Please enter valid weight and height!","error");return}this.isbmiLoading=!0,this.authService.calculateBmi(this.userInput.weight,this.userInput.height).subscribe(t=>{this.isbmiLoading=!1,this.bmiResult=t.data.bmi,this.isBMILoaded=!0,this.showBMIForm=!0},t=>{this.isbmiLoading=!1,this.notification.showNotification("BMI calculation failed. Try again later.","error"),console.error("Error:",t)})}logout(){let t=localStorage.getItem("email");t&&this.authService.logout(t).subscribe(e=>{localStorage.clear(),this.router.navigate(["/login"]),this.notification.showNotification(`${e.msg}`,"success")},e=>{this.notification.showNotification(`${e.error.msg}`,"error")})}goToSection(t){this.router.navigate([""],{fragment:`${t}`}),this.router.url==="/"?document.getElementById(t)?.scrollIntoView({behavior:"smooth",block:"start"}):this.router.navigate(["/"]).then(()=>{document.getElementById(t)?.scrollIntoView({behavior:"smooth",block:"start"})})}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=Ct({type:n,selectors:[["app-user"]],decls:148,vars:27,consts:[["bmiForm","ngForm"],[1,"main"],[1,"left-section"],[1,"logo"],[2,"color","#fff"],[2,"color","var(--shade-1)"],[1,"menu"],[1,"welcome"],[1,"dashboard-active"],["src","dashboard.png","alt","","width","20px"],[3,"routerLink"],[1,"fa-solid","fa-house"],[3,"click"],[1,"fa-brands","fa-slack"],[1,"fa-solid","fa-power-off"],[1,"right-section"],[1,"heading"],["class","detailsPopup",4,"ngIf"],[1,"bmi"],[1,"bmi-container"],[1,"bmi-left"],[1,"bmiForm",3,"ngSubmit"],[1,"bmiCalculator"],[1,"form-bmi"],["type","number","name","weight","required","",3,"ngModelChange","ngModel"],["type","number","name","height","required","",3,"ngModelChange","ngModel"],["type","submit",1,"btn","btn-primary",3,"disabled"],[1,"bmi-right"],["class","spinner",4,"ngIf"],["src","https://th.bing.com/th/id/OIP.O0NScisRgcMHf4bPqnhvjwHaFj?rs=1&pid=ImgDetMain","alt","",4,"ngIf"],["class","showBMIDetails",4,"ngIf"],[1,"rcontainer"],[1,"r-left"],[1,"line"],[3,"submit"],[1,"group"],["type","number","name","age","required","",3,"ngModelChange","ngModel"],["name","gender","required","",3,"ngModelChange","ngModel"],["value","Male"],["value","Female"],["type","number","name","avg_bpm","required","",3,"ngModelChange","ngModel"],["type","number","name","experience_level","required","",3,"ngModelChange","ngModel"],["type","number","name","workout_frequency","required","",3,"ngModelChange","ngModel"],["name","medicalCondition",3,"ngModelChange","ngModel"],["value",""],["value","Heart Disease"],["value","Diabetes"],["value","Hypertension"],["value","Osteoarthritis"],["value","COPD"],["value","Diverticulosis"],["type","submit",1,"submit-btn"],[1,"r-right"],[4,"ngIf"],[1,"tracker-container"],[1,"t-left"],["src","https://th.bing.com/th/id/OIP.LDvhJ0s_5Sh9bHyRy6nGQwHaE8?rs=1&pid=ImgDetMain","alt",""],[1,"t-right"],[1,"aform",3,"submit"],[1,"ag"],["for","activity"],["name","activity",3,"ngModelChange","ngModel"],[3,"ngValue",4,"ngFor","ngForOf"],["for","quantity"],["type","number","name","quantity","min","1","required","",3,"ngModelChange","ngModel"],["type","submit",1,"submit-btn-1"],[1,"detailsPopup"],[1,"popupContent"],[4,"ngFor","ngForOf"],[1,"spinner"],["src","https://th.bing.com/th/id/OIP.O0NScisRgcMHf4bPqnhvjwHaFj?rs=1&pid=ImgDetMain","alt",""],[1,"showBMIDetails"],[1,"bmi-r"],["class","predict",4,"ngIf"],[1,"predict"],[3,"ngValue"]],template:function(e,r){if(e&1){let o=et();E(0,"div",1)(1,"div",2)(2,"div",3)(3,"span",4)(4,"span",5),O(5,"FIT"),S(),O(6,"GENIE"),S()(),E(7,"div",6)(8,"div",7)(9,"span"),O(10,"Welcome,"),ce(11,"br"),E(12,"span",5),O(13),S()()(),E(14,"li",8),ce(15,"img",9),O(16,"\xA0\xA0 "),E(17,"p"),O(18,"Dashboard"),S()(),E(19,"a",10)(20,"li"),ce(21,"i",11),O(22,"\xA0\xA0 "),E(23,"p"),O(24,"Home"),S()()(),E(25,"li",12),_e("click",function(){return ve(o),be(r.openDetails())}),ce(26,"i",13),O(27,"\xA0\xA0 "),E(28,"p"),O(29,"Achievements"),S()(),E(30,"li",12),_e("click",function(){return ve(o),be(r.logout())}),ce(31,"i",14),O(32,"\xA0\xA0 "),E(33,"p"),O(34,"Log Out"),S()()(),ce(35,"hr"),S(),E(36,"div",15)(37,"div",16)(38,"span"),O(39,"User Dashboard"),S()(),Ne(40,W_e,8,1,"div",17),E(41,"div",18)(42,"div",19)(43,"div",20)(44,"h1"),O(45,"BMI CALCULATOR"),S(),E(46,"Span"),O(47,"BMI is calculated as weight in kilograms divided by height in meters squared to classify body weight status."),S(),E(48,"form",21,0),_e("ngSubmit",function(){return ve(o),be(r.bmiCalculate())}),E(50,"div",22)(51,"div",23)(52,"label"),O(53,"Weight (kg): "),E(54,"input",24),ht("ngModelChange",function(s){return ve(o),gt(r.userInput.weight,s)||(r.userInput.weight=s),be(s)}),S()()(),E(55,"div",23)(56,"label"),O(57,"Height (cm): "),E(58,"input",25),ht("ngModelChange",function(s){return ve(o),gt(r.userInput.height,s)||(r.userInput.height=s),be(s)}),S()()()(),E(59,"button",26),O(60,"Submit"),S()()(),E(61,"div",27),Ne(62,G_e,1,0,"div",28)(63,j_e,1,0,"img",29)(64,Y_e,7,5,"div",30),S()()(),E(65,"div",31)(66,"div",32)(67,"h2"),O(68,"Workout Recommendation"),S(),ce(69,"div",33),E(70,"div")(71,"form",34),_e("submit",function(s){return ve(o),be(r.getRecommendations(s))}),E(72,"div",35)(73,"label"),O(74,"Age: "),E(75,"input",36),ht("ngModelChange",function(s){return ve(o),gt(r.userInput.age,s)||(r.userInput.age=s),be(s)}),S()(),E(76,"label"),O(77,"Gender: "),E(78,"select",37),ht("ngModelChange",function(s){return ve(o),gt(r.userInput.gender,s)||(r.userInput.gender=s),be(s)}),E(79,"option",38),O(80,"Male"),S(),E(81,"option",39),O(82,"Female"),S()()()(),E(83,"div",35)(84,"label"),O(85,"Weight (kg): "),E(86,"input",24),ht("ngModelChange",function(s){return ve(o),gt(r.userInput.weight,s)||(r.userInput.weight=s),be(s)}),S()(),E(87,"label"),O(88,"Height (cm): "),E(89,"input",25),ht("ngModelChange",function(s){return ve(o),gt(r.userInput.height,s)||(r.userInput.height=s),be(s)}),S()()(),E(90,"div",35)(91,"label"),O(92,"Avg Heart Beats/ Min: "),E(93,"input",40),ht("ngModelChange",function(s){return ve(o),gt(r.userInput.avg_bpm,s)||(r.userInput.avg_bpm=s),be(s)}),S()(),E(94,"label"),O(95,"Experience Level (1-3): "),E(96,"input",41),ht("ngModelChange",function(s){return ve(o),gt(r.userInput.experience_level,s)||(r.userInput.experience_level=s),be(s)}),S()()(),E(97,"div",35)(98,"label"),O(99,"Workout Frequency (days per week): "),E(100,"input",42),ht("ngModelChange",function(s){return ve(o),gt(r.userInput.workout_frequency,s)||(r.userInput.workout_frequency=s),be(s)}),S()(),E(101,"label"),O(102,"Medical Condition: "),E(103,"select",43),ht("ngModelChange",function(s){return ve(o),gt(r.userInput.medicalCondition,s)||(r.userInput.medicalCondition=s),be(s)}),E(104,"option",44),O(105,"None"),S(),E(106,"option",45),O(107,"Heart Disease"),S(),E(108,"option",46),O(109,"Diabetes"),S(),E(110,"option",47),O(111,"Hypertension"),S(),E(112,"option",48),O(113,"Osteoarthritis"),S(),E(114,"option",49),O(115,"COPD"),S(),E(116,"option",50),O(117,"Diverticulosis"),S()()()(),E(118,"button",51),O(119,"Get Recommendations"),S()()()(),E(120,"div",52),Ne(121,Z_e,1,0,"div",28)(122,Q_e,2,0,"span",53)(123,tSe,2,1,"div",53),S()(),E(124,"div",54)(125,"div",55),ce(126,"img",56),S(),E(127,"div",57)(128,"h2"),O(129,"\u{1F331} Eco-Friendly Activity Tracker"),S(),E(130,"form",58),_e("submit",function(s){return ve(o),r.addActivity(),be(s.preventDefault())}),E(131,"div",59)(132,"label",60),O(133,"Select Activity:"),S(),E(134,"select",61),ht("ngModelChange",function(s){return ve(o),gt(r.selectedActivity,s)||(r.selectedActivity=s),be(s)}),Ne(135,nSe,2,3,"option",62),S()(),E(136,"div",59)(137,"label",63),O(138),S(),E(139,"input",64),ht("ngModelChange",function(s){return ve(o),gt(r.quantity,s)||(r.quantity=s),be(s)}),S()(),E(140,"button",65),O(141,"Log Activity"),S()(),E(142,"h4"),O(143,"Total CO\u2082 Reduction: "),E(144,"strong"),O(145),S()(),Ne(146,oSe,5,1,"div",53),S()()()(),ce(147,"app-footer")}if(e&2){let o=Fg(49);z(13),Ye(r.userName),z(6),re("routerLink",Fi(26,z_e)),z(21),re("ngIf",r.isDetails),z(14),ft("ngModel",r.userInput.weight),z(4),ft("ngModel",r.userInput.height),z(),re("disabled",!o.valid),z(3),re("ngIf",r.isbmiLoading),z(),re("ngIf",!r.showBMIForm&&!r.isbmiLoading&&!r.isBMILoaded),z(),re("ngIf",r.showBMIForm&&!r.isbmiLoading&&r.isBMILoaded),z(11),ft("ngModel",r.userInput.age),z(3),ft("ngModel",r.userInput.gender),z(8),ft("ngModel",r.userInput.weight),z(3),ft("ngModel",r.userInput.height),z(4),ft("ngModel",r.userInput.avg_bpm),z(3),ft("ngModel",r.userInput.experience_level),z(4),ft("ngModel",r.userInput.workout_frequency),z(3),ft("ngModel",r.userInput.medicalCondition),z(18),re("ngIf",r.loading),z(),re("ngIf",!r.isShowing&&!r.loading),z(),re("ngIf",r.isShowing&&!r.loading),z(11),ft("ngModel",r.selectedActivity),z(),re("ngForOf",r.activities),z(3),Tt("Enter Quantity (",r.selectedActivity==null?null:r.selectedActivity.unit,"):"),z(),ft("ngModel",r.quantity),z(6),Tt("",r.totalReduction.toFixed(2)," kg"),z(),re("ngIf",r.logs.length>0)}},dependencies:[Li,Kn,Fs,Vi,fc,hc,vo,Y0,Ps,Ho,$i,ad,sM,ka,sd,Ls,Ln,Er],styles:[".main[_ngcontent-%COMP%]{min-height:100vh;background-color:var(--dark);display:flex;font-family:Poppins,sans-serif;width:100%;max-width:1500px;margin:0 auto}.logo[_ngcontent-%COMP%]{font-size:25px;font-weight:600;margin:20px 20px 30px;color:var(--light)}.logo[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{cursor:pointer}.welcome[_ngcontent-%COMP%]{color:var(--light)}.left-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;width:240px;background-color:var(--shade-2)}.menu[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:18px}.menu[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:flex;text-align:left;align-items:center;white-space:nowrap;font-size:larger;font-weight:500;color:var(--light);cursor:pointer;margin-bottom:18px}.menu[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0}.left-section[_ngcontent-%COMP%]   hr[_ngcontent-%COMP%]{width:100%;background-color:#e7e7e7;height:2px}.contact-section[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-end;position:relative;margin-top:50px;padding:90px 0}.contact-section[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:120px;position:absolute;left:0}.contact-text[_ngcontent-%COMP%]{height:max-content;background-color:bisque;padding:4px;width:150px;z-index:2}.contact-text[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border:none;outline:none;border-radius:9999px;padding:5px 10px;background-color:#16331b;color:var(--light);font-weight:600}.dashboard-active[_ngcontent-%COMP%]{display:flex;align-items:center;text-align:center;margin-bottom:16px;border-radius:8px}.dashboard-active[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-bottom:0}.right-section[_ngcontent-%COMP%]{width:calc(100% - 240px);padding:16px}.line[_ngcontent-%COMP%]{height:2px;border-radius:6px;margin:18px auto;background-color:#16331b}.welcome[_ngcontent-%COMP%]{text-align:center;margin-bottom:18px}.welcome[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:600;color:var(--shade-4);font-size:20px}.heading[_ngcontent-%COMP%]{padding:10px 18px;background-color:var(--shade-2);text-align:center;border-radius:4px;color:var(--light);font-weight:600;font-size:larger}.bmi[_ngcontent-%COMP%]{background-color:var(--shade-2);width:100%;margin:20px auto;border-radius:4px}.bmi-container[_ngcontent-%COMP%]{display:flex;justify-content:center;width:100%;max-height:1500px;border-radius:4px}.bmi-left[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;width:50%;background-color:var(--shade-2);padding:12px;color:var(--light)}.bmi-left[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#9f9f9f;font-size:medium;font-weight:500;margin:18px 0}.bmiCalculator[_ngcontent-%COMP%]{display:flex;gap:12px;padding:18px 0}.form-bmi[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.bmiForm[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border-radius:4px;width:250px;background-color:var(--shade-1);border:none;color:var(--dark);font-weight:600;padding:10px 20px;cursor:pointer;font-size:larger}.form-bmi[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{background-color:#002a31;color:var(--light);border-radius:2px;padding:10px 25px;border:none}.bmi-right[_ngcontent-%COMP%]{width:50%;display:flex;align-items:center;justify-content:center}.bmi-right[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:auto;object-fit:cover}.rcontainer[_ngcontent-%COMP%]{background-color:var(--shade-2);color:var(--light);padding:12px;border-radius:4px;display:flex}.r-left[_ngcontent-%COMP%]{width:56%}.form-group[_ngcontent-%COMP%]{display:flex;gap:8px;width:100%;max-width:100%;height:100%}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{flex:1;height:100%;padding:4px 8px;border:none;border-radius:4px;background-color:#002a31;color:var(--light)}.f-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px}.rForm[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px;max-width:100%}.submit-btn[_ngcontent-%COMP%]{color:var(--shade-1);padding:8px;font-size:larger;font-weight:500;border-radius:4px;color:var(--dark);background-color:var(--shade-1)}.submit-btn[_ngcontent-%COMP%]:disabled{cursor:not-allowed;background-color:#d8f9005d}.r-right[_ngcontent-%COMP%]{width:50%;display:flex;padding:18px;align-items:center;justify-content:center;text-align:center}.r-right[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:28px;font-weight:600;color:var(--shade-1)}.spinner[_ngcontent-%COMP%]{border:8px solid #f3f3f3;border-top:8px solid var(--shade-1);border-radius:50%;width:60px;height:60px;animation:_ngcontent-%COMP%_spin 2s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.showBMIDetails[_ngcontent-%COMP%]{color:var(--light);display:flex;flex-direction:column;gap:12px;justify-content:center;align-items:center;text-align:center}.bmi-r[_ngcontent-%COMP%]{color:var(--shade-1)}form[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}.group[_ngcontent-%COMP%]{display:flex;gap:12px;margin-bottom:16px}.group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{width:50%}.group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{flex:1;height:100%;padding:4px 8px;border:none;border-radius:4px;background-color:#002a31;color:var(--light);width:100%}.predict[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{padding:0;display:flex;flex-direction:column;gap:8px}.predict[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{background-color:#002a312e;padding:10px;border-radius:4px}.tracker-container[_ngcontent-%COMP%]{background-color:var(--shade-2);margin:16px 0;border-radius:4px;color:var(--light);display:flex;height:370px}.t-left[_ngcontent-%COMP%]{width:50%;height:100%}.t-left[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.t-right[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:12px}.ag[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;margin:8px 0}.ag[_ngcontent-%COMP%]   select[_ngcontent-%COMP%], .ag[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding:4px 8px;border:none;border-radius:4px;background-color:#002a31;color:var(--light)}.submit-btn-1[_ngcontent-%COMP%]{background-color:transparent;color:var(--shade-1);border:1px solid var(--shade-1);width:100%;margin:12px 0;padding:12px;border-radius:4px;font-size:larger;font-weight:600}.t-right[_ngcontent-%COMP%]{overflow:auto}.t-right[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.detailsPopup[_ngcontent-%COMP%]{position:fixed;z-index:1;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:#4d4d4dd8;display:flex;justify-content:center;align-items:center}.popupContent[_ngcontent-%COMP%]{padding:18px;border-radius:4px;background-color:var(--dark);width:700px;color:var(--light)}.popupContent[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-top:16px;border:none;outline:none;border-radius:4px;padding:8px 18px;background-color:var(--shade-1);color:var(--dark);margin-right:16px;font-weight:600}"]})};var hy=class n{constructor(t){this.router=t}canActivate(){return localStorage.getItem("token")?(this.router.navigate([""]),!1):!0}static \u0275fac=function(e){return new(e||n)(it(Ut))};static \u0275prov=Me({token:n,factory:n.\u0275fac,providedIn:"root"})};var ab=class n{constructor(t){this.router=t}canActivate(){return localStorage.getItem("token")?!0:(this.router.navigate(["/login"]),!1)}static \u0275fac=function(e){return new(e||n)(it(Ut))};static \u0275prov=Me({token:n,factory:n.\u0275fac,providedIn:"root"})};var iI=class n{constructor(t){this.router=t}canActivate(){let t=localStorage.getItem("email"),e=localStorage.getItem("isAdmin"),r=localStorage.getItem("isFitnessCenter");return e?ct(!0):(this.router.navigate(["/"]),ct(!1))}static \u0275fac=function(e){return new(e||n)(it(Ut))};static \u0275prov=Me({token:n,factory:n.\u0275fac,providedIn:"root"})};var WH=(n,t)=>!!localStorage.getItem("isFitnessCenter");var GH=(n,t)=>!!localStorage.getItem("email");var iSe=()=>[""];function sSe(n,t){if(n&1){let e=et();E(0,"button",65),_e("click",function(){ve(e);let o=le().index,i=le(2);return be(i.removeField("daysAvailable",o))}),O(1,"Remove"),S()}}function aSe(n,t){if(n&1){let e=et();E(0,"div",23)(1,"label"),O(2),S(),E(3,"input",64),ht("ngModelChange",function(o){let i=ve(e).index,s=le(2);return gt(s.center.daysAvailable[i],o)||(s.center.daysAvailable[i]=o),be(o)}),S(),Ne(4,sSe,2,0,"button",52),S()}if(n&2){let e=t.index,r=le(2);z(2),Tt("Day ",e+1,":"),z(),Ca("name","daysAvailable",e,""),ft("ngModel",r.center.daysAvailable[e]),z(),re("ngIf",r.center.daysAvailable.length>1)}}function lSe(n,t){if(n&1){let e=et();E(0,"button",65),_e("click",function(){ve(e);let o=le(2);return be(o.addField("daysAvailable"))}),O(1,"Add Day"),S()}}function cSe(n,t){if(n&1){let e=et();E(0,"button",65),_e("click",function(){ve(e);let o=le(2);return be(o.addField("images"))}),O(1,"Add Image"),S()}}function uSe(n,t){if(n&1){let e=et();E(0,"button",65),_e("click",function(){ve(e);let o=le().index,i=le(2);return be(i.removeField("images",o))}),O(1,"Remove"),S()}}function dSe(n,t){if(n&1){let e=et();E(0,"div",66)(1,"input",67),ht("ngModelChange",function(o){let i=ve(e).index,s=le(2);return gt(s.center.images[i],o)||(s.center.images[i]=o),be(o)}),S(),Ne(2,uSe,2,0,"button",52),S()}if(n&2){let e=t.index,r=le(2);z(),Ca("name","images",e,""),re("placeholder","Sample Image "+(e+1)),ft("ngModel",r.center.images[e]),z(),re("ngIf",r.center.images.length>1)}}function pSe(n,t){if(n&1){let e=et();E(0,"button",65),_e("click",function(){ve(e);let o=le(2);return be(o.addField("videos"))}),O(1,"Add Video"),S()}}function fSe(n,t){if(n&1){let e=et();E(0,"button",65),_e("click",function(){ve(e);let o=le().index,i=le(2);return be(i.removeField("videos",o))}),O(1,"Remove"),S()}}function hSe(n,t){if(n&1){let e=et();E(0,"div",66)(1,"input",67),ht("ngModelChange",function(o){let i=ve(e).index,s=le(2);return gt(s.center.videos[i],o)||(s.center.videos[i]=o),be(o)}),S(),Ne(2,fSe,2,0,"button",52),S()}if(n&2){let e=t.index,r=le(2);z(),Ca("name","videos",e,""),re("placeholder","Sample Video "+(e+1)),ft("ngModel",r.center.videos[e]),z(),re("ngIf",r.center.videos.length>1)}}function mSe(n,t){if(n&1){let e=et();E(0,"button",65),_e("click",function(){ve(e);let o=le(2);return be(o.addField("availableInstruments"))}),O(1,"Add Instrument"),S()}}function gSe(n,t){if(n&1){let e=et();E(0,"button",65),_e("click",function(){ve(e);let o=le().index,i=le(2);return be(i.removeField("availableInstruments",o))}),O(1,"Remove"),S()}}function ySe(n,t){if(n&1){let e=et();E(0,"div",68)(1,"input",69),ht("ngModelChange",function(o){let i=ve(e).index,s=le(2);return gt(s.center.availableInstruments[i],o)||(s.center.availableInstruments[i]=o),be(o)}),S(),Ne(2,gSe,2,0,"button",52),S()}if(n&2){let e=t.index,r=le(2);z(),Ca("name","availableInstruments",e,""),re("placeholder","Instrument "+(e+1)),ft("ngModel",r.center.availableInstruments[e]),z(),re("ngIf",r.center.availableInstruments.length>1)}}function xSe(n,t){if(n&1){let e=et();E(0,"div",18)(1,"span",19),O(2,"Center Registration"),S(),ce(3,"div",20),E(4,"form",21,0),_e("ngSubmit",function(){ve(e);let o=le();return be(o.submitForm())}),E(6,"div",22)(7,"div",23)(8,"label",24),O(9,"Owner Email:"),S(),E(10,"input",25),ht("ngModelChange",function(o){ve(e);let i=le();return gt(i.email,o)||(i.email=o),be(o)}),S()(),E(11,"div",23)(12,"label",26),O(13,"Center Name:"),S(),E(14,"input",27),ht("ngModelChange",function(o){ve(e);let i=le();return gt(i.center.centerName,o)||(i.center.centerName=o),be(o)}),S()(),E(15,"div",23)(16,"label",28),O(17,"Center Type:"),S(),E(18,"select",29),ht("ngModelChange",function(o){ve(e);let i=le();return gt(i.center.centerType,o)||(i.center.centerType=o),be(o)}),E(19,"option",30),O(20,"Select AC/Non-AC"),S(),E(21,"option",31),O(22,"AC"),S(),E(23,"option",32),O(24,"Non-AC"),S()()()(),E(25,"div",22)(26,"div",23)(27,"label",33),O(28,"Registration Number:"),S(),E(29,"input",34),ht("ngModelChange",function(o){ve(e);let i=le();return gt(i.center.registrationNumber,o)||(i.center.registrationNumber=o),be(o)}),S()(),E(30,"div",23)(31,"label",35),O(32,"Contact Number:"),S(),E(33,"input",36),ht("ngModelChange",function(o){ve(e);let i=le();return gt(i.center.contactNumber,o)||(i.center.contactNumber=o),be(o)}),S()(),E(34,"div",23)(35,"label",37),O(36,"Trainer Count:"),S(),E(37,"input",38),ht("ngModelChange",function(o){ve(e);let i=le();return gt(i.center.trainerCount,o)||(i.center.trainerCount=o),be(o)}),S()()(),E(38,"div",22)(39,"div",23)(40,"label",39),O(41,"Address:"),S(),E(42,"input",40),ht("ngModelChange",function(o){ve(e);let i=le();return gt(i.center.address,o)||(i.center.address=o),be(o)}),S()(),E(43,"div",23)(44,"label",41),O(45,"State:"),S(),E(46,"input",42),ht("ngModelChange",function(o){ve(e);let i=le();return gt(i.center.state,o)||(i.center.state=o),be(o)}),S()(),E(47,"div",23)(48,"label",43),O(49,"City:"),S(),E(50,"input",44),ht("ngModelChange",function(o){ve(e);let i=le();return gt(i.center.city,o)||(i.center.city=o),be(o)}),S()(),E(51,"div",23)(52,"label",45),O(53,"Pincode:"),S(),E(54,"input",46),ht("ngModelChange",function(o){ve(e);let i=le();return gt(i.center.pincode,o)||(i.center.pincode=o),be(o)}),S()()(),E(55,"div",22)(56,"div",23)(57,"label",47),O(58,"Opening Time:"),S(),E(59,"input",48),ht("ngModelChange",function(o){ve(e);let i=le();return gt(i.center.openingTime,o)||(i.center.openingTime=o),be(o)}),S()(),E(60,"div",23)(61,"label",49),O(62,"Closing Time:"),S(),E(63,"input",50),ht("ngModelChange",function(o){ve(e);let i=le();return gt(i.center.closingTime,o)||(i.center.closingTime=o),be(o)}),S()(),Ne(64,aSe,5,5,"div",51)(65,lSe,2,0,"button",52),S(),E(66,"div",23)(67,"label",53),O(68,"Details:"),S(),E(69,"textarea",54),ht("ngModelChange",function(o){ve(e);let i=le();return gt(i.center.details,o)||(i.center.details=o),be(o)}),S()(),E(70,"div",22)(71,"div",23)(72,"label",55),O(73,"Latitude:"),S(),E(74,"input",56),ht("ngModelChange",function(o){ve(e);let i=le();return gt(i.center.latitude,o)||(i.center.latitude=o),be(o)}),S()(),E(75,"div",23)(76,"label",57),O(77,"Longitude:"),S(),E(78,"input",58),ht("ngModelChange",function(o){ve(e);let i=le();return gt(i.center.longitude,o)||(i.center.longitude=o),be(o)}),S()()(),E(79,"div",59)(80,"div",60)(81,"label"),O(82,"Images(URL):"),S(),Ne(83,cSe,2,0,"button",52),S(),Ne(84,dSe,3,5,"div",61),S(),E(85,"div",60)(86,"label"),O(87,"Videos(URL):"),S(),Ne(88,pSe,2,0,"button",52),S(),Ne(89,hSe,3,5,"div",61),E(90,"div",60)(91,"label"),O(92,"Instruments:"),S(),Ne(93,mSe,2,0,"button",52),S(),Ne(94,ySe,3,5,"div",62),E(95,"button",63),O(96,"Submit"),S()()()}if(n&2){let e=Fg(5),r=le();z(10),ft("ngModel",r.email),z(4),ft("ngModel",r.center.centerName),z(4),ft("ngModel",r.center.centerType),z(11),ft("ngModel",r.center.registrationNumber),z(4),ft("ngModel",r.center.contactNumber),z(4),ft("ngModel",r.center.trainerCount),z(5),ft("ngModel",r.center.address),z(4),ft("ngModel",r.center.state),z(4),ft("ngModel",r.center.city),z(4),ft("ngModel",r.center.pincode),z(5),ft("ngModel",r.center.openingTime),re("placeholder",r.center.openingTime),z(4),ft("ngModel",r.center.closingTime),z(),re("ngForOf",r.center.daysAvailable)("ngForTrackBy",r.trackByIndex),z(),re("ngIf",r.center.daysAvailable[r.center.daysAvailable.length-1]),z(4),ft("ngModel",r.center.details),z(5),ft("ngModel",r.center.latitude),z(4),ft("ngModel",r.center.longitude),z(5),re("ngIf",r.center.images[r.center.images.length-1]),z(),re("ngForOf",r.center.images)("ngForTrackBy",r.trackByIndex),z(4),re("ngIf",r.center.videos[r.center.videos.length-1]),z(),re("ngForOf",r.center.videos)("ngForTrackBy",r.trackByIndex),z(4),re("ngIf",r.center.availableInstruments[r.center.availableInstruments.length-1]),z(),re("ngForOf",r.center.availableInstruments)("ngForTrackBy",r.trackByIndex),z(),re("disabled",!e.form.valid)}}function vSe(n,t){n&1&&(E(0,"span",79),ce(1,"i",80),O(2,"\xA0Verification Pending"),S())}function bSe(n,t){n&1&&(E(0,"span",81),ce(1,"i",82),O(2,"\xA0Verified"),S())}function wSe(n,t){if(n&1&&(E(0,"div",70)(1,"div",71)(2,"h5",72),O(3,"Center Details"),S(),Ne(4,vSe,3,0,"span",73)(5,bSe,3,0,"span",74),S(),ce(6,"div",20),E(7,"div",75)(8,"div",76)(9,"div",23)(10,"label"),O(11,"Center Name:"),S(),E(12,"p"),O(13),S()(),E(14,"div",23)(15,"label"),O(16,"Center Type:"),S(),E(17,"p"),O(18),S()(),E(19,"div",23)(20,"label"),O(21,"Registration Number:"),S(),E(22,"p"),O(23),S()(),E(24,"div",23)(25,"label"),O(26,"Contact Number:"),S(),E(27,"p"),O(28),S()(),E(29,"div",23)(30,"label"),O(31,"Trainer Count:"),S(),E(32,"p"),O(33),S()(),E(34,"div",23)(35,"label"),O(36,"State:"),S(),E(37,"p"),O(38),S()(),E(39,"div",23)(40,"label"),O(41,"City:"),S(),E(42,"p"),O(43),S()(),E(44,"div",23)(45,"label"),O(46,"Pincode:"),S(),E(47,"p"),O(48),S()(),E(49,"div",23)(50,"label"),O(51,"Opening Time:"),S(),E(52,"p"),O(53),S()(),E(54,"div",23)(55,"label"),O(56,"Closing Time:"),S(),E(57,"p"),O(58),S()(),E(59,"div",23)(60,"label"),O(61,"Days Available:"),S(),E(62,"p"),O(63),S()(),E(64,"div",23)(65,"label"),O(66,"Address:"),S(),E(67,"p"),O(68),S()()(),E(69,"div",77),ce(70,"img",78),S()()()),n&2){let e=le();z(4),re("ngIf",!e.center.isVerified),z(),re("ngIf",e.center.isVerified),z(8),Ye(e.center.centerName),z(5),Ye(e.center.centerType),z(5),Ye(e.center.registrationNumber),z(5),Ye(e.center.contactNumber),z(5),Ye(e.center.trainerCount),z(5),Ye(e.center.state),z(5),Ye(e.center.city),z(5),Ye(e.center.pincode),z(5),Ye(e.center.openingTime),z(5),Ye(e.center.closingTime),z(5),Ye(e.center.daysAvailable.join(", ")),z(5),Ye(e.center.address),z(2),re("src",e.center.images[0],di)}}var sI=class n{isRegistered=!1;isVerified=!1;email=localStorage.getItem("email");userName=localStorage.getItem("userName");http=Q(Ea);authService=Q(xn);router=Q(Ut);notification=Q(Vn);center={centerHeadEmail:"",centerName:"",centerType:"",registrationNumber:"",address:"",state:"",city:"",pincode:"",contactNumber:"",trainerCount:"",details:"",openingTime:"",closingTime:"",daysAvailable:[""],availableInstruments:[""],videos:[""],images:[""],latitude:"",longitude:"",isRegistered:!1,isVerified:!1};centerDetails=[];healthData;ngOnInit(){this.email&&this.authService.gymRegistered(this.email).subscribe(t=>{this.isRegistered=t.isRegistered,t.isRegistered&&(this.center=t.gym)})}addField(t){this.center[t][this.center[t].length-1]!==""&&(this.center[t].push(""),setTimeout(()=>{let e=document.querySelectorAll(`input[name=${t}${this.center[t].length-1}]`);e.length>0&&e[0].focus()}))}removeField(t,e){this.center[t].length>1&&this.center[t].splice(e,1)}trackByIndex(t,e){return t}submitForm(){this.email&&this.center.centerName.trim()&&this.center.centerType.trim()&&this.center.registrationNumber.trim()&&this.center.address.trim()&&this.center.state.trim()&&this.center.city.trim()&&this.center.pincode.trim()&&this.center.contactNumber.trim()&&this.center.trainerCount.trim()&&this.center.details.trim()&&this.center.openingTime.trim()&&this.center.closingTime.trim()&&this.center.daysAvailable.some(t=>t.trim()!=="")&&this.center.availableInstruments.some(t=>t.trim()!=="")&&this.center.videos.some(t=>t.trim()!=="")&&this.center.images.some(t=>t.trim()!=="")&&this.center.latitude.trim()&&this.center.longitude.trim()?(this.center.centerHeadEmail=this.email,console.log(this.center),this.authService.addGymDetails(this.center).subscribe(t=>{window.location.reload(),this.notification.showNotification("Gym details added successfully!","success")},t=>{console.log(t),this.notification.showNotification(`${t.error.msg}`,"error")})):alert("Please fill all required fields!")}logout(){let t=localStorage.getItem("email");t&&this.authService.logout(t).subscribe(e=>{localStorage.clear(),this.router.navigate(["/login"]),this.notification.showNotification(`${e.msg}`,"success")},e=>{this.notification.showNotification(`${e.error.msg}`,"error")})}goToSection(t){if(this.router.navigate([""],{fragment:`${t}`}),this.router.url==="/"){let e=document.getElementById(t);e&&e.scrollIntoView({behavior:"smooth",block:"start"})}else this.router.navigate(["/"]).then(()=>{let e=document.getElementById(t);e&&e.scrollIntoView({behavior:"smooth",block:"start"})})}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=Ct({type:n,selectors:[["app-center"]],decls:38,vars:5,consts:[["centerForm","ngForm"],[1,"main"],[1,"left-section"],[1,"logo"],[2,"color","#fff"],[2,"color","var(--shade-1)"],[1,"menu"],[1,"welcome"],[1,"dashboard-active"],["src","dashboard.png","alt","","width","20px"],[3,"routerLink"],[1,"fa-solid","fa-house"],[3,"click"],[1,"fa-solid","fa-power-off"],[1,"right-section"],[1,"heading"],["class","registrationForm",4,"ngIf"],["class","displayDetails",4,"ngIf"],[1,"registrationForm"],[1,"cr"],[1,"line"],[3,"ngSubmit"],[1,"g1"],[1,"form-group"],["for","centerHeadEmail"],["type","email","id","centerHeadEmail","name","centerHeadEmail","readonly","",1,"form-control","disabled",3,"ngModelChange","ngModel"],["for","centerName"],["type","text","id","centerName","name","centerName","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","centerType"],["id","centerType","name","centerType","required","",1,"form-control",3,"ngModelChange","ngModel"],["value",""],["value","AC"],["value","Non-AC"],["for","registrationNumber"],["type","text","id","registrationNumber","name","registrationNumber","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","contactNumber"],["type","text","id","contactNumber","name","contactNumber","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","trainerCount"],["type","text","id","trainerCount","name","trainerCount","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","address"],["type","text","id","address","name","address","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","state"],["type","text","id","state","name","state","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","city"],["type","text","id","city","name","city","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","pincode"],["type","text","id","pincode","name","pincode","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","openingTime"],["type","time","id","openingTime","name","openingTime","required","",1,"form-control",3,"ngModelChange","ngModel","placeholder"],["for","closingTime"],["type","time","id","closingTime","name","closingTime","placeholder","HH / MM","required","",1,"form-control",3,"ngModelChange","ngModel"],["class","form-group",4,"ngFor","ngForOf","ngForTrackBy"],["type","button",3,"click",4,"ngIf"],["for","details"],["placeholder","Basic Info About Gym","id","details","name","details",1,"form-control",3,"ngModelChange","ngModel"],["for","latitude"],["id","latitude","name","latitude","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","longitude"],["id","longitude","name","longitude","required","",1,"form-control",3,"ngModelChange","ngModel"],[1,""],[1,"form-group-array"],["class","form-group fg1",4,"ngFor","ngForOf","ngForTrackBy"],["class","fg1 form-group",4,"ngFor","ngForOf","ngForTrackBy"],["type","submit",1,"btnSubmit",3,"disabled"],["type","text","placeholder","Available Day in week","required","",1,"form-control",3,"ngModelChange","ngModel","name"],["type","button",3,"click"],[1,"form-group","fg1"],["type","text","required","",1,"form-control",3,"ngModelChange","placeholder","ngModel","name"],[1,"fg1","form-group"],["type","text","required","","placeholder","Instruments Used",1,"form-control",3,"ngModelChange","placeholder","ngModel","name"],[1,"displayDetails"],[1,"title"],[2,"margin","0"],["id","v1",4,"ngIf"],["id","v2",4,"ngIf"],[1,"centerDetails"],[1,"centerDetailsLeft"],[1,"centerDetailsRight"],["alt","Gym Image",3,"src"],["id","v1"],[1,"fa-solid","fa-info"],["id","v2"],[1,"fa-solid","fa-check"]],template:function(e,r){e&1&&(E(0,"div",1)(1,"div",2)(2,"div",3)(3,"span",4)(4,"span",5),O(5,"FIT"),S(),O(6,"GENIE"),S()(),E(7,"div",6)(8,"div",7)(9,"span"),O(10,"Welcome,"),ce(11,"br"),E(12,"span",5),O(13),S()()(),E(14,"li",8),ce(15,"img",9),O(16,"\xA0\xA0 "),E(17,"p"),O(18,"Dashboard"),S()(),E(19,"a",10)(20,"li"),ce(21,"i",11),O(22,"\xA0\xA0 "),E(23,"p"),O(24,"Home"),S()()(),E(25,"li",12),_e("click",function(){return r.logout()}),ce(26,"i",13),O(27,"\xA0\xA0 "),E(28,"p"),O(29,"Log Out"),S()()(),ce(30,"hr"),S(),E(31,"div",14)(32,"div",15)(33,"span"),O(34,"Fitness Center Dashboard"),S()(),Ne(35,xSe,97,29,"div",16)(36,wSe,71,15,"div",17),S()(),ce(37,"app-footer")),e&2&&(z(13),Ye(r.userName),z(6),re("routerLink",Fi(4,iSe)),z(16),re("ngIf",!r.isRegistered),z(),re("ngIf",r.isRegistered))},dependencies:[Kn,Ln,Li,Er,Fs,Vi,fc,hc,vo,Ps,Ho,$i,ad,ka,sd,Ls],styles:['.main[_ngcontent-%COMP%]{min-height:100vh;background-color:var(--dark);display:flex;font-family:Poppins,sans-serif;width:100%;max-width:1500px;margin:0 auto}.logo[_ngcontent-%COMP%]{font-size:25px;font-weight:600;margin:20px 20px 30px;color:var(--light)}.welcome[_ngcontent-%COMP%]{color:var(--light)}.left-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;width:240px;background-color:var(--shade-2)}.menu[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:18px}.menu[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:flex;text-align:left;align-items:center;white-space:nowrap;font-size:larger;font-weight:500;color:var(--light);cursor:pointer;margin-bottom:18px}.menu[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0}.left-section[_ngcontent-%COMP%]   hr[_ngcontent-%COMP%]{width:100%;background-color:#e7e7e7;height:2px}.contact-section[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-end;position:relative;margin-top:50px;padding:90px 0}.contact-section[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:120px;position:absolute;left:0}.contact-text[_ngcontent-%COMP%]{height:max-content;background-color:bisque;padding:4px;width:150px;z-index:2}.contact-text[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border:none;outline:none;border-radius:9999px;padding:5px 10px;background-color:#16331b;color:var(--light);font-weight:600}.dashboard-active[_ngcontent-%COMP%]{display:flex;align-items:center;text-align:center;margin-bottom:16px;border-radius:8px}.dashboard-active[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-bottom:0}.right-section[_ngcontent-%COMP%]{width:calc(100% - 240px);padding:16px}.line[_ngcontent-%COMP%]{height:2px;border-radius:6px;margin:18px auto;background-color:#16331b}.verify-shops-list[_ngcontent-%COMP%]{border-radius:8px;max-height:500px;overflow-y:auto;background-color:#efefefde;border:1px solid #a5a5a5b4;padding:10px;display:flex;flex-direction:column;gap:8px}.welcome[_ngcontent-%COMP%]{text-align:center;margin-bottom:18px}.welcome[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:600;color:var(--shade-4);font-size:20px}.heading[_ngcontent-%COMP%]{padding:10px 18px;background-color:var(--shade-2);text-align:center;border-radius:4px;color:var(--light);font-weight:600;font-size:larger}.registrationForm[_ngcontent-%COMP%]{background-color:var(--shade-2);padding:12px;border-radius:4px;margin:20px 0}.cr[_ngcontent-%COMP%]{margin:0;color:var(--light);font-size:larger;font-weight:600}.form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px;margin-bottom:12px}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{color:var(--light)}.g1[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{background-color:#c5c5c5;border:none}.form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{height:100px;resize:none}.disabled[_ngcontent-%COMP%]{background-color:#7a7a7a!important;cursor:not-allowed}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]:after{padding:0 4px;content:"*";color:#c40000}button[_ngcontent-%COMP%]:disabled{color:#626262;cursor:not-allowed}.btnSubmit[_ngcontent-%COMP%]{border-radius:4px;border:none;background-color:var(--shade-1);padding:8px 18px;font-weight:600;color:var(--dark)}.form-group-array[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;color:var(--light);padding:8px 0}.form-group-array[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border:none;outline:none;border-radius:4px;padding:5px 10px;background-color:#ffffff3f;color:var(--light);font-weight:600;cursor:pointer}.fg1[_ngcontent-%COMP%]{display:flex!important;flex-direction:row}.fg1[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:4px 8px;border:none;border-radius:4px;font-weight:600}.form-group-array[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]:after{padding:0 4px;content:"*";color:#c40000}.displayDetails[_ngcontent-%COMP%]{background-color:var(--shade-2);padding:12px;border-radius:4px;margin:16px 0}.displayDetails[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{color:var(--light);font-weight:500;font-size:large;margin-bottom:12px;display:flex;align-items:center;gap:16px}.displayDetails[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin:0}.displayDetails[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{background-color:var(--shade-1);padding:4px 8px;border-radius:50%;color:var(--dark);font-size:16px;font-weight:900}#v2[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{padding:4px 6px!important}.centerDetails[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]:after{content:""!important}.centerDetails[_ngcontent-%COMP%]{display:flex}.centerDetails[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{max-width:480px;color:#fff;background-color:#ffffff25;padding:8px;border-radius:4px;height:max-content}.centerDetails[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0}.centerDetailsLeft[_ngcontent-%COMP%]{width:70%;display:flex;flex-wrap:wrap;gap:12px}.centerDetailsRight[_ngcontent-%COMP%]{width:30%}.centerDetailsRight[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;border-radius:4px;object-fit:cover}']})};function CSe(n,t){if(n&1){let e=et();E(0,"div",13)(1,"input",14),_e("change",function(){let o=ve(e).$implicit,i=le(2);return be(i.updateFilter("city",o.name))}),S(),E(2,"label",15),O(3),S()()}if(n&2){let e=t.$implicit;z(),re("id","city-"+e.name),z(),re("for","city-"+e.name),z(),Ye(e.name)}}function _Se(n,t){if(n&1&&(E(0,"div",11),Ne(1,CSe,4,3,"div",12),S()),n&2){let e=le();z(),re("ngForOf",e.city)}}function SSe(n,t){if(n&1){let e=et();E(0,"div",13)(1,"input",16),_e("change",function(){let o=ve(e).$implicit,i=le(2);return be(i.updateFilter("centerRating",o.value.toString()))}),S(),E(2,"label",15),O(3),S()()}if(n&2){let e=t.$implicit;z(),re("id","centerRating-"+e.value),z(),re("for","centerRating-"+e.value),z(),Ye(e.value)}}function ISe(n,t){if(n&1&&(E(0,"div",11),Ne(1,SSe,4,3,"div",12),S()),n&2){let e=le();z(),re("ngForOf",e.centerRating)}}function ESe(n,t){if(n&1){let e=et();E(0,"div",13)(1,"input",17),_e("change",function(){let o=ve(e).$implicit,i=le(2);return be(i.updateFilter("daysAvailable",o.value))}),S(),E(2,"label",15),O(3),S()()}if(n&2){let e=t.$implicit;z(),re("id","daysAvailable-"+e.value),z(),re("for","daysAvailable-"+e.value),z(),Ye(e.name)}}function TSe(n,t){if(n&1&&(E(0,"div",11),Ne(1,ESe,4,3,"div",12),S()),n&2){let e=le();z(),re("ngForOf",e.daysAvailable)}}function DSe(n,t){if(n&1){let e=et();E(0,"div",13)(1,"input",18),_e("change",function(){let o=ve(e).$implicit,i=le(2);return be(i.updateFilter("centerType",o.name))}),S(),E(2,"label",15),O(3),S()()}if(n&2){let e=t.$implicit;z(),re("id","centerType-"+e.name),z(),re("for","centerType-"+e.name),z(),Ye(e.name)}}function kSe(n,t){if(n&1&&(E(0,"div",11),Ne(1,DSe,4,3,"div",12),S()),n&2){let e=le();z(),re("ngForOf",e.centerType)}}function NSe(n,t){n&1&&(E(0,"div",19),O(1," No Gyms available. "),S())}function ASe(n,t){if(n&1){let e=et();E(0,"div",20)(1,"div",21),ce(2,"img",22),S(),E(3,"div",23)(4,"h5"),O(5),S(),E(6,"p",24),O(7),S(),E(8,"p"),O(9),S(),E(10,"p",25),O(11),S(),E(12,"p",26),ce(13,"i",27),O(14),S()(),E(15,"div",28)(16,"p",29),O(17),S(),E(18,"button",30),_e("click",function(){let o=ve(e).$implicit,i=le();return be(i.viewDetails(o._id))}),O(19," View Details "),S()()()}if(n&2){let e=t.$implicit;z(2),re("src",e.images[0],di),z(3),Ye(e.centerName),z(2),Tt(" ",e.centerType," "),z(2),Ye(e.registrationNumber),z(2),Tt("",e.availableInstruments.slice(0,2).join(", "),"..."),z(3),_a("\xA0",e.address,", ",e.city," "),z(3),Ye(e.daysAvailable.join(" - "))}}var aI=class n{selectedFilters={};gyms=[];authService=Q(xn);notificationService=Q(Vn);router=Q(Ut);cityChecked=!1;ratingChecked=!1;daysChecked=!1;typeChecked=!1;isappointmentCard=!1;email=localStorage.getItem("email");userName=localStorage.getItem("userName");centerRating=[{value:5},{value:4},{value:3},{value:2},{value:1}];centerType=[{name:"AC"},{name:"Non-AC"}];daysAvailable=[{name:"Everyday",value:"everyday"},{name:"Monday",value:"mon"},{name:"Tuesday",value:"tue"},{name:"Wednesday",value:"wed"},{name:"Thursday",value:"thu"},{name:"Friday",value:"fri"},{name:"Saturday",value:"sat"},{name:"Sunday",value:"sun"}];city=[{name:"Kolkata"},{name:"Mumbai"},{name:"Delhi"},{name:"Chennai"},{name:"Bangalore"},{name:"Hyderabad"},{name:"Pune"},{name:"Mohali"},{name:"Nagpur"},{name:"Jaipur"},{name:"Bhopal"},{name:"Visakhapatnam"},{name:"Vadodara"},{name:"Surat"},{name:"Ahmedabad"},{name:"Rajkot"},{name:"Lucknow"},{name:"Kanpur"},{name:"Nashik"},{name:"Indore"},{name:"Bhubaneswar"}];ngOnInit(){this.fetchGymCentres()}toggleCheck(t,e){this[e]=!t}viewDetails(t){this.router.navigate(["/centerDetails/"+t])}fetchGymCentres(){let t=Object.keys(this.selectedFilters).reduce((e,r)=>(this.selectedFilters[r]!==null&&this.selectedFilters[r]!==void 0&&(e[r]=Array.isArray(this.selectedFilters[r])?this.selectedFilters[r]:String(this.selectedFilters[r])),e),{});this.authService.fetchFilteredCenterDetails(t).subscribe({next:e=>{this.gyms=e.gyms||[]},error:e=>{console.error("Error fetching gyms:",e)}})}updateFilter(t,e){t==="rating"?this.selectedFilters[t]=String(e):t==="daysAvailable"?this.selectedFilters[t]=Array.isArray(e)?e:[String(e)]:this.selectedFilters[t]=e?String(e):null,this.fetchGymCentres()}clearFilters(){this.selectedFilters={},this.fetchGymCentres()}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=Ct({type:n,selectors:[["app-centers"]],decls:34,vars:6,consts:[[1,"navbar"],[1,"main"],[1,"left-section"],[1,"filter"],[1,"form-title",3,"click"],[1,"fa-solid","fa-angle-down"],["class","form-content",4,"ngIf"],[1,"clear",3,"click"],[1,"right-section"],["class","no-gyms",4,"ngIf"],["class","gym-card",4,"ngFor","ngForOf"],[1,"form-content"],["class","form-item",4,"ngFor","ngForOf"],[1,"form-item"],["type","radio","name","city",3,"change","id"],[3,"for"],["type","radio","name","centerRating",3,"change","id"],["type","radio","name","daysAvailable",3,"change","id"],["type","radio","name","centerType",3,"change","id"],[1,"no-gyms"],[1,"gym-card"],[1,"gym-image"],["alt","Gym's Image",3,"src"],[1,"gym-details"],[1,"experience"],[1,"qualification"],[1,"location"],[1,"fa-solid","fa-location-dot"],[1,"gym-appointment"],[1,"availableDays"],[1,"bookAppointment",3,"click"]],template:function(e,r){e&1&&(E(0,"div",0),ce(1,"app-navbar"),S(),E(2,"div",1)(3,"div",2)(4,"h4"),O(5,"Filters"),S(),E(6,"div",3)(7,"div",4),_e("click",function(){return r.toggleCheck(r.cityChecked,"cityChecked")}),O(8," City"),ce(9,"i",5),S(),Ne(10,_Se,2,1,"div",6),S(),E(11,"div",3)(12,"div",4),_e("click",function(){return r.toggleCheck(r.ratingChecked,"ratingChecked")}),O(13," Rating"),ce(14,"i",5),S(),Ne(15,ISe,2,1,"div",6),S(),E(16,"div",3)(17,"div",4),_e("click",function(){return r.toggleCheck(r.daysChecked,"daysChecked")}),O(18," Days Available "),ce(19,"i",5),S(),Ne(20,TSe,2,1,"div",6),S(),E(21,"div",3)(22,"div",4),_e("click",function(){return r.toggleCheck(r.typeChecked,"typeChecked")}),O(23," Gym Type "),ce(24,"i",5),S(),Ne(25,kSe,2,1,"div",6),S(),E(26,"button",7),_e("click",function(){return r.clearFilters()}),O(27,"Clear Filters"),S()(),E(28,"div",8)(29,"h4"),O(30,"Available Gym Centers"),S(),Ne(31,NSe,2,0,"div",9)(32,ASe,20,8,"div",10),S()(),ce(33,"app-footer")),e&2&&(z(10),re("ngIf",r.cityChecked),z(5),re("ngIf",r.ratingChecked),z(5),re("ngIf",r.daysChecked),z(5),re("ngIf",r.typeChecked),z(6),re("ngIf",r.gyms.length===0),z(),re("ngForOf",r.gyms))},dependencies:[Xr,Kn,Ln,Er,Zg],styles:[".main[_ngcontent-%COMP%]{min-height:100vh;max-width:1350px;margin:25px auto;display:flex;color:var(--light)}.left-section[_ngcontent-%COMP%]{padding:20px}.left-section[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin-bottom:30px}.form-filter[_ngcontent-%COMP%]{width:280px}.filter[_ngcontent-%COMP%]{margin-bottom:12px}.form-title[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;font-size:large;width:280px;font-weight:500;padding:8px 18px;background-color:var(--shade-2);border:1px solid var(--shade-1);color:var(--shade-1);border-radius:4px 4px 0 0;cursor:pointer}.form-title[_ngcontent-%COMP%]:hover{background-color:var(--shade-1);color:var(--dark)}.form-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:8px 18px;border:1px solid var(--shade-1);border-radius:0 0 4px 4px;max-height:180px;overflow-y:auto}.form-item[_ngcontent-%COMP%]{display:inline-flex;gap:8px}.clear[_ngcontent-%COMP%]{background-color:transparent;border:none;cursor:pointer;color:var(--light);padding:8px 18px;font-size:larger}.right-section[_ngcontent-%COMP%]{width:100%}.gym-card[_ngcontent-%COMP%]{padding:12px;border:1px solid var(--shade-1);border-radius:4px;margin:12px 0;width:100%;display:flex}.gym-image[_ngcontent-%COMP%]{width:200px;height:200px;object-fit:cover;background-color:var(--light);margin-right:18px}.gym-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.gym-details[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;letter-spacing:.06rem;gap:4px;width:450px;font-size:small;border-right:1.5px solid var(--shade-2);padding:0 12px}.gym-details[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0}.experience[_ngcontent-%COMP%]{padding:4px 8px;background-color:var(--shade-4);border-radius:4px;color:var(--shade-2);font-weight:600;width:max-content}.location[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:var(--shade-1)}.qualification[_ngcontent-%COMP%]{font-weight:600}.gym-appointment[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;width:40%}.availableDays[_ngcontent-%COMP%]{color:var(--shade-1);font-size:larger;font-weight:600}.bookAppointment[_ngcontent-%COMP%]{background-color:var(--shade-1);color:var(--dark);border:none;font-weight:600;border-radius:4px;padding:8px 16px;cursor:pointer}.bookAppointment[_ngcontent-%COMP%]:hover{background-color:#afce00}"]})};function RSe(n,t){if(n&1){let e=et();E(0,"div",29)(1,"img",30),_e("click",function(){let o=ve(e).$implicit,i=le(2);return be(i.showInLargeView(o,"image"))}),S()()}if(n&2){let e=t.$implicit;z(),re("src",e,di)}}function OSe(n,t){if(n&1){let e=et();E(0,"div",29)(1,"img",31),_e("click",function(){let o=ve(e).$implicit,i=le(2);return be(i.showInLargeView(o,"video"))}),S()()}}function MSe(n,t){if(n&1&&ce(0,"img",32),n&2){let e=le(2);re("src",e.largeViewSrc,di)}}function PSe(n,t){if(n&1&&ce(0,"iframe",33),n&2){let e=le(2);re("src",e.largeViewSrc,f0)}}function FSe(n,t){n&1&&ce(0,"div",38)}function LSe(n,t){n&1&&ce(0,"i",39)}function $Se(n,t){if(n&1){let e=et();E(0,"button",34),_e("click",function(){ve(e);let o=le(2);return be(o.isWishlisted?o.goToWishlist():o.wishlist(o.gymDetails._id))}),ce(1,"i",35),O(2),Ne(3,FSe,1,0,"div",36)(4,LSe,1,0,"i",37),S()}if(n&2){let e=le(2);z(2),Tt("\xA0\xA0\xA0\xA0",e.isWishlisted?"Go to Wishlist":"Add to Wishlist"," "),z(),re("ngIf",e.loading),z(),re("ngIf",!e.email)}}function VSe(n,t){if(n&1){let e=et();E(0,"button",40),_e("click",function(){ve(e);let o=le(2);return be(o.openEditForm())}),ce(1,"i",41),O(2,"\xA0\xA0Edit Gym Details "),S()}}function BSe(n,t){if(n&1&&(E(0,"li"),O(1),S()),n&2){let e=t.$implicit;z(),Ye(e)}}function zSe(n,t){n&1&&(E(0,"div"),O(1,"Loading plant details..."),S())}function USe(n,t){if(n&1){let e=et();E(0,"div")(1,"div",3)(2,"div",4)(3,"div",5)(4,"div",6),Ne(5,RSe,2,1,"div",7)(6,OSe,2,0,"div",7),S(),E(7,"div",8)(8,"button",9),_e("click",function(){ve(e);let o=le();return be(o.sharePage())}),ce(9,"i",10),S(),E(10,"div",11),Ne(11,MSe,1,1,"img",12)(12,PSe,1,1,"iframe",13),S()()(),E(13,"div",14),Ne(14,$Se,5,3,"button",15),S()(),E(15,"div",16),Ne(16,VSe,3,0,"button",17),E(17,"div",18)(18,"h3"),O(19),S()(),E(20,"div",19)(21,"p")(22,"strong"),O(23,"Type:"),S(),O(24),S()(),E(25,"div",19)(26,"p")(27,"strong"),O(28,"No of trainers:"),S(),O(29),S()(),E(30,"div",20)(31,"div",21)(32,"strong"),O(33,"Description"),S()(),E(34,"p"),O(35),S()(),E(36,"div",22)(37,"p")(38,"strong"),O(39,"Availability"),S(),O(40),S()(),E(41,"div",23)(42,"p")(43,"strong"),O(44,"Days Available:"),S(),O(45),S()(),E(46,"div",24)(47,"div",21)(48,"strong"),O(49,"Instruments"),S()(),E(50,"ul",25),Ne(51,BSe,2,1,"li",26),S()(),E(52,"div",27)(53,"div",21)(54,"strong"),O(55,"Address:"),S()(),E(56,"p"),O(57),S()(),E(58,"div",28)(59,"div",21)(60,"strong"),O(61,"Contact Number:"),S()(),E(62,"p"),O(63),S()()(),Ne(64,zSe,2,0,"div",2),S()()}if(n&2){let e=le();z(5),re("ngForOf",e.gymDetails.images),z(),re("ngForOf",e.gymDetails.videos),z(5),re("ngIf",e.largeViewType==="image"),z(),re("ngIf",e.largeViewType==="video"),z(2),re("ngIf",!e.loading),z(2),re("ngIf",e.email===e.gymDetails.centerHeadEmail),z(3),Ye(e.gymDetails.centerName),z(5),Tt(" ",e.gymDetails.centerType,""),z(5),Tt(" ",e.gymDetails.trainerCount,""),z(6),Ye(e.gymDetails.details),z(5),_a(": ",e.gymDetails.openingTime," - ",e.gymDetails.closingTime,""),z(5),Tt(" ",e.gymDetails.daysAvailable.join(", "),""),z(6),re("ngForOf",e.gymDetails.availableInstruments),z(6),GR("",e.gymDetails.address,", ",e.gymDetails.state,", ",e.gymDetails.city,", ",e.gymDetails.pincode,""),z(6),Ye(e.gymDetails.contactNumber),z(),re("ngIf",!e.gymDetails)}}var lI=class n{constructor(t){this.route=t;this.currentPageUrl=`${window.location.origin}${this.router.url}`}gymId=null;gymDetails=null;gymName=null;data=null;showModelInLargeView=!1;email=localStorage.getItem("email");showLock=!0;showEditPopup=!1;editableGymDetails={};isWishlisted=!1;sanitizer=Q(w0);authService=Q(xn);params=Q(jo);router=Q(Ut);notificationService=Q(Vn);largeViewSrc;proxyUrl;largeViewType="";showCommentModal=!1;commentText="";currentPageUrl;loading=!1;isModel=!0;ngOnInit(){this.gymId=this.params.snapshot.paramMap.get("id"),this.gymId&&this.fetchgymDetails(this.gymId),this.editableGymDetails=ke({},this.gymDetails)}openEditForm(){this.showEditPopup=!0,this.editableGymDetails=ke({},this.gymDetails)}saveChanges(){let t=this.editableGymDetails;this.loading=!0,this.gymId&&this.authService.updateGymDetails(this.gymId,t).subscribe({next:()=>{this.gymDetails=ke({},this.editableGymDetails),this.showEditPopup=!1,this.loading=!1},error:()=>{this.loading=!1,alert("Failed to update gym details.")}})}wishlist(t){this.email&&(this.loading=!0,this.authService.addToWishlist(this.email,t).subscribe({next:e=>{this.isWishlisted=!0,this.loading=!1,this.notificationService.showNotification(e.message,"success")},error:e=>{this.loading=!1,console.log(e),this.notificationService.showNotification("Failed to add gym to wishlist.","error")}}))}goToWishlist(){this.router.navigate(["/wishList"])}discardChanges(){this.showEditPopup=!1}addItem(t){Array.isArray(t)&&t.push("")}removeItem(t,e){Array.isArray(t)&&e>=0&&e<t.length&&t.splice(e,1)}fetchgymDetails(t){this.authService.loadGymDetails(t).subscribe({next:e=>{this.gymDetails=e.gym,this.largeViewType="image",this.largeViewSrc=this.gymDetails.images[0],this.gymName=this.gymDetails.centerName,this.gymDetails&&this.email&&this.authService.checkInWishlist(this.email,this.gymDetails._id).subscribe(r=>{r.isGymInWishlist&&(this.isWishlisted=!0)},r=>{console.log(r)})},error:e=>console.error("Error fetching gym details:",e)})}sanitizeUrl(t){return this.sanitizer.bypassSecurityTrustResourceUrl(t)}showInLargeView(t,e){if(e==="video"||e==="image"?this.isModel=!1:this.isModel=!0,e==="video"){this.largeViewSrc=this.sanitizeUrl(t),console.log(this.largeViewSrc),this.largeViewType=e;return}this.largeViewSrc=t,this.largeViewType=e}sharePage(){navigator.share?navigator.share({title:"Check out this gym!",text:"Here is a detailed view of the gym.",url:this.currentPageUrl}).then(()=>console.log("Successfully shared")).catch(t=>console.error("Error sharing:",t)):navigator.clipboard.writeText(this.currentPageUrl).then(()=>alert("Link copied to clipboard!")).catch(t=>console.error("Error copying link:",t))}static \u0275fac=function(e){return new(e||n)(Be(jo))};static \u0275cmp=Ct({type:n,selectors:[["app-center-details"]],decls:5,vars:1,consts:[[1,"navbar"],[1,"main"],[4,"ngIf"],["id","pc",1,"item"],[1,"item-graphics"],[1,"item-media"],[1,"media-preview-column"],["class","preview-item",4,"ngFor","ngForOf"],[1,"media-large-view-column"],[1,"sharePage",3,"click"],[1,"fa-solid","fa-share-from-square"],[1,"large-view-item"],["alt","Large View","class","large-view-image",3,"src",4,"ngIf"],["controls","","autoplay","","class","large-view-video",3,"src",4,"ngIf"],[1,"item-button"],["id","wishlist","class","bookmarkbtn",3,"click",4,"ngIf"],[1,"item-details"],["id","edit",3,"click",4,"ngIf"],[1,"item-common-names"],[1,"center-type"],[1,"item-description"],[1,"item-header"],[1,"item-availability"],[1,"days-available"],[1,"item-instruments"],[1,"instruments-uses"],[4,"ngFor","ngForOf"],[1,"item-habitat"],[1,"item-contactNumber"],[1,"preview-item"],["alt","Modal Image",1,"preview-image",3,"click","src"],["src","https://th.bing.com/th/id/OIP.8_bri3mAg46YzGyic7aGuwHaHa?w=512&h=512&rs=1&pid=ImgDetMain","alt","image",1,"preview-image",3,"click"],["alt","Large View",1,"large-view-image",3,"src"],["controls","","autoplay","",1,"large-view-video",3,"src"],["id","wishlist",1,"bookmarkbtn",3,"click"],[1,"fa-solid","fa-heart",2,"color","#ff0000"],["class","spinner",4,"ngIf"],["class","fa-solid fa-lock","id","lock",4,"ngIf"],[1,"spinner"],["id","lock",1,"fa-solid","fa-lock"],["id","edit",3,"click"],[1,"fa-regular","fa-pen-to-square"]],template:function(e,r){e&1&&(E(0,"div",0),ce(1,"app-navbar"),S(),E(2,"div",1),Ne(3,USe,65,20,"div",2),ce(4,"app-footer"),S()),e&2&&(z(3),re("ngIf",r.gymDetails))},dependencies:[Xr,Kn,Ln,Er],styles:['.navbar[_ngcontent-%COMP%]{background-color:var(--dark)}.main[_ngcontent-%COMP%]{min-height:90vh;position:relative}.item[_ngcontent-%COMP%]{background-color:var(--shade-2);padding:10px;display:flex;margin:20px auto;width:95%;max-width:1500px;height:100vh;max-height:700px}.item-details[_ngcontent-%COMP%]{padding:12px;width:50%;max-height:700px;overflow:auto;scrollbar-width:none;font-size:larger;background-color:var(--dark);color:var(--light)}.item-details[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:var(--shade-1)}.item-details[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{padding-left:12px}.item-details[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-bottom:4px}.item-details[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:before{font-family:"Font Awesome 6 Free";font-weight:900;font-size:22px;content:"\\f0da";margin-right:6px}.item-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;background-color:var(--light-green);padding:5px;border-radius:4px;margin-top:8px;margin-bottom:10px}.item-common-names[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-weight:600}.item-graphics[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:50%}.item-button[_ngcontent-%COMP%]{display:flex;width:100%;justify-content:center}.item-button[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:300px;border:none;border-radius:6px;height:60px;font-size:20px;font-weight:600;margin:18px 12px;border:1px solid var(--shade-1);color:var(--shade-1);background-color:transparent;position:relative}.item-button[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:var(--shade-1);color:var(--dark)}#lock[_ngcontent-%COMP%]{color:#ff4000;position:absolute;top:-10px;z-index:3;right:5px}.item-media[_ngcontent-%COMP%]{display:flex}.media-preview-column[_ngcontent-%COMP%]{width:100px;display:flex;flex-direction:column}.preview-item[_ngcontent-%COMP%]{margin-bottom:10px;width:100px;height:80px}.preview-item[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:100%;object-fit:cover;width:100%}.preview-image[_ngcontent-%COMP%], .preview-video[_ngcontent-%COMP%]{width:100%;cursor:pointer}.media-large-view-column[_ngcontent-%COMP%]{width:calc(100% - 100px);padding:15px 15px 6px;display:flex;flex-direction:column;justify-content:center;align-items:center}.sharePage[_ngcontent-%COMP%]{border:none;outline:none;background:transparent;color:var(--shade-1);text-align:end;width:100%;font-size:26px}#large-view[_ngcontent-%COMP%]{width:400px;height:400px}.large-view-item[_ngcontent-%COMP%]{width:100%;height:auto;max-height:450px;display:flex;justify-content:center;align-items:center}.large-view-3dmodel[_ngcontent-%COMP%]{width:500px;height:auto;max-height:450px}.large-view-image[_ngcontent-%COMP%]{width:100%;height:100%}.large-view-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:100%}.large-view-video[_ngcontent-%COMP%]{width:100%;height:300px}.preview-item.selected[_ngcontent-%COMP%]{border:3px solid green}.item-name[_ngcontent-%COMP%]{font-size:larger;font-weight:600;color:#003c05}.spinner[_ngcontent-%COMP%]{width:24px;height:24px;border:4px solid #ccc;border-top-color:#007bff;border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}#note-button[_ngcontent-%COMP%]{border:none;outline:none;background-color:var(--light-green);color:var(--dark);font-size:larger;padding:10px;font-weight:600;position:fixed;right:-31px;top:50%;border-radius:6px 6px 0 0;transform:rotate(-90deg)}.modal[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#000e;display:flex;justify-content:center;align-items:center;z-index:3}.modal-content[_ngcontent-%COMP%]{max-width:600px;padding:12px}.modal-content[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border-radius:4px;border:none;outline:none;padding:4px 8px;margin-right:12px;font-size:large;font-weight:500}.modal-content[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{height:200px;max-height:200px;min-height:200px;width:100%;min-width:100%;max-width:100%;padding:12px;font-size:larger;font-weight:500}.language-selector[_ngcontent-%COMP%]{padding:10px 0}.language-selector[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{margin:0 8px;padding:2px}.language-selector[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border:none;outline:none;background-color:var(--dark);color:var(--light);padding:2px 12px;border-radius:4px}.modal[_ngcontent-%COMP%]{padding:18px}.modal-content[_ngcontent-%COMP%]{height:100%;width:100%;max-width:1600px;overflow:auto;padding:12px}.editForm[_ngcontent-%COMP%]{height:90%}.editInputs[_ngcontent-%COMP%]{display:flex;flex-direction:column}.deleteInput[_ngcontent-%COMP%]{display:flex;width:100%}#map[_ngcontent-%COMP%]{height:400px;width:100%;border:1px solid #ccc;border-radius:8px}#mobile[_ngcontent-%COMP%]{display:none}.show3D[_ngcontent-%COMP%]{border:none;outline:none;background-color:transparent;color:var(--dark);font-size:larger;font-weight:600;margin-bottom:18px}.model-popup[_ngcontent-%COMP%]{background-color:#000000e0;position:fixed;inset:0;display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:4}.model-viewer-popup[_ngcontent-%COMP%]{width:100%;max-width:700px;display:flex;flex-direction:column;justify-content:center;align-items:center;background-color:#fff;border-radius:6px;height:400px;padding:12px}.model-viewer-popup[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border:none;outline:none;background-color:transparent}#edit[_ngcontent-%COMP%]{border:none;outline:none;background-color:transparent;color:var(--light);font-size:large;font-weight:600;margin-bottom:18px}.notesContent[_ngcontent-%COMP%]{max-width:700px!important}.model-viewer-popup[_ngcontent-%COMP%]   model-viewer[_ngcontent-%COMP%]{width:100%;height:100%}@media (max-width: 550px){#mobile[_ngcontent-%COMP%]{display:flex!important;flex-direction:column}#pc[_ngcontent-%COMP%]{display:none}.item[_ngcontent-%COMP%]{flex-direction:column;width:100%;padding:12px;margin:0;overflow:auto;height:100vh;max-height:100vh}.item-graphics[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%}.item-media[_ngcontent-%COMP%]{display:flex;width:100%;flex-direction:column-reverse}.media-preview-column[_ngcontent-%COMP%]{display:flex;flex-direction:row;width:100%;overflow:auto;gap:16px;margin:18px 0}.media-large-view-column[_ngcontent-%COMP%]{width:100%}.preview-item[_ngcontent-%COMP%]{margin-right:16px}.item-details[_ngcontent-%COMP%]{width:100%;overflow:hidden}#note-button[_ngcontent-%COMP%]{display:none}.item-button[_ngcontent-%COMP%]{flex-direction:column;justify-content:center;align-items:center;gap:12px}#lock[_ngcontent-%COMP%]{display:none}.item-button[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}.item-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-wrap:wrap}}']})};function WSe(n,t){n&1&&(E(0,"div",6),O(1," No Gyms available. "),S())}function GSe(n,t){if(n&1){let e=et();E(0,"div",7)(1,"div",8),ce(2,"img",9),S(),E(3,"div",10)(4,"h5"),O(5),S(),E(6,"p",11),O(7),S(),E(8,"p",12),O(9),S(),E(10,"p",13),ce(11,"i",14),O(12),S()(),E(13,"div",15)(14,"p",16),O(15),S(),E(16,"button",17),_e("click",function(){let o=ve(e).$implicit,i=le();return be(i.viewDetails(o._id))}),O(17," View Details "),S()()()}if(n&2){let e=t.$implicit;z(2),re("src",e.images[0],di),z(3),Ye(e.centerName),z(2),Tt(" ",e.centerType," "),z(2),Tt("",e.availableInstruments.slice(0,2).join(", "),"..."),z(3),_a("\xA0",e.address,", ",e.city," "),z(3),Ye(e.daysAvailable.join(" - "))}}var cI=class n{gyms=[];email=localStorage.getItem("email");router=Q(Ut);authService=Q(xn);ngOnInit(){this.fetchGymCentres()}fetchGymCentres(){this.email&&this.authService.fetchWishlistItems(this.email).subscribe(t=>{this.gyms=t,console.log(t)},t=>{console.error(t)})}removeFromWishlist(t){}viewDetails(t){this.router.navigate(["/centerDetails/"+t])}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=Ct({type:n,selectors:[["app-wishlist"]],decls:10,vars:2,consts:[[1,"navbar"],[1,"main"],[1,"gym-container"],[1,"center"],["class","no-gyms",4,"ngIf"],["class","gym-card",4,"ngFor","ngForOf"],[1,"no-gyms"],[1,"gym-card"],[1,"gym-image"],["alt","Gym's Image",3,"src"],[1,"gym-details"],[1,"experience"],[1,"qualification"],[1,"location"],[1,"fa-solid","fa-location-dot"],[1,"gym-appointment"],[1,"availableDays"],[1,"bookAppointment",3,"click"]],template:function(e,r){e&1&&(E(0,"div",0),ce(1,"app-navbar"),S(),E(2,"div",1)(3,"div",2)(4,"div",3)(5,"h3"),O(6,"WISHLISTED ITEMS"),S()(),Ne(7,WSe,2,0,"div",4)(8,GSe,18,7,"div",5),S()(),ce(9,"app-footer")),e&2&&(z(7),re("ngIf",r.gyms.length===0),z(),re("ngForOf",r.gyms))},dependencies:[Xr,Kn,Ln,Er,Zg],styles:[".main[_ngcontent-%COMP%]{min-height:100vh;max-width:1350px;margin:25px auto;display:flex;color:var(--light)}.gym-container[_ngcontent-%COMP%]{width:100%;max-width:1000px;margin:0 auto}.form-filter[_ngcontent-%COMP%]{width:280px}.filter[_ngcontent-%COMP%]{margin-bottom:12px}.form-title[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;font-size:large;width:280px;font-weight:500;padding:8px 18px;background-color:var(--shade-2);border:1px solid var(--shade-1);color:var(--shade-1);border-radius:4px 4px 0 0;cursor:pointer}.form-title[_ngcontent-%COMP%]:hover{background-color:var(--shade-1);color:var(--dark)}.form-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:8px 18px;border:1px solid var(--shade-1);border-radius:0 0 4px 4px;max-height:180px;overflow-y:auto}.form-item[_ngcontent-%COMP%]{display:inline-flex;gap:8px}.clear[_ngcontent-%COMP%]{background-color:transparent;border:none;cursor:pointer;color:var(--light);padding:8px 18px;font-size:larger}.right-section[_ngcontent-%COMP%]{width:100%}.gym-card[_ngcontent-%COMP%]{padding:12px;border:1px solid var(--shade-1);border-radius:4px;margin:12px 0;width:100%;display:flex}.gym-image[_ngcontent-%COMP%]{width:200px;height:200px;object-fit:cover;background-color:var(--light);margin-right:18px}.gym-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.gym-details[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;letter-spacing:.06rem;gap:4px;width:450px;font-size:small;border-right:1.5px solid var(--shade-2);padding:0 12px}.gym-details[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0}.experience[_ngcontent-%COMP%]{padding:4px 8px;background-color:var(--shade-4);border-radius:4px;color:var(--shade-2);font-weight:600;width:max-content}.location[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:var(--shade-1)}.qualification[_ngcontent-%COMP%]{font-weight:600}.gym-appointment[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;width:40%}.availableDays[_ngcontent-%COMP%]{color:var(--shade-1);font-size:larger;font-weight:600}.bookAppointment[_ngcontent-%COMP%]{background-color:var(--shade-1);color:var(--dark);border:none;font-weight:600;border-radius:4px;padding:8px 16px;cursor:pointer}.bookAppointment[_ngcontent-%COMP%]:hover{background-color:#afce00}.center[_ngcontent-%COMP%]{text-align:center}"]})};function jSe(n,t){n&1&&(E(0,"div",6),O(1," No exercises available. "),S())}function HSe(n,t){if(n&1){let e=et();E(0,"div",7)(1,"div",8),ce(2,"img",9),S(),E(3,"div",10)(4,"h5"),O(5),S(),E(6,"p",11),O(7),S(),E(8,"p",12),O(9),S(),E(10,"span"),O(11),S()(),E(12,"div",13)(13,"button",14),_e("click",function(){let o=ve(e).$implicit,i=le();return be(i.viewDetails(o._id))}),O(14," View Details "),S()()()}if(n&2){let e=t.$implicit;z(2),re("src",e.images[0],di),z(3),Ye(e.exerciseName),z(2),Tt(" ",e.exerciseType," "),z(2),Tt("",e.equipments.slice(0,2).join(", "),"..."),z(2),Ye(e.exerciseCategory)}}var uI=class n{exercises=[];loading=!1;authService=Q(xn);notification=Q(Vn);router=Q(Ut);ngOnInit(){this.fetchExercises()}fetchExercises(){this.loading=!0,this.authService.fetchExercises().subscribe(t=>{this.exercises=t,this.loading=!1},t=>{this.notification.showNotification("Failed to fetch exercises","error"),this.loading=!1})}viewDetails(t){this.router.navigate(["/exerciseDetails/"+t])}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=Ct({type:n,selectors:[["app-exercises"]],decls:9,vars:2,consts:[[1,"navbar"],[1,"main"],[2,"text-align","center"],[1,"exercise-container"],["class","no-exercises",4,"ngIf"],["class","exercise-card",4,"ngFor","ngForOf"],[1,"no-exercises"],[1,"exercise-card"],[1,"exercise-image"],["alt","exercise's Image",3,"src"],[1,"exercise-details"],[1,"experience"],[1,"qualification"],[1,"exercise-appointment"],[1,"bookAppointment",3,"click"]],template:function(e,r){e&1&&(E(0,"div",0),ce(1,"app-navbar"),S(),E(2,"div",1)(3,"h3",2),O(4,"Exercises"),S(),E(5,"div",3),Ne(6,jSe,2,0,"div",4)(7,HSe,15,5,"div",5),S()(),ce(8,"app-footer")),e&2&&(z(6),re("ngIf",r.exercises.length===0),z(),re("ngForOf",r.exercises))},dependencies:[Xr,Kn,Ln,Er],styles:[".main[_ngcontent-%COMP%]{min-height:100vh;background-color:var(--shade-2);padding:16px;color:var(--light)}.exercise-container[_ngcontent-%COMP%]{width:100%;max-width:1000px;margin:0 auto}.form-filter[_ngcontent-%COMP%]{width:280px}.filter[_ngcontent-%COMP%]{margin-bottom:12px}.form-title[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;font-size:large;width:280px;font-weight:500;padding:8px 18px;background-color:var(--shade-2);border:1px solid var(--shade-1);color:var(--shade-1);border-radius:4px 4px 0 0;cursor:pointer}.form-title[_ngcontent-%COMP%]:hover{background-color:var(--shade-1);color:var(--dark)}.form-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:8px 18px;border:1px solid var(--shade-1);border-radius:0 0 4px 4px;max-height:180px;overflow-y:auto}.form-item[_ngcontent-%COMP%]{display:inline-flex;gap:8px}.clear[_ngcontent-%COMP%]{background-color:transparent;border:none;cursor:pointer;color:var(--light);padding:8px 18px;font-size:larger}.right-section[_ngcontent-%COMP%]{width:100%}.exercise-card[_ngcontent-%COMP%]{padding:12px;border:1px solid var(--shade-1);border-radius:4px;margin:12px 0;width:100%;display:flex}.exercise-image[_ngcontent-%COMP%]{width:200px;height:200px;object-fit:cover;background-color:var(--light);margin-right:18px}.exercise-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.exercise-details[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;letter-spacing:.06rem;gap:4px;width:450px;font-size:small;border-right:1.5px solid var(--shade-2);padding:0 12px}.exercise-details[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0}.experience[_ngcontent-%COMP%]{padding:4px 8px;background-color:var(--shade-4);border-radius:4px;color:var(--shade-2);font-weight:600;width:max-content}.location[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:var(--shade-1)}.qualification[_ngcontent-%COMP%]{font-weight:600}.exercise-appointment[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;width:40%}.availableDays[_ngcontent-%COMP%]{color:var(--shade-1);font-size:larger;font-weight:600}.bookAppointment[_ngcontent-%COMP%]{background-color:var(--shade-1);color:var(--dark);border:none;font-weight:600;border-radius:4px;padding:8px 16px;cursor:pointer}.bookAppointment[_ngcontent-%COMP%]:hover{background-color:#afce00}.center[_ngcontent-%COMP%]{text-align:center}"]})};var qSe=()=>[""];function KSe(n,t){if(n&1&&(E(0,"div",24),O(1),S()),n&2){let e=t.$implicit,r=le();Zu("today",e===r.today),z(),Tt(" ",e," ")}}function XSe(n,t){n&1&&(E(0,"div",25),O(1," You must be logged in to access the community. "),S())}function YSe(n,t){if(n&1&&(E(0,"span"),O(1),S()),n&2){let e=le().$implicit;z(),Tt("",e.likes.length," Likes")}}function ZSe(n,t){if(n&1){let e=et();E(0,"span",46),_e("click",function(){ve(e);let o=le().$implicit,i=le(2);return be(i.toggleComments(o._id))}),O(1),S()}if(n&2){let e=le().$implicit;z(),Tt("",e.comments.length+e.comments.length," Comments")}}function QSe(n,t){n&1&&(E(0,"span"),ce(1,"i",47),O(2,"\xA0\xA0Like"),S())}function JSe(n,t){n&1&&(E(0,"span",48),ce(1,"i",49),O(2,"\xA0\xA0Like"),S())}function eIe(n,t){if(n&1){let e=et();E(0,"div",50)(1,"input",51),ht("ngModelChange",function(o){ve(e);let i=le(3);return gt(i.commentText,o)||(i.commentText=o),be(o)}),S(),E(2,"button",28),_e("click",function(){ve(e);let o=le().$implicit,i=le(2);return be(i.postComment(o._id,null))}),O(3,"Comment"),S()()}if(n&2){let e=le(3);z(),ft("ngModel",e.commentText)}}function tIe(n,t){if(n&1&&(E(0,"div",58),ce(1,"div",59),E(2,"div",60)(3,"p")(4,"strong"),O(5),S(),O(6),S()()()),n&2){let e=t.$implicit;z(5),Ye(e.author.userName),z(),Tt(": ",e.content,"")}}function nIe(n,t){if(n&1&&(E(0,"div",56),Ne(1,tIe,7,2,"div",57),S()),n&2){let e=le().$implicit;z(),re("ngForOf",e.replies)}}function rIe(n,t){if(n&1){let e=et();E(0,"div",61)(1,"input",62),ht("ngModelChange",function(o){ve(e);let i=le(4);return gt(i.commentText,o)||(i.commentText=o),be(o)}),S(),E(2,"button",28),_e("click",function(){ve(e);let o=le().$implicit,i=le().$implicit,s=le(2);return be(s.postComment(i._id,o._id))}),O(3,"Reply"),S()()}if(n&2){let e=le(4);z(),ft("ngModel",e.commentText)}}function oIe(n,t){if(n&1){let e=et();E(0,"div",52)(1,"p")(2,"strong"),O(3),S(),O(4),S(),E(5,"div",53)(6,"button",28),_e("click",function(){let o=ve(e).$implicit,i=le(3);return be(i.likeComment(o._id))}),O(7),S(),E(8,"button",28),_e("click",function(){let o=ve(e).$implicit,i=le(3);return be(i.startReplying(o._id))}),O(9,"Reply"),S(),E(10,"button",28),_e("click",function(){let o=ve(e).$implicit,i=le(3);return be(i.deleteComment(o._id))}),O(11,"Delete"),S()(),Ne(12,nIe,2,1,"div",54)(13,rIe,4,1,"div",55),S()}if(n&2){let e=t.$implicit,r=le(3);z(3),Ye(e.userName),z(),Tt(": ",e.content," "),z(3),Tt("Like (",e.likes.length,")"),z(5),re("ngIf",e.replies&&e.replies.length>0),z(),re("ngIf",r.replyingTo===e._id)}}function iIe(n,t){if(n&1){let e=et();E(0,"div",31)(1,"p")(2,"strong"),O(3),S(),O(4," \xA0"),E(5,"span"),O(6),S()(),E(7,"p",32),O(8),S(),E(9,"p",33),O(10),S(),E(11,"div",34),Ne(12,YSe,2,1,"span",17)(13,ZSe,2,1,"span",35),S(),E(14,"div",36)(15,"button",37),_e("click",function(){let o=ve(e).$implicit,i=le(2);return be(i.likePost(o._id))}),Ne(16,QSe,3,0,"span",17)(17,JSe,3,0,"span",38),S(),E(18,"button",39),ce(19,"i",40),O(20,"\xA0\xA0Repost"),S(),E(21,"button",37),_e("click",function(){let o=ve(e).$implicit,i=le(2);return be(i.toggleCommentInput(o._id))}),ce(22,"i",41),O(23,"\xA0\xA0Comment "),S(),E(24,"button",39),ce(25,"i",42),O(26,"\xA0\xA0Share"),S(),E(27,"button",37),_e("click",function(){let o=ve(e).$implicit,i=le(2);return be(i.deletePost(o._id))}),ce(28,"i",43),O(29,"\xA0\xA0Delete Post"),S()(),Ne(30,eIe,4,1,"div",44)(31,oIe,14,5,"div",45),S()}if(n&2){let e=t.$implicit,r=le(2);z(3),Ye(e.author.userName),z(3),Ye(r.timeAgo(e.createdAt)),z(2),Ye(e.userType),z(2),Ye(e.content),z(2),re("ngIf",e.likes.length>0),z(),re("ngIf",e.comments.length>0),z(3),re("ngIf",!e.likes.includes(r.userId)),z(),re("ngIf",e.likes.includes(r.userId)),z(13),re("ngIf",r.commentInputVisible[e._id]),z(),re("ngForOf",e.comments)}}function sIe(n,t){if(n&1){let e=et();E(0,"div")(1,"div",26)(2,"textarea",27),ht("ngModelChange",function(o){ve(e);let i=le();return gt(i.newPostContent,o)||(i.newPostContent=o),be(o)}),S(),E(3,"button",28),_e("click",function(){ve(e);let o=le();return be(o.addPost())}),ce(4,"i",29),S()(),Ne(5,iIe,32,10,"div",30),S()}if(n&2){let e=le();z(2),ft("ngModel",e.newPostContent),z(3),re("ngForOf",e.posts)}}var dI=class n{posts=[];newPostContent="";userType="";userId=localStorage.getItem("userId");email=localStorage.getItem("email");userName=localStorage.getItem("userName");commentText="";replyingTo=null;commentInputVisible={};commentsVisible={};currentDate=new Date;days=[];month;year;firstDay;today;authService=Q(xn);ngOnInit(){localStorage.getItem("isAdmin")?this.userType="Admin":localStorage.getItem("isFitnessCenter")?this.userType="Fitness Center":this.userType="User",this.fetchPosts(),this.generateCalendar()}toggleCommentInput(t){this.commentInputVisible[t]=!this.commentInputVisible[t]}toggleComments(t){this.commentsVisible[t]=!this.commentsVisible[t]}fetchPosts(){this.authService.fetchPosts().subscribe(t=>{this.posts=t})}addPost(){if(!this.userId){alert("You must be logged in to post.");return}this.email&&this.authService.createPost(this.userId,this.newPostContent,this.userType,this.email).subscribe(()=>{this.fetchPosts(),this.newPostContent=""})}likePost(t){this.userId&&this.authService.likePost(t,this.userId).subscribe(()=>{this.fetchPosts()})}postComment(t,e=null){this.commentText.trim()&&(console.log(t,this.commentText,this.userId,this.userType,this.email,e),this.userId&&this.userType&&this.email&&this.authService.commentPost(t,this.commentText,this.userId,this.userType,this.email,e??"").subscribe(()=>{this.commentText="",this.replyingTo=null,this.fetchPosts()}))}likeComment(t){this.userId&&this.authService.likeComment(t,this.userId).subscribe(()=>{this.fetchPosts()})}startReplying(t){this.replyingTo=t}deletePost(t){confirm("Are you sure you want to delete this post?")&&this.authService.deletePost(t).subscribe(()=>{this.fetchPosts()})}deleteComment(t){confirm("Are you sure you want to delete this comment?")&&this.authService.deleteComment(t).subscribe(()=>{this.fetchPosts()})}generateCalendar(){let t=new Date;this.month=t.toLocaleString("default",{month:"long"}),this.year=t.getFullYear(),this.today=t.getDate();let e=new Date(this.year,t.getMonth(),1);this.firstDay=e.getDay();let r=new Date(this.year,t.getMonth()+1,0).getDate();this.days=Array.from({length:r},(o,i)=>i+1)}timeAgo(t){let e=new Date,r=new Date(t),o=Math.floor((e.getTime()-r.getTime())/1e3);if(o<60)return"Just Now";let i=Math.floor(o/60);if(i<60)return`${i} min${i>1?"s":""} ago`;let s=Math.floor(i/60);if(s<24)return`${s} hour${s>1?"s":""} ago`;let a=Math.floor(s/24);return`${a} day${a>1?"s":""} ago`}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=Ct({type:n,selectors:[["app-community"]],decls:34,vars:8,consts:[[1,"main"],[1,"outer-glass"],[1,"left"],[1,"logo"],[3,"routerLink"],[2,"color","#fff"],[2,"color","var(--shade-1)"],[1,"menu"],[1,"welcome"],[1,"calendar"],[1,"month-header"],[1,"days-container"],["class","day",3,"today",4,"ngFor","ngForOf"],[1,"middle"],[1,"heading"],[1,"posts"],["class","alert alert-warning",4,"ngIf"],[4,"ngIf"],[1,"right"],[1,"inner-glass"],["id","sh1",1,"shape1"],["id","sh2",1,"shape1"],["id","sh3",1,"shape1"],["id","sh4",1,"shape1"],[1,"day"],[1,"alert","alert-warning"],[1,"create-post"],["placeholder","Write your post here...",3,"ngModelChange","ngModel"],[3,"click"],[1,"fa-solid","fa-plus"],["class","post",4,"ngFor","ngForOf"],[1,"post"],[1,"highlighted"],[1,"content"],[1,"post-info"],["class","clickable",3,"click",4,"ngIf"],[1,"post-buttons"],[1,"post-button",3,"click"],["style","color: #ff0000;",4,"ngIf"],[1,"post-button"],[1,"fa-solid","fa-repeat"],[1,"fa-regular","fa-comment-dots"],[1,"fa-solid","fa-paper-plane"],[1,"fa-solid","fa-trash"],["class","comment",4,"ngIf"],["class","comment-container",4,"ngFor","ngForOf"],[1,"clickable",3,"click"],[1,"fa-regular","fa-heart"],[2,"color","#ff0000"],[1,"fa-solid","fa-heart"],[1,"comment"],["type","text","placeholder","Write a comment...",3,"ngModelChange","ngModel"],[1,"comment-container"],[1,"comment-actions"],["class","replies",4,"ngIf"],["class","reply-input",4,"ngIf"],[1,"replies"],["class","reply",4,"ngFor","ngForOf"],[1,"reply"],[1,"reply-line"],[1,"reply-content"],[1,"reply-input"],["type","text","placeholder","Write a reply...",3,"ngModelChange","ngModel"]],template:function(e,r){e&1&&(E(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"a",4)(5,"span",5)(6,"span",6),O(7,"FIT"),S(),O(8,"GENIE"),S()()(),E(9,"div",7)(10,"div",8)(11,"span"),O(12,"Welcome,"),ce(13,"br"),E(14,"span",6),O(15),S()()(),E(16,"div",9)(17,"div",10),O(18),S(),E(19,"div",11),Ne(20,KSe,2,3,"div",12),S()()()(),E(21,"div",13)(22,"h1",14),O(23,"Community"),S(),E(24,"div",15),Ne(25,XSe,2,0,"div",16)(26,sIe,6,2,"div",17),S()(),ce(27,"div",18),S(),E(28,"div",19),ce(29,"div",20)(30,"div",21)(31,"div",22)(32,"div",23),S()(),ce(33,"app-footer")),e&2&&(z(4),re("routerLink",Fi(7,qSe)),z(11),Ye(r.userName),z(3),_a("",r.month," ",r.year,""),z(2),re("ngForOf",r.days),z(5),re("ngIf",!r.userId),z(),re("ngIf",r.userId))},dependencies:[Ln,Er,Fs,vo,Ho,ka,Ls,Kn,Li],styles:[".main[_ngcontent-%COMP%]{min-height:90vh;display:flex;position:relative;justify-content:center;color:var(--light)}.logo[_ngcontent-%COMP%]{font-size:25px;font-weight:600;margin:20px 20px 30px;color:var(--light)}.welcome[_ngcontent-%COMP%]{color:var(--light)}.left[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;width:260px;background-color:var(--shade-2)}.menu[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:18px}.menu[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:flex;text-align:left;align-items:center;white-space:nowrap;font-size:larger;font-weight:500;color:var(--light);cursor:pointer;margin-bottom:18px}.menu[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0}.left[_ngcontent-%COMP%]   hr[_ngcontent-%COMP%]{width:100%;background-color:#e7e7e7;height:2px}.welcome[_ngcontent-%COMP%]{text-align:center;margin-bottom:18px}.welcome[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:600;color:var(--shade-4);font-size:20px}.heading[_ngcontent-%COMP%]{padding:10px 18px;background-color:var(--shade-2);text-align:center;border-radius:4px;color:var(--light);font-weight:600;font-size:larger;width:100%}.outer-glass[_ngcontent-%COMP%]{width:100%;background-color:#000000dc;-webkit-backdrop-filter:blur(50px);backdrop-filter:blur(50px);z-index:1;display:flex}.inner-glass[_ngcontent-%COMP%]{position:absolute;inset:0;z-index:0;width:100%;max-width:1500px;overflow:hidden}.shape1[_ngcontent-%COMP%]{width:300px;height:300px;border-radius:50%;position:absolute}#sh1[_ngcontent-%COMP%]{background-color:#ddff00b4;top:50%;left:30%;animation:_ngcontent-%COMP%_one 12s infinite ease-in-out}@keyframes _ngcontent-%COMP%_one{0%{top:10%;left:10%}25%{top:70%;left:30%}50%{top:40%;left:80%}75%{top:20%;left:50%}to{top:80%;left:10%}}#sh2[_ngcontent-%COMP%]{background-color:#ffd000;top:20%;left:60%;animation:_ngcontent-%COMP%_two 10s infinite ease-in-out}@keyframes _ngcontent-%COMP%_two{0%{top:30%;left:60%}25%{top:50%;left:20%}50%{top:70%;left:80%}75%{top:10%;left:40%}to{top:60%;left:10%}}#sh3[_ngcontent-%COMP%]{background-color:#bac700;top:20%;left:10%;animation:_ngcontent-%COMP%_three 13s infinite ease-in-out}@keyframes _ngcontent-%COMP%_three{0%{top:20%;left:10%}25%{top:60%;left:70%}50%{top:80%;left:30%}75%{top:30%;left:90%}to{top:50%;left:10%}}.middle[_ngcontent-%COMP%]{width:calc(100% - 260px);padding:18px;display:flex;flex-direction:column;align-items:center}.calendar[_ngcontent-%COMP%]{width:225px;border:2px solid var(--light);border-radius:5px;padding:10px;text-align:center;font-family:Arial,sans-serif;background:var(--shade-3)}.month-header[_ngcontent-%COMP%]{font-weight:700;font-size:16px;margin-bottom:10px}.days-container[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(7,1fr);gap:5px}.day[_ngcontent-%COMP%]{width:25px;height:25px;line-height:25px;border-radius:50%;text-align:center}.today[_ngcontent-%COMP%]{background:var(--shade-1);color:var(--dark);font-weight:700}.posts[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%;max-width:750px}.create-post[_ngcontent-%COMP%]{background-color:var(--shade-2);padding:12px;border-radius:8px;display:flex;align-items:center;gap:8px}.create-post[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{width:100%;padding:12px;border:none;resize:none;background:transparent;color:var(--light)}.create-post[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:6px 18px;border:none;background-color:var(--shade-1);color:var(--dark);border-radius:8px;cursor:pointer;height:max-content;font-weight:600;font-size:larger}.post[_ngcontent-%COMP%]{margin:16px 0;border-radius:8px;padding:12px;background-color:var(--shade-2)}.post[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0}.post-buttons[_ngcontent-%COMP%]{display:flex;width:100%;justify-content:space-around;padding:6px 0}.post-button[_ngcontent-%COMP%]{background-color:transparent;border:none;color:var(--light)}.content[_ngcontent-%COMP%]{margin:12px 0!important;padding-left:8px;border-left:2px solid var(--shade-1)}.highlighted[_ngcontent-%COMP%]{background-color:#ffffff27;padding:2px 4px;width:max-content;border-radius:3px;font-weight:600;color:var(--light)}.post-info[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-top:8px;border-bottom:1px solid #3e3e3e;padding:6px 0}.comments[_ngcontent-%COMP%]{margin-top:10px;padding-left:15px;border-left:2px solid #ccc}.comment-container[_ngcontent-%COMP%]{margin-bottom:15px;padding-left:10px;border-left:2px solid #ccc}.comment-actions[_ngcontent-%COMP%]{display:flex;gap:10px;font-size:12px}.replies[_ngcontent-%COMP%]{margin-left:20px;padding-left:10px;border-left:2px solid #aaa}.reply[_ngcontent-%COMP%]{display:flex;align-items:center}.reply-line[_ngcontent-%COMP%]{width:2px;height:100%;background-color:#aaa;margin-right:10px}.reply-content[_ngcontent-%COMP%]{background:#f9f9f9;padding:5px 10px;border-radius:5px}.reply-input[_ngcontent-%COMP%]{margin-left:20px;display:flex;gap:10px}.clickable[_ngcontent-%COMP%]{cursor:pointer}.clickable[_ngcontent-%COMP%]:hover{text-decoration:underline;color:#7ea7ff}"]})};function pI(n,t=0){return aIe(n)?Number(n):arguments.length===2?t:0}function aIe(n){return!isNaN(parseFloat(n))&&!isNaN(Number(n))}function iP(n){return Array.isArray(n)?n:[n]}function Gr(n){return n==null?"":typeof n=="string"?n:`${n}px`}function my(n){return n instanceof hr?n.nativeElement:n}var aP;try{aP=typeof Intl<"u"&&Intl.v8BreakIterator}catch{aP=!1}var ps=(()=>{class n{_platformId=Q(lc);isBrowser=this._platformId?xW(this._platformId):typeof document=="object"&&!!document;EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent);TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent);BLINK=this.isBrowser&&!!(window.chrome||aP)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT;WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT;IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window);FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent);ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT;SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT;constructor(){}static \u0275fac=function(r){return new(r||n)};static \u0275prov=Me({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var lb;function lIe(){if(lb==null&&typeof window<"u")try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>lb=!0}))}finally{lb=lb||!1}return lb}function lP(n){return lIe()?n:!!n.capture}var Wh;function cP(){if(Wh==null){if(typeof document!="object"||!document||typeof Element!="function"||!Element)return Wh=!1,Wh;if("scrollBehavior"in document.documentElement.style)Wh=!0;else{let n=Element.prototype.scrollTo;n?Wh=!/\{\s*\[native code\]\s*\}/.test(n.toString()):Wh=!1}}return Wh}var sP;function cIe(){if(sP==null){let n=typeof document<"u"?document.head:null;sP=!!(n&&(n.createShadowRoot||n.attachShadow))}return sP}function jH(n){if(cIe()){let t=n.getRootNode?n.getRootNode():null;if(typeof ShadowRoot<"u"&&ShadowRoot&&t instanceof ShadowRoot)return t}return null}function cb(){let n=typeof document<"u"&&document?document.activeElement:null;for(;n&&n.shadowRoot;){let t=n.shadowRoot.activeElement;if(t===n)break;n=t}return n}function hd(n){return n.composedPath?n.composedPath()[0]:n.target}function uP(){return typeof __karma__<"u"&&!!__karma__||typeof jasmine<"u"&&!!jasmine||typeof jest<"u"&&!!jest||typeof Mocha<"u"&&!!Mocha}var uIe=new Ge("cdk-dir-doc",{providedIn:"root",factory:dIe});function dIe(){return Q(fn)}var pIe=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;function fIe(n){let t=n?.toLowerCase()||"";return t==="auto"&&typeof navigator<"u"&&navigator?.language?pIe.test(navigator.language)?"rtl":"ltr":t==="rtl"?"rtl":"ltr"}var ub=(()=>{class n{value="ltr";change=new Un;constructor(){let e=Q(uIe,{optional:!0});if(e){let r=e.body?e.body.dir:null,o=e.documentElement?e.documentElement.dir:null;this.value=fIe(r||o||"ltr")}}ngOnDestroy(){this.change.complete()}static \u0275fac=function(r){return new(r||n)};static \u0275prov=Me({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var hIe=20,HH=(()=>{class n{_ngZone=Q(ln);_platform=Q(ps);_renderer=Q(Ns).createRenderer(null,null);_cleanupGlobalListener;constructor(){}_scrolled=new zt;_scrolledCount=0;scrollContainers=new Map;register(e){this.scrollContainers.has(e)||this.scrollContainers.set(e,e.elementScrolled().subscribe(()=>this._scrolled.next(e)))}deregister(e){let r=this.scrollContainers.get(e);r&&(r.unsubscribe(),this.scrollContainers.delete(e))}scrolled(e=hIe){return this._platform.isBrowser?new on(r=>{this._cleanupGlobalListener||(this._cleanupGlobalListener=this._ngZone.runOutsideAngular(()=>this._renderer.listen("document","scroll",()=>this._scrolled.next())));let o=e>0?this._scrolled.pipe(OC(e)).subscribe(r):this._scrolled.subscribe(r);return this._scrolledCount++,()=>{o.unsubscribe(),this._scrolledCount--,this._scrolledCount||(this._cleanupGlobalListener?.(),this._cleanupGlobalListener=void 0)}}):ct()}ngOnDestroy(){this._cleanupGlobalListener?.(),this._cleanupGlobalListener=void 0,this.scrollContainers.forEach((e,r)=>this.deregister(r)),this._scrolled.complete()}ancestorScrolled(e,r){let o=this.getAncestorScrollContainers(e);return this.scrolled(r).pipe(fr(i=>!i||o.indexOf(i)>-1))}getAncestorScrollContainers(e){let r=[];return this.scrollContainers.forEach((o,i)=>{this._scrollableContainsElement(i,e)&&r.push(i)}),r}_scrollableContainsElement(e,r){let o=my(r),i=e.getElementRef().nativeElement;do if(o==i)return!0;while(o=o.parentElement);return!1}static \u0275fac=function(r){return new(r||n)};static \u0275prov=Me({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var mIe=20,dP=(()=>{class n{_platform=Q(ps);_listeners;_viewportSize;_change=new zt;_document=Q(fn,{optional:!0});constructor(){let e=Q(ln),r=Q(Ns).createRenderer(null,null);e.runOutsideAngular(()=>{if(this._platform.isBrowser){let o=i=>this._change.next(i);this._listeners=[r.listen("window","resize",o),r.listen("window","orientationchange",o)]}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){this._listeners?.forEach(e=>e()),this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();let e={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),e}getViewportRect(){let e=this.getViewportScrollPosition(),{width:r,height:o}=this.getViewportSize();return{top:e.top,left:e.left,bottom:e.top+o,right:e.left+r,height:o,width:r}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};let e=this._document,r=this._getWindow(),o=e.documentElement,i=o.getBoundingClientRect(),s=-i.top||e.body.scrollTop||r.scrollY||o.scrollTop||0,a=-i.left||e.body.scrollLeft||r.scrollX||o.scrollLeft||0;return{top:s,left:a}}change(e=mIe){return e>0?this._change.pipe(OC(e)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){let e=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:e.innerWidth,height:e.innerHeight}:{width:0,height:0}}static \u0275fac=function(r){return new(r||n)};static \u0275prov=Me({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var db=class{_attachedHost;attach(t){return this._attachedHost=t,t.attach(this)}detach(){let t=this._attachedHost;t!=null&&(this._attachedHost=null,t.detach())}get isAttached(){return this._attachedHost!=null}setAttachedHost(t){this._attachedHost=t}},gy=class extends db{component;viewContainerRef;injector;componentFactoryResolver;projectableNodes;constructor(t,e,r,o,i){super(),this.component=t,this.viewContainerRef=e,this.injector=r,this.projectableNodes=i}},yy=class extends db{templateRef;viewContainerRef;context;injector;constructor(t,e,r,o){super(),this.templateRef=t,this.viewContainerRef=e,this.context=r,this.injector=o}get origin(){return this.templateRef.elementRef}attach(t,e=this.context){return this.context=e,super.attach(t)}detach(){return this.context=void 0,super.detach()}},pP=class extends db{element;constructor(t){super(),this.element=t instanceof hr?t.nativeElement:t}},xy=class{_attachedPortal;_disposeFn;_isDisposed=!1;hasAttached(){return!!this._attachedPortal}attach(t){if(t instanceof gy)return this._attachedPortal=t,this.attachComponentPortal(t);if(t instanceof yy)return this._attachedPortal=t,this.attachTemplatePortal(t);if(this.attachDomPortal&&t instanceof pP)return this._attachedPortal=t,this.attachDomPortal(t)}attachDomPortal=null;detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(t){this._disposeFn=t}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}};var fI=class extends xy{outletElement;_appRef;_defaultInjector;_document;constructor(t,e,r,o,i){super(),this.outletElement=t,this._appRef=r,this._defaultInjector=o,this._document=i}attachComponentPortal(t){let e;if(t.viewContainerRef){let r=t.injector||t.viewContainerRef.injector,o=r.get(ga,null,{optional:!0})||void 0;e=t.viewContainerRef.createComponent(t.component,{index:t.viewContainerRef.length,injector:r,ngModuleRef:o,projectableNodes:t.projectableNodes||void 0}),this.setDisposeFn(()=>e.destroy())}else e=B_(t.component,{elementInjector:t.injector||this._defaultInjector||qn.NULL,environmentInjector:this._appRef.injector,projectableNodes:t.projectableNodes||void 0}),this._appRef.attachView(e.hostView),this.setDisposeFn(()=>{this._appRef.viewCount>0&&this._appRef.detachView(e.hostView),e.destroy()});return this.outletElement.appendChild(this._getComponentRootNode(e)),this._attachedPortal=t,e}attachTemplatePortal(t){let e=t.viewContainerRef,r=e.createEmbeddedView(t.templateRef,t.context,{injector:t.injector});return r.rootNodes.forEach(o=>this.outletElement.appendChild(o)),r.detectChanges(),this.setDisposeFn(()=>{let o=e.indexOf(r);o!==-1&&e.remove(o)}),this._attachedPortal=t,r}attachDomPortal=t=>{let e=t.element;e.parentNode;let r=this._document.createComment("dom-portal");e.parentNode.insertBefore(r,e),this.outletElement.appendChild(e),this._attachedPortal=t,super.setDisposeFn(()=>{r.parentNode&&r.parentNode.replaceChild(e,r)})};dispose(){super.dispose(),this.outletElement.remove()}_getComponentRootNode(t){return t.hostView.rootNodes[0]}};var pb=(()=>{class n extends xy{_moduleRef=Q(ga,{optional:!0});_document=Q(fn);_viewContainerRef=Q(Rs);_isInitialized=!1;_attachedRef;constructor(){super()}get portal(){return this._attachedPortal}set portal(e){this.hasAttached()&&!e&&!this._isInitialized||(this.hasAttached()&&super.detach(),e&&super.attach(e),this._attachedPortal=e||null)}attached=new Un;get attachedRef(){return this._attachedRef}ngOnInit(){this._isInitialized=!0}ngOnDestroy(){super.dispose(),this._attachedRef=this._attachedPortal=null}attachComponentPortal(e){e.setAttachedHost(this);let r=e.viewContainerRef!=null?e.viewContainerRef:this._viewContainerRef,o=r.createComponent(e.component,{index:r.length,injector:e.injector||r.injector,projectableNodes:e.projectableNodes||void 0,ngModuleRef:this._moduleRef||void 0});return r!==this._viewContainerRef&&this._getRootNode().appendChild(o.hostView.rootNodes[0]),super.setDisposeFn(()=>o.destroy()),this._attachedPortal=e,this._attachedRef=o,this.attached.emit(o),o}attachTemplatePortal(e){e.setAttachedHost(this);let r=this._viewContainerRef.createEmbeddedView(e.templateRef,e.context,{injector:e.injector});return super.setDisposeFn(()=>this._viewContainerRef.clear()),this._attachedPortal=e,this._attachedRef=r,this.attached.emit(r),r}attachDomPortal=e=>{let r=e.element;r.parentNode;let o=this._document.createComment("dom-portal");e.setAttachedHost(this),r.parentNode.insertBefore(o,r),this._getRootNode().appendChild(r),this._attachedPortal=e,super.setDisposeFn(()=>{o.parentNode&&o.parentNode.replaceChild(r,o)})};_getRootNode(){let e=this._viewContainerRef.element.nativeElement;return e.nodeType===e.ELEMENT_NODE?e:e.parentNode}static \u0275fac=function(r){return new(r||n)};static \u0275dir=yn({type:n,selectors:[["","cdkPortalOutlet",""]],inputs:{portal:[0,"cdkPortalOutlet","portal"]},outputs:{attached:"attached"},exportAs:["cdkPortalOutlet"],features:[Or]})}return n})();var hI=new WeakMap,fb=(()=>{class n{_appRef;_injector=Q(qn);_environmentInjector=Q(lo);load(e){let r=this._appRef=this._appRef||this._injector.get(cs),o=hI.get(r);o||(o={loaders:new Set,refs:[]},hI.set(r,o),r.onDestroy(()=>{hI.get(r)?.refs.forEach(i=>i.destroy()),hI.delete(r)})),o.loaders.has(e)||(o.loaders.add(e),o.refs.push(B_(e,{environmentInjector:this._environmentInjector})))}static \u0275fac=function(r){return new(r||n)};static \u0275prov=Me({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),qH=(()=>{class n{static \u0275fac=function(r){return new(r||n)};static \u0275cmp=Ct({type:n,selectors:[["ng-component"]],exportAs:["cdkVisuallyHidden"],decls:0,vars:0,template:function(r,o){},styles:[".cdk-visually-hidden{border:0;clip:rect(0 0 0 0);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px;white-space:nowrap;outline:0;-webkit-appearance:none;-moz-appearance:none;left:0}[dir=rtl] .cdk-visually-hidden{left:auto;right:0}"],encapsulation:2,changeDetection:0})}return n})();function mI(n,...t){return t.length?t.some(e=>n[e]):n.altKey||n.shiftKey||n.ctrlKey||n.metaKey}var mP=(()=>{class n{_platform=Q(ps);constructor(){}isDisabled(e){return e.hasAttribute("disabled")}isVisible(e){return yIe(e)&&getComputedStyle(e).visibility==="visible"}isTabbable(e){if(!this._platform.isBrowser)return!1;let r=gIe(IIe(e));if(r&&(KH(r)===-1||!this.isVisible(r)))return!1;let o=e.nodeName.toLowerCase(),i=KH(e);return e.hasAttribute("contenteditable")?i!==-1:o==="iframe"||o==="object"||this._platform.WEBKIT&&this._platform.IOS&&!_Ie(e)?!1:o==="audio"?e.hasAttribute("controls")?i!==-1:!1:o==="video"?i===-1?!1:i!==null?!0:this._platform.FIREFOX||e.hasAttribute("controls"):e.tabIndex>=0}isFocusable(e,r){return SIe(e)&&!this.isDisabled(e)&&(r?.ignoreVisibility||this.isVisible(e))}static \u0275fac=function(r){return new(r||n)};static \u0275prov=Me({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function gIe(n){try{return n.frameElement}catch{return null}}function yIe(n){return!!(n.offsetWidth||n.offsetHeight||typeof n.getClientRects=="function"&&n.getClientRects().length)}function xIe(n){let t=n.nodeName.toLowerCase();return t==="input"||t==="select"||t==="button"||t==="textarea"}function vIe(n){return wIe(n)&&n.type=="hidden"}function bIe(n){return CIe(n)&&n.hasAttribute("href")}function wIe(n){return n.nodeName.toLowerCase()=="input"}function CIe(n){return n.nodeName.toLowerCase()=="a"}function XH(n){if(!n.hasAttribute("tabindex")||n.tabIndex===void 0)return!1;let t=n.getAttribute("tabindex");return!!(t&&!isNaN(parseInt(t,10)))}function KH(n){if(!XH(n))return null;let t=parseInt(n.getAttribute("tabindex")||"",10);return isNaN(t)?-1:t}function _Ie(n){let t=n.nodeName.toLowerCase(),e=t==="input"&&n.type;return e==="text"||e==="password"||t==="select"||t==="textarea"}function SIe(n){return vIe(n)?!1:xIe(n)||bIe(n)||n.hasAttribute("contenteditable")||XH(n)}function IIe(n){return n.ownerDocument&&n.ownerDocument.defaultView||window}var hP=class{_element;_checker;_ngZone;_document;_injector;_startAnchor;_endAnchor;_hasAttached=!1;startAnchorListener=()=>this.focusLastTabbableElement();endAnchorListener=()=>this.focusFirstTabbableElement();get enabled(){return this._enabled}set enabled(t){this._enabled=t,this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(t,this._startAnchor),this._toggleAnchorTabIndex(t,this._endAnchor))}_enabled=!0;constructor(t,e,r,o,i=!1,s){this._element=t,this._checker=e,this._ngZone=r,this._document=o,this._injector=s,i||this.attachAnchors()}destroy(){let t=this._startAnchor,e=this._endAnchor;t&&(t.removeEventListener("focus",this.startAnchorListener),t.remove()),e&&(e.removeEventListener("focus",this.endAnchorListener),e.remove()),this._startAnchor=this._endAnchor=null,this._hasAttached=!1}attachAnchors(){return this._hasAttached?!0:(this._ngZone.runOutsideAngular(()=>{this._startAnchor||(this._startAnchor=this._createAnchor(),this._startAnchor.addEventListener("focus",this.startAnchorListener)),this._endAnchor||(this._endAnchor=this._createAnchor(),this._endAnchor.addEventListener("focus",this.endAnchorListener))}),this._element.parentNode&&(this._element.parentNode.insertBefore(this._startAnchor,this._element),this._element.parentNode.insertBefore(this._endAnchor,this._element.nextSibling),this._hasAttached=!0),this._hasAttached)}focusInitialElementWhenReady(t){return new Promise(e=>{this._executeOnStable(()=>e(this.focusInitialElement(t)))})}focusFirstTabbableElementWhenReady(t){return new Promise(e=>{this._executeOnStable(()=>e(this.focusFirstTabbableElement(t)))})}focusLastTabbableElementWhenReady(t){return new Promise(e=>{this._executeOnStable(()=>e(this.focusLastTabbableElement(t)))})}_getRegionBoundary(t){let e=this._element.querySelectorAll(`[cdk-focus-region-${t}], [cdkFocusRegion${t}], [cdk-focus-${t}]`);return t=="start"?e.length?e[0]:this._getFirstTabbableElement(this._element):e.length?e[e.length-1]:this._getLastTabbableElement(this._element)}focusInitialElement(t){let e=this._element.querySelector("[cdk-focus-initial], [cdkFocusInitial]");if(e){if(!this._checker.isFocusable(e)){let r=this._getFirstTabbableElement(e);return r?.focus(t),!!r}return e.focus(t),!0}return this.focusFirstTabbableElement(t)}focusFirstTabbableElement(t){let e=this._getRegionBoundary("start");return e&&e.focus(t),!!e}focusLastTabbableElement(t){let e=this._getRegionBoundary("end");return e&&e.focus(t),!!e}hasAttached(){return this._hasAttached}_getFirstTabbableElement(t){if(this._checker.isFocusable(t)&&this._checker.isTabbable(t))return t;let e=t.children;for(let r=0;r<e.length;r++){let o=e[r].nodeType===this._document.ELEMENT_NODE?this._getFirstTabbableElement(e[r]):null;if(o)return o}return null}_getLastTabbableElement(t){if(this._checker.isFocusable(t)&&this._checker.isTabbable(t))return t;let e=t.children;for(let r=e.length-1;r>=0;r--){let o=e[r].nodeType===this._document.ELEMENT_NODE?this._getLastTabbableElement(e[r]):null;if(o)return o}return null}_createAnchor(){let t=this._document.createElement("div");return this._toggleAnchorTabIndex(this._enabled,t),t.classList.add("cdk-visually-hidden"),t.classList.add("cdk-focus-trap-anchor"),t.setAttribute("aria-hidden","true"),t}_toggleAnchorTabIndex(t,e){t?e.setAttribute("tabindex","0"):e.removeAttribute("tabindex")}toggleAnchors(t){this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(t,this._startAnchor),this._toggleAnchorTabIndex(t,this._endAnchor))}_executeOnStable(t){this._injector?cc(t,{injector:this._injector}):setTimeout(t)}},YH=(()=>{class n{_checker=Q(mP);_ngZone=Q(ln);_document=Q(fn);_injector=Q(qn);constructor(){Q(fb).load(qH)}create(e,r=!1){return new hP(e,this._checker,this._ngZone,this._document,r,this._injector)}static \u0275fac=function(r){return new(r||n)};static \u0275prov=Me({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function EIe(n){return n.buttons===0||n.detail===0}function TIe(n){let t=n.touches&&n.touches[0]||n.changedTouches&&n.changedTouches[0];return!!t&&t.identifier===-1&&(t.radiusX==null||t.radiusX===1)&&(t.radiusY==null||t.radiusY===1)}var DIe=new Ge("cdk-input-modality-detector-options"),kIe={ignoreKeys:[18,17,224,91,16]},ZH=650,vy=lP({passive:!0,capture:!0}),NIe=(()=>{class n{_platform=Q(ps);modalityDetected;modalityChanged;get mostRecentModality(){return this._modality.value}_mostRecentTarget=null;_modality=new Wr(null);_options;_lastTouchMs=0;_onKeydown=e=>{this._options?.ignoreKeys?.some(r=>r===e.keyCode)||(this._modality.next("keyboard"),this._mostRecentTarget=hd(e))};_onMousedown=e=>{Date.now()-this._lastTouchMs<ZH||(this._modality.next(EIe(e)?"keyboard":"mouse"),this._mostRecentTarget=hd(e))};_onTouchstart=e=>{if(TIe(e)){this._modality.next("keyboard");return}this._lastTouchMs=Date.now(),this._modality.next("touch"),this._mostRecentTarget=hd(e)};constructor(){let e=Q(ln),r=Q(fn),o=Q(DIe,{optional:!0});this._options=ke(ke({},kIe),o),this.modalityDetected=this._modality.pipe(VA(1)),this.modalityChanged=this.modalityDetected.pipe(MC()),this._platform.isBrowser&&e.runOutsideAngular(()=>{r.addEventListener("keydown",this._onKeydown,vy),r.addEventListener("mousedown",this._onMousedown,vy),r.addEventListener("touchstart",this._onTouchstart,vy)})}ngOnDestroy(){this._modality.complete(),this._platform.isBrowser&&(document.removeEventListener("keydown",this._onKeydown,vy),document.removeEventListener("mousedown",this._onMousedown,vy),document.removeEventListener("touchstart",this._onTouchstart,vy))}static \u0275fac=function(r){return new(r||n)};static \u0275prov=Me({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var yI=function(n){return n[n.IMMEDIATE=0]="IMMEDIATE",n[n.EVENTUAL=1]="EVENTUAL",n}(yI||{}),AIe=new Ge("cdk-focus-monitor-default-options"),gI=lP({passive:!0,capture:!0}),QH=(()=>{class n{_ngZone=Q(ln);_platform=Q(ps);_inputModalityDetector=Q(NIe);_origin=null;_lastFocusOrigin;_windowFocused=!1;_windowFocusTimeoutId;_originTimeoutId;_originFromTouchInteraction=!1;_elementInfo=new Map;_monitoredElementCount=0;_rootNodeFocusListenerCount=new Map;_detectionMode;_windowFocusListener=()=>{this._windowFocused=!0,this._windowFocusTimeoutId=setTimeout(()=>this._windowFocused=!1)};_document=Q(fn,{optional:!0});_stopInputModalityDetector=new zt;constructor(){let e=Q(AIe,{optional:!0});this._detectionMode=e?.detectionMode||yI.IMMEDIATE}_rootNodeFocusAndBlurListener=e=>{let r=hd(e);for(let o=r;o;o=o.parentElement)e.type==="focus"?this._onFocus(e,o):this._onBlur(e,o)};monitor(e,r=!1){let o=my(e);if(!this._platform.isBrowser||o.nodeType!==1)return ct();let i=jH(o)||this._getDocument(),s=this._elementInfo.get(o);if(s)return r&&(s.checkChildren=!0),s.subject;let a={checkChildren:r,subject:new zt,rootNode:i};return this._elementInfo.set(o,a),this._registerGlobalListeners(a),a.subject}stopMonitoring(e){let r=my(e),o=this._elementInfo.get(r);o&&(o.subject.complete(),this._setClasses(r),this._elementInfo.delete(r),this._removeGlobalListeners(o))}focusVia(e,r,o){let i=my(e),s=this._getDocument().activeElement;i===s?this._getClosestElementsInfo(i).forEach(([a,l])=>this._originChanged(a,r,l)):(this._setOrigin(r),typeof i.focus=="function"&&i.focus(o))}ngOnDestroy(){this._elementInfo.forEach((e,r)=>this.stopMonitoring(r))}_getDocument(){return this._document||document}_getWindow(){return this._getDocument().defaultView||window}_getFocusOrigin(e){return this._origin?this._originFromTouchInteraction?this._shouldBeAttributedToTouch(e)?"touch":"program":this._origin:this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:e&&this._isLastInteractionFromInputLabel(e)?"mouse":"program"}_shouldBeAttributedToTouch(e){return this._detectionMode===yI.EVENTUAL||!!e?.contains(this._inputModalityDetector._mostRecentTarget)}_setClasses(e,r){e.classList.toggle("cdk-focused",!!r),e.classList.toggle("cdk-touch-focused",r==="touch"),e.classList.toggle("cdk-keyboard-focused",r==="keyboard"),e.classList.toggle("cdk-mouse-focused",r==="mouse"),e.classList.toggle("cdk-program-focused",r==="program")}_setOrigin(e,r=!1){this._ngZone.runOutsideAngular(()=>{if(this._origin=e,this._originFromTouchInteraction=e==="touch"&&r,this._detectionMode===yI.IMMEDIATE){clearTimeout(this._originTimeoutId);let o=this._originFromTouchInteraction?ZH:1;this._originTimeoutId=setTimeout(()=>this._origin=null,o)}})}_onFocus(e,r){let o=this._elementInfo.get(r),i=hd(e);!o||!o.checkChildren&&r!==i||this._originChanged(r,this._getFocusOrigin(i),o)}_onBlur(e,r){let o=this._elementInfo.get(r);!o||o.checkChildren&&e.relatedTarget instanceof Node&&r.contains(e.relatedTarget)||(this._setClasses(r),this._emitOrigin(o,null))}_emitOrigin(e,r){e.subject.observers.length&&this._ngZone.run(()=>e.subject.next(r))}_registerGlobalListeners(e){if(!this._platform.isBrowser)return;let r=e.rootNode,o=this._rootNodeFocusListenerCount.get(r)||0;o||this._ngZone.runOutsideAngular(()=>{r.addEventListener("focus",this._rootNodeFocusAndBlurListener,gI),r.addEventListener("blur",this._rootNodeFocusAndBlurListener,gI)}),this._rootNodeFocusListenerCount.set(r,o+1),++this._monitoredElementCount===1&&(this._ngZone.runOutsideAngular(()=>{this._getWindow().addEventListener("focus",this._windowFocusListener)}),this._inputModalityDetector.modalityDetected.pipe(ap(this._stopInputModalityDetector)).subscribe(i=>{this._setOrigin(i,!0)}))}_removeGlobalListeners(e){let r=e.rootNode;if(this._rootNodeFocusListenerCount.has(r)){let o=this._rootNodeFocusListenerCount.get(r);o>1?this._rootNodeFocusListenerCount.set(r,o-1):(r.removeEventListener("focus",this._rootNodeFocusAndBlurListener,gI),r.removeEventListener("blur",this._rootNodeFocusAndBlurListener,gI),this._rootNodeFocusListenerCount.delete(r))}--this._monitoredElementCount||(this._getWindow().removeEventListener("focus",this._windowFocusListener),this._stopInputModalityDetector.next(),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._originTimeoutId))}_originChanged(e,r,o){this._setClasses(e,r),this._emitOrigin(o,r),this._lastFocusOrigin=r}_getClosestElementsInfo(e){let r=[];return this._elementInfo.forEach((o,i)=>{(i===e||o.checkChildren&&i.contains(e))&&r.push([i,o])}),r}_isLastInteractionFromInputLabel(e){let{_mostRecentTarget:r,mostRecentModality:o}=this._inputModalityDetector;if(o!=="mouse"||!r||r===e||e.nodeName!=="INPUT"&&e.nodeName!=="TEXTAREA"||e.disabled)return!1;let i=e.labels;if(i){for(let s=0;s<i.length;s++)if(i[s].contains(r))return!0}return!1}static \u0275fac=function(r){return new(r||n)};static \u0275prov=Me({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var fP={},by=(()=>{class n{_appId=Q(d0);getId(e){return this._appId!=="ng"&&(e+=this._appId),fP.hasOwnProperty(e)||(fP[e]=0),`${e}${fP[e]++}`}static \u0275fac=function(r){return new(r||n)};static \u0275prov=Me({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var JH=cP(),gP=class{_viewportRuler;_previousHTMLStyles={top:"",left:""};_previousScrollPosition;_isEnabled=!1;_document;constructor(t,e){this._viewportRuler=t,this._document=e}attach(){}enable(){if(this._canBeEnabled()){let t=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=t.style.left||"",this._previousHTMLStyles.top=t.style.top||"",t.style.left=Gr(-this._previousScrollPosition.left),t.style.top=Gr(-this._previousScrollPosition.top),t.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){let t=this._document.documentElement,e=this._document.body,r=t.style,o=e.style,i=r.scrollBehavior||"",s=o.scrollBehavior||"";this._isEnabled=!1,r.left=this._previousHTMLStyles.left,r.top=this._previousHTMLStyles.top,t.classList.remove("cdk-global-scrollblock"),JH&&(r.scrollBehavior=o.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),JH&&(r.scrollBehavior=i,o.scrollBehavior=s)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;let e=this._document.body,r=this._viewportRuler.getViewportSize();return e.scrollHeight>r.height||e.scrollWidth>r.width}};var yP=class{_scrollDispatcher;_ngZone;_viewportRuler;_config;_scrollSubscription=null;_overlayRef;_initialScrollPosition;constructor(t,e,r,o){this._scrollDispatcher=t,this._ngZone=e,this._viewportRuler=r,this._config=o}attach(t){this._overlayRef,this._overlayRef=t}enable(){if(this._scrollSubscription)return;let t=this._scrollDispatcher.scrolled(0).pipe(fr(e=>!e||!this._overlayRef.overlayElement.contains(e.getElementRef().nativeElement)));this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=t.subscribe(()=>{let e=this._viewportRuler.getViewportScrollPosition().top;Math.abs(e-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=t.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}_detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}},xI=class{enable(){}disable(){}attach(){}};function xP(n,t){return t.some(e=>{let r=n.bottom<e.top,o=n.top>e.bottom,i=n.right<e.left,s=n.left>e.right;return r||o||i||s})}function e6(n,t){return t.some(e=>{let r=n.top<e.top,o=n.bottom>e.bottom,i=n.left<e.left,s=n.right>e.right;return r||o||i||s})}var vP=class{_scrollDispatcher;_viewportRuler;_ngZone;_config;_scrollSubscription=null;_overlayRef;constructor(t,e,r,o){this._scrollDispatcher=t,this._viewportRuler=e,this._ngZone=r,this._config=o}attach(t){this._overlayRef,this._overlayRef=t}enable(){if(!this._scrollSubscription){let t=this._config?this._config.scrollThrottle:0;this._scrollSubscription=this._scrollDispatcher.scrolled(t).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){let e=this._overlayRef.overlayElement.getBoundingClientRect(),{width:r,height:o}=this._viewportRuler.getViewportSize();xP(e,[{width:r,height:o,bottom:o,right:r,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}})}}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}},RIe=(()=>{class n{_scrollDispatcher=Q(HH);_viewportRuler=Q(dP);_ngZone=Q(ln);_document=Q(fn);constructor(){}noop=()=>new xI;close=e=>new yP(this._scrollDispatcher,this._ngZone,this._viewportRuler,e);block=()=>new gP(this._viewportRuler,this._document);reposition=e=>new vP(this._scrollDispatcher,this._viewportRuler,this._ngZone,e);static \u0275fac=function(r){return new(r||n)};static \u0275prov=Me({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),hb=class{positionStrategy;scrollStrategy=new xI;panelClass="";hasBackdrop=!1;backdropClass="cdk-overlay-dark-backdrop";width;height;minWidth;minHeight;maxWidth;maxHeight;direction;disposeOnNavigation=!1;constructor(t){if(t){let e=Object.keys(t);for(let r of e)t[r]!==void 0&&(this[r]=t[r])}}};var bP=class{connectionPair;scrollableViewProperties;constructor(t,e){this.connectionPair=t,this.scrollableViewProperties=e}};var a6=(()=>{class n{_attachedOverlays=[];_document=Q(fn);_isAttached;constructor(){}ngOnDestroy(){this.detach()}add(e){this.remove(e),this._attachedOverlays.push(e)}remove(e){let r=this._attachedOverlays.indexOf(e);r>-1&&this._attachedOverlays.splice(r,1),this._attachedOverlays.length===0&&this.detach()}static \u0275fac=function(r){return new(r||n)};static \u0275prov=Me({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),OIe=(()=>{class n extends a6{_ngZone=Q(ln);_renderer=Q(Ns).createRenderer(null,null);_cleanupKeydown;add(e){super.add(e),this._isAttached||(this._ngZone.runOutsideAngular(()=>{this._cleanupKeydown=this._renderer.listen("body","keydown",this._keydownListener)}),this._isAttached=!0)}detach(){this._isAttached&&(this._cleanupKeydown?.(),this._isAttached=!1)}_keydownListener=e=>{let r=this._attachedOverlays;for(let o=r.length-1;o>-1;o--)if(r[o]._keydownEvents.observers.length>0){this._ngZone.run(()=>r[o]._keydownEvents.next(e));break}};static \u0275fac=(()=>{let e;return function(o){return(e||(e=Go(n)))(o||n)}})();static \u0275prov=Me({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),MIe=(()=>{class n extends a6{_platform=Q(ps);_ngZone=Q(ln,{optional:!0});_cursorOriginalValue;_cursorStyleIsSet=!1;_pointerDownEventTarget;add(e){if(super.add(e),!this._isAttached){let r=this._document.body;this._ngZone?this._ngZone.runOutsideAngular(()=>this._addEventListeners(r)):this._addEventListeners(r),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=r.style.cursor,r.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){if(this._isAttached){let e=this._document.body;e.removeEventListener("pointerdown",this._pointerDownListener,!0),e.removeEventListener("click",this._clickListener,!0),e.removeEventListener("auxclick",this._clickListener,!0),e.removeEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&this._cursorStyleIsSet&&(e.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1}}_addEventListeners(e){e.addEventListener("pointerdown",this._pointerDownListener,!0),e.addEventListener("click",this._clickListener,!0),e.addEventListener("auxclick",this._clickListener,!0),e.addEventListener("contextmenu",this._clickListener,!0)}_pointerDownListener=e=>{this._pointerDownEventTarget=hd(e)};_clickListener=e=>{let r=hd(e),o=e.type==="click"&&this._pointerDownEventTarget?this._pointerDownEventTarget:r;this._pointerDownEventTarget=null;let i=this._attachedOverlays.slice();for(let s=i.length-1;s>-1;s--){let a=i[s];if(a._outsidePointerEvents.observers.length<1||!a.hasAttached())continue;if(t6(a.overlayElement,r)||t6(a.overlayElement,o))break;let l=a._outsidePointerEvents;this._ngZone?this._ngZone.run(()=>l.next(e)):l.next(e)}};static \u0275fac=(()=>{let e;return function(o){return(e||(e=Go(n)))(o||n)}})();static \u0275prov=Me({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function t6(n,t){let e=typeof ShadowRoot<"u"&&ShadowRoot,r=t;for(;r;){if(r===n)return!0;r=e&&r instanceof ShadowRoot?r.host:r.parentNode}return!1}var l6=(()=>{class n{static \u0275fac=function(r){return new(r||n)};static \u0275cmp=Ct({type:n,selectors:[["ng-component"]],hostAttrs:["cdk-overlay-style-loader",""],decls:0,vars:0,template:function(r,o){},styles:[".cdk-overlay-container,.cdk-global-overlay-wrapper{pointer-events:none;top:0;left:0;height:100%;width:100%}.cdk-overlay-container{position:fixed}@layer cdk-overlay{.cdk-overlay-container{z-index:1000}}.cdk-overlay-container:empty{display:none}.cdk-global-overlay-wrapper{display:flex;position:absolute}@layer cdk-overlay{.cdk-global-overlay-wrapper{z-index:1000}}.cdk-overlay-pane{position:absolute;pointer-events:auto;box-sizing:border-box;display:flex;max-width:100%;max-height:100%}@layer cdk-overlay{.cdk-overlay-pane{z-index:1000}}.cdk-overlay-backdrop{position:absolute;top:0;bottom:0;left:0;right:0;pointer-events:auto;-webkit-tap-highlight-color:rgba(0,0,0,0);opacity:0}@layer cdk-overlay{.cdk-overlay-backdrop{z-index:1000;transition:opacity 400ms cubic-bezier(0.25, 0.8, 0.25, 1)}}.cdk-overlay-backdrop-showing{opacity:1}@media(forced-colors: active){.cdk-overlay-backdrop-showing{opacity:.6}}@layer cdk-overlay{.cdk-overlay-dark-backdrop{background:rgba(0,0,0,.32)}}.cdk-overlay-transparent-backdrop{transition:visibility 1ms linear,opacity 1ms linear;visibility:hidden;opacity:1}.cdk-overlay-transparent-backdrop.cdk-overlay-backdrop-showing,.cdk-high-contrast-active .cdk-overlay-transparent-backdrop{opacity:0;visibility:visible}.cdk-overlay-backdrop-noop-animation{transition:none}.cdk-overlay-connected-position-bounding-box{position:absolute;display:flex;flex-direction:column;min-width:1px;min-height:1px}@layer cdk-overlay{.cdk-overlay-connected-position-bounding-box{z-index:1000}}.cdk-global-scrollblock{position:fixed;width:100%;overflow-y:scroll}"],encapsulation:2,changeDetection:0})}return n})(),vI=(()=>{class n{_platform=Q(ps);_containerElement;_document=Q(fn);_styleLoader=Q(fb);constructor(){}ngOnDestroy(){this._containerElement?.remove()}getContainerElement(){return this._loadStyles(),this._containerElement||this._createContainer(),this._containerElement}_createContainer(){let e="cdk-overlay-container";if(this._platform.isBrowser||uP()){let o=this._document.querySelectorAll(`.${e}[platform="server"], .${e}[platform="test"]`);for(let i=0;i<o.length;i++)o[i].remove()}let r=this._document.createElement("div");r.classList.add(e),uP()?r.setAttribute("platform","test"):this._platform.isBrowser||r.setAttribute("platform","server"),this._document.body.appendChild(r),this._containerElement=r}_loadStyles(){this._styleLoader.load(l6)}static \u0275fac=function(r){return new(r||n)};static \u0275prov=Me({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),wy=class{_portalOutlet;_host;_pane;_config;_ngZone;_keyboardDispatcher;_document;_location;_outsideClickDispatcher;_animationsDisabled;_injector;_renderer;_backdropElement=null;_backdropTimeout;_backdropClick=new zt;_attachments=new zt;_detachments=new zt;_positionStrategy;_scrollStrategy;_locationChanges=Jn.EMPTY;_cleanupBackdropClick;_cleanupBackdropTransitionEnd;_previousHostParent;_keydownEvents=new zt;_outsidePointerEvents=new zt;_renders=new zt;_afterRenderRef;_afterNextRenderRef;constructor(t,e,r,o,i,s,a,l,c,u=!1,d,p){this._portalOutlet=t,this._host=e,this._pane=r,this._config=o,this._ngZone=i,this._keyboardDispatcher=s,this._document=a,this._location=l,this._outsideClickDispatcher=c,this._animationsDisabled=u,this._injector=d,this._renderer=p,o.scrollStrategy&&(this._scrollStrategy=o.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=o.positionStrategy,this._afterRenderRef=Os(()=>_R(()=>{this._renders.next()},{injector:this._injector}))}get overlayElement(){return this._pane}get backdropElement(){return this._backdropElement}get hostElement(){return this._host}attach(t){!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host);let e=this._portalOutlet.attach(t);return this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._afterNextRenderRef?.destroy(),this._afterNextRenderRef=cc(()=>{this.hasAttached()&&this.updatePosition()},{injector:this._injector}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),typeof e?.onDestroy=="function"&&e.onDestroy(()=>{this.hasAttached()&&this._ngZone.runOutsideAngular(()=>Promise.resolve().then(()=>this.detach()))}),e}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();let t=this._portalOutlet.detach();return this._detachments.next(),this._keyboardDispatcher.remove(this),this._detachContentWhenEmpty(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),t}dispose(){let t=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._disposeBackdrop(this._backdropElement),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),this._host?.remove(),this._afterNextRenderRef?.destroy(),this._previousHostParent=this._pane=this._host=null,t&&this._detachments.next(),this._detachments.complete(),this._afterRenderRef.destroy(),this._renders.complete()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(t){t!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=t,this.hasAttached()&&(t.attach(this),this.updatePosition()))}updateSize(t){this._config=ke(ke({},this._config),t),this._updateElementSize()}setDirection(t){this._config=Ft(ke({},this._config),{direction:t}),this._updateElementDirection()}addPanelClass(t){this._pane&&this._toggleClasses(this._pane,t,!0)}removePanelClass(t){this._pane&&this._toggleClasses(this._pane,t,!1)}getDirection(){let t=this._config.direction;return t?typeof t=="string"?t:t.value:"ltr"}updateScrollStrategy(t){t!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=t,this.hasAttached()&&(t.attach(this),t.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;let t=this._pane.style;t.width=Gr(this._config.width),t.height=Gr(this._config.height),t.minWidth=Gr(this._config.minWidth),t.minHeight=Gr(this._config.minHeight),t.maxWidth=Gr(this._config.maxWidth),t.maxHeight=Gr(this._config.maxHeight)}_togglePointerEvents(t){this._pane.style.pointerEvents=t?"":"none"}_attachBackdrop(){let t="cdk-overlay-backdrop-showing";this._backdropElement=this._document.createElement("div"),this._backdropElement.classList.add("cdk-overlay-backdrop"),this._animationsDisabled&&this._backdropElement.classList.add("cdk-overlay-backdrop-noop-animation"),this._config.backdropClass&&this._toggleClasses(this._backdropElement,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropElement,this._host),this._cleanupBackdropClick?.(),this._cleanupBackdropClick=this._renderer.listen(this._backdropElement,"click",e=>this._backdropClick.next(e)),!this._animationsDisabled&&typeof requestAnimationFrame<"u"?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this._backdropElement&&this._backdropElement.classList.add(t)})}):this._backdropElement.classList.add(t)}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){let t=this._backdropElement;if(t){if(this._animationsDisabled){this._disposeBackdrop(t);return}t.classList.remove("cdk-overlay-backdrop-showing"),this._ngZone.runOutsideAngular(()=>{this._cleanupBackdropTransitionEnd?.(),this._cleanupBackdropTransitionEnd=this._renderer.listen(t,"transitionend",e=>{this._disposeBackdrop(e.target)})}),t.style.pointerEvents="none",this._backdropTimeout=this._ngZone.runOutsideAngular(()=>setTimeout(()=>{this._disposeBackdrop(t)},500))}}_toggleClasses(t,e,r){let o=iP(e||[]).filter(i=>!!i);o.length&&(r?t.classList.add(...o):t.classList.remove(...o))}_detachContentWhenEmpty(){this._ngZone.runOutsideAngular(()=>{let t=this._renders.pipe(ap(Wv(this._attachments,this._detachments))).subscribe(()=>{(!this._pane||!this._host||this._pane.children.length===0)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._host.remove()),t.unsubscribe())})})}_disposeScrollStrategy(){let t=this._scrollStrategy;t&&(t.disable(),t.detach&&t.detach())}_disposeBackdrop(t){this._cleanupBackdropClick?.(),this._cleanupBackdropTransitionEnd?.(),t&&(t.remove(),this._backdropElement===t&&(this._backdropElement=null)),this._backdropTimeout&&(clearTimeout(this._backdropTimeout),this._backdropTimeout=void 0)}},n6="cdk-overlay-connected-position-bounding-box",PIe=/([A-Za-z%]+)$/,wP=class{_viewportRuler;_document;_platform;_overlayContainer;_overlayRef;_isInitialRender;_lastBoundingBoxSize={width:0,height:0};_isPushed=!1;_canPush=!0;_growAfterOpen=!1;_hasFlexibleDimensions=!0;_positionLocked=!1;_originRect;_overlayRect;_viewportRect;_containerRect;_viewportMargin=0;_scrollables=[];_preferredPositions=[];_origin;_pane;_isDisposed;_boundingBox;_lastPosition;_lastScrollVisibility;_positionChanges=new zt;_resizeSubscription=Jn.EMPTY;_offsetX=0;_offsetY=0;_transformOriginSelector;_appliedPanelClasses=[];_previousPushAmount;positionChanges=this._positionChanges;get positions(){return this._preferredPositions}constructor(t,e,r,o,i){this._viewportRuler=e,this._document=r,this._platform=o,this._overlayContainer=i,this.setOrigin(t)}attach(t){this._overlayRef&&this._overlayRef,this._validatePositions(),t.hostElement.classList.add(n6),this._overlayRef=t,this._boundingBox=t.hostElement,this._pane=t.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition){this.reapplyLastPosition();return}this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();let t=this._originRect,e=this._overlayRect,r=this._viewportRect,o=this._containerRect,i=[],s;for(let a of this._preferredPositions){let l=this._getOriginPoint(t,o,a),c=this._getOverlayPoint(l,e,a),u=this._getOverlayFit(c,e,r,a);if(u.isCompletelyWithinViewport){this._isPushed=!1,this._applyPosition(a,l);return}if(this._canFitWithFlexibleDimensions(u,c,r)){i.push({position:a,origin:l,overlayRect:e,boundingBoxRect:this._calculateBoundingBoxRect(l,a)});continue}(!s||s.overlayFit.visibleArea<u.visibleArea)&&(s={overlayFit:u,overlayPoint:c,originPoint:l,position:a,overlayRect:e})}if(i.length){let a=null,l=-1;for(let c of i){let u=c.boundingBoxRect.width*c.boundingBoxRect.height*(c.position.weight||1);u>l&&(l=u,a=c)}this._isPushed=!1,this._applyPosition(a.position,a.origin);return}if(this._canPush){this._isPushed=!0,this._applyPosition(s.position,s.originPoint);return}this._applyPosition(s.position,s.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&Gh(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(n6),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(this._isDisposed||!this._platform.isBrowser)return;let t=this._lastPosition;if(t){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();let e=this._getOriginPoint(this._originRect,this._containerRect,t);this._applyPosition(t,e)}else this.apply()}withScrollableContainers(t){return this._scrollables=t,this}withPositions(t){return this._preferredPositions=t,t.indexOf(this._lastPosition)===-1&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(t){return this._viewportMargin=t,this}withFlexibleDimensions(t=!0){return this._hasFlexibleDimensions=t,this}withGrowAfterOpen(t=!0){return this._growAfterOpen=t,this}withPush(t=!0){return this._canPush=t,this}withLockedPosition(t=!0){return this._positionLocked=t,this}setOrigin(t){return this._origin=t,this}withDefaultOffsetX(t){return this._offsetX=t,this}withDefaultOffsetY(t){return this._offsetY=t,this}withTransformOriginOn(t){return this._transformOriginSelector=t,this}_getOriginPoint(t,e,r){let o;if(r.originX=="center")o=t.left+t.width/2;else{let s=this._isRtl()?t.right:t.left,a=this._isRtl()?t.left:t.right;o=r.originX=="start"?s:a}e.left<0&&(o-=e.left);let i;return r.originY=="center"?i=t.top+t.height/2:i=r.originY=="top"?t.top:t.bottom,e.top<0&&(i-=e.top),{x:o,y:i}}_getOverlayPoint(t,e,r){let o;r.overlayX=="center"?o=-e.width/2:r.overlayX==="start"?o=this._isRtl()?-e.width:0:o=this._isRtl()?0:-e.width;let i;return r.overlayY=="center"?i=-e.height/2:i=r.overlayY=="top"?0:-e.height,{x:t.x+o,y:t.y+i}}_getOverlayFit(t,e,r,o){let i=o6(e),{x:s,y:a}=t,l=this._getOffset(o,"x"),c=this._getOffset(o,"y");l&&(s+=l),c&&(a+=c);let u=0-s,d=s+i.width-r.width,p=0-a,f=a+i.height-r.height,h=this._subtractOverflows(i.width,u,d),m=this._subtractOverflows(i.height,p,f),g=h*m;return{visibleArea:g,isCompletelyWithinViewport:i.width*i.height===g,fitsInViewportVertically:m===i.height,fitsInViewportHorizontally:h==i.width}}_canFitWithFlexibleDimensions(t,e,r){if(this._hasFlexibleDimensions){let o=r.bottom-e.y,i=r.right-e.x,s=r6(this._overlayRef.getConfig().minHeight),a=r6(this._overlayRef.getConfig().minWidth),l=t.fitsInViewportVertically||s!=null&&s<=o,c=t.fitsInViewportHorizontally||a!=null&&a<=i;return l&&c}return!1}_pushOverlayOnScreen(t,e,r){if(this._previousPushAmount&&this._positionLocked)return{x:t.x+this._previousPushAmount.x,y:t.y+this._previousPushAmount.y};let o=o6(e),i=this._viewportRect,s=Math.max(t.x+o.width-i.width,0),a=Math.max(t.y+o.height-i.height,0),l=Math.max(i.top-r.top-t.y,0),c=Math.max(i.left-r.left-t.x,0),u=0,d=0;return o.width<=i.width?u=c||-s:u=t.x<this._viewportMargin?i.left-r.left-t.x:0,o.height<=i.height?d=l||-a:d=t.y<this._viewportMargin?i.top-r.top-t.y:0,this._previousPushAmount={x:u,y:d},{x:t.x+u,y:t.y+d}}_applyPosition(t,e){if(this._setTransformOrigin(t),this._setOverlayElementStyles(e,t),this._setBoundingBoxStyles(e,t),t.panelClass&&this._addPanelClasses(t.panelClass),this._positionChanges.observers.length){let r=this._getScrollVisibility();if(t!==this._lastPosition||!this._lastScrollVisibility||!FIe(this._lastScrollVisibility,r)){let o=new bP(t,r);this._positionChanges.next(o)}this._lastScrollVisibility=r}this._lastPosition=t,this._isInitialRender=!1}_setTransformOrigin(t){if(!this._transformOriginSelector)return;let e=this._boundingBox.querySelectorAll(this._transformOriginSelector),r,o=t.overlayY;t.overlayX==="center"?r="center":this._isRtl()?r=t.overlayX==="start"?"right":"left":r=t.overlayX==="start"?"left":"right";for(let i=0;i<e.length;i++)e[i].style.transformOrigin=`${r} ${o}`}_calculateBoundingBoxRect(t,e){let r=this._viewportRect,o=this._isRtl(),i,s,a;if(e.overlayY==="top")s=t.y,i=r.height-s+this._viewportMargin;else if(e.overlayY==="bottom")a=r.height-t.y+this._viewportMargin*2,i=r.height-a+this._viewportMargin;else{let f=Math.min(r.bottom-t.y+r.top,t.y),h=this._lastBoundingBoxSize.height;i=f*2,s=t.y-f,i>h&&!this._isInitialRender&&!this._growAfterOpen&&(s=t.y-h/2)}let l=e.overlayX==="start"&&!o||e.overlayX==="end"&&o,c=e.overlayX==="end"&&!o||e.overlayX==="start"&&o,u,d,p;if(c)p=r.width-t.x+this._viewportMargin*2,u=t.x-this._viewportMargin;else if(l)d=t.x,u=r.right-t.x;else{let f=Math.min(r.right-t.x+r.left,t.x),h=this._lastBoundingBoxSize.width;u=f*2,d=t.x-f,u>h&&!this._isInitialRender&&!this._growAfterOpen&&(d=t.x-h/2)}return{top:s,left:d,bottom:a,right:p,width:u,height:i}}_setBoundingBoxStyles(t,e){let r=this._calculateBoundingBoxRect(t,e);!this._isInitialRender&&!this._growAfterOpen&&(r.height=Math.min(r.height,this._lastBoundingBoxSize.height),r.width=Math.min(r.width,this._lastBoundingBoxSize.width));let o={};if(this._hasExactPosition())o.top=o.left="0",o.bottom=o.right=o.maxHeight=o.maxWidth="",o.width=o.height="100%";else{let i=this._overlayRef.getConfig().maxHeight,s=this._overlayRef.getConfig().maxWidth;o.height=Gr(r.height),o.top=Gr(r.top),o.bottom=Gr(r.bottom),o.width=Gr(r.width),o.left=Gr(r.left),o.right=Gr(r.right),e.overlayX==="center"?o.alignItems="center":o.alignItems=e.overlayX==="end"?"flex-end":"flex-start",e.overlayY==="center"?o.justifyContent="center":o.justifyContent=e.overlayY==="bottom"?"flex-end":"flex-start",i&&(o.maxHeight=Gr(i)),s&&(o.maxWidth=Gr(s))}this._lastBoundingBoxSize=r,Gh(this._boundingBox.style,o)}_resetBoundingBoxStyles(){Gh(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){Gh(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(t,e){let r={},o=this._hasExactPosition(),i=this._hasFlexibleDimensions,s=this._overlayRef.getConfig();if(o){let u=this._viewportRuler.getViewportScrollPosition();Gh(r,this._getExactOverlayY(e,t,u)),Gh(r,this._getExactOverlayX(e,t,u))}else r.position="static";let a="",l=this._getOffset(e,"x"),c=this._getOffset(e,"y");l&&(a+=`translateX(${l}px) `),c&&(a+=`translateY(${c}px)`),r.transform=a.trim(),s.maxHeight&&(o?r.maxHeight=Gr(s.maxHeight):i&&(r.maxHeight="")),s.maxWidth&&(o?r.maxWidth=Gr(s.maxWidth):i&&(r.maxWidth="")),Gh(this._pane.style,r)}_getExactOverlayY(t,e,r){let o={top:"",bottom:""},i=this._getOverlayPoint(e,this._overlayRect,t);if(this._isPushed&&(i=this._pushOverlayOnScreen(i,this._overlayRect,r)),t.overlayY==="bottom"){let s=this._document.documentElement.clientHeight;o.bottom=`${s-(i.y+this._overlayRect.height)}px`}else o.top=Gr(i.y);return o}_getExactOverlayX(t,e,r){let o={left:"",right:""},i=this._getOverlayPoint(e,this._overlayRect,t);this._isPushed&&(i=this._pushOverlayOnScreen(i,this._overlayRect,r));let s;if(this._isRtl()?s=t.overlayX==="end"?"left":"right":s=t.overlayX==="end"?"right":"left",s==="right"){let a=this._document.documentElement.clientWidth;o.right=`${a-(i.x+this._overlayRect.width)}px`}else o.left=Gr(i.x);return o}_getScrollVisibility(){let t=this._getOriginRect(),e=this._pane.getBoundingClientRect(),r=this._scrollables.map(o=>o.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:e6(t,r),isOriginOutsideView:xP(t,r),isOverlayClipped:e6(e,r),isOverlayOutsideView:xP(e,r)}}_subtractOverflows(t,...e){return e.reduce((r,o)=>r-Math.max(o,0),t)}_getNarrowedViewportRect(){let t=this._document.documentElement.clientWidth,e=this._document.documentElement.clientHeight,r=this._viewportRuler.getViewportScrollPosition();return{top:r.top+this._viewportMargin,left:r.left+this._viewportMargin,right:r.left+t-this._viewportMargin,bottom:r.top+e-this._viewportMargin,width:t-2*this._viewportMargin,height:e-2*this._viewportMargin}}_isRtl(){return this._overlayRef.getDirection()==="rtl"}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(t,e){return e==="x"?t.offsetX==null?this._offsetX:t.offsetX:t.offsetY==null?this._offsetY:t.offsetY}_validatePositions(){}_addPanelClasses(t){this._pane&&iP(t).forEach(e=>{e!==""&&this._appliedPanelClasses.indexOf(e)===-1&&(this._appliedPanelClasses.push(e),this._pane.classList.add(e))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(t=>{this._pane.classList.remove(t)}),this._appliedPanelClasses=[])}_getOriginRect(){let t=this._origin;if(t instanceof hr)return t.nativeElement.getBoundingClientRect();if(t instanceof Element)return t.getBoundingClientRect();let e=t.width||0,r=t.height||0;return{top:t.y,bottom:t.y+r,left:t.x,right:t.x+e,height:r,width:e}}};function Gh(n,t){for(let e in t)t.hasOwnProperty(e)&&(n[e]=t[e]);return n}function r6(n){if(typeof n!="number"&&n!=null){let[t,e]=n.split(PIe);return!e||e==="px"?parseFloat(t):null}return n||null}function o6(n){return{top:Math.floor(n.top),right:Math.floor(n.right),bottom:Math.floor(n.bottom),left:Math.floor(n.left),width:Math.floor(n.width),height:Math.floor(n.height)}}function FIe(n,t){return n===t?!0:n.isOriginClipped===t.isOriginClipped&&n.isOriginOutsideView===t.isOriginOutsideView&&n.isOverlayClipped===t.isOverlayClipped&&n.isOverlayOutsideView===t.isOverlayOutsideView}var i6="cdk-global-overlay-wrapper",CP=class{_overlayRef;_cssPosition="static";_topOffset="";_bottomOffset="";_alignItems="";_xPosition="";_xOffset="";_width="";_height="";_isDisposed=!1;attach(t){let e=t.getConfig();this._overlayRef=t,this._width&&!e.width&&t.updateSize({width:this._width}),this._height&&!e.height&&t.updateSize({height:this._height}),t.hostElement.classList.add(i6),this._isDisposed=!1}top(t=""){return this._bottomOffset="",this._topOffset=t,this._alignItems="flex-start",this}left(t=""){return this._xOffset=t,this._xPosition="left",this}bottom(t=""){return this._topOffset="",this._bottomOffset=t,this._alignItems="flex-end",this}right(t=""){return this._xOffset=t,this._xPosition="right",this}start(t=""){return this._xOffset=t,this._xPosition="start",this}end(t=""){return this._xOffset=t,this._xPosition="end",this}width(t=""){return this._overlayRef?this._overlayRef.updateSize({width:t}):this._width=t,this}height(t=""){return this._overlayRef?this._overlayRef.updateSize({height:t}):this._height=t,this}centerHorizontally(t=""){return this.left(t),this._xPosition="center",this}centerVertically(t=""){return this.top(t),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;let t=this._overlayRef.overlayElement.style,e=this._overlayRef.hostElement.style,r=this._overlayRef.getConfig(),{width:o,height:i,maxWidth:s,maxHeight:a}=r,l=(o==="100%"||o==="100vw")&&(!s||s==="100%"||s==="100vw"),c=(i==="100%"||i==="100vh")&&(!a||a==="100%"||a==="100vh"),u=this._xPosition,d=this._xOffset,p=this._overlayRef.getConfig().direction==="rtl",f="",h="",m="";l?m="flex-start":u==="center"?(m="center",p?h=d:f=d):p?u==="left"||u==="end"?(m="flex-end",f=d):(u==="right"||u==="start")&&(m="flex-start",h=d):u==="left"||u==="start"?(m="flex-start",f=d):(u==="right"||u==="end")&&(m="flex-end",h=d),t.position=this._cssPosition,t.marginLeft=l?"0":f,t.marginTop=c?"0":this._topOffset,t.marginBottom=this._bottomOffset,t.marginRight=l?"0":h,e.justifyContent=m,e.alignItems=c?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;let t=this._overlayRef.overlayElement.style,e=this._overlayRef.hostElement,r=e.style;e.classList.remove(i6),r.justifyContent=r.alignItems=t.marginTop=t.marginBottom=t.marginLeft=t.marginRight=t.position="",this._overlayRef=null,this._isDisposed=!0}},LIe=(()=>{class n{_viewportRuler=Q(dP);_document=Q(fn);_platform=Q(ps);_overlayContainer=Q(vI);constructor(){}global(){return new CP}flexibleConnectedTo(e){return new wP(e,this._viewportRuler,this._document,this._platform,this._overlayContainer)}static \u0275fac=function(r){return new(r||n)};static \u0275prov=Me({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Cy=(()=>{class n{scrollStrategies=Q(RIe);_overlayContainer=Q(vI);_positionBuilder=Q(LIe);_keyboardDispatcher=Q(OIe);_injector=Q(qn);_ngZone=Q(ln);_document=Q(fn);_directionality=Q(ub);_location=Q(gp);_outsideClickDispatcher=Q(MIe);_animationsModuleType=Q(k_,{optional:!0});_idGenerator=Q(by);_renderer=Q(Ns).createRenderer(null,null);_appRef;_styleLoader=Q(fb);constructor(){}create(e){this._styleLoader.load(l6);let r=this._createHostElement(),o=this._createPaneElement(r),i=this._createPortalOutlet(o),s=new hb(e);return s.direction=s.direction||this._directionality.value,new wy(i,r,o,s,this._ngZone,this._keyboardDispatcher,this._document,this._location,this._outsideClickDispatcher,this._animationsModuleType==="NoopAnimations",this._injector.get(lo),this._renderer)}position(){return this._positionBuilder}_createPaneElement(e){let r=this._document.createElement("div");return r.id=this._idGenerator.getId("cdk-overlay-"),r.classList.add("cdk-overlay-pane"),e.appendChild(r),r}_createHostElement(){let e=this._document.createElement("div");return this._overlayContainer.getContainerElement().appendChild(e),e}_createPortalOutlet(e){return this._appRef||(this._appRef=this._injector.get(cs)),new fI(e,null,this._appRef,this._injector,this._document)}static \u0275fac=function(r){return new(r||n)};static \u0275prov=Me({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function VIe(n,t){}var Ip=class{viewContainerRef;injector;id;role="dialog";panelClass="";hasBackdrop=!0;backdropClass="";disableClose=!1;width="";height="";minWidth;minHeight;maxWidth;maxHeight;positionStrategy;data=null;direction;ariaDescribedBy=null;ariaLabelledBy=null;ariaLabel=null;ariaModal=!1;autoFocus="first-tabbable";restoreFocus=!0;scrollStrategy;closeOnNavigation=!0;closeOnDestroy=!0;closeOnOverlayDetachments=!0;componentFactoryResolver;providers;container;templateContext};var IP=(()=>{class n extends xy{_elementRef=Q(hr);_focusTrapFactory=Q(YH);_config;_interactivityChecker=Q(mP);_ngZone=Q(ln);_overlayRef=Q(wy);_focusMonitor=Q(QH);_renderer=Q(Mi);_platform=Q(ps);_document=Q(fn,{optional:!0});_portalOutlet;_focusTrap=null;_elementFocusedBeforeDialogWasOpened=null;_closeInteractionType=null;_ariaLabelledByQueue=[];_changeDetectorRef=Q(Sa);_injector=Q(qn);_isDestroyed=!1;constructor(){super(),this._config=Q(Ip,{optional:!0})||new Ip,this._config.ariaLabelledBy&&this._ariaLabelledByQueue.push(this._config.ariaLabelledBy)}_addAriaLabelledBy(e){this._ariaLabelledByQueue.push(e),this._changeDetectorRef.markForCheck()}_removeAriaLabelledBy(e){let r=this._ariaLabelledByQueue.indexOf(e);r>-1&&(this._ariaLabelledByQueue.splice(r,1),this._changeDetectorRef.markForCheck())}_contentAttached(){this._initializeFocusTrap(),this._handleBackdropClicks(),this._captureInitialFocus()}_captureInitialFocus(){this._trapFocus()}ngOnDestroy(){this._isDestroyed=!0,this._restoreFocus()}attachComponentPortal(e){this._portalOutlet.hasAttached();let r=this._portalOutlet.attachComponentPortal(e);return this._contentAttached(),r}attachTemplatePortal(e){this._portalOutlet.hasAttached();let r=this._portalOutlet.attachTemplatePortal(e);return this._contentAttached(),r}attachDomPortal=e=>{this._portalOutlet.hasAttached();let r=this._portalOutlet.attachDomPortal(e);return this._contentAttached(),r};_recaptureFocus(){this._containsFocus()||this._trapFocus()}_forceFocus(e,r){this._interactivityChecker.isFocusable(e)||(e.tabIndex=-1,this._ngZone.runOutsideAngular(()=>{let o=()=>{i(),s(),e.removeAttribute("tabindex")},i=this._renderer.listen(e,"blur",o),s=this._renderer.listen(e,"mousedown",o)})),e.focus(r)}_focusByCssSelector(e,r){let o=this._elementRef.nativeElement.querySelector(e);o&&this._forceFocus(o,r)}_trapFocus(){this._isDestroyed||cc(()=>{let e=this._elementRef.nativeElement;switch(this._config.autoFocus){case!1:case"dialog":this._containsFocus()||e.focus();break;case!0:case"first-tabbable":this._focusTrap?.focusInitialElement()||this._focusDialogContainer();break;case"first-heading":this._focusByCssSelector('h1, h2, h3, h4, h5, h6, [role="heading"]');break;default:this._focusByCssSelector(this._config.autoFocus);break}},{injector:this._injector})}_restoreFocus(){let e=this._config.restoreFocus,r=null;if(typeof e=="string"?r=this._document.querySelector(e):typeof e=="boolean"?r=e?this._elementFocusedBeforeDialogWasOpened:null:e&&(r=e),this._config.restoreFocus&&r&&typeof r.focus=="function"){let o=cb(),i=this._elementRef.nativeElement;(!o||o===this._document.body||o===i||i.contains(o))&&(this._focusMonitor?(this._focusMonitor.focusVia(r,this._closeInteractionType),this._closeInteractionType=null):r.focus())}this._focusTrap&&this._focusTrap.destroy()}_focusDialogContainer(){this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()}_containsFocus(){let e=this._elementRef.nativeElement,r=cb();return e===r||e.contains(r)}_initializeFocusTrap(){this._platform.isBrowser&&(this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._document&&(this._elementFocusedBeforeDialogWasOpened=cb()))}_handleBackdropClicks(){this._overlayRef.backdropClick().subscribe(()=>{this._config.disableClose&&this._recaptureFocus()})}static \u0275fac=function(r){return new(r||n)};static \u0275cmp=Ct({type:n,selectors:[["cdk-dialog-container"]],viewQuery:function(r,o){if(r&1&&hp(pb,7),r&2){let i;uc(i=dc())&&(o._portalOutlet=i.first)}},hostAttrs:["tabindex","-1",1,"cdk-dialog-container"],hostVars:6,hostBindings:function(r,o){r&2&&wa("id",o._config.id||null)("role",o._config.role)("aria-modal",o._config.ariaModal)("aria-labelledby",o._config.ariaLabel?null:o._ariaLabelledByQueue[0])("aria-label",o._config.ariaLabel)("aria-describedby",o._config.ariaDescribedBy||null)},features:[Or],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(r,o){r&1&&Ne(0,VIe,0,0,"ng-template",0)},dependencies:[pb],styles:[".cdk-dialog-container{display:block;width:100%;height:100%;min-height:inherit;max-height:inherit}"],encapsulation:2})}return n})(),mb=class{overlayRef;config;componentInstance;componentRef;containerInstance;disableClose;closed=new zt;backdropClick;keydownEvents;outsidePointerEvents;id;_detachSubscription;constructor(t,e){this.overlayRef=t,this.config=e,this.disableClose=e.disableClose,this.backdropClick=t.backdropClick(),this.keydownEvents=t.keydownEvents(),this.outsidePointerEvents=t.outsidePointerEvents(),this.id=e.id,this.keydownEvents.subscribe(r=>{r.keyCode===27&&!this.disableClose&&!mI(r)&&(r.preventDefault(),this.close(void 0,{focusOrigin:"keyboard"}))}),this.backdropClick.subscribe(()=>{this.disableClose||this.close(void 0,{focusOrigin:"mouse"})}),this._detachSubscription=t.detachments().subscribe(()=>{e.closeOnOverlayDetachments!==!1&&this.close()})}close(t,e){if(this.containerInstance){let r=this.closed;this.containerInstance._closeInteractionType=e?.focusOrigin||"program",this._detachSubscription.unsubscribe(),this.overlayRef.dispose(),r.next(t),r.complete(),this.componentInstance=this.containerInstance=null}}updatePosition(){return this.overlayRef.updatePosition(),this}updateSize(t="",e=""){return this.overlayRef.updateSize({width:t,height:e}),this}addPanelClass(t){return this.overlayRef.addPanelClass(t),this}removePanelClass(t){return this.overlayRef.removePanelClass(t),this}},BIe=new Ge("DialogScrollStrategy",{providedIn:"root",factory:()=>{let n=Q(Cy);return()=>n.scrollStrategies.block()}}),zIe=new Ge("DialogData"),UIe=new Ge("DefaultDialogConfig");var c6=(()=>{class n{_overlay=Q(Cy);_injector=Q(qn);_defaultOptions=Q(UIe,{optional:!0});_parentDialog=Q(n,{optional:!0,skipSelf:!0});_overlayContainer=Q(vI);_idGenerator=Q(by);_openDialogsAtThisLevel=[];_afterAllClosedAtThisLevel=new zt;_afterOpenedAtThisLevel=new zt;_ariaHiddenElements=new Map;_scrollStrategy=Q(BIe);get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}afterAllClosed=rp(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(sp(void 0)));constructor(){}open(e,r){let o=this._defaultOptions||new Ip;r=ke(ke({},o),r),r.id=r.id||this._idGenerator.getId("cdk-dialog-"),r.id&&this.getDialogById(r.id);let i=this._getOverlayConfig(r),s=this._overlay.create(i),a=new mb(s,r),l=this._attachContainer(s,a,r);return a.containerInstance=l,this._attachDialogContent(e,a,l,r),this.openDialogs.length||this._hideNonDialogContentFromAssistiveTechnology(),this.openDialogs.push(a),a.closed.subscribe(()=>this._removeOpenDialog(a,!0)),this.afterOpened.next(a),a}closeAll(){_P(this.openDialogs,e=>e.close())}getDialogById(e){return this.openDialogs.find(r=>r.id===e)}ngOnDestroy(){_P(this._openDialogsAtThisLevel,e=>{e.config.closeOnDestroy===!1&&this._removeOpenDialog(e,!1)}),_P(this._openDialogsAtThisLevel,e=>e.close()),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete(),this._openDialogsAtThisLevel=[]}_getOverlayConfig(e){let r=new hb({positionStrategy:e.positionStrategy||this._overlay.position().global().centerHorizontally().centerVertically(),scrollStrategy:e.scrollStrategy||this._scrollStrategy(),panelClass:e.panelClass,hasBackdrop:e.hasBackdrop,direction:e.direction,minWidth:e.minWidth,minHeight:e.minHeight,maxWidth:e.maxWidth,maxHeight:e.maxHeight,width:e.width,height:e.height,disposeOnNavigation:e.closeOnNavigation});return e.backdropClass&&(r.backdropClass=e.backdropClass),r}_attachContainer(e,r,o){let i=o.injector||o.viewContainerRef?.injector,s=[{provide:Ip,useValue:o},{provide:mb,useValue:r},{provide:wy,useValue:e}],a;o.container?typeof o.container=="function"?a=o.container:(a=o.container.type,s.push(...o.container.providers(o))):a=IP;let l=new gy(a,o.viewContainerRef,qn.create({parent:i||this._injector,providers:s}));return e.attach(l).instance}_attachDialogContent(e,r,o,i){if(e instanceof ks){let s=this._createInjector(i,r,o,void 0),a={$implicit:i.data,dialogRef:r};i.templateContext&&(a=ke(ke({},a),typeof i.templateContext=="function"?i.templateContext():i.templateContext)),o.attachTemplatePortal(new yy(e,null,a,s))}else{let s=this._createInjector(i,r,o,this._injector),a=o.attachComponentPortal(new gy(e,i.viewContainerRef,s));r.componentRef=a,r.componentInstance=a.instance}}_createInjector(e,r,o,i){let s=e.injector||e.viewContainerRef?.injector,a=[{provide:zIe,useValue:e.data},{provide:mb,useValue:r}];return e.providers&&(typeof e.providers=="function"?a.push(...e.providers(r,e,o)):a.push(...e.providers)),e.direction&&(!s||!s.get(ub,null,{optional:!0}))&&a.push({provide:ub,useValue:{value:e.direction,change:ct()}}),qn.create({parent:s||i,providers:a})}_removeOpenDialog(e,r){let o=this.openDialogs.indexOf(e);o>-1&&(this.openDialogs.splice(o,1),this.openDialogs.length||(this._ariaHiddenElements.forEach((i,s)=>{i?s.setAttribute("aria-hidden",i):s.removeAttribute("aria-hidden")}),this._ariaHiddenElements.clear(),r&&this._getAfterAllClosed().next()))}_hideNonDialogContentFromAssistiveTechnology(){let e=this._overlayContainer.getContainerElement();if(e.parentElement){let r=e.parentElement.children;for(let o=r.length-1;o>-1;o--){let i=r[o];i!==e&&i.nodeName!=="SCRIPT"&&i.nodeName!=="STYLE"&&!i.hasAttribute("aria-live")&&(this._ariaHiddenElements.set(i,i.getAttribute("aria-hidden")),i.setAttribute("aria-hidden","true"))}}}_getAfterAllClosed(){let e=this._parentDialog;return e?e._getAfterAllClosed():this._afterAllClosedAtThisLevel}static \u0275fac=function(r){return new(r||n)};static \u0275prov=Me({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function _P(n,t){let e=n.length;for(;e--;)t(n[e])}function WIe(n,t){}var wI=class{viewContainerRef;injector;id;role="dialog";panelClass="";hasBackdrop=!0;backdropClass="";disableClose=!1;width="";height="";minWidth;minHeight;maxWidth;maxHeight;position;data=null;direction;ariaDescribedBy=null;ariaLabelledBy=null;ariaLabel=null;ariaModal=!1;autoFocus="first-tabbable";restoreFocus=!0;delayFocusTrap=!0;scrollStrategy;closeOnNavigation=!0;componentFactoryResolver;enterAnimationDuration;exitAnimationDuration},EP="mdc-dialog--open",u6="mdc-dialog--opening",d6="mdc-dialog--closing",GIe=150,jIe=75,HIe=(()=>{class n extends IP{_animationMode=Q(k_,{optional:!0});_animationStateChanged=new Un;_animationsEnabled=this._animationMode!=="NoopAnimations";_actionSectionCount=0;_hostElement=this._elementRef.nativeElement;_enterAnimationDuration=this._animationsEnabled?f6(this._config.enterAnimationDuration)??GIe:0;_exitAnimationDuration=this._animationsEnabled?f6(this._config.exitAnimationDuration)??jIe:0;_animationTimer=null;_contentAttached(){super._contentAttached(),this._startOpenAnimation()}_startOpenAnimation(){this._animationStateChanged.emit({state:"opening",totalTime:this._enterAnimationDuration}),this._animationsEnabled?(this._hostElement.style.setProperty(p6,`${this._enterAnimationDuration}ms`),this._requestAnimationFrame(()=>this._hostElement.classList.add(u6,EP)),this._waitForAnimationToComplete(this._enterAnimationDuration,this._finishDialogOpen)):(this._hostElement.classList.add(EP),Promise.resolve().then(()=>this._finishDialogOpen()))}_startExitAnimation(){this._animationStateChanged.emit({state:"closing",totalTime:this._exitAnimationDuration}),this._hostElement.classList.remove(EP),this._animationsEnabled?(this._hostElement.style.setProperty(p6,`${this._exitAnimationDuration}ms`),this._requestAnimationFrame(()=>this._hostElement.classList.add(d6)),this._waitForAnimationToComplete(this._exitAnimationDuration,this._finishDialogClose)):Promise.resolve().then(()=>this._finishDialogClose())}_updateActionSectionCount(e){this._actionSectionCount+=e,this._changeDetectorRef.markForCheck()}_finishDialogOpen=()=>{this._clearAnimationClasses(),this._openAnimationDone(this._enterAnimationDuration)};_finishDialogClose=()=>{this._clearAnimationClasses(),this._animationStateChanged.emit({state:"closed",totalTime:this._exitAnimationDuration})};_clearAnimationClasses(){this._hostElement.classList.remove(u6,d6)}_waitForAnimationToComplete(e,r){this._animationTimer!==null&&clearTimeout(this._animationTimer),this._animationTimer=setTimeout(r,e)}_requestAnimationFrame(e){this._ngZone.runOutsideAngular(()=>{typeof requestAnimationFrame=="function"?requestAnimationFrame(e):e()})}_captureInitialFocus(){this._config.delayFocusTrap||this._trapFocus()}_openAnimationDone(e){this._config.delayFocusTrap&&this._trapFocus(),this._animationStateChanged.next({state:"opened",totalTime:e})}ngOnDestroy(){super.ngOnDestroy(),this._animationTimer!==null&&clearTimeout(this._animationTimer)}attachComponentPortal(e){let r=super.attachComponentPortal(e);return r.location.nativeElement.classList.add("mat-mdc-dialog-component-host"),r}static \u0275fac=(()=>{let e;return function(o){return(e||(e=Go(n)))(o||n)}})();static \u0275cmp=Ct({type:n,selectors:[["mat-dialog-container"]],hostAttrs:["tabindex","-1",1,"mat-mdc-dialog-container","mdc-dialog"],hostVars:10,hostBindings:function(r,o){r&2&&(UR("id",o._config.id),wa("aria-modal",o._config.ariaModal)("role",o._config.role)("aria-labelledby",o._config.ariaLabel?null:o._ariaLabelledByQueue[0])("aria-label",o._config.ariaLabel)("aria-describedby",o._config.ariaDescribedBy||null),Zu("_mat-animation-noopable",!o._animationsEnabled)("mat-mdc-dialog-container-with-actions",o._actionSectionCount>0))},features:[Or],decls:3,vars:0,consts:[[1,"mat-mdc-dialog-inner-container","mdc-dialog__container"],[1,"mat-mdc-dialog-surface","mdc-dialog__surface"],["cdkPortalOutlet",""]],template:function(r,o){r&1&&(E(0,"div",0)(1,"div",1),Ne(2,WIe,0,0,"ng-template",2),S()())},dependencies:[pb],styles:['.mat-mdc-dialog-container{width:100%;height:100%;display:block;box-sizing:border-box;max-height:inherit;min-height:inherit;min-width:inherit;max-width:inherit;outline:0}.cdk-overlay-pane.mat-mdc-dialog-panel{max-width:var(--mat-dialog-container-max-width, 560px);min-width:var(--mat-dialog-container-min-width, 280px)}@media(max-width: 599px){.cdk-overlay-pane.mat-mdc-dialog-panel{max-width:var(--mat-dialog-container-small-max-width, calc(100vw - 32px))}}.mat-mdc-dialog-inner-container{display:flex;flex-direction:row;align-items:center;justify-content:space-around;box-sizing:border-box;height:100%;opacity:0;transition:opacity linear var(--mat-dialog-transition-duration, 0ms);max-height:inherit;min-height:inherit;min-width:inherit;max-width:inherit}.mdc-dialog--closing .mat-mdc-dialog-inner-container{transition:opacity 75ms linear;transform:none}.mdc-dialog--open .mat-mdc-dialog-inner-container{opacity:1}._mat-animation-noopable .mat-mdc-dialog-inner-container{transition:none}.mat-mdc-dialog-surface{display:flex;flex-direction:column;flex-grow:0;flex-shrink:0;box-sizing:border-box;width:100%;height:100%;position:relative;overflow-y:auto;outline:0;transform:scale(0.8);transition:transform var(--mat-dialog-transition-duration, 0ms) cubic-bezier(0, 0, 0.2, 1);max-height:inherit;min-height:inherit;min-width:inherit;max-width:inherit;box-shadow:var(--mat-dialog-container-elevation-shadow, none);border-radius:var(--mdc-dialog-container-shape, var(--mat-sys-corner-extra-large, 4px));background-color:var(--mdc-dialog-container-color, var(--mat-sys-surface, white))}[dir=rtl] .mat-mdc-dialog-surface{text-align:right}.mdc-dialog--open .mat-mdc-dialog-surface,.mdc-dialog--closing .mat-mdc-dialog-surface{transform:none}._mat-animation-noopable .mat-mdc-dialog-surface{transition:none}.mat-mdc-dialog-surface::before{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:2px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none}.mat-mdc-dialog-title{display:block;position:relative;flex-shrink:0;box-sizing:border-box;margin:0 0 1px;padding:var(--mat-dialog-headline-padding, 6px 24px 13px)}.mat-mdc-dialog-title::before{display:inline-block;width:0;height:40px;content:"";vertical-align:0}[dir=rtl] .mat-mdc-dialog-title{text-align:right}.mat-mdc-dialog-container .mat-mdc-dialog-title{color:var(--mdc-dialog-subhead-color, var(--mat-sys-on-surface, rgba(0, 0, 0, 0.87)));font-family:var(--mdc-dialog-subhead-font, var(--mat-sys-headline-small-font, inherit));line-height:var(--mdc-dialog-subhead-line-height, var(--mat-sys-headline-small-line-height, 1.5rem));font-size:var(--mdc-dialog-subhead-size, var(--mat-sys-headline-small-size, 1rem));font-weight:var(--mdc-dialog-subhead-weight, var(--mat-sys-headline-small-weight, 400));letter-spacing:var(--mdc-dialog-subhead-tracking, var(--mat-sys-headline-small-tracking, 0.03125em))}.mat-mdc-dialog-content{display:block;flex-grow:1;box-sizing:border-box;margin:0;overflow:auto;max-height:65vh}.mat-mdc-dialog-content>:first-child{margin-top:0}.mat-mdc-dialog-content>:last-child{margin-bottom:0}.mat-mdc-dialog-container .mat-mdc-dialog-content{color:var(--mdc-dialog-supporting-text-color, var(--mat-sys-on-surface-variant, rgba(0, 0, 0, 0.6)));font-family:var(--mdc-dialog-supporting-text-font, var(--mat-sys-body-medium-font, inherit));line-height:var(--mdc-dialog-supporting-text-line-height, var(--mat-sys-body-medium-line-height, 1.5rem));font-size:var(--mdc-dialog-supporting-text-size, var(--mat-sys-body-medium-size, 1rem));font-weight:var(--mdc-dialog-supporting-text-weight, var(--mat-sys-body-medium-weight, 400));letter-spacing:var(--mdc-dialog-supporting-text-tracking, var(--mat-sys-body-medium-tracking, 0.03125em))}.mat-mdc-dialog-container .mat-mdc-dialog-content{padding:var(--mat-dialog-content-padding, 20px 24px)}.mat-mdc-dialog-container-with-actions .mat-mdc-dialog-content{padding:var(--mat-dialog-with-actions-content-padding, 20px 24px 0)}.mat-mdc-dialog-container .mat-mdc-dialog-title+.mat-mdc-dialog-content{padding-top:0}.mat-mdc-dialog-actions{display:flex;position:relative;flex-shrink:0;flex-wrap:wrap;align-items:center;justify-content:flex-end;box-sizing:border-box;min-height:52px;margin:0;padding:8px;border-top:1px solid rgba(0,0,0,0);padding:var(--mat-dialog-actions-padding, 16px 24px);justify-content:var(--mat-dialog-actions-alignment, flex-end)}@media(forced-colors: active){.mat-mdc-dialog-actions{border-top-color:CanvasText}}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-start,.mat-mdc-dialog-actions[align=start]{justify-content:start}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-center,.mat-mdc-dialog-actions[align=center]{justify-content:center}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-end,.mat-mdc-dialog-actions[align=end]{justify-content:flex-end}.mat-mdc-dialog-actions .mat-button-base+.mat-button-base,.mat-mdc-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:8px}[dir=rtl] .mat-mdc-dialog-actions .mat-button-base+.mat-button-base,[dir=rtl] .mat-mdc-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:0;margin-right:8px}.mat-mdc-dialog-component-host{display:contents}'],encapsulation:2})}return n})(),p6="--mat-dialog-transition-duration";function f6(n){return n==null?null:typeof n=="number"?n:n.endsWith("ms")?pI(n.substring(0,n.length-2)):n.endsWith("s")?pI(n.substring(0,n.length-1))*1e3:n==="0"?0:null}var bI=function(n){return n[n.OPEN=0]="OPEN",n[n.CLOSING=1]="CLOSING",n[n.CLOSED=2]="CLOSED",n}(bI||{}),gb=class{_ref;_containerInstance;componentInstance;componentRef;disableClose;id;_afterOpened=new zt;_beforeClosed=new zt;_result;_closeFallbackTimeout;_state=bI.OPEN;_closeInteractionType;constructor(t,e,r){this._ref=t,this._containerInstance=r,this.disableClose=e.disableClose,this.id=t.id,t.addPanelClass("mat-mdc-dialog-panel"),r._animationStateChanged.pipe(fr(o=>o.state==="opened"),Ti(1)).subscribe(()=>{this._afterOpened.next(),this._afterOpened.complete()}),r._animationStateChanged.pipe(fr(o=>o.state==="closed"),Ti(1)).subscribe(()=>{clearTimeout(this._closeFallbackTimeout),this._finishDialogClose()}),t.overlayRef.detachments().subscribe(()=>{this._beforeClosed.next(this._result),this._beforeClosed.complete(),this._finishDialogClose()}),Wv(this.backdropClick(),this.keydownEvents().pipe(fr(o=>o.keyCode===27&&!this.disableClose&&!mI(o)))).subscribe(o=>{this.disableClose||(o.preventDefault(),qIe(this,o.type==="keydown"?"keyboard":"mouse"))})}close(t){this._result=t,this._containerInstance._animationStateChanged.pipe(fr(e=>e.state==="closing"),Ti(1)).subscribe(e=>{this._beforeClosed.next(t),this._beforeClosed.complete(),this._ref.overlayRef.detachBackdrop(),this._closeFallbackTimeout=setTimeout(()=>this._finishDialogClose(),e.totalTime+100)}),this._state=bI.CLOSING,this._containerInstance._startExitAnimation()}afterOpened(){return this._afterOpened}afterClosed(){return this._ref.closed}beforeClosed(){return this._beforeClosed}backdropClick(){return this._ref.backdropClick}keydownEvents(){return this._ref.keydownEvents}updatePosition(t){let e=this._ref.config.positionStrategy;return t&&(t.left||t.right)?t.left?e.left(t.left):e.right(t.right):e.centerHorizontally(),t&&(t.top||t.bottom)?t.top?e.top(t.top):e.bottom(t.bottom):e.centerVertically(),this._ref.updatePosition(),this}updateSize(t="",e=""){return this._ref.updateSize(t,e),this}addPanelClass(t){return this._ref.addPanelClass(t),this}removePanelClass(t){return this._ref.removePanelClass(t),this}getState(){return this._state}_finishDialogClose(){this._state=bI.CLOSED,this._ref.close(this._result,{focusOrigin:this._closeInteractionType}),this.componentInstance=null}};function qIe(n,t,e){return n._closeInteractionType=t,n.close(e)}var KIe=new Ge("MatMdcDialogData"),XIe=new Ge("mat-mdc-dialog-default-options"),YIe=new Ge("mat-mdc-dialog-scroll-strategy",{providedIn:"root",factory:()=>{let n=Q(Cy);return()=>n.scrollStrategies.block()}});var h6=(()=>{class n{_overlay=Q(Cy);_defaultOptions=Q(XIe,{optional:!0});_scrollStrategy=Q(YIe);_parentDialog=Q(n,{optional:!0,skipSelf:!0});_idGenerator=Q(by);_dialog=Q(c6);_openDialogsAtThisLevel=[];_afterAllClosedAtThisLevel=new zt;_afterOpenedAtThisLevel=new zt;dialogConfigClass=wI;_dialogRefConstructor;_dialogContainerType;_dialogDataToken;get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}_getAfterAllClosed(){let e=this._parentDialog;return e?e._getAfterAllClosed():this._afterAllClosedAtThisLevel}afterAllClosed=rp(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(sp(void 0)));constructor(){this._dialogRefConstructor=gb,this._dialogContainerType=HIe,this._dialogDataToken=KIe}open(e,r){let o;r=ke(ke({},this._defaultOptions||new wI),r),r.id=r.id||this._idGenerator.getId("mat-mdc-dialog-"),r.scrollStrategy=r.scrollStrategy||this._scrollStrategy();let i=this._dialog.open(e,Ft(ke({},r),{positionStrategy:this._overlay.position().global().centerHorizontally().centerVertically(),disableClose:!0,closeOnDestroy:!1,closeOnOverlayDetachments:!1,container:{type:this._dialogContainerType,providers:()=>[{provide:this.dialogConfigClass,useValue:r},{provide:Ip,useValue:r}]},templateContext:()=>({dialogRef:o}),providers:(s,a,l)=>(o=new this._dialogRefConstructor(s,r,l),o.updatePosition(r?.position),[{provide:this._dialogContainerType,useValue:l},{provide:this._dialogDataToken,useValue:a.data},{provide:this._dialogRefConstructor,useValue:o}])}));return o.componentRef=i.componentRef,o.componentInstance=i.componentInstance,this.openDialogs.push(o),this.afterOpened.next(o),o.afterClosed().subscribe(()=>{let s=this.openDialogs.indexOf(o);s>-1&&(this.openDialogs.splice(s,1),this.openDialogs.length||this._getAfterAllClosed().next())}),o}closeAll(){this._closeDialogs(this.openDialogs)}getDialogById(e){return this.openDialogs.find(r=>r.id===e)}ngOnDestroy(){this._closeDialogs(this._openDialogsAtThisLevel),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete()}_closeDialogs(e){let r=e.length;for(;r--;)e[r].close()}static \u0275fac=function(r){return new(r||n)};static \u0275prov=Me({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var md=class{constructor(t,e){this.backend=t,this.dataMover=e,this.data=new WeakMap,this.dataIdsCount=0}get(t){return this.data.has(t)||this.dataMover.moveData(this.backend,t),this.data.get(t)}set(t,e){this.dataIdsCount++,this.data.set(t,e)}has(t){return this.data.has(t)}delete(t){return this.dataIdsCount--,this.data.delete(t)}numDataIds(){return this.dataIdsCount}},Ra=class{refCount(t){return Bi("refCount")}incRef(t){return Bi("incRef")}timerAvailable(){return!0}time(t){return Bi("time")}read(t){return Bi("read")}readSync(t){return Bi("readSync")}readToGPU(t,e){return Bi("readToGPU")}numDataIds(){return Bi("numDataIds")}disposeData(t,e){return Bi("disposeData")}write(t,e,r){return Bi("write")}move(t,e,r,o,i){return Bi("move")}createTensorFromGPUData(t,e,r){return Bi("createTensorFromGPUData")}memory(){return Bi("memory")}floatPrecision(){return Bi("floatPrecision")}epsilon(){return this.floatPrecision()===32?1e-7:1e-4}dispose(){return Bi("dispose")}};function Bi(n){throw new Error(`'${n}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}function m6(n){let t=n.length,e=0;for(;t>0;)e=Math.random()*t|0,t--,CI(n,t,e)}function QIe(n,t){if(n.length!==t.length)throw new Error(`Array sizes must match to be shuffled together First array length was ${n.length}Second array length was ${t.length}`);let e=n.length,r=0;for(;e>0;)r=Math.random()*e|0,e--,CI(n,e,r),CI(t,e,r)}function _y(n,t,e){return Math.max(n,Math.min(t,e))}function JIe(n){return n%2===0?n:n+1}function CI(n,t,e){let r=n[t];n[t]=n[e],n[e]=r}function e1e(n){let t=0;for(let e=0;e<n.length;e++)t+=n[e];return t}function t1e(n,t){let e=Math.random();return t*e+(1-e)*n}function n1e(n,t){let e=0;for(let r=0;r<n.length;r++){let o=Number(n[r])-Number(t[r]);e+=o*o}return e}function L(n,t){if(!n)throw new Error(typeof t=="string"?t:t())}function br(n,t,e=""){L(zi(n,t),()=>e+` Shapes ${n} and ${t} must match`)}function fs(n){L(n!=null,()=>"The input to the tensor constructor must be a non-null value.")}function Mt(n){if(n.length===0)return 1;let t=n[0];for(let e=1;e<n.length;e++)t*=n[e];return t}function r1e(n){return n.length===0}function TP(n,t){if(n===t)return!0;if(n==null||t==null||n.length!==t.length)return!1;for(let e=0;e<n.length;e++)if(n[e]!==null&&t[e]!==null&&n[e]!==t[e])return!1;return!0}function zi(n,t){if(n===t)return!0;if(n==null||t==null||n.length!==t.length)return!1;for(let e=0;e<n.length;e++)if(n[e]!==t[e])return!1;return!0}function gd(n){return n%1===0}function o1e(n){if(Math.tanh!=null)return Math.tanh(n);if(n===1/0)return 1;if(n===-1/0)return-1;{let t=Math.exp(2*n);return(t-1)/(t+1)}}function i1e(n){let t=Math.ceil(Math.sqrt(n));return[t,Math.ceil(n/t)]}function s1e(n){let t=new Uint32Array(n);for(let e=0;e<n;++e)t[e]=e;return m6(t),t}function Hh(n,t){return t<=n.length?n:n+" ".repeat(t-n.length)}function a1e(n,t=o=>0,e,r){return new Promise((o,i)=>{let s=0,a=()=>{if(n()){o();return}s++;let l=t(s);if(e!=null&&s>=e){i();return}r!=null?r(a,l):setTimeout(a,l)};a()})}function l1e(n,t){let e=1,r=-1;for(let i=0;i<n.length;++i)if(n[i]>=0)e*=n[i];else if(n[i]===-1){if(r!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${r} and dim ${i}`);r=i}else if(n[i]<0)throw Error(`Shapes can not be < 0. Found ${n[i]} at dim ${i}`);if(r===-1){if(t>0&&t!==e)throw Error(`Size(${t}) must match the product of shape ${n}`);return n}if(e===0)throw Error(`Cannot infer the missing size in [${n}] when there are 0 elements`);if(t%e!==0)throw Error(`The implicit shape can't be a fractional number. Got ${t} / ${e}`);let o=n.slice();return o[r]=t/e,o}function Mr(n,t){let e=t.length;return n=n==null?t.map((r,o)=>o):[].concat(n),L(n.every(r=>r>=-e&&r<e),()=>`All values in axis param must be in range [-${e}, ${e}) but got axis ${n}`),L(n.every(r=>gd(r)),()=>`All values in axis param must be integers but got axis ${n}`),n.map(r=>r<0?e+r:r)}function DP(n,t){let e=[],r=[],o=t!=null&&Array.isArray(t)&&t.length===0,i=t==null||o?null:Mr(t,n).sort(),s=0;for(let a=0;a<n.length;++a){if(i!=null){if(i[s]===a&&n[a]!==1)throw new Error(`Can't squeeze axis ${a} since its dim '${n[a]}' is not 1`);(i[s]==null||i[s]>a)&&n[a]===1&&(e.push(n[a]),r.push(a)),i[s]<=a&&s++}n[a]!==1&&(e.push(n[a]),r.push(a))}return{newShape:e,keptDims:r}}function kP(n,t){return _I(n,t)}function _I(n,t){let e=null;if(n==null||n==="float32")e=new Float32Array(t);else if(n==="int32")e=new Int32Array(t);else if(n==="bool")e=new Uint8Array(t);else if(n==="string")e=new Array(t);else throw new Error(`Unknown data type ${n}`);return e}function NP(n,t){for(let e=0;e<n.length;e++){let r=n[e];if(isNaN(r)||!isFinite(r))throw Error(`A tensor of type ${t} being uploaded contains ${r}.`)}}function AP(n){return n==="bool"||n==="complex64"||n==="float32"||n==="int32"||n==="string"}function c1e(n,t){return!(t==="complex64"||t==="float32"&&n!=="complex64"||t==="int32"&&n!=="float32"&&n!=="complex64"||t==="bool"&&n==="bool")}function Sy(n){if(n==="float32"||n==="int32")return 4;if(n==="complex64")return 8;if(n==="bool")return 1;throw new Error(`Unknown dtype ${n}`)}function RP(n){if(n==null)return 0;let t=0;return n.forEach(e=>t+=e.length),t}function Iy(n){return typeof n=="string"||n instanceof String}function g6(n){return typeof n=="boolean"}function y6(n){return typeof n=="number"}function Ep(n){return Array.isArray(n)?Ep(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray?"int32":y6(n)?"float32":Iy(n)?"string":g6(n)?"bool":"float32"}function Ey(n){return!!(n&&n.constructor&&n.call&&n.apply)}function Ty(n,t){for(let e=t;e<n;++e)if(n%e===0)return e;return n}function bc(n){let t=n.length;if(t<2)return[];let e=new Array(t-1);e[t-2]=n[t-1];for(let r=t-3;r>=0;--r)e[r]=e[r+1]*n[r+1];return e}function x6(n,t,e,r=!1){let o=new Array;if(t.length===1){let i=t[0]*(r?2:1);for(let s=0;s<i;s++)o[s]=e[n+s]}else{let i=t[0],s=t.slice(1),a=s.reduce((l,c)=>l*c)*(r?2:1);for(let l=0;l<i;l++)o[l]=x6(n+l*a,s,e,r)}return o}function jh(n,t,e=!1){if(n.length===0)return t[0];let r=n.reduce((o,i)=>o*i)*(e?2:1);if(r===0)return[];if(r!==t.length)throw new Error(`[${n}] does not match the input size ${t.length}${e?" for a complex tensor":""}.`);return x6(0,n,t,e)}function u1e(n,t){if(Array.isArray(n))return n;if(t==="float32")return n instanceof Float32Array?n:new Float32Array(n);if(t==="int32")return n instanceof Int32Array?n:new Int32Array(n);if(t==="bool"||t==="string")return Uint8Array.from(new Int32Array(n));throw new Error(`Unknown dtype ${t}`)}function yb(n,t){let e=Dy(n,t);for(let r=0;r<e.length;r++)e[r]=1;return e}function Dy(n,t){if(t==null||t==="float32"||t==="complex64")return new Float32Array(n);if(t==="int32")return new Int32Array(n);if(t==="bool")return new Uint8Array(n);throw new Error(`Unknown data type ${t}`)}function d1e(n,t){let e=n.reduce((r,o)=>r*o,1);if(t==null||t==="float32")return jh(n,new Float32Array(e));if(t==="int32")return jh(n,new Int32Array(e));if(t==="bool")return jh(n,new Uint8Array(e));throw new Error(`Unknown data type ${t}`)}function rr(n){n.forEach(t=>{L(Number.isInteger(t)&&t>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${n}].`)})}function p1e(n,t,e){if(t===0)return 0;if(t===1)return n[0];let r=n[n.length-1];for(let o=0;o<n.length-1;++o)r+=e[o]*n[o];return r}function f1e(n,t,e){if(t===0)return[];if(t===1)return[n];let r=new Array(t);for(let o=0;o<r.length-1;++o)r[o]=Math.floor(n/e[o]),n-=r[o]*e[o];return r[r.length-1]=n,r}function qh(n){return n&&n.then&&typeof n.then=="function"}var v6="tfjsflags",xb=class{constructor(t){this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=m1e,this.populateURLFlags()}setPlatform(t,e){this.platform!=null&&(q().getBool("IS_TEST")||q().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${t}.`)),this.platformName=t,this.platform=e}registerFlag(t,e,r){if(this.flagRegistry[t]={evaluationFn:e,setHook:r},this.urlFlags[t]!=null){let o=this.urlFlags[t];q().getBool("IS_TEST")||q().getBool("PROD")||console.warn(`Setting feature override from URL ${t}: ${o}.`),this.set(t,o)}}getAsync(t){return B(this,null,function*(){return t in this.flags?this.flags[t]:(this.flags[t]=yield this.evaluateFlag(t),this.flags[t])})}get(t){if(t in this.flags)return this.flags[t];let e=this.evaluateFlag(t);if(qh(e))throw new Error(`Flag ${t} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[t]=e,this.flags[t]}getNumber(t){return this.get(t)}getBool(t){return this.get(t)}getString(t){return this.get(t)}getFlags(){return this.flags}get features(){return this.flags}set(t,e){if(this.flagRegistry[t]==null)throw new Error(`Cannot set flag ${t} as it has not been registered.`);this.flags[t]=e,this.flagRegistry[t].setHook!=null&&this.flagRegistry[t].setHook(e)}evaluateFlag(t){if(this.flagRegistry[t]==null)throw new Error(`Cannot evaluate flag '${t}': no evaluation function found.`);return this.flagRegistry[t].evaluationFn()}setFlags(t){this.flags=Object.assign({},t)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;let t=this.getQueryParams(this.global.location.search);v6 in t&&t[v6].split(",").forEach(r=>{let[o,i]=r.split(":");this.urlFlags[o]=y1e(o,i)})}};function m1e(n){let t={};return n.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(e,...r)=>(g1e(t,r[0],r[1]),r.join("="))),t}function g1e(n,t,e){n[decodeURIComponent(t)]=decodeURIComponent(e||"")}function y1e(n,t){let e=t.toLowerCase();return e==="true"||e==="false"?e==="true":`${+e}`===e?+e:t}function q(){return OP}var OP=null;function b6(n){OP=n}var MP;function PP(){if(MP==null){let n;if(typeof window<"u")n=window;else if(typeof global<"u")n=global;else if(typeof process<"u")n=process;else if(typeof self<"u")n=self;else throw new Error("Could not find a global object");MP=n}return MP}function x1e(){let n=PP();return n._tfGlobals==null&&(n._tfGlobals=new Map),n._tfGlobals}function vb(n,t){let e=x1e();if(e.has(n))return e.get(n);{let r=t();return e.set(n,r),e.get(n)}}var wc="Abs",Oa="Acos",Ma="Acosh",hs="Add",Cc="AddN",Tp="All",Dp="Any",_c="ArgMax",Sc="ArgMin",Pa="Asin",Fa="Asinh",La="Atan",$a="Atanh",Va="Atan2",Ic="AvgPool",kp="AvgPoolGrad",Ec="AvgPool3D",Np="AvgPool3DGrad",Tc="BatchMatMul",Dc="BatchToSpaceND",Ap="Bincount",Kh="BitwiseAnd",w6="BroadcastTo",Rp="BroadcastArgs",$s="Cast",Ba="Ceil",za="ClipByValue",Op="Complex",kc="ComplexAbs",Nc="Concat",Ac="Conv2D",Mp="Conv2DBackpropFilter",Rc="Conv2DBackpropInput",Oc="Conv3D",Pp="Conv3DBackpropFilterV2",Fp="Conv3DBackpropInputV2",Ua="Cos",Wa="Cosh",Lp="Cumprod",Mc="Cumsum",$p="CropAndResize",Vp="DenseBincount",Bp="DepthToSpace",Pc="DepthwiseConv2dNative",zp="DepthwiseConv2dNativeBackpropFilter",Up="DepthwiseConv2dNativeBackpropInput",Wp="Diag",Fc="Dilation2D",Xh="Dilation2DBackpropInput",Yh="Dilation2DBackpropFilter",Zh="Draw",Ga="RealDiv",Gp="Einsum",ja="Elu",jp="EluGrad",Ha="Erf",yd="Equal",qa="Exp",Lc="ExpandDims",Ka="Expm1",Hp="FFT",qp="Fill",Kp="FlipLeftRight",Xa="Floor",Ya="FloorDiv",$c="FusedBatchNorm",Vc="GatherV2",Xp="GatherNd",xd="Greater",Za="GreaterEqual",Vs="Identity",Yp="IFFT",Zp="Imag",Qa="IsFinite",Ja="IsInf",el="IsNan",Bc="LeakyRelu",vd="Less",bd="LessEqual",Qp="LinSpace",tl="Log",nl="Log1p",wd="LogicalAnd",Cd="LogicalNot",_d="LogicalOr";var C6="LogSoftmax";var zc="LRN",Jp="LRNGrad";var Uc="Max",rl="Maximum",Wc="MaxPool",ef="MaxPoolGrad",Gc="MaxPool3D",tf="MaxPool3DGrad",nf="MaxPoolWithArgmax",jc="Mean",Hc="Min",ol="Minimum",qc="MirrorPad",il="Mod",rf="Multinomial",sl="Multiply",Kc="Neg",Sd="NotEqual",of="NonMaxSuppressionV3",ky="NonMaxSuppressionV4",sf="NonMaxSuppressionV5",Xc="OnesLike",Yc="OneHot",Zc="Pack",Qc="PadV2";var al="Pow",Jc="Prelu",eu="Prod",Ny="RaggedGather",Ay="RaggedRange",Ry="RaggedTensorToTensor",af="Range",lf="Real",ll="Reciprocal",cl="Relu",tu="Reshape",nu="ResizeNearestNeighbor",cf="ResizeNearestNeighborGrad",ru="ResizeBilinear",uf="ResizeBilinearGrad",ul="Relu6",ou="Reverse",dl="Round",pl="Rsqrt",df="ScatterNd",pf="TensorScatterUpdate",ff="SearchSorted",iu="Select",fl="Selu",su="Slice",hl="Sin",ml="Sinh",gl="Sign",yl="Sigmoid",xl="Softplus",vl="Sqrt",au="Sum",lu="SpaceToBatchND",cu="SplitV",uu="Softmax",Oy="SparseFillEmptyRows",My="SparseReshape",hf="SparseSegmentMean",mf="SparseSegmentSum",gf="SparseToDense",bl="SquaredDifference",yf="Square",Qh="StaticRegexReplace",xf="StridedSlice",vf="StringNGrams",Py="StringSplit",Fy="StringToHashBucketFast",wl="Sub",Cl="Tan",_l="Tanh",Bs="Tile",bf="TopK",wf="Transform",zs="Transpose",Ly="Unique",du="Unpack",pu="UnsortedSegmentSum";var fu="ZerosLike",Sl="Step",Jh="FromPixels",Cf="RotateWithOffset",Id="_FusedMatMul",Ed="FusedConv2D",Td="FusedDepthwiseConv2D";function hu(...n){q().getBool("IS_TEST")||q().getBool("PROD")||console.warn(...n)}function v1e(...n){q().getBool("IS_TEST")||q().getBool("PROD")||console.log(...n)}var SI=vb("kernelRegistry",()=>new Map),FP=vb("gradRegistry",()=>new Map);function $y(n,t){let e=I6(n,t);return SI.get(e)}function LP(n){return FP.get(n)}function $P(n){let t=SI.entries(),e=[];for(;;){let{done:r,value:o}=t.next();if(r)break;let[i,s]=o,[a]=i.split("_");a===n&&e.push(s)}return e}function Vy(n){let{kernelName:t,backendName:e}=n,r=I6(t,e);SI.has(r)&&hu(`The kernel '${t}' for backend '${e}' is already registered`),SI.set(r,n)}function S6(n){let{kernelName:t}=n;FP.has(t)&&q().getBool("DEBUG")&&hu(`Overriding the gradient for '${t}'`),FP.set(t,n)}function I6(n,t){return`${t}_${n}`}var b={};bn(b,{arraysEqual:()=>zi,arraysEqualWithNull:()=>TP,assert:()=>L,assertNonNegativeIntegerDimensions:()=>rr,assertNonNull:()=>fs,assertShapesMatch:()=>br,bytesFromStringArray:()=>RP,bytesPerElement:()=>Sy,checkConversionForErrors:()=>NP,clamp:()=>_y,computeStrides:()=>bc,convertBackendValuesAndArrayBuffer:()=>u1e,createScalarValue:()=>E1e,createShuffledIndices:()=>s1e,decodeString:()=>Gy,distSquared:()=>n1e,encodeString:()=>Wy,fetch:()=>D1e,fingerPrint64:()=>I1e,flatten:()=>Sf,getArrayFromDType:()=>_I,getTypedArrayFromDType:()=>kP,hasEncodingLoss:()=>c1e,hexToLong:()=>bb,indexToLoc:()=>f1e,inferDtype:()=>Ep,inferFromImplicitShape:()=>l1e,isBoolean:()=>g6,isFunction:()=>Ey,isInt:()=>gd,isNumber:()=>y6,isPromise:()=>qh,isScalarShape:()=>r1e,isString:()=>Iy,isTypedArray:()=>Mo,isValidDtype:()=>AP,locToIndex:()=>p1e,makeOnesTypedArray:()=>yb,makeZerosNestedTypedArray:()=>d1e,makeZerosTypedArray:()=>Dy,nearestDivisor:()=>Ty,nearestLargerEven:()=>JIe,now:()=>om,parseAxisParam:()=>Mr,randUniform:()=>t1e,repeatedTry:()=>a1e,rightPad:()=>Hh,shuffle:()=>m6,shuffleCombo:()=>QIe,sizeFromShape:()=>Mt,sizeToSquarishShape:()=>i1e,squeezeShape:()=>DP,sum:()=>e1e,swap:()=>CI,tanh:()=>o1e,toNestedArray:()=>jh,toTypedArray:()=>Uy});function II(n){return n instanceof Float32Array||n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray}var UP=rg(F6());var rm=UP.default||UP;function bb(n){return rm.fromString(n,!0,16)}var $6=bb("c3a5c85c97cb3127"),nm=bb("b492b66fbe98f273"),Ko=bb("9ae16a3b2f90404f");function zP(n){return n.xor(n.shru(47))}function V6(n,t,e){let r=n.slice(t,t+e);return rm.fromBytes(Array.from(r),!0,!0)}function or(n,t){return V6(n,t,8)}function L6(n,t){return V6(n,t,4)}function uo(n,t){return t===0?n:n.shru(t).or(n.shl(64-t))}function _f(n,t,e=bb("9ddfea08eb382d69")){let r=n.xor(t).mul(e);r=r.xor(r.shru(47));let o=t.xor(r).mul(e);return o=o.xor(o.shru(47)),o=o.mul(e),o}function w1e(n,t,e,r,o,i){o=o.add(n),i=uo(i.add(o).add(r),21);let s=o;return o=o.add(t),o=o.add(e),i=i.add(uo(o,44)),[o.add(r),i.add(s)]}function TI(n,t,e,r){return w1e(or(n,t),or(n,t+8),or(n,t+16),or(n,t+24),e,r)}function C1e(n,t=n.length){if(t>=8){let e=Ko.add(t*2),r=or(n,0).add(Ko),o=or(n,t-8),i=uo(o,37).mul(e).add(r),s=uo(r,25).add(o).mul(e);return _f(i,s,e)}if(t>=4){let e=Ko.add(t*2),r=L6(n,0);return _f(r.shl(3).add(t),L6(n,t-4),e)}if(t>0){let e=n[0],r=n[t>>1],o=n[t-1],i=e+(r<<8),s=t+(o<<2);return zP(Ko.mul(i).xor($6.mul(s))).mul(Ko)}return Ko}function _1e(n,t=n.length){let e=Ko.add(t*2),r=or(n,0).mul(nm),o=or(n,8),i=or(n,t-8).mul(e),s=or(n,t-16).mul(Ko);return _f(uo(r.add(o),43).add(uo(i,30)).add(s),r.add(uo(o.add(Ko),18)).add(i),e)}function S1e(n,t=n.length){let e=Ko.add(t*2),r=or(n,0).mul(Ko),o=or(n,8),i=or(n,t-8).mul(e),s=or(n,t-16).mul(Ko),a=uo(r.add(o),43).add(uo(i,30)).add(s),l=_f(a,r.add(uo(o.add(Ko),18)).add(i),e),c=or(n,16).mul(e),u=or(n,24),d=a.add(or(n,t-32)).mul(e),p=l.add(or(n,t-24)).mul(e);return _f(uo(c.add(u),43).add(uo(d,30)).add(p),c.add(uo(u.add(r),18)).add(d),e)}function I1e(n,t=n.length){let e=rm.fromNumber(81,!0);if(t<=32)return t<=16?C1e(n,t):_1e(n,t);if(t<=64)return S1e(n,t);let r=e,o=e.mul(nm).add(113),i=zP(o.mul(Ko).add(113)).mul(Ko),s=[rm.UZERO,rm.UZERO],a=[rm.UZERO,rm.UZERO];r=r.mul(Ko).add(or(n,0));let l=0,c=(t-1>>6)*64,u=c+(t-1&63)-63;do r=uo(r.add(o).add(s[0]).add(or(n,l+8)),37).mul(nm),o=uo(o.add(s[1]).add(or(n,l+48)),42).mul(nm),r=r.xor(a[1]),o=o.add(s[0]).add(or(n,l+40)),i=uo(i.add(a[0]),33).mul(nm),s=TI(n,l,s[1].mul(nm),r.add(a[0])),a=TI(n,l+32,i.add(a[1]),o.add(or(n,l+16))),[i,r]=[r,i],l+=64;while(l!==c);let d=nm.add(i.and(255).shl(1));return l=u,a[0]=a[0].add(t-1&63),s[0]=s[0].add(a[0]),a[0]=a[0].add(s[0]),r=uo(r.add(o).add(s[0]).add(or(n,l+8)),37).mul(d),o=uo(o.add(s[1]).add(or(n,l+48)),42).mul(d),r=r.xor(a[1].mul(9)),o=o.add(s[0].mul(9).add(or(n,l+40))),i=uo(i.add(a[0]),33).mul(d),s=TI(n,l,s[1].mul(d),r.add(a[0])),a=TI(n,l+32,i.add(a[1]),o.add(or(n,l+16))),[i,r]=[r,i],_f(_f(s[0],a[0],d).add(zP(o).mul($6)).add(i),_f(s[1],a[1],d).add(r),d)}function E1e(n,t){return t==="string"?Wy(n):Uy([n],t)}function T1e(n,t){return n instanceof Float32Array&&t==="float32"||n instanceof Int32Array&&t==="int32"||n instanceof Uint8Array&&t==="bool"}function Uy(n,t){if(t==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=Sf(n)),q().getBool("DEBUG")&&NP(n,t),T1e(n,t))return n;if(t==null||t==="float32"||t==="complex64")return new Float32Array(n);if(t==="int32")return new Int32Array(n);if(t==="bool"){let e=new Uint8Array(n.length);for(let r=0;r<e.length;++r)Math.round(n[r])!==0&&(e[r]=1);return e}else throw new Error(`Unknown data type ${t}`)}function om(){return q().platform.now()}function D1e(n,t){return q().platform.fetch(n,t)}function Wy(n,t="utf-8"){return t=t||"utf-8",q().platform.encode(n,t)}function Gy(n,t="utf-8"){return t=t||"utf-8",q().platform.decode(n,t)}function Mo(n){return q().platform.isTypedArray!=null?q().platform.isTypedArray(n):II(n)}function Sf(n,t=[],e=!1){if(t==null&&(t=[]),typeof n=="boolean"||typeof n=="number"||typeof n=="string"||qh(n)||n==null||Mo(n)&&e)t.push(n);else if(Array.isArray(n)||Mo(n))for(let r=0;r<n.length;++r)Sf(n[r],t,e);else{let r=-1;for(let o of Object.keys(n))/^([1-9]+[0-9]*|0)$/.test(o)&&(r=Math.max(r,Number(o)));for(let o=0;o<=r;o++)Sf(n[o],t,e)}return t}var DI=class{constructor(t,e){this.backendTimer=t,this.logger=e,e==null&&(this.logger=new WP)}profileKernel(t,e,r){let o,i=()=>{o=r()},s,a=om();if(this.backendTimer.timerAvailable())s=this.backendTimer.time(i);else{i();for(let c of o)c.dataSync();s=Promise.resolve({kernelMs:om()-a})}if(q().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let c=0;c<o.length;c++){let u=o[c];u.data().then(d=>{k1e(d,u.dtype,t)})}return{kernelName:t,outputs:o,inputs:e,timeMs:s.then(c=>c.kernelMs),extraInfo:s.then(c=>c.getExtraProfileInfo!=null?c.getExtraProfileInfo():"")}}logKernelProfile(t){let{kernelName:e,outputs:r,timeMs:o,inputs:i,extraInfo:s}=t;r.forEach(a=>{Promise.all([a.data(),o,s]).then(l=>{this.logger.logKernelProfile(e,a,l[0],l[1],i,l[2])})})}};function k1e(n,t,e){if(t!=="float32")return!1;for(let r=0;r<n.length;r++){let o=n[r];if(isNaN(o)||!isFinite(o))return console.warn(`Found ${o} in the result of '${e}'`),!0}return!1}var WP=class{logKernelProfile(t,e,r,o,i,s){let a=typeof o=="number"?Hh(`${o}ms`,9):o.error,l=Hh(t,25),c=e.rank,u=e.size,d=Hh(e.shape.toString(),14),p="";for(let f in i){let h=i[f];if(h!=null){let m=h.shape||e.shape,g=m.length;p+=`${f}: ${g}D ${g>0?m:""} `}}console.log(`%c${l}	%c${a}	%c${c}D ${d}	%c${u}	%c${p}	%c${s}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}};function B6(n,t,e){let r={},o={};for(let l=0;l<t.length;l++)r[t[l].id]=!0;for(let l=0;l<n.length;l++){let c=n[l],u=c.inputs;for(let d in u){let p=u[d],f=!1;for(let h=0;h<t.length;h++)if(r[p.id]){c.outputs.forEach(m=>r[m.id]=!0),f=!0,o[c.id]=!0;break}if(f)break}}let i={};i[e.id]=!0;let s={};for(let l=n.length-1;l>=0;l--){let c=n[l],u=c.inputs;for(let d=0;d<c.outputs.length;d++)if(i[c.outputs[d].id]){for(let p in u)i[u[p].id]=!0,s[c.id]=!0;break}}let a=[];for(let l=0;l<n.length;l++){let c=n[l];if(o[c.id]&&s[c.id]){let u={};for(let p in c.inputs){let f=c.inputs[p];r[f.id]&&(u[p]=f)}let d=Object.assign({},c);d.inputs=u,d.outputs=c.outputs,a.push(d)}}return a}function z6(n,t,e,r){for(let o=t.length-1;o>=0;o--){let i=t[o],s=[];if(i.outputs.forEach(l=>{let c=n[l.id];c!=null?s.push(c):s.push(null)}),i.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${i.kernelName}.`);let a=i.gradient(s);for(let l in i.inputs){if(!(l in a))throw new Error(`Cannot backprop through input ${l}. Available gradients found: ${Object.keys(a)}.`);let c=e(()=>a[l]());if(c.dtype!=="float32")throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input ${l} must have 'float32' dtype, but has '${c.dtype}'`);let u=i.inputs[l];if(!zi(c.shape,u.shape))throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input '${l}' has shape '${c.shape}', which does not match the shape of the input '${u.shape}'`);if(n[u.id]==null)n[u.id]=c;else{let d=n[u.id];n[u.id]=r(d,c),d.dispose()}}}}var U6=20,wb=3,GP=7;function W6(n,t,e,r){let o=bc(t),i=N1e(n,t,e,o),s=t.length,a=kI(n,t,e,o,i),l=["Tensor"];return r&&(l.push(`  dtype: ${e}`),l.push(`  rank: ${s}`),l.push(`  shape: [${t}]`),l.push("  values:")),l.push(a.map(c=>"    "+c).join(`
`)),l.join(`
`)}function N1e(n,t,e,r){let o=Mt(t),i=r[r.length-1],s=new Array(i).fill(0),a=t.length,l=e==="complex64"?_b(n):n;if(a>1)for(let c=0;c<o/i;c++){let u=c*i;for(let d=0;d<i;d++)s[d]=Math.max(s[d],Cb(l[u+d],0,e).length)}return s}function Cb(n,t,e){let r;return Array.isArray(n)?r=`${parseFloat(n[0].toFixed(GP))} + ${parseFloat(n[1].toFixed(GP))}j`:Iy(n)?r=`'${n}'`:e==="bool"?r=G6(n):r=parseFloat(n.toFixed(GP)).toString(),Hh(r,t)}function G6(n){return n===0?"false":"true"}function kI(n,t,e,r,o,i=!0){let s=e==="complex64"?2:1,a=t[0],l=t.length;if(l===0){if(e==="complex64"){let m=_b(n);return[Cb(m[0],0,e)]}return e==="bool"?[G6(n[0])]:[n[0].toString()]}if(l===1){if(a>U6){let g=wb*s,y=Array.from(n.slice(0,g)),v=Array.from(n.slice((a-wb)*s,a*s));return e==="complex64"&&(y=_b(y),v=_b(v)),["["+y.map((w,C)=>Cb(w,o[C],e)).join(", ")+", ..., "+v.map((w,C)=>Cb(w,o[a-wb+C],e)).join(", ")+"]"]}return["["+(e==="complex64"?_b(n):Array.from(n)).map((g,y)=>Cb(g,o[y],e)).join(", ")+"]"]}let c=t.slice(1),u=r.slice(1),d=r[0]*s,p=[];if(a>U6){for(let m=0;m<wb;m++){let g=m*d,y=g+d;p.push(...kI(n.slice(g,y),c,e,u,o,!1))}p.push("...");for(let m=a-wb;m<a;m++){let g=m*d,y=g+d;p.push(...kI(n.slice(g,y),c,e,u,o,m===a-1))}}else for(let m=0;m<a;m++){let g=m*d,y=g+d;p.push(...kI(n.slice(g,y),c,e,u,o,m===a-1))}let f=l===2?",":"";p[0]="["+(a>0?p[0]+f:"");for(let m=1;m<p.length-1;m++)p[m]=" "+p[m]+f;let h=`,
`;for(let m=2;m<l;m++)h+=`
`;return p[p.length-1]=" "+p[p.length-1]+"]"+(i?"":h),p}function _b(n){let t=[];for(let e=0;e<n.length;e+=2)t.push([n[e],n[e+1]]);return t}var an=class{constructor(t,e,r){if(this.dtype=e,this.shape=t.slice(),this.size=Mt(t),r!=null){let o=r.length;L(o===this.size,()=>`Length of values '${o}' does not match the size inferred by the shape '${this.size}'.`)}if(e==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||_I(e,this.size),this.strides=bc(t)}set(t,...e){e.length===0&&(e=[0]),L(e.length===this.rank,()=>`The number of provided coordinates (${e.length}) must match the rank (${this.rank})`);let r=this.locToIndex(e);this.values[r]=t}get(...t){t.length===0&&(t=[0]);let e=0;for(let o of t){if(o<0||o>=this.shape[e]){let i=`Requested out of range element at ${t}.   Buffer shape=${this.shape}`;throw new Error(i)}e++}let r=t[t.length-1];for(let o=0;o<t.length-1;++o)r+=this.strides[o]*t[o];return this.values[r]}locToIndex(t){if(this.rank===0)return 0;if(this.rank===1)return t[0];let e=t[t.length-1];for(let r=0;r<t.length-1;++r)e+=this.strides[r]*t[r];return e}indexToLoc(t){if(this.rank===0)return[];if(this.rank===1)return[t];let e=new Array(this.shape.length);for(let r=0;r<e.length-1;++r)e[r]=Math.floor(t/this.strides[r]),t-=e[r]*this.strides[r];return e[e.length-1]=t,e}get rank(){return this.shape.length}toTensor(){return El().makeTensor(this.values,this.shape,this.dtype)}},El=null,jy=null,A1e=null;function j6(n){El=n}function H6(n){jy=n}function q6(n){A1e=n}var bt=class{constructor(t,e,r,o){this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=e||"float32",this.size=Mt(t),this.strides=bc(t),this.dataId=r,this.id=o,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}buffer(){return B(this,null,function*(){let t=yield this.data();return jy.buffer(this.shape,this.dtype,t)})}bufferSync(){return jy.buffer(this.shape,this.dtype,this.dataSync())}array(){return B(this,null,function*(){let t=yield this.data();return jh(this.shape,t,this.dtype==="complex64")})}arraySync(){return jh(this.shape,this.dataSync(),this.dtype==="complex64")}data(){return B(this,null,function*(){this.throwIfDisposed();let t=El().read(this.dataId);if(this.dtype==="string"){let e=yield t;try{return e.map(r=>Gy(r))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return t})}dataToGPU(t){return this.throwIfDisposed(),El().readToGPU(this.dataId,t)}dataSync(){this.throwIfDisposed();let t=El().readSync(this.dataId);if(this.dtype==="string")try{return t.map(e=>Gy(e))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return t}bytes(){return B(this,null,function*(){this.throwIfDisposed();let t=yield El().read(this.dataId);return this.dtype==="string"?t:new Uint8Array(t.buffer)})}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),El().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(t=!1){return jy.print(this,t)}clone(){return this.throwIfDisposed(),jy.clone(this)}toString(t=!1){let e=this.dataSync();return W6(e,this.shape,this.dtype,t)}cast(t){return this.throwIfDisposed(),jy.cast(this,t)}variable(t=!0,e,r){return this.throwIfDisposed(),El().makeVariable(this,t,e,r)}};Object.defineProperty(bt,Symbol.hasInstance,{value:n=>!!n&&n.data!=null&&n.dataSync!=null&&n.throwIfDisposed!=null});function j(){return vb("Tensor",()=>bt)}j();var Dd=class extends bt{constructor(t,e,r,o){super(t.shape,t.dtype,t.dataId,o),this.trainable=e,this.name=r}assign(t){if(t.dtype!==this.dtype)throw new Error(`dtype of the new value (${t.dtype}) and previous value (${this.dtype}) must match`);if(!zi(t.shape,this.shape))throw new Error(`shape of the new value (${t.shape}) and previous value (${this.shape}) must match`);El().disposeTensor(this),this.dataId=t.dataId,El().incRef(this,null)}dispose(){El().disposeVariable(this),this.isDisposedInternal=!0}};Object.defineProperty(Dd,Symbol.hasInstance,{value:n=>n instanceof bt&&n.assign!=null&&n.assign instanceof Function});var K6=function(n){return n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64",n}(K6||{}),X6=function(n){return n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64",n}(X6||{}),Y6=function(n){return n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64",n}(Y6||{}),Z6=function(n){return n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64",n}(Z6||{}),R1e={float32:Y6,int32:K6,bool:X6,complex64:Z6};function En(n,t){if(n==="string"||t==="string"){if(n==="string"&&t==="string")return"string";throw new Error(`Can not upcast ${n} with ${t}`)}return R1e[n][t]}function kd(n){return En(n,"int32")}function NI(n){return n!=null&&typeof n=="object"&&"texture"in n&&n.texture instanceof WebGLTexture}function AI(n){return typeof GPUBuffer<"u"&&n!=null&&typeof n=="object"&&"buffer"in n&&n.buffer instanceof GPUBuffer}function Pt(n,t){if(n.dtype===t.dtype)return[n,t];let e=En(n.dtype,t.dtype);return[n.cast(e),t.cast(e)]}function Q6(n,t){L(n.dtype===t.dtype,()=>`The dtypes of the first(${n.dtype}) and second(${t.dtype}) input must match`)}function RI(n){let t=[];return J6(n,t,new Set),t}function J6(n,t,e){if(n==null)return;if(n instanceof bt){t.push(n);return}if(!O1e(n))return;let r=n;for(let o in r){let i=r[o];e.has(i)||(e.add(i),J6(i,t,e))}}function O1e(n){return Array.isArray(n)||typeof n=="object"}function jP(n){return n.kernelName!=null}var OI=class{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(t=>t.name)))}}}dispose(){for(let t in this.registeredVariables)this.registeredVariables[t].dispose()}},P1e=(()=>{class n{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new OI}ready(){return B(this,null,function*(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;let e=this.getSortedBackends();for(let r=0;r<e.length;r++){let o=e[r];if(yield this.initializeBackend(o).success){yield this.setBackend(o);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")})}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){let{name:e,asyncInit:r}=this.initializeBackendsAndReturnBest();if(r)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){let{asyncInit:r}=this.initializeBackend(e);if(r)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,r,o=1){return e in this.registryFactory?(hu(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:r,priority:o},!0)}setBackend(e){return B(this,null,function*(){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;let{success:r,asyncInit:o}=this.initializeBackend(e);if(!(o?yield r:r))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new DI(this.backendInstance),!0})}setupRegisteredKernels(){$P(this.backendName).forEach(r=>{r.setupFunc!=null&&r.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){$P(e).forEach(o=>{o.disposeFunc!=null&&o.disposeFunc(this.registry[e])})}initializeBackend(e){let r=this.registryFactory[e];if(r==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{let o=r.factory();if(o&&!(o instanceof Ra)&&typeof o.then=="function"){let i=++this.pendingBackendInitId,s=o.then(a=>i<this.pendingBackendInitId?!1:(this.registry[e]=a,this.pendingBackendInit=null,!0)).catch(a=>(i<this.pendingBackendInitId||(this.pendingBackendInit=null,hu(`Initialization of backend ${e} failed`),hu(a.stack||a.message)),!1));return this.pendingBackendInit=s,{success:s,asyncInit:!0}}else return this.registry[e]=o,{success:!0,asyncInit:!1}}catch(o){return hu(`Initialization of backend ${e} failed`),hu(o.stack||o.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,r)=>this.registryFactory[r].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){let e=this.getSortedBackends();for(let r=0;r<e.length;r++){let o=e[r],{success:i,asyncInit:s}=this.initializeBackend(o);if(s||i)return{name:o,asyncInit:s}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,r){let o=this.state.tensorInfo.get(r),i=o.backend,s=this.readSync(r),a=i.refCount(r);i.disposeData(r,!0),o.backend=e,e.move(r,s,o.shape,o.dtype,a),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,r){let o=null;if(r==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");r=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof r!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");o=e}let i;return this.scopedRun(()=>this.startScope(o),()=>this.endScope(i),()=>(i=r(),i instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),i))}scopedRun(e,r,o){e();try{let i=o();return r(),i}catch(i){throw r(),i}}nextTensorId(){return n.nextTensorId++}nextVariableId(){return n.nextVariableId++}clone(e){let r=P.runKernel(Vs,{x:e}),o={x:e},i=a=>({x:()=>{let l="float32",c={x:a},u={dtype:l};return P.runKernel($s,c,u)}}),s=[];return this.addTapeNode(this.state.activeScope.name,o,[r],i,s,{}),r}runKernel(e,r,o){if(this.backendName==null&&this.backend,!($y(e,this.backendName)!=null))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:r,attrs:o})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,r,o){let i=this.backend.numDataIds(),s=0;o.forEach(c=>{s+=c.dtype==="complex64"?3:1});let a=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],l=i-r-s-a;if(l>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${l} data ids) after running '${e}'`)}runKernelFunc(e){let r,o=[],i=this.isTapeOn(),s=this.state.numBytes,a=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let l;this.backendName==null&&this.backend;let c,u=jP(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(jP(e)){let{kernelName:m,inputs:g,attrs:y}=e;this.backendName==null&&this.backend;let v=$y(m,this.backendName);L(v!=null,()=>`Cannot find registered kernel '${m}' for backend '${this.backendName}'`),l=()=>{let w=this.backend.numDataIds();c=v.kernelFunc({inputs:g,attrs:y,backend:this.backend});let C=Array.isArray(c)?c:[c];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(m,w,C);let I=C.map(A=>A.rank!=null?A:this.makeTensorFromTensorInfo(A));if(i){let A=this.getTensorsForGradient(m,g,I);o=this.saveTensorsForBackwardMode(A)}return I}}else{let{forwardFunc:m}=e,g=y=>{i&&(o=y.map(v=>this.keep(this.clone(v))))};l=()=>{let y=this.backend.numDataIds();c=this.tidy(()=>m(this.backend,g));let v=Array.isArray(c)?c:[c];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(u,y,v),v}}let{inputs:d,attrs:p}=e,f=jP(e)?null:e.backwardsFunc,h;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?r=l():(h=this.profiler.profileKernel(u,d,()=>l()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(h),r=h.outputs)}),i&&this.addTapeNode(u,d,r,f,o,p),this.state.profiling&&this.state.activeProfile.kernels.push({name:u,bytesAdded:this.state.numBytes-s,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-a,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(d).map(m=>d[m]!=null?d[m].shape:null),outputShapes:r.map(m=>m.shape),kernelTimeMs:h.timeMs,extraInfo:h.extraInfo}),Array.isArray(c)?r:r[0]}saveTensorsForBackwardMode(e){return e.map(o=>this.keep(this.clone(o)))}getTensorsForGradient(e,r,o){let i=LP(e);if(i!=null){let s=i.inputsToSave||[],a=i.outputsToSave||[],l;i.saveAllInputs?(L(Array.isArray(r),()=>"saveAllInputs is true, expected inputs to be an array."),l=Object.keys(r).map(u=>r[u])):l=s.map(u=>r[u]);let c=o.filter((u,d)=>a[d]);return l.concat(c)}return[]}makeTensor(e,r,o,i){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");o=o||"float32",i=i||this.backend;let s=e;o==="string"&&Iy(e[0])&&(s=e.map(c=>Wy(c)));let a=i.write(s,r,o),l=new bt(r,o,a,this.nextTensorId());if(this.trackTensor(l,i),o==="string"){let c=this.state.tensorInfo.get(a),u=RP(s);this.state.numBytes+=u-c.bytes,c.bytes=u}return l}makeTensorFromDataId(e,r,o,i){o=o||"float32";let s={dataId:e,shape:r,dtype:o};return this.makeTensorFromTensorInfo(s,i)}makeTensorFromTensorInfo(e,r){let{dataId:o,shape:i,dtype:s}=e,a=new bt(i,s,o,this.nextTensorId());return this.trackTensor(a,r),a}makeVariable(e,r=!0,o,i){o=o||this.nextVariableId().toString(),i!=null&&i!==e.dtype&&(e=e.cast(i));let s=new Dd(e,r,o,this.nextTensorId());if(this.state.registeredVariables[s.name]!=null)throw new Error(`Variable with name ${s.name} was already registered`);return this.state.registeredVariables[s.name]=s,this.incRef(s,this.backend),s}trackTensor(e,r){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let o=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(o=e.size*Sy(e.dtype)),this.state.numBytes+=o,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:r||this.backend,dtype:e.dtype,shape:e.shape,bytes:o})),e instanceof Dd||this.track(e)}incRef(e,r){this.trackTensor(e,r),this.backend.incRef(e.dataId)}removeDataId(e,r){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===r&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;let r=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=r.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){let o=e.size*Sy(e.dtype);this.state.numBytes-=o}r.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,r.backend)}disposeVariables(){for(let e in this.state.registeredVariables){let r=this.state.registeredVariables[e];this.disposeVariable(r)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){let e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}profile(e){return B(this,null,function*(){this.state.profiling=!0;let r=this.state.numBytes,o=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=yield e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(i=>i.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-r,this.state.activeProfile.newTensors=this.state.numTensors-o;for(let i of this.state.activeProfile.kernels)i.kernelTimeMs=yield i.kernelTimeMs,i.extraInfo=yield i.extraInfo;return this.state.activeProfile})}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,r,o,i,s,a){let l={id:this.state.nextTapeNodeId++,kernelName:e,inputs:r,outputs:o,saved:s},c=LP(e);c!=null&&(i=c.gradFunc),i!=null&&(l.gradient=u=>(u=u.map((d,p)=>{if(d==null){let f=o[p],h=Dy(f.size,f.dtype);return this.makeTensor(h,f.shape,f.dtype)}return d}),i(u.length>1?u:u[0],s,a))),this.state.activeTape.push(l)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){let r={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(r.name=e),this.state.scopeStack.push(r),this.state.activeScope=r}endScope(e){let r=RI(e),o=new Set(r.map(s=>s.id));for(let s=0;s<this.state.activeScope.track.length;s++){let a=this.state.activeScope.track[s];!a.kept&&!o.has(a.id)&&a.dispose()}let i=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],r.forEach(s=>{!s.kept&&s.scopeId===i.id&&this.track(s)})}gradients(e,r,o,i=!1){if(L(r.length>0,()=>"gradients() received an empty list of xs."),o!=null&&o.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${o.dtype}'`);let s=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));L(s instanceof bt,()=>"The result y returned by f() must be a tensor.");let a=B6(this.state.activeTape,r,s);if(!i&&a.length===0&&r.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{let l={};l[s.id]=o??F1e(s.shape),z6(l,a,u=>this.tidy(u),L1e);let c=r.map(u=>l[u.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(u=>{for(let d of u.saved)d.dispose()}),this.state.activeTape=null),{value:s,grads:c}})}customGrad(e){return L(Ey(e),()=>"The f passed in customGrad(f) must be a function."),(...r)=>{L(r.every(l=>l instanceof bt),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let o,i={};r.forEach((l,c)=>{i[c]=l});let s=(l,c)=>(o=e(...r,c),L(o.value instanceof bt,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),L(Ey(o.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),o.value),a=(l,c)=>{let u=o.gradFunc(l,c),d=Array.isArray(u)?u:[u];L(d.length===r.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),L(d.every(f=>f instanceof bt),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");let p={};return d.forEach((f,h)=>{p[h]=()=>f}),p};return this.runKernelFunc({forwardFunc:s,backwardsFunc:a,inputs:i})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,r){return this.state.tensorInfo.get(e).backend.readToGPU(e,r)}time(e){return B(this,null,function*(){let r=om(),o=yield this.backend.time(e);return o.wallMs=om()-r,o})}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new OI;for(let e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}return n.nextTensorId=0,n.nextVariableId=0,n})();function F1e(n){let t=yb(Mt(n),"float32");return P.makeTensor(t,n,"float32")}function HP(){let n=PP();if(n._tfengine==null){let t=new xb(n);n._tfengine=new P1e(t)}return b6(n._tfengine.ENV),j6(()=>n._tfengine),n._tfengine}var P=HP();function L1e(n,t){let e={a:n,b:t};return P.runKernel(hs,e)}var If={};bn(If,{isBrowser:()=>KP,isMobile:()=>B1e,mockIsMobile:()=>V1e});function $1e(){return typeof navigator<"u"&&navigator!=null}var qP;function V1e(n){qP=n}function B1e(n){if(qP!==void 0)return qP;if(n||$1e()){if(n||(n=navigator),n.product==="ReactNative")return!0;let t=n.userAgent||n.vendor||(typeof window<"u"?window.opera:"");if(!t){let e=n;return e.userAgentData&&e.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))}return!1}function KP(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var pi=q();pi.registerFlag("DEBUG",()=>!1,n=>{n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});pi.registerFlag("IS_BROWSER",()=>KP());pi.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");pi.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));pi.registerFlag("IS_SAFARI",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor));pi.registerFlag("PROD",()=>!1);pi.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>pi.getBool("DEBUG"));pi.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);pi.registerFlag("IS_TEST",()=>!1);pi.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>pi.getBool("DEBUG"));pi.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);pi.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);pi.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);function fi(n,t){let e=n;if(Mo(n))return t==="string"?[]:[n.length];if(NI(n)){let o=n.channels||"RGBA";return[n.height,n.width*o.length]}else if(AI(n))return[n.buffer.size/(t==null?4:Sy(t))];if(!Array.isArray(n))return[];let r=[];for(;Array.isArray(e)||Mo(e)&&t!=="string";)r.push(e.length),e=e[0];return Array.isArray(n)&&q().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&t5(n,r,[]),r}function t5(n,t,e){if(e=e||[],!Array.isArray(n)&&!Mo(n)){L(t.length===0,()=>`Element arr[${e.join("][")}] is a primitive, but should be an array/TypedArray of ${t[0]} elements`);return}L(t.length>0,()=>`Element arr[${e.join("][")}] should be a primitive, but is an array of ${n.length} elements`),L(n.length===t[0],()=>`Element arr[${e.join("][")}] should have ${t[0]} elements, but has ${n.length} elements`);let r=t.slice(1);for(let o=0;o<n.length;++o)t5(n[o],r,e.concat(o))}function e5(n,t,e,r){if(n!=="string_or_numeric"){if(n==null)throw new Error("Expected dtype cannot be null.");if(n!=="numeric"&&n!==t||n==="numeric"&&t==="string")throw new Error(`Argument '${e}' passed to '${r}' must be ${n} tensor, but got ${t} tensor`)}}function k(n,t,e,r="numeric"){if(n instanceof j())return e5(r,n.dtype,t,e),n;let o=Ep(n);if(o!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(o=r),e5(r,o,t,e),n==null||!Mo(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string"){let l=n==null?"null":n.constructor.name;throw new Error(`Argument '${t}' passed to '${e}' must be a Tensor or TensorLike, but got '${l}'`)}let i=fi(n,o);!Mo(n)&&!Array.isArray(n)&&(n=[n]);let a=o!=="string"?Uy(n,o):Sf(n,[],!0);return P.makeTensor(a,i,o)}function im(n,t,e,r="numeric"){if(!Array.isArray(n))throw new Error(`Argument ${t} passed to ${e} must be a \`Tensor[]\` or \`TensorLike[]\``);return n.map((i,s)=>k(i,`${t}[${s}]`,e,r))}var XP="__op";function R(n){let t=Object.keys(n);if(t.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${t.length} keys.`);let e=t[0],r=n[e];e.endsWith("_")&&(e=e.substring(0,e.length-1)),e=e+XP;let o=(...i)=>{P.startScope(e);try{let s=r(...i);return qh(s)&&console.error("Cannot return a Promise inside of tidy."),P.endScope(s),s}catch(s){throw P.endScope(null),s}};return Object.defineProperty(o,"name",{value:e,configurable:!0}),o}function z1e(n,t){let e=k(n,"real","complex"),r=k(t,"imag","complex");br(e.shape,r.shape,`real and imag shapes, ${e.shape} and ${r.shape}, must match in call to tf.complex().`);let o={real:e,imag:r};return P.runKernel(Op,o)}var hi=R({complex_:z1e});function Xo(n,t,e,r){if(r==null)r=Ep(n);else if(r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(AI(n)||NI(n)){if(r!=="float32"&&r!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${r}.`);return P.backend.createTensorFromGPUData(n,t||e,r)}if(!Mo(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(t!=null){rr(t);let o=Mt(t),i=Mt(e);L(o===i,()=>`Based on the provided shape, [${t}], the tensor should have ${o} values but has ${i}`);for(let s=0;s<e.length;++s){let a=e[s],l=s===e.length-1?a!==Mt(t.slice(s)):!0;L(e[s]===t[s]||!l,()=>`Error creating a new Tensor. Inferred shape (${e}) does not match the provided shape (${t}). `)}}return!Mo(n)&&!Array.isArray(n)&&(n=[n]),t=t||e,n=r!=="string"?Uy(n,r):Sf(n,[],!0),P.makeTensor(n,t,r)}function Yr(n,t,e){let r=fi(n,e);return Xo(n,t,r,e)}var Nd={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};var bo=class n{static join(t){return new n(t).slice()}constructor(t){if(this.shards=[],this.previousShardIndex=0,t==null||(t instanceof Array||(t=[t]),t=t.map(r=>Mo(r)?r.buffer:r),t.length===0))return;this.bufferUniformSize=t[0].byteLength;let e=0;for(let r=0;r<t.length;r++){let o=t[r];r!==t.length-1&&o.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);let i=e+o.byteLength;this.shards.push({buffer:o,start:e,end:i}),e=i}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(t=0,e=this.byteLength){if(this.shards.length===0)return new ArrayBuffer(0);if(t=isNaN(Number(t))?0:t,e=isNaN(Number(e))?0:e,t=Math.max(0,t),e=Math.min(this.byteLength,e),e<=t)return new ArrayBuffer(0);let r=this.findShardForByte(t);if(r===-1)throw new Error(`Could not find start shard for byte ${t}`);let o=e-t,i=new ArrayBuffer(o),s=new Uint8Array(i),a=0;for(let l=r;l<this.shards.length;l++){let c=this.shards[l],d=t+a-c.start,p=a,h=Math.min(e,c.end)-c.start,m=new Uint8Array(c.buffer,d,h-d);if(s.set(m,p),a+=m.length,e<c.end)break}return i}findShardForByte(t){if(this.shards.length===0||t<0||t>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(t/this.bufferUniformSize),this.previousShardIndex;function e(o){return t<o.start?-1:t>=o.end?1:0}if(e(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;let r=U1e(this.shards,e);return r===-1?-1:(this.previousShardIndex=r,this.previousShardIndex)}};function U1e(n,t){let e=0,r=n.length;for(;e<=r;){let o=Math.floor((r-e)/2)+e,i=t(n[o]);if(i===0)return o;i<0?r=o:e=o+1}return-1}function W1e(n){q().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(n+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}q6(W1e);function Zr(){return P}function Sb(){return P.memory()}function Z(n,t){return P.tidy(n,t)}function He(n){RI(n).forEach(e=>e.dispose())}function Wn(n){return P.keep(n)}function YP(n){return P.setBackend(n)}function n5(){return P.ready()}function sm(){return P.backendName}function Hy(n,t,e=1){return P.registerBackend(n,t,e)}function mu(){return P.backend}var Ef=4;function i5(n,t){return B(this,null,function*(){let e=[],r=[],o=Array.isArray(n)?n.map(s=>s.name):Object.keys(n);for(let s=0;s<o.length;++s){let a=o[s],l=Array.isArray(n)?n[s].tensor:n[a];if(l.dtype!=="float32"&&l.dtype!=="int32"&&l.dtype!=="bool"&&l.dtype!=="string"&&l.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${a}': ${l.dtype}`);let c={name:a,shape:l.shape,dtype:l.dtype};if(l.dtype==="string"){let u=new Promise(d=>B(this,null,function*(){let p=yield l.bytes(),f=p.reduce((g,y)=>g+y.length,0)+Ef*p.length,h=new Uint8Array(f),m=0;for(let g=0;g<p.length;g++){let y=p[g],v=new Uint8Array(new Uint32Array([y.length]).buffer);h.set(v,m),m+=Ef,h.set(y,m),m+=y.length}d(h)}));r.push(u)}else r.push(l.data());t!=null&&(c.group=t),e.push(c)}let i=yield Promise.all(r);return{data:H1e(i),specs:e}})}function MI(n,t){let e=new bo(n),r={},o=0;for(let i of t){let s=G1e(i,(a,l)=>e.slice(o+a,o+l));r[i.name]=s5(i,e.slice(o,o+s)),o+=s}return r}function G1e(n,t){let e=Mt(n.shape),r;if("quantization"in n){let o=n.quantization;r=Nd[o.dtype]}else if(n.dtype==="string"){let o=0;for(let i=0;i<e;i++)o+=Ef+new Uint32Array(t(o,o+Ef))[0];return o}else r=Nd[n.dtype];return e*r}function j1e(n,t){return B(this,null,function*(){let e=Mt(n.shape),r;if("quantization"in n){let o=n.quantization;r=Nd[o.dtype]}else if(n.dtype==="string"){let o=0;for(let i=0;i<e;i++)o+=Ef+new Uint32Array(yield t(o,o+Ef))[0];return o}else r=Nd[n.dtype];return e*r})}function s5(n,t){let e=n.name,r=n.dtype,o=n.shape,i=Mt(o),s,a=0;if("quantization"in n){let l=n.quantization;if(l.dtype==="uint8"||l.dtype==="uint16"){if(!("min"in l&&"scale"in l))throw new Error(`Weight ${n.name} with quantization ${l.dtype} doesn't have corresponding metadata min and scale.`)}else if(l.dtype==="float16"){if(r!=="float32")throw new Error(`Weight ${n.name} is quantized with ${l.dtype} which only supports weights of type float32 not ${r}.`)}else throw new Error(`Weight ${n.name} has unknown quantization dtype ${l.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);let c=Nd[l.dtype],u=l.dtype==="uint8"?new Uint8Array(t):new Uint16Array(t);if(r==="float32")if(l.dtype==="uint8"||l.dtype==="uint16"){s=new Float32Array(u.length);for(let d=0;d<u.length;d++){let p=u[d];s[d]=p*l.scale+l.min}}else if(l.dtype==="float16")s=Y1e()(u);else throw new Error(`Unsupported quantization type ${l.dtype} for weight type float32.`);else if(r==="int32"){if(l.dtype!=="uint8"&&l.dtype!=="uint16")throw new Error(`Unsupported quantization type ${l.dtype} for weight type int32.`);s=new Int32Array(u.length);for(let d=0;d<u.length;d++){let p=u[d];s[d]=Math.round(p*l.scale+l.min)}}else throw new Error(`Unsupported dtype in weight '${e}': ${r}`);a+=i*c}else if(r==="string"){let l=Mt(n.shape);s=[];for(let c=0;c<l;c++){let u=new Uint32Array(t.slice(a,a+Ef))[0];a+=Ef;let d=new Uint8Array(t.slice(a,a+u));s.push(d),a+=u}}else{let l=Nd[r];if(r==="float32")s=new Float32Array(t);else if(r==="int32")s=new Int32Array(t);else if(r==="bool")s=new Uint8Array(t);else if(r==="complex64"){s=new Float32Array(t);let c=new Float32Array(s.length/2),u=new Float32Array(s.length/2);for(let h=0;h<c.length;h++)c[h]=s[h*2],u[h]=s[h*2+1];let d=Yr(c,o,"float32"),p=Yr(u,o,"float32"),f=hi(d,p);return d.dispose(),p.dispose(),f}else throw new Error(`Unsupported dtype in weight '${e}': ${r}`);a+=i*l}return Yr(s,o,r)}function r5(n,t,e){return B(this,null,function*(){let r=new Uint8Array(t);for(;r.byteLength<e;){let{done:o,value:i}=yield n.read();if(o&&i==null){let a=e-r.byteLength;throw new Error(`Reader is done but ${a} bytes are still expected`)}let s=new Uint8Array(r.length+i.byteLength);s.set(r,0),s.set(new Uint8Array(i),r.length),r=s}return r.buffer})}function PI(n,t){return B(this,null,function*(){let e={},r=n.getReader(),o=new ArrayBuffer(0);for(let i of t){let s=yield j1e(i,(c,u)=>B(this,null,function*(){return o=yield r5(r,o,u),o.slice(c,u)}));o=yield r5(r,o,s);let a=o.slice(0,s);o=o.slice(s);let l=s5(i,a);if(e[i.name]=l,sm()==="webgpu"){let c=mu();"uploadToGPU"in c&&Mt(l.shape)>=q().get("WEBGPU_CPU_HANDOFF_SIZE_THRESHOLD")&&c.uploadToGPU(l.dataId)}}return e})}function H1e(n){if(n===null)throw new Error(`Invalid input value: ${JSON.stringify(n)}`);let t=0,e=[];n.forEach(i=>{if(t+=i.byteLength,e.push(i.byteLength===i.buffer.byteLength?i:new i.constructor(i)),!(i instanceof Float32Array||i instanceof Int32Array||i instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${i.constructor.name}`)});let r=new Uint8Array(t),o=0;return e.forEach(i=>{r.set(new Uint8Array(i.buffer),o),o+=i.byteLength}),r.buffer}var ZP=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function o5(n){return ZP?Buffer.byteLength(n,"utf8"):new Blob([n]).size}function a5(n){if(ZP)return Buffer.from(n).toString("base64");let t=new Uint8Array(n),e="";for(let r=0,o=t.length;r<o;r++)e+=String.fromCharCode(t[r]);return btoa(e)}function l5(n){if(ZP){let r=Buffer.from(n,"base64");return r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength)}let t=atob(n),e=new Uint8Array(t.length);for(let r=0;r<t.length;++r)e.set([t.charCodeAt(r)],r);return e.buffer}function c5(n){return bo.join(n)}function QP(n){let t="/";for(n=n.trim();n.endsWith(t);)n=n.slice(0,n.length-1);let e=n.split(t);return e[e.length-1]}function FI(n,t){let e={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,weightsManifest:t};return n.signature!=null&&(e.signature=n.signature),n.userDefinedMetadata!=null&&(e.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(e.modelInitializer=n.modelInitializer),n.initializerSignature!=null&&(e.initializerSignature=n.initializerSignature),n.trainingConfig!=null&&(e.trainingConfig=n.trainingConfig),e}function JP(n,t,e){let r={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy};if(n.trainingConfig!=null&&(r.trainingConfig=n.trainingConfig),n.weightsManifest!=null){if(!t)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!e)throw new Error("modelJSON has weightsManifest but weightData is null");r.weightSpecs=t,r.weightData=e}return n.signature!=null&&(r.signature=n.signature),n.userDefinedMetadata!=null&&(r.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(r.modelInitializer=n.modelInitializer),n.initializerSignature!=null&&(r.initializerSignature=n.initializerSignature),r}function qy(n,t){return B(this,null,function*(){let e,r;return n.weightsManifest!=null&&([e,r]=yield t(n.weightsManifest)),JP(n,e,r)})}function gu(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:n.modelTopology==null?0:o5(JSON.stringify(n.modelTopology)),weightSpecsBytes:n.weightSpecs==null?0:o5(JSON.stringify(n.weightSpecs)),weightDataBytes:n.weightData==null?0:new bo(n.weightData).byteLength}}function Ib(n){let t=[];for(let e of n)t.push(...e.weights);return t}function q1e(){let n=e=>{let r=e<<13,o=0;for(;!(r&8388608);)o-=8388608,r<<=1;return r&=-8388609,o+=947912704,r|o},t=new Uint32Array(2048);t[0]=0;for(let e=1;e<1024;e++)t[e]=n(e);for(let e=1024;e<2048;e++)t[e]=939524096+(e-1024<<13);return t}function K1e(){let n=new Uint32Array(64);n[0]=0,n[31]=1199570944,n[32]=2147483648,n[63]=3347054592;for(let t=1;t<31;t++)n[t]=t<<23;for(let t=33;t<63;t++)n[t]=2147483648+(t-32<<23);return n}function X1e(){let n=new Uint32Array(64);for(let t=0;t<64;t++)n[t]=1024;return n[0]=n[32]=0,n}function Y1e(){let n=q1e(),t=K1e(),e=X1e();return r=>{let o=new ArrayBuffer(4*r.length),i=new Uint32Array(o);for(let s=0;s<r.length;s++){let a=r[s],l=n[e[a>>10]+(a&1023)]+t[a>>10];i[s]=l}return new Float32Array(o)}}var Qr=class n{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return n.instance==null&&(n.instance=new n),n.instance}static registerSaveRouter(t){n.getInstance().saveRouters.push(t)}static registerLoadRouter(t){n.getInstance().loadRouters.push(t)}static getSaveHandlers(t){return n.getHandlers(t,"save")}static getLoadHandlers(t,e){return n.getHandlers(t,"load",e)}static getHandlers(t,e,r){let o=[];return(e==="load"?n.getInstance().loadRouters:n.getInstance().saveRouters).forEach(s=>{let a=s(t,r);a!==null&&o.push(a)}),o}},u5=n=>Qr.registerSaveRouter(n),d5=n=>Qr.registerLoadRouter(n),p5=n=>Qr.getSaveHandlers(n),f5=(n,t)=>Qr.getLoadHandlers(n,t);var eF="tensorflowjs",tF=1,am="models_store",Tf="model_info_store";function h5(){if(!q().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");let n=typeof window>"u"?self:window,t=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(t==null)throw new Error("The current browser does not appear to support IndexedDB.");return t}function nF(n){let t=n.result;t.createObjectStore(am,{keyPath:"modelPath"}),t.createObjectStore(Tf,{keyPath:"modelPath"})}var lm=(()=>{class n{constructor(e){if(this.indexedDB=h5(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}save(e){return B(this,null,function*(){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)})}load(){return B(this,null,function*(){return this.databaseAction(this.modelPath)})}databaseAction(e,r){return new Promise((o,i)=>{let s=this.indexedDB.open(eF,tF);s.onupgradeneeded=()=>nF(s),s.onsuccess=()=>{let a=s.result;if(r==null){let l=a.transaction(am,"readonly"),u=l.objectStore(am).get(this.modelPath);u.onsuccess=()=>{if(u.result==null)return a.close(),i(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));o(u.result.modelArtifacts)},u.onerror=d=>(a.close(),i(u.error)),l.oncomplete=()=>a.close()}else{r.weightData=bo.join(r.weightData);let l=gu(r),c=a.transaction(Tf,"readwrite"),u=c.objectStore(Tf),d;try{d=u.put({modelPath:this.modelPath,modelArtifactsInfo:l})}catch(f){return i(f)}let p;d.onsuccess=()=>{p=a.transaction(am,"readwrite");let f=p.objectStore(am),h;try{h=f.put({modelPath:this.modelPath,modelArtifacts:r,modelArtifactsInfo:l})}catch(m){return i(m)}h.onsuccess=()=>o({modelArtifactsInfo:l}),h.onerror=m=>{u=c.objectStore(Tf);let g=u.delete(this.modelPath);g.onsuccess=()=>(a.close(),i(h.error)),g.onerror=y=>(a.close(),i(h.error))}},d.onerror=f=>(a.close(),i(d.error)),c.oncomplete=()=>{p==null?a.close():p.oncomplete=()=>a.close()}}},s.onerror=a=>i(s.error)})}}return n.URL_SCHEME="indexeddb://",n})();var m5=n=>q().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(lm.URL_SCHEME)?Z1e(n.slice(lm.URL_SCHEME.length)):null;Qr.registerSaveRouter(m5);Qr.registerLoadRouter(m5);function Z1e(n){return new lm(n)}function Q1e(n){return n.startsWith(lm.URL_SCHEME)?n.slice(lm.URL_SCHEME.length):n}var LI=class{constructor(){this.indexedDB=h5()}listModels(){return B(this,null,function*(){return new Promise((t,e)=>{let r=this.indexedDB.open(eF,tF);r.onupgradeneeded=()=>nF(r),r.onsuccess=()=>{let o=r.result,i=o.transaction(Tf,"readonly"),a=i.objectStore(Tf).getAll();a.onsuccess=()=>{let l={};for(let c of a.result)l[c.modelPath]=c.modelArtifactsInfo;t(l)},a.onerror=l=>(o.close(),e(a.error)),i.oncomplete=()=>o.close()},r.onerror=o=>e(r.error)})})}removeModel(t){return B(this,null,function*(){return t=Q1e(t),new Promise((e,r)=>{let o=this.indexedDB.open(eF,tF);o.onupgradeneeded=()=>nF(o),o.onsuccess=()=>{let i=o.result,s=i.transaction(Tf,"readwrite"),a=s.objectStore(Tf),l=a.get(t),c;l.onsuccess=()=>{if(l.result==null)return i.close(),r(new Error(`Cannot find model with path '${t}' in IndexedDB.`));{let u=a.delete(t),d=()=>{c=i.transaction(am,"readwrite");let f=c.objectStore(am).delete(t);f.onsuccess=()=>e(l.result.modelArtifactsInfo),f.onerror=h=>r(l.error)};u.onsuccess=d,u.onerror=p=>(d(),i.close(),r(l.error))}},l.onerror=u=>(i.close(),r(l.error)),s.oncomplete=()=>{c==null?i.close():c.oncomplete=()=>i.close()}},o.onerror=i=>r(o.error)})})}};var Ad="/",Ky="tensorflowjs_models",g5="info",J1e="model_topology",eEe="weight_specs",tEe="weight_data",nEe="model_metadata";function y5(n){return{info:[Ky,n,g5].join(Ad),topology:[Ky,n,J1e].join(Ad),weightSpecs:[Ky,n,eEe].join(Ad),weightData:[Ky,n,tEe].join(Ad),modelMetadata:[Ky,n,nEe].join(Ad)}}function x5(n){for(let t of Object.values(n))window.localStorage.removeItem(t)}function rEe(n){let t=n.split(Ad);if(t.length<3)throw new Error(`Invalid key format: ${n}`);return t.slice(1,t.length-1).join(Ad)}function oEe(n){return n.startsWith(cm.URL_SCHEME)?n.slice(cm.URL_SCHEME.length):n}var cm=(()=>{class n{constructor(e){if(!q().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=y5(this.modelPath)}save(e){return B(this,null,function*(){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{let r=JSON.stringify(e.modelTopology),o=JSON.stringify(e.weightSpecs),i=gu(e),s=bo.join(e.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(i)),this.LS.setItem(this.keys.topology,r),this.LS.setItem(this.keys.weightSpecs,o),this.LS.setItem(this.keys.weightData,a5(s));let a={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(a)),{modelArtifactsInfo:i}}catch{throw x5(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${i.modelTopologyBytes}, weightSpecsBytes=${i.weightSpecsBytes}, weightDataBytes=${i.weightDataBytes}.`)}}})}load(){return B(this,null,function*(){let e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");let r={},o=JSON.parse(this.LS.getItem(this.keys.topology));if(o==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);r.modelTopology=o;let i=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(i==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);r.weightSpecs=i;let s=this.LS.getItem(this.keys.modelMetadata);if(s!=null){let l=JSON.parse(s);r.format=l.format,r.generatedBy=l.generatedBy,r.convertedBy=l.convertedBy,l.signature!=null&&(r.signature=l.signature),l.userDefinedMetadata!=null&&(r.userDefinedMetadata=l.userDefinedMetadata),l.modelInitializer!=null&&(r.modelInitializer=l.modelInitializer),l.initializerSignature!=null&&(r.initializerSignature=l.initializerSignature),l.trainingConfig!=null&&(r.trainingConfig=l.trainingConfig)}let a=this.LS.getItem(this.keys.weightData);if(a==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return r.weightData=l5(a),r})}}return n.URL_SCHEME="localstorage://",n})();var v5=n=>q().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(cm.URL_SCHEME)?iEe(n.slice(cm.URL_SCHEME.length)):null;Qr.registerSaveRouter(v5);Qr.registerLoadRouter(v5);function iEe(n){return new cm(n)}var $I=class{constructor(){L(q().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),L(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}listModels(){return B(this,null,function*(){let t={},e=Ky+Ad,r=Ad+g5;for(let o=0;o<this.LS.length;++o){let i=this.LS.key(o);if(i.startsWith(e)&&i.endsWith(r)){let s=rEe(i);t[s]=JSON.parse(this.LS.getItem(i))}}return t})}removeModel(t){return B(this,null,function*(){t=oEe(t);let e=y5(t);if(this.LS.getItem(e.info)==null)throw new Error(`Cannot find model at path '${t}'`);let r=JSON.parse(this.LS.getItem(e.info));return x5(e),r})}};var Xy="://",Tl=class n{constructor(){this.managers={}}static getInstance(){return n.instance==null&&(n.instance=new n),n.instance}static registerManager(t,e){L(t!=null,()=>"scheme must not be undefined or null."),t.endsWith(Xy)&&(t=t.slice(0,t.indexOf(Xy))),L(t.length>0,()=>"scheme must not be an empty string.");let r=n.getInstance();L(r.managers[t]==null,()=>`A model store manager is already registered for scheme '${t}'.`),r.managers[t]=e}static getManager(t){let e=n.getInstance().managers[t];if(e==null)throw new Error(`Cannot find model manager for scheme '${t}'`);return e}static getSchemes(){return Object.keys(n.getInstance().managers)}};function VI(n){if(n.indexOf(Xy)===-1)throw new Error(`The url string provided does not contain a scheme. Supported schemes are: ${Tl.getSchemes().join(",")}`);return{scheme:n.split(Xy)[0],path:n.split(Xy)[1]}}function b5(n,t,e=!1){return B(this,null,function*(){L(n!==t,()=>`Old path and new path are the same: '${n}'`);let r=Qr.getLoadHandlers(n);L(r.length>0,()=>`Copying failed because no load handler is found for source URL ${n}.`),L(r.length<2,()=>`Copying failed because more than one (${r.length}) load handlers for source URL ${n}.`);let o=r[0],i=Qr.getSaveHandlers(t);L(i.length>0,()=>`Copying failed because no save handler is found for destination URL ${t}.`),L(i.length<2,()=>`Copying failed because more than one (${r.length}) save handlers for destination URL ${t}.`);let s=i[0],a=VI(n).scheme,l=VI(n).path,c=a===VI(n).scheme,u=yield o.load();e&&c&&(yield Tl.getManager(a).removeModel(l));let d=yield s.save(u);return e&&!c&&(yield Tl.getManager(a).removeModel(l)),d.modelArtifactsInfo})}function w5(){return B(this,null,function*(){let n=Tl.getSchemes(),t={};for(let e of n){let r=yield Tl.getManager(e).listModels();for(let o in r){let i=e+Xy+o;t[i]=r[o]}}return t})}function C5(n){return B(this,null,function*(){let t=VI(n);return Tl.getManager(t.scheme).removeModel(t.path)})}function _5(n,t){return B(this,null,function*(){return b5(n,t,!1)})}function S5(n,t){return B(this,null,function*(){return b5(n,t,!0)})}var rF=class{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(t,e){return fetch(t,e)}now(){return performance.now()}encode(t,e){if(e!=="utf-8"&&e!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${e}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(t)}decode(t,e){return new TextDecoder(e).decode(t)}setTimeoutCustom(t,e){if(typeof window>"u"||!q().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(t,e);return}this.functionRefs.push(t),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},e),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",r=>{if(r.source===window&&r.data.name===this.messageName){r.stopPropagation();let o=this.functionRefs[r.data.index];o(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}isTypedArray(t){return II(t)}};if(q().get("IS_BROWSER")){q().setPlatform("browser",new rF);try{Tl.registerManager(cm.URL_SCHEME,new $I)}catch{}try{Tl.registerManager(lm.URL_SCHEME,new LI)}catch{}}var aEe={importFetch:()=>E5()},oF;var iF=class{constructor(){this.util=T5(),this.textEncoder=new this.util.TextEncoder}fetch(t,e){return q().global.fetch!=null?q().global.fetch(t,e):(oF==null&&(oF=aEe.importFetch()),oF(t,e))}now(){let t=process.hrtime();return t[0]*1e3+t[1]/1e6}encode(t,e){if(e!=="utf-8"&&e!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${e}`);return this.textEncoder.encode(t)}decode(t,e){return t.length===0?"":new this.util.TextDecoder(e).decode(t)}isTypedArray(t){return this.util.types.isFloat32Array(t)||this.util.types.isInt32Array(t)||this.util.types.isUint8Array(t)||this.util.types.isUint8ClampedArray(t)}};q().get("IS_NODE")&&!q().get("IS_BROWSER")&&q().setPlatform("node",new iF);function ze(n,t="float32",e){return t=t||"float32",rr(n),new an(n,t,e)}function lEe(n,t){let e=k(n,"x","cast");if(!AP(t))throw new Error(`Failed to cast to unknown dtype ${t}`);if(t==="string"&&e.dtype!=="string"||t!=="string"&&e.dtype==="string")throw new Error("Only strings can be casted to strings");let r={x:e},o={dtype:t};return P.runKernel($s,r,o)}var me=R({cast_:lEe});function cEe(n){let e={x:k(n,"x","clone","string_or_numeric")};return P.runKernel(Vs,e)}var Yo=R({clone_:cEe});function BI(n,t=!1){console.log(n.toString(t))}HP();var uEe={buffer:ze,cast:me,clone:Yo,print:BI};H6(uEe);function dEe(n,t){let e=k(n,"a","add"),r=k(t,"b","add");[e,r]=Pt(e,r);let o={a:e,b:r};return P.runKernel(hs,o)}var ae=R({add_:dEe});function pEe(n,t){let e=k(n,"a","floorDiv"),r=k(t,"b","floorDiv");[e,r]=Pt(e,r);let o={a:e,b:r};return P.runKernel(Ya,o)}var Zy=R({floorDiv_:pEe});function fEe(n,t){let e=k(n,"a","div"),r=k(t,"b","div");if([e,r]=Pt(e,r),e.dtype==="int32"&&r.dtype==="int32")return Zy(e,r);let o={a:e,b:r},i={};return P.runKernel(Ga,o,i)}var Se=R({div_:fEe});function hEe(n,t){let e=k(n,"a","mul"),r=k(t,"b","mul");[e,r]=Pt(e,r);let o={a:e,b:r};return P.runKernel(sl,o)}var U=R({mul_:hEe});function mEe(n){let t=k(n,"x","abs");if(t.dtype==="complex64"){let e={x:t};return P.runKernel(kc,e)}else{let e={x:t};return P.runKernel(wc,e)}}var Bn=R({abs_:mEe});function gEe(n){let e={x:k(n,"x","acos")};return P.runKernel(Oa,e)}var zI=R({acos_:gEe});function yEe(n){let e={x:k(n,"x","acosh")};return P.runKernel(Ma,e)}var UI=R({acosh_:yEe});function xEe(n){L(Array.isArray(n),()=>"The argument passed to tf.addN() must be a list of tensors"),L(n.length>=1,()=>`Must pass at least one tensor to tf.addN(), but got ${n.length}`);let t=n.map((o,i)=>k(o,`tensors${i}`,"addN")),e=t[0];t.forEach(o=>{if(o.dtype!==e.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),t.forEach(o=>{if(!zi(o.shape,e.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});let r=t;return P.runKernel(Cc,r)}var D5=R({addN_:xEe});function vEe(n,t=null,e=!1){let o={x:k(n,"x","all","bool")},i={axis:t,keepDims:e};return P.runKernel(Tp,o,i)}var Qy=R({all_:vEe});function bEe(n,t=null,e=!1){let o={x:k(n,"x","any","bool")},i={axis:t,keepDims:e};return P.runKernel(Dp,o,i)}var dm=R({any_:bEe});function wEe(n,t=0){let r={x:k(n,"x","argMax")},o={axis:t};return P.runKernel(_c,r,o)}var js=R({argMax_:wEe});function CEe(n,t=0){let r={x:k(n,"x","argMin")},o={axis:t};return P.runKernel(Sc,r,o)}var WI=R({argMin_:CEe});function _Ee(n){let e={x:k(n,"x","asin")};return P.runKernel(Pa,e)}var GI=R({asin_:_Ee});function SEe(n){let e={x:k(n,"x","asinh")};return P.runKernel(Fa,e)}var jI=R({asinh_:SEe});function IEe(n){let e={x:k(n,"x","atan")};return P.runKernel(La,e)}var HI=R({atan_:IEe});function EEe(n,t){let e=k(n,"a","atan2"),r=k(t,"b","atan2");[e,r]=Pt(e,r);let o={a:e,b:r};return P.runKernel(Va,o)}var qI=R({atan2_:EEe});function TEe(n){let e={x:k(n,"x","atanh")};return P.runKernel($a,e)}var KI=R({atanh_:TEe});function DEe(n,t,e,r,o="NHWC",i){let s=n[3],a=[...t,s],l=N5(o);return pm(n,a,e,i,r,null,null,l)}function aF(n,t,e,r,o,i,s="channelsLast"){let[a,l]=Eb(t),c;if(s==="channelsLast")c=[a,l,n[3],n[3]];else if(s==="channelsFirst")c=[a,l,n[1],n[1]];else throw new Error(`Unknown dataFormat ${s}`);return pm(n,c,e,r,o,i,!1,s)}function kEe(n,t,e,r,o,i,s="NDHWC"){let[a,l,c]=sF(t),u,d;if(s==="NDHWC")d="channelsLast",u=[a,l,c,n[4],n[4]];else if(s==="NCDHW")d="channelsFirst",u=[a,l,c,n[1],n[1]];else throw new Error(`Unknown dataFormat ${s}`);return k5(n,u,e,r,o,!1,d,i)}function pm(n,t,e,r,o,i,s=!1,a="channelsLast"){let[l,c,u,d]=[-1,-1,-1,-1];if(a==="channelsLast")[l,c,u,d]=n;else if(a==="channelsFirst")[l,d,c,u]=n;else throw new Error(`Unknown dataFormat ${a}`);let[p,f,,h]=t,[m,g]=Eb(e),[y,v]=Eb(r),w=Jy(p,y),C=Jy(f,v),{padInfo:I,outHeight:A,outWidth:M}=REe(o,c,u,m,g,w,C,i,a),$=s?h*d:h,V;return a==="channelsFirst"?V=[l,$,A,M]:a==="channelsLast"&&(V=[l,A,M,$]),{batchSize:l,dataFormat:a,inHeight:c,inWidth:u,inChannels:d,outHeight:A,outWidth:M,outChannels:$,padInfo:I,strideHeight:m,strideWidth:g,filterHeight:p,filterWidth:f,effectiveFilterHeight:w,effectiveFilterWidth:C,dilationHeight:y,dilationWidth:v,inShape:n,outShape:V,filterShape:t}}function k5(n,t,e,r,o,i=!1,s="channelsLast",a){let[l,c,u,d,p]=[-1,-1,-1,-1,-1];if(s==="channelsLast")[l,c,u,d,p]=n;else if(s==="channelsFirst")[l,p,c,u,d]=n;else throw new Error(`Unknown dataFormat ${s}`);let[f,h,m,,g]=t,[y,v,w]=sF(e),[C,I,A]=sF(r),M=Jy(f,C),$=Jy(h,I),V=Jy(m,A),{padInfo:W,outDepth:K,outHeight:te,outWidth:ee}=OEe(o,c,u,d,y,v,w,M,$,V,a),oe=i?g*p:g,ie;return s==="channelsFirst"?ie=[l,oe,K,te,ee]:s==="channelsLast"&&(ie=[l,K,te,ee,oe]),{batchSize:l,dataFormat:s,inDepth:c,inHeight:u,inWidth:d,inChannels:p,outDepth:K,outHeight:te,outWidth:ee,outChannels:oe,padInfo:W,strideDepth:y,strideHeight:v,strideWidth:w,filterDepth:f,filterHeight:h,filterWidth:m,effectiveFilterDepth:M,effectiveFilterHeight:$,effectiveFilterWidth:V,dilationDepth:C,dilationHeight:I,dilationWidth:A,inShape:n,outShape:ie,filterShape:t}}function NEe(n,t,e,r,o){r==null&&(r=lF(n,t,e));let i=n[0],s=n[1],a=Tb((i-t+2*r)/e+1,o),l=Tb((s-t+2*r)/e+1,o);return[a,l]}function AEe(n,t,e,r,o,i){o==null&&(o=lF(n,t[0],r[0]));let s=[0,0,0,e];for(let a=0;a<3;a++)n[a]+2*o>=t[a]&&(s[a]=Tb((n[a]-t[a]+2*o)/r[a]+1,i));return s}function lF(n,t,e,r=1){let o=Jy(t,r);return Math.floor((n[0]*(e-1)-e+o)/2)}function Eb(n){return typeof n=="number"?[n,n,n]:n.length===2?[n[0],n[1],1]:n}function sF(n){return typeof n=="number"?[n,n,n]:n}function Jy(n,t){return t<=1?n:n+(n-1)*(t-1)}function REe(n,t,e,r,o,i,s,a,l){let c,u,d;if(typeof n=="number"){c={top:n,bottom:n,left:n,right:n,type:n===0?"VALID":"NUMBER"};let f=NEe([t,e],i,r,n,a);u=f[0],d=f[1]}else if(n==="same"){u=Math.ceil(t/r),d=Math.ceil(e/o);let p=Math.max(0,(u-1)*r+i-t),f=Math.max(0,(d-1)*o+s-e),h=Math.floor(p/2),m=p-h,g=Math.floor(f/2),y=f-g;c={top:h,bottom:m,left:g,right:y,type:"SAME"}}else if(n==="valid")c={top:0,bottom:0,left:0,right:0,type:"VALID"},u=Math.ceil((t-i+1)/r),d=Math.ceil((e-s+1)/o);else if(typeof n=="object"){let p=l==="channelsLast"?n[1][0]:n[2][0],f=l==="channelsLast"?n[1][1]:n[2][1],h=l==="channelsLast"?n[2][0]:n[3][0],m=l==="channelsLast"?n[2][1]:n[3][1];c={top:p,bottom:f,left:h,right:m,type:p===0&&f===0&&h===0&&m===0?"VALID":"EXPLICIT"},u=Tb((t-i+p+f)/r+1,a),d=Tb((e-s+h+m)/o+1,a)}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:c,outHeight:u,outWidth:d}}function OEe(n,t,e,r,o,i,s,a,l,c,u){let d,p,f,h;if(n==="valid"&&(n=0),typeof n=="number"){d={top:n,bottom:n,left:n,right:n,front:n,back:n,type:n===0?"VALID":"NUMBER"};let g=AEe([t,e,r,1],[a,l,c],1,[o,i,s],n,u);p=g[0],f=g[1],h=g[2]}else if(n==="same"){p=Math.ceil(t/o),f=Math.ceil(e/i),h=Math.ceil(r/s);let m=(p-1)*o+a-t,g=(f-1)*i+l-e,y=(h-1)*s+c-r,v=Math.floor(m/2),w=m-v,C=Math.floor(g/2),I=g-C,A=Math.floor(y/2),M=y-A;d={top:C,bottom:I,left:A,right:M,front:v,back:w,type:"SAME"}}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:d,outDepth:p,outHeight:f,outWidth:h}}function Tb(n,t){if(!t)return Math.trunc(n);switch(t){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error(`Unknown roundingMode ${t}`)}}function ms(n){let[t,e,r]=Eb(n);return t===1&&e===1&&r===1}function po(n,t){return ms(n)||ms(t)}function yu(n){return Eb(n).every(t=>t>0)}function N5(n){if(n==="NHWC")return"channelsLast";if(n==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${n}`)}function An(n,t,e){if(e!=null){if(typeof t=="string")throw Error(`Error in ${n}: pad must be an integer when using dimRoundingMode ${e} but got pad ${t}.`);if(typeof t=="number")L(gd(t),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${e} but got pad ${t}.`);else if(typeof t=="object")t.forEach(r=>{r.forEach(o=>{L(gd(o),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${e} but got pad ${o}.`)})});else throw Error(`Error in ${n}: Unknown padding parameter: ${t}`)}}function MEe(n,t){let r={x:k(n,"x","reshape","string_or_numeric")},o={shape:t};return P.runKernel(tu,r,o)}var G=R({reshape_:MEe});function PEe(n,t,e,r,o){let i=k(n,"x","avgPool","float32"),s=1;L(po(e,s),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${e} and dilations '${s}'`);let a=i,l=!1;i.rank===3&&(l=!0,a=G(i,[1,i.shape[0],i.shape[1],i.shape[2]])),L(a.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${a.rank}.`),An("avgPool",r,o);let c={x:a},u={filterSize:t,strides:e,pad:r,dimRoundingMode:o},d=P.runKernel(Ic,c,u);return d=me(d,i.dtype),l?G(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var Df=R({avgPool_:PEe});function FEe(n,t,e,r,o,i="NDHWC"){let s=k(n,"x","avgPool3d","float32"),a=s,l=!1;s.rank===4&&(l=!0,a=G(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),L(a.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`),L(i==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),L(typeof e=="number"&&e>0||Array.isArray(e)&&e[0]>0&&e[1]>0&&e[2]>0,()=>`Error in avgPool3d: Stride must be > 0, but got '${e}'`),An("avgPool3d",r,o);let c={x:a},u={filterSize:t,strides:e,pad:r,dimRoundingMode:o,dataFormat:i},d=P.runKernel(Ec,c,u);return d=me(d,a.dtype),l?G(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}var XI=R({avgPool3d_:FEe});function LEe(n,t=0){L(n.length>=1,()=>"Pass at least one tensor to concat");let e=im(n,"tensors","concat","string_or_numeric");if(e[0].dtype==="complex64"&&e.forEach(i=>{if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${i.dtype}. `)}),e.length===1)return Yo(e[0]);let r=e,o={axis:t};return P.runKernel(Nc,r,o)}var Gt=R({concat_:LEe});function $Ee(n,t,e=!1,r=!1){let o=k(n,"a","matMul"),i=k(t,"b","matMul");[o,i]=Pt(o,i);let s={a:o,b:i},a={transposeA:e,transposeB:r};return P.runKernel(Tc,s,a)}var _t=R({matMul_:$Ee});function VEe(n){let e={x:k(n,"x","sigmoid","float32")};return P.runKernel(yl,e)}var jr=R({sigmoid_:VEe});function BEe(n,t,e){let r=k(n,"x","slice","string_or_numeric");if(r.rank===0)throw new Error("Slicing scalar is not possible");let o={x:r},i={begin:t,size:e};return P.runKernel(su,o,i)}var Je=R({slice_:BEe});function zEe(n){let e={x:k(n,"x","tanh","float32")};return P.runKernel(_l,e)}var Dl=R({tanh_:zEe});function UEe(n,t,e,r,o,i){let s=k(n,"forgetBias","basicLSTMCell"),a=k(t,"lstmKernel","basicLSTMCell"),l=k(e,"lstmBias","basicLSTMCell"),c=k(r,"data","basicLSTMCell"),u=k(o,"c","basicLSTMCell"),d=k(i,"h","basicLSTMCell"),p=Gt([c,d],1),f=_t(p,a),h=ae(f,l),m=h.shape[0],g=h.shape[1]/4,y=[m,g],v=Je(h,[0,0],y),w=Je(h,[0,g],y),C=Je(h,[0,g*2],y),I=Je(h,[0,g*3],y),A=ae(U(jr(v),Dl(w)),U(u,jr(ae(s,C)))),M=U(Dl(A),jr(I));return[A,M]}var A5=R({basicLSTMCell_:UEe});function WEe(n,t,e){let r=k(n,"x","batchToSpaceND"),o=t.reduce((a,l)=>a*l);L(r.rank>=1+t.length,()=>`input rank is ${r.rank} but should be > than blockShape.length ${t.length}`),L(e.length===t.length,()=>`crops.length is ${e.length} but should be equal to blockShape.length  ${t.length}`),L(r.shape[0]%o===0,()=>`input tensor batch is ${r.shape[0]} but is not divisible by the product of the elements of blockShape ${t.join(" * ")} === ${o}`);let i={x:r},s={blockShape:t,crops:e};return P.runKernel(Dc,i,s)}var kf=R({batchToSpaceND_:WEe});function R5(n){let t;return n.rank===0||n.rank===1?t=G(n,[1,1,1,n.size]):n.rank===2?t=G(n,[1,1,n.shape[0],n.shape[1]]):n.rank===3?t=G(n,[1,n.shape[0],n.shape[1],n.shape[2]]):t=n,t}function GEe(n,t,e,r,o,i){i==null&&(i=.001);let s=k(n,"x","batchNorm"),a=k(t,"mean","batchNorm"),l=k(e,"variance","batchNorm"),c;o!=null&&(c=k(o,"scale","batchNorm"));let u;r!=null&&(u=k(r,"offset","batchNorm")),L(a.rank===l.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),L(u==null||a.rank===u.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),L(c==null||a.rank===c.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let p={x:R5(s),scale:c,offset:u,mean:a,variance:l},f={varianceEpsilon:i},h=P.runKernel($c,p,f);return G(h,s.shape)}var xu=R({batchNorm_:GEe});function jEe(n,t,e,r,o,i){let s=k(n,"x","batchNorm"),a=k(t,"mean","batchNorm"),l=k(e,"variance","batchNorm"),c;o!=null&&(c=k(o,"scale","batchNorm"));let u;return r!=null&&(u=k(r,"offset","batchNorm")),L(s.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${s.rank}.`),L(a.rank===2||a.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`),L(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${l.rank}.`),c!=null&&L(c.rank===2||c.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${c.rank}.`),u!=null&&L(u.rank===2||u.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${u.rank}.`),xu(s,a,l,u,c,i)}var YI=R({batchNorm2d_:jEe});function HEe(n,t,e,r,o,i){let s=k(n,"x","batchNorm"),a=k(t,"mean","batchNorm"),l=k(e,"variance","batchNorm"),c;o!=null&&(c=k(o,"scale","batchNorm"));let u;return r!=null&&(u=k(r,"offset","batchNorm")),L(s.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${s.rank}.`),L(a.rank===3||a.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`),L(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${l.rank}.`),c!=null&&L(c.rank===3||c.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${c.rank}.`),u!=null&&L(u.rank===3||u.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${u.rank}.`),xu(s,a,l,u,c,i)}var ZI=R({batchNorm3d_:HEe});function qEe(n,t,e,r,o,i){let s=k(n,"x","batchNorm"),a=k(t,"mean","batchNorm"),l=k(e,"variance","batchNorm"),c;o!=null&&(c=k(o,"scale","batchNorm"));let u;return r!=null&&(u=k(r,"offset","batchNorm")),L(s.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${s.rank}.`),L(a.rank===4||a.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`),L(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${l.rank}.`),c!=null&&L(c.rank===4||c.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${c.rank}.`),u!=null&&L(u.rank===4||u.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${u.rank}.`),xu(s,a,l,u,c,i)}var QI=R({batchNorm4d_:qEe});function KEe(n,t,e){let r=k(n,"x","bincount"),o=k(t,"weights","bincount");L(r.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${r.dtype}`),L(e>=0,()=>`size must be non-negative, but got ${e}.`),L(o.size===r.size||o.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${r.shape}, weights shape: ${o.shape}.`);let i={x:r,weights:o},s={size:e};return P.runKernel(Ap,i,s)}var JI=R({bincount_:KEe});function XEe(n,t){let e=k(n,"x","bitwiseAnd"),r=k(t,"y","bitwiseAnd");if(!zi(e.shape,r.shape))throw new Error(`BitwiseAnd: Tensors must have the same shape. x: ${e.shape}, y: ${r.shape}`);if(e.dtype!=="int32"||r.dtype!=="int32")throw new Error(`BitwiseAnd: Only supports 'int32' values in tensor, found type of x: ${e.dtype} and type of y: ${r.dtype}`);let o={a:e,b:r};return P.runKernel(Kh,o)}var O5=R({bitwiseAnd_:XEe});function YEe(n,t){let e=k(n,"s0","broadcastArgs","int32"),r=k(t,"s1","broadcastArgs","int32");if(e.rank!==1)throw new Error(`broadcastArgs(): first input must be a vector (rank=1). Has rank ${e.rank}`);if(r.rank!==1)throw new Error(`broadcastArgs(): second input must be a vector (rank=1). Has rank ${r.rank}`);let o={s0:e,s1:r};return P.runKernel(Rp,o)}var M5=R({broadcastArgs_:YEe});function ZEe(n,t){let e=k(n,"broadcastTo","x"),r=e.shape;if(rr(t),t.length<e.rank)throw new Error(`broadcastTo(): shape.length=${t.length} < input.rank=${e.rank}.`);if(t.length>e.rank){let c=e.shape.slice();for(;c.length<t.length;)c.unshift(1);e=G(e,c)}let o=e.shape,i=Array.from(t);for(let c=t.length-1;c>=0;c--)if(o[c]===t[c])i[c]=1;else if(e.shape[c]!==1)throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${t}].`);if(i.map((c,u)=>c>1?u:-1).filter(c=>c>=0).length===0)return Yo(e);let a={x:e},l={reps:i};return P.runKernel(Bs,a,l)}var vu=R({broadcastTo_:ZEe});function QEe(n){let e={x:k(n,"x","ceil","float32")};return P.runKernel(Ba,e)}var e1=R({ceil_:QEe});function Hs(n,t,e){rr(n),e=e||Ep(t);let r={shape:n,value:t,dtype:e};return P.runKernel(qp,{},r)}function JEe(n,t,e){let r=k(n,"x","clipByValue");if(L(t<=e,()=>`Error in clip: min (${t}) must be less than or equal to max (${e}).`),t===e)return Hs(r.shape,t,r.dtype);let o={x:r},i={clipValueMin:t,clipValueMax:e};return P.runKernel(za,o,i)}var Pr=R({clipByValue_:JEe});function eTe(n){return Gt(n,0)}var t1=R({concat1d_:eTe});function tTe(n,t){return Gt(n,t)}var n1=R({concat2d_:tTe});function nTe(n,t){return Gt(n,t)}var r1=R({concat3d_:nTe});function rTe(n,t){return Gt(n,t)}var o1=R({concat4d_:rTe});function oTe(n,t,e,r,o="NHWC",i=[1,1],s){let a=k(n,"x","conv2d","float32"),l=k(t,"filter","conv2d","float32"),c=a,u=!1;a.rank===3&&(u=!0,c=G(a,[1,a.shape[0],a.shape[1],a.shape[2]])),L(c.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${c.rank}.`),L(l.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${l.rank}.`),An("conv2d",r,s);let d=o==="NHWC"?c.shape[3]:c.shape[1];L(d===l.shape[2],()=>`Error in conv2d: depth of input (${d}) must match input depth for filter ${l.shape[2]}.`),L(po(e,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${e} and dilations '${i}'`),L(yu(i),()=>"Error in conv2D: Dilated rates should be larger than 0."),L(yu(e),()=>"Error in conv2D: Strides should be larger than 0.");let p={x:c,filter:l},f={strides:e,pad:r,dataFormat:o,dilations:i,dimRoundingMode:s},h=P.runKernel(Ac,p,f);return u?G(h,[h.shape[1],h.shape[2],h.shape[3]]):h}var mi=R({conv2d_:oTe});function iTe(n,t,e,r,o="NWC",i=1,s){let a=k(n,"x","conv1d"),l=k(t,"filter","conv1d"),c=a,u=!1;a.rank===2&&(u=!0,c=G(a,[1,a.shape[0],a.shape[1]])),L(c.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${c.rank}.`),L(l.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${l.rank}.`),An("conv1d",r,s),L(c.shape[2]===l.shape[1],()=>`Error in conv1d: depth of input (${c.shape[2]}) must match input depth for filter ${l.shape[1]}.`),L(po(e,i),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${e} and dilation '${i}'`),L(yu(i),()=>"Error in conv1D: Dilated rates should be larger than 0."),L(yu(e),()=>"Error in conv1D: Stride should be larger than 0."),L(o==="NWC",()=>`Error in conv1d: got dataFormat of ${o} but only NWC is currently supported.`);let d=G(l,[1,l.shape[0],l.shape[1],l.shape[2]]),p=G(c,[c.shape[0],1,c.shape[1],c.shape[2]]),g=mi(p,d,[1,e],r,"NHWC",[1,i],s);return u?G(g,[g.shape[2],g.shape[3]]):G(g,[g.shape[0],g.shape[2],g.shape[3]])}var ex=R({conv1d_:iTe});function sTe(n,t,e,r,o,i="NHWC",s){L(n.length===t.rank,()=>`Length of inShape (${n.length}) and rank of dy (${t.rank}) must match`);let a=n,l=t,c=!1;t.rank===3&&(c=!0,l=G(t,[1,t.shape[0],t.shape[1],t.shape[2]]),a=[1,n[0],n[1],n[2]]),L(a.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`),L(l.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${l.rank}`),L(e.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${e.rank}`);let u=i==="NHWC"?a[3]:a[1],d=i==="NHWC"?l.shape[3]:l.shape[1];L(u===e.shape[2],()=>`Error in conv2dDerInput: depth of input (${u}) must match input depth for filter ${e.shape[2]}.`),L(d===e.shape[3],()=>`Error in conv2dDerInput: depth of output (${d}) must match output depth for filter ${e.shape[3]}.`),An("conv2dDerInput",o,s);let p={dy:l,filter:e},f={strides:r,pad:o,dataFormat:i,dimRoundingMode:s,inputShape:a},h=P.runKernel(Rc,p,f);return c?G(h,[h.shape[1],h.shape[2],h.shape[3]]):h}var tx=R({conv2DBackpropInput_:sTe});function aTe(n,t,e,r,o,i){let s=k(n,"x","conv2dTranspose"),a=k(t,"filter","conv2dTranspose");return tx(e,s,a,r,o,"NHWC",i)}var nx=R({conv2dTranspose_:aTe});function lTe(n,t,e,r,o="NDHWC",i=[1,1,1]){let s=k(n,"x","conv3d"),a=k(t,"filter","conv3d"),l=s,c=!1;s.rank===4&&(c=!0,l=G(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),L(l.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${l.rank}.`),L(a.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`),L(l.shape[4]===a.shape[3],()=>`Error in conv3d: depth of input (${l.shape[4]}) must match input depth for filter ${a.shape[3]}.`),L(po(e,i),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${e} and dilations '${i}'`),L(o==="NDHWC",()=>`Error in conv3d: got dataFormat of ${o} but only NDHWC is currently supported.`),L(yu(i),()=>"Error in conv3D: Dilated rates should be larger than 0."),L(yu(e),()=>"Error in conv3D: Strides should be larger than 0.");let u={x:l,filter:a},d={strides:e,pad:r,dataFormat:o,dilations:i},p=P.runKernel(Oc,u,d);return c?G(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}var i1=R({conv3d_:lTe});function cTe(n,t,e,r,o){L(n.length===t.rank,()=>`Length of inShape (${n.length}) and rank of dy (${t.rank}) must match`);let i=n,s=t,a=!1;t.rank===4&&(a=!0,s=G(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]),i=[1,n[0],n[1],n[2],n[3]]);let l=i[4],c=s.shape[4];L(i.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${i.length}.`),L(s.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${s.rank}`),L(e.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${e.rank}`),L(l===e.shape[3],()=>`Error in conv3dDerInput: depth of input (${l}) must match input depth for filter ${e.shape[3]}.`),L(c===e.shape[4],()=>`Error in conv3dDerInput: depth of output (${c}) must match output depth for filter ${e.shape[4]}.`);let u={dy:s,filter:e},d={pad:o,strides:r,inputShape:i},p=P.runKernel(Fp,u,d);return a?G(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}var s1=R({conv3DBackpropInput_:cTe});function uTe(n,t,e,r,o){let i=k(n,"x","conv3dTranspose"),s=k(t,"filter","conv3dTranspose");return s1(e,i,s,r,o)}var a1=R({conv3dTranspose_:uTe});function dTe(n){let e={x:k(n,"x","cos","float32")};return P.runKernel(Ua,e)}var Nf=R({cos_:dTe});function pTe(n){let e={x:k(n,"x","cosh","float32")};return P.runKernel(Wa,e)}var rx=R({cosh_:pTe});function fTe(n,t=0,e=!1,r=!1){let i={x:k(n,"x","cumprod")},s={axis:t,exclusive:e,reverse:r};return P.runKernel(Lp,i,s)}var fm=R({cumprod_:fTe});function hTe(n,t=0,e=!1,r=!1){let i={x:k(n,"x","cumsum")},s={axis:t,exclusive:e,reverse:r};return P.runKernel(Mc,i,s)}var ox=R({cumsum_:hTe});function mTe(n,t,e,r=!1){let o=k(n,"x","denseBincount"),i=k(t,"weights","denseBincount");L(o.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${o.dtype}`),L(o.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${o.rank}.`),L(e>=0,()=>`size must be non-negative, but got ${e}.`),L(i.size===o.size||i.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${o.shape}, weights shape: ${i.shape}.`);let s={x:o,weights:i},a={size:e,binaryOutput:r};return P.runKernel(Vp,s,a)}var Db=R({denseBincount_:mTe});function gTe(n,t,e="NHWC"){let r=k(n,"x","depthToSpace","float32"),o=e==="NHWC"?r.shape[1]:r.shape[2],i=e==="NHWC"?r.shape[2]:r.shape[3],s=e==="NHWC"?r.shape[3]:r.shape[1];L(t>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${t}`),L(o*t>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${o} and ${t}  for depthToSpace with input shape
    ${r.shape}`),L(i*t>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${i} and ${t} for depthToSpace with input shape
        ${r.shape}`),L(s%(t*t)===0,()=>`Dimension size must be evenly divisible by ${t*t} but is ${s} for depthToSpace with input shape ${r.shape}`);let a={x:r},l={blockSize:t,dataFormat:e};return P.runKernel(Bp,a,l)}var l1=R({depthToSpace_:gTe});function yTe(n,t,e,r,o="NHWC",i=[1,1],s){let a=k(n,"x","depthwiseConv2d","float32"),l=k(t,"filter","depthwiseConv2d","float32"),c=a,u=!1;a.rank===3&&(u=!0,c=G(a,[1,a.shape[0],a.shape[1],a.shape[2]])),L(c.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${c.rank}.`),L(l.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${l.rank}.`);let d=o==="NHWC"?c.shape[3]:c.shape[1];L(d===l.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${d}) must match the inChannels dimension in filter ${l.shape[2]}.`),An("depthwiseConv2d",r,s);let p={x:c,filter:l},f={strides:e,pad:r,dataFormat:o,dilations:i,dimRoundingMode:s},h=P.runKernel(Pc,p,f);return u?G(h,[h.shape[1],h.shape[2],h.shape[3]]):h}var bu=R({depthwiseConv2d_:yTe});function xTe(n){let e={x:k(n,"x","diag")};return P.runKernel(Wp,e)}var P5=R({diag_:xTe});function vTe(n,t,e,r,o=[1,1],i="NHWC"){let s=k(n,"x","dilation2d"),a=k(t,"filter","dilation2d");L(s.rank===3||s.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${s.rank}.`),L(a.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`),L(i==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${i}`);let l=s,c=!1;s.rank===3&&(l=G(s,[1,s.shape[0],s.shape[1],s.shape[2]]),c=!0),L(l.shape[3]===a.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${l.shape[3]} vs ${a.shape[2]}`);let u={x:l,filter:a},d={strides:e,pad:r,dilations:o},p=P.runKernel(Fc,u,d);return c?G(p,[p.shape[1],p.shape[2],p.shape[3]]):p}var c1=R({dilation2d_:vTe});var Zo={};bn(Zo,{assertAndGetBroadcastShape:()=>yt,getBroadcastDims:()=>F5,getReductionAxes:()=>Tn});function F5(n,t){let e=n.length,r=[];for(let o=0;o<e;o++){let i=e-1-o,s=n[i]||1;(t[t.length-1-o]||1)>1&&s===1&&r.unshift(i)}return r}function Tn(n,t){let e=[];for(let r=0;r<t.length;r++){let o=n[n.length-r-1],i=t.length-r-1,s=t[i];(o==null||o===1&&s>1)&&e.unshift(i)}return e}function yt(n,t){let e=Math.max(n.length,t.length),r=new Array(e);for(let o=0;o<e;o++){let i=n[n.length-o-1];i==null&&(i=1);let s=t[t.length-o-1];if(s==null&&(s=1),i===1)r[e-o-1]=s;else if(s===1)r[e-o-1]=i;else if(i!==s){let a=`Operands could not be broadcast together with shapes ${n} and ${t}.`;throw Error(a)}else r[e-o-1]=i}return r}function bTe(n,t){let e=k(n,"a","equal","string_or_numeric"),r=k(t,"b","equal","string_or_numeric");[e,r]=Pt(e,r),yt(e.shape,r.shape);let o={a:e,b:r};return P.runKernel(yd,o)}var Po=R({equal_:bTe});function wTe(n,t,e){let r=k(t,"a","where"),o=k(e,"b","where"),i=k(n,"condition","where","bool"),s=yt(yt(i.shape,r.shape),o.shape),a=vu(i,s),l=vu(r,s),c=vu(o,s),u={condition:a,t:l,e:c};return P.runKernel(iu,u)}var Rn=R({where_:wTe});function CTe(n){let e={x:k(n,"x","zerosLike")};return P.runKernel(fu,e)}var tt=R({zerosLike_:CTe});function _Te(n,t){let e=k(n,"a","div"),r=k(t,"b","div");[e,r]=Pt(e,r);let o=Se(e,r),i=tt(o),s=Po(r,i);return Rn(s,i,o)}var u1=R({divNoNan_:_Te});function STe(n,t){let e=k(n,"t1","dot"),r=k(t,"t2","dot");L((e.rank===1||e.rank===2)&&(r.rank===1||r.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${e.rank} and ${r.rank}.`);let o=e.rank===1?e.size:e.shape[1],i=r.rank===1?r.size:r.shape[0];if(L(o===i,()=>`Error in dot: inner dimensions of inputs must match, but got ${o} and ${i}.`),e.rank===1&&r.rank===1){let s=G(e,[1,-1]),a=G(r,[-1,1]),l=_t(s,a);return G(l,[])}else if(e.rank===1&&r.rank===2){let s=G(e,[1,-1]),a=G(r,[r.shape[0],r.shape[1]]),l=_t(s,a);return G(l,[l.size])}else if(e.rank===2&&r.rank===1){let s=G(r,[-1,1]),a=_t(e,s);return G(a,[a.size])}else{let s=G(r,[r.shape[0],r.shape[1]]);return _t(e,s)}}var d1=R({dot_:STe});function ITe(n,...t){let e=t.map((o,i)=>k(o,`tensors${i}`,"einsum")),r={equation:n};return P.runKernel(Gp,e,r)}var Af=R({einsum_:ITe});function ETe(n){let e={x:k(n,"x","elu","float32")};return P.runKernel(ja,e)}var wu=R({elu_:ETe});function TTe(n,t){let e=k(n,"x","ensureShape","string_or_numeric");if(!TP(e.shape,t))throw new Error(`EnsureShape: Shape of tensor ${e.shape} is not compatible with expected shape ${t}`);return n}var L5=R({ensureShape_:TTe});function DTe(n){let t=k(n,"x","erf");L(t.dtype==="int32"||t.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),t.dtype==="int32"&&(t=me(t,"float32"));let e={x:t};return P.runKernel(Ha,e)}var ix=R({erf_:DTe});function cF(n,t){for(let e=0;e<n.length;++e)if(n[n.length-e-1]!==t-1-e)return!1;return!0}function $5(n,t,e){let r=n.length+t.length,o=[],i=0,s=0;for(let a=0;a<r;a++)e.indexOf(a)===-1?o.push(n[i++]):o.push(t[s++]);return o}function uF(n,t){let e=[],r=n.length;for(let i=0;i<r;i++)t.indexOf(i)===-1&&e.push(n[i]);let o=t.map(i=>n[i]);return[e,o]}function qs(n,t){let e=t.map(r=>1);return $5(n,e,t)}function kTe(n,t,e){L(cF(t,e),()=>`${n} supports only inner-most axes for now. Got axes ${t} and rank-${e} input.`)}function dF(n,t){if(cF(n,t))return null;let e=[];for(let r=0;r<t;++r)n.indexOf(r)===-1&&e.push(r);return n.forEach(r=>e.push(r)),e}function kb(n){return n.map((t,e)=>[e,t]).sort((t,e)=>t[1]-e[1]).map(t=>t[0])}function NTe(n,t){let e=[];for(let r=t-n;r<t;++r)e.push(r);return e}function ATe(n,t=null,e=!1){let o={x:k(n,"x","max")},i={reductionIndices:t,keepDims:e};return P.runKernel(Uc,o,i)}var Jr=R({max_:ATe});function RTe(n,t=null,e=!1){let o={x:k(n,"x","min")},i={axis:t,keepDims:e};return P.runKernel(Hc,o,i)}var Rd=R({min_:RTe});function OTe(n,t){let e=k(n,"base","pow"),r=k(t,"exp","pow");[e,r]=Pt(e,r);let o={a:e,b:r};return P.runKernel(al,o)}var wo=R({pow_:OTe});function Ae(n,t){if((Mo(n)&&t!=="string"||Array.isArray(n))&&t!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(t==="string"&&Mo(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Xo(n,[],[],t)}function MTe(n){let e={x:k(n,"x","sqrt","float32")};return P.runKernel(vl,e)}var wn=R({sqrt_:MTe});function PTe(n){let t=k(n,"x","square"),e={};return P.runKernel("Square",{x:t},e)}var xt=R({square_:PTe});function FTe(n,t=null,e=!1){let r=k(n,"x","sum");r.dtype==="bool"&&(r=me(r,"int32"));let o={x:r},i={axis:t,keepDims:e};return P.runKernel(au,o,i)}var Pe=R({sum_:FTe});function LTe(n,t="euclidean",e=null,r=!1){n=k(n,"x","norm");let o=V5(n,t,e),i=o.shape;if(r){let s=Mr(e,n.shape);i=qs(o.shape,s)}return G(o,i)}function V5(n,t,e=null){if(n.rank===0)return Bn(n);if(n.rank!==1&&e===null)return V5(G(n,[-1]),t,e);if(n.rank===1||typeof e=="number"||Array.isArray(e)&&e.length===1){if(t===1)return Pe(Bn(n),e);if(t===1/0)return Jr(Bn(n),e);if(t===-1/0)return Rd(Bn(n),e);if(t==="euclidean"||t===2)return wn(Pe(wo(Bn(n),Ae(2,"int32")),e));throw new Error(`Error in norm: invalid ord value: ${t}`)}if(Array.isArray(e)&&e.length===2){if(t===1)return Jr(Pe(Bn(n),e[0]),e[1]-1);if(t===1/0)return Jr(Pe(Bn(n),e[1]),e[0]);if(t===-1/0)return Rd(Pe(Bn(n),e[1]),e[0]);if(t==="fro"||t==="euclidean")return wn(Pe(xt(n),e));throw new Error(`Error in norm: invalid ord value: ${t}`)}throw new Error(`Error in norm: invalid axis: ${e}`)}var Od=R({norm_:LTe});function $Te(n,t=null,e=!1){return Od(n,"euclidean",t,e)}var p1=R({euclideanNorm_:$Te});function VTe(n){let e={x:k(n,"x","exp")};return P.runKernel(qa,e)}var Gn=R({exp_:VTe});function BTe(n,t=0){let e=k(n,"x","expandDims","string_or_numeric");L(t<=e.rank,()=>"Axis must be <= rank of the tensor");let r={input:e},o={dim:t};return P.runKernel(Lc,r,o)}var On=R({expandDims_:BTe});function zTe(n){let e={x:k(n,"x","expm1")};return P.runKernel(Ka,e)}var f1=R({expm1_:zTe});function UTe(n,t){let e=k(n,"x","tile","string_or_numeric");L(e.rank===t.length,()=>`Error in transpose: rank of input ${e.rank} must match length of reps ${t}.`);let r={x:e},o={reps:t};return P.runKernel(Bs,r,o)}var fo=R({tile_:UTe});function WTe(n,t,e,r="float32"){t==null&&(t=n);let o=ze([n,t],r),i=n<=t?n:t;for(let a=0;a<i;++a)o.set(1,a,a);let s=G(o.toTensor(),[n,t]);if(e==null)return s;if(e.length===1)return fo(On(s,0),[e[0],1,1]);if(e.length===2)return fo(On(On(s,0),0),[e[0],e[1],1,1]);if(e.length===3)return fo(On(On(On(s,0),0),0),[e[0],e[1],e[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${e.length}D.`)}var hm=R({eye_:WTe});function GTe(n){let e={x:k(n,"x","floor","float32")};return P.runKernel(Xa,e)}var Cu=R({floor_:GTe});function jTe(n,t,e=0,r=0){let o=k(n,"x","gather"),i=k(t,"indices","gather","int32"),s={x:o,indices:i},a={axis:e,batchDims:r};return P.runKernel(Vc,s,a)}var _u=R({gather_:jTe});function HTe(n,t){let e=k(n,"a","greater","string_or_numeric"),r=k(t,"b","greater","string_or_numeric");[e,r]=Pt(e,r),yt(e.shape,r.shape);let o={a:e,b:r};return P.runKernel(xd,o)}var ir=R({greater_:HTe});function qTe(n,t){let e=k(n,"a","greaterEqual","string_or_numeric"),r=k(t,"b","greaterEqual","string_or_numeric");[e,r]=Pt(e,r),yt(e.shape,r.shape);let o={a:e,b:r};return P.runKernel(Za,o)}var Qo=R({greaterEqual_:qTe});function KTe(n){let e={input:k(n,"input","imag")};return P.runKernel(Zp,e)}var Rf=R({imag_:KTe});function XTe(n){let e={x:k(n,"x","isFinite")};return P.runKernel(Qa,e)}var h1=R({isFinite_:XTe});function YTe(n){let e={x:k(n,"x","isInf")};return P.runKernel(Ja,e)}var m1=R({isInf_:YTe});function ZTe(n){let e={x:k(n,"x","isNaN")};return P.runKernel(el,e)}var g1=R({isNaN_:ZTe});function QTe(n,t=.2){let r={x:k(n,"x","leakyRelu")},o={alpha:t};return P.runKernel(Bc,r,o)}var Of=R({leakyRelu_:QTe});function JTe(n,t){let e=k(n,"a","less","string_or_numeric"),r=k(t,"b","less","string_or_numeric");[e,r]=Pt(e,r),yt(e.shape,r.shape);let o={a:e,b:r};return P.runKernel(vd,o)}var Md=R({less_:JTe});function eDe(n,t){let e=k(n,"a","lessEqual","string_or_numeric"),r=k(t,"b","lessEqual","string_or_numeric");[e,r]=Pt(e,r),yt(e.shape,r.shape);let o={a:e,b:r};return P.runKernel(bd,o)}var Gi=R({lessEqual_:eDe});function B5(n,t,e){if(e<=0)throw new Error("The number of values should be positive.");let r={start:n,stop:t,num:e};return P.runKernel(Qp,{},r)}function tDe(n,t=5,e=1,r=1,o=.5){let i=k(n,"x","localResponseNormalization");L(i.rank===4||i.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${i.rank}.`),L(gd(t),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${t}.`);let s=i,a=!1;i.rank===3&&(a=!0,s=G(i,[1,i.shape[0],i.shape[1],i.shape[2]]));let l={x:s},c={depthRadius:t,bias:e,alpha:r,beta:o},u=P.runKernel(zc,l,c);return a?G(u,[u.shape[1],u.shape[2],u.shape[3]]):u}var y1=R({localResponseNormalization_:tDe});function nDe(n){let e={x:k(n,"x","log","float32")};return P.runKernel(tl,e)}var eo=R({log_:nDe});function rDe(n){let e={x:k(n,"x","log1p")};return P.runKernel(nl,e)}var Mf=R({log1p_:rDe});function fF(n,t){L(Ey(n),()=>"The f passed in variableGrads(f) must be a function"),L(t==null||Array.isArray(t)&&t.every(c=>c instanceof Dd),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");let e=t!=null;if(!e){t=[];for(let c in P.registeredVariables)t.push(P.registeredVariables[c])}let r=e?t.filter(c=>!c.trainable):null,o=t.length;t=t.filter(c=>c.trainable),L(t.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${o} variables is trainable.`);let i=!0,{value:s,grads:a}=P.gradients(n,t,null,i);L(a.some(c=>c!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),L(s.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${s.rank} tensor`);let l={};return t.forEach((c,u)=>{a[u]!=null&&(l[c.name]=a[u])}),r?.forEach(c=>l[c.name]=null),{value:s,grads:l}}function gi(n){return P.customGrad(n)}function oDe(n){let e={x:k(n,"x","neg")};return P.runKernel(Kc,e)}var Dt=R({neg_:oDe});function iDe(n){let e={x:k(n,"x","softplus")};return P.runKernel(xl,e)}var kl=R({softplus_:iDe});function sDe(n){let t=k(n,"x","logSigmoid");return gi(r=>({value:Dt(kl(Dt(r))),gradFunc:s=>U(s,jr(Dt(r)))}))(t)}var x1=R({logSigmoid_:sDe});function aDe(n,t){let e=k(n,"a","sub"),r=k(t,"b","sub");[e,r]=Pt(e,r);let o={a:e,b:r};return P.runKernel(wl,o)}var Ie=R({sub_:aDe});function lDe(n,t=-1){let e=k(n,"logits","logSoftmax");if(t===-1&&(t=e.rank-1),t!==e.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${e.rank} and axis was ${t}`);return gi((o,i)=>{let a=Jr(o,t,!0),l=Ie(o,a),c=Ie(me(l,"float32"),eo(Pe(Gn(l),t,!0)));return i([c]),{value:c,gradFunc:(d,p)=>{let[f]=p,h=!0,m=Gn(f);return Ie(d,U(Pe(d,t,h),m))}}})(e)}var sx=R({logSoftmax_:lDe});function cDe(n,t=null,e=!1){let r=k(n,"x","logSumExp"),o=Mr(t,r.shape),i=Jr(r,o,!0),s=Ie(r,i),a=Gn(s),l=Pe(a,o),c=eo(l),u=ae(G(i,c.shape),c);if(e){let d=qs(u.shape,o);return G(u,d)}return u}var Pf=R({logSumExp_:cDe});function uDe(n,t){let e=k(n,"a","logicalAnd","bool"),r=k(t,"b","logicalAnd","bool");yt(e.shape,r.shape);let o={a:e,b:r};return P.runKernel(wd,o)}var Co=R({logicalAnd_:uDe});function dDe(n){let e={x:k(n,"x","logicalNot","bool")};return P.runKernel(Cd,e)}var Ff=R({logicalNot_:dDe});function pDe(n,t){let e=k(n,"a","logicalOr","bool"),r=k(t,"b","logicalOr","bool");yt(e.shape,r.shape);let o={a:e,b:r};return P.runKernel(_d,o)}var ax=R({logicalOr_:pDe});function fDe(n,t){let e=k(n,"a","logicalXor","bool"),r=k(t,"b","logicalXor","bool");return yt(e.shape,r.shape),Co(ax(n,t),Ff(Co(n,t)))}var v1=R({logicalXor_:fDe});var b1=2147483648;function hDe(n,t,e="left"){let r=k(n,"sortedSequence","searchSorted"),o=k(t,"values","searchSorted"),i=r.shape[r.shape.length-1],s=o.shape[o.shape.length-1],a=G(r,[-1,i]),l=G(o,[-1,s]);if(a.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(a.shape[0]!==l.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(Mt(l.shape)>=b1)throw new Error(`values tensor size must less than ${b1}`);if(a.shape[1]>=b1)throw new Error(`trailing dim_size must less than ${b1} for int32 output type, was ${a.shape[1]}`);let c={sortedSequence:a,values:l},u={side:e};return P.runKernel(ff,c,u)}var Nb=R({searchSorted_:hDe});function z5(n,t){return Nb(n,t,"left")}function mDe(n,t,e,r,o){let i=k(n,"x","maxPool"),s=1,a=i,l=!1;i.rank===3&&(l=!0,a=G(i,[1,i.shape[0],i.shape[1],i.shape[2]])),L(a.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${a.rank}.`),L(po(e,s),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${e} and dilations '${s}'`),An("maxPool",r,o);let c={x:a},u={filterSize:t,strides:e,pad:r,dimRoundingMode:o},d=P.runKernel(Wc,c,u);return l?G(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var Lf=R({maxPool_:mDe});function gDe(n,t=[1,1,1],e,r,o,i="NDHWC"){let s=k(n,"x","maxPool3d"),a=s,l=!1;s.rank===4&&(l=!0,a=G(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),L(a.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`),L(i==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),An("maxPool3d",r,o);let c={x:a},u={filterSize:t,strides:e,pad:r,dimRoundingMode:o,dataFormat:i},d=P.runKernel(Gc,c,u);return l?G(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}var w1=R({maxPool3d_:gDe});function yDe(n,t,e,r,o=!1){let s={x:k(n,"x","maxPoolWithArgmax")},a={filterSize:t,strides:e,pad:r,includeBatchInIndex:o},l=P.runKernel(nf,s,a);return{result:l[0],indexes:l[1]}}var U5=R({maxPoolWithArgmax_:yDe});function xDe(n,t){let e=k(n,"a","maximum"),r=k(t,"b","maximum");[e,r]=Pt(e,r),e.dtype==="bool"&&(e=me(e,"int32"),r=me(r,"int32")),yt(e.shape,r.shape);let o={a:e,b:r};return P.runKernel(rl,o)}var yi=R({maximum_:xDe});function vDe(n,t=null,e=!1){let o={x:k(n,"x","mean")},i={axis:t,keepDims:e};return P.runKernel(jc,o,i)}var Mn=R({mean_:vDe});function hn(n,t="float32"){if(rr(n),t==="complex64"){let r=hn(n,"float32"),o=hn(n,"float32");return hi(r,o)}let e=Dy(Mt(n),t);return P.makeTensor(e,n,t)}function Tr(n,t="float32"){if(rr(n),t==="complex64"){let r=Tr(n,"float32"),o=hn(n,"float32");return hi(r,o)}let e=yb(Mt(n),t);return P.makeTensor(e,n,t)}function W5(n,t,{indexing:e="xy"}={}){if(e!=="xy"&&e!=="ij")throw new TypeError(`${e} is not a valid third argument to meshgrid`);if(n===void 0)return[];let r=k(n,"x","meshgrid",n instanceof bt?n.dtype:"float32");if(t===void 0)return[r];let o=k(t,"y","meshgrid",t instanceof bt?t.dtype:"float32"),i=Mt(r.shape),s=Mt(o.shape);return e==="xy"?(r=G(r,[1,-1]),o=G(o,[-1,1]),[_t(Tr([s,1],r.dtype),r),_t(o,Tr([1,i],o.dtype))]):(r=G(r,[-1,1]),o=G(o,[1,-1]),[_t(r,Tr([1,s],r.dtype)),_t(Tr([i,1],o.dtype),o)])}function bDe(n,t){let e=k(n,"a","minimum"),r=k(t,"b","minimum");[e,r]=Pt(e,r),e.dtype==="bool"&&(e=me(e,"int32"),r=me(r,"int32")),yt(e.shape,r.shape);let o={a:e,b:r};return P.runKernel(ol,o)}var xi=R({minimum_:bDe});function wDe(n,t,e){L(e==="reflect"||e==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${e}.`);let r=k(n,"x","mirrorPad");if(r.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");L(t.length===r.rank,()=>`Padding doesn't match input. Must be ${r.rank}. Got ${t.length}.`);let o=e==="reflect"?1:0;for(let a=0;a<r.rank;a++)L(t[a].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),L(t[a][0]>=0&&t[a][0]<=r.shape[a]-o&&t[a][1]>=0&&t[a][1]<=r.shape[a]-o,()=>`Padding in dimension ${a} cannot be greater than or equal to ${r.shape[a]-o} or less than 0 for input of shape ${r.shape}`);let i={paddings:t,mode:e},s={x:r};return P.runKernel(qc,s,i)}var lx=R({mirrorPad_:wDe});function CDe(n,t){let e=k(n,"a","mod"),r=k(t,"b","mod");[e,r]=Pt(e,r);let o={a:e,b:r};return P.runKernel(il,o)}var C1=R({mod_:CDe});function _De(n,t=null,e=!1){n=k(n,"x","moments");let r=Mr(t,n.shape),o=Mn(n,r,e),i=o.shape;e||(i=qs(o.shape,r));let s=xt(Ie(me(n,"float32"),G(o,i))),a=Mn(s,r,e);return{mean:o,variance:a}}var mm=R({moments_:_De});function SDe(n,t,e,r){let o=k(t,"data","multiRNNCell"),i=im(e,"c","multiRNNCell"),s=im(r,"h","multiRNNCell"),a=o,l=[];for(let d=0;d<n.length;d++){let p=n[d](a,i[d],s[d]);l.push(p[0]),l.push(p[1]),a=p[1]}let c=[],u=[];for(let d=0;d<l.length;d+=2)c.push(l[d]),u.push(l[d+1]);return[c,u]}var G5=R({multiRNNCell_:SDe});function IDe(n,t,e,r=!1){let o=k(n,"logits","multinomial"),i=o.size,s=o.rank;if(i<2)throw new Error(`Error in multinomial: you need at least 2 outcomes, but got ${i}.`);if(s>2)throw new Error(`Rank of probabilities must be 1 or 2, but is ${s}`);e=e||Math.random();let l={logits:s===1?G(o,[1,-1]):o},c={numSamples:t,seed:e,normalized:r},u=P.runKernel(rf,l,c);return s===1?G(u,[u.size]):u}var j5=R({multinomial_:IDe});function EDe(n,t){let e=k(n,"a","notEqual","string_or_numeric"),r=k(t,"b","notEqual","string_or_numeric");[e,r]=Pt(e,r),yt(e.shape,r.shape);let o={a:e,b:r};return P.runKernel(Sd,o)}var Nl=R({notEqual_:EDe});function TDe(n,t,e=1,r=0,o="int32"){if(t<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${t}`);let s={indices:k(n,"indices","oneHot","int32")},a={dtype:o,depth:t,onValue:e,offValue:r};return P.runKernel(Yc,s,a)}var gm=R({oneHot_:TDe});function DDe(n){let e={x:k(n,"x","onesLike")};return P.runKernel(Xc,e)}var Hr=R({onesLike_:DDe});function kDe(n,t){let e=k(n,"v1","outerProduct"),r=k(t,"v2","outerProduct");L(e.rank===1&&r.rank===1,()=>`Error in outerProduct: inputs must be rank 1, but got ranks ${e.rank} and ${r.rank}.`);let o=G(e,[-1,1]),i=G(r,[1,-1]);return _t(o,i)}var H5=R({outerProduct_:kDe});function NDe(n,t,e=0){let r=k(n,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");let o={paddings:t,constantValue:e},i={x:r};return P.runKernel(Qc,i,o)}var to=R({pad_:NDe});function ADe(n,t,e=0){return L(t.length===2,()=>"Invalid number of paddings. Must be length of 2."),to(n,[t],e)}var q5=R({pad1d_:ADe});function RDe(n,t,e=0){return L(t.length===2&&t[0].length===2&&t[1].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),to(n,t,e)}var K5=R({pad2d_:RDe});function ODe(n,t,e=0){return L(t.length===3&&t[0].length===2&&t[1].length===2&&t[2].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),to(n,t,e)}var X5=R({pad3d_:ODe});function MDe(n,t,e=0){return L(t.length===4&&t[0].length===2&&t[1].length===2&&t[2].length===2&&t[3].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),to(n,t,e)}var Y5=R({pad4d_:MDe});function PDe(n,t,e){let r=k(n,"x","spaceToBatchND");L(r.rank>=1+t.length,()=>`input rank ${r.rank} should be > than [blockShape] ${t.length}`),L(e.length===t.length,()=>`paddings.shape[0] ${e.length} must be equal to [blockShape] ${t.length}`),L(r.shape.reduce((s,a,l)=>l>0&&l<=t.length?s&&(a+e[l-1][0]+e[l-1][1])%t[l-1]===0:s,!0),()=>`input spatial dimensions ${r.shape.slice(1)} with paddings ${e.toString()} must be divisible by blockShapes ${t.toString()}`);let o={x:r},i={blockShape:t,paddings:e};return P.runKernel(lu,o,i)}var $f=R({spaceToBatchND_:PDe});function FDe(n,t,e,r,o,i,s){o==null&&(o=[1,1]),i==null&&(i=1),r===0&&(r="valid");let a=k(n,"x","maxPool"),l=a,c=!1;a.rank===3&&(c=!0,l=G(a,[1,a.shape[0],a.shape[1],a.shape[2]])),L(po(i,o),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${i} and dilations '${o}'`);let u=aF(l.shape,t,i,o,r),d=[u.dilationHeight,u.dilationWidth],p;r==="same"?p=$De([u.filterHeight,u.filterWidth],d):p=[[0,0],[0,0]];let f=d[0]===1&&d[1]===1,[h,m]=LDe([u.inHeight,u.inWidth],d,p),g=f?r:"valid",y=f?l:$f(l,d,h),w=(e==="avg"?()=>Df(y,t,i,g,s):()=>Lf(y,t,i,g,s))(),C=f?w:kf(w,d,m);return c?G(C,[C.shape[1],C.shape[2],C.shape[3]]):C}function LDe(n,t,e){let r=e.map(u=>u[0]),o=e.map(u=>u[1]),i=n.concat(r,o),s=t.map((u,d)=>(u-i[d]%u)%u),a=o.map((u,d)=>u+s[d]),l=t.map((u,d)=>[r[d],a[d]]),c=t.map((u,d)=>[0,s[d]]);return[l,c]}function $De(n,t){let r=n.map((s,a)=>s+(s-1)*(t[a]-1)).map(s=>s-1),o=r.map(s=>Math.floor(s/2)),i=r.map((s,a)=>s-o[a]);return r.map((s,a)=>[o[a],i[a]])}var _1=R({pool_:FDe});function VDe(n,t){let e=k(n,"x","prelu"),r=k(t,"alpha","prelu"),o={x:e,alpha:r};return P.runKernel(Jc,o)}var Vf=R({prelu_:VDe});function BDe(n,t=null,e=!1){let r=k(n,"x","prod");r.dtype==="bool"&&(r=me(r,"int32"));let o={x:r},i={axis:t,keepDims:e};return P.runKernel(eu,o,i)}var S1=R({prod_:BDe});function zDe(n,t,e,r){let o=n.map((u,d)=>k(u,`tensors${d}`,"raggedGather","int32")),i=k(t,"paramsDenseValues","raggedGather"),s=k(e,"indices","raggedGather","int32"),a={paramsNestedSplits:o,paramsDenseValues:i,indices:s},l={outputRaggedRank:r},c=P.runKernel(Ny,a,l);return{outputNestedSplits:c.slice(0,c.length-1),outputDenseValues:c[c.length-1]}}var Z5=R({raggedGather_:zDe});function UDe(n,t,e){let r=k(n,"starts","raggedRange"),o=k(t,"limits","raggedRange",r.dtype),i=k(e,"deltas","raggedRange",r.dtype),s={starts:r,limits:o,deltas:i},a=P.runKernel(Ay,s);return{rtNestedSplits:a[0],rtDenseValues:a[1]}}var Q5=R({raggedRange_:UDe});function WDe(n,t,e,r,o){let i=k(n,"shape","raggedTensorToTensor","int32"),s=k(t,"values","raggedTensorToTensor"),a=k(e,"defaultValue","raggedTensorToTensor",s.dtype),l=r.map((d,p)=>k(d,`tensors${p}`,"raggedTensorToTensor","int32")),c={shape:i,values:s,defaultValue:a,rowPartitionTensors:l},u={rowPartitionTypes:o};return P.runKernel(Ry,c,u)}var J5=R({raggedTensorToTensor_:WDe});function GDe(n,t,e){rr(n);let r=Mt(n),o=null;if(e==null||e==="float32")o=new Float32Array(r);else if(e==="int32")o=new Int32Array(r);else if(e==="bool")o=new Uint8Array(r);else throw new Error(`Unknown data type ${e}`);for(let i=0;i<r;i++)o[i]=t();return P.makeTensor(o,n,e)}var eq=R({rand_:GDe});var D1=rg(Ab());var xm=class{constructor(t,e,r,o,i){this.mean=t,this.stdDev=e,this.dtype=r,this.nextVal=NaN,this.truncated=o,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);let s=i||Math.random();this.random=D1.alea(s.toString())}nextValue(){if(!isNaN(this.nextVal)){let o=this.nextVal;return this.nextVal=NaN,o}let t,e,r=!1;for(;!r;){let o,i,s;do o=2*this.random()-1,i=2*this.random()-1,s=o*o+i*i;while(s>=1||s===0);let a=Math.sqrt(-2*Math.log(s)/s);t=this.mean+this.stdDev*o*a,e=this.mean+this.stdDev*i*a,(!this.truncated||this.isValidTruncated(t))&&(r=!0)}return(!this.truncated||this.isValidTruncated(e))&&(this.nextVal=this.convertValue(e)),this.convertValue(t)}convertValue(t){return this.dtype==null||this.dtype==="float32"?t:Math.round(t)}isValidTruncated(t){return t<=this.upper&&t>=this.lower}},E1=class{constructor(t,e,r,o){this.alpha=t,this.beta=1/e,this.dtype=r;let i=o||Math.random();this.randu=D1.alea(i.toString()),this.randn=new xm(0,1,r,!1,this.randu()),t<1?this.d=t+2/3:this.d=t-1/3,this.c=1/Math.sqrt(9*this.d)}nextValue(){let t,e,r,o,i,s;for(;;){do o=this.randn.nextValue(),s=1+this.c*o;while(s<=0);if(s*=s*s,t=o*o,e=1-.331*t*t,r=.5*t+this.d*(1-s+Math.log(s)),i=this.randu(),i<e||Math.log(i)<r)break}return s=1/this.beta*this.d*s,this.alpha<1&&(s*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(s)}convertValue(t){return this.dtype==="float32"?t:Math.round(t)}},T1=class{constructor(t=0,e=1,r,o){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=t,this.range=e-t,this.dtype=r,o==null&&(o=Math.random()),typeof o=="number"&&(o=o.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${t} - ${e} <= 1 and dtype is not float`);this.random=D1.alea(o)}convertValue(t){return this.canReturnFloat()?t:Math.round(t)}nextValue(){return this.convertValue(this.min+this.range*this.random())}};function ZDe(n,t,e=1,r="float32",o){if(rr(n),e==null&&(e=1),r==null&&(r="float32"),r!=="float32"&&r!=="int32")throw new Error(`Unsupported data type ${r}`);let i=new E1(t,e,r,o),s=ze(n,r);for(let a=0;a<s.values.length;a++)s.values[a]=i.nextValue();return s.toTensor()}var yq=R({randomGamma_:ZDe});function QDe(n,t=0,e=1,r,o){if(rr(n),r!=null&&r==="bool")throw new Error(`Unsupported data type ${r}`);let i=new xm(t,e,r,!1,o),s=ze(n,r);for(let a=0;a<s.values.length;a++)s.values[a]=i.nextValue();return s.toTensor()}var vm=R({randomNormal_:QDe});function JDe(n,t,e){if(t!=null&&t==="bool")throw new Error(`Unsupported data type ${t}`);return vm(n,0,1,t,e)}var xq=R({randomStandardNormal_:JDe});function eke(n,t=0,e=1,r="float32",o){rr(n);let i=ze(n,r),s=new T1(t,e,null,o);for(let a=0;a<i.values.length;a++)i.values[a]=s.nextValue();return i.toTensor()}var ji=R({randomUniform_:eke});function tke(n,t,e,r){return ji(n,t,e,"int32",r)}var vq=R({randomUniformInt_:tke});function Su(n,t,e=1,r="float32"){if(e===0)throw new Error("Cannot have a step of zero");let o={start:n,stop:t,step:e,dtype:r};return P.runKernel(af,{},o)}function nke(n){let e={input:k(n,"input","real")};return P.runKernel(lf,e)}var Pd=R({real_:nke});function rke(n){let e={x:k(n,"x","reciprocal")};return P.runKernel(ll,e)}var k1=R({reciprocal_:rke});function oke(n){let e={x:k(n,"x","relu")};return P.runKernel(cl,e)}var ho=R({relu_:oke});function ike(n){let e={x:k(n,"x","relu6")};return P.runKernel(ul,e)}var cx=R({relu6_:ike});function ske(n,t){let r={x:k(n,"x","reverse")},o={dims:t};return P.runKernel(ou,r,o)}var Fr=R({reverse_:ske});function ake(n){let t=k(n,"x","reverse");return L(t.rank===1,()=>`Error in reverse1D: x must be rank 1 but got rank ${t.rank}.`),Fr(t,0)}var bq=R({reverse1d_:ake});function lke(n,t){let e=k(n,"x","reverse");return L(e.rank===2,()=>`Error in reverse2D: x must be rank 2 but got rank ${e.rank}.`),Fr(e,t)}var wq=R({reverse2d_:lke});function cke(n,t){let e=k(n,"x","reverse");return L(e.rank===3,()=>`Error in reverse3D: x must be rank 3 but got rank ${e.rank}.`),Fr(e,t)}var Cq=R({reverse3d_:cke});function uke(n,t){let e=k(n,"x","reverse");return L(e.rank===4,()=>`Error in reverse4D: x must be rank 4 but got rank ${e.rank}.`),Fr(e,t)}var _q=R({reverse4d_:uke});function dke(n){let e={x:k(n,"x","round")};return P.runKernel(dl,e)}var ux=R({round_:dke});function pke(n){let e={x:k(n,"x","rsqrt","float32")};return P.runKernel(pl,e)}var dx=R({rsqrt_:pke});function fke(n){let e={x:k(n,"x","selu")};return P.runKernel(fl,e)}var px=R({selu_:fke});function hke(n,t,e,r,o,i=[1,1],s="NHWC"){let a=k(n,"x","separableConv2d"),l=k(t,"depthwiseFilter","separableConv2d"),c=k(e,"pointwiseFilter","separableConv2d"),u=a,d=!1;if(a.rank===3&&(d=!0,u=G(a,[1,a.shape[0],a.shape[1],a.shape[2]])),s==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");L(u.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${u.rank}.`),L(l.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${l.rank}.`),L(c.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${l.rank}.`),L(c.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${c.shape[0]}.`),L(c.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${c.shape[1]}.`);let p=l.shape[2],f=l.shape[3];L(c.shape[2]===p*f,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${p*f}, but got ${c.shape[2]}.`);let h=bu(u,l,r,o,s,i),g=mi(h,c,1,"valid",s);return d?G(g,[g.shape[1],g.shape[2],g.shape[3]]):g}var fx=R({separableConv2d_:hke});function mke(n,t){return B(this,null,function*(){let e=k(n,"x","setdiff1d"),r=k(t,"y","setdiff1d");L(e.dtype===r.dtype,()=>`x and y should have the same dtype, but got x (${e.dtype}) and y (${r.dtype}).`),L(e.rank===1,()=>`x should be 1D tensor, but got x (${e.shape}).`),L(r.rank===1,()=>`y should be 1D tensor, but got y (${r.shape}).`);let o=yield e.data(),i=yield r.data(),s=new Set(i),a=0;for(let u=0;u<o.length;u++)s.has(o[u])||a++;let l=new an([a],e.dtype),c=new an([a],"int32");for(let u=0,d=0;u<o.length;u++)s.has(o[u])||(l.values[d]=o[u],c.values[d]=u,d++);return[l.toTensor(),c.toTensor()]})}var Sq=mke;function gke(n){let e={x:k(n,"x","sign")};return P.runKernel(gl,e)}var N1=R({sign_:gke});function yke(n){let e={x:k(n,"x","sin","float32")};return P.runKernel(hl,e)}var hx=R({sin_:yke});function xke(n){let e={x:k(n,"x","sinh")};return P.runKernel(ml,e)}var mx=R({sinh_:xke});function vke(n,t,e){let r=k(n,"x","slice1d");return L(r.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${r.rank} tensor`),Je(r,[t],[e])}var gx=R({slice1d_:vke});function bke(n,t,e){let r=k(n,"x","slice2d");return L(r.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${r.rank} tensor`),Je(r,t,e)}var Rb=R({slice2d_:bke});function wke(n,t,e){let r=k(n,"x","slice3d");return L(r.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${r.rank} tensor`),Je(r,t,e)}var yx=R({slice3d_:wke});function Cke(n,t,e){let r=k(n,"x","slice4d");return L(r.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${r.rank} tensor`),Je(r,t,e)}var bm=R({slice4d_:Cke});function _ke(n,t=-1){let e=k(n,"logits","softmax","float32");if(t===-1&&(t=e.rank-1),t!==e.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${e.rank} and dim was ${t}`);let r={logits:e},o={dim:t};return P.runKernel(uu,r,o)}var Bf=R({softmax_:_ke});function Ske(n){L(n.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${n.dtype}.`);let t={input:n};return P.runKernel(Hp,t)}var zf=R({fft_:Ske});function Ike(n){L(n.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${n.dtype}.`);let t={input:n};return P.runKernel(Yp,t)}var Fd=R({ifft_:Ike});function Eke(n){let t=n.shape[n.shape.length-1],e=n.size/t,r;if(t<=2){let o=G(n,[e,t]);r=Fd(o)}else{let o=[e,2*(t-1)],i=G(Pd(n),[e,t]),s=G(Rf(n),[e,t]),a=Fr(Je(i,[0,1],[e,t-2]),1),l=U(Fr(Je(s,[0,1],[e,t-2]),1),Ae(-1)),c=Gt([i,a],1),u=Gt([s,l],1),d=G(hi(c,u),[o[0],o[1]]);r=Fd(d)}if(r=Pd(r),n.rank===3&&n.shape[0]!==0){let o=r,i=n.shape[0];r=G(r,[i,r.shape[0]/i,r.shape[1]]),o.dispose()}return r}var xx=R({irfft_:Eke});function Tke(n,t,e=0){let o={x:k(n,"x","split")},i={numOrSizeSplits:t,axis:e};return P.runKernel(cu,o,i)}var Lr=R({split_:Tke});function Dke(n,t){L(n.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${n.dtype}`);let e=n.shape[n.shape.length-1],r=n.size/e,o;if(t!=null&&t<e){let h=n.shape.map(g=>0),m=n.shape.map(g=>g);m[n.shape.length-1]=t,o=Je(n,h,m),e=t}else if(t!=null&&t>e){let h=n.shape.map(m=>m);h[n.shape.length-1]=t-e,o=Gt([n,hn(h)],n.shape.length-1),e=t}else o=n;let i=tt(o),s=G(hi(o,i),[r,e]),a=zf(s),l=Math.floor(e/2)+1,c=Pd(a),u=Rf(a),d=Lr(c,[l,e-l],c.shape.length-1),p=Lr(u,[l,e-l],u.shape.length-1),f=o.shape.slice();return f[o.shape.length-1]=l,G(hi(d[0],p[0]),f)}var Uf=R({rfft_:Dke});function kke(n,t){let e=k(n,"a","squaredDifference"),r=k(t,"b","squaredDifference");[e,r]=Pt(e,r),yt(e.shape,r.shape);let o={a:e,b:r},i={};return P.runKernel(bl,o,i)}var vx=R({squaredDifference_:kke});function Nke(n,t){let e=k(n,"x","squeeze","string_or_numeric");return G(e,DP(e.shape,t).newShape)}var qt=R({squeeze_:Nke});function Ake(n,t=0){let e=im(n,"tensors","stack","string_or_numeric");L(e.length>=1,()=>"Pass at least one tensor to tf.stack"),e.length>0&&L(t<=e[0].rank,()=>"Axis must be <= rank of the tensor");let r=e,o={axis:t};return P.runKernel(Zc,r,o)}var sr=R({stack_:Ake});function Rke(n,t=0){let r={x:k(n,"x","step")},o={alpha:t};return P.runKernel(Sl,r,o)}var Ks=R({step_:Rke});function Oke(n,t,e,r,o=0,i=0,s=0,a=0,l=0){let u={x:k(n,"x","stridedSlice","string_or_numeric")},d={begin:t,end:e,strides:r,beginMask:o,endMask:i,ellipsisMask:s,newAxisMask:a,shrinkAxisMask:l};return P.runKernel(xf,u,d)}var A1=R({stridedSlice_:Oke});function Mke(n){let e={x:k(n,"x","tan","float32")};return P.runKernel(Cl,e)}var R1=R({tan_:Mke});function Cn(n,t){fs(n);let e=fi(n,t);if(e.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Xo(n,null,e,t)}function Fo(n,t,e){if(fs(n),t!=null&&t.length!==2)throw new Error("tensor2d() requires shape to have two numbers");let r=fi(n,e);if(r.length!==2&&r.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Xo(n,t,r,e)}function O1(n,t,e){if(fs(n),t!=null&&t.length!==3)throw new Error("tensor3d() requires shape to have three numbers");let r=fi(n,e);if(r.length!==3&&r.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Xo(n,t,r,e)}function Iq(n,t,e){if(fs(n),t!=null&&t.length!==4)throw new Error("tensor4d() requires shape to have four numbers");let r=fi(n,e);if(r.length!==4&&r.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Xo(n,t,r,e)}function Eq(n,t,e){if(fs(n),t!=null&&t.length!==5)throw new Error("tensor5d() requires shape to have five numbers");let r=fi(n,e);if(r.length!==5&&r.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Xo(n,t,r,e)}function Tq(n,t,e){if(fs(n),t!=null&&t.length!==6)throw new Error("tensor6d() requires shape to have six numbers");let r=fi(n,e);if(r.length!==6&&r.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return t=t||r,Xo(n,t,r,e)}function Dq(n,t,e){let r=t.rank>1?t.shape[t.rank-1]:1,o=t.rank>1?t.rank-1:1,i=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${e.shape}, indices.shape: ${t.shape}, shape: ${n}, sliceDim: ${r}, and batchDim: ${o}.`;if(e.rank<o)throw new Error(i+` update.rank < ${o}. `);if(n.length<r+(e.rank-o))throw new Error(i+` Output shape length < ${r+(e.rank-o)}`);if(e.rank!==o+n.length-r)throw new Error(i+` update.rank != ${o+n.length-r}`);for(let s=0;s<o;++s)if(e.shape[s]!==t.shape[s])throw new Error(i+` updates.shape[${s}] (${e.shape[s]}) != indices.shape[${s}] (${t.shape[s]}).`);for(let s=0;s<e.rank-o;++s)if(e.shape[s+o]!==n[s+r])throw new Error(i+` updates.shape[${s+o}] (${e.shape[s+o]}) != shape[${s+o}] (${n[s+o]})`)}function Ob(n,t,e){if(t.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${t.rank}.`);if(n.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${n.rank}.`);if(t.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${t.dtype}`);if(e.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${e}`);if(e.length===0){if(t.size===0)throw new Error(`Indices specified for empty output. indices shape: ${t.shape}`);if(n.size===0)throw new Error(`Updates specified for empty output. updates shape: ${n.shape}`)}Dq(e,t,n)}function Pke(n,t,e){let r=t.shape.length,o=r>1?t.shape[r-1]:1,i=e.length,s=1;for(let d=o;d<i;++d)s*=e[d];let a=o<1?1:o,l=Mt(t.shape)/a,c=[...bc(e.slice(0,o)),1],u=Mt(e);return{sliceRank:o,numUpdates:l,sliceSize:s,strides:c,outputSize:u}}function Fke(n,t,e){let r=k(n,"tensor","tensorScatterupdate"),o=k(t,"indices","tensorScatterupdate","int32"),i=k(e,"updates","tensorScatterupdate");if(Ob(i,o,r.shape),r.dtype!==i.dtype)throw new Error(`tensor and updates must have the same dtype, instead they are ${r.dtype} and ${i.dtype}.`);let s={tensor:r,indices:o,updates:i},a={};return P.runKernel(pf,s,a)}var Nq=R({tensorScatterUpdate_:Fke});function Lke(n,t=1,e=!0){let r=k(n,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");let o=r.shape[r.shape.length-1];if(t<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${t}`);if(t>o)throw new Error(`'k' passed to topk() must be <= the last dimension (${o}) but got ${t}`);let i={x:r},s={k:t,sorted:e},[a,l]=P.runKernel(bf,i,s);return{values:a,indices:l}}var M1=R({topk_:Lke});function $ke(n,t=0,e=1,r,o){if(rr(n),r!=null&&r==="bool")throw new Error("Unsupported data type $ { dtype }");let i=new xm(t,e,r,!0,o),s=ze(n,r);for(let a=0;a<s.values.length;a++)s.values[a]=i.nextValue();return s.toTensor()}var bx=R({truncatedNormal_:$ke});function Vke(n,t=0){let e=k(n,"x","unique","string_or_numeric");L(e.rank>0,()=>"The input tensor must be at least 1D");let r={x:e},o={axis:t},[i,s]=P.runKernel(Ly,r,o);return{values:i,indices:s}}var P1=R({unique_:Vke});function Bke(n,t,e){let r=k(n,"x","unsortedSegmentSum"),o=k(t,"segmentIds","unsortedSegmentSum","int32");L(gd(e),()=>"numSegments must be of dtype int");let i={x:r,segmentIds:o},s={numSegments:e};return P.runKernel(pu,i,s)}var wx=R({unsortedSegmentSum_:Bke});function zke(n,t=0){let e=k(n,"x","unstack","string_or_numeric");L(t>=-e.shape.length&&t<e.shape.length,()=>`Axis = ${t} is not in [-${e.shape.length}, ${e.shape.length})`);let r={value:e},o={axis:t};return P.runKernel(du,r,o)}var $r=R({unstack_:zke});function Aq(n,t){return Nb(n,t,"right")}function F1(n,t=!0,e,r){return P.makeVariable(n,t,e,r)}function L1(n,t){let e=[];for(let i=0;i<t.length;i++)t[i]&&e.push(i);let r=ze(n,"int32"),o=ze([e.length,n.length],"int32");for(let i=0;i<e.length;i++){let s=r.indexToLoc(e[i]),a=i*n.length;o.values.set(s,a)}return o.toTensor()}function Uke(n){return B(this,null,function*(){let t=k(n,"condition","whereAsync","bool"),e=yield t.data(),r=L1(t.shape,e);return n!==t&&t.dispose(),r})}var $1=Uke;function Wke(n,t,e){return B(this,null,function*(){let r=k(n,"tensor","boolMask"),o=k(t,"mask","boolMask","bool"),i=e??0,s=o.rank,a=r.shape;L(s>0,()=>"mask cannot be scalar"),br(a.slice(i,i+s),o.shape,"mask's shape must match the first K dimensions of tensor's shape,");let l=1;for(let m=i;m<i+s;m++)l*=a[m];let c=a.slice(0,i).concat([l],a.slice(i+s)),u=G(r,c),d=G(o,[-1]),p=yield $1(d),f=qt(p,[1]),h=_u(u,f,i);return n!==r&&r.dispose(),t!==o&&o.dispose(),f.dispose(),u.dispose(),d.dispose(),p.dispose(),h})}var Gke=Wke;function jke(n,t,e){let r=k(n,"x","transpose");if(t==null&&(t=r.shape.map((s,a)=>a).reverse()),L(r.rank===t.length,()=>`Error in transpose: rank of input ${r.rank} must match length of perm ${t}.`),t.forEach(s=>{L(s>=0&&s<r.rank,()=>`All entries in 'perm' must be between 0 and ${r.rank-1} but got ${t}`)}),r.rank<=1)return r.clone();let o={x:r},i={perm:t};return r.dtype==="complex64"?Z(()=>{let s=Pd(r),a=Rf(r);return s=P.runKernel(zs,{x:s},i),a=P.runKernel(zs,{x:a},i),e&&(a=Dt(a)),hi(s,a)}):P.runKernel(zs,o,i)}var St=R({transpose_:jke});function Hke(n,t,e,r,o=!0){let i=k(n,"v","movingAverage"),s=k(t,"x","movingAverage"),a=k(e,"decay","movingAverage");Q6(i,s),L(zi(i.shape,s.shape),()=>"Shape mismatch in v and x");let l=Ae(1),c=Ie(l,a),u=U(Ie(s,i),c);if(o){L(r!=null,()=>"When using zeroDebias: true, step is required.");let d=k(r,"step","movingAverage");u=Se(u,Ie(l,wo(a,d)))}return ae(i,u)}var qke=R({movingAverage_:Hke});function Kke(n,t,e){rr(e);let r=k(n,"indices","scatterND","int32"),o=k(t,"updates","scatterND");Ob(o,r,e);let i={indices:r,updates:o},s={shape:e};return P.runKernel(df,i,s)}var Xke=R({scatterND_:Kke});function Rq(n,t,e,r){if(n.dtype!=="int32")throw new Error(`tf.sparseToDense() expects the indices to be int32 type, but the dtype was ${n.dtype}.`);if(n.rank>2)throw new Error(`sparseIndices should be a scalar, vector, or matrix, but got shape ${n.shape}.`);let o=n.rank>0?n.shape[0]:1,i=n.rank>1?n.shape[1]:1;if(e.length!==i)throw new Error(`outputShape has incorrect number of elements:, ${e.length}, should be: ${i}.`);let s=t.size;if(!(t.rank===0||t.rank===1&&s===o))throw new Error(`sparseValues has incorrect shape ${t.shape}, should be [] or [${o}]`);if(t.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}function Zke(n,t,e,r=0){rr(e);let o=k(n,"sparseIndices","sparseToDense","int32"),i=k(t,"sparseValues","sparseToDense","string_or_numeric"),s=k(r,"defaultValue","sparseToDense",i.dtype);Rq(o,i,e,s);let a={sparseIndices:o,sparseValues:i,defaultValue:s},l={outputShape:e};return P.runKernel(gf,a,l)}var Qke=R({sparseToDense_:Zke});function Jke(n,t){let e=k(t,"indices","gatherND","int32"),o={params:k(n,"x","gatherND","string_or_numeric"),indices:e};return P.runKernel(Xp,o)}var eNe=R({gatherND_:Jke});function Oq(n,t){if(t==null)return n.shape.slice();if(zi(n.shape,t))return t;if(n.shape.length===t.length){let e=[];for(let r=0;r<n.shape.length;r++)t[r]==null&&n.shape[r]!=null?e.push(n.shape[r]):e.push(t[r]);return e}return t}function tNe(n,t,e,r){let o=k(n,"x","dropout");if(L(o.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${o.dtype} tensor instead.`),L(t>=0&&t<1,()=>`rate must be a float in the range [0, 1), but got ${t}.`),t===0)return n instanceof bt?o.clone():o;let i=Oq(o,e),s=1-t,a=Se(Cu(ae(ji(i,0,1,"float32",r),s)),s);return U(o,a)}var bF=R({dropout_:tNe});function wF(n){return Math.floor(Math.pow(2,Math.ceil(Math.log(n)/Math.log(2))))}function Mb(n,t,e){let r=1-n%2,o=new Float32Array(n);for(let i=0;i<n;++i){let s=2*Math.PI*i/(n+r-1);o[i]=t-e*Math.cos(s)}return Cn(o,"float32")}function nNe(n,t,e=1){return B(this,null,function*(){let r=k(n,"predictions","inTopK"),o=k(t,"targets","inTopK");L(r.rank>1,()=>`inTopK() expects the predictions to be of rank 2 or higher, but got ${r.rank}`),L(r.rank-1===o.rank,()=>`predictions rank should be 1 larger than targets rank, but got predictions rank ${r.rank} and targets rank ${o.rank}`),br(r.shape.slice(0,r.shape.length-1),o.shape,"predictions's shape should be align with the targets' shape, except the last dimension.");let i=r.shape[r.shape.length-1];L(e>0&&e<=i,()=>`'k' passed to inTopK() must be > 0 && <= the predictions last dimension (${i}), but got ${e}`);let s=yield r.data(),a=yield o.data(),[l,c]=[s.length/i,i],u=kP("bool",l);for(let d=0;d<l;d++){let p=d*c,f=s.subarray(p,p+c),h=[];for(let m=0;m<f.length;m++)h.push({value:f[m],index:m});h.sort((m,g)=>g.value-m.value),u[d]=0;for(let m=0;m<e;m++)if(h[m].index===a[d]){u[d]=1;break}}return n!==r&&r.dispose(),t!==o&&o.dispose(),Yr(u,o.shape,"bool")})}var rNe=nNe;var Wf={};bn(Wf,{conv2d:()=>Mq,depthwiseConv2d:()=>Pq,matMul:()=>Fq});function oNe(n,t,e,r,o,i="NHWC",s){let a=n;n.rank===3&&(a=G(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let l=t;l.rank===3&&(l=G(t,[1,t.shape[0],t.shape[1],t.shape[2]])),L(a.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`),L(l.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${l.shape}.`),L(e.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${e}.`);let c=i==="NHWC"?a.shape[3]:a.shape[1],u=i==="NHWC"?l.shape[3]:l.shape[1];L(c===e[2],()=>`Error in conv2dDerFilter: depth of input ${c}) must match input depth in filter (${e[2]}.`),L(u===e[3],()=>`Error in conv2dDerFilter: depth of dy (${u}) must match output depth for filter (${e[3]}).`),An("conv2dDerFilter",o,s);let d={x:a,dy:l},p={strides:r,pad:o,dataFormat:i,dimRoundingMode:s,filterShape:e};return P.runKernel(Mp,d,p)}var Cx=R({conv2DBackpropFilter_:oNe});function wm(n,t,e){if(e==null||e==="linear")return n;if(e==="relu")return U(n,Ks(t));throw new Error(`Cannot compute gradient for fused activation ${e}.`)}function Cm(n,t){let e=t,r=Tn(n.shape,t.shape);return r.length>0&&(e=Pe(e,r)),G(e,n.shape)}function _m(n,t,e,r){if(t==="linear")return n;if(t==="relu")return ho(n);if(t==="elu")return wu(n);if(t==="relu6")return cx(n);if(t==="prelu")return Vf(n,e);if(t==="leakyrelu")return Of(n,r);if(t==="sigmoid")return jr(n);throw new Error(`Unknown fused activation ${t}.`)}var Sm=(n,t)=>!(n>0)||t==="linear";function iNe({x:n,filter:t,strides:e,pad:r,dataFormat:o="NHWC",dilations:i=[1,1],dimRoundingMode:s,bias:a,activation:l="linear",preluActivationWeights:c,leakyreluAlpha:u}){if(l=l||"linear",Sm(P.state.gradientDepth,l)===!1){L(o==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${o} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let A=mi(n,t,e,r,o,i,s);return a!=null&&(A=ae(A,a)),_m(A,l,c,u)}let d=k(n,"x","conv2d","float32"),p=k(t,"filter","conv2d","float32"),f=d,h=!1;d.rank===3&&(h=!0,f=G(d,[1,d.shape[0],d.shape[1],d.shape[2]])),L(f.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${f.rank}.`),L(p.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${p.rank}.`),An("fused conv2d",r,s);let m=o==="NHWC"?f.shape[3]:f.shape[1];L(p.shape[2]===m,()=>`Error in conv2d: depth of input (${m}) must match input depth for filter ${p.shape[2]}.`),L(po(e,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${e} and dilations '${i}'`);let g=pm(f.shape,p.shape,e,i,r,s),y;a!=null&&(y=k(a,"bias","fused conv2d"),[y]=Pt(y,d),o==="NHWC"?yt(g.outShape,y.shape):(L(y.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${y.shape.length}.`),L(y.shape.length===0||y.shape[0]===g.outChannels||y.shape[0]===1,()=>`Error in fused conv2d: bias shape (${y.shape}) is not compatible with the number of output channels (${g.outChannels})`)));let v;if(c!=null){let A=c.shape;if(L(A.length<=1||A.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${A.length}.`),A.length===1)L(A[0]===1||A[0]===g.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${A}) is not compatible with the number of output channels (${g.outChannels}).`);else if(A.length===3)try{yt(A,g.outShape)}catch{let $=`Error in fused conv2d: PReLU activation weights (${A}) is not compatible with the output shape of the conv2d (${g.outShape}).`;throw Error($)}v=k(c,"prelu weights","fused conv2d")}let w=(A,M)=>{L(o==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${o} but only NHWC is currently supported.`);let[$,V,W,K]=M,te=wm(A,W,l);L(ms(i),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`);let ee=tx(V.shape,te,$,e,r),oe=Cx(V,te,$.shape,e,r),ie=[ee,oe];if(K!=null){let se=Cm(K,te);ie.push(se)}return ie},C={x:f,filter:p,bias:y,preluActivationWeights:v},I={strides:e,pad:r,dataFormat:o,dilations:i,dimRoundingMode:s,activation:l,leakyreluAlpha:u};return a==null?gi((M,$,V)=>{let W=P.runKernel(Ed,C,I);return V([$,M,W]),h&&(W=G(W,[W.shape[1],W.shape[2],W.shape[3]])),{value:W,gradFunc:w}})(f,p):gi((M,$,V,W)=>{let K=P.runKernel(Ed,C,I);return W([$,M,K,V]),h&&(K=G(K,[K.shape[1],K.shape[2],K.shape[3]])),{value:K,gradFunc:w}})(f,p,y)}var Mq=R({fusedConv2d_:iNe});function sNe(n,t,e,r,o,i=[1,1],s){let a=n;n.rank===3&&(a=G(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let l=t;l.rank===3&&(l=G(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let c={x:a,dy:l},u={strides:r,pad:o,dimRoundingMode:s,dilations:i,filterShape:e};return P.runKernel(zp,c,u)}var V1=R({depthwiseConv2dNativeBackpropFilter_:sNe});function aNe(n,t,e,r,o,i=[1,1],s){let a=t,l=!1;t.rank===3&&(l=!0,a=G(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let c={dy:a,filter:e},u={strides:r,pad:o,dimRoundingMode:s,dilations:i,inputShape:n},d=P.runKernel(Up,c,u);return l?G(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var B1=R({depthwiseConv2dNativeBackpropInput_:aNe});function lNe({x:n,filter:t,strides:e,pad:r,dataFormat:o="NHWC",dilations:i=[1,1],dimRoundingMode:s,bias:a,activation:l="linear",preluActivationWeights:c,leakyreluAlpha:u}){if(Sm(P.state.gradientDepth,l)===!1){let I=bu(n,t,e,r,o,i,s);return a!=null&&(I=ae(I,a)),_m(I,l,c,u)}let d=k(n,"x","depthwiseConv2d","float32"),p=k(t,"filter","depthwiseConv2d","float32"),f=d,h=!1;d.rank===3&&(h=!0,f=G(d,[1,d.shape[0],d.shape[1],d.shape[2]])),L(f.rank===4,()=>`Error in fused depthwiseConv2d: input must be rank 4, but got rank ${f.rank}.`),L(p.rank===4,()=>`Error in fused depthwiseConv2d: filter must be rank 4, but got rank ${p.rank}.`),L(f.shape[3]===p.shape[2],()=>`Error in fused depthwiseConv2d: number of input channels (${f.shape[3]}) must match the inChannels dimension in filter ${p.shape[2]}.`),i==null&&(i=[1,1]),L(po(e,i),()=>`Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ${e} and dilations '${i}'`),An("fused depthwiseConv2d",r,s);let m=pm(f.shape,p.shape,e,i,r,s,!0),g;a!=null&&(g=k(a,"bias","fused conv2d"),[g]=Pt(g,d),yt(m.outShape,g.shape));let y;c!=null&&(y=k(c,"prelu weights","fused depthwiseConv2d"));let v=(I,A)=>{L(ms(i),()=>`Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '${i}'`);let[M,$,V,W]=A,K=wm(I,V,l),te=B1($.shape,K,M,e,r,i,s),ee=V1($,K,M.shape,e,r,i,s);if(W!=null){let oe=Cm(g,K);return[te,ee,oe]}return[te,ee]},w={x:f,filter:p,bias:g,preluActivationWeights:y},C={strides:e,pad:r,dataFormat:o,dilations:i,dimRoundingMode:s,activation:l,leakyreluAlpha:u};return a==null?gi((A,M,$)=>{let V=P.runKernel(Td,w,C);return $([M,A,V]),h&&(V=G(V,[V.shape[1],V.shape[2],V.shape[3]])),{value:V,gradFunc:v}})(f,p):gi((A,M,$,V)=>{let W=P.runKernel(Td,w,C);return V([M,A,W,$]),h&&(W=G(W,[W.shape[1],W.shape[2],W.shape[3]])),{value:W,gradFunc:v}})(f,p,g)}var Pq=R({fusedDepthwiseConv2d_:lNe});function cNe({a:n,b:t,transposeA:e=!1,transposeB:r=!1,bias:o,activation:i="linear",preluActivationWeights:s,leakyreluAlpha:a=.2}){if(Sm(P.state.gradientDepth,i)===!1){let K=_t(n,t,e,r);return o!=null&&(K=ae(K,o)),_m(K,i,s,a)}let l=k(n,"a","fused matMul"),c=k(t,"b","fused matMul");[l,c]=Pt(l,c);let u=e?l.shape[l.rank-2]:l.shape[l.rank-1],d=r?c.shape[c.rank-1]:c.shape[c.rank-2],p=e?l.shape[l.rank-1]:l.shape[l.rank-2],f=r?c.shape[c.rank-2]:c.shape[c.rank-1],h=l.shape.slice(0,-2),m=c.shape.slice(0,-2),g=Mt(h),y=Mt(m);L(u===d,()=>`Error in fused matMul: inner shapes (${u}) and (${d}) of Tensors with shapes ${l.shape} and ${c.shape} and transposeA=${e} and transposeB=${r} must match.`);let w=yt(l.shape.slice(0,-2),c.shape.slice(0,-2)).concat([p,f]),C=e?G(l,[g,u,p]):G(l,[g,p,u]),I=r?G(c,[y,f,d]):G(c,[y,d,f]),A;o!=null&&(A=k(o,"bias","fused matMul"),[A]=Pt(A,l),yt(w,A.shape));let M;s!=null&&(M=k(s,"prelu weights","fused matMul"));let $=(K,te)=>{let[ee,oe,ie,se]=te,fe=wm(G(K,ie.shape),ie,i),ue,ye;if(!e&&!r?(ue=_t(fe,oe,!1,!0),ye=_t(ee,fe,!0,!1)):!e&&r?(ue=_t(fe,oe,!1,!1),ye=_t(fe,ee,!0,!1)):e&&!r?(ue=_t(oe,fe,!1,!0),ye=_t(ee,fe,!1,!1)):(ue=_t(oe,fe,!0,!0),ye=_t(fe,ee,!0,!0)),o!=null){let Te=Cm(se,fe);return[ue,ye,Te]}else return[ue,ye]},V={a:C,b:I,bias:A,preluActivationWeights:M},W={transposeA:e,transposeB:r,activation:i,leakyreluAlpha:a};return o==null?gi((te,ee,oe)=>{let ie=P.runKernel(Id,V,W);return oe([te,ee,ie]),{value:G(ie,w),gradFunc:$}})(C,I):gi((te,ee,oe,ie)=>{let se=P.runKernel(Id,V,W);return ie([te,ee,se,oe]),{value:G(se,w),gradFunc:$}})(C,I,A)}var Fq=R({fusedMatMul_:cNe});function uNe(n){return Mb(n,.54,.46)}var Lq=R({hammingWindow_:uNe});function dNe(n){return Mb(n,.5,.5)}var z1=R({hannWindow_:dNe});function pNe(n,t,e,r=!1,o=0){let i=0,s=[];for(;i+t<=n.size;)s.push(Je(n,i,t)),i+=e;if(r)for(;i<n.size;){let a=i+t-n.size,l=Gt([Je(n,i,t-a),Hs([a],o)]);s.push(l),i+=e}return s.length===0?Fo([],[0,t]):G(Gt(s),[s.length,t])}var U1=R({frame_:pNe});function fNe(n,t,e,r,o=z1){r==null&&(r=wF(t));let i=U1(n,t,e),s=U(i,o(t));return Uf(s,r)}var $q=R({stft_:fNe});function hNe(n,t,e,r,o="bilinear",i=0){let s=k(n,"image","cropAndResize"),a=k(t,"boxes","cropAndResize","float32"),l=k(e,"boxInd","cropAndResize","int32"),c=a.shape[0];L(s.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${s.rank}.`),L(a.rank===2&&a.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${c},4] but had shape ${a.shape}.`),L(l.rank===1&&l.shape[0]===c,()=>`Error in cropAndResize: boxInd must be have size [${c}] but had shape ${a.shape}.`),L(r.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${r.length}.`),L(r[0]>=1&&r[1]>=1,()=>`cropSize must be atleast [1,1], but was ${r}`),L(o==="bilinear"||o==="nearest",()=>`method must be bilinear or nearest, but was ${o}`);let u={image:s,boxes:a,boxInd:l},d={method:o,extrapolationValue:i,cropSize:r};return P.runKernel($p,u,d)}var Vq=R({cropAndResize_:hNe});function mNe(n){let t=k(n,"image","flipLeftRight","float32");L(t.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${t.rank}.`);let e={image:t};return P.runKernel(Kp,e,{})}var Bq=R({flipLeftRight_:mNe});function gNe(n){let t=k(n,"image","grayscaleToRGB"),e=t.rank-1,r=t.shape[e];L(t.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${t.rank}.`),L(r===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${r}.`);let o=new Array(t.rank);return o.fill(1,0,e),o[e]=3,fo(t,o)}var zq=R({grayscaleToRGB_:gNe});function yNe(n){let t=k(n,"image","RGBToGrayscale"),e=t.rank-1,r=t.shape[e];L(t.rank>=2,()=>`Error in RGBToGrayscale: images must be at least rank 2, but got rank ${t.rank}.`),L(r===3,()=>`Error in RGBToGrayscale: last dimension of an RGB image should be size 3, but got size ${r}.`);let o=t.dtype,i=me(t,"float32"),s=Cn([.2989,.587,.114]),a;switch(t.rank){case 2:a=Af("ij,j->i",i,s);break;case 3:a=Af("ijk,k->ij",i,s);break;case 4:a=Af("ijkl,l->ijk",i,s);break;case 5:a=Af("ijklm,m->ijkl",i,s);break;case 6:a=Af("ijklmn,n->ijklm",i,s);break;default:throw new Error("Not a valid tensor rank.")}return a=On(a,-1),me(a,o)}var Uq=R({rgbToGrayscale_:yNe});function xNe(n,t,e=0,r=.5){let o=k(n,"image","rotateWithOffset","float32");L(o.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${o.rank}.`);let i={image:o},s={radians:t,fillValue:e,center:r};return P.runKernel(Cf,i,s)}var Wq=R({rotateWithOffset_:xNe});function Xs(n,t,e,r,o,i){r==null&&(r=.5),o==null&&(o=Number.NEGATIVE_INFINITY),i==null&&(i=0);let s=n.shape[0];return e=Math.min(e,s),L(0<=r&&r<=1,()=>`iouThreshold must be in [0, 1], but was '${r}'`),L(n.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${n.rank}'`),L(n.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${n.shape[1]}`),L(t.rank===1,()=>"scores must be a 1D tensor"),L(t.shape[0]===s,()=>`scores has incompatible shape with boxes. Expected ${s}, but was ${t.shape[0]}`),L(0<=i&&i<=1,()=>`softNmsSigma must be in [0, 1], but was '${i}'`),{maxOutputSize:e,iouThreshold:r,scoreThreshold:o,softNmsSigma:i}}function vNe(n,t,e,r=.5,o=Number.NEGATIVE_INFINITY){let i=k(n,"boxes","nonMaxSuppression","float32"),s=k(t,"scores","nonMaxSuppression","float32"),a=Xs(i,s,e,r,o);e=a.maxOutputSize,r=a.iouThreshold,o=a.scoreThreshold;let l={maxOutputSize:e,iouThreshold:r,scoreThreshold:o};return P.runKernel(of,{boxes:i,scores:s},l)}var Gq=R({nonMaxSuppression_:vNe});function jq(n,t,e){let r=bNe(n,t,e),o=r<0?-(r+1):r;n.splice(o,0,t)}function bNe(n,t,e){return CNe(n,t,e||wNe)}function wNe(n,t){return n>t?1:n<t?-1:0}function CNe(n,t,e){let r=0,o=n.length,i=0,s=!1;for(;r<o;){i=r+(o-r>>>1);let a=e(t,n[i]);a>0?r=i+1:(o=i,s=!a)}return s?r:-r-1}function W1(n,t,e,r,o){return CF(n,t,e,r,o,0)}function G1(n,t,e,r,o,i){return CF(n,t,e,r,o,0,!1,i,!0)}function j1(n,t,e,r,o,i){return CF(n,t,e,r,o,i,!0)}function CF(n,t,e,r,o,i,s=!1,a=!1,l=!1){let c=[];for(let g=0;g<t.length;g++)t[g]>o&&c.push({score:t[g],boxIndex:g,suppressBeginIndex:0});c.sort(Hq);let u=i>0?-.5/i:0,d=[],p=[];for(;d.length<e&&c.length>0;){let g=c.pop(),{score:y,boxIndex:v,suppressBeginIndex:w}=g;if(y<o)break;let C=!1;for(let I=d.length-1;I>=w;--I){let A=_Ne(n,v,d[I]);if(A>=r){C=!0;break}if(g.score=g.score*SNe(r,u,A),g.score<=o)break}g.suppressBeginIndex=d.length,C||(g.score===y?(d.push(v),p.push(g.score)):g.score>o&&jq(c,g,Hq))}let f=d.length,h=e-f;a&&h>0&&(d.push(...new Array(h).fill(0)),p.push(...new Array(h).fill(0)));let m={selectedIndices:d};return s&&(m.selectedScores=p),l&&(m.validOutputs=f),m}function _Ne(n,t,e){let r=n.subarray(t*4,t*4+4),o=n.subarray(e*4,e*4+4),i=Math.min(r[0],r[2]),s=Math.min(r[1],r[3]),a=Math.max(r[0],r[2]),l=Math.max(r[1],r[3]),c=Math.min(o[0],o[2]),u=Math.min(o[1],o[3]),d=Math.max(o[0],o[2]),p=Math.max(o[1],o[3]),f=(a-i)*(l-s),h=(d-c)*(p-u);if(f<=0||h<=0)return 0;let m=Math.max(i,c),g=Math.max(s,u),y=Math.min(a,d),v=Math.min(l,p),w=Math.max(y-m,0)*Math.max(v-g,0);return w/(f+h-w)}function SNe(n,t,e){let r=Math.exp(t*e*e);return e<=n?r:0}function Hq(n,t){return n.score-t.score||n.score===t.score&&t.boxIndex-n.boxIndex}function INe(i,s,a){return B(this,arguments,function*(n,t,e,r=.5,o=Number.NEGATIVE_INFINITY){let l=k(n,"boxes","nonMaxSuppressionAsync"),c=k(t,"scores","nonMaxSuppressionAsync"),u=Xs(l,c,e,r,o);e=u.maxOutputSize,r=u.iouThreshold,o=u.scoreThreshold;let d=yield Promise.all([l.data(),c.data()]),p=d[0],f=d[1],{selectedIndices:h}=W1(p,f,e,r,o);return l!==n&&l.dispose(),c!==t&&c.dispose(),Cn(h,"int32")})}var qq=INe;function ENe(n,t,e,r=.5,o=Number.NEGATIVE_INFINITY,i=0){let s=k(n,"boxes","nonMaxSuppression"),a=k(t,"scores","nonMaxSuppression"),l=Xs(s,a,e,r,o,i);e=l.maxOutputSize,r=l.iouThreshold,o=l.scoreThreshold,i=l.softNmsSigma;let c={boxes:s,scores:a},u={maxOutputSize:e,iouThreshold:r,scoreThreshold:o,softNmsSigma:i},d=P.runKernel(sf,c,u);return{selectedIndices:d[0],selectedScores:d[1]}}var Kq=R({nonMaxSuppressionWithScore_:ENe});function TNe(s,a,l){return B(this,arguments,function*(n,t,e,r=.5,o=Number.NEGATIVE_INFINITY,i=0){let c=k(n,"boxes","nonMaxSuppressionAsync"),u=k(t,"scores","nonMaxSuppressionAsync"),d=Xs(c,u,e,r,o,i);e=d.maxOutputSize,r=d.iouThreshold,o=d.scoreThreshold,i=d.softNmsSigma;let p=yield Promise.all([c.data(),u.data()]),f=p[0],h=p[1],{selectedIndices:m,selectedScores:g}=j1(f,h,e,r,o,i);return c!==n&&c.dispose(),u!==t&&u.dispose(),{selectedIndices:Cn(m,"int32"),selectedScores:Cn(g)}})}var Xq=TNe;function DNe(n,t,e,r=.5,o=Number.NEGATIVE_INFINITY,i=!1){let s=k(n,"boxes","nonMaxSuppression"),a=k(t,"scores","nonMaxSuppression"),l=Xs(s,a,e,r,o,null),c=l.maxOutputSize,u=l.iouThreshold,d=l.scoreThreshold,p={boxes:s,scores:a},f={maxOutputSize:c,iouThreshold:u,scoreThreshold:d,padToMaxOutputSize:i},h=P.runKernel(ky,p,f);return{selectedIndices:h[0],validOutputs:h[1]}}var Yq=R({nonMaxSuppressionPadded_:DNe});function kNe(s,a,l){return B(this,arguments,function*(n,t,e,r=.5,o=Number.NEGATIVE_INFINITY,i=!1){let c=k(n,"boxes","nonMaxSuppressionAsync"),u=k(t,"scores","nonMaxSuppressionAsync"),d=Xs(c,u,e,r,o,null),p=d.maxOutputSize,f=d.iouThreshold,h=d.scoreThreshold,[m,g]=yield Promise.all([c.data(),u.data()]),{selectedIndices:y,validOutputs:v}=G1(m,g,p,f,h,i);return c!==n&&c.dispose(),u!==t&&u.dispose(),{selectedIndices:Cn(y,"int32"),validOutputs:Ae(v,"int32")}})}var Zq=kNe;function NNe(n,t,e=!1,r=!1){let o=k(n,"images","resizeBilinear");L(o.rank===3||o.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${o.rank}.`),L(t.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${t}.`),L(r===!1||e===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let i=o,s=!1;o.rank===3&&(s=!0,i=G(o,[1,o.shape[0],o.shape[1],o.shape[2]]));let[]=t,a={images:i},l={alignCorners:e,halfPixelCenters:r,size:t},c=P.runKernel(ru,a,l);return s?G(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var H1=R({resizeBilinear_:NNe});function ANe(n,t,e=!1,r=!1){let o=k(n,"images","resizeNearestNeighbor");L(o.rank===3||o.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${o.rank}.`),L(t.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${t}.`),L(o.dtype==="float32"||o.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),L(r===!1||e===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let i=o,s=!1;o.rank===3&&(s=!0,i=G(o,[1,o.shape[0],o.shape[1],o.shape[2]]));let[]=t,a={images:i},l={alignCorners:e,halfPixelCenters:r,size:t},c=P.runKernel(nu,a,l);return s?G(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var q1=R({resizeNearestNeighbor_:ANe});function RNe(n,t="binary",e=!1,r=.5){let o=k(n,"image","threshold"),i=.2989,s=.587,a=.114,l=o.shape[0]*o.shape[1],c=U(Cn([r]),255),u,d,p,f;if(L(o.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${o.rank}.`),L(o.shape[2]===3||o.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${o.shape[2]}.`),L(o.dtype==="int32"||o.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${o.dtype}.`),L(t==="otsu"||t==="binary",()=>`Method must be binary or otsu, but was ${t}`),o.shape[2]===3){[u,d,p]=Lr(o,[1,1,1],-1);let g=U(u,i),y=U(d,s),v=U(p,a);f=ae(ae(g,y),v)}else f=n;if(t==="otsu"){let g=JI(me(ux(f),"int32"),Yr([]),256);c=ONe(g,l)}let h=e?Gi(f,c):ir(f,c);return me(U(h,255),"int32")}function ONe(n,t){let e=Cn([-1]),r=Cn([0]),o=Cn([0]),i,s,a,l,c,u;for(let d=0;d<n.size-1;d++){i=Je(n,0,d+1),s=Je(n,d+1),c=Se(Pe(i),t),u=Se(Pe(s),t);let p=Pe(U(i,Su(0,i.size)));a=Se(p,Pe(i));let f=Hs(s.shape,i.size),h=ae(Su(0,s.size),f),m=U(s,h);l=Se(Pe(m),Pe(s));let g=Ie(a,l),y=Ie(a,l),v=U(c,u);o=U(U(v,g),y);let w=ir(o,r);r=Rn(w,o,r),e=Rn(w,Cn([d]),e)}return e}var Qq=R({threshold_:RNe});function MNe(n,t,e="nearest",r="constant",o=0,i){let s=k(n,"image","transform","float32"),a=k(t,"transforms","transform","float32");L(s.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${s.rank}.`),L(a.rank===2&&(a.shape[0]===s.shape[0]||a.shape[0]===1)&&a.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),L(i==null||i.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${i}.`);let l={image:s,transforms:a},c={interpolation:e,fillMode:r,fillValue:o,outputShape:i};return P.runKernel(wf,l,c)}var Jq=R({transform_:MNe});function PNe(n,t,e){let r=k(n,"a","bandPart");L(r.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${r.rank}.`);let o=r.shape,[i,s]=r.shape.slice(-2),a,l;typeof t=="number"?(L(t%1===0,()=>`bandPart(): numLower must be an integer, got ${t}.`),L(t<=i,()=>`bandPart(): numLower (${t}) must not be greater than the number of rows (${i}).`),a=k(t<0?i:t,"numLower","bandPart")):(L(t.dtype==="int32",()=>"bandPart(): numLower's dtype must be an int32."),a=Rn(Md(t,0),i,xi(t,i))),typeof e=="number"?(L(e%1===0,()=>`bandPart(): numUpper must be an integer, got ${e}.`),L(e<=s,()=>`bandPart(): numUpper (${e}) must not be greater than the number of columns (${s}).`),l=k(e<0?s:e,"numUpper","bandPart")):(L(e.dtype==="int32",()=>"bandPart(): numUpper's dtype must be an int32."),l=Rn(Md(e,0),s,xi(e,s)));let c=G(Su(0,i,1,"int32"),[-1,1]),u=Su(0,s,1,"int32"),d=Ie(c,u),p=Co(Gi(d,a),Qo(d,Dt(l))),f=hn([i,s],r.dtype);return G(sr($r(G(r,[-1,i,s])).map(h=>Rn(p,h,f))),o)}var e8=R({bandPart_:PNe});function FNe(n){let t;if(Array.isArray(n)){t=!1,L(n!=null&&n.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");let o=n[0].shape[0];for(let i=1;i<n.length;++i)L(n[i].shape[0]===o,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${n[i].shape[0]} vs. ${o})`)}else t=!0,n=Lr(n,n.shape[0],0).map(o=>qt(o,[0]));L(n.length<=n[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${n.length}) exceeds number of dimensions (${n[0].shape[0]}).`);let e=[],r=n;for(let o=0;o<n.length;++o)e.push(P.tidy(()=>{let i=r[o];if(o>0)for(let s=0;s<o;++s){let a=U(Pe(U(e[s],i)),e[s]);i=Ie(i,a)}return Se(i,Od(i,"euclidean"))}));return t?sr(e,0):e}var t8=R({gramSchmidt_:FNe});function LNe(n,t=!1){if(L(n.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${n.rank}`),n.rank===2)return n8(n,t);{let e=n.shape.slice(0,n.shape.length-2).reduce((l,c)=>l*c),r=$r(G(n,[e,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0),o=[],i=[];r.forEach(l=>{let[c,u]=n8(l,t);o.push(c),i.push(u)});let s=G(sr(o,0),n.shape),a=G(sr(i,0),n.shape);return[s,a]}}function n8(n,t=!1){return P.tidy(()=>{L(n.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${n.shape.length}D Tensor.`);let e=n.shape[0],r=n.shape[1],o=hm(e),i=Yo(n),s=Fo([[1]],[1,1]),a=Yo(s),l=e>=r?r:e;for(let c=0;c<l;++c){let u=i,d=a,p=o;[a,i,o]=P.tidy(()=>{let f=Je(i,[c,c],[e-c,1]),h=Od(f),m=Je(i,[c,c],[1,1]),g=Rn(ir(m,0),Fo([[-1]]),Fo([[1]])),y=Ie(m,U(g,h)),v=Se(f,y);v.shape[0]===1?a=Yo(s):a=Gt([s,Je(v,[1,0],[v.shape[0]-1,v.shape[1]])],0);let w=Dt(Se(_t(g,y),h)),C=Je(i,[c,0],[e-c,r]),I=U(w,a),A=St(a);if(c===0)i=Ie(C,_t(I,_t(A,C)));else{let V=Ie(C,_t(I,_t(A,C)));i=Gt([Je(i,[0,0],[c,r]),V],0)}let M=St(I),$=Je(o,[0,c],[e,o.shape[1]-c]);if(c===0)o=Ie($,_t(_t($,a),M));else{let V=Ie($,_t(_t($,a),M));o=Gt([Je(o,[0,0],[e,c]),V],1)}return[a,i,o]}),He([u,d,p])}return!t&&e>r&&(o=Je(o,[0,0],[e,r]),i=Je(i,[0,0],[r,r])),[o,i]})}var r8=R({qr_:LNe});var Dr=function(n){return n[n.NONE=0]="NONE",n[n.MEAN=1]="MEAN",n[n.SUM=2]="SUM",n[n.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS",n}(Dr||{});function $Ne(n,t,e=Dr.SUM_BY_NONZERO_WEIGHTS){let r=k(n,"losses","computeWeightedLoss"),o=null;t!=null&&(o=k(t,"weights","computeWeightedLoss"));let i=o==null?r:U(r,o);if(e===Dr.NONE)return i;if(e===Dr.SUM)return Pe(i);if(e===Dr.MEAN){if(o==null)return Mn(i);{let s=r.size/o.size,a=Se(Pe(i),Pe(o));return s>1?Se(a,Ae(s)):a}}if(e===Dr.SUM_BY_NONZERO_WEIGHTS){if(o==null)return Se(Pe(i),Ae(r.size));{let s=U(o,Tr(r.shape)),a=me(Pe(Nl(s,Ae(0))),"float32");return Se(Pe(i),a)}}throw Error(`Unknown reduction: ${e}`)}var _o=R({computeWeightedLoss_:$Ne});function VNe(n,t,e,r=Dr.SUM_BY_NONZERO_WEIGHTS){let o=k(n,"labels","absoluteDifference"),i=k(t,"predictions","absoluteDifference"),s=null;e!=null&&(s=k(e,"weights","absoluteDifference")),br(o.shape,i.shape,"Error in absoluteDifference: ");let a=Bn(Ie(o,i));return _o(a,s,r)}var o8=R({absoluteDifference_:VNe});function BNe(n,t,e,r,o=Dr.SUM_BY_NONZERO_WEIGHTS){let i=k(n,"labels","cosineDistance"),s=k(t,"predictions","cosineDistance"),a=null;r!=null&&(a=k(r,"weights","cosineDistance")),br(i.shape,s.shape,"Error in cosineDistance: ");let l=Ae(1),c=Ie(l,Pe(U(i,s),e,!0));return _o(c,a,o)}var i8=R({cosineDistance_:BNe});function zNe(n,t,e,r=Dr.SUM_BY_NONZERO_WEIGHTS){let o=k(n,"labels","hingeLoss"),i=k(t,"predictions","hingeLoss"),s=null;e!=null&&(s=k(e,"weights","hingeLoss")),br(o.shape,i.shape,"Error in hingeLoss: ");let a=Ae(1);o=Ie(U(Ae(2),o),a);let l=ho(Ie(a,U(o,i)));return _o(l,s,r)}var s8=R({hingeLoss_:zNe});function UNe(n,t,e,r=1,o=Dr.SUM_BY_NONZERO_WEIGHTS){let i=k(n,"labels","huberLoss"),s=k(t,"predictions","huberLoss"),a=null;e!=null&&(a=k(e,"weights","huberLoss")),br(i.shape,s.shape,"Error in huberLoss: ");let l=Ae(r),c=Bn(Ie(s,i)),u=xi(c,l),d=Ie(c,u),p=ae(U(Ae(.5),xt(u)),U(l,d));return _o(p,a,o)}var a8=R({huberLoss_:UNe});function WNe(n,t,e,r=1e-7,o=Dr.SUM_BY_NONZERO_WEIGHTS){let i=k(n,"labels","logLoss"),s=k(t,"predictions","logLoss"),a=null;e!=null&&(a=k(e,"weights","logLoss")),br(i.shape,s.shape,"Error in logLoss: ");let l=Ae(1),c=Ae(r),u=Dt(U(i,eo(ae(s,c)))),d=U(Ie(l,i),eo(ae(Ie(l,s),c))),p=Ie(u,d);return _o(p,a,o)}var l8=R({logLoss_:WNe});function GNe(n,t,e,r=Dr.SUM_BY_NONZERO_WEIGHTS){let o=k(n,"labels","meanSquaredError"),i=k(t,"predictions","meanSquaredError"),s=null;e!=null&&(s=k(e,"weights","meanSquaredError")),br(o.shape,i.shape,"Error in meanSquaredError: ");let a=vx(o,i);return _o(a,s,r)}var c8=R({meanSquaredError_:GNe});function jNe(n,t){let e=k(n,"labels","sigmoidCrossEntropyWithLogits"),r=k(t,"logits","sigmoidCrossEntropyWithLogits");br(e.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");let o=ho(r),i=U(r,e),s=Mf(Gn(Dt(Bn(r))));return ae(Ie(o,i),s)}function HNe(n,t,e,r=0,o=Dr.SUM_BY_NONZERO_WEIGHTS){let i=k(n,"multiClassLabels","sigmoidCrossEntropy"),s=k(t,"logits","sigmoidCrossEntropy"),a=null;if(e!=null&&(a=k(e,"weights","sigmoidCrossEntropy")),br(i.shape,s.shape,"Error in sigmoidCrossEntropy: "),r>0){let c=Ae(r),u=Ae(1),d=Ae(.5);i=ae(U(i,Ie(u,c)),U(d,c))}let l=jNe(i,s);return _o(l,a,o)}var u8=R({sigmoidCrossEntropy_:HNe});function qNe(n,t,e=-1){if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ${t.rank} and dim was ${e}`);return gi((o,i,s)=>{let l=Pf(i,[e],!0),c=Ie(me(i,"float32"),l);s([o,c]);let u=Dt(U(c,o));return{value:Pe(u,[e]),gradFunc:(f,h)=>{let[m,g]=h,y=qs(f.shape,[e]);return[U(G(f,y),Ie(me(m,"float32"),Gn(g))),U(G(f,y),Ie(Gn(g),me(m,"float32")))]}}})(n,t)}function KNe(n,t,e,r=0,o=Dr.SUM_BY_NONZERO_WEIGHTS){let i=k(n,"onehotLabels","softmaxCrossEntropy"),s=k(t,"logits","softmaxCrossEntropy"),a=null;if(e!=null&&(a=k(e,"weights","softmaxCrossEntropy")),br(i.shape,s.shape,"Error in softmaxCrossEntropy: "),r>0){let c=Ae(r),u=Ae(1),d=Ae(i.shape[1]);i=ae(U(i,Ie(u,c)),Se(c,d))}let l=qNe(i,s);return _o(l,a,o)}var d8=R({softmaxCrossEntropy_:KNe});function XNe(n,t,e,r){let o=k(n,"indices","sparseFillEmptyRows","int32"),i=k(t,"values","sparseFillEmptyRows"),s=k(e,"denseShape","sparseFillEmptyRows","int32"),a=k(r,"defaultValue","sparseFillEmptyRows",i.dtype);if(o.rank!==2)throw new Error(`Indices should be Tensor2D but received shape
        ${o.shape}`);if(i.rank!==1)throw new Error(`Values should be Tensor1D but received shape ${i.shape}`);if(s.rank!==1)throw new Error(`Dense shape should be Tensor1D but received shape ${s.shape}`);if(a.rank!==0)throw new Error(`Default value should be a scalar but received shape ${a.shape}`);let l={indices:o,values:i,denseShape:s,defaultValue:a},c=P.runKernel(Oy,l);return{outputIndices:c[0],outputValues:c[1],emptyRowIndicator:c[2],reverseIndexMap:c[3]}}var p8=R({sparseFillEmptyRows_:XNe});function YNe(n,t,e){let r=k(n,"inputIndices","sparseReshape","int32"),o=k(t,"inputShape","sparseReshape","int32"),i=k(e,"newShape","sparseReshape","int32");if(r.rank!==2)throw new Error(`Input indices should be Tensor2D but received shape
        ${r.shape}`);if(o.rank!==1)throw new Error(`Input shape should be Tensor1D but received shape ${o.shape}`);if(i.rank!==1)throw new Error(`New shape should be Tensor1D but received shape ${i.shape}`);let s={inputIndices:r,inputShape:o,newShape:i},a=P.runKernel(My,s);return{outputIndices:a[0],outputShape:a[1]}}var f8=R({sparseReshape_:YNe});function ZNe(n,t,e){let r=k(n,"data","sparseSegmentMean"),o=k(t,"indices","sparseSegmentMean","int32"),i=k(e,"segmentIds","sparseSegmentMean","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(o.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
          ${o.shape}`);if(i.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
          ${i.shape}`);let s={data:r,indices:o,segmentIds:i};return P.runKernel(hf,s)}var h8=R({sparseSegmentMean_:ZNe});function QNe(n,t,e){let r=k(n,"data","sparseSegmentSum"),o=k(t,"indices","sparseSegmentSum","int32"),i=k(e,"segmentIds","sparseSegmentSum","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(o.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
         ${o.shape}`);if(i.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
         ${i.shape}`);let s={data:r,indices:o,segmentIds:i};return P.runKernel(mf,s)}var m8=R({sparseSegmentSum_:QNe});function JNe(n,t,e,r,o,i,s,a){let l=k(n,"data","stringNGrams","string");if(l.dtype!=="string")throw new Error("Data must be of datatype string");if(l.shape.length!==1)throw new Error(`Data must be a vector, saw: ${l.shape}`);let c=k(t,"dataSplits","stringNGrams");if(c.dtype!=="int32")throw new Error("Data splits must be of datatype int32");let u={separator:e,nGramWidths:r,leftPad:o,rightPad:i,padWidth:s,preserveShortSequences:a},d={data:l,dataSplits:c},p=P.runKernel(vf,d,u);return{nGrams:p[0],nGramsSplits:p[1]}}var g8=R({stringNGrams_:JNe});function eAe(n,t,e=!0){let r=k(n,"input","stringSplit","string"),o=k(t,"delimiter","stringSplit","string");if(r.rank!==1)throw new Error(`Input should be Tensor1D but received shape ${r.shape}`);if(o.rank!==0)throw new Error(`Delimiter should be a scalar but received shape ${o.shape}`);let i={skipEmpty:e},s={input:r,delimiter:o},a=P.runKernel(Py,s,i);return{indices:a[0],values:a[1],shape:a[2]}}var y8=R({stringSplit_:eAe});function tAe(n,t){let e=k(n,"input","stringToHashBucketFast","string"),r={numBuckets:t};if(t<=0)throw new Error("Number of buckets must be at least 1");let o={input:e};return P.runKernel(Fy,o,r)}var x8=R({stringToHashBucketFast_:tAe});function nAe(n,t,e,r=!0){let o=k(n,"input","staticRegexReplace","string"),i={pattern:t,rewrite:e,replaceGlobal:r};return P.runKernel(Qh,{x:o},i)}var v8=R({staticRegexReplace_:nAe});var rAe={fft:zf,ifft:Fd,rfft:Uf,irfft:xx},oAe={hammingWindow:Lq,hannWindow:z1,frame:U1,stft:$q},kr={flipLeftRight:Bq,grayscaleToRGB:zq,resizeNearestNeighbor:q1,resizeBilinear:H1,rgbToGrayscale:Uq,rotateWithOffset:Wq,cropAndResize:Vq,nonMaxSuppression:Gq,nonMaxSuppressionAsync:qq,nonMaxSuppressionWithScore:Kq,nonMaxSuppressionWithScoreAsync:Xq,nonMaxSuppressionPadded:Yq,nonMaxSuppressionPaddedAsync:Zq,threshold:Qq,transform:Jq},_F={bandPart:e8,gramSchmidt:t8,qr:r8},iAe={absoluteDifference:o8,computeWeightedLoss:_o,cosineDistance:i8,hingeLoss:s8,huberLoss:a8,logLoss:l8,meanSquaredError:c8,sigmoidCrossEntropy:u8,softmaxCrossEntropy:d8},sAe={sparseFillEmptyRows:p8,sparseReshape:f8,sparseSegmentMean:h8,sparseSegmentSum:m8},aAe={stringNGrams:g8,stringSplit:y8,stringToHashBucketFast:x8,staticRegexReplace:v8};var ge={};bn(ge,{Serializable:()=>Pb,SerializationMap:()=>K1,getRegisteredName:()=>cAe,registerClass:()=>IF});var lAe=new Map,SF=new Map,Pb=class{getClassName(){return this.constructor.className}static fromConfig(t,e){return new t(e)}},K1=class n{constructor(){this.classNameMap={}}static getMap(){return n.instance==null&&(n.instance=new n),n.instance}static register(t){n.getMap().classNameMap[t.className]=[t,t.fromConfig]}};function IF(n,t,e){L(n.className!=null,()=>"Class being registered does not have the static className property defined."),L(typeof n.className=="string",()=>"className is required to be a string, but got type "+typeof n.className),L(n.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),typeof t>"u"&&(t="Custom"),typeof e>"u"&&(e=n.className);let r=e,o=t+">"+r;return K1.register(n),lAe.set(o,n),SF.set(n,o),n}function cAe(n){return SF.has(n)?SF.get(n):n.className}var So=class extends Pb{minimize(t,e=!1,r){let{value:o,grads:i}=this.computeGradients(t,r);if(r!=null){let s=r.map(a=>({name:a.name,tensor:i[a.name]}));this.applyGradients(s)}else this.applyGradients(i);return He(i),e?o:(o.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(t,e){return fF(t,e)}dispose(){this.iterations_!=null&&He(this.iterations_)}saveIterations(){return B(this,null,function*(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:Ae(this.iterations_,"int32")}})}getWeights(){return B(this,null,function*(){throw new Error("getWeights() is not implemented for this optimizer yet.")})}setWeights(t){return B(this,null,function*(){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)})}extractIterations(t){return B(this,null,function*(){return this.iterations_=(yield t[0].tensor.data())[0],t.slice(1)})}};Object.defineProperty(So,Symbol.hasInstance,{value:n=>n.minimize!=null&&n.computeGradients!=null&&n.applyGradients!=null});var _x=class extends So{static get className(){return"Adadelta"}constructor(t,e,r=null){super(),this.learningRate=t,this.rho=e,this.epsilon=r,this.accumulatedGrads=[],this.accumulatedUpdates=[],r==null&&(this.epsilon=P.backend.epsilon())}applyGradients(t){(Array.isArray(t)?t.map(r=>r.name):Object.keys(t)).forEach((r,o)=>{let i=P.registeredVariables[r],s=!1;this.accumulatedGrads[o]==null&&(this.accumulatedGrads[o]={originalName:`${r}/accum_grad`,variable:Z(()=>tt(i).variable(s))}),this.accumulatedUpdates[o]==null&&(this.accumulatedUpdates[o]={originalName:`${r}/accum_var`,variable:Z(()=>tt(i).variable(s))});let a=Array.isArray(t)?t[o].tensor:t[r];if(a==null)return;let l=this.accumulatedGrads[o].variable,c=this.accumulatedUpdates[o].variable;Z(()=>{let u=ae(U(l,this.rho),U(xt(a),1-this.rho)),d=U(Se(wn(ae(c,this.epsilon)),wn(ae(l,this.epsilon))),a),p=ae(U(c,this.rho),U(xt(d),1-this.rho));l.assign(u),c.assign(p);let f=ae(U(d,-this.learningRate),i);i.assign(f)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(He(this.accumulatedGrads.map(t=>t.variable)),He(this.accumulatedUpdates.map(t=>t.variable)))}getWeights(){return B(this,null,function*(){let t=[...this.accumulatedGrads,...this.accumulatedUpdates];return[yield this.saveIterations()].concat(t.map(e=>({name:e.originalName,tensor:e.variable})))})}setWeights(t){return B(this,null,function*(){t=yield this.extractIterations(t);let e=t.length/2,r=!1;this.accumulatedGrads=t.slice(0,e).map(o=>({originalName:o.name,variable:o.tensor.variable(r)})),this.accumulatedUpdates=t.slice(e,e*2).map(o=>({originalName:o.name,variable:o.tensor.variable(r)}))})}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(t,e){return new t(e.learningRate,e.rho,e.epsilon)}};var Sx=class extends So{static get className(){return"Adagrad"}constructor(t,e=.1){super(),this.learningRate=t,this.initialAccumulatorValue=e,this.accumulatedGrads=[]}applyGradients(t){(Array.isArray(t)?t.map(r=>r.name):Object.keys(t)).forEach((r,o)=>{let i=P.registeredVariables[r];this.accumulatedGrads[o]==null&&(this.accumulatedGrads[o]={originalName:`${r}/accumulator`,variable:Z(()=>Hs(i.shape,this.initialAccumulatorValue).variable(!1))});let s=Array.isArray(t)?t[o].tensor:t[r];if(s==null)return;let a=this.accumulatedGrads[o].variable;Z(()=>{let l=ae(a,xt(s));a.assign(l);let c=ae(U(Se(s,wn(ae(l,P.backend.epsilon()))),-this.learningRate),i);i.assign(c)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&He(this.accumulatedGrads.map(t=>t.variable))}getWeights(){return B(this,null,function*(){return[yield this.saveIterations()].concat(this.accumulatedGrads.map(t=>({name:t.originalName,tensor:t.variable})))})}setWeights(t){return B(this,null,function*(){t=yield this.extractIterations(t);let e=!1;this.accumulatedGrads=t.map(r=>({originalName:r.name,variable:r.tensor.variable(e)}))})}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(t,e){return new t(e.learningRate,e.initialAccumulatorValue)}};var Ix=class extends So{static get className(){return"Adam"}constructor(t,e,r,o=null){super(),this.learningRate=t,this.beta1=e,this.beta2=r,this.epsilon=o,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],Z(()=>{this.accBeta1=Ae(e).variable(),this.accBeta2=Ae(r).variable()}),o==null&&(this.epsilon=P.backend.epsilon())}applyGradients(t){let e=Array.isArray(t)?t.map(r=>r.name):Object.keys(t);Z(()=>{let r=Ie(1,this.accBeta1),o=Ie(1,this.accBeta2);e.forEach((i,s)=>{let a=P.registeredVariables[i],l=!1;this.accumulatedFirstMoment[s]==null&&(this.accumulatedFirstMoment[s]={originalName:`${i}/m`,variable:Z(()=>tt(a).variable(l))}),this.accumulatedSecondMoment[s]==null&&(this.accumulatedSecondMoment[s]={originalName:`${i}/v`,variable:Z(()=>tt(a).variable(l))});let c=Array.isArray(t)?t[s].tensor:t[i];if(c==null)return;let u=this.accumulatedFirstMoment[s].variable,d=this.accumulatedSecondMoment[s].variable,p=ae(U(u,this.beta1),U(c,1-this.beta1)),f=ae(U(d,this.beta2),U(xt(c),1-this.beta2)),h=Se(p,r),m=Se(f,o);u.assign(p),d.assign(f);let g=ae(U(Se(h,ae(wn(m),this.epsilon)),-this.learningRate),a);a.assign(g)}),this.accBeta1.assign(U(this.accBeta1,this.beta1)),this.accBeta2.assign(U(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&He(this.accumulatedFirstMoment.map(t=>t.variable)),this.accumulatedSecondMoment!=null&&He(this.accumulatedSecondMoment.map(t=>t.variable))}getWeights(){return B(this,null,function*(){let t=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[yield this.saveIterations()].concat(t.map(e=>({name:e.originalName,tensor:e.variable})))})}setWeights(t){return B(this,null,function*(){t=yield this.extractIterations(t),Z(()=>{this.accBeta1.assign(wo(this.beta1,this.iterations_+1)),this.accBeta2.assign(wo(this.beta2,this.iterations_+1))});let e=t.length/2,r=!1;this.accumulatedFirstMoment=t.slice(0,e).map(o=>({originalName:o.name,variable:o.tensor.variable(r)})),this.accumulatedSecondMoment=t.slice(e,e*2).map(o=>({originalName:o.name,variable:o.tensor.variable(r)}))})}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon)}};var Ex=class extends So{static get className(){return"Adamax"}constructor(t,e,r,o=null,i=0){super(),this.learningRate=t,this.beta1=e,this.beta2=r,this.epsilon=o,this.decay=i,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],Z(()=>{this.iteration=Ae(0).variable(),this.accBeta1=Ae(e).variable()}),o==null&&(this.epsilon=P.backend.epsilon())}applyGradients(t){let e=Array.isArray(t)?t.map(r=>r.name):Object.keys(t);Z(()=>{let r=Ie(1,this.accBeta1),o=Se(-this.learningRate,ae(U(this.iteration,this.decay),1));e.forEach((i,s)=>{let a=P.registeredVariables[i],l=!1;this.accumulatedFirstMoment[s]==null&&(this.accumulatedFirstMoment[s]={originalName:`${i}/m`,variable:tt(a).variable(l)}),this.accumulatedWeightedInfNorm[s]==null&&(this.accumulatedWeightedInfNorm[s]={originalName:`${i}/v`,variable:tt(a).variable(l)});let c=Array.isArray(t)?t[s].tensor:t[i];if(c==null)return;let u=this.accumulatedFirstMoment[s].variable,d=this.accumulatedWeightedInfNorm[s].variable,p=ae(U(u,this.beta1),U(c,1-this.beta1)),f=U(d,this.beta2),h=Bn(c),m=yi(f,h);u.assign(p),d.assign(m);let g=ae(U(Se(o,r),Se(p,ae(m,this.epsilon))),a);a.assign(g)}),this.iteration.assign(ae(this.iteration,1)),this.accBeta1.assign(U(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&He(this.accumulatedFirstMoment.map(t=>t.variable)),this.accumulatedWeightedInfNorm!=null&&He(this.accumulatedWeightedInfNorm.map(t=>t.variable))}getWeights(){return B(this,null,function*(){throw new Error("getWeights() is not implemented for Adamax yet.")})}setWeights(t){return B(this,null,function*(){throw new Error("setWeights() is not implemented for Adamax yet.")})}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon,e.decay)}};var Gf=class extends So{static get className(){return"SGD"}constructor(t){super(),this.learningRate=t,this.setLearningRate(t)}applyGradients(t){(Array.isArray(t)?t.map(r=>r.name):Object.keys(t)).forEach((r,o)=>{let i=Array.isArray(t)?t[o].tensor:t[r];if(i==null)return;let s=P.registeredVariables[r];Z(()=>{let a=ae(U(this.c,i),s);s.assign(a)})}),this.incrementIterations()}setLearningRate(t){this.learningRate=t,this.c!=null&&this.c.dispose(),this.c=Wn(Ae(-t))}dispose(){this.c.dispose()}getWeights(){return B(this,null,function*(){return[yield this.saveIterations()]})}setWeights(t){return B(this,null,function*(){if(t=yield this.extractIterations(t),t.length!==0)throw new Error("SGD optimizer does not have settable weights.")})}getConfig(){return{learningRate:this.learningRate}}static fromConfig(t,e){return new t(e.learningRate)}};var Tx=class extends Gf{static get className(){return"Momentum"}constructor(t,e,r=!1){super(t),this.learningRate=t,this.momentum=e,this.useNesterov=r,this.accumulations=[],this.m=Ae(this.momentum)}applyGradients(t){(Array.isArray(t)?t.map(r=>r.name):Object.keys(t)).forEach((r,o)=>{let i=P.registeredVariables[r];this.accumulations[o]==null&&(this.accumulations[o]={originalName:`${r}/momentum`,variable:Z(()=>tt(i).variable(!1))});let s=this.accumulations[o].variable,a=Array.isArray(t)?t[o].tensor:t[r];a!=null&&Z(()=>{let l,c=ae(U(this.m,s),a);this.useNesterov?l=ae(U(this.c,ae(a,U(c,this.m))),i):l=ae(U(this.c,c),i),s.assign(c),i.assign(l)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&He(this.accumulations.map(t=>t.variable))}setMomentum(t){this.momentum=t}getWeights(){return B(this,null,function*(){return[yield this.saveIterations()].concat(this.accumulations.map(t=>({name:t.originalName,tensor:t.variable})))})}setWeights(t){return B(this,null,function*(){t=yield this.extractIterations(t);let e=!1;this.accumulations=t.map(r=>({originalName:r.name,variable:r.tensor.variable(e)}))})}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(t,e){return new t(e.learningRate,e.momentum,e.useNesterov)}};var Dx=class extends So{static get className(){return"RMSProp"}constructor(t,e=.9,r=0,o=null,i=!1){if(super(),this.learningRate=t,this.decay=e,this.momentum=r,this.epsilon=o,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=i,o==null&&(this.epsilon=P.backend.epsilon()),t==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(t){(Array.isArray(t)?t.map(r=>r.name):Object.keys(t)).forEach((r,o)=>{let i=P.registeredVariables[r],s=!1;this.accumulatedMeanSquares[o]==null&&(this.accumulatedMeanSquares[o]={originalName:`${r}/rms`,variable:Z(()=>tt(i).variable(s))}),this.accumulatedMoments[o]==null&&(this.accumulatedMoments[o]={originalName:`${r}/momentum`,variable:Z(()=>tt(i).variable(s))}),this.accumulatedMeanGrads[o]==null&&this.centered&&(this.accumulatedMeanGrads[o]={originalName:`${r}/mg`,variable:Z(()=>tt(i).variable(s))});let a=Array.isArray(t)?t[o].tensor:t[r];if(a==null)return;let l=this.accumulatedMeanSquares[o].variable,c=this.accumulatedMoments[o].variable;Z(()=>{let u=ae(U(l,this.decay),U(xt(a),1-this.decay));if(this.centered){let d=this.accumulatedMeanGrads[o].variable,p=ae(U(d,this.decay),U(a,1-this.decay)),f=Se(U(a,this.learningRate),wn(Ie(u,ae(xt(p),this.epsilon)))),h=ae(U(c,this.momentum),f);l.assign(u),d.assign(p),c.assign(h);let m=Ie(i,h);i.assign(m)}else{let d=ae(U(l,this.decay),U(xt(a),1-this.decay)),p=ae(U(c,this.momentum),Se(U(a,this.learningRate),wn(ae(d,this.epsilon))));l.assign(d),c.assign(p);let f=Ie(i,p);i.assign(f)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&He(this.accumulatedMeanSquares.map(t=>t.variable)),this.accumulatedMeanGrads!=null&&this.centered&&He(this.accumulatedMeanGrads.map(t=>t.variable)),this.accumulatedMoments!=null&&He(this.accumulatedMoments.map(t=>t.variable))}getWeights(){return B(this,null,function*(){let t=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&t.push(...this.accumulatedMeanGrads),[yield this.saveIterations()].concat(t.map(e=>({name:e.originalName,tensor:e.variable})))})}setWeights(t){return B(this,null,function*(){t=yield this.extractIterations(t);let e=this.centered?t.length/3:t.length/2,r=!1;this.accumulatedMeanSquares=t.slice(0,e).map(o=>({originalName:o.name,variable:o.tensor.variable(r)})),this.accumulatedMoments=t.slice(e,e*2).map(o=>({originalName:o.name,variable:o.tensor.variable(r)})),this.centered&&(this.accumulatedMeanGrads=t.slice(e*2,e*3).map(o=>({originalName:o.name,variable:o.tensor.variable(r)})))})}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(t,e){return new t(e.learningRate,e.decay,e.momentum,e.epsilon,e.centered)}};var uAe=[_x,Sx,Ix,Ex,Tx,Dx,Gf];function b8(){for(let n of uAe)IF(n)}var Al={};bn(Al,{CompositeArrayBuffer:()=>bo,browserFiles:()=>C8,browserHTTPRequest:()=>T8,concatenateArrayBuffers:()=>c5,copyModel:()=>_5,decodeWeights:()=>MI,decodeWeightsStream:()=>PI,encodeWeights:()=>i5,fromMemory:()=>D8,fromMemorySync:()=>RF,getLoadHandlers:()=>f5,getModelArtifactsForJSON:()=>qy,getModelArtifactsForJSONSync:()=>JP,getModelArtifactsInfoForJSON:()=>gu,getSaveHandlers:()=>p5,getWeightSpecs:()=>Ib,http:()=>Y1,isHTTPScheme:()=>X1,listModels:()=>w5,loadWeights:()=>S8,moveModel:()=>S5,registerLoadRouter:()=>d5,registerSaveRouter:()=>u5,removeModel:()=>C5,weightsLoaderFactory:()=>NF,withSaveHandler:()=>k8,withSaveHandlerSync:()=>N8});var dAe="model",pAe=".json",fAe=".weights.bin";function w8(n){return new Promise(t=>setTimeout(t)).then(n)}var EF=(()=>{class n{constructor(e){if(!q().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(n.URL_SCHEME)&&(e=e.slice(n.URL_SCHEME.length)),(e==null||e.length===0)&&(e=dAe),this.modelJsonFileName=e+pAe,this.weightDataFileName=e+fAe}save(e){return B(this,null,function*(){if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");let r=bo.join(e.weightData),o=window.URL.createObjectURL(new Blob([r],{type:"application/octet-stream"}));if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{let i=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],s=FI(e,i),a=window.URL.createObjectURL(new Blob([JSON.stringify(s)],{type:"application/json"})),l=this.modelJsonAnchor==null?document.createElement("a"):this.modelJsonAnchor;if(l.download=this.modelJsonFileName,l.href=a,yield w8(()=>l.dispatchEvent(new MouseEvent("click"))),e.weightData!=null){let c=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor;c.download=this.weightDataFileName,c.href=o,yield w8(()=>c.dispatchEvent(new MouseEvent("click")))}return{modelArtifactsInfo:gu(e)}}})}}return n.URL_SCHEME="downloads://",n})();var TF=class{constructor(t){if(t==null||t.length<1)throw new Error(`When calling browserFiles, at least 1 file is required, but received ${t}`);this.jsonFile=t[0],this.weightsFiles=t.slice(1)}load(){return B(this,null,function*(){return new Promise((t,e)=>{let r=new FileReader;r.onload=o=>{let i=JSON.parse(o.target.result),s=i.modelTopology;if(s==null){e(new Error(`modelTopology field is missing from file ${this.jsonFile.name}`));return}if(i.weightsManifest==null){e(new Error(`weightManifest field is missing from file ${this.jsonFile.name}`));return}if(this.weightsFiles.length===0){t({modelTopology:s});return}let l=qy(i,c=>this.loadWeights(c));t(l)},r.onerror=o=>e(`Failed to read model topology and weights manifest JSON from file '${this.jsonFile.name}'. BrowserFiles supports loading Keras-style tf.Model artifacts only.`),r.readAsText(this.jsonFile)})})}loadWeights(t){let e=[],r=[];for(let s of t)e.push(...s.weights),r.push(...s.paths);let o=this.checkManifestAndWeightFiles(t),i=r.map(s=>this.loadWeightsFile(s,o[s]));return Promise.all(i).then(s=>[e,s])}loadWeightsFile(t,e){return new Promise((r,o)=>{let i=new FileReader;i.onload=s=>{let a=s.target.result;r(a)},i.onerror=s=>o(`Failed to weights data from file of path '${t}'.`),i.readAsArrayBuffer(e)})}checkManifestAndWeightFiles(t){let e=[],r=this.weightsFiles.map(i=>QP(i.name)),o={};for(let i of t)i.paths.forEach(s=>{let a=QP(s);if(e.indexOf(a)!==-1)throw new Error(`Duplicate file basename found in weights manifest: '${a}'`);if(e.push(a),r.indexOf(a)===-1)throw new Error(`Weight file with basename '${a}' is not provided.`);o[s]=this.weightsFiles[r.indexOf(a)]});if(e.length!==this.weightsFiles.length)throw new Error(`Mismatch in the number of files in weights manifest (${e.length}) and the number of weight files provided (${this.weightsFiles.length}).`);return o}},hAe=n=>q().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(EF.URL_SCHEME)?mAe(n.slice(EF.URL_SCHEME.length)):null;Qr.registerSaveRouter(hAe);function mAe(n="model"){return new EF(n)}function C8(n){return new TF(n)}function DF(n,t,e,r){s(n),e=e??0,r=r??1,a(e,r);let o=0,i=l=>(l.then(c=>{let u=e+ ++o/n.length*(r-e);return t(u),c}),l);function s(l){L(l!=null&&Array.isArray(l)&&l.length>0,()=>"promises must be a none empty array")}function a(l,c){L(l>=0&&l<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${l}`),L(c>=0&&c<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${c}`),L(c>=l,()=>`startFraction must be no more than endFraction, but got startFraction ${l} and endFraction ${c}`)}return Promise.all(n.map(i))}function kF(n,t){return B(this,null,function*(){t==null&&(t={});let e=t.fetchFunc==null?q().platform.fetch:t.fetchFunc,r=n.map(d=>e(d,t.requestInit,{isBinary:!0})),a=(t.onProgress==null?yield Promise.all(r):yield DF(r,t.onProgress,0,.5)).map(d=>d.arrayBuffer());return t.onProgress==null?yield Promise.all(a):yield DF(a,t.onProgress,.5,1)})}function _8(n,t){var e;let r=t.fetchFunc==null?q().platform.fetch:t.fetchFunc,o=0,i;return(e=t.onProgress)===null||e===void 0||e.call(t,0),new ReadableStream({pull:s=>B(this,null,function*(){for(var a;o<n.length;){i||(i=(yield r(n[o],t.requestInit,{isBinary:!0})).body.getReader());let{done:l,value:c}=yield i.read();if(l){o++,i=void 0,(a=t.onProgress)===null||a===void 0||a.call(t,o/n.length);continue}s.enqueue(c);return}s.close()})})}function S8(n,t="",e,r){return B(this,null,function*(){return NF(s=>kF(s,{requestInit:r}))(n,t,e)})}function NF(n){return(t,e="",r)=>B(this,null,function*(){let o=t.map(()=>!1),i={},s=r!=null?r.map(()=>!1):[],a=[];if(t.forEach((f,h)=>{let m=0;f.weights.forEach(g=>{let y="quantization"in g?g.quantization.dtype:g.dtype,v=Nd[y]*Mt(g.shape),w=()=>{o[h]=!0,i[h]==null&&(i[h]=[]),i[h].push({manifestEntry:g,groupOffset:m,sizeBytes:v})};r!=null?r.forEach((C,I)=>{C===g.name&&(w(),s[I]=!0)}):w(),a.push(g.name),m+=v})}),!s.every(f=>f)){let f=r.filter((h,m)=>!s[m]);throw new Error(`Could not find weights in manifest with names: ${f.join(", ")}. 
Manifest JSON has weights with names: ${a.join(", ")}.`)}let l=o.reduce((f,h,m)=>(h&&f.push(m),f),[]),c=[];l.forEach(f=>{t[f].paths.forEach(h=>{let m=e+(e.endsWith("/")?"":"/")+h;c.push(m)})});let u=yield n(c),d={},p=0;return l.forEach(f=>{let h=t[f].paths.length,m=new bo(u.slice(p,p+h));i[f].forEach(y=>{let v=m.slice(y.groupOffset,y.groupOffset+y.sizeBytes),w=MI(v,[y.manifestEntry]);for(let C in w)d[C]=w[C]}),p+=h}),d})}var gAe="application/octet-stream",yAe="application/json",I8=(()=>{class n{constructor(e,r){if(this.DEFAULT_METHOD="POST",r==null&&(r={}),this.weightPathPrefix=r.weightPathPrefix,this.weightUrlConverter=r.weightUrlConverter,r.fetchFunc!=null?(L(typeof r.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=r.fetchFunc):this.fetch=q().platform.fetch,L(e!=null&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&L(e.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`),this.path=e,r.requestInit!=null&&r.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=r.requestInit||{},this.loadOptions=r}save(e){return B(this,null,function*(){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");let r=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);r.body=new FormData;let o=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],i=FI(e,o);if(r.body.append("model.json",new Blob([JSON.stringify(i)],{type:yAe}),"model.json"),e.weightData!=null){let a=bo.join(e.weightData);r.body.append("model.weights.bin",new Blob([a],{type:gAe}),"model.weights.bin")}let s=yield this.fetch(this.path,r);if(s.ok)return{modelArtifactsInfo:gu(e),responses:[s]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${s.status}.`)})}loadModelJSON(){return B(this,null,function*(){let e=yield this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let r;try{r=yield e.json()}catch{let a=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?a+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":a+=" Please make sure the server is serving valid JSON for this request.",new Error(a)}let o=r.modelTopology,i=r.weightsManifest;if(o==null&&i==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return r})}load(){return B(this,null,function*(){if(this.loadOptions.streamWeights)return this.loadStream();let e=yield this.loadModelJSON();return qy(e,r=>this.loadWeights(r))})}loadStream(){return B(this,null,function*(){let e=yield this.loadModelJSON(),r=yield this.getWeightUrls(e.weightsManifest),o=Ib(e.weightsManifest),i=()=>_8(r,this.loadOptions);return Object.assign(Object.assign({},e),{weightSpecs:o,getWeightStream:i})})}getWeightUrls(e){return B(this,null,function*(){let r=Array.isArray(this.path)?this.path[1]:this.path,[o,i]=xAe(r),s=this.weightPathPrefix||o,a=[],l=[];for(let c of e)for(let u of c.paths)this.weightUrlConverter!=null?l.push(this.weightUrlConverter(u)):a.push(s+u+i);return this.weightUrlConverter&&a.push(...yield Promise.all(l)),a})}loadWeights(e){return B(this,null,function*(){let r=yield this.getWeightUrls(e),o=Ib(e),i=yield kF(r,this.loadOptions);return[o,i]})}}return n.URL_SCHEME_REGEX=/^https?:\/\//,n})();function xAe(n){let t=n.lastIndexOf("/"),e=n.lastIndexOf("?"),r=n.substring(0,t),o=e>t?n.substring(e):"";return[r+"/",o]}function X1(n){return n.match(I8.URL_SCHEME_REGEX)!=null}var E8=(n,t)=>{if(typeof fetch>"u"&&(t==null||t.fetchFunc==null))return null;{let e=!0;if(Array.isArray(n)?e=n.every(r=>X1(r)):e=X1(n),e)return Y1(n,t)}return null};Qr.registerSaveRouter(E8);Qr.registerLoadRouter(E8);function Y1(n,t){return new I8(n,t)}function T8(n,t){return Y1(n,t)}var Fb=class{constructor(t){this.modelArtifacts=t}load(){return this.modelArtifacts}},Z1=class{constructor(t){this.saveHandler=t}save(t){return this.saveHandler(t)}},AF=class{constructor(t){t.load&&(this.load=()=>Promise.resolve(t.load())),t.save&&(this.save=e=>Promise.resolve(t.save(e)))}};function D8(n,t,e,r){let o=arguments;return new AF(RF(...o))}function RF(n,t,e,r){return arguments.length===1?n.modelTopology!=null||n.weightSpecs!=null?new Fb(n):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Fb({modelTopology:n})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Fb({modelTopology:n,weightSpecs:t,weightData:e,trainingConfig:r}))}function k8(n){return new Z1(n)}function N8(n){return new Z1(n)}var Ld={};bn(Ld,{draw:()=>EAe,fromPixels:()=>TAe,fromPixelsAsync:()=>_Ae,toPixels:()=>IAe});var Im,A8=!1;function R8(n,t=3){if(t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(n==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let e=!1,r=!1,o=!1,i=!1,s=!1,a=!1;if(n.data instanceof Uint8Array)e=!0;else if(typeof ImageData<"u"&&n instanceof ImageData)r=!0;else if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement)o=!0;else if(typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement)i=!0;else if(n.getContext!=null)s=!0;else if(typeof ImageBitmap<"u"&&n instanceof ImageBitmap)a=!0;else throw new Error(`pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ${n.constructor.name}`);if($y(Jh,P.backendName)!=null){let h={pixels:n},m={numChannels:t};return P.runKernel(Jh,h,m)}let[c,u]=o?[n.videoWidth,n.videoHeight]:[n.width,n.height],d;if(s)d=n.getContext("2d").getImageData(0,0,c,u).data;else if(r||e)d=n.data;else if(i||o||a){if(Im==null)if(typeof document>"u")if(typeof OffscreenCanvas<"u"&&typeof OffscreenCanvasRenderingContext2D<"u")Im=new OffscreenCanvas(1,1).getContext("2d");else throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");else Im=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});Im.canvas.width=c,Im.canvas.height=u,Im.drawImage(n,0,0,c,u),d=Im.getImageData(0,0,c,u).data}let p;if(t===4)p=new Int32Array(d);else{let h=c*u;p=new Int32Array(h*t);for(let m=0;m<h;m++)for(let g=0;g<t;++g)p[m*t+g]=d[m*4+g]}return O1(p,[u,c,t],"int32")}function vAe(n){return n!=null&&n.data instanceof Uint8Array}function bAe(){return typeof window<"u"&&typeof ImageBitmap<"u"&&window.hasOwnProperty("createImageBitmap")}function wAe(n){return n!=null&&n.width!==0&&n.height!==0}function CAe(n){return bAe()&&!(n instanceof ImageBitmap)&&wAe(n)&&!vAe(n)}function _Ae(n,t=3){return B(this,null,function*(){let e=null;if(q().getBool("WRAP_TO_IMAGEBITMAP")&&CAe(n)){let r;try{r=yield createImageBitmap(n,{premultiplyAlpha:"none"})}catch{r=null}r!=null&&r.width===n.width&&r.height===n.height?e=r:e=n}else e=n;return R8(e,t)})}function O8(n){if(n.rank!==2&&n.rank!==3)throw new Error(`toPixels only supports rank 2 or 3 tensors, got rank ${n.rank}.`);let t=n.rank===2?1:n.shape[2];if(t>4||t===2)throw new Error(`toPixels only supports depth of size 1, 3 or 4 but got ${t}`);if(n.dtype!=="float32"&&n.dtype!=="int32")throw new Error(`Unsupported type for toPixels: ${n.dtype}. Please use float32 or int32 tensors.`)}function SAe(n){let t=n?.alpha||1;if(t>1||t<0)throw new Error(`Alpha value ${t} is suppoed to be in range [0 - 1].`)}function IAe(n,t){return B(this,null,function*(){let e=k(n,"img","toPixels");if(!(n instanceof bt)){let c=e;e=me(c,"int32"),c.dispose()}O8(e);let[r,o]=e.shape.slice(0,2),i=e.rank===2?1:e.shape[2],s=yield e.data(),a=e.dtype==="float32"?255:1,l=new Uint8ClampedArray(o*r*4);for(let c=0;c<r*o;++c){let u=[0,0,0,255];for(let p=0;p<i;p++){let f=s[c*i+p];if(e.dtype==="float32"){if(f<0||f>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${f}.`)}else if(e.dtype==="int32"&&(f<0||f>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${f}.`);i===1?(u[0]=f*a,u[1]=f*a,u[2]=f*a):u[p]=f*a}let d=c*4;l[d+0]=Math.round(u[0]),l[d+1]=Math.round(u[1]),l[d+2]=Math.round(u[2]),l[d+3]=Math.round(u[3])}if(t!=null){A8||$y(Zh,P.backendName)!=null&&(console.warn("tf.browser.toPixels is not efficient to draw tensor on canvas. Please try tf.browser.draw instead."),A8=!0),t.width=o,t.height=r;let c=t.getContext("2d"),u=new ImageData(l,o,r);c.putImageData(u,0,0)}return e!==n&&e.dispose(),l})}function EAe(n,t,e){let r=k(n,"img","draw");if(!(n instanceof bt)){let s=r;r=me(s,"int32"),s.dispose()}O8(r),SAe(e?.imageOptions);let o={image:r},i={canvas:t,options:e};P.runKernel(Zh,o,i)}var TAe=R({fromPixels_:R8});function DAe(n,t){let e=n.shape.length,r=t.shape.length;if(e<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${e}.`);if(r<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${r}.`);if(t.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${t.dtype}.`);if(t.shape[r-1]>e)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${t.shape[r-1]} vs. ${e}`);if(Mt(n.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${n.shape}.`);let o=t.shape,i=o[o.length-1],s=1;for(let d=0;d<o.length-1;++d)s*=o[d];let a=n.shape,l=o.slice();l.pop();let c=1;for(let d=i;d<e;++d)c*=a[d],l.push(a[d]);let u=[...bc(n.shape).map(d=>d/c),1].slice(0,i);return[l,s,c,u]}var yr={};bn(yr,{assertParamsValid:()=>NAe,computeFlatOffset:()=>PAe,computeOutShape:()=>RAe,getNormalizedAxes:()=>OAe,isSliceContinous:()=>MAe,maskToAxes:()=>AAe,parseSliceParams:()=>MF,sliceInfo:()=>FAe,startForAxis:()=>z8,startIndicesWithElidedDims:()=>$8,stopForAxis:()=>U8,stopIndicesWithElidedDims:()=>V8,stridesForAxis:()=>B8,stridesWithElidedDims:()=>P8});var OF=-2,kAe=-1;function NAe(n,t,e){let r=n.shape.length;L(r===t.length,()=>`Error in slice${r}D: Length of begin ${t} must match the rank of the array (${r}).`),L(r===e.length,()=>`Error in slice${r}D: Length of size ${e} must match the rank of the array (${r}).`);for(let o=0;o<r;++o)L(t[o]+e[o]<=n.shape[o],()=>`Error in slice${r}D: begin[${o}] + size[${o}] (${t[o]+e[o]}) would overflow input.shape[${o}] (${n.shape[o]})`)}function AAe(n){let t=[],e=0;for(;n>0;)n&1&&t.push(e),n/=2,e++;return t}function RAe(n,t,e){let r=[];for(let o=0;o<n.length;o++)r[o]=Math.ceil((t[o]-n[o])/e[o]);return r}function P8(n,t,e,r){let o=[...n];for(let i=o.length;i<r.length;i++)o.push(1);for(let i=0;i<e;i++)i===0?o[t]=1:(o.splice(t,0,1),o.pop());return o}function F8(n,t,e){return e<=n?e:e-(t-1)}function L8(n,t){let e=[];for(let r=0;r<n;r++)e.push(t+r);return e}function OAe(n,t,e,r,o,i,s,a,l){let c=n.length,u=new Array(c),d=new Array(c),p=new Array(c);if(t.length&&e>0){let f=t[0],h=e+1;u=$8(s,f,h,r,n),d=V8(a,f,h,o,n),p=P8(i,f,h,n)}else for(let f=0;f<c;f++)u[f]=z8(s,r,i,n,f,l),d[f]=U8(a,o,i,n,f,l),p[f]=B8(i,f,l);return{begin:u,end:d,strides:p}}function $8(n,t,e,r,o){let i=[...o],s=L8(e,t);for(let a=0;a<i.length;a++)if(s.indexOf(a)>-1)i[a]=0;else{let l=F8(t,e,a),c=r[l];n&1<<l&&(c=0),i[a]=c}return i}function V8(n,t,e,r,o){let i=[...o],s=L8(e,t);for(let a=0;a<i.length;a++)if(s.indexOf(a)>-1)i[a]=Number.MAX_SAFE_INTEGER;else{let l=F8(t,e,a),c=r[l];n&1<<l&&(c=Number.MAX_SAFE_INTEGER),i[a]=c}for(let a=0;a<i.length;a++){let l=o[a];i[a]<0&&(i[a]+=l),i[a]=_y(0,i[a],o[a])}return i}function B8(n,t,e){let r=n[t];return(e&1<<t||r==null)&&(r=1),r}function z8(n,t,e,r,o,i){let s=t[o],a=e[o]||1;(n&1<<o||i&1<<o||s==null)&&(a>0?s=Number.MIN_SAFE_INTEGER:s=Number.MAX_SAFE_INTEGER);let l=r[o];return s<0&&(s+=l),s=_y(0,s,l-1),s}function U8(n,t,e,r,o,i){let s=t[o],a=e[o]||1;(n&1<<o||i&1<<o||s==null)&&(a>0?s=Number.MAX_SAFE_INTEGER:s=Number.MIN_SAFE_INTEGER);let l=r[o];return s<0&&(s+=l),a>0?s=_y(0,s,l):s=_y(-1,s,l-1),s}function MAe(n,t,e){let r=e.length;for(let o=0;o<e.length;o++)if(e[o]>1){r=o;break}for(let o=r+1;o<e.length;o++)if(t[o]>0||e[o]!==n[o])return!1;return!0}function PAe(n,t){let e=n.length>0?n[n.length-1]:1;for(let r=0;r<n.length-1;r++)e+=n[r]*t[r];return e}function MF(n,t,e){let r,o=n.shape.length;typeof t=="number"?r=[t,...new Array(o-1).fill(0)]:t.length<o?r=t.concat(new Array(o-t.length).fill(0)):r=t.slice(),r.forEach(s=>{L(s!==-1,()=>"slice() does not support negative begin indexing.")});let i;return e==null?i=new Array(o).fill(-1):typeof e=="number"?i=[e,...new Array(o-1).fill(-1)]:e.length<o?i=e.concat(new Array(o-e.length).fill(-1)):i=e,i=i.map((s,a)=>s>=0?s:(L(s===-1,()=>`Negative size values should be exactly -1 but got ${s} for the slice() size at index ${a}.`),n.shape[a]-r[a])),[r,i]}function FAe(n,t,e,r,o,i,s,a,l){let c;if(r==null?(c=new Array(t.length),c.fill(1)):c=r,s!=null&&s&s-1)throw new Error("Multiple ellipses in slice is not allowed.");let u=!1,d={dims:c.length,numAddAxisAfterEllipsis:0,begin:t.slice(),end:e.slice(),strides:c.slice(),beginMask:o,endMask:i,ellipsisMask:s,newAxisMask:a,shrinkAxisMask:l};for(let w=0;w<d.dims;w++)u&&1<<w&a&&d.numAddAxisAfterEllipsis++,1<<w&s&&(u=!0);u||(d.ellipsisMask|=1<<d.dims,d.dims++);let p={dims:n.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};LAe(d,p);let f=!0,h=!0,m=!0,g=[],y=[];for(let w=0;w<n.length;++w){if(p.strides[w]===0)throw Error(`strides[${w}] must be non-zero`);let C=!!(p.shrinkAxisMask&1<<w),I=n[w];if(I===-1){g.push(C?1:-1);continue}let A=[p.beginMask&1<<w,p.endMask&1<<w],M=[p.strides[w]>0?0:-1,p.strides[w]>0?I:I-1];if(C&&p.strides[w]<=0)throw Error("only stride 1 allowed on non-range indexing.");m=m&&p.strides[w]===1;let $=!!(p.beginMask&1<<w&&p.endMask&1<<w);if(p.beginValid&&p.endValid){if(C){let te=p.begin[w]<0?I+p.begin[w]:p.begin[w];if(p.begin[w]=te,p.end[w]=p.begin[w]+1,te<0||te>=I)throw Error(`slice index ${p.begin[w]} of dimension ${w} out of bounds.`)}else p.begin[w]=M8(p.begin[w],0,p.strides[w],I,A,M),p.end[w]=M8(p.end[w],1,p.strides[w],I,A,M);let K=p.strides[w]===1&&p.begin[w]===0&&p.end[w]===I;f=f&&K,h=h&&(w===0&&p.strides[w]===1||K)}else f=f&&p.strides[w]===1&&$,h=h&&(w===0&&p.strides[w]===1||$);let V,W=!1;if(p.beginValid&&p.endValid?(V=p.end[w]-p.begin[w],W=!0):C?(V=1,W=!0):$&&I>=0&&(p.strides[w]<0?V=-I:V=I,W=!0),W){let K;V===0||V<0!=p.strides[w]<0?K=0:K=Math.trunc(V/p.strides[w])+(V%p.strides[w]!==0?1:0),g.push(K)}else g.push(-1)}for(let w=0;w<p.finalShapeGatherIndices.length;++w){let C=p.finalShapeGatherIndices[w];C>=0?y.push(g[C]):C===OF&&y.push(1)}return{finalShapeSparse:y.filter((w,C)=>p.finalShapeGatherIndices[C]!==OF),finalShape:y,isIdentity:f,sliceDim0:h,isSimpleSlice:m,begin:p.begin,end:p.end,strides:p.strides}}function LAe(n,t){t.beginMask=0,t.endMask=0,t.shrinkAxisMask=0;let e=0;t.beginValid=n.begin!=null,t.endValid=n.end!=null,t.begin=new Array(t.dims),t.end=new Array(t.dims),t.strides=new Array(t.dims),t.finalShapeGatherIndices=[],t.finalShapeGatherIndicesSparse=[],t.inputShapeGatherIndicesSparse=new Array(t.dims);for(let r=0;r<n.dims;r++)if(1<<r&n.ellipsisMask){let o=Math.min(t.dims-(n.dims-r)+1+n.numAddAxisAfterEllipsis,t.dims);for(;e<o;e++)t.begin[e]=0,t.end[e]=0,t.strides[e]=1,t.beginMask|=1<<e,t.endMask|=1<<e,t.finalShapeGatherIndices.push(e),t.finalShapeGatherIndicesSparse.push(-1),t.inputShapeGatherIndicesSparse[e]=r}else if(1<<r&n.newAxisMask)t.finalShapeGatherIndices.push(OF),t.finalShapeGatherIndicesSparse.push(-1);else{if(e===t.begin.length)throw Error(`Index out of range using input dim ${e}; input has only ${t.dims} dims, ${t.begin.length}.`);n.begin!=null&&(t.begin[e]=n.begin[r]),n.end!=null&&(t.end[e]=n.end[r]),t.strides[e]=n.strides[r],n.beginMask&1<<r&&(t.beginMask|=1<<e),n.endMask&1<<r&&(t.endMask|=1<<e),n.shrinkAxisMask&1<<r?(t.finalShapeGatherIndices.push(kAe),t.finalShapeGatherIndicesSparse.push(-1),t.shrinkAxisMask|=1<<e):(t.finalShapeGatherIndices.push(e),t.finalShapeGatherIndicesSparse.push(r)),t.inputShapeGatherIndicesSparse[e]=r,e++}}function M8(n,t,e,r,o,i){if(o[t])return e>0?i[t]:i[t+1&1];{let s=n<0?r+n:n;return s<i[0]?i[0]:s>i[1]?i[1]:s}}var Q1=class{static sgd(t){return new Gf(t)}static momentum(t,e,r=!1){return new Tx(t,e,r)}static rmsprop(t,e=.9,r=0,o=null,i=!1){return new Dx(t,e,r,o,i)}static adam(t=.001,e=.9,r=.999,o=null){return new Ix(t,e,r,o)}static adadelta(t=.001,e=.95,r=null){return new _x(t,e,r)}static adamax(t=.002,e=.9,r=.999,o=null,i=0){return new Ex(t,e,r,o,i)}static adagrad(t,e=.1){return new Sx(t,e)}};var Em=Q1;var $Ae=typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:n=>n();function Lb(){return new Promise(n=>$Ae(()=>n()))}var T={};bn(T,{ERF_A1:()=>JAe,ERF_A2:()=>e2e,ERF_A3:()=>t2e,ERF_A4:()=>n2e,ERF_A5:()=>r2e,ERF_P:()=>QAe,PARALLELIZE_THRESHOLD:()=>J1,RowPartitionType:()=>$d,SELU_SCALE:()=>FF,SELU_SCALEALPHA:()=>PF,applyActivation:()=>_m,assertAndGetBroadcastShape:()=>yt,assertAxesAreInnerMostDims:()=>kTe,assertParamsConsistent:()=>VAe,assignToTypedArray:()=>c2e,axesAreInnerMostDims:()=>cF,calculateShapes:()=>Pke,checkEinsumDimSizes:()=>m2e,checkPadOnDimRoundingMode:()=>An,combineLocations:()=>$5,combineRaggedTensorToTensorShapes:()=>zAe,complexWithEvenIndex:()=>s2e,complexWithOddIndex:()=>a2e,computeConv2DInfo:()=>pm,computeConv3DInfo:()=>k5,computeDefaultPad:()=>lF,computeDilation2DInfo:()=>DEe,computeOptimalWindowSize:()=>jAe,computeOutAndReduceShapes:()=>uF,computeOutShape:()=>BAe,computePool2DInfo:()=>aF,computePool3DInfo:()=>kEe,convertConv2DDataFormat:()=>N5,decodeEinsumEquation:()=>f2e,eitherStridesOrDilationsAreOne:()=>po,expandShapeToKeepDim:()=>qs,exponent:()=>d2e,exponents:()=>u2e,fromStringArrayToUint8:()=>F2e,fromUint8ToStringArray:()=>P2e,getAxesPermutation:()=>dF,getBroadcastDims:()=>F5,getComplexWithIndex:()=>l2e,getEinsumComputePath:()=>g2e,getEinsumPermutation:()=>h2e,getFusedBiasGradient:()=>Cm,getFusedDyActivation:()=>wm,getImageCenter:()=>HAe,getInnerMostAxes:()=>NTe,getPermuted:()=>KAe,getRaggedRank:()=>WAe,getReductionAxes:()=>Tn,getReshaped:()=>qAe,getReshapedPermuted:()=>XAe,getRowPartitionTypesHelper:()=>UAe,getSliceBeginCoords:()=>YAe,getSliceSize:()=>ZAe,getSparseFillEmptyRowsIndicesDenseShapeMismatch:()=>b2e,getSparseFillEmptyRowsNegativeIndexErrorMessage:()=>w2e,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:()=>C2e,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:()=>I2e,getSparseReshapeInputOutputMismatchErrorMessage:()=>T2e,getSparseReshapeInputOutputMultipleErrorMessage:()=>E2e,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:()=>_2e,getSparseReshapeNegativeOutputDimErrorMessage:()=>S2e,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:()=>A2e,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:()=>D2e,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:()=>k2e,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:()=>N2e,getUndoAxesPermutation:()=>kb,isIdentityPermutation:()=>y2e,log:()=>v1e,mergeRealAndImagArrays:()=>o2e,prepareAndValidate:()=>DAe,prepareSplitSize:()=>v2e,segment_util:()=>$F,shouldFuse:()=>Sm,slice_util:()=>yr,splitRealAndImagArrays:()=>i2e,stridesOrDilationsArePositive:()=>yu,tupleValuesAreOne:()=>ms,upcastType:()=>En,validateDefaultValueShape:()=>GAe,validateInput:()=>Ob,validateUpdateShape:()=>Dq,warn:()=>hu});function VAe(n,t){let e=n[0].length;n.forEach((o,i)=>{L(o.length===e,()=>`Error in concat${e}D: rank of tensors[${i}] must be the same as the rank of the rest (${e})`)}),L(t>=0&&t<e,()=>`Error in concat${e}D: axis must be between 0 and ${e-1}.`);let r=n[0];n.forEach((o,i)=>{for(let s=0;s<e;s++)L(s===t||o[s]===r[s],()=>`Error in concat${e}D: Shape of tensors[${i}] (${o}) does not match the shape of the rest (${r}) along the non-concatenated axis ${i}.`)})}function BAe(n,t){let e=n[0].slice();for(let r=1;r<n.length;r++)e[t]+=n[r][t];return e}var $d=function(n){return n[n.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",n[n.VALUE_ROWIDS=1]="VALUE_ROWIDS",n[n.ROW_LENGTHS=2]="ROW_LENGTHS",n[n.ROW_SPLITS=3]="ROW_SPLITS",n[n.ROW_LIMITS=4]="ROW_LIMITS",n[n.ROW_STARTS=5]="ROW_STARTS",n}($d||{});function zAe(n,t,e){let r=new Array;if(e==null&&t==null)return r;if(t==null)for(;r.length<n+e.length;)r.push(-1);else r=t.slice();if(e==null)return r;if(n+e.length!==r.length)throw new Error(`rt input.shape and shape=${t} are incompatible: rt input.rank = ${n+e.length}, but shape.rank = ${r.length}`);for(let o=1;o<e.length;++o){let i=e[o],s=r[r.length-e.length+o],a=r[s];if(i>=0)if(a>=0){if(a!==i)throw new Error(`rt input.shape and shape=${t} are incompatible: rt input.shape[${o+n}] = ${i} but shape[${o+n}] = ${a}`)}else r[s]=i}return r}function UAe(n){let t={FIRST_DIM_SIZE:$d.FIRST_DIM_SIZE,VALUE_ROWIDS:$d.VALUE_ROWIDS,ROW_LENGTHS:$d.ROW_LENGTHS,ROW_SPLITS:$d.ROW_SPLITS,ROW_LIMITS:$d.ROW_LIMITS,ROW_STARTS:$d.ROW_STARTS},e=[];for(let r of n)if(r in t)e.push(t[r]);else break;return e}function WAe(n){return n.length===0?0:n[0]===$d.FIRST_DIM_SIZE?n.length-1:n.length}function GAe(n,t){if(n==null||t==null)return;let e=n.length,r=t.length;if(e>=r)throw new Error(`defaultValue.shape=${n} and ragged tensor flatValues.shape=${t}, are incompatible: defaultValue.rank = ${e} must be less than ragged tensor input flatValues.rank = ${r})`);for(let o=0;o<Math.min(e,r-1);++o){let i=n[o],s=t[o+1];if(i>=0&&s>=0&&i!==1&&i!==s)throw new Error(`defaultValue.shape=${n}, and ragged tensor input flatValues.shape=${t} are incompatible: defaultValue.shape[${o-n.length}] = ${i} but ragged tensor input.flatValues.shape[${o-n.length}] = ${s}`)}}var J1=30;function jAe(n){return n<=J1?n:Ty(n,Math.floor(Math.sqrt(n)))}function HAe(n,t,e){let r=e*(typeof n=="number"?n:n[0]),o=t*(typeof n=="number"?n:n[1]);return[r,o]}function qAe(n,t,e,r=!0){let o=[];if(r)o=o.concat(t.slice(0)),o.push(n[0]/e),o=o.concat(n.slice(1));else{o=o.concat(n[0]);let i=t.length;for(let s=0;s<i;++s)o=o.concat([n[s+1]/t[s],t[s]]);o=o.concat(n.slice(i+1))}return o}function KAe(n,t,e=!0){let r=[];if(e){r.push(t);for(let o=t+1;o<n;++o)o<=2*t?(r.push(o),r.push(o-(t+1))):r.push(o)}else{let o=[],i=[];for(let s=1;s<n;++s)s>=t*2+1||s%2===1?i.push(s):o.push(s);r.push(...o),r.push(0),r.push(...i)}return r}function XAe(n,t,e,r=!0){let o=[];r?o.push(n[0]/e):o.push(n[0]*e);for(let i=1;i<n.length;++i)i<=t.length?r?o.push(t[i-1]*n[i]):o.push(n[i]/t[i-1]):o.push(n[i]);return o}function YAe(n,t){let e=[0];for(let r=0;r<t;++r)e.push(n[r][0]);return e}function ZAe(n,t,e){let r=n.slice(0,1);for(let o=0;o<e;++o)r.push(n[o+1]-t[o][0]-t[o][1]);return r}var PF=1.7580993408473768,FF=1.0507009873554805;var QAe=.3275911,JAe=.254829592,e2e=-.284496736,t2e=1.421413741,n2e=-1.453152027,r2e=1.061405429;function o2e(n,t){if(n.length!==t.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${n.length}, imag: ${t.length}.`);let e=new Float32Array(n.length*2);for(let r=0;r<e.length;r+=2)e[r]=n[r/2],e[r+1]=t[r/2];return e}function i2e(n){let t=new Float32Array(n.length/2),e=new Float32Array(n.length/2);for(let r=0;r<n.length;r+=2)t[r/2]=n[r],e[r/2]=n[r+1];return{real:t,imag:e}}function s2e(n){let t=Math.ceil(n.length/4),e=new Float32Array(t),r=new Float32Array(t);for(let o=0;o<n.length;o+=4)e[Math.floor(o/4)]=n[o],r[Math.floor(o/4)]=n[o+1];return{real:e,imag:r}}function a2e(n){let t=Math.floor(n.length/4),e=new Float32Array(t),r=new Float32Array(t);for(let o=2;o<n.length;o+=4)e[Math.floor(o/4)]=n[o],r[Math.floor(o/4)]=n[o+1];return{real:e,imag:r}}function l2e(n,t){let e=n[t*2],r=n[t*2+1];return{real:e,imag:r}}function c2e(n,t,e,r){n[r*2]=t,n[r*2+1]=e}function u2e(n,t){let e=new Float32Array(n/2),r=new Float32Array(n/2);for(let o=0;o<Math.ceil(n/2);o++){let i=(t?2:-2)*Math.PI*(o/n);e[o]=Math.cos(i),r[o]=Math.sin(i)}return{real:e,imag:r}}function d2e(n,t,e){let r=(e?2:-2)*Math.PI*(n/t),o=Math.cos(r),i=Math.sin(r);return{real:o,imag:i}}var LF="->",p2e=/->/g,W8=",",G8="...";function f2e(n,t){n=n.replace(/\s/g,"");let e=(n.length-n.replace(p2e,"").length)/LF.length;if(e<1)throw new Error("Equations without an arrow are not supported.");if(e>1)throw new Error(`Equation must contain exactly one arrow ("${LF}").`);let[r,o]=n.split(LF);L(r.indexOf(G8)===-1,()=>`The ellipsis notation ("${G8}") is not supported yet.`);let i=r.split(W8),s=i.length;if(t!==s)throw new Error(`Expected ${s} input tensors, received ${t}`);if(s>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");let a=[];for(let p=0;p<o.length;++p){let f=o[p];if(!i.some(h=>h.indexOf(f)!==-1))throw new Error(`Output subscripts contain the label ${f} not present in the input subscripts.`);a.indexOf(f)===-1&&a.push(f)}for(let p=0;p<r.length;++p){let f=r[p];a.indexOf(f)===-1&&f!==W8&&a.push(f)}let l=new Array(i.length);for(let p=0;p<s;++p){if(new Set(i[p].split("")).size!==i[p].length)throw new Error(`Found duplicate axes in input component ${i[p]}. Support for duplicate axes in input is not implemented yet.`);l[p]=[];for(let f=0;f<i[p].length;++f)l[p].push(a.indexOf(i[p][f]))}let c=a.length,u=o.length,d=[];for(let p=u;p<c;++p)d.push(p);return{allDims:a,summedDims:d,idDims:l}}function h2e(n,t){let e=new Array(n);e.fill(-1);for(let o=0;o<t.length;++o)e[t[o]]=o;let r=[];for(let o=0;o<n;++o)e[o]===-1&&r.push(o);return e=e.filter(o=>o!==-1),{permutationIndices:e,expandDims:r}}function m2e(n,t,e){let r=new Array(n);for(let o=0;o<e.length;++o){let i=e[o].shape;for(let s=0;s<t[o].length;++s)r[t[o][s]]===void 0?r[t[o][s]]=i[s]:L(r[t[o][s]]===i[s],()=>`Expected dimension ${r[t[o][s]]} at axis ${s} of input shaped ${JSON.stringify(i)}, but got dimension ${i[s]}`)}}function g2e(n,t){let e=n,r=[],o=0;n.length===0&&e.push(-1),o=n.length+1;for(let s=0;s<o;++s)r.push([]);let i=[];for(let s=0;s<e.length;++s){let a=e[s],l=x2e(t,a);for(let c of l)i.indexOf(c)===-1&&(r[s].push(c),i.push(c))}return{path:e,steps:r}}function y2e(n){return n.every((t,e)=>t===e)}function x2e(n,t){let e=[];for(let r=0;r<n.length;++r)(n[r].length===0||n[r].indexOf(t)!==-1||t===-1)&&e.push(r);return e}function v2e(n,t,e=0){let r=[];if(typeof t=="number")L(n.shape[e]%t===0,()=>"Number of splits must evenly divide the axis."),r=new Array(t).fill(n.shape[e]/t);else{let o=t.reduce((s,a)=>(a===-1&&(s+=1),s),0);L(o<=1,()=>"There should be only one negative value in split array.");let i=t.indexOf(-1);if(i!==-1){let s=t.reduce((a,l)=>l>0?a+l:a);t[i]=n.shape[e]-s}L(n.shape[e]===t.reduce((s,a)=>s+a),()=>"The sum of sizes must match the size of the axis dimension."),r=t}return r}function b2e(n){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${n}`}function w2e(n,t){return`indices(${n}, 0) is invalid: ${t} < 0`}function C2e(n,t,e){return`indices(${n}, 0) is invalid: ${t} >= ${e}`}function _2e(n,t){return`only one output dimension may be -1, not both ${n} and ${t}`}function S2e(n,t){return`size ${n} must be non-negative, not ${t}`}function I2e(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function E2e(n,t){let e=Mt(n),r=Mt(t);return`Input to reshape is a SparseTensor with ${e}
  dense values, but the requested shape requires a multiple of ${r}. inputShape=${n} outputShape= ${t}`}function T2e(n,t){let e=Mt(n),r=Mt(t);return`Input to reshape is a tensor with ${e} dense values, but the requested shape has ${r}. inputShape=${n} outputShape=${t}`}function D2e(){return"segment ids must be >= 0"}function k2e(){return"segment ids are not increasing"}function N2e(n,t){return`Segment id ${n} out of range [0, ${t}), possibly because segmentIds input is not sorted.`}function A2e(n,t,e){return`Bad: indices[${n}] == ${t} out of range [0, ${e})`}var $F={};bn($F,{collectGatherOpShapeInfo:()=>M2e,computeOutShape:()=>O2e,segOpComputeOptimalWindowSize:()=>R2e});function R2e(n,t){let e=!1,r;for(n<=J1?(r=n,e=!0):r=Ty(n,Math.floor(Math.sqrt(n)));!e;)r>t||r===n?e=!0:r=Ty(n,r+1);return r}function O2e(n,t,e){let r=[],o=n.length;for(let i=0;i<o;i++)i!==t?r.push(n[i]):r.push(e);return r}function M2e(n,t,e,r){let o=t.shape.length,i=n.shape.length;if(r!==0&&(r<-o||r>o))throw new Error(`Expect batchDims in the range of [-${o}, ${o}], but got ${r}`);if(r<0&&(r+=o),r>i)throw new Error(`batchDims (${r}) must be less than rank(x) (
    ${i}).`);if(e<r)throw new Error(`batchDims (${r}) must be less than or equal to axis (${e}).`);for(let d=0;d<r;++d)if(n.shape[d]!==t.shape[d])throw new Error(`x.shape[${d}]: ${n.shape[d]} should be equal to indices.shape[${d}]: ${t.shape[d]}.`);let s=n.shape[e],a=[],l=1,c=1,u=1;for(let d=0;d<r;++d)a.push(n.shape[d]),l*=n.shape[d];for(let d=r;d<e;d++)a.push(n.shape[d]),c*=n.shape[d];for(let d=r;d<o;d++)a.push(t.shape[d]);for(let d=e+1;d<i;d++)a.push(n.shape[d]),u*=n.shape[d];return{batchSize:l,sliceSize:u,outerSize:c,dimSize:s,outputShape:a}}function P2e(n){try{return n.map(t=>Gy(t))}catch(t){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${t}`)}}function F2e(n){return n.map(t=>Wy(t))}var Vr={};bn(Vr,{nonMaxSuppressionV3Impl:()=>W1,nonMaxSuppressionV4Impl:()=>G1,nonMaxSuppressionV5Impl:()=>j1,whereImpl:()=>L1});b8();var eE={kernelName:wc,inputsToSave:["x"],gradFunc:(n,t)=>{let[e]=t;return{x:()=>U(n,Ks(me(e,"float32"),-1))}}};var j8={kernelName:Oa,inputsToSave:["x"],gradFunc:(n,t)=>{let[e]=t;return{x:()=>{let r=xt(me(e,"float32")),o=wn(Ie(Ae(1),r));return Dt(Se(n,o))}}}};var H8={kernelName:Ma,inputsToSave:["x"],gradFunc:(n,t)=>{let[e]=t;return{x:()=>{let r=wn(Ie(xt(me(e,"float32")),1));return Se(n,r)}}}};var q8={kernelName:hs,inputsToSave:["a","b"],gradFunc:(n,t)=>{let[e,r]=t,o=yt(e.shape,r.shape);return{a:()=>{let a=n,l=Tn(e.shape,o);return l.length>0&&(a=Pe(a,l)),G(a,e.shape)},b:()=>{let a=n,l=Tn(r.shape,o);return l.length>0&&(a=Pe(a,l)),G(a,r.shape)}}}};var K8={kernelName:Cc,saveAllInputs:!0,gradFunc:(n,t)=>{let e={};return t.forEach((r,o)=>{e[o]=()=>n.clone()}),e}};var X8={kernelName:_c,inputsToSave:["x"],gradFunc:(n,t)=>{let[e]=t;return{x:()=>tt(e)}}};var Y8={kernelName:Sc,inputsToSave:["x"],gradFunc:(n,t)=>{let[e]=t;return{x:()=>tt(e)}}};var Z8={kernelName:Pa,inputsToSave:["x"],gradFunc:(n,t)=>{let[e]=t;return{x:()=>Se(n,wn(Ie(Ae(1),xt(me(e,"float32")))))}}};var Q8={kernelName:Fa,inputsToSave:["x"],gradFunc:(n,t)=>{let[e]=t;return{x:()=>{let r=wn(ae(Ae(1),xt(me(e,"float32"))));return Se(n,r)}}}};var J8={kernelName:Va,inputsToSave:["a","b"],gradFunc:(n,t)=>{let[e,r]=t,o=yt(e.shape,r.shape);return{a:()=>{let a=ae(xt(e),xt(r)),l=U(n,Se(r,a)),c=Tn(e.shape,o);return c.length>0&&(l=Pe(l,c)),G(l,e.shape)},b:()=>{let a=ae(xt(e),xt(r)),l=Dt(U(n,Se(e,a))),c=Tn(r.shape,o);return c.length>0&&(l=Pe(l,c)),G(l,r.shape)}}}};var eK={kernelName:La,inputsToSave:["x"],gradFunc:(n,t)=>{let[e]=t;return{x:()=>Se(n,ae(xt(me(e,"float32")),1))}}};var tK={kernelName:$a,inputsToSave:["x"],gradFunc:(n,t)=>{let[e]=t;return{x:()=>Se(n,Ie(Ae(1),xt(me(e,"float32"))))}}};function L2e(n,t,e,r,o,i){let s=k(n,"dy","avgPool3dGrad"),a=k(t,"input","avgPool3dGrad"),l=s,c=a,u=!1;a.rank===4&&(u=!0,l=G(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]]),c=G(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),L(l.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${l.rank}.`),L(c.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${c.rank}.`),An("avgPool3dGrad",o,i);let d={dy:l,input:c},p={filterSize:e,strides:r,pad:o,dimRoundingMode:i},f=P.runKernel(Np,d,p);return u?G(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}var nK=R({avgPool3dGrad_:L2e});var rK={kernelName:Ec,inputsToSave:["x"],gradFunc:(n,t,e)=>{let[r]=t,{filterSize:o,strides:i,pad:s,dimRoundingMode:a}=e;return{x:()=>nK(n,r,o,i,s,a)}}};function $2e(n,t,e,r,o){let i=k(n,"dy","avgPoolGrad"),s=k(t,"input","avgPoolGrad");L(s.rank===i.rank,()=>`Rank of input (${s.rank}) does not match rank of dy (${i.rank})`);let a=s,l=i,c=!1;s.rank===3&&(c=!0,a=G(s,[1,s.shape[0],s.shape[1],s.shape[2]]),l=G(i,[1,i.shape[0],i.shape[1],i.shape[2]])),L(l.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${l.rank}.`),L(a.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${a.rank}.`);let u={dy:l,input:a},d={filterSize:e,strides:r,pad:o},p=P.runKernel(kp,u,d);return c?G(p,[p.shape[1],p.shape[2],p.shape[3]]):p}var oK=R({avgPoolGrad_:$2e});var iK={kernelName:Ic,inputsToSave:["x"],gradFunc:(n,t,e)=>{let[r]=t,{filterSize:o,strides:i,pad:s}=e;return{x:()=>oK(n,r,o,i,s)}}};var sK={kernelName:Tc,inputsToSave:["a","b"],gradFunc:(n,t,e)=>{let[r,o]=t,{transposeA:i,transposeB:s}=e;return!i&&!s?{a:()=>_t(n,o,!1,!0),b:()=>_t(r,n,!0,!1)}:!i&&s?{a:()=>_t(n,o,!1,!1),b:()=>_t(n,r,!0,!1)}:i&&!s?{a:()=>_t(o,n,!1,!0),b:()=>_t(r,n,!1,!1)}:{a:()=>_t(o,n,!0,!0),b:()=>_t(n,r,!0,!0)}}};var aK={kernelName:Dc,gradFunc:(n,t,e)=>{let{blockShape:r,crops:o}=e;return{x:()=>$f(n,r,o)}}};var lK={kernelName:w6,gradFunc:(n,t,e)=>{let r=e,o=r.inputShape,i=r.shape,s=Array.from(i);for(let l=o.length-1;l>=0;l--)if(o[l]===i[l])s[l]=1;else if(o[l]!==1)throw new Error(`broadcastTo(): [${o}] cannot be broadcast to [${i}].`);let a=[];for(let l=0;l<s.length;l++)s[l]>1&&a.push(l);return{x:()=>Pe(n,a,!0)}}};var cK={kernelName:$s,gradFunc:n=>({x:()=>n.clone()})};var uK={kernelName:Ba,gradFunc:n=>({x:()=>tt(n)})};var dK={kernelName:za,inputsToSave:["x"],gradFunc:(n,t,e)=>{let[r]=t,{clipValueMin:o,clipValueMax:i}=e;return{x:()=>Rn(Co(Qo(r,o),Gi(r,i)),n,tt(n))}}};var pK={kernelName:kc,inputsToSave:["x"],gradFunc:eE.gradFunc};var fK={kernelName:Nc,saveAllInputs:!0,gradFunc:(n,t,e)=>{let r=t.map(l=>l.shape),{axis:o}=e,i=Mr(o,t[0].shape)[0],s=r.map(l=>l[i]);return Lr(n,s,i).map(l=>()=>l)}};var hK={kernelName:Ac,inputsToSave:["x","filter"],gradFunc:(n,t,e)=>{let[r,o]=t,{dilations:i,strides:s,pad:a,dataFormat:l}=e;return L(ms(i),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`),{x:()=>tx(r.shape,n,o,s,a,l),filter:()=>Cx(r,n,o.shape,s,a,l)}}};var mK={kernelName:Rc,inputsToSave:["dy","filter"],gradFunc:(n,t,e)=>{let[r,o]=t,{strides:i,pad:s,dataFormat:a,dimRoundingMode:l}=e;return{dy:()=>mi(n,o,i,s,a,1,l),filter:()=>Cx(n,r,o.shape,i,s,a,l)}}};function V2e(n,t,e,r,o){let i=n;n.rank===4&&(i=G(n,[1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]]));let s=t;s.rank===4&&(s=G(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]])),L(i.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${i.shape}.`),L(s.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${s.shape}.`),L(e.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${e}.`),L(i.shape[4]===e[3],()=>`Error in conv3dDerFilter: depth of input ${i.shape[4]}) must match input depth in filter (${e[3]}.`),L(s.shape[4]===e[4],()=>`Error in conv3dDerFilter: depth of dy (${s.shape[4]}) must match output depth for filter (${e[4]}).`);let a={x:i,dy:s},l={strides:r,pad:o,filterShape:e};return P.runKernel(Pp,a,l)}var gK=R({conv3DBackpropFilter_:V2e});var yK={kernelName:Oc,inputsToSave:["x","filter"],gradFunc:(n,t,e)=>{let{dilations:r,strides:o,pad:i}=e;L(ms(r),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${r}'`);let[s,a]=t;return{x:()=>s1(s.shape,n,a,o,i),filter:()=>gK(s,n,a.shape,o,i)}}};var xK={kernelName:Ua,inputsToSave:["x"],gradFunc:(n,t)=>{let[e]=t;return{x:()=>U(Dt(hx(me(e,"float32"))),n)}}};var vK={kernelName:Wa,inputsToSave:["x"],gradFunc:(n,t)=>{let[e]=t;return{x:()=>U(mx(me(e,"float32")),n)}}};var bK={kernelName:Mc,inputsToSave:["x"],gradFunc:(n,t,e)=>{let[r]=t,{axis:o,exclusive:i,reverse:s}=e;return{x:()=>{let a=dF([o],r.rank),l=ox(n,o,i,!s);return a!=null&&(l=St(l,a)),l}}}};var wK={kernelName:Pc,inputsToSave:["x","filter"],gradFunc:(n,t,e)=>{let{dilations:r,strides:o,pad:i,dimRoundingMode:s}=e,a=r??[1,1];L(ms(a),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${a}'`);let[l,c]=t;return L(l.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${l.rank}.`),L(c.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${c.rank}.`),L(l.shape[3]===c.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${l.shape[3]}) must match the inChannels dimension in filter ${c.shape[2]}.`),L(po(o,a),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${o} and dilations '${a}'.`),An("depthwiseConv2d",i,s),{x:()=>B1(l.shape,n,c,o,i,a,s),filter:()=>V1(l,n,c.shape,o,i,a,s)}}};var CK={kernelName:Fc,inputsToSave:["x","filter"],gradFunc:(n,t,e)=>{let[r,o]=t,i={x:r,filter:o,dy:n},s={x:r,filter:o,dy:n};return{x:()=>P.runKernel(Xh,i,e),filter:()=>P.runKernel(Yh,s,e)}}};var _K={kernelName:ja,outputsToSave:[!0],gradFunc:(n,t)=>{let[e]=t,r={dy:n,y:e};return{x:()=>P.runKernel(jp,r)}}};var SK={kernelName:Ha,inputsToSave:["x"],gradFunc:(n,t)=>{let[e]=t,r=U(Gn(Dt(xt(e))),2/Math.sqrt(Math.PI));return{x:()=>U(n,r)}}};var IK={kernelName:qa,outputsToSave:[!0],gradFunc:(n,t)=>{let[e]=t;return{x:()=>U(n,e)}}};var EK={kernelName:Lc,inputsToSave:["input"],gradFunc:(n,t)=>{let[e]=t;return{input:()=>G(n,e.shape)}}};var TK={kernelName:Ka,inputsToSave:["x"],gradFunc:(n,t)=>{let[e]=t;return{x:()=>U(n,Gn(e))}}};var DK={kernelName:Xa,gradFunc:n=>({x:()=>tt(n)})};var kK={kernelName:Ya,inputsToSave:["a","b"],gradFunc:(n,t)=>{let[e,r]=t,o=yt(e.shape,r.shape);return{a:()=>{let a=Se(n,me(r,"float32")),l=Tn(e.shape,o);return l.length>0?G(Pe(a,l),e.shape):a},b:()=>{let a=U(n,me(e,"float32")),l=Tn(r.shape,o);l.length>0&&(a=G(Pe(a,l),r.shape));let c=xt(r);return Dt(Se(a,me(c,"float32")))}}}};var NK={kernelName:$c,inputsToSave:["x","mean","variance","scale"],gradFunc:(n,t,e)=>{let{varianceEpsilon:r}=e,[o,i,s,a]=t,l=a??Ae(1),c=Tn(i.shape,o.shape),u=[];if(i.rank===1){for(let C=0;C<o.shape.length-1;++C)u.push(o.shape[C]);u.push(1)}let d=Ie(o,i),p=U(n,l),f=dx(ae(s,Ae(r))),h=U(U(U(f,f),f),Ae(-.5));return{x:()=>i.rank===1?G(U(U(n,fo(G(f,[1,1,1,i.shape[0]]),u)),l),o.shape):G(U(U(n,f),l),o.shape),mean:()=>{let C=U(U(f,Ae(-1)),p);return i.rank===1&&(C=Pe(C,c)),G(C,i.shape)},variance:()=>{let C=U(U(h,d),p);return i.rank===1&&(C=Pe(C,c)),G(C,i.shape)},scale:()=>{let C=U(d,f),I=U(n,C);return i.rank===1&&(I=Pe(I,c)),G(I,i.shape)},offset:()=>{let C=n;return i.rank===1&&(C=Pe(C,c)),G(C,i.shape)}}}};var OK={kernelName:Vc,inputsToSave:["x","indices"],gradFunc:(n,t,e)=>{let[r,o]=t,{axis:i,batchDims:s}=e,a=Mr(i,r.shape)[0],l=(c,u,d)=>()=>{let p=c.shape,f=u.size,h=p.slice(0,a),m=h.length,g=p.slice(i,p.length).slice(1),y=g.length,v=AK(0,m),w=AK(m+1,m+1+y),C=RK([h,[f],g]),I=G(d,C),A=G(u,[f]),M=RK([[m],v,w]),$=St(I,M),V=wx($,A,c.shape[a]),W=kb(M);return V=St(V,W),V};if(s===1){let c=r.shape[0],u=r.split(c,0);return{x:()=>sr(u.map((f,h)=>l(f,o.slice(h,1),n.slice(h,1))())).reshape(r.shape),indices:()=>o}}else return{x:l(r,o,n),indices:()=>o}}};function AK(n,t){let e=[];for(let r=n;r<t;++r)e.push(r);return e}function RK(n){let t=[];for(let e=0;e<n.length;++e)for(let r=0;r<n[e].length;++r)t.push(n[e][r]);return t}var MK={kernelName:Za,inputsToSave:["a","b"],gradFunc:(n,t)=>{let[e,r]=t;return{a:()=>tt(e),b:()=>tt(r)}}};var PK={kernelName:Vs,gradFunc:n=>({x:()=>me(n,"float32")})};var FK={kernelName:Qa,gradFunc:n=>({x:()=>tt(n)})};var LK={kernelName:Ja,gradFunc:n=>({x:()=>tt(n)})};var $K={kernelName:el,gradFunc:n=>({x:()=>tt(n)})};var VK={kernelName:Bc,inputsToSave:["x"],gradFunc:(n,t,e)=>{let[r]=t,{alpha:o}=e,i=ir(r,0);return{x:()=>Rn(i,n,U(n,o))}}};var BK={kernelName:nl,inputsToSave:["x"],gradFunc:(n,t)=>{let[e]=t;return{x:()=>Se(n,ae(e,1))}}};var zK={kernelName:tl,inputsToSave:["x"],gradFunc:(n,t)=>{let[e]=t;return{x:()=>Se(n,me(e,"float32"))}}};var UK={kernelName:C6,inputsToSave:[],outputsToSave:[!0],gradFunc:(n,t,e)=>{let[r]=t,{axis:o}=e;return{logits:()=>{let s=Gn(r);return Ie(n,U(Pe(n,o,!0),s))}}}};function B2e(n,t,e,r=5,o=1,i=1,s=.5){let a={x:n,y:t,dy:e},l={depthRadius:r,bias:o,alpha:i,beta:s};return P.runKernel(Jp,a,l)}var WK=R({localResponseNormalizationBackprop_:B2e});var GK={kernelName:zc,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,t,e)=>{let[r,o]=t,{depthRadius:i,bias:s,alpha:a,beta:l}=e;return{x:()=>WK(r,o,n,i,s,a,l)}}};function tE(n,t,e,r){return t.rank<e.rank&&(t=G(t,qs(t.shape,r))),n.rank<e.rank&&(n=G(n,qs(n.shape,r))),{x:()=>U(n,me(Po(e,t),n.dtype))}}var VF={kernelName:Uc,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,t,e)=>{let r=e,{reductionIndices:o}=r,i=t[0],s=t[1],a=Mr(o,i.shape),l=tE(n,s,i,a);return{x:()=>l.x()}}};var jK={kernelName:rl,inputsToSave:["a","b"],gradFunc:(n,t)=>{let[e,r]=t;return{a:()=>U(n,me(Qo(e,r),"float32")),b:()=>U(n,me(Md(e,r),"float32"))}}};function z2e(n,t,e,r,o,i,s){let a=k(n,"dy","maxPool3dGrad"),l=k(t,"input","maxPool3dGrad"),c=k(e,"output","maxPool3dGrad"),u=a,d=l,p=c,f=!1;l.rank===4&&(f=!0,u=G(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]),d=G(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),p=G(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]])),L(u.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${u.rank}.`),L(d.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${d.rank}.`),L(p.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${p.rank}.`),An("maxPool3dGrad",i,s);let h={dy:u,input:d,output:p},m={filterSize:r,strides:o,pad:i,dimRoundingMode:s},g=P.runKernel(tf,h,m);return f?G(g,[g.shape[1],g.shape[2],g.shape[3],g.shape[4]]):g}var HK=R({maxPool3dGrad_:z2e});var qK={kernelName:Gc,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,t,e)=>{let[r,o]=t,{filterSize:i,strides:s,pad:a,dimRoundingMode:l}=e;return{x:()=>HK(n,r,o,i,s,a,l)}}};function U2e(n,t,e,r,o,i,s){let a=k(n,"dy","maxPoolGrad"),l=k(t,"input","maxPoolGrad"),c=k(e,"output","maxPoolGrad");L(l.rank===a.rank,()=>`Rank of input (${l.rank}) does not match rank of dy (${a.rank})`),L(a.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${a.rank}.`),L(l.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${l.rank}.`),An("maxPoolGrad",i,s);let u={dy:a,input:l,output:c},d={filterSize:r,strides:o,pad:i,dimRoundingMode:s};return P.runKernel(ef,u,d)}var KK=R({maxPoolGrad_:U2e});var XK={kernelName:Wc,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,t,e)=>{let[r,o]=t,{filterSize:i,strides:s,pad:a}=e;return{x:()=>KK(n,r,o,i,s,a)}}};var YK={kernelName:jc,inputsToSave:["x"],gradFunc:(n,t,e)=>{let[r]=t,{axis:o}=e,i=Mr(o,r.shape),a=uF(r.shape,i)[1],l=Mt(a);return{x:()=>{let u=r.shape.slice();i.forEach(f=>{u[f]=1});let d=G(n,u);return Se(U(d,Tr(r.shape,"float32")),l)}}}};var ZK={kernelName:Hc,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,t,e)=>{let r=e,{axis:o}=r,[i,s]=t,a=Mr(o,i.shape),l=tE(n,s,i,a);return{x:()=>l.x()}}};var QK={kernelName:ol,inputsToSave:["a","b"],gradFunc:(n,t)=>{let[e,r]=t;return{a:()=>U(n,me(Gi(e,r),"float32")),b:()=>U(n,me(ir(e,r),"float32"))}}};var JK={kernelName:qc,inputsToSave:["x"],gradFunc:(n,t,e)=>{let r=t[0],{paddings:o}=e,i=o.map(s=>s[0]);return{x:()=>Je(n,i,r.shape)}}};var e7={kernelName:il,inputsToSave:["a","b"],gradFunc:(n,t)=>{let[e,r]=t,o=yt(e.shape,r.shape);return{a:()=>{let a=Tn(e.shape,o);return a.length>0?G(Pe(n,a),e.shape):n},b:()=>{let a=U(n,Dt(Cu(Se(e,r)))),l=Tn(r.shape,o);return l.length>0?G(Pe(a,l),r.shape):a}}}};var t7={kernelName:sl,inputsToSave:["a","b"],gradFunc:(n,t)=>{let[e,r]=t,o=yt(e.shape,r.shape);return{a:()=>{let a=U(n,me(r,"float32")),l=Tn(e.shape,o);return l.length>0?G(Pe(a,l),e.shape):a},b:()=>{let a=U(n,me(e,"float32")),l=Tn(r.shape,o);return l.length>0?G(Pe(a,l),r.shape):a}}}};var n7={kernelName:Kc,gradFunc:n=>({x:()=>Dt(n)})};var r7={kernelName:Yc,inputsToSave:["indices"],gradFunc:(n,t)=>{let e=t[0];return{indices:()=>hn(e.shape,"float32")}}};var o7={kernelName:Xc,gradFunc:n=>({x:()=>tt(n)})};var i7={kernelName:Zc,saveAllInputs:!0,gradFunc:(n,t,e)=>{let{axis:r}=e;return $r(n,r).map(i=>()=>i)}};var BF={kernelName:Qc,inputsToSave:["x"],gradFunc:(n,t,e)=>{let r=t[0],{paddings:o}=e,i=o.map(s=>s[0]);return{x:()=>Je(n,i,r.shape)}}};var s7={kernelName:al,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(n,t)=>{let[e,r,o]=t,i=e,s=r,a=yt(i.shape,s.shape);return{a:()=>{let u=me(s,"float32"),d=U(n,U(u,wo(i,Ie(u,Ae(1))))),p=Tn(i.shape,a);return p.length>0&&(d=Pe(d,p)),G(d,i.shape)},b:()=>{let u=ir(i,0),d=Rn(u,eo(i),tt(i)),p=U(n,U(o,d)),f=Tn(s.shape,a);return f.length>0&&(p=Pe(p,f)),G(p,s.shape)}}}};var a7={kernelName:Jc,inputsToSave:["x","alpha"],gradFunc:(n,t)=>{let[e,r]=t,o=ir(e,0);return{x:()=>Rn(o,n,U(n,r)),alpha:()=>{let i=Rn(o,tt(n),U(n,e)),s=Tn(r.shape,n.shape);return s.length>0&&(i=Pe(i,s)),G(i,r.shape)}}}};function W2e(n,t,e){let r=n.shape.slice();r[e]=1;let o=G(t,r),i=fm(n,e,!0,!1),s=fm(n,e,!0,!0),a=U(i,s);return U(o,a)}function G2e(n,t,e){let r=n.shape.length,o=r-e.length,i=T.getAxesPermutation(e,r),s=n;i!=null&&(s=St(n,i));let a=s.shape.slice(),c=a.splice(r-e.length,e.length).reduce((p,f)=>p*f,1);a.push(c);let u=s.reshape(a),d=W2e(u,t,o);if(d=d.reshape(s.shape),i!=null){let p=T.getUndoAxesPermutation(i);d=St(d,p)}return d}var l7={kernelName:eu,inputsToSave:["x"],gradFunc:(n,t,e)=>{let[r]=t,{axis:o}=e,i=[];return o==null?i=r.shape.map((s,a)=>a):typeof o=="number"?i=[o]:i=o,{x:()=>G2e(r,n,i)}}};var c7={kernelName:Ga,inputsToSave:["a","b"],gradFunc:(n,t)=>{let[e,r]=t,o=yt(e.shape,r.shape);return{a:()=>{let a=Se(n,me(r,"float32")),l=Tn(e.shape,o);return l.length>0?G(Pe(a,l),e.shape):a},b:()=>{let a=U(n,me(e,"float32")),l=Tn(r.shape,o);l.length>0&&(a=G(Pe(a,l),r.shape));let c=xt(r);return Dt(Se(a,me(c,"float32")))}}}};var u7={kernelName:ll,inputsToSave:["x"],gradFunc:(n,t)=>{let[e]=t;return{x:()=>Se(n,Dt(xt(e)))}}};var d7={kernelName:ul,inputsToSave:["x"],gradFunc:(n,t)=>{let[e]=t,r=U(Gi(e,6),Ks(e));return{x:()=>U(n,me(r,"float32"))}}};var p7={kernelName:cl,inputsToSave:["x"],gradFunc:(n,t)=>{let[e]=t;return{x:()=>U(n,me(Ks(e),"float32"))}}};var f7={kernelName:tu,inputsToSave:["x"],gradFunc:(n,t)=>{let[e]=t;return{x:()=>G(n,e.shape)}}};var h7={kernelName:ru,inputsToSave:["images"],gradFunc:(n,t,e)=>{let[r]=t,o={dy:n,images:r};return{images:()=>P.runKernel(uf,o,e)}}};var m7={kernelName:nu,inputsToSave:["images"],gradFunc:(n,t,e)=>{let[r]=t,o={dy:n,images:r};return{images:()=>P.runKernel(cf,o,e)}}};var g7={kernelName:ou,gradFunc:(n,t,e)=>{let{dims:r}=e,o=Mr(r,n.shape);return{x:()=>Fr(n,o)}}};var y7={kernelName:dl,gradFunc:n=>({x:()=>tt(n)})};var x7={kernelName:pl,inputsToSave:["x"],gradFunc:(n,t)=>{let[e]=t;return{x:()=>Dt(Se(n,U(wo(e,1.5),2)))}}};var v7={kernelName:iu,inputsToSave:["condition"],gradFunc:(n,t)=>{let[e]=t;return{condition:()=>me(tt(e),"float32"),t:()=>U(n,me(e,n.dtype)),e:()=>U(n,me(Ff(e),n.dtype))}}};var b7={kernelName:fl,inputsToSave:["x"],gradFunc:(n,t)=>{let[e]=t;return{x:()=>{let r=ir(e,Ae(0)),o=Ae(PF),i=Ae(FF),s=U(n,i),a=U(U(n,o),Gn(me(e,"float32")));return Rn(r,s,a)}}}};var w7={kernelName:yl,outputsToSave:[!0],gradFunc:(n,t)=>{let[e]=t;return{x:()=>U(n,U(e,Ie(Ae(1),e)))}}};var C7={kernelName:gl,gradFunc:n=>({x:()=>tt(n)})};var _7={kernelName:hl,inputsToSave:["x"],gradFunc:(n,t)=>{let[e]=t;return{x:()=>U(Nf(me(e,"float32")),n)}}};var S7={kernelName:ml,inputsToSave:["x"],gradFunc:(n,t)=>{let[e]=t;return{x:()=>U(rx(me(e,"float32")),n)}}};var I7={kernelName:su,inputsToSave:["x"],gradFunc:(n,t,e)=>{let[r]=t,{begin:o,size:i}=e,s=r.shape,[a,l]=MF(r,o,i),c=[];for(let u=0;u<n.rank;u++)c.push([a[u],s[u]-a[u]-l[u]]);return{x:()=>to(n,c)}}};var E7={kernelName:uu,outputsToSave:[!0],gradFunc:(n,t,e)=>{let[r]=t,{dim:o}=e,i=!0,s=U(n,r);return{logits:()=>Ie(s,U(Pe(s,[o],i),r))}}};var T7={kernelName:xl,inputsToSave:["x"],gradFunc:(n,t)=>{let[e]=t;return{x:()=>U(n,jr(e))}}};var zF={kernelName:lu,gradFunc:(n,t,e)=>{let{blockShape:r,paddings:o}=e;return{x:()=>kf(n,r,o)}}};var UF={kernelName:cu,gradFunc:(n,t,e)=>{let{axis:r}=e;return{x:()=>Gt(n,r)}}};var D7={kernelName:vl,inputsToSave:["x"],gradFunc:(n,t)=>{let[e]=t;return{x:()=>Se(n,U(wn(me(e,"float32")),2))}}};var k7={kernelName:yf,inputsToSave:["x"],gradFunc:(n,t)=>{let[e]=t;return{x:()=>U(n,U(me(e,"float32"),2))}}};var N7={kernelName:bl,inputsToSave:["a","b"],gradFunc:(n,t)=>{let[e,r]=t,o=Ae(2);return{a:()=>U(n,U(o,Ie(e,r))),b:()=>U(n,U(o,Ie(r,e)))}}};var A7={kernelName:Sl,gradFunc:n=>({x:()=>tt(n)})};var R7={kernelName:wl,inputsToSave:["a","b"],gradFunc:(n,t)=>{let[e,r]=t,o=yt(e.shape,r.shape);return{a:()=>{let a=n,l=Tn(e.shape,o);return l.length>0&&(a=Pe(a,l)),G(a,e.shape)},b:()=>{let a=n,l=Tn(r.shape,o);return l.length>0&&(a=Pe(a,l)),G(Dt(a),r.shape)}}}};var O7={kernelName:au,inputsToSave:["x"],gradFunc:(n,t,e)=>{let[r]=t,o=r.shape.slice(),{axis:i}=e;Mr(i,r.shape).forEach(c=>{o[c]=1});let a=G(n,o),l=U(a,Tr(r.shape,"float32"));return{x:()=>l}}};var M7={kernelName:Cl,inputsToSave:["x"],gradFunc:(n,t)=>{let[e]=t;return{x:()=>Se(n,xt(Nf(e)))}}};var P7={kernelName:_l,outputsToSave:[!0],gradFunc:(n,t)=>{let[e]=t;return{x:()=>U(Ie(Ae(1),xt(e)),n)}}};var F7={kernelName:Bs,inputsToSave:["x"],gradFunc:(n,t,e)=>{let[r]=t,{reps:o}=e;return{x:()=>{let s=tt(r);if(r.rank===1)for(let a=0;a<o[0];++a)s=ae(s,Je(n,[a*r.shape[0]],[r.shape[0]]));else if(r.rank===2)for(let a=0;a<o[0];++a)for(let l=0;l<o[1];++l)s=ae(s,Je(n,[a*r.shape[0],l*r.shape[1]],[r.shape[0],r.shape[1]]));else if(r.rank===3)for(let a=0;a<o[0];++a)for(let l=0;l<o[1];++l)for(let c=0;c<o[2];++c)s=ae(s,Je(n,[a*r.shape[0],l*r.shape[1],c*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else if(r.rank===4)for(let a=0;a<o[0];++a)for(let l=0;l<o[1];++l)for(let c=0;c<o[2];++c)for(let u=0;u<o[3];++u)s=ae(s,Je(n,[a*r.shape[0],l*r.shape[1],c*r.shape[2],u*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${r.rank} tensors yet.`);return s}}}};var L7={kernelName:zs,gradFunc:(n,t,e)=>{let r=e,{perm:o}=r,i=kb(o);return{x:()=>St(n,i)}}};var $7={kernelName:du,gradFunc:(n,t,e)=>{let r=e,{axis:o}=r;return{value:()=>sr(n,o)}}};var V7={kernelName:pu,inputsToSave:["segmentIds"],gradFunc:(n,t)=>{let[e]=t;return{x:()=>j2e(n,e)}}};function j2e(n,t){let e=yi(t,tt(t)),r=_u(n,e),o=Qo(t,Ae(0,"int32")),i=r.rank-o.rank;for(let a=0;a<i;++a)o=On(o,a+1);o=Co(o,Tr(r.shape,"bool"));let s=tt(r);return Rn(o,r,s)}var B7={kernelName:fu,gradFunc:n=>({x:()=>tt(n)})};var H2e=[eE,j8,H8,q8,K8,X8,Y8,Z8,Q8,J8,eK,tK,rK,iK,sK,aK,lK,cK,uK,dK,pK,fK,mK,hK,yK,xK,vK,bK,wK,CK,c7,_K,SK,IK,EK,TK,kK,DK,NK,OK,MK,PK,FK,LK,$K,VK,BK,zK,UK,GK,VF,VF,jK,qK,XK,YK,ZK,QK,JK,e7,t7,n7,r7,o7,i7,BF,BF,s7,a7,l7,u7,d7,p7,f7,h7,m7,g7,y7,x7,v7,b7,w7,C7,_7,S7,I7,E7,T7,zF,zF,UF,UF,D7,N7,k7,A7,R7,O7,M7,P7,F7,L7,$7,V7,B7];for(let n of H2e)S6(n);j().prototype.abs=function(){return this.throwIfDisposed(),Bn(this)};j().prototype.acos=function(){return this.throwIfDisposed(),zI(this)};j().prototype.acosh=function(){return this.throwIfDisposed(),UI(this)};j().prototype.add=function(n){return this.throwIfDisposed(),ae(this,n)};j().prototype.all=function(n,t){return this.throwIfDisposed(),Qy(this,n,t)};j().prototype.any=function(n,t){return this.throwIfDisposed(),dm(this,n,t)};j().prototype.argMax=function(n){return this.throwIfDisposed(),js(this,n)};j().prototype.argMin=function(n){return this.throwIfDisposed(),WI(this,n)};j().prototype.asScalar=function(){return this.throwIfDisposed(),L(this.size===1,()=>"The array must have only 1 element."),G(this,[])};j().prototype.asType=function(n){return this.throwIfDisposed(),me(this,n)};j().prototype.as1D=function(){return this.throwIfDisposed(),G(this,[this.size])};j().prototype.as2D=function(n,t){return this.throwIfDisposed(),G(this,[n,t])};j().prototype.as3D=function(n,t,e){return this.throwIfDisposed(),G(this,[n,t,e])};j().prototype.as4D=function(n,t,e,r){return this.throwIfDisposed(),G(this,[n,t,e,r])};j().prototype.as5D=function(n,t,e,r,o){return this.throwIfDisposed(),G(this,[n,t,e,r,o])};j().prototype.asin=function(){return this.throwIfDisposed(),GI(this)};j().prototype.asinh=function(){return this.throwIfDisposed(),jI(this)};j().prototype.atan=function(){return this.throwIfDisposed(),HI(this)};j().prototype.atan2=function(n){return this.throwIfDisposed(),qI(this,n)};j().prototype.atanh=function(){return this.throwIfDisposed(),KI(this)};j().prototype.avgPool=function(n,t,e,r){return this.throwIfDisposed(),Df(this,n,t,e,r)};j().prototype.batchToSpaceND=function(n,t){return this.throwIfDisposed(),kf(this,n,t)};j().prototype.batchNorm=function(n,t,e,r,o){return this.throwIfDisposed(),xu(this,n,t,e,r,o)};j().prototype.broadcastTo=function(n){return this.throwIfDisposed(),vu(this,n)};j().prototype.cast=function(n){return this.throwIfDisposed(),me(this,n)};j().prototype.ceil=function(){return this.throwIfDisposed(),e1(this)};j().prototype.clipByValue=function(n,t){return this.throwIfDisposed(),Pr(this,n,t)};j().prototype.concat=function(n,t){return this.throwIfDisposed(),n instanceof bt&&(n=[n]),Gt([this,...n],t)};j().prototype.conv1d=function(n,t,e,r,o,i){return this.throwIfDisposed(),ex(this,n,t,e,r,o,i)};j().prototype.conv2dTranspose=function(n,t,e,r,o){return this.throwIfDisposed(),nx(this,n,t,e,r,o)};j().prototype.conv2d=function(n,t,e,r,o,i){return this.throwIfDisposed(),mi(this,n,t,e,r,o,i)};j().prototype.cos=function(){return this.throwIfDisposed(),Nf(this)};j().prototype.cosh=function(){return this.throwIfDisposed(),rx(this)};j().prototype.cumprod=function(n,t,e){return this.throwIfDisposed(),fm(this,n,t,e)};j().prototype.cumsum=function(n,t,e){return this.throwIfDisposed(),ox(this,n,t,e)};j().prototype.depthToSpace=function(n,t){return this.throwIfDisposed(),l1(this,n,t)};j().prototype.depthwiseConv2d=function(n,t,e,r,o,i){return this.throwIfDisposed(),bu(this,n,t,e,r,o,i)};j().prototype.dilation2d=function(n,t,e,r,o){return this.throwIfDisposed(),c1(this,n,t,e,r,o)};j().prototype.divNoNan=function(n){return this.throwIfDisposed(),u1(this,n)};j().prototype.div=function(n){return this.throwIfDisposed(),Se(this,n)};j().prototype.dot=function(n){return this.throwIfDisposed(),d1(this,n)};j().prototype.elu=function(){return this.throwIfDisposed(),wu(this)};j().prototype.equal=function(n){return this.throwIfDisposed(),Po(this,n)};j().prototype.erf=function(){return this.throwIfDisposed(),ix(this)};j().prototype.euclideanNorm=function(n,t){return this.throwIfDisposed(),p1(this,n,t)};j().prototype.exp=function(){return this.throwIfDisposed(),Gn(this)};j().prototype.expandDims=function(n){return this.throwIfDisposed(),On(this,n)};j().prototype.expm1=function(){return this.throwIfDisposed(),f1(this)};j().prototype.fft=function(){return this.throwIfDisposed(),zf(this)};j().prototype.flatten=function(){return this.throwIfDisposed(),G(this,[this.size])};j().prototype.floor=function(){return this.throwIfDisposed(),Cu(this)};j().prototype.floorDiv=function(n){return this.throwIfDisposed(),Zy(this,n)};j().prototype.gather=function(n,t,e){return this.throwIfDisposed(),_u(this,n,t,e)};j().prototype.greaterEqual=function(n){return this.throwIfDisposed(),Qo(this,n)};j().prototype.greater=function(n){return this.throwIfDisposed(),ir(this,n)};j().prototype.ifft=function(){return this.throwIfDisposed(),Fd(this)};j().prototype.irfft=function(){return this.throwIfDisposed(),xx(this)};j().prototype.isFinite=function(){return this.throwIfDisposed(),h1(this)};j().prototype.isInf=function(){return this.throwIfDisposed(),m1(this)};j().prototype.isNaN=function(){return this.throwIfDisposed(),g1(this)};j().prototype.leakyRelu=function(n){return this.throwIfDisposed(),Of(this,n)};j().prototype.lessEqual=function(n){return this.throwIfDisposed(),Gi(this,n)};j().prototype.less=function(n){return this.throwIfDisposed(),Md(this,n)};j().prototype.localResponseNormalization=function(n,t,e,r){return this.throwIfDisposed(),y1(this,n,t,e,r)};j().prototype.logSigmoid=function(){return this.throwIfDisposed(),x1(this)};j().prototype.logSoftmax=function(n){return this.throwIfDisposed(),sx(this,n)};j().prototype.logSumExp=function(n,t){return this.throwIfDisposed(),Pf(this,n,t)};j().prototype.log=function(){return this.throwIfDisposed(),eo(this)};j().prototype.log1p=function(){return this.throwIfDisposed(),Mf(this)};j().prototype.logicalAnd=function(n){return this.throwIfDisposed(),Co(this,n)};j().prototype.logicalNot=function(){return this.throwIfDisposed(),Ff(this)};j().prototype.logicalOr=function(n){return this.throwIfDisposed(),ax(this,n)};j().prototype.logicalXor=function(n){return this.throwIfDisposed(),v1(this,n)};j().prototype.matMul=function(n,t,e){return this.throwIfDisposed(),_t(this,n,t,e)};j().prototype.maxPool=function(n,t,e,r){return this.throwIfDisposed(),Lf(this,n,t,e,r)};j().prototype.max=function(n,t){return this.throwIfDisposed(),Jr(this,n,t)};j().prototype.maximum=function(n){return this.throwIfDisposed(),yi(this,n)};j().prototype.mean=function(n,t){return this.throwIfDisposed(),Mn(this,n,t)};j().prototype.min=function(n,t){return this.throwIfDisposed(),Rd(this,n,t)};j().prototype.minimum=function(n){return this.throwIfDisposed(),xi(this,n)};j().prototype.mirrorPad=function(n,t){return this.throwIfDisposed(),lx(this,n,t)};j().prototype.mod=function(n){return this.throwIfDisposed(),C1(this,n)};j().prototype.mul=function(n){return this.throwIfDisposed(),U(this,n)};j().prototype.neg=function(){return this.throwIfDisposed(),Dt(this)};j().prototype.norm=function(n,t,e){return this.throwIfDisposed(),Od(this,n,t,e)};j().prototype.notEqual=function(n){return this.throwIfDisposed(),Nl(this,n)};j().prototype.oneHot=function(n,t=1,e=0){return this.throwIfDisposed(),gm(this,n,t,e)};j().prototype.onesLike=function(){return this.throwIfDisposed(),Hr(this)};j().prototype.pad=function(n,t){return this.throwIfDisposed(),to(this,n,t)};j().prototype.pool=function(n,t,e,r,o,i){return this.throwIfDisposed(),_1(this,n,t,e,r,o,i)};j().prototype.pow=function(n){return this.throwIfDisposed(),wo(this,n)};j().prototype.prelu=function(n){return this.throwIfDisposed(),Vf(this,n)};j().prototype.prod=function(n,t){return this.throwIfDisposed(),S1(this,n,t)};j().prototype.reciprocal=function(){return this.throwIfDisposed(),k1(this)};j().prototype.relu=function(){return this.throwIfDisposed(),ho(this)};j().prototype.relu6=function(){return this.throwIfDisposed(),cx(this)};j().prototype.reshapeAs=function(n){return this.throwIfDisposed(),G(this,n.shape)};j().prototype.reshape=function(n){return this.throwIfDisposed(),G(this,n)};j().prototype.resizeBilinear=function(n,t,e){return this.throwIfDisposed(),H1(this,n,t,e)};j().prototype.resizeNearestNeighbor=function(n,t,e){return this.throwIfDisposed(),q1(this,n,t,e)};j().prototype.reverse=function(n){return this.throwIfDisposed(),Fr(this,n)};j().prototype.rfft=function(){return this.throwIfDisposed(),Uf(this)};j().prototype.round=function(){return this.throwIfDisposed(),ux(this)};j().prototype.rsqrt=function(){return this.throwIfDisposed(),dx(this)};j().prototype.selu=function(){return this.throwIfDisposed(),px(this)};j().prototype.separableConv2d=function(n,t,e,r,o,i){return this.throwIfDisposed(),fx(this,n,t,e,r,o,i)};j().prototype.sigmoid=function(){return this.throwIfDisposed(),jr(this)};j().prototype.sign=function(){return this.throwIfDisposed(),N1(this)};j().prototype.sin=function(){return this.throwIfDisposed(),hx(this)};j().prototype.sinh=function(){return this.throwIfDisposed(),mx(this)};j().prototype.slice=function(n,t){return this.throwIfDisposed(),Je(this,n,t)};j().prototype.softmax=function(n){return this.throwIfDisposed(),Bf(this,n)};j().prototype.softplus=function(){return this.throwIfDisposed(),kl(this)};j().prototype.spaceToBatchND=function(n,t){return this.throwIfDisposed(),$f(this,n,t)};j().prototype.split=function(n,t){return this.throwIfDisposed(),Lr(this,n,t)};j().prototype.sqrt=function(){return this.throwIfDisposed(),wn(this)};j().prototype.square=function(){return this.throwIfDisposed(),xt(this)};j().prototype.squaredDifference=function(n){return this.throwIfDisposed(),vx(this,n)};j().prototype.squeeze=function(n){return this.throwIfDisposed(),qt(this,n)};j().prototype.stack=function(n,t){this.throwIfDisposed();let e=n instanceof bt?[this,n]:[this,...n];return sr(e,t)};j().prototype.step=function(n){return this.throwIfDisposed(),Ks(this,n)};j().prototype.stridedSlice=function(n,t,e,r,o,i,s,a){return this.throwIfDisposed(),A1(this,n,t,e,r,o,i,s,a)};j().prototype.sub=function(n){return this.throwIfDisposed(),Ie(this,n)};j().prototype.sum=function(n,t){return this.throwIfDisposed(),Pe(this,n,t)};j().prototype.tan=function(){return this.throwIfDisposed(),R1(this)};j().prototype.tanh=function(){return this.throwIfDisposed(),Dl(this)};j().prototype.tile=function(n){return this.throwIfDisposed(),fo(this,n)};j().prototype.toBool=function(){return this.throwIfDisposed(),me(this,"bool")};j().prototype.toFloat=function(){return this.throwIfDisposed(),me(this,"float32")};j().prototype.toInt=function(){return this.throwIfDisposed(),me(this,"int32")};j().prototype.topk=function(n,t){return this.throwIfDisposed(),M1(this,n,t)};j().prototype.transpose=function(n){return this.throwIfDisposed(),St(this,n)};j().prototype.unique=function(n){return this.throwIfDisposed(),P1(this,n)};j().prototype.unsortedSegmentSum=function(n,t){return this.throwIfDisposed(),wx(this,n,t)};j().prototype.unstack=function(n){return this.throwIfDisposed(),$r(this,n)};j().prototype.where=function(n,t){return this.throwIfDisposed(),Rn(n,this,t)};j().prototype.zerosLike=function(){return this.throwIfDisposed(),tt(this)};var ys=class n extends Error{constructor(t){super(t),Object.setPrototypeOf(this,n.prototype)}},Jo=class n extends Error{constructor(t){super(t),Object.setPrototypeOf(this,n.prototype)}},J=class n extends Error{constructor(t){super(t),Object.setPrototypeOf(this,n.prototype)}},st=class n extends Error{constructor(t){super(t),Object.setPrototypeOf(this,n.prototype)}},nE=class n extends Error{constructor(t){super(t),Object.setPrototypeOf(this,n.prototype)}};var $b=class{constructor(t){this.maxEntries=t||100,this.cache=new Map}get(t){let e;return this.cache.has(t)&&(e=this.cache.get(t),this.cache.delete(t),this.cache.set(t,e)),e}put(t,e){if(this.cache.has(t))this.cache.delete(t);else if(this.cache.size>=this.maxEntries){let r=this.cache.keys().next().value;this.cache.delete(r)}this.cache.set(t,e)}getMaxEntries(){return this.maxEntries}setMaxEntries(t){if(t<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${t}.`);if(this.maxEntries>t)for(let e=0;e<this.maxEntries-t;e++){let r=this.cache.keys().next().value;this.cache.delete(r)}this.maxEntries=t}};function Zs(n,t){if(Array.isArray(n)){let e=[];for(let r=0;r<t;r++)e=e.concat(n);return e}else{let e=new Array(t);return e.fill(n),e}}function xs(n,t){if(!n)throw new nE(t)}function GF(n,t){let e=0;for(let r of n)r===t&&e++;return e}function no(n){return n.length===1?n[0]:n}function cn(n){return Array.isArray(n)?n:[n]}function Qs(n){let e=n.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return e[0]!=="_"?e:"private"+e}function Vd(n){return n.length<=1||n.indexOf("_")===-1?n:n.replace(/[_]+(\w|$)/g,(t,e)=>e.toUpperCase())}var Ys={};function kx(n){if(n==null)return null;let t={};return t.className=n.getClassName(),t.config=n.getConfig(),t}function WF(n){if(!(n==null||typeof n!="object"))if(Array.isArray(n))n.forEach(t=>WF(t));else{let t=Object.keys(n);for(let e of t){let r=n[e];r!=null&&typeof r=="object"&&(!Array.isArray(r)&&r.type==="ndarray"&&typeof r.value=="number"?n[e]=r.value:WF(r))}}}function Iu(n,t={},e={},r="object",o=!1){if(typeof n=="string"){let i=n,s;if(i in e)s=e[i];else if(i in Ys)s=Ys[i];else if(s=t[i],s==null)throw new J(`Unknown ${r}: ${n}. This may be due to one of the following reasons:
1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return s}else{let i=n;if(i.className==null||i.config==null)throw new J(`${r}: Improper config format: ${JSON.stringify(i)}.
'className' and 'config' must set.`);let s=i.className,a,l;if(s in e?[a,l]=e[s]:s in Ys?[a,l]=Ys.className:s in t&&([a,l]=t[s]),a==null)throw new J(`Unknown ${r}: ${s}. This may be due to one of the following reasons:
1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(l!=null){let c={};for(let f of Object.keys(Ys))c[f]=Ys[f];for(let f of Object.keys(e))c[f]=e[f];let u=i.config;u.customObjects=c;let d=Object.assign({},Ys);for(let f of Object.keys(e))Ys[f]=e[f];WF(i.config);let p=l(a,i.config,e,o);return Ys=Object.assign({},d),p}else{let c=Object.assign({},Ys);for(let d of Object.keys(e))Ys[d]=e[d];let u=new a(i.config);return Ys=Object.assign({},c),u}}}function q2e(n,t){return n<t?-1:n>t?1:0}function Vb(n,t){return-1*q2e(n,t)}function Js(n){if(n==null)return n;let t=[];for(let e of n)t.indexOf(e)===-1&&t.push(e);return t}function z7(n){if(n==null)throw new J(`Invalid value in obj: ${JSON.stringify(n)}`);for(let t in n)if(n.hasOwnProperty(t))return!1;return!0}function Eu(n,t,e){if(e!=null&&n.indexOf(e)<0)throw new J(`${e} is not a valid ${t}.  Valid values are ${n} or null/undefined.`)}function rE(n,t,e=0,r=1/0){return xs(e>=0),xs(r>=e),Array.isArray(n)&&n.length>=e&&n.length<=r&&n.every(o=>typeof o===t)}function wr(n,t){Array.isArray(n)?(b.assert(n.length>0,()=>`${t} is unexpectedly an empty array.`),n.forEach((e,r)=>wr(e,`element ${r+1} of ${t}`))):b.assert(Number.isInteger(n)&&n>0,()=>`Expected ${t} to be a positive integer, but got ${U7(n)}.`)}function U7(n){return n===null?"null":Array.isArray(n)?"["+n.map(t=>U7(t)).join(",")+"]":typeof n=="string"?`"${n}"`:`${n}`}function W7(n,t,e){let r=e!=null?e():b.now(),o;return(...s)=>{let a=e!=null?e():b.now();return a-r<t||(r=a,o=n(...s)),o}}function oE(n){return n==="relu"?"relu":n==="linear"?"linear":n==="elu"?"elu":null}var K2e=0;function sE(){return K2e++}var iE={};function jf(n=""){return n in iE||(iE[n]=0),iE[n]+=1,n+iE[n].toString()}var G7=["channelsFirst","channelsLast"],j7=["nearest","bilinear"],H7=["valid","same","causal"],q7=["max","avg"],K7=["sum","mul","concat","ave"];var Nx=new Map;function Xn(n){Eu(G7,"DataFormat",n)}function Y7(n){Eu(j7,"InterpolationFormat",n)}function ei(n){Eu(H7,"PaddingMode",n)}function jF(n){Eu(q7,"PoolMode",n)}var Bb=[],X7="/";function Ol(n,t){Bb.push(n);try{let e=t();return Bb.pop(),e}catch(e){throw Bb.pop(),e}}function X2e(){return Bb.length===0?"":Bb.join(X7)+X7}function aE(n){if(!Z7(n))throw new Error("Not a valid tensor name: '"+n+"'");return X2e()+n}function lE(n){if(!Z7(n))throw new Error("Not a valid tensor name: '"+n+"'");Nx.has(n)||Nx.set(n,0);let t=Nx.get(n);if(Nx.set(n,Nx.get(n)+1),t>0){let e=`${n}_${t}`;return Nx.set(e,1),e}else return n}var Y2e=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function Z7(n){return!!n.match(Y2e)}function Q7(n){return n===parseInt(n.toString(),10)}function ea(n,t,e){t==null&&(t=0),e==null&&(e=n.length);let r=1;for(let o=t;o<e;++o)r*=n[o];return r}function Tm(n){if(n.length===0)return Number.NaN;let t=Number.POSITIVE_INFINITY;for(let e=0;e<n.length;e++){let r=n[e];r<t&&(t=r)}return t}function Ml(n){if(n.length===0)return Number.NaN;let t=Number.NEGATIVE_INFINITY;for(let e=0;e<n.length;e++){let r=n[e];r>t&&(t=r)}return t}function ti(n,t){if(t<n)throw new J(`end (${t}) < begin (${n}) is forbidden.`);let e=[];for(let r=n;r<t;++r)e.push(r);return e}var HF;function Nr(){return HF==null&&(HF=mu().epsilon()),HF}function ni(){return"channelsLast"}function Lo(n,t){return me(n,t)}function zd(n,t=-1){let e=n.shape.slice();return t<0&&(t=e.length+t+1),e.splice(t,0,1),G(n,e)}function J7(n,t){return Z(()=>{if(n.shape.length!==2)throw new J(`repeat() expects a rank-2 tensor, but received a rank-${n.shape.length} tensor.`);let e=zd(n,1);return uE(e,[1,t,1])})}function e9(n){let t=[ea(n.shape)];return G(n,t)}function t9(n){if(n.rank<=1)throw new J(`batchFlatten requires a minimum rank of 2. Got rank: ${n.rank}.`);let t=[n.shape[0],ea(n.shape,1)];return G(n,t)}function Bd(n,t,e){return Z(()=>{switch(n.rank){case 1:return gx(n,t,e);case 2:return Rb(n,[t,0],[e,n.shape[1]]);case 3:return yx(n,[t,0,0],[e,n.shape[1],n.shape[2]]);case 4:return bm(n,[t,0,0,0],[e,n.shape[1],n.shape[2],n.shape[3]]);case 5:return Je(n,[t,0,0,0,0],[e,n.shape[1],n.shape[2],n.shape[3],n.shape[4]]);case 6:return Je(n,[t,0,0,0,0,0],[e,n.shape[1],n.shape[2],n.shape[3],n.shape[4],n.shape[5]]);default:throw new J(`sliceAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}})}function qF(n,t,e){return Z(()=>{switch(n.rank){case 1:return gx(n,t,e);case 2:return Rb(n,[0,t],[n.shape[0],e]);case 3:return yx(n,[0,0,t],[n.shape[0],n.shape[1],e]);case 4:return bm(n,[0,0,0,t],[n.shape[0],n.shape[1],n.shape[2],e]);default:throw new J(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function zb(n,t,e,r){return Z(()=>{switch(n.rank){case 1:return gx(n,t,e);case 2:switch(r){case 1:return Bd(n,t,e);case 2:return qF(n,t,e);default:throw new J(`The axis is not within the rank of the tensor ${r}`)}case 3:switch(r){case 1:return Bd(n,t,e);case 2:return yx(n,[0,t,0],[n.shape[0],e,n.shape[2]]);case 3:return qF(n,t,e);default:throw new J(`The axis is not within the rank of the tensor ${r}`)}case 4:switch(r){case 1:return Bd(n,t,e);case 2:return bm(n,[0,t,0,0],[n.shape[0],e,n.shape[2],n.shape[3]]);case 3:return bm(n,[0,0,t,0],[n.shape[0],n.shape[1],e,n.shape[3]]);case 4:return qF(n,t,e);default:throw new J(`The axis is not within the rank of the tensor ${r}`)}default:throw new J(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function Ax(n,t=-1){let e;return t<0&&(e=n[0].rank,e!==0?t=e:t=0),t===n[0].rank&&(t=-1),Gt(n,t)}function XF(n,t){switch(n.rank){case 1:return t1([n,t]);case 2:return n1([n,t],0);case 3:return r1([n,t],0);case 4:return o1([n,t],0);default:throw new J(`concatAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}}function uE(n,t){if(Array.isArray(t)||(t=[t]),n.rank!==t.length)throw new J(`The length of input n (${t.length}) does not match the number of dimensions in input x (${n.rank})`);return fo(n,t)}function Rx(n,t=0,e=1,r,o){return vm(n,t,e,r,o)}function ta(n,t,e,r){if(n.rank<2||t.rank<2)throw new st(`dot requires both inputs to be rank >= 2 but got x shape = ${n.shape} and y shape = ${t.shape}`);if(t.rank>=3){let o=n.shape.slice(-1)[0],i=t.shape.slice(-2)[0];if(o!==i)throw new st(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${n.shape} and  y shape = ${t.shape}`)}if(n.rank===2&&t.rank===2)return Wf.matMul({a:n,b:t,transposeA:!1,transposeB:!1,bias:r?KF(n.rank,r,ni()):null,activation:e});{let o=n.shape.slice(),i=o.pop();n=G(n,[-1,i]);let s=t.shape.slice(),a=s.pop(),l=s.pop(),c=[...s,a],u=Array.from({length:t.rank},(h,m)=>m===0?t.rank-2:m<=t.rank-2?m-1:m);t=G(St(t,u),[l,-1]);let d=[...o,...c];return G(Wf.matMul({a:n,b:t,transposeA:!1,transposeB:!1,bias:r?KF(n.rank,r,ni()):null,activation:e}),d)}}function dE(n,t,e){return Z(()=>(Array.isArray(t)?t=Cn(t,"int32"):t=me(t,"int32"),_u(n,t,e)))}function Dm(n){return U(n,n)}function KF(n,t,e){let r=t.shape;if(t.rank!==1&&t.rank!==n)throw new J(`Unexpected bias dimensions: ${t.rank}; expected it to be 1 or ${n}`);if(n===5){if(e==="channelsFirst")return r.length===1?G(t,[1,r[0],1,1,1]):G(t,[1,r[3],r[0],r[1],r[2]]);if(e==="channelsLast")return r.length===1?G(t,[1,1,1,1,r[0]]):G(t,[1].concat(r))}else if(n===4){if(e==="channelsFirst")return r.length===1?G(t,[1,r[0],1,1]):G(t,[1,r[2],r[0],r[1]]);if(e==="channelsLast")return r.length===1?G(t,[1,1,1,r[0]]):G(t,[1].concat(r))}else if(n===3){if(e==="channelsFirst")return r.length===1?G(t,[1,r[0],1]):G(t,[1,r[1],r[0]]);if(e==="channelsLast")return r.length===1?G(t,[1,1,r[0]]):G(t,[1].concat(r))}else if(n<3)return t;throw new J(`Unsupported input rank by biasAdd: ${t.rank}`)}function ri(n,t,e){return Z(()=>(e==null&&(e=ni()),Xn(e),ae(n,KF(n.rank,t,e))))}function n9(n,t=1){if(t!==1)throw new st(`Support for alpha values other than 1 (${t}) is not implemented yet.`);return wu(n)}function r9(n){return Z(()=>Se(n,ae(Bn(n),1)))}function pE(n,t,e,r){return Z(()=>bF(n,t,e,r))}function o9(n){return Z(()=>{let t=ae(.5,U(.2,n));return Pr(t,0,1)})}function Hf(n,t,e=!1){return e?n():t()}var i9=["fanIn","fanOut","fanAvg"],s9=["normal","uniform","truncatedNormal"];function Z2e(n){Eu(i9,"FanMode",n)}function Q2e(n){Eu(s9,"Distribution",n)}var oi=class extends ge.Serializable{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}},c9=(()=>{class n extends oi{apply(e,r){return hn(e,r)}}return n.className="Zeros",n})();ge.registerClass(c9);var fE=(()=>{class n extends oi{apply(e,r){return Tr(e,r)}}return n.className="Ones",n})();ge.registerClass(fE);var u9=(()=>{class n extends oi{constructor(e){if(super(),typeof e!="object")throw new J(`Expected argument of type ConstantConfig but got ${e}`);if(e.value===void 0)throw new J(`config must have value set but got ${e}`);this.value=e.value}apply(e,r){return Z(()=>U(Ae(this.value),Tr(e,r)))}getConfig(){return{value:this.value}}}return n.className="Constant",n})();ge.registerClass(u9);var d9=(()=>{class n extends oi{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,r){return ji(e,this.minval,this.maxval,r,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}return n.className="RandomUniform",n})();ge.registerClass(d9);var p9=(()=>{class n extends oi{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,r){if(r=r||"float32",r!=="float32"&&r!=="int32")throw new st(`randomNormal does not support dType ${r}.`);return Rx(e,this.mean,this.stddev,r,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}return n.className="RandomNormal",n})();ge.registerClass(p9);var f9=(()=>{class n extends oi{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,r){if(r=r||"float32",r!=="float32"&&r!=="int32")throw new st(`truncatedNormal does not support dType ${r}.`);return bx(e,this.mean,this.stddev,r,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}return n.className="TruncatedNormal",n})();ge.registerClass(f9);var h9=(()=>{class n extends oi{constructor(e){super(),this.gain=e.gain!=null?e.gain:1}apply(e,r){return Z(()=>{if(e.length!==2||e[0]!==e[1])throw new J("Identity matrix initializer can only be used for 2D square matrices.");return U(this.gain,hm(e[0]))})}getConfig(){return{gain:this.gain}}}return n.className="Identity",n})();ge.registerClass(h9);function J2e(n,t="channelsLast"){let e,r;if(Xn(t),n.length===2)e=n[0],r=n[1];else if([3,4,5].indexOf(n.length)!==-1){if(t==="channelsFirst"){let o=ea(n,2);e=n[1]*o,r=n[0]*o}else if(t==="channelsLast"){let o=ea(n,0,n.length-2);e=n[n.length-2]*o,r=n[n.length-1]*o}}else{let o=ea(n);e=Math.sqrt(o),r=Math.sqrt(o)}return[e,r]}var Hi=(()=>{class n extends oi{constructor(e){if(super(),e.scale<0)throw new J(`scale must be a positive float. Got: ${e.scale}`);this.scale=e.scale==null?1:e.scale,this.mode=e.mode==null?"fanIn":e.mode,Z2e(this.mode),this.distribution=e.distribution==null?"normal":e.distribution,Q2e(this.distribution),this.seed=e.seed}apply(e,r){let o=J2e(e),i=o[0],s=o[1],a=this.scale;if(this.mode==="fanIn"?a/=Math.max(1,i):this.mode==="fanOut"?a/=Math.max(1,s):a/=Math.max(1,(i+s)/2),this.distribution==="normal"){let l=Math.sqrt(a);if(r=r||"float32",r!=="float32"&&r!=="int32")throw new st(`${this.getClassName()} does not support dType ${r}.`);return bx(e,0,l,r,this.seed)}else{let l=Math.sqrt(3*a);return ji(e,-l,l,r,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}return n.className="VarianceScaling",n})();ge.registerClass(Hi);var YF=(()=>{class n extends Hi{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Hi.className}}return n.className="GlorotUniform",n})();ge.registerClass(YF);var ZF=(()=>{class n extends Hi{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Hi.className}}return n.className="GlorotNormal",n})();ge.registerClass(ZF);var QF=(()=>{class n extends Hi{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Hi.className}}return n.className="HeNormal",n})();ge.registerClass(QF);var JF=(()=>{class n extends Hi{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Hi.className}}return n.className="HeUniform",n})();ge.registerClass(JF);var eL=(()=>{class n extends Hi{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Hi.className}}return n.className="LeCunNormal",n})();ge.registerClass(eL);var tL=(()=>{class n extends Hi{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Hi.className}}return n.className="LeCunUniform",n})();ge.registerClass(tL);var m9=(()=>{class n extends oi{constructor(e){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=e.gain==null?this.DEFAULT_GAIN:e.gain,this.seed=e.seed}apply(e,r){return Z(()=>{if(e.length<2)throw new st("Shape must be at least 2D.");if(r!=="int32"&&r!=="float32"&&r!==void 0)throw new TypeError(`Unsupported data type ${r}.`);r=r;let o=b.sizeFromShape(e.slice(0,-1)),i=e[e.length-1],s=o*i;s>this.ELEMENTS_WARN_SLOW&&console.warn(`Orthogonal initializer is being called on a matrix with more than ${this.ELEMENTS_WARN_SLOW} (${s}) elements: Slowness may result.`);let a=[Math.max(i,o),Math.min(i,o)],l=Rx(a,0,1,r,this.seed),c=_F.qr(l,!1),u=c[0],p=c[1].flatten().stridedSlice([0],[Math.min(i,o)*Math.min(i,o)],[Math.min(i,o)+1]);return u=U(u,p.sign()),o<i&&(u=u.transpose()),U(Ae(this.gain),u.reshape(e))})}getConfig(){return{gain:this.gain,seed:this.seed}}}return n.className="Orthogonal",n})();ge.registerClass(m9);var a9={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function l9(n,t={}){return Iu(n,ge.SerializationMap.getMap().classNameMap,t,"initializer")}function Pn(n){return kx(n)}function _n(n){if(typeof n=="string"){let t=n in a9?a9[n]:n;if(t==="GlorotNormal")return new ZF;if(t==="GlorotUniform")return new YF;if(t==="HeNormal")return new QF;if(t==="HeUniform")return new JF;if(t==="LeCunNormal")return new eL;if(t==="LeCunUniform")return new tL;{let e={};return e.className=t,e.config={},l9(e)}}else return n instanceof oi?n:l9(n)}function hE(n){return Array.isArray(n)&&Array.isArray(n[0])}function Ox(n){return n.length===0?[]:Array.isArray(n[0])?n:[n]}function rt(n){let t;if(Array.isArray(n)){if(n.length!==1)throw new J(`Expected Tensor length to be 1; got ${n.length}`);t=n[0]}else t=n;return t}function wt(n){if(Array.isArray(n)&&Array.isArray(n[0])){if(n.length===1)return n=n,n[0];throw new J(`Expected exactly 1 Shape; got ${n.length}`)}else return n}function Mx(n){let t=0;for(let e of n)e.shape.length===0?t+=1:t+=e.shape.reduce((r,o)=>r*o);return t}var y9="Variable",Ub=class{constructor(t,e="float32",r=y9,o=!0,i=null){this.dtype=e??"float32",this.shape=t.shape,this.id=sE(),r=r??y9,this.originalName=aE(r),this.name=lE(this.originalName),this.trainable_=o,this.constraint=i,this.val=F1(t,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(t){return this.assertNotDisposed(),tRe(this.val,t),this.val.id!==t.id&&(this.val.assign(t),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(t){this.trainable_=t,this.val.trainable=t}};function tRe(n,t){if(n.shape.toString()!==t.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(n.shape)+" vs. "+JSON.stringify(t.shape))}function Wb(n){return n.map(t=>t.read())}function Px(n){n.forEach(t=>{t[0].write(t[1])})}var Dn=class{constructor(t){this.dtype=t.dtype,this.shape=t.shape,t.shape!=null?this.ndim=t.shape.length:this.ndim=t.ndim,this.maxNDim=t.maxNDim,this.minNDim=t.minNDim,this.axes=t.axes||{}}},$o=class{constructor(t,e,r,o,i,s,a){this.dtype=t,this.shape=e,this.sourceLayer=r,this.inputs=o,this.callArgs=i,this.outputTensorIndex=a,this.id=sE(),s!=null&&(this.originalName=aE(s),this.name=lE(this.originalName)),this.rank=e.length}},nRe=0,Ud=class{constructor(t,e){this.callArgs=e,this.id=nRe++,this.outboundLayer=t.outboundLayer,this.inboundLayers=t.inboundLayers,this.nodeIndices=t.nodeIndices,this.tensorIndices=t.tensorIndices,this.inputTensors=t.inputTensors,this.outputTensors=t.outputTensors,this.inputMasks=t.inputMasks,this.outputMasks=t.outputMasks,this.inputShapes=t.inputShapes,this.outputShapes=t.outputShapes;for(let r of t.inboundLayers)r?.outboundNodes.push(this);t.outboundLayer.inboundNodes.push(this)}getConfig(){let t=[];for(let e of this.inboundLayers)e!=null?t.push(e.name):t.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:t,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}},rRe=0,at=class extends ge.Serializable{constructor(t={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=rRe++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let e=t.name;if(!e){let r=this.getClassName();e=Qs(r)+"_"+jf(r)}if(this.name=e,this.trainable_=t.trainable==null?!0:t.trainable,t.inputShape!=null||t.batchInputShape!=null){let r;if(t.batchInputShape!=null)r=t.batchInputShape;else if(t.inputShape!=null){let i=null;t.batchSize!=null&&(i=t.batchSize),r=[i].concat(t.inputShape)}this.batchInputShape=r;let o=t.dtype;o==null&&(o=t.inputDType),o==null&&(o="float32"),this.dtype=o}t.weights!=null?this.initialWeights=t.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(t,e){return t.name+"_ib-"+e.toString()}getNodeAtIndex(t,e){if(this.inboundNodes.length===0)throw new Jo(`The layer has never been called and thus has no defined ${e}.`);if(this.inboundNodes.length<=t)throw new J(`Asked to get ${e} at node ${t}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[t]}getInputAt(t){return no(this.getNodeAtIndex(t,"input").inputTensors)}getOutputAt(t){return no(this.getNodeAtIndex(t,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new ys(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new ys(`Layer ${this.name} is not connected, no input to return.`);return no(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new ys(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new ys(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return no(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(t=>t())}get updates(){return this._updates}get built(){return this._built}set built(t){this._built=t}get trainable(){return this.trainable_}set trainable(t){this._trainableWeights.forEach(e=>e.trainable=t),this.trainable_=t}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(t=>t.trainable):[]}set trainableWeights(t){this._trainableWeights=t}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(t=>!t.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(t){this._nonTrainableWeights=t}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(t){let e=cn(t);if(this.inputSpec==null||this.inputSpec.length===0)return;let r=cn(this.inputSpec);if(e.length!==r.length)throw new J(`Layer ${this.name} expects ${r.length} inputs, but it received ${e.length} input tensors. Input received: ${t}`);for(let o=0;o<e.length;o++){let i=e[o],s=r[o];if(s==null)continue;let a=i.rank;if(s.ndim!=null&&a!==s.ndim)throw new J(`Input ${o} is incompatible with layer ${this.name}: expected ndim=${s.ndim}, found ndim=${a}`);if(s.maxNDim!=null&&a>s.maxNDim)throw new J(`Input ${o} is incompatible with layer ${this.name}: expected max_ndim=${s.maxNDim}, found ndim=${a}`);if(s.minNDim!=null&&a<s.minNDim)throw new J(`Input ${o} is incompatible with layer ${this.name}: expected min_ndim=${s.minNDim}, found ndim=${a}.`);if(s.dtype!=null&&i.dtype!==s.dtype)throw new J(`Input ${o} is incompatible with layer ${this.name} : expected dtype=${s.dtype}, found dtype=${i.dtype}.`);if(s.axes){let l=i.shape;for(let c in s.axes){let u=Number(c),d=s.axes[c],p=u>=0?l[u]:l[l.length+u];if(d!=null&&[d,null].indexOf(p)===-1)throw new J(`Input ${o} is incompatible with layer ${this.name}: expected axis ${u} of input shape to have value ${d} but got shape ${l}.`)}}if(s.shape!=null)for(let l=0;l<s.shape.length;++l){let c=s.shape[l],u=i.shape[l];if(c!=null&&u!=null&&c!==u)throw new J(`Input ${o} is incompatible with layer ${this.name}: expected shape=${s.shape}, found shape=${i.shape}.`)}}}call(t,e){return t}invokeCallHook(t,e){this._callHook!=null&&this._callHook(t,e)}setCallHook(t){this._callHook=t}clearCallHook(){this._callHook=null}apply(t,e){e=e||{},this.assertNotDisposed();let r=cn(t),o=sRe(t),i=aRe(t);if(o===i)throw new J("Arguments to apply() must be all SymbolicTensors or all Tensors");return Ol(this.name,()=>{if(!this.built){this.assertInputCompatibility(t);let s=[];for(let a of cn(t))s.push(a.shape);this.build(no(s)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&i&&(this._refCount=1)}if(this.assertInputCompatibility(t),i){let s=this.call(t,e);this.supportsMasking&&this.setMaskMetadata(t,s);let a=cn(s),l=[];for(let c of a)r.indexOf(c)!==-1&&(c=c.clone()),l.push(c);if(s=no(l),this.activityRegularizer!=null)throw new st("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return s}else{let s=oRe(t),a=this.computeOutputShape(s),l,c=iRe(t);if(this.warnOnIncompatibleInputShape(Array.isArray(t)?s[0]:s),a!=null&&a.length>0&&Array.isArray(a[0])?l=a.map((u,d)=>new $o(c,u,this,cn(t),e,this.name,d)):l=new $o(c,a,this,cn(t),e,this.name),this.addInboundNode(t,l,null,null,s,a,e),this._refCount++,this.activityRegularizer!=null)throw new st("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return l}})}warnOnIncompatibleInputShape(t){if(this.batchInputShape!=null)if(t.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(t)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let e=!1;this.batchInputShape.forEach((r,o)=>{r!=null&&t[o]!=null&&t[o]!==r&&(e=!0)}),e&&console.warn(`The shape of the input tensor (${JSON.stringify(t)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new ys(`The layer ${this.name} has never been called and thus has no defined output shape.`);let t=[];for(let e of this.inboundNodes){let r=JSON.stringify(e.outputShapes);t.indexOf(r)===-1&&t.push(r)}if(t.length===1){let e=this.inboundNodes[0].outputShapes;return Array.isArray(e)&&Array.isArray(e[0])&&e.length===1?e[0]:e}else throw new ys(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new Jo(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return Mx(this.weights)}build(t){this.built=!0}getWeights(t=!1){return Wb(t?this.trainableWeights:this.weights)}setWeights(t){Z(()=>{let e=this.weights;if(e.length!==t.length)throw new J(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${t.length}, but the layer was expecting ${e.length} weights. Provided weights: ${t}...`);if(e.length===0)return;let r=[],o=Wb(e);for(let i=0;i<o.length;++i){let s=o[i],a=e[i],l=t[i];if(!b.arraysEqual(s.shape,l.shape))throw new J(`Layer weight shape ${s.shape} not compatible with provided weight shape ${l.shape}`);r.push([a,l])}Px(r)})}addWeight(t,e,r,o,i,s,a,l){if(this._addedWeightNames.indexOf(t)!==-1)throw new J(`Duplicate weight name ${t} for layer ${this.name}`);this._addedWeightNames.push(t),r==null&&(r="float32"),this.fastWeightInitDuringBuild&&(o=l!=null?l():_n("zeros"));let c=o.apply(e,r),u=new Ub(c,r,t,s,a);return c.dispose(),i!=null&&this.addLoss(()=>i.apply(u.read())),s==null&&(s=!0),s?this._trainableWeights.push(u):this._nonTrainableWeights.push(u),u}setFastWeightInitDuringBuild(t){this.fastWeightInitDuringBuild=t}addLoss(t){t==null||Array.isArray(t)&&t.length===0||(t=cn(t),this._losses!==void 0&&this._losses!==null&&this.losses.push(...t))}computeOutputShape(t){return t}computeMask(t,e){if(!this.supportsMasking){if(e!=null)if(Array.isArray(e))e.forEach(r=>{if(r!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return e}setMaskMetadata(t,e,r){if(!this.supportsMasking)return;let o=this.computeMask(t,r),i=cn(e),s=cn(o);if(i.length!==s.length)throw new Error(`${this.name} outputs ${i.length} tensors but ${i.length} masks for those tensors`);for(let a=0;a<i.length;a++)i[a].kerasMask=s[a]}addInboundNode(t,e,r,o,i,s,a=null){let l=cn(t);e=cn(e),r=cn(r),o=cn(o),i=Ox(i),s=Ox(s);let c=[],u=[],d=[];for(let p of l)c.push(p.sourceLayer),u.push(p.nodeIndex),d.push(p.tensorIndex);new Ud({outboundLayer:this,inboundLayers:c,nodeIndices:u,tensorIndices:d,inputTensors:l,outputTensors:e,inputMasks:r,outputMasks:o,inputShapes:i,outputShapes:s},a);for(let p=0;p<e.length;p++)e[p].sourceLayer=this,e[p].nodeIndex=this.inboundNodes.length-1,e[p].tensorIndex=p}getConfig(){let t={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(t.batchInputShape=this.batchInputShape),this.dtype!=null&&(t.dtype=this.dtype),t}disposeWeights(){return this.weights.forEach(t=>t.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let t=0;return--this._refCount===0&&(t=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:t}}};function oRe(n){n=cn(n);let t=[];for(let e of n)t.push(e.shape);return no(t)}function iRe(n){return"float32"}function nL(n,t,e){if((t==null||e!=null&&e>0)&&(t=n.sourceLayer,e=n.nodeIndex),t.inboundNodes.length===0)return[n];{let r=t.inboundNodes[e];if(r.inboundLayers.length===0)return r.inputTensors;{let o=[];for(let i=0;i<r.inboundLayers.length;i++){let s=r.inputTensors[i],a=r.inboundLayers[i],l=r.nodeIndices[i],c=nL(s,a,l);for(let u of c)o.indexOf(u)===-1&&o.push(u)}return o}}}function sRe(n){let t=!0;for(let e of cn(n))if(!(e instanceof $o)){t=!1;break}return t}function aRe(n){let t=!0;for(let e of cn(n))if(e instanceof $o){t=!1;break}return t}var km=(()=>{class n extends at{constructor(e){if(super({dtype:e.dtype,name:e.name!=null?e.name:jf("input").toString()}),e.batchSize==null&&(e.batchSize=null),e.sparse==null&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,e.inputShape!=null&&e.batchInputShape!=null)throw new J("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let r=e.batchInputShape;if(r==null){if(e.inputShape==null)throw new J("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");r=[e.batchSize].concat(e.inputShape)}else if(e.batchSize!=null)throw new J("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");let o=e.dtype||"float32";this.batchInputShape=r,this.dtype=o,this.inputSpec=[{shape:r}];let i=new $o(this.dtype,this.batchInputShape,this,[],{},this.name);i.nodeIndex=0,i.tensorIndex=0,new Ud({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[i],outputTensors:[i],inputMasks:[null],outputMasks:[null],inputShapes:[r],outputShapes:[r]})}apply(e,r){throw new J(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}return n.className="InputLayer",n})();ge.registerClass(km);function rL(n){if(n.batchShape==null&&n.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(n.batchShape!=null&&n.shape!=null)throw new J("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let t=n.batchShape;n.shape!=null&&t==null&&(t=[null].concat(n.shape));let e=n.dtype;return e==null&&(e="float32"),new km({batchInputShape:t,name:n.name,dtype:e,sparse:n.sparse}).inboundNodes[0].outputTensors[0]}function lRe(n,t){if(n.dtype==null||n.dtype===t.dtype)return t;try{return me(t,n.dtype)}catch{throw new J(`The dtype of the feed (${t.dtype}) can not be cast to the dtype of the key '${n.name}' (${n.dtype}).`)}}var Tu=class n{constructor(t){if(this.id2Value={},this.id2Mask={},this.name2Id={},t instanceof n)for(let e in t.id2Value)this.id2Value[e]=t.id2Value[e],e in t.id2Mask&&(this.id2Mask[e]=t.id2Mask[e]);else{if(t==null)return;for(let e of t)this.add(e.key,e.value)}}add(t,e,r){if(this.id2Value[t.id]==null)this.id2Value[t.id]=lRe(t,e),this.name2Id[t.name]=t.id,r!=null&&(this.id2Mask[t.id]=r);else throw new J(`Duplicate key: name=${t.name}, id=${t.id}`);return this}addFeed(t){this.add(t.key,t.value)}hasKey(t){return this.id2Value[t.id]!=null}names(){return Object.keys(this.name2Id)}getValue(t){if(t instanceof $o){if(this.id2Value[t.id]==null)throw new J(`Nonexistent key: ${t.name}`);return this.id2Value[t.id]}else{let e=this.name2Id[t];if(e==null)throw new J(`Feed dict has no SymbolicTensor name: ${t}`);return this.id2Value[e]}}getMask(t){if(t instanceof $o){if(this.id2Value[t.id]==null)throw new J(`Nonexistent key: ${t.name}`);return this.id2Mask[t.id]}else{let e=this.name2Id[t];if(e==null)throw new J(`Feed dict has no SymbolicTensor name: ${t}`);return this.id2Mask[e]}}disposeMasks(){this.id2Mask!=null&&He(this.id2Mask)}},mE=new $b,gE=new $b;function v9(n){mE?.setMaxEntries(n),gE?.setMaxEntries(n)}function Nm(n,t,e,r){let o=e==null?!1:e.training,i=Array.isArray(n),s=i?n:[n],a=s.map(h=>h.name),l=[],c=t.names();for(let h of a)c.indexOf(h)!==-1?l.push(t.getValue(h)):l.push(null);r!=null&&(r.maxNumTensors=-1/0,r.minNumTensors=1/0);let u=a.join(",")+"|"+t.names().sort().join(","),d=mE.get(u),p;if(d==null){let h=cRe(s,t);d=h.sorted,p=h.recipientCounts,mE.put(u,d),gE.put(u,p)}p={},o||Object.assign(p,gE.get(u));let f=new Tu(t);for(let h=0;h<d.length;++h){if(r!=null){let V=Sb().numTensors;V>r.maxNumTensors&&(r.maxNumTensors=V),V<r.minNumTensors&&(r.minNumTensors=V)}let m=d[h],g=m.sourceLayer;if(g instanceof km)continue;let y=[],v=[],w=[],C=!1;for(let V of m.inputs){let W=f.getValue(V),K=f.getMask(V);y.push(W),v.push(K),K!=null&&(C=!0),o||(p[V.name]--,p[V.name]===0&&!t.hasKey(V)&&a.indexOf(V.name)===-1&&!W.isDisposed&&V.sourceLayer.stateful!==!0&&w.push(W))}C&&(e=e||{},e.mask=v[0]);let I=cn(g.apply(y,e)),A=null;g.supportsMasking&&(A=g.computeMask(y,v));let M=dRe(m),$=Array.isArray(M)?M:[M];for(let V=0;V<$.length;++V){f.hasKey($[V])||f.add($[V],I[V],Array.isArray(A)?A[0]:A);let W=a.indexOf($[V].name);W!==-1&&(l[W]=I[V])}o||He(w)}return f.disposeMasks(),i?l:l[0]}function cRe(n,t){b.assert(n!=null&&n.length>0,()=>"Expected at least one fetch, got none");let e=[],r={};if(n.length===1){let o=x9(n[0],t);e=o.sorted,r=o.recipientMap}else{let o=new Set;for(let i of n){let{sorted:s,recipientMap:a}=x9(i,t);for(let l of s)o.has(l.name)||(e.push(l),o.add(l.name));for(let l in a)r[l]==null&&(r[l]=new Set),a[l].forEach(c=>r[l].add(c))}}return{sorted:e,recipientCounts:uRe(r)}}function uRe(n){let t={};for(let e in n)t[e]=n[e].size;return t}function x9(n,t){let e=new Set,r=[],o={};for(let a of t.names())e.add(a);let i=[],s=[];for(i.push(n);i.length>0;){let a=i[i.length-1];if(e.has(a.name)){i.pop();continue}let l=s[s.length-1]===i.length-1;if(a.inputs.length===0||l)i.pop(),r.push(a),e.add(a.name),l&&s.pop();else{s.push(i.length-1);for(let c of a.inputs)o[c.name]==null&&(o[c.name]=new Set),o[c.name].add(a.name),!e.has(c.name)&&i.push(c)}}return{sorted:r,recipientMap:o}}function dRe(n){let t;if(n.sourceLayer.inboundNodes.length===1)t=n.sourceLayer.output;else{let e=null;for(let r=0;r<n.sourceLayer.inboundNodes.length;++r)for(let o of n.sourceLayer.inboundNodes[r].outputTensors)if(o.id===n.id){e=r;break}t=n.sourceLayer.getOutputAt(e)}return t}var pRe=q();pRe.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,v9);function oL(n,t){return Z(()=>wn(Pe(U(n,n),t,!0)))}var Am=class extends ge.Serializable{getConfig(){return{}}},C9=(()=>{class n extends Am{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return Z(()=>{let r=oL(e,this.axis),o=Pr(r,0,this.maxValue);return U(e,Se(o,ae(Nr(),r)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}return n.className="MaxNorm",n})();ge.registerClass(C9);var _9=(()=>{class n extends Am{constructor(e){super(),this.defaultAxis=0,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return Z(()=>Se(e,ae(Nr(),oL(e,this.axis))))}getConfig(){return{axis:this.axis}}}return n.className="UnitNorm",n})();ge.registerClass(_9);var S9=(()=>{class n extends Am{apply(e){return ho(e)}}return n.className="NonNeg",n})();ge.registerClass(S9);var I9=(()=>{class n extends Am{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=e.minValue!=null?e.minValue:this.defaultMinValue,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.rate=e.rate!=null?e.rate:this.defaultRate,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return Z(()=>{let r=oL(e,this.axis),o=ae(U(this.rate,Pr(r,this.minValue,this.maxValue)),U(1-this.rate,r));return U(e,Se(o,ae(Nr(),r)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}return n.className="MinMaxNorm",n})();ge.registerClass(I9);var b9={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function ar(n){return kx(n)}function w9(n,t={}){return Iu(n,ge.SerializationMap.getMap().classNameMap,t,"constraint")}function lr(n){if(n==null)return null;if(typeof n=="string"){let e={className:n in b9?b9[n]:n,config:{}};return w9(e)}else return n instanceof Am?n:w9(n)}function Wd(n){return B(this,null,function*(){if(n==null)return;let t=[],e=[],r=[];for(let o in n){let i=n[o];if(typeof i!="number"){let s=i;t.push(s.data()),e.push(o),r.push(s)}}if(t.length>0){let o=yield Promise.all(t);for(let i=0;i<o.length;++i)n[e[i]]=o[i][0];He(r)}})}function yE(n){if(n!=null)for(let t in n){let e=n[t];typeof e!="number"&&e.dispose()}}var mRe=125,qf=class{constructor(){this.validationData=null}setParams(t){this.params=t}onEpochBegin(t,e){return B(this,null,function*(){})}onEpochEnd(t,e){return B(this,null,function*(){})}onBatchBegin(t,e){return B(this,null,function*(){})}onBatchEnd(t,e){return B(this,null,function*(){})}onTrainBegin(t){return B(this,null,function*(){})}onTrainEnd(t){return B(this,null,function*(){})}setModel(t){}},xE=class{constructor(t,e=10){t==null&&(t=[]),this.callbacks=t,this.queueLength=e}append(t){this.callbacks.push(t)}setParams(t){for(let e of this.callbacks)e.setParams(t)}setModel(t){for(let e of this.callbacks)e.setModel(t)}onEpochBegin(t,e){return B(this,null,function*(){e==null&&(e={});for(let r of this.callbacks)yield r.onEpochBegin(t,e)})}onEpochEnd(t,e){return B(this,null,function*(){e==null&&(e={});for(let r of this.callbacks)yield r.onEpochEnd(t,e)})}onBatchBegin(t,e){return B(this,null,function*(){e==null&&(e={});for(let r of this.callbacks)yield r.onBatchBegin(t,e)})}onBatchEnd(t,e){return B(this,null,function*(){e==null&&(e={});for(let r of this.callbacks)yield r.onBatchEnd(t,e)})}onTrainBegin(t){return B(this,null,function*(){t==null&&(t={});for(let e of this.callbacks)yield e.onTrainBegin(t)})}onTrainEnd(t){return B(this,null,function*(){t==null&&(t={});for(let e of this.callbacks)yield e.onTrainEnd(t)})}},iL=class extends qf{constructor(){super()}onEpochBegin(t){return B(this,null,function*(){this.seen=0,this.totals={}})}onBatchEnd(t,e){return B(this,null,function*(){e==null&&(e={});let r=e.size==null?0:e.size;this.seen+=r;for(let o in e){let i=e[o];if(typeof i=="number")this.totals.hasOwnProperty(o)||(this.totals[o]=0),this.totals[o]=this.totals[o]+i*r;else{let s;o in this.totals?s=this.totals[o]:this.totals[o]=0;let a=Z(()=>ae(this.totals[o],U(i,r)));this.totals[o]=a,s?.dispose()}}})}onEpochEnd(t,e){return B(this,null,function*(){if(e!=null)for(let r of this.params.metrics)this.totals[r]!=null&&(typeof this.totals[r]=="number"?e[r]=this.totals[r]/this.seen:Z(()=>{let o=U(Se(1,this.seen),this.totals[r]);e[r]=o,this.totals[r].dispose(),Wn(e[r])}))})}},vE=class extends qf{onTrainBegin(t){return B(this,null,function*(){this.epoch=[],this.history={}})}onEpochEnd(t,e){return B(this,null,function*(){e==null&&(e={}),this.epoch.push(t);for(let r in e)this.history[r]==null&&(this.history[r]=[]),this.history[r].push(e[r])})}syncData(){return B(this,null,function*(){let t=[],e=[],r=[];for(let i in this.history){let s=this.history[i];for(let a=0;a<s.length;++a)if(typeof s[a]!="number"){let l=s[a];t.push(l.data()),e.push(i),r.push(a)}}let o=yield Promise.all(t);for(let i=0;i<o.length;++i)this.history[e[i]][r[i]].dispose(),this.history[e[i]][r[i]]=o[i][0]})}},bE=class extends qf{constructor(t,e){if(super(),this.currentEpoch=0,this.nowFunc=t.nowFunc,this.nextFrameFunc=t.nextFrameFunc||Lb,this.yieldEvery=e||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=mRe),this.yieldEvery==="never"&&t.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");b.isNumber(this.yieldEvery)&&(this.maybeWait=W7(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=t.onTrainBegin,this.trainEnd=t.onTrainEnd,this.epochBegin=t.onEpochBegin,this.epochEnd=t.onEpochEnd,this.batchBegin=t.onBatchBegin,this.batchEnd=t.onBatchEnd,this.yield=t.onYield}maybeWait(t,e,r){return B(this,null,function*(){let o=[];this.yield!=null&&(yield Wd(r),o.push(this.yield(t,e,r))),o.push(this.nextFrameFunc()),yield Promise.all(o)})}onEpochBegin(t,e){return B(this,null,function*(){this.currentEpoch=t,this.epochBegin!=null&&(yield Wd(e),yield this.epochBegin(t,e))})}onEpochEnd(t,e){return B(this,null,function*(){let r=[];this.epochEnd!=null&&(yield Wd(e),r.push(this.epochEnd(t,e))),this.yieldEvery==="epoch"&&r.push(this.nextFrameFunc()),yield Promise.all(r)})}onBatchBegin(t,e){return B(this,null,function*(){this.batchBegin!=null&&(yield Wd(e),yield this.batchBegin(t,e))})}onBatchEnd(t,e){return B(this,null,function*(){let r=[];this.batchEnd!=null&&(yield Wd(e),r.push(this.batchEnd(t,e))),this.yieldEvery==="batch"?r.push(this.nextFrameFunc()):b.isNumber(this.yieldEvery)&&r.push(this.maybeWait(this.currentEpoch,t,e)),yield Promise.all(r)})}onTrainBegin(t){return B(this,null,function*(){this.trainBegin!=null&&(yield Wd(t),yield this.trainBegin(t))})}onTrainEnd(t){return B(this,null,function*(){this.trainEnd!=null&&(yield Wd(t),yield this.trainEnd(t))})}};function wE(n,t){return n==null&&(n={}),n instanceof qf?[n]:Array.isArray(n)&&n[0]instanceof qf?n:cn(n).map(r=>new bE(r,t))}var E9=(()=>{class n{constructor(){}static registerCallbackConstructor(e,r){b.assert(e>=0&&Number.isInteger(e),()=>`Verbosity level is expected to be an integer >= 0, but got ${e}`),n.checkForDuplicate(r),n.constructors[e]==null&&(n.constructors[e]=[]),n.constructors[e].push(r)}static checkForDuplicate(e){for(let r in n.constructors)n.constructors[+r].forEach(i=>{if(i===e)throw new J("Duplicate callback constructor.")})}static clear(){n.constructors={}}static createCallbacks(e){let r=[];for(let o in n.constructors){let i=+o;e>=i&&r.push(...n.constructors[i])}return r.map(o=>new o)}}return n.constructors={},n})();function CE(n,t,e,r,o,i,s,a,l){let c=new vE,u=[new iL,...E9.createCallbacks(t)];n!=null&&u.push(...n),u.push(c);let d=new xE(u);return d.setParams({epochs:e,initialEpoch:r,samples:o,steps:i,batchSize:s,verbose:t,doValidation:a,metrics:l}),{callbackList:d,history:c}}function qi(n,t={},e=!1){return Iu(n,ge.SerializationMap.getMap().classNameMap,t,"layer",e)}function Gb(n,t){return Z(()=>{n.dtype!=="float32"&&(n=me(n,"float32"));let e=Pe(Dm(n),t,!0),r=Hs(e.shape,Nr()),o=wn(yi(e,r));return Se(n,o)})}function Rm(n,t){return Z(()=>Mn(Dm(Ie(t,n)),-1))}function Hb(n,t){return Z(()=>Mn(Bn(Ie(t,n)),-1))}function qb(n,t){return Z(()=>{let e=Ie(n,t),r=Pr(Bn(n),Nr(),Number.MAX_VALUE),o=Bn(Se(e,r));return U(100,Mn(o,-1))})}function gRe(n,t){return Z(()=>{let e=Pr(t,Nr(),Number.MAX_VALUE),r=eo(ae(1,e)),o=Pr(n,Nr(),Number.MAX_VALUE),i=eo(ae(1,o));return Mn(Dm(Ie(r,i)),-1)})}function yRe(n,t){return Z(()=>{let e=yi(0,Ie(1,U(n,t)));return Mn(Dm(e),-1)})}function xRe(n,t){return Z(()=>{let e=yi(0,Ie(1,U(n,t)));return Mn(e,-1)})}function vRe(n,t){return Z(()=>{let e=Pe(U(n,t),-1),r=Jr(U(Ie(1,n),t),-1);return yi(0,ae(1,Ie(r,e)))})}function bRe(n,t){return Z(()=>{let e=Math.log(2),r=Ie(t,n),o=Ie(ae(r,kl(U(-2,r))),e);return Mn(o,-1)})}function Om(n,t,e=!1){return Z(()=>{if(e)t=Bf(t);else{let r=Pe(t,t.shape.length-1,!0);t=Se(t,r)}return t=Pr(t,Nr(),1-Nr()),Dt(Pe(U(me(n,"float32"),eo(t)),t.shape.length-1))})}function Fx(n,t,e=!1){return Z(()=>{let r=me(Cu(e9(n)),"int32");t=Pr(t,Nr(),1-Nr());let o=t.shape,i=G(gm(r,o[o.length-1]),o);return Om(i,t,e)})}function wRe(n,t){if(!b.arraysEqual(n.shape,t.shape))throw new J(`logits and labels must have the same shape, but got shapes ${JSON.stringify(n.shape)} and ${JSON.stringify(t.shape)}`);return Z(()=>{let e=ho(t),r=Dt(Bn(t));return ae(Ie(e,U(t,n)),Mf(Gn(r)))})}function Lx(n,t){return Z(()=>{let e;return e=Pr(t,Nr(),1-Nr()),e=eo(Se(e,Ie(1,e))),Mn(wRe(n,e),-1)})}function CRe(n,t){return Z(()=>{let e=Pr(n,Nr(),1),r=Pr(t,Nr(),1);return Pe(U(n,eo(Se(e,r))),-1)})}function _Re(n,t){return Z(()=>{let e=eo(ae(Nr(),t));return Mn(Ie(t,U(n,e)),-1)})}function _E(n,t){return Z(()=>{let e=Gb(n,-1),r=Gb(t,-1),o=U(e,r);return Dt(Pe(o,-1))})}var jb={meanSquaredError:Rm,meanAbsoluteError:Hb,meanAbsolutePercentageError:qb,meanSquaredLogarithmicError:gRe,squaredHinge:yRe,hinge:xRe,categoricalHinge:vRe,logcosh:bRe,categoricalCrossentropy:Om,sparseCategoricalCrossentropy:Fx,binaryCrossentropy:Lx,kullbackLeiblerDivergence:CRe,poisson:_Re,cosineProximity:_E};function SE(n){if(typeof n=="string"){if(n in jb)return jb[n];let t=`Unknown loss ${n}`;throw n.toLowerCase().includes("softmaxcrossentropy")&&(t=`Unknown loss ${n}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new J(t)}else return n}function EE(n,t){return Z(()=>{let e=U(.5,Hr(t)),r=Lo(ir(t,e),n.dtype);return Mn(Po(n,r),-1)})}function TE(n,t){return Z(()=>Lo(Po(js(n,-1),js(t,-1)),"float32"))}function SRe(n,t){return Z(()=>me(Pe(Co(Po(n,1),Po(t,1))),"float32"))}function IRe(n,t){return Z(()=>me(Pe(Co(Po(n,0),Po(t,1))),"float32"))}function D9(n,t){return Z(()=>{let e=SRe(n,t),r=IRe(n,t),o=ae(e,r);return me(Rn(ir(o,0),Se(e,o),0),"float32")})}function sL(n,t){return Lx(n,t)}function aL(n,t){return n.rank===t.rank&&(n=qt(n,[n.rank-1])),t=js(t,-1),t.dtype!==n.dtype&&(t=me(t,n.dtype)),me(Po(n,t),"float32")}var ERe=Rm,TRe=Rm,DRe=Hb,kRe=Hb,NRe=qb,ARe=qb,DE=Om,RRe=_E,lL=Fx,IE={binaryAccuracy:EE,categoricalAccuracy:TE,precision:D9,categoricalCrossentropy:DE,sparseCategoricalCrossentropy:lL,mse:ERe,MSE:TRe,mae:DRe,MAE:kRe,mape:NRe,MAPE:ARe,cosine:RRe};function k9(n){if(typeof n=="string"&&n in IE)return IE[n];if(typeof n!="string"&&n!=null)return n;throw new J(`Unknown metric ${n}`)}function Kb(n){if(xs(n!==null,`Unknown LossOrMetricFn ${n}`),typeof n=="string")return n;{let t;for(let e of Object.keys(jb))if(jb[e]===n){t=e;break}if(t!==void 0)return t;for(let e of Object.keys(IE))if(IE[e]===n){t=e;break}return t!==void 0?t:n.name}}function A9(n){let t={Adagrad:()=>Em.adagrad(.01),Adadelta:()=>Em.adadelta(1,.95,Nr()),Adam:()=>Em.adam(.001,.9,.999,Nr()),Adamax:()=>Em.adamax(.002,.9,.999,Nr(),0),RMSProp:()=>Em.rmsprop(.001,.9,0,Nr()),SGD:()=>Em.sgd(.01)};if(t.adagrad=t.Adagrad,t.adadelta=t.Adadelta,t.adam=t.Adam,t.adamax=t.Adamax,t.rmsprop=t.RMSProp,t.sgd=t.SGD,n in t)return t[n]();throw new J(`Unknown Optimizer ${n}`)}function uL(n,t,e=!1){if(n==null||typeof n!="object"||Object.getPrototypeOf(n)!==Object.prototype||!cL(n))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(e){let r=JSON.stringify(n);r.length>1048576&&console.warn(`User-defined metadata of model "${t}" is too large in size (length=${r.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= 1048576.`)}}function cL(n){if(n===null)return!0;if(typeof n=="object")if(Object.getPrototypeOf(n)===Object.prototype){let t=Object.keys(n);for(let e of t)if(typeof e!="string"||!cL(n[e]))return!1;return!0}else if(Array.isArray(n)){for(let t of n)if(!cL(t))return!1;return!0}else return!1;else{let t=typeof n;return t==="string"||t==="number"||t==="boolean"}}function R9(n,t,e,r=console.log){let o=PRe(n),i=["Layer (type)","Input Shape","Output shape","Param #"];o?(t=t||90,e=e||[.32,.61,.89,1]):(t=t||115,e=e||[.24,.48,.7,.8,1]),e[e.length-1]<=1&&(e=e.map(u=>Math.floor(t*u)));let s;if(!o){i.push("Receives inputs"),s=[];for(let u in n.nodesByDepth)s.push(...n.nodesByDepth[u])}r("_".repeat(t)),kE(i,e,r),r("=".repeat(t));let a=n.layers;for(let u=0;u<a.length;++u)o?FRe(a[u],e,r):LRe(a[u],e,s,r),r((u===a.length-1?"=":"_").repeat(t));n.checkTrainableWeightsConsistency();let l=MRe(n),c=Mx(n.nonTrainableWeights);r(`Total params: ${l+c}`),r(`Trainable params: ${l}`),r(`Non-trainable params: ${c}`),r("_".repeat(t))}function MRe(n){let t;return n.collectedTrainableWeights!=null?t=Mx(n.collectedTrainableWeights):t=Mx(n.trainableWeights),t}function PRe(n){let t=!0,e=[],r=[];for(let o in n.nodesByDepth)e.push(n.nodesByDepth[o]);for(let o of e){if(o.length>1||o.length===1&&o[0].inboundLayers.length>1){t=!1;break}r.push(...o)}if(t)for(let o of n.layers){let i=!1;for(let s of o.inboundNodes)if(r.indexOf(s)!==-1)if(i){t=!1;break}else i=!0;if(!t)break}return t}function kE(n,t,e=console.log){let r="";for(let o=0;o<n.length;++o)o>0&&(r=r.slice(0,r.length-1)+" "),r+=n[o],r=r.slice(0,t[o]),r+=" ".repeat(t[o]-r.length);e(r)}function FRe(n,t,e){let r,o;try{o=n.inboundNodes.map(l=>JSON.stringify(l.inputShapes)).join(",")}catch{o="multiple"}try{r=JSON.stringify(n.outputShape)}catch{r="multiple"}let i=n.name,s=n.getClassName(),a=[`${i} (${s})`,o,r,n.countParams().toString()];kE(a,t,e)}function LRe(n,t,e,r){let o,i;try{i=n.inboundNodes.map(d=>JSON.stringify(d.inputShapes)).join(",")}catch{i="multiple"}try{o=JSON.stringify(n.outputShape)}catch{o="multiple"}let s=[];for(let d of n.inboundNodes)if(!(e!=null&&e.length>0&&e.indexOf(d)===-1))for(let p=0;p<d.inboundLayers.length;++p){let f=d.inboundLayers[p].name,h=d.nodeIndices[p],m=d.tensorIndices[p];s.push(`${f}[${h}][${m}]`)}let a=n.name,l=n.getClassName(),c=s.length===0?"":s[0],u=[`${a} (${l})`,i,o,n.countParams().toString(),c];kE(u,t,r);for(let d=1;d<s.length;++d)kE(["","","","",s[d]],t,r)}function O9(n,t,e){return(n==="inboundNodes"||n==="outputLayers"||n==="inputLayers")&&t===0&&typeof e=="string"}function Xb(n,t){if(n===null)return null;if(typeof n=="string")return Vd(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){let e=[],r=n.length;for(let o=0;o<r;++o){let i=n[o];O9(t,o,i)?e.push(i):e.push(Xb(i,t))}return e}else{let e={};for(let r of Object.keys(n)){let o=n[r];if(r==="name"&&typeof o=="string")e[r]=o;else{let i=Vd(r);e[i]=Xb(o,i)}}return e}}function NE(n,t){if(n==null)return null;if(typeof n=="string")return Qs(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){let e=[],r=n.length;for(let o=0;o<r;++o){let i=n[o];O9(t,o,i)?e.push(i):e.push(NE(i,t))}return e}else{let e={};for(let r of Object.keys(n)){let o=n[r],i=Qs(r);(r==="name"||r==="className")&&typeof o=="string"?e[i]=o:e[i]=NE(o,r)}return e}}var $x="4.22.0";var $Re=n=>{let t=Object.keys(n);if(t.length===0)return!1;let e=t[0].split("/");return!isNaN(parseInt(e[e.length-1],10))},AE=class n extends at{constructor(t){if(super({}),this.containerNodes=new Set,this.name=t.name,this.name==null){let v=this.getClassName().toLowerCase();this.name=jf(v)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(t.inputs)?this.inputs=t.inputs.slice():this.inputs=[t.inputs],Array.isArray(t.outputs)?this.outputs=t.outputs.slice():this.outputs=[t.outputs],Js(this.inputs).length!==this.inputs.length)throw new J(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(v=>v.name)}`);Js(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(v=>v.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(let v of this.outputs){let w=v.sourceLayer,C=v.nodeIndex,I=v.tensorIndex;this.outputLayers.push(w),this.outputLayersNodeIndices.push(C),this.outputLayersTensorIndices.push(I)}for(let v of this.inputs){let w=v.sourceLayer,C=v.nodeIndex,I=v.tensorIndex;xs(C===0,"input layer has >1 nodes"),xs(I===0,"input layer has >1 tensors"),this.inputLayers.push(w),this.inputLayersNodeIndices.push(C),this.inputLayersTensorIndices.push(I)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let v=0;v<this.inputLayers.length;v++){let w=this.inputLayers[v];if(!(w instanceof km))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${t.inputs}. Input ${v} (0-based) originates from layer type ${w.getClassName()}.`);this.inputNames.push(w.name),this.feedInputShapes.push(w.batchInputShape),this.feedInputNames.push(w.name)}for(let v of this.outputLayers)this.outputNames.push(v.name);this.internalInputShapes=this.inputs.map(v=>v.shape),this.internalOutputShapes=this.outputs.map(v=>v.shape);let e={},r={},o={},i={},s={},a=[],l=(v,w,C,I,A,M)=>{(I==null||A==null||M==null)&&(I=v.sourceLayer,A=v.nodeIndex,M=v.tensorIndex);let $=I.inboundNodes[A];if(C.indexOf($)!==-1)throw new Jo(`The tensor ${v.name} at layer "${I.name}" is part of a cycle.`);if(w.indexOf($)!==-1)return;this.containerNodes.add(n.nodeKey(I,A)),I.id in s||(s[I.id]=Object.keys(s).length),C.indexOf($)===-1&&C.push($);let V=$.inboundLayers.length;for(let W=0;W<V;W++){let K=$.inputTensors[W],te=$.inboundLayers[W],ee=$.nodeIndices[W],oe=$.tensorIndices[W];l(K,w,C,te,ee,oe)}for(w.push($);C.indexOf($)>=0;)C.splice(C.indexOf($),1);a.push($)},c=[],u=[];for(let v of this.outputs)l(v,c,u);let d=a.slice().reverse();for(let v of d){r[v.id]=v,v.id in e||(e[v.id]=0);let w=e[v.id],C=o[v.outboundLayer.id]==null?0:o[v.outboundLayer.id];w=Math.max(w,C),o[v.outboundLayer.id]=w,i[v.outboundLayer.id]=v.outboundLayer,e[v.id]=w;for(let I=0;I<v.inboundLayers.length;I++){let A=v.inboundLayers[I],M=v.nodeIndices[I],$=A.inboundNodes[M],V=e[$.id]==null?0:e[$.id];e[$.id]=Math.max(w+1,V),r[$.id]=$}}let p={};for(let v in e){let w=e[v];w in p||(p[w]=[]),p[w].push(r[v])}let f={};for(let v in o){let w=o[v];w in f||(f[w]=[]),f[w].push(i[v])}let h=Object.keys(f).map(v=>parseInt(v,10)).sort(Vb);this.layers=[];for(let v of h){let w=f[v];w.sort((C,I)=>{let A=s[C.id],M=s[I.id];return A<M?-1:A>M?1:0});for(let C of w)C instanceof n&&this.internalContainerRefs.push(C),this.layers.push(C)}this.layersByDepth=f,h=Object.keys(p).map(v=>parseInt(v,10)).sort(Vb);let m=this.inputs.slice(),g=[];for(let v of h)for(let w of p[v]){let C=w.outboundLayer;if(C!=null){for(let I of w.inputTensors)if(m.indexOf(I)===-1)throw new Jo(`Graph disconnected: cannot obtain value for tensor ${I} at layer "${C.name}". The following previous layers were accessed without issue: ${g}`);for(let I of w.outputTensors)m.push(I);g.push(C.name)}}this.nodesByDepth=p;let y=this.layers.map(v=>v.name);for(let v of y){let w=y.filter(C=>C===v).length;if(w!==1)throw new Jo(`The name "${v}" is used ${w} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(y))}this.outboundNodes=[],this.inboundNodes=[],new Ud({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(v=>null),outputMasks:this.outputs.map(v=>null),inputShapes:this.inputs.map(v=>v.shape),outputShapes:this.outputs.map(v=>v.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();let t={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(let e of this.layers)t.numDisposedVariables+=e.dispose().numDisposedVariables;for(let e of this.internalContainerRefs)t.numDisposedVariables+=e.dispose().numDisposedVariables}return t.refCountAfterDispose=this._refCount,t}get trainable(){return this.trainable_}set trainable(t){this.layers.forEach(e=>{e._trainableWeights.forEach(r=>r.trainable=t)}),this.trainable_=t}get trainableWeights(){if(this._trainableWeights.length>0)throw new J("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let t=[];for(let e of this.layers)t=t.concat(e.trainableWeights);return t}get nonTrainableWeights(){let t=[];for(let e of this.layers)t.push(...e.nonTrainableWeights);if(!this.trainable){let e=[];for(let r of this.layers)e.push(...r.trainableWeights);return e.concat(t)}return t}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(t,e=!0){let r={},o=0,i=$Re(t);i&&this.parseWeights(t);for(let a of this.layers)for(let[l,c]of a.weights.entries()){let u=i?`${c.name.split("/").slice(0,-1).join("/")+"/"}${l}`:c.originalName;if(r[u]!=null)throw new J(`Duplicate weight name: ${u}`);r[u]=c,o++}let s=[];for(let a in t){let l=a;if(r[a]==null){let c=a.split("/");l=c.slice(0,-2).concat([c[c.length-1]]).join("/")}if(r[l]!=null)s.push([r[l],t[a]]);else if(e)throw new J(`Provided weight data has no target variable: ${a}`);delete r[l]}if(e){let a=[];for(let l in r)a.push(l);if(a.length>0)throw new J(`${a.length} of ${o} weights are not set: ${a}`)}Px(s)}parseWeights(t){for(let e in Object.keys(t)){let r=e.split("/"),o=["vars","layer_checkpoint_dependencies"],i=r.map(s=>s.startsWith("_")?s.slice(1):s).filter(s=>!o.includes(s)).join("/");i!==e&&(t[i]=t[e],delete t[e])}}updatedConfig(){let t=this.getConfig(),e={};return e.className=this.getClassName(),e.config=t,e.kerasVersion=`tfjs-layers ${$x}`,e.backend="TensorFlow.js",e}toJSON(t,e=!0){let r=NE(this.updatedConfig());return e?JSON.stringify(r):r}call(t,e){return Z(()=>{t=cn(t);let r=new Tu;for(let o=0;o<this.inputs.length;++o)r.add(this.inputs[o],t[o]);return Nm(this.outputs,r,e)})}computeMask(t,e){return Z(()=>{t=cn(t);let r;return e==null?r=Zs(null,t.length):r=cn(e),this.runInternalGraph(t,r)[1]})}computeOutputShape(t){let e=Ox(t);if(e.length!==this.inputLayers.length)throw new J(`Invalid inputShape argument ${t}: model has ${this.inputLayers.length} tensor inputs.`);let r={};for(let a=0;a<e.length;a++){let l=this.inputLayers[a],c=e[a],u=l.name+"_0_0";r[u]=c}let o=Object.keys(this.nodesByDepth).map(a=>parseInt(a,10)).sort(Vb);if(o.length>1)for(let a of o){let l=this.nodesByDepth[a];for(let c of l){let u=c.outboundLayer;if(this.inputLayers.map(m=>m.id).indexOf(u.id)!==-1)continue;let d=[];for(let m=0;m<c.inboundLayers.length;m++){let g=c.inboundLayers[m],y=c.nodeIndices[m],v=c.tensorIndices[m],w=`${g.name}_${y}_${v}`,C=r[w];d.push(C)}let p=u.computeOutputShape(no(d)),f=Ox(p),h=u.inboundNodes.indexOf(c);for(let m=0;m<f.length;m++){let g=`${u.name}_${h}_${m}`;r[g]=f[m]}}}let i=[],s=[];for(let a=0;a<this.outputLayers.length;a++){let l=this.outputLayers[a],c=this.outputLayersNodeIndices[a],u=this.outputLayersTensorIndices[a],d=`${l.name}_${c}_${u}`;s.push(d)}for(let a=0;a<s.length;a++){let l=s[a];xs(l in r),i.push(r[l])}return no(i)}runInternalGraph(t,e){e==null&&(e=Zs(null,t.length));let r={};for(let l=0;l<this.inputs.length;++l){let c=this.inputs[l],u=t[l],d=e[l];r[c.id]=[u,d]}let o=Object.keys(this.nodesByDepth).map(l=>parseInt(l,10)).sort(Vb);for(let l of o){let c=this.nodesByDepth[l];for(let u of c){let d=u.outboundLayer,p=u.inputTensors,f=u.outputTensors,h=new Array;for(let m of p)m.id in r&&h.push(r[m.id]);if(h.length===p.length){let m={},g,y,v,w;if(u.callArgs!=null&&(m=u.callArgs),h.length===1){let[C,I]=h[0];m.mask==null&&(m.mask=I),v=cn(d.call(C,m)),w=cn(d.computeMask(C,I)),g=[C],y=[I]}else g=h.map(C=>C[0]),y=h.map(C=>C[1]),m.mask==null&&(m.mask=y),v=cn(d.call(g,m)),w=cn(d.computeMask(g,y));if(d.activityRegularizer)throw new st("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let C=0;C<f.length;++C){let I=f[C],A=v[C],M=w[C];r[I.id]=[A,M]}}}}let i=[],s=[],a=[];for(let l of this.outputs){xs(l.id in r,`Could not compute output ${l.name} : ${l.id}`);let[c,u]=r[l.id];a.push(c.shape),i.push(c),s.push(u)}return[i,s,a]}buildNodeConversionMap(t){let e={},r;for(let o of this.layers){r=o instanceof n?1:0;for(let i=0;i<o.inboundNodes.length;i++){let s=n.nodeKey(o,i);this.containerNodes.has(s)&&(e[s]=r,r+=1)}}return e}getLayer(t,e){if(e!=null)return this.findLayer(e);if(t==null)throw new J("Provide either a layer name or layer index");if(typeof t=="number")return this.findLayer(t);for(let r of this.layers)if(r.name===t)return r;throw new J(`No such layer: ${t}`)}findLayer(t){if(this.layers.length<=t)throw new J(`Was asked to retrieve layer at index ${t}, but model only has ${this.layers.length} layer(s).`);return this.layers[t]}calculateLosses(){return Z(()=>{let t=[];for(let e of this.layers)for(let r=0;r<e.inboundNodes.length;++r){let o=n.nodeKey(e,r);this.containerNodes.has(o)&&t.push(...e.calculateLosses())}return t})}getConfig(){let t={name:this.name},e=this.buildNodeConversionMap(this.layers),r=[];for(let s of this.layers){let a=s.getClassName(),l=s.getConfig(),c=[];for(let d=0;d<s.inboundNodes.length;d++){let p=s.inboundNodes[d],f=n.nodeKey(s,d),h={};if(this.containerNodes.has(f)){if(p.callArgs)try{JSON.stringify(p.callArgs),h=p.callArgs}catch{console.warn(`Layer ${s.name} was passed non-serializable keyword arguments: ${p.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),h={}}if(p.inboundLayers.length>0){let m=[];for(let g=0;g<p.inboundLayers.length;g++){let y=p.inboundLayers[g],v=p.nodeIndices[g],w=p.tensorIndices[g],C=n.nodeKey(y,v),I=e[C];I==null&&(I=0),m.push([y.name,I,w,h])}c.push(m)}}}let u={};u.name=s.name,u.className=a,u.config=l,u.inboundNodes=c,r.push(u)}t.layers=r;let o=[];for(let s=0;s<this.inputLayers.length;s++){let a=this.inputLayers[s],l=this.inputLayersNodeIndices[s],c=n.nodeKey(a,l);if(!this.containerNodes.has(c))continue;let u=e[c];u==null&&(u=0);let d=this.inputLayersTensorIndices[s];o.push([a.name,u,d])}t.inputLayers=o;let i=[];for(let s=0;s<this.outputLayers.length;s++){let a=this.outputLayers[s],l=this.outputLayersNodeIndices[s],c=n.nodeKey(a,l);if(!this.containerNodes.has(c))continue;let u=e[c];u==null&&(u=0);let d=this.outputLayersTensorIndices[s];i.push([a.name,u,d])}return t.outputLayers=i,t}static fromConfig(t,e,r={},o=!1){let i={},s={};function a(g,y){g.name in s?s[g.name].push(y):s[g.name]=[y]}function l(g,y){let v=[],w;for(let C of y){let I=C[0],A=C[1],M=C[2];if(w=C[3]==null?{}:C[3],!(I in i)){a(g,y);return}let $=i[I];if($.inboundNodes.length<=A){a(g,y);return}let V=$.inboundNodes[A];v.push(V.outputTensors[M])}v.length>0&&g.apply(no(v),w)}function c(g){let y=g.name,v=qi(g,e.customObjects!=null?e.customObjects:{});v.setFastWeightInitDuringBuild(o),i[y]=v,g.inboundNodes.forEach(C=>{if(!(C instanceof Array))throw new J(`Corrupted configuration, expected array for nodeData: ${C}`);a(v,C)})}let u=e.name,d=e.layers;for(let g of d)c(g);for(;!z7(s);)for(let g of d){let y=i[g.name];if(y.name in s){let v=s[y.name];delete s[y.name];for(let w of v)l(y,w)}}let p=[],f=[],h=e.inputLayers;for(let g of h){let y=g[0],v=g[1],w=g[2];xs(y in i);let I=i[y].inboundNodes[v].outputTensors;p.push(I[w])}let m=e.outputLayers;for(let g of m){let y=g[0],v=g[1],w=g[2];xs(y in i);let I=i[y].inboundNodes[v].outputTensors;f.push(I[w])}return new t({inputs:p,outputs:f,name:u})}get stateful(){if(this._stateful)throw new J("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(let t of this.layers)if(t.stateful)return!0;return!1}resetStates(){Z(()=>{this.layers.forEach(t=>{t.stateful&&t.resetStates()})})}};function VRe(n,t,e){let r=t.length;if(n==null||Array.isArray(n)&&n.length===0)return t.map(o=>null);if(r===1)return Array.isArray(n)&&n.length===1?n:typeof n=="object"&&t[0]in n?[n[t[0]]]:[n];if(Array.isArray(n)){if(n.length!==r)throw new Error(`Provided ${e} is an array of ${n.length} element(s), but the model has ${r} outputs. Make sure a set of weights is provided for each model output.`);return n}else if(typeof n=="object"&&Object.keys(n).length>0&&typeof n[Object.keys(n)[0]]=="object"){let o=[];return t.forEach(i=>{i in n?o.push(n[i]):o.push(null)}),o}else throw new Error(`The model has multiple (${r}) outputs, so ${e} must be either an array with ${r} elements or an object with ${t} keys. Provided ${e} not understood: ${JSON.stringify(n)}`)}function RE(n,t){return VRe(n,t,"classWeight")}function OE(n,t,e,r){return B(this,null,function*(){if(t!=null||r!=null)throw new Error("Support sampleWeight is not implemented yet");if(e!=null){let o=Z(()=>{if(n.shape.length===1)return Yo(n);if(n.shape.length===2){if(n.shape[1]>1)return js(n,1);if(n.shape[1]===1)return G(n,[n.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${n.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${n.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),i=Array.from(yield o.data());He(o);let s=[];return i.forEach(a=>{if(e[a]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${a} exists in the data but not in classWeight`);s.push(e[a])}),Cn(s,"float32")}else return null})}function M9(n,t){return U(n,t)}var BRe=32;function L9(n,t){let e,r,o=t;e=o.xs,r=o.ys,b.assert(e!=null&&r!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${t}`);let i=P9("input",n.inputNames,e),s=P9("output",n.outputNames,r),a=i[0].shape[0];b.assert(i.length===n.inputs.length,()=>`LayersModel has ${n.inputs.length} inputs, but the dataset provides ${i.length} inputs.  (Expected input keys: ${JSON.stringify(n.inputNames)})`),b.assert(s.length===n.outputs.length,()=>`LayersModel has ${n.outputs.length} outputs, but the dataset provides ${s.length} outputs.  (Expected output keys: ${JSON.stringify(n.outputNames)})`);for(let l=0;l<i.length;l++)b.assert(i[l].shape[0]===a,()=>`Batch size mismatch: input ${n.inputNames[l]} has ${i[l].shape[0]}; expected  ${a} based on input ${n.inputNames[0]}.`);for(let l=0;l<s.length;l++)b.assert(s[l].shape[0]===a,()=>`Batch size mismatch: output ${n.outputNames[l]} has ${s[l].shape[0]}; expected  ${a} based on input ${n.inputNames[0]}.`);return{xs:i,ys:s}}function P9(n,t,e){if(e instanceof bt)return[e];if(Array.isArray(e))return b.assert(e.length===t.length,()=>`Received an array of ${e.length} Tensors, but expected ${t.length} to match the ${n} keys ${t}.`),e;{let r=[];for(let o of t){if(e[o]==null)throw new J(`The feature data generated by the dataset lacks the required ${n} key '${o}'.`);r.push(e[o])}return r}}function zRe(n){if(n.length===3)throw new st("Validation with sample weights is not implemented yet.");return{xs:n[0],ys:n[1]}}function $9(n,t,e){return B(this,null,function*(){let r=e.batchesPerEpoch!=null;if(b.assert(n.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),b.assert(e!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),b.assert(e.epochs!=null&&e.epochs>0&&Number.isInteger(e.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${e.epochs}`),b.assert(!r||e.batchesPerEpoch>0&&Number.isInteger(e.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${e.batchesPerEpoch}`),b.assert(e.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),n.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");n.isTraining=!0;try{let o=e.validationData!=null,i,s;if(o)if(F9(e.validationData))b.assert(e.validationBatches==null||e.validationBatches>0&&Number.isInteger(e.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${e.validationBatches}`);else{let g=zRe(e.validationData);i=g.xs,s=g.ys}let a=n.makeTrainFunction(),l=n.getDedupedMetricsNames(),c;o?c=l.slice().concat(l.map(g=>"val_"+g)):c=l.slice();let u=wE(e.callbacks,e.yieldEvery),d=e.verbose==null?1:e.verbose,{callbackList:p,history:f}=CE(u,d,e.epochs,null,null,URe(t,e),null,o,c);p.setModel(n),n.history=f,yield p.onTrainBegin(),n.stopTraining_=!1;let h=e.initialEpoch==null?0:e.initialEpoch,m=yield t.iterator();for(;h<e.epochs;){let g={};yield p.onEpochBegin(h);let y=0,v=0;for(r||(m=yield t.iterator());!r||y<e.batchesPerEpoch;){let w=yield m.next();if(r&&w.done){console.warn(`You provided \`batchesPerEpoch\` as ${e.batchesPerEpoch}, but your dataset iterator ran out of data after ${y} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${e.batchesPerEpoch*e.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(w.value!=null){let{xs:C,ys:I}=L9(n,w.value),A={};A.batch=v,A.size=C[0].shape[0],yield p.onBatchBegin(v,A);let M=[];if(e.classWeight!=null){let W=RE(e.classWeight,n.outputNames);for(let K=0;K<W.length;++K)M.push(yield OE(I[K],null,W[K]))}let $=C.concat(I).concat(M),V=a($);He($);for(let W=0;W<l.length;++W){let K=l[W],te=V[W];A[K]=te,Wn(te)}yield p.onBatchEnd(v,A),yE(A),v++,y++}if(r?y>=e.batchesPerEpoch:w.done){if(o){let C;F9(e.validationData)?C=cn(yield n.evaluateDataset(e.validationData,{batches:e.validationBatches})):C=cn(n.evaluate(i,s,{batchSize:e.validationBatchSize==null?BRe:e.validationBatchSize,verbose:0}));for(let I=0;I<n.metricsNames.length;++I)g[`val_${n.metricsNames[I]}`]=C[I]}break}if(n.stopTraining_)break}if(yield p.onEpochEnd(h,g),h++,n.stopTraining_)break}return yield p.onTrainEnd(),yield n.history.syncData(),n.history}finally{n.isTraining=!1}})}function URe(n,t){let e=null;return t.batchesPerEpoch!=null?e=t.batchesPerEpoch:Number.isFinite(n.size)&&(e=n.size),e}function F9(n){return typeof n.iterator=="function"}function WRe(n){return typeof n.next=="function"}function V9(n,t,e){return B(this,null,function*(){e=e||{};let r=e.batches!=null,o=n.testFunction,i=[];if(e.verbose>0)throw new st("Verbose mode is not implemented yet.");b.assert(!r||e.batches>0&&Number.isInteger(e.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(e.batches)}`);let s=WRe(t)?t:yield t.iterator(),a=0,l=0;for(;!r||l<e.batches;){let c=yield s.next();if(i=Z(()=>{if(c.value){let{xs:u,ys:d}=L9(n,c.value),p=u.concat(d),f=Z(()=>o(p));if(He(p),l===0)for(let m=0;m<f.length;++m)i.push(Ae(0));let h=p[0].shape[0];for(let m=0;m<f.length;++m){let g=f[m],y=i[m];i[m]=Z(()=>ae(i[m],U(h,g))),l>0&&He(y)}He(f),a+=h,++l}return i}),c.done){r&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${e.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let c=0;c<i.length;++c){let u=i[c];i[c]=Se(i[c],a),He(u)}return no(i)})}function ME(n){b.assert(n>0&&Number.isInteger(n),()=>`batchSize is required to be a positive integer, but got ${n}`)}function Vx(n,t,e){return n==null?[null]:Array.isArray(n)?n.map(r=>Bd(r,t,e-t)):Bd(n,t,e-t)}function PE(n,t){return Z(()=>n==null?null:Array.isArray(n)?n.map(e=>PE(e,t)):dE(n,t.dtype==="int32"?t:me(t,"int32")))}function FE(n,t){let e=[],r=0,o=null;for(;r<n;)o=r+t,o>=n&&(o=n),e.push([r,o]),r=o;return e}function dL(n){let t=[];n instanceof bt&&(n=[n]);for(let e=0;e<n.length;++e){let r=n[e];if(r.rank===1)t.push(zd(r,1));else{if(r.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");t.push(r)}}return t}function na(n,t){if(n==null)return;let e=[];if(t instanceof bt)e.push(t.id);else if(Array.isArray(t))t.forEach(o=>e.push(o.id));else if(t!=null)for(let o in t){let i=t[o];e.push(i.id)}let r=[];if(n instanceof bt)e.indexOf(n.id)===-1&&r.push(n);else if(Array.isArray(n))n.forEach(o=>{e.indexOf(o.id)===-1&&r.push(o)});else if(n!=null)for(let o in n){let i=n[o];e.indexOf(i.id)===-1&&r.push(i)}r.forEach(o=>{o.isDisposed||o.dispose()})}function GRe(n){return n instanceof bt}function pL(n){return Array.isArray(n)}function B9(n){return!GRe(n)&&!pL(n)}function z9(n,t,e,r=!0,o=""){if(t==null||t.length===0){if(n!=null){let s=!1;if(pL(n)&&n.length>0)s=!0;else if(B9(n)){for(let a in n)if(n.hasOwnProperty(a)){s=!0;break}}else s=!0;if(s)throw new J(`Error when checking model ${o} expected no data, but got ${n}`)}return[]}if(n==null)return t.map(s=>null);let i;if(B9(n)){n=n,i=[];for(let s of t){if(n[s]==null)throw new J(`No data provided for "${s}". Need data for each key in: ${t}`);i.push(n[s])}}else if(pL(n)){if(n=n,n.length!==t.length)throw new J(`Error when checking model ${o}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${t.length} Tensor(s), but instead got the following list of Tensor(s): ${n}`);i=n}else{if(n=n,t.length>1)throw new J(`The model ${o} expects ${t.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${n.shape}`);i=[n]}if(i=dL(i),e!=null)for(let s=0;s<t.length;++s){if(e[s]==null)continue;let a=i[s];if(a.shape.length!==e[s].length)throw new J(`Error when checking ${o}: expected ${t[s]} to have ${e[s].length} dimension(s). but got array with shape ${a.shape}`);for(let l=0;l<e[s].length;++l){if(l===0&&!r)continue;let c=a.shape[l],u=e[s][l];if(u!=null&&u>=0&&c!==u)throw new J(`${o} expected a batch of elements where each example has shape [${e[s].slice(1,e[s].length)}] (i.e.,tensor shape [*,${e[s].slice(1,e[s].length)}]) but the ${o} received an input with ${a.shape[0]} examples, each with shape [${a.shape.slice(1,a.shape.length)}] (tensor shape [${a.shape}])`)}}return i}function jRe(n,t,e){let r=Js(n.map(i=>i.shape[0]));r.sort();let o=Js(t.map(i=>i.shape[0]));if(o.sort(),r.length>1)throw new J(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(n.map(i=>i.shape))}`);if(o.length>1)throw new J(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(t.map(i=>i.shape))}`);if(r.length>0&&o.length>0&&!b.arraysEqual(r,o))throw new J(`Input Tensors should have the same number of samples as target Tensors. Found ${r[0]} input sample(s) and ${o[0]} target sample(s).`)}function HRe(n,t,e){let r=[Rm,Lx,Om];for(let o=0;o<n.length;++o){let i=n[o],s=t[o],a=e[o];if(s!=null){if(s===Om&&i.shape[i.shape.length-1]===1)throw new J(`You are passing a target array of shape ${i.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(r.indexOf(s)!==-1){let l=i.shape.slice(1),c=a.slice(1);for(let u=0;u<l.length;++u){let d=l[u],p=c[u];if(p!=null&&d!==p)throw new J(`A target Tensor with shape ${i.shape} was passed for an output of shape ${a}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function U9(n,t,e,r=!0,o=""){let i;if(Array.isArray(n)){if(n.length!==t.length)throw new J(`Error when checking model ${o}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${t.length} Tensor(s), but instead got ${n.length} Tensors(s).`);i=n}else{if(t.length>1)throw new J(`The model expects ${t.length} ${o} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(n.shape)}.`);i=[n]}if(e!=null)for(let s=0;s<t.length;++s){if(e[s]==null)continue;let a=i[s];if(a.shape.length!==e[s].length)throw new J(`Error when checking ${o}: expected ${t[s]} to have ${e[s].length} dimension(s), but got array with shape ${JSON.stringify(a.shape)}`);for(let l=0;l<e[s].length;++l){if(l===0&&!r)continue;let c=a.shape[l],u=e[s][l];if(u!=null&&u!==c)throw new J(`Error when checking ${o}: expected ${t[s]} to have shape ${JSON.stringify(e[s])} but got array with shape ${JSON.stringify(a.shape)}.`)}}}function qRe(n,t){if(n==null||Array.isArray(n)&&n.length===0)return t.map(r=>[]);let e;if(typeof n=="string"||typeof n=="function")e=[n];else if(Array.isArray(n)||typeof n=="object")e=n;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${n}`);if(Array.isArray(e))return t.map(r=>e);{let r=[];for(let o of t){let i=e.hasOwnProperty(o)?e[o]:[];Array.isArray(i)||(i=[i]),r.push(i)}return r}}var KRe="layers-model",Gd=(()=>{class n extends AE{constructor(e){super(e),this.isTraining=!1}summary(e,r,o=console.log){if(!this.built)throw new J("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");R9(this,e,r,o)}compile(e){if(e.loss==null&&(e.loss=[]),this.loss=e.loss,typeof e.optimizer=="string")this.optimizer_=A9(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof So))throw new J("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let r=[];if(!Array.isArray(e.loss)&&typeof e.loss!="string"&&typeof e.loss!="function"){e.loss=e.loss;for(let a in e.loss)if(this.outputNames.indexOf(a)===-1)throw new J(`Unknown entry in loss dictionary: "${a}". Only expected the following keys: ${this.outputNames}`);for(let a of this.outputNames)e.loss[a]==null&&console.warn(`Output "${a}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${a} during training`),r.push(SE(e.loss[a]))}else if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new J(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${e.loss}.`);r=e.loss.map(l=>SE(l))}else{let a=SE(e.loss);this.outputs.forEach(l=>{r.push(a)})}this.lossFunctions=r,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let a=0;a<this.outputs.length;++a){let l=this.internalOutputShapes[a],c=this.outputNames[a];this.feedOutputNames.push(c),this.feedOutputShapes.push(l),this.feedLossFns.push(this.lossFunctions[a])}let o=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],Ol("loss",()=>{for(let a=0;a<this.outputs.length;++a){if(o.indexOf(a)!==-1)continue;let l=this.lossFunctions[a];this.outputs.length>1&&(this.metricsTensors.push([l,a]),this.metricsNames.push(this.outputNames[a]+"_loss"))}});let i=qRe(e.metrics,this.outputNames),s=(a,l,c)=>{this.outputNames.length>1&&(l=this.outputNames[a]+"_"+l),this.metricsNames.push(l),this.metricsTensors.push([c,a])};Ol("metric",()=>{for(let a=0;a<this.outputs.length;++a){if(o.indexOf(a)!==-1)continue;let l=i[a];(u=>{let d="",p,f,h;for(let m of u){if(typeof m=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(m)!==-1){let y=this.internalOutputShapes[a];y[y.length-1]===1||this.lossFunctions[a]===Lx?["accuracy","acc"].indexOf(m)!==-1?f=EE:["crossentropy","ce"].indexOf(m)!==-1&&(f=sL):this.lossFunctions[a]===Fx?["accuracy","acc"].indexOf(m)!==-1?f=aL:["crossentropy","ce"].indexOf(m)!==-1&&(f=lL):["accuracy","acc"].indexOf(m)!==-1?f=TE:["crossentropy","ce"].indexOf(m)!==-1&&(f=DE);let v;["accuracy","acc"].indexOf(m)!==-1?v="acc":["crossentropy","ce"].indexOf(m)!==-1&&(v="ce"),h=f,p=d+v}else h=k9(m),p=d+Kb(m);let g;Ol(p,()=>{g=h}),s(a,p,g)}})(l)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,r,o={}){let i=o.batchSize==null?32:o.batchSize;ME(i);let a=this.standardizeUserDataXY(e,r,!0,i);try{let l=a[0].concat(a[1]);this.makeTestFunction();let c=this.testFunction,u=this.testLoop(c,l,i,o.verbose,o.steps);return no(u)}finally{na(a[0],e),na(a[1],r)}}evaluateDataset(e,r){return B(this,null,function*(){return this.makeTestFunction(),V9(this,e,r)})}checkNumSamples(e,r,o,i="steps"){let s;if(o!=null){if(s=null,r!=null)throw new J(`If ${i} is set, batchSize must be null or undefined.Got batchSize = ${r}`)}else if(e!=null)Array.isArray(e)?s=e[0].shape[0]:s=e.shape[0];else throw new J(`Either the input data should have a defined shape, or ${i} shoud be specified.`);return s}execute(e,r){if(Array.isArray(r)&&r.length===0)throw new J("`outputs` is an empty Array, which is not allowed.");let o=Array.isArray(r),i=o?r:[r],s=this.retrieveSymbolicTensors(i),a=new Tu;if(e instanceof bt&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new J(`The number of inputs provided (${e.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let c=0;c<this.inputs.length;++c)a.add(this.inputs[c],e[c])}else for(let c of this.inputs){let u=e[c.name];if(u==null)throw new J(`No value is provided for the model's input ${c.name}`);a.add(c,u)}let l=Nm(s,a);return o?l:l[0]}retrieveSymbolicTensors(e){let r=Zs(null,e.length),o=e.length;for(let i of this.layers){let s=Array.isArray(i.output)?i.output:[i.output],a=s.map(l=>l.name);for(let l=0;l<e.length;++l){let c=a.indexOf(e[l]);if(c!==-1&&(r[l]=s[c],o--),o===0)break}if(o===0)break}if(o>0){let i=[];throw r.forEach((s,a)=>{s==null&&i.push(e[a])}),new J(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(i)}`)}return r}predictLoop(e,r=32,o=!1){return Z(()=>{let i=this.checkNumSamples(e);if(o)throw new st("Verbose predictLoop() is not implemented yet.");let s=FE(i,r),a=this.outputs.map(l=>[]);for(let l=0;l<s.length;++l)Z(()=>{let u=s[l][0],d=s[l][1],p=Vx(e,u,d),f=[];if(Array.isArray(p))for(let m=0;m<p.length;++m)f.push({key:this.inputs[m],value:p[m]});else f.push({key:this.inputs[0],value:p});let h=new Tu(f);return Nm(this.outputs,h)}).forEach((u,d)=>a[d].push(u));return no(a.map(l=>Gt(l,0)))})}predict(e,r={}){let o=dL(e);U9(o,this.inputNames,this.feedInputShapes,!1);try{let i=r.batchSize==null?32:r.batchSize;return ME(i),this.predictLoop(o,i)}finally{na(o,e)}}predictOnBatch(e){U9(e,this.inputNames,this.feedInputShapes,!0);let r=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,r)}standardizeUserDataXY(e,r,o=!0,i){if(this.optimizer_==null)throw new Jo("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");let s=[];for(let a=0;a<this.feedOutputShapes.length;++a){let l=this.feedOutputShapes[a];this.feedLossFns[a]===Fx?s.push(l.slice(0,l.length-1).concat([1])):s.push(l)}if(e=z9(e,this.feedInputNames,this.feedInputShapes,!1,"input"),r=z9(r,this.feedOutputNames,s,!1,"target"),jRe(e,r,null),HRe(r,this.feedLossFns,this.feedOutputShapes),this.stateful&&i!=null&&i>0&&e[0].shape[0]%i!==0)throw new J(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${i}. Found: ${e[0].shape[0]} sample(s).`);return[e,r]}standardizeUserData(e,r,o,i,s=!0,a){return B(this,null,function*(){let[l,c]=this.standardizeUserDataXY(e,r,s,a);if(o!=null)throw new Error("sample weight is not supported yet.");let u=null;if(i!=null){let d=RE(i,this.outputNames);u=[];for(let p=0;p<d.length;++p)u.push(yield OE(c[p],null,d[p]))}return[l,c,u]})}testLoop(e,r,o,i=0,s){return Z(()=>{let a=this.checkNumSamples(r,o,s,"steps"),l=[];if(i>0)throw new st("Verbose mode is not implemented yet.");if(s!=null)throw new st("steps mode in testLoop() is not implemented yet");{let c=FE(a,o),u=Cn(ti(0,a));for(let d=0;d<c.length;++d){let p=c[d][0],f=c[d][1],h=Bd(u,p,f-p),m=PE(r,h),g=e(m);if(d===0)for(let y=0;y<g.length;++y)l.push(Ae(0));for(let y=0;y<g.length;++y){let v=g[y];l[y]=ae(l[y],U(f-p,v))}}for(let d=0;d<l.length;++d)l[d]=Se(l[d],a)}return l})}getDedupedMetricsNames(){let e=this.metricsNames,r=[];for(let o=0;o<e.length;++o){let i=e[o],s=i;if(GF(e,i)>1){let a=GF(e.slice(0,o),i);s+=`_${a}`}r.push(s)}return r}makeTrainFunction(){return e=>{let r=[],o=e.slice(0,this.inputs.length),i=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),s=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),a=[],l=()=>{let p=[];for(let g=0;g<this.inputs.length;++g)p.push({key:this.inputs[g],value:o[g]});let f=new Tu(p),h=Nm(this.outputs,f,{training:!0}),m;for(let g=0;g<this.lossFunctions.length;++g){let y=this.lossFunctions[g],v=y(i[g],h[g]);s[g]!=null&&(v=M9(v,s[g]));let w=Mn(v);r.push(w),g===0?m=v:m=ae(m,v)}for(let g=0;g<this.metricsTensors.length;++g){let y;if(this.outputs.length>1&&g<this.outputs.length)y=r[g];else{let v=this.metricsTensors[g][0],w=this.metricsTensors[g][1];y=Mn(v(i[w],h[w]))}Wn(y),a.push(y)}return m=Mn(m),this.calculateLosses().forEach(g=>{m=ae(m,g)}),m},c=this.collectedTrainableWeights.map(p=>p.read());return[this.optimizer_.minimize(l,!0,c)].concat(a)}}makeTestFunction(){this.testFunction=e=>Z(()=>{let r=[],o,i=e.slice(0,this.inputs.length),s=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),a=[];for(let u=0;u<this.inputs.length;++u)a.push({key:this.inputs[u],value:i[u]});let l=new Tu(a),c=Nm(this.outputs,l);for(let u=0;u<this.lossFunctions.length;++u){let d=this.lossFunctions[u],p=Mn(d(s[u],c[u]));u===0?o=p:o=ae(o,p),r.push(o)}for(let u=0;u<this.metricsTensors.length;++u){let d=this.metricsTensors[u][0],p=this.metricsTensors[u][1],f=Mn(d(s[p],c[p]));r.push(f)}return r})}fit(i,s){return B(this,arguments,function*(e,r,o={}){if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;let a,l,c,u,d,p,f,h,m;try{let g=o.batchSize==null?32:o.batchSize;ME(g);let v=yield this.standardizeUserData(e,r,o.sampleWeight,o.classWeight,!1,g);a=v[0],l=v[1],m=v[2];let w=!1,C;if(o.validationData!=null&&o.validationData.length>0){if(w=!0,o.validationData.length===2)d=o.validationData[0],p=o.validationData[1];else throw o.validationData.length===3?new st("validationData including sample weights is not supported yet."):new J(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${o.validationData} is invalid.`);let ee=yield this.standardizeUserData(d,p,null,null,!0,g);f=ee[0],h=ee[1],C=f.concat(h)}else if(o.validationSplit!=null&&o.validationSplit>0&&o.validationSplit<1){w=!0;let te=Math.floor(a[0].shape[0]*(1-o.validationSplit)),ee=a[0].shape[0];f=Vx(a,te,ee),c=a,a=Vx(a,0,te),h=Vx(l,te,ee),u=l,l=Vx(l,0,te),C=f.concat(h)}else o.validationSteps!=null&&(w=!0);let I=a.concat(l).concat(m);this.checkTrainableWeightsConsistency();let A=this.makeTrainFunction(),M=this.getDedupedMetricsNames(),$,V;w?(this.makeTestFunction(),$=this.testFunction,V=M.slice().concat(M.map(te=>"val_"+te))):($=null,C=[],V=M.slice());let W=wE(o.callbacks,o.yieldEvery);return yield this.fitLoop(A,I,M,g,o.epochs,o.verbose,W,$,C,o.shuffle,V,o.initialEpoch,null,null)}finally{this.isTraining=!1,na(a,e),na(l,r),na(c,e),na(u,r),na(f,d),na(h,p),m!=null&&He(m)}})}fitLoop(e,r,o,i,s,a,l,c,u,d,p,f,h,m){return B(this,null,function*(){i==null&&(i=32),s==null&&(s=1),d==null&&(d=!0),f==null&&(f=0);let g=!1;if(c!=null&&u!=null&&(g=!0),m!=null&&(g=!0,h==null))throw new J("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");let y=this.checkNumSamples(r,i,h,"steps_per_epoch"),v;y!=null&&(v=ti(0,y)),a==null&&(a=1);let{callbackList:w,history:C}=CE(l,a,s,f,y,h,i,g,p);w.setModel(this),this.history=C,yield w.onTrainBegin(),this.stopTraining_=!1;for(let I=f;I<s;++I){yield w.onEpochBegin(I);let A={};if(h!=null)throw new st("stepsPerEpoch mode is not implemented yet.");{if(d==="batch")throw new st("batch shuffling is not implemneted yet");d&&b.shuffle(v);let M=Cn(v),$=FE(y,i);for(let V=0;V<$.length;++V){let W={};if(yield w.onBatchBegin(V,W),Z(()=>{let K=$[V][0],te=$[V][1],ee=Bd(M,K,te-K);W.batch=V,W.size=te-K;let oe=PE(r,ee),ie=e(oe);for(let se=0;se<o.length;++se){let fe=o[se],ue=ie[se];W[fe]=ue,Wn(ue)}if(V===$.length-1&&g){let se=this.testLoop(c,u,i);for(let fe=0;fe<o.length;++fe){let ue=o[fe],ye=se[fe];Wn(ye),A["val_"+ue]=ye}}}),yield w.onBatchEnd(V,W),yE(W),this.stopTraining_)break}M.dispose()}if(yield w.onEpochEnd(I,A),this.stopTraining_)break}return yield w.onTrainEnd(),yield this.history.syncData(),this.history})}fitDataset(e,r){return B(this,null,function*(){return $9(this,e,r)})}trainOnBatch(e,r){return B(this,null,function*(){let o=yield this.standardizeUserData(e,r),i=o[0],s=o[1],l=this.makeTrainFunction()(i.concat(s)),c=[];for(let u of l){let d=yield u.data();c.push(d[0])}return He(l),na(o[0],e),na(o[1],r),no(c)})}getNamedWeights(e){let r=[],o=e!=null&&e.trainableOnly,i=o?this.trainableWeights:this.weights,s=this.getWeights(o);for(let a=0;a<i.length;++a)o&&!i[a].trainable||r.push({name:i[a].originalName,tensor:s[a]});return r}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){let e=super.dispose();if(e.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){let r=Sb().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=r-Sb().numTensors}return e}getLossIdentifiers(){let e;if(typeof this.loss=="string")e=Qs(this.loss);else if(Array.isArray(this.loss)){for(let r of this.loss)if(typeof r!="string")throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map(r=>Qs(r))}else{let r=Object.keys(this.loss);e={};let o=this.loss;for(let i of r)if(typeof o[i]=="string")e[i]=Qs(o[i]);else throw new Error("Serialization of non-string loss is not supported.")}return e}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[Qs(Kb(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(e=>Qs(Kb(e)));{let e={};for(let r in this.metrics)e[r]=Qs(Kb(this.metrics[r]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(e.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(e.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(e.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");let r=Xb(e.optimizer_config),o=qi(r),i;if(typeof e.loss=="string")i=Vd(e.loss);else if(Array.isArray(e.loss))i=e.loss.map(a=>Vd(a));else if(e.loss!=null){i={};for(let a in e.loss)i[a]=Vd(e.loss[a])}let s;if(Array.isArray(e.metrics))s=e.metrics.map(a=>Vd(a));else if(e.metrics!=null){s={};for(let a in e.metrics)s[a]=Vd(e.metrics[a])}this.compile({loss:i,metrics:s,optimizer:o})}save(e,r){return B(this,null,function*(){if(typeof e=="string"){let u=Al.getSaveHandlers(e);if(u.length===0)throw new J(`Cannot find any save handlers for URL '${e}'`);if(u.length>1)throw new J(`Found more than one (${u.length}) save handlers for URL '${e}'`);e=u[0]}if(e.save==null)throw new J("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");let o=yield Al.encodeWeights(this.getNamedWeights(r)),l={modelTopology:this.toJSON(null,!1),format:KRe,generatedBy:`TensorFlow.js tfjs-layers v${$x}`,convertedBy:null};if((r==null?!1:r.includeOptimizer)&&this.optimizer!=null){l.trainingConfig=this.getTrainingConfig();let u="optimizer",{data:d,specs:p}=yield Al.encodeWeights(yield this.optimizer.getWeights(),u);o.specs.push(...p),o.data=Al.concatenateArrayBuffers([o.data,d])}return this.userDefinedMetadata!=null&&(uL(this.userDefinedMetadata,this.name,!0),l.userDefinedMetadata=this.userDefinedMetadata),l.weightData=o.data,l.weightSpecs=o.specs,e.save(l)})}setUserDefinedMetadata(e){uL(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}}return n.className="Model",n})();ge.registerClass(Gd);var XRe=(()=>{class n extends Gd{}return n.className="Functional",n})();ge.registerClass(XRe);var fL=(()=>{class n extends Gd{constructor(e){if(super({inputs:[],outputs:[]}),e=e||{},this.trainable=!0,this.built=!1,this.name=e.name!=null?e.name:jf("sequential_"),e.layers!=null)for(let r of e.layers)this.add(r)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some(o=>o<0))throw new J(`Negative dimension size caused by adding layer ${e.name} with input shape [${e.inboundNodes[0].inputTensors[0].shape}]`)}add(e){let r=e instanceof n||e instanceof Gd,o;if(r){if(o=e,o.outputs.length!==1)throw new J("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(o.inputs.length!==1)throw new J("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(e.inboundNodes.length===0){if(e.batchInputShape==null)throw new J("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");let i=rL({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(i)}if(r)this.outputs=o.outputs,this.inputs=o.inputs;else{if(e.inboundNodes.length!==1)throw new J(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${e.name} which has ${e.inboundNodes.length} pre-existing inbound connections.`);if(e.inboundNodes[0].outputTensors.length!==1)throw new J("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=nL(this.outputs[0])}this.inboundNodes=[],new Ud({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:Zs(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(i=>i.shape),outputShapes:this.outputs[0].shape})}else{let i=e.apply(this.outputs[0]);if(Array.isArray(i))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[i],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{let e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,r){return this.model==null&&this.build(),this.model.call(e,r)}build(e){if(wt(e),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new Gd({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,r,o=console.log){this.built||this.build(),super.summary(e,r,o)}setWeights(e){this.model==null&&this.build(),this.model.setWeights(e)}evaluate(e,r,o={}){if(!this.built)throw new Jo("The model needs to be compiled before being used.");return this.model.evaluate(e,r,o)}evaluateDataset(e,r){return B(this,null,function*(){if(!this.built)throw new Jo("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,r)})}predict(e,r={}){return this.model==null&&this.build(),this.model.predict(e,r)}predictOnBatch(e){return this.model==null&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}fit(i,s){return B(this,arguments,function*(e,r,o={}){if(!this.built)throw new Jo("The model needs to be compiled before being used.");return this.model.fit(e,r,o)})}fitDataset(e,r){return B(this,null,function*(){if(!this.built)throw new Jo("The model needs to be compiled before being used.");return this.model.fitDataset(e,r)})}trainOnBatch(e,r){return B(this,null,function*(){return this.model.trainOnBatch(e,r)})}static fromConfig(e,r,o={},i=!1){let s,a={};if(r instanceof Array){if(r[0].className==null||r[0].className==="Merge")throw new J("Legacy serialization format not supported yet.");s=r}else b.assert(r.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),s=r.layers,delete r.layers,a=r;let l=new e(a);if(!(l instanceof n))throw new st(`Sequential.fromConfig called on non-Sequential input: ${l}`);for(let c of s){let d=qi(c,void 0,i);i&&d.setFastWeightInitDuringBuild(!0),l.add(d)}return l}set stopTraining(e){if(this.model==null)throw new J("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(this.model==null)throw new J("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){let e=[];for(let r of this.layers){let o={};o.className=r.getClassName(),o.config=r.getConfig(),e.push(o)}return{name:this.name,layers:e}}}return n.className="Sequential",n})();ge.registerClass(fL);var mo=class extends ge.Serializable{getConfig(){return{}}},ZRe=(()=>{class n extends mo{apply(e,r=1){return n9(e,r)}}return n.className="elu",n})();ge.registerClass(ZRe);var QRe=(()=>{class n extends mo{apply(e){return px(e)}}return n.className="selu",n})();ge.registerClass(QRe);var JRe=(()=>{class n extends mo{apply(e){return ho(e)}}return n.className="relu",n})();ge.registerClass(JRe);var eOe=(()=>{class n extends mo{apply(e){return Z(()=>xi(6,ho(e)))}}return n.className="relu6",n})();ge.registerClass(eOe);var tOe=(()=>{class n extends mo{apply(e){return e}}return n.className="linear",n})();ge.registerClass(tOe);var nOe=(()=>{class n extends mo{apply(e){return jr(e)}}return n.className="sigmoid",n})();ge.registerClass(nOe);var rOe=(()=>{class n extends mo{apply(e){return o9(e)}}return n.className="hardSigmoid",n})();ge.registerClass(rOe);var oOe=(()=>{class n extends mo{apply(e){return kl(e)}}return n.className="softplus",n})();ge.registerClass(oOe);var iOe=(()=>{class n extends mo{apply(e){return r9(e)}}return n.className="softsign",n})();ge.registerClass(iOe);var sOe=(()=>{class n extends mo{apply(e){return Dl(e)}}return n.className="tanh",n})();ge.registerClass(sOe);var mL=(()=>{class n extends mo{apply(e,r=-1){return Bf(e,r)}}return n.className="softmax",n})();ge.registerClass(mL);var aOe=(()=>{class n extends mo{apply(e,r=-1){return sx(e,r)}}return n.className="logSoftmax",n})();ge.registerClass(aOe);var lOe=(()=>{class n extends mo{apply(e){return Z(()=>Z(()=>{let r=Math.sqrt(2),o=U(.5,ae(1,ix(Se(e,r))));return U(e,o)}))}}return n.className="gelu",n})();ge.registerClass(lOe);var cOe=(()=>{class n extends mo{apply(e){return Z(()=>U(.5,U(e,ae(1,Dl(U(wn(Se(2,Math.PI)),ae(e,U(.044715,wo(e,3)))))))))}}return n.className="gelu_new",n})();ge.registerClass(cOe);var uOe=(()=>{class n extends mo{apply(e){return Z(()=>U(e,Dl(kl(e))))}}return n.className="mish",n})();ge.registerClass(uOe);var dOe=(()=>{class n extends mo{apply(e,r=1){return Z(()=>U(jr(U(e,r)),e))}}return n.className="swish",n})();ge.registerClass(dOe);function Pl(n){return n.getClassName()}function hL(n,t={}){return Iu(n,ge.SerializationMap.getMap().classNameMap,t,"activation")}function Fl(n){if(n==null){let t={};return t.className="linear",t.config={},hL(t)}if(typeof n=="string"){let t={};return t.className=n,t.config={},hL(t)}else return n instanceof mo?n:hL(n)}function pOe(n){if(n!=null&&typeof n!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${n}`)}var LE=class extends ge.Serializable{},j9=(()=>{class n extends LE{constructor(e){super(),pOe(e),this.l1=e==null||e.l1==null?.01:e.l1,this.l2=e==null||e.l2==null?.01:e.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(e){return Z(()=>{let r=hn([1]);return this.hasL1&&(r=ae(r,Pe(U(this.l1,Bn(e))))),this.hasL2&&(r=ae(r,Pe(U(this.l2,Dm(e))))),G(r,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,r){return new e({l1:r.l1,l2:r.l2})}}return n.className="L1L2",n})();ge.registerClass(j9);var W9={l1l2:"L1L2"};function mn(n){return kx(n)}function G9(n,t={}){return Iu(n,ge.SerializationMap.getMap().classNameMap,t,"regularizer")}function kn(n){if(n==null)return null;if(typeof n=="string"){let e={className:n in W9?W9[n]:n,config:{}};return G9(e)}else return n instanceof LE?n:G9(n)}var H9=(()=>{class n extends at{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null&&(this.maxValue=e.maxValue)}call(e,r){e=rt(e);let o=ho(e);return this.maxValue!=null&&(o=Pr(o,0,this.maxValue)),o}computeOutputShape(e){return e}getConfig(){let e={maxValue:this.maxValue},r=super.getConfig();return Object.assign(e,r),e}}return n.className="ReLU",n})();ge.registerClass(H9);var q9=(()=>{class n extends at{constructor(e){super(e??{}),this.DEFAULT_ALPHA=.3,e==null&&(e={}),this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,r){let o=rt(e);return Of(o,this.alpha)}computeOutputShape(e){return e}getConfig(){let e={alpha:this.alpha},r=super.getConfig();return Object.assign(e,r),e}}return n.className="LeakyReLU",n})();ge.registerClass(q9);var K9=(()=>{class n extends at{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",e==null&&(e={}),this.supportsMasking=!0,this.alphaInitializer=_n(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=kn(e.alphaRegularizer),this.alphaConstraint=lr(e.alphaConstraint),e.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else if(typeof e.sharedAxes=="number")this.sharedAxes=[e.sharedAxes];else throw new J(`Expected sharedAxes to be a number or an array of numbers, but got ${e.sharedAxes}`)}build(e){e=wt(e);let r=e.slice(1);if(this.sharedAxes!=null)for(let i of this.sharedAxes)r[i-1]=1;this.alpha=this.addWeight("alpha",r,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);let o={};if(this.sharedAxes!=null)for(let i=1;i<e.length;++i)o[i]=e[i];this.inputSpec=[new Dn({ndim:e.length,axes:o})],this.built=!0}call(e,r){return e=rt(e),Vf(e,this.alpha.read())}getConfig(){let e={alphaInitializer:Pn(this.alphaInitializer),alphaRegularizer:mn(this.alphaRegularizer),alphaConstraint:ar(this.alphaConstraint),sharedAxes:this.sharedAxes},r=super.getConfig();return Object.assign(e,r),e}}return n.className="PReLU",n})();ge.registerClass(K9);var X9=(()=>{class n extends at{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA=1,e==null&&(e={}),e.alpha!=null&&e.alpha!==this.DEFAULT_ALPHA)throw new st(`Non-default alpha value (${e.alpha}) is not supported by the ELU layer yet.`);this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,r){let o=rt(e);return wu(o)}computeOutputShape(e){return e}getConfig(){let e={alpha:this.alpha},r=super.getConfig();return Object.assign(e,r),e}}return n.className="ELU",n})();ge.registerClass(X9);var Y9=(()=>{class n extends at{constructor(e){super(e??{}),this.DEFAULT_THETA=1,e==null&&(e={}),this.theta=e.theta==null?this.DEFAULT_THETA:e.theta}call(e,r){let o=rt(e);return U(o,me(ir(o,this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){let e={theta:this.theta},r=super.getConfig();return Object.assign(e,r),e}}return n.className="ThresholdedReLU",n})();ge.registerClass(Y9);var Z9=(()=>{class n extends at{constructor(e){super(e??{}),this.DEFAULT_AXIS=1,e==null&&(e={}),this.softmax=new mL().apply,this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis}call(e,r){return Z(()=>{let o=rt(e),i=r.mask;if(i!=null){let s=U(Ie(Tr(o.shape),me(i,o.dtype)),Ae(-1e9));o=ae(o,s)}return this.axis instanceof Array?this.axis.length>1?Gn(Ie(o,Pf(o,this.axis,!0))):this.softmax(o,this.axis[0]):this.softmax(o,this.axis)})}computeOutputShape(e){return e}getConfig(){let e={axis:this.axis},r=super.getConfig();return Object.assign(e,r),e}}return n.className="Softmax",n})();ge.registerClass(Z9);function Kf(n,t,e){if(typeof n=="number")return Zs(n,t);if(n.length!==t)throw new J(`The ${e} argument must be an integer or tuple of ${t} integers. Received: ${n.length} elements.`);for(let r=0;r<t;++r){let o=n[r];if(!Q7(o))throw new J(`The ${e} argument must be an integer or tuple of ${t} integers. Received: ${JSON.stringify(n)} including a non-integer number ${o}`)}return n}function vi(n,t,e,r,o=1){if(n==null)return n;let i=t+(t-1)*(o-1),s;return e==="same"?s=n:s=n-i+1,Math.floor((s+r-1)/r)}function Ll(n,t,e,r){if(n==null)return null;if(r==="valid")n=n*t+Ml([e-t,0]);else if(r==="same")n=n*t;else throw new J(`Unsupport padding mode: ${r}.`);return n}function Zb(n,t){return Z(()=>(Xn(t),t==="channelsFirst"?St(n,[0,2,3,1]):n))}function gL(n,t){return Z(()=>(Xn(t),t==="channelsFirst"?St(n,[0,2,3,4,1]):n))}function hOe(n,t,e,r=1,o="valid",i,s=1){return Z(()=>{if(i==null&&(i=ni()),Xn(i),n.shape.length!==3)throw new J(`The input of a conv1dWithBias operation should be 3, but is ${n.shape.length} instead.`);if(t.shape.length!==3)throw new J(`The kernel for a conv1dWithBias operation should be 3, but is ${t.shape.length} instead`);if(e!=null&&e.shape.length!==1)throw new J(`The bias for a conv1dWithBias operation should be 1, but is ${e.shape.length} instead`);if(i==="channelsFirst"&&(n=St(n,[0,2,1])),o==="causal")throw new st("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let a=ex(n,t,r,o==="same"?"same":"valid","NWC",s);return e!=null&&(a=ri(a,e)),a})}function Q9(n,t,e,r=[1,1],o="valid",i,s,a=null){return Z(()=>{if(i==null&&(i=ni()),Xn(i),n.rank!==3&&n.rank!==4)throw new J(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${n.rank}.`);if(t.rank!==3&&t.rank!==4)throw new J(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${n.rank}.`);let l=Zb(n,i);if(o==="causal")throw new st("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return l=Wf.conv2d({x:l,filter:t,strides:r,pad:o==="same"?"same":"valid",dilations:s,dataFormat:"NHWC",bias:e,activation:a}),i==="channelsFirst"&&(l=St(l,[0,3,1,2])),l})}function mOe(n,t,e,r=[1,1,1],o="valid",i,s){return Z(()=>{if(i==null&&(i=ni()),Xn(i),n.rank!==4&&n.rank!==5)throw new J(`conv3dWithBias expects input to be of rank 4 or 5, but received ${n.rank}.`);if(t.rank!==4&&t.rank!==5)throw new J(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${n.rank}.`);let a=gL(n,i);if(o==="causal")throw new st("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return a=i1(a,t,r,o==="same"?"same":"valid","NDHWC",s),e!=null&&(a=ri(a,e)),i==="channelsFirst"&&(a=St(a,[0,4,1,2,3])),a})}var Yb=class n extends at{constructor(t,e){if(super(e),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",n.verifyArgs(e),this.rank=t,wr(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new st(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=Kf(e.kernelSize,t,"kernelSize"),this.strides=Kf(e.strides==null?1:e.strides,t,"strides"),this.padding=e.padding==null?"valid":e.padding,ei(this.padding),this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Xn(this.dataFormat),this.activation=Fl(e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.biasInitializer=_n(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=lr(e.biasConstraint),this.biasRegularizer=kn(e.biasRegularizer),this.activityRegularizer=kn(e.activityRegularizer),this.dilationRate=Kf(e.dilationRate==null?1:e.dilationRate,t,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new J(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new J(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new J(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(t){if(xs("kernelSize"in t,"required key 'kernelSize' not in config"),typeof t.kernelSize!="number"&&!rE(t.kernelSize,"number",1,3))throw new J(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(t.kernelSize)}.`)}getConfig(){let t={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:Pl(this.activation),useBias:this.useBias,biasInitializer:Pn(this.biasInitializer),biasRegularizer:mn(this.biasRegularizer),activityRegularizer:mn(this.activityRegularizer),biasConstraint:ar(this.biasConstraint)},e=super.getConfig();return Object.assign(t,e),t}},Bx=class n extends Yb{constructor(t,e){super(t,e),this.kernel=null,n.verifyArgs(e),this.filters=e.filters,wr(this.filters,"filters"),this.kernelInitializer=_n(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=lr(e.kernelConstraint),this.kernelRegularizer=kn(e.kernelRegularizer)}build(t){t=wt(t);let e=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[e]==null)throw new J(`The channel dimension of the input should be defined. Found ${t[e]}`);let r=t[e],o=this.kernelSize.concat([r,this.filters]);this.kernel=this.addWeight("kernel",o,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[e]:r}}],this.built=!0}call(t,e){return Z(()=>{t=rt(t);let r,o=this.bias==null?null:this.bias.read(),i=oE(this.activation.getClassName());if(i!=null&&this.rank===2)r=Q9(t,this.kernel.read(),o,this.strides,this.padding,this.dataFormat,this.dilationRate,i);else{if(this.rank===1)r=hOe(t,this.kernel.read(),o,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)r=Q9(t,this.kernel.read(),o,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)r=mOe(t,this.kernel.read(),o,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new st("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(r=this.activation.apply(r))}return r})}computeOutputShape(t){t=wt(t);let e=[],r=this.dataFormat==="channelsLast"?t.slice(1,t.length-1):t.slice(2);for(let i=0;i<r.length;++i){let s=vi(r[i],this.kernelSize[i],this.padding,this.strides[i],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[i]);e.push(s)}let o=[t[0]];return this.dataFormat==="channelsLast"?(o=o.concat(e),o.push(this.filters)):(o.push(this.filters),o=o.concat(e)),o}getConfig(){let t={filters:this.filters,kernelInitializer:Pn(this.kernelInitializer),kernelRegularizer:mn(this.kernelRegularizer),kernelConstraint:ar(this.kernelConstraint)},e=super.getConfig();return Object.assign(t,e),t}static verifyArgs(t){if(!("filters"in t)||typeof t.filters!="number"||t.filters<1)throw new J(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(t.filters)}`)}},yL=(()=>{class n extends Bx{constructor(e){super(2,e),n.verifyArgs(e)}getConfig(){let e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!rE(e.kernelSize,"number",1,2))throw new J(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(e.kernelSize)}.`)}}return n.className="Conv2D",n})();ge.registerClass(yL);var xL=(()=>{class n extends Bx{constructor(e){super(3,e),n.verifyArgs(e)}getConfig(){let e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!(Array.isArray(e.kernelSize)&&(e.kernelSize.length===1||e.kernelSize.length===3)))throw new J(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(e.kernelSize)}.`)}}return n.className="Conv3D",n})();ge.registerClass(xL);var J9=(()=>{class n extends yL{constructor(e){if(super(e),this.inputSpec=[new Dn({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new J(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=wt(e),e.length!==4)throw new J("Input should have rank 4; Received input shape: "+JSON.stringify(e));let r=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[r]==null)throw new J("The channel dimension of the inputs should be defined. Found `None`.");let o=e[r],i=this.kernelSize.concat([this.filters,o]);this.kernel=this.addWeight("kernel",i,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Dn({ndim:4,axes:{[r]:o}})],this.built=!0}call(e,r){return Z(()=>{let o=rt(e);if(o.shape.length!==4)throw new J(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${o.shape.length}`);let i=o.shape,s=i[0],a,l;this.dataFormat==="channelsFirst"?(a=2,l=3):(a=1,l=2);let c=i[a],u=i[l],d=this.kernelSize[0],p=this.kernelSize[1],f=this.strides[0],h=this.strides[1],m=Ll(c,f,d,this.padding),g=Ll(u,h,p,this.padding),y=[s,m,g,this.filters];this.dataFormat!=="channelsLast"&&(o=St(o,[0,2,3,1]));let v=nx(o,this.kernel.read(),y,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(v=St(v,[0,3,1,2])),this.bias!=null&&(v=ri(v,this.bias.read(),this.dataFormat)),this.activation!=null&&(v=this.activation.apply(v)),v})}computeOutputShape(e){e=wt(e);let r=e.slice(),o,i,s;this.dataFormat==="channelsFirst"?(o=1,i=2,s=3):(o=3,i=1,s=2);let a=this.kernelSize[0],l=this.kernelSize[1],c=this.strides[0],u=this.strides[1];return r[o]=this.filters,r[i]=Ll(r[i],c,a,this.padding),r[s]=Ll(r[s],u,l,this.padding),r}getConfig(){let e=super.getConfig();return delete e.dilationRate,e}}return n.className="Conv2DTranspose",n})();ge.registerClass(J9);var eX=(()=>{class n extends xL{constructor(e){if(super(e),this.inputSpec=[new Dn({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new J(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=wt(e),e.length!==5)throw new J("Input should have rank 5; Received input shape: "+JSON.stringify(e));let r=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[r]==null)throw new J("The channel dimension of the inputs should be defined. Found `None`.");let o=e[r],i=this.kernelSize.concat([this.filters,o]);this.kernel=this.addWeight("kernel",i,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Dn({ndim:5,axes:{[r]:o}})],this.built=!0}call(e,r){return Z(()=>{let o=rt(e);if(o.shape.length!==5)throw new J(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${o.shape.length}`);let i=o.shape,s=i[0],a,l,c;this.dataFormat==="channelsFirst"?(c=2,a=3,l=4):(c=1,a=2,l=3);let u=i[c],d=i[a],p=i[l],f=this.kernelSize[0],h=this.kernelSize[1],m=this.kernelSize[2],g=this.strides[0],y=this.strides[1],v=this.strides[2],w=Ll(u,g,f,this.padding),C=Ll(d,y,h,this.padding),I=Ll(p,v,m,this.padding),A=[s,w,C,I,this.filters];this.dataFormat!=="channelsLast"&&(o=St(o,[0,2,3,4,1]));let M=a1(o,this.kernel.read(),A,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(M=St(M,[0,4,1,2,3])),this.bias!==null&&(M=ri(M,this.bias.read(),this.dataFormat)),this.activation!==null&&(M=this.activation.apply(M)),M})}computeOutputShape(e){e=wt(e);let r=e.slice(),o,i,s,a;this.dataFormat==="channelsFirst"?(o=1,i=2,s=3,a=4):(o=4,i=1,s=2,a=3);let l=this.kernelSize[0],c=this.kernelSize[1],u=this.kernelSize[2],d=this.strides[0],p=this.strides[1],f=this.strides[2];return r[o]=this.filters,r[i]=Ll(r[i],d,l,this.padding),r[s]=Ll(r[s],p,c,this.padding),r[a]=Ll(r[a],f,u,this.padding),r}getConfig(){let e=super.getConfig();return delete e.dilationRate,e}}return n.className="Conv3DTranspose",n})();ge.registerClass(eX);var gOe=(()=>{class n extends Bx{constructor(e,r){if(super(e,r),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,r.filters==null)throw new J("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(r.kernelInitializer!=null||r.kernelRegularizer!=null||r.kernelConstraint!=null)throw new J("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(r.padding!=null&&r.padding!=="same"&&r.padding!=="valid")throw new J(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(r.padding)}`);this.depthMultiplier=r.depthMultiplier==null?1:r.depthMultiplier,this.depthwiseInitializer=_n(r.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=kn(r.depthwiseRegularizer),this.depthwiseConstraint=lr(r.depthwiseConstraint),this.pointwiseInitializer=_n(r.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=kn(r.pointwiseRegularizer),this.pointwiseConstraint=lr(r.pointwiseConstraint)}build(e){if(e=wt(e),e.length<this.rank+2)throw new J(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(e)}`);let r=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[r]==null||e[r]<0)throw new J(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(e[r])}`);let o=e[r],i=this.kernelSize.concat([o,this.depthMultiplier]),s=[];for(let l=0;l<this.rank;++l)s.push(1);s.push(o*this.depthMultiplier,this.filters);let a=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",i,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,a,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",s,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,a,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,a,this.biasConstraint):this.bias=null,this.inputSpec=[new Dn({ndim:this.rank+2,axes:{[r]:o}})],this.built=!0}call(e,r){return Z(()=>{e=rt(e);let o;if(this.rank===1)throw new st("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(e=St(e,[0,2,3,1])),o=fx(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(o=ri(o,this.bias.read(),this.dataFormat)),this.activation!=null&&(o=this.activation.apply(o)),this.dataFormat==="channelsFirst"&&(o=St(o,[0,3,1,2])),o})}getConfig(){let e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=Pn(this.depthwiseInitializer),e.pointwiseInitializer=Pn(this.pointwiseInitializer),e.depthwiseRegularizer=mn(this.depthwiseRegularizer),e.pointwiseRegularizer=mn(this.pointwiseRegularizer),e.depthwiseConstraint=ar(this.depthwiseConstraint),e.pointwiseConstraint=ar(this.pointwiseConstraint),e}}return n.className="SeparableConv",n})();var tX=(()=>{class n extends gOe{constructor(e){super(2,e)}}return n.className="SeparableConv2D",n})();ge.registerClass(tX);var nX=(()=>{class n extends Bx{constructor(e){super(1,e),n.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){let e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!rE(e.kernelSize,"number",1,1))throw new J(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(e.kernelSize)}.`)}}return n.className="Conv1D",n})();ge.registerClass(nX);var rX=(()=>{class n extends at{constructor(e){super(e),typeof e.cropping=="number"?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:typeof e.cropping[0]=="number"?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=e.dataFormat===void 0?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return this.dataFormat==="channelsFirst"?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,r){return Z(()=>{if(e=rt(e),this.dataFormat==="channelsLast"){let o=zb(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return zb(o,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{let o=zb(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return zb(o,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){let e={cropping:this.cropping,dataFormat:this.dataFormat},r=super.getConfig();return Object.assign(e,r),e}}return n.className="Cropping2D",n})();ge.registerClass(rX);var oX=(()=>{class n extends at{constructor(e){super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=e.size==null?this.DEFAULT_SIZE:e.size,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Xn(this.dataFormat),this.interpolation=e.interpolation==null?"nearest":e.interpolation,Y7(this.interpolation)}computeOutputShape(e){if(this.dataFormat==="channelsFirst"){let r=e[2]==null?null:this.size[0]*e[2],o=e[3]==null?null:this.size[1]*e[3];return[e[0],e[1],r,o]}else{let r=e[1]==null?null:this.size[0]*e[1],o=e[2]==null?null:this.size[1]*e[2];return[e[0],r,o,e[3]]}}call(e,r){return Z(()=>{let o=rt(e),i=o.shape;if(this.dataFormat==="channelsFirst"){o=St(o,[0,2,3,1]);let s=this.size[0]*i[2],a=this.size[1]*i[3],l=this.interpolation==="nearest"?kr.resizeNearestNeighbor(o,[s,a]):kr.resizeBilinear(o,[s,a]);return St(l,[0,3,1,2])}else{let s=this.size[0]*i[1],a=this.size[1]*i[2];return this.interpolation==="nearest"?kr.resizeNearestNeighbor(o,[s,a]):kr.resizeBilinear(o,[s,a])}})}getConfig(){let e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},r=super.getConfig();return Object.assign(e,r),e}}return n.className="UpSampling2D",n})();ge.registerClass(oX);function yOe(n,t,e=[1,1],r="valid",o,i){return Z(()=>{o==null&&(o=ni()),Xn(o);let s=Zb(n,o);if(n.rank!==4)throw new J(`Input for depthwiseConv2d is required to be 4-D, but is instead ${n.rank}-D`);if(t.rank!==4)throw new J(`depthwiseKernel is required to be 4-D, but is instead ${t.rank}-D`);return s=bu(s,t,e,r==="same"?"same":"valid","NHWC",i),o==="channelsFirst"&&(s=St(s,[0,3,1,2])),s})}var iX=(()=>{class n extends Yb{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=e.depthMultiplier==null?1:e.depthMultiplier,this.depthwiseInitializer=_n(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=lr(e.depthwiseConstraint),this.depthwiseRegularizer=kn(e.depthwiseRegularizer)}build(e){if(e=wt(e),e.length<4)throw new J(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(e)}.`);let r=this.dataFormat==="channelsFirst"?1:3;if(e[r]==null||e[r]<0)throw new J(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${e[r]}).`);let o=e[r],i=[this.kernelSize[0],this.kernelSize[1],o,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",i,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[o*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,r){return Z(()=>{e=rt(e);let o=yOe(e,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(o=ri(o,this.bias.read(),this.dataFormat)),this.activation!=null&&(o=this.activation.apply(o)),o})}computeOutputShape(e){e=wt(e);let r=this.dataFormat==="channelsFirst"?e[2]:e[1],o=this.dataFormat==="channelsFirst"?e[3]:e[2],i=this.dataFormat==="channelsFirst"?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,s=vi(r,this.kernelSize[0],this.padding,this.strides[0]),a=vi(o,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[e[0],i,s,a]:[e[0],s,a,i]}getConfig(){let e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=Pn(this.depthwiseInitializer),e.depthwiseRegularizer=mn(this.depthwiseRegularizer),e.depthwiseConstraint=ar(this.depthwiseRegularizer),e}}return n.className="DepthwiseConv2D",n})();ge.registerClass(iX);function vL(n,t,e,r){if(Array.isArray(n)){if(t!=null||e!=null)throw new J("When inputs is an array, neither initialState or constants should be provided");r!=null&&(e=n.slice(n.length-r,n.length),n=n.slice(0,n.length-r)),n.length>1&&(t=n.slice(1,n.length)),n=n[0]}function o(i){return i==null||Array.isArray(i)?i:[i]}return t=o(t),e=o(e),{inputs:n,initialState:t,constants:e}}function bL(n,t,e,r=!1,o,i,s=!1,a=!1){return Z(()=>{let l=t.shape.length;if(l<3)throw new J(`Input should be at least 3D, but is ${l}D.`);let c=[1,0].concat(ti(2,l));if(t=St(t,c),i!=null)throw new st("The rnn() functoin of the deeplearn.js backend does not support constants yet.");s&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),o!=null&&(o=me(me(o,"bool"),"float32"),o.rank===l-1&&(o=On(o,-1)),o=St(o,c)),r&&(t=Fr(t,0),o!=null&&(o=Fr(o,0)));let u=[],d,p=e,f=t.shape[0],h=$r(t),m;o!=null&&(m=$r(o));for(let y=0;y<f;++y){let v=h[y],w=Z(()=>n(v,p));if(o==null)d=w[0],p=w[1];else{let C=Z(()=>{let I=m[y],A=Ie(Hr(I),I),M=ae(U(w[0],I),U(p[0],A)),$=p.map((V,W)=>ae(U(w[1][W],I),U(V,A)));return{output:M,newStates:$}});d=C.output,p=C.newStates}a&&u.push(d)}let g;return a&&(g=sr(u,1)),[d,g,p]})}var Yf=(()=>{class n extends at{constructor(e){super(e);let r;if(e.cell==null)throw new J("cell property is missing for the constructor of RNN.");if(Array.isArray(e.cell)?r=new _L({cells:e.cell}):r=e.cell,r.stateSize==null)throw new J("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=r,this.returnSequences=e.returnSequences==null?!1:e.returnSequences,this.returnState=e.returnState==null?!1:e.returnState,this.goBackwards=e.goBackwards==null?!1:e.goBackwards,this._stateful=e.stateful==null?!1:e.stateful,this.unroll=e.unroll==null?!1:e.unroll,this.supportsMasking=!0,this.inputSpec=[new Dn({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){let e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return ti(0,e).map(r=>null)}else return this.states_}setStates(e){this.states_=e}computeOutputShape(e){hE(e)&&(e=e[0]),e=e;let r=this.cell.stateSize;Array.isArray(r)||(r=[r]);let o=r[0],i;if(this.returnSequences?i=[e[0],e[1],o]:i=[e[0],o],this.returnState){let s=[];for(let a of r)s.push([e[0],a]);return[i].concat(s)}else return i}computeMask(e,r){return Z(()=>{Array.isArray(r)&&(r=r[0]);let o=this.returnSequences?r:null;if(this.returnState){let i=this.states.map(s=>null);return[o].concat(i)}else return o})}get states(){if(this.states_==null){let e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,r=[];for(let o=0;o<e;++o)r.push(null);return r}else return this.states_}set states(e){this.states_=e}build(e){if(this.numConstants!=null)throw new st("Constants support is not implemented in RNN yet.");hE(e)&&(e=e[0]),e=e;let o=this.stateful?e[0]:null,i=e.slice(2);this.inputSpec[0]=new Dn({shape:[o,null,...i]});let s=[e[0]].concat(e.slice(2));this.cell.build(s);let a;if(Array.isArray(this.cell.stateSize)?a=this.cell.stateSize:a=[this.cell.stateSize],this.stateSpec!=null){if(!b.arraysEqual(this.stateSpec.map(l=>l.shape[l.shape.length-1]),a))throw new J(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=a.map(l=>new Dn({shape:[null,l]}));this.stateful&&this.resetStates()}resetStates(e,r=!1){Z(()=>{if(!this.stateful)throw new ys("Cannot call resetStates() on an RNN Layer that is not stateful.");let o=this.inputSpec[0].shape[0];if(o==null)throw new J("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(i=>hn([o,i])):this.states_=[hn([o,this.cell.stateSize])];else if(e==null)He(this.states_),this.keptStates!=null&&(He(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(i=>hn([o,i])):this.states_[0]=hn([o,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new J(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);r===!0?this.keptStates.push(this.states_.slice()):He(this.states_);for(let i=0;i<this.states_.length;++i){let s=e[i],a=Array.isArray(this.cell.stateSize)?this.cell.stateSize[i]:this.cell.stateSize,l=[o,a];if(!b.arraysEqual(s.shape,l))throw new J(`State ${i} is incompatible with layer ${this.name}: expected shape=${l}, received shape=${s.shape}`);this.states_[i]=s}}this.states_=this.states_.map(i=>Wn(i.clone()))})}apply(e,r){let o=r==null?null:r.initialState,i=r==null?null:r.constants;r==null&&(r={});let s=vL(e,o,i,this.numConstants);e=s.inputs,o=s.initialState,i=s.constants;let a=[],l=[];if(o!=null){r.initialState=o,a=a.concat(o),this.stateSpec=[];for(let u of o)this.stateSpec.push(new Dn({shape:u.shape}));l=l.concat(this.stateSpec)}if(i!=null&&(r.constants=i,a=a.concat(i),this.numConstants=i.length),a[0]instanceof $o){let u=[e].concat(a),d=this.inputSpec.concat(l),p=this.inputSpec;this.inputSpec=d;let f=super.apply(u,r);return this.inputSpec=p,f}else return super.apply(e,r)}call(e,r){return Z(()=>{let o=r==null?null:r.mask,i=r==null?null:r.training,s=r==null?null:r.initialState;e=rt(e),s==null&&(this.stateful?s=this.states_:s=this.getInitialState(e));let a=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(s.length!==a)throw new J(`RNN Layer has ${a} state(s) but was passed ${s.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");let l={training:i},u=bL((m,g)=>{let y=this.cell.call([m].concat(g),l);return[y[0],y.slice(1)]},e,s,this.goBackwards,o,null,this.unroll,this.returnSequences),d=u[0],p=u[1],f=u[2];this.stateful&&this.resetStates(f,i);let h=this.returnSequences?p:d;return this.returnState?[h].concat(f):h})}getInitialState(e){return Z(()=>{let r=hn(e.shape);return r=Pe(r,[1,2]),r=zd(r),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(o=>o>1?uE(r,[1,o]):r):this.cell.stateSize>1?[uE(r,[1,this.cell.stateSize])]:[r]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){let e=super.getConfig(),r={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(r.numConstants=this.numConstants);let o=this.cell.getConfig();return this.getClassName()===n.className&&(r.cell={className:this.cell.getClassName(),config:o}),Object.assign(Object.assign(Object.assign({},o),e),r)}static fromConfig(e,r,o={}){let i=r.cell,s=qi(i,o);return new e(Object.assign(r,{cell:s}))}}return n.className="RNN",n})();ge.registerClass(Yf);var Xf=class extends at{},wL=(()=>{class n extends Xf{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,wr(this.units,"units"),this.activation=Fl(e.activation==null?this.DEFAULT_ACTIVATION:e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=_n(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=_n(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=_n(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=kn(e.kernelRegularizer),this.recurrentRegularizer=kn(e.recurrentRegularizer),this.biasRegularizer=kn(e.biasRegularizer),this.kernelConstraint=lr(e.kernelConstraint),this.recurrentConstraint=lr(e.recurrentConstraint),this.biasConstraint=lr(e.biasConstraint),this.dropout=Tm([1,Ml([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=Tm([1,Ml([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=wt(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,r){return Z(()=>{if(e=e,e.length!==2)throw new J(`SimpleRNNCell expects 2 input Tensors, got ${e.length}.`);let o=e[1];e=e[0];let i=r.training==null?!1:r.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=jd({ones:()=>Hr(e),rate:this.dropout,training:i,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=jd({ones:()=>Hr(o),rate:this.recurrentDropout,training:i,dropoutFunc:this.dropoutFunc}));let s,a=this.dropoutMask,l=this.recurrentDropoutMask;a!=null?s=ta(U(e,a),this.kernel.read()):s=ta(e,this.kernel.read()),this.bias!=null&&(s=ri(s,this.bias.read())),l!=null&&(o=U(o,l));let c=ae(s,ta(o,this.recurrentKernel.read()));return this.activation!=null&&(c=this.activation.apply(c)),[c,c]})}getConfig(){let e=super.getConfig(),r={units:this.units,activation:Pl(this.activation),useBias:this.useBias,kernelInitializer:Pn(this.kernelInitializer),recurrentInitializer:Pn(this.recurrentInitializer),biasInitializer:Pn(this.biasInitializer),kernelRegularizer:mn(this.kernelRegularizer),recurrentRegularizer:mn(this.recurrentRegularizer),biasRegularizer:mn(this.biasRegularizer),activityRegularizer:mn(this.activityRegularizer),kernelConstraint:ar(this.kernelConstraint),recurrentConstraint:ar(this.recurrentConstraint),biasConstraint:ar(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},e),r)}}return n.className="SimpleRNNCell",n})();ge.registerClass(wL);var sX=(()=>{class n extends Yf{constructor(e){e.cell=new wL(e),super(e)}call(e,r){return Z(()=>{this.cell.dropoutMask!=null&&(He(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(He(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);let o=r==null?null:r.mask,i=r==null?null:r.training,s=r==null?null:r.initialState;return super.call(e,{mask:o,training:i,initialState:s})})}static fromConfig(e,r){return new e(r)}}return n.className="SimpleRNN",n})();ge.registerClass(sX);var CL=(()=>{class n extends Xf{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new J("GRUCell does not support reset_after parameter set to true.");this.units=e.units,wr(this.units,"units"),this.activation=Fl(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=Fl(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=_n(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=_n(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=_n(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=kn(e.kernelRegularizer),this.recurrentRegularizer=kn(e.recurrentRegularizer),this.biasRegularizer=kn(e.biasRegularizer),this.kernelConstraint=lr(e.kernelConstraint),this.recurrentConstraint=lr(e.recurrentConstraint),this.biasConstraint=lr(e.biasConstraint),this.dropout=Tm([1,Ml([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=Tm([1,Ml([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=wt(e);let r=e[e.length-1];this.kernel=this.addWeight("kernel",[r,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,r){return Z(()=>{if(e=e,e.length!==2)throw new J(`GRUCell expects 2 input Tensors (inputs, h, c), got ${e.length}.`);let o=r.training==null?!1:r.training,i=e[1];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=jd({ones:()=>Hr(e),rate:this.dropout,training:o,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=jd({ones:()=>Hr(i),rate:this.recurrentDropout,training:o,count:3,dropoutFunc:this.dropoutFunc}));let s=this.dropoutMask,a=this.recurrentDropoutMask,l,c,u;0<this.dropout&&this.dropout<1&&(e=U(e,s[0]));let d=ta(e,this.kernel.read());this.useBias&&(d=ri(d,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(i=U(i,a[0]));let p=this.recurrentKernel.read(),[f,h]=Lr(p,[2*this.units,this.units],p.rank-1),m=ta(i,f),[g,y,v]=Lr(d,3,d.rank-1),[w,C]=Lr(m,2,m.rank-1);l=this.recurrentActivation.apply(ae(g,w)),c=this.recurrentActivation.apply(ae(y,C));let I=ta(U(c,i),h);u=this.activation.apply(ae(v,I));let A=ae(U(l,i),U(ae(1,Dt(l)),u));return[A,A]})}getConfig(){let e=super.getConfig(),r={units:this.units,activation:Pl(this.activation),recurrentActivation:Pl(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Pn(this.kernelInitializer),recurrentInitializer:Pn(this.recurrentInitializer),biasInitializer:Pn(this.biasInitializer),kernelRegularizer:mn(this.kernelRegularizer),recurrentRegularizer:mn(this.recurrentRegularizer),biasRegularizer:mn(this.biasRegularizer),activityRegularizer:mn(this.activityRegularizer),kernelConstraint:ar(this.kernelConstraint),recurrentConstraint:ar(this.recurrentConstraint),biasConstraint:ar(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},e),r)}}return n.className="GRUCell",n})();ge.registerClass(CL);var aX=(()=>{class n extends Yf{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new CL(e),super(e)}call(e,r){return Z(()=>{this.cell.dropoutMask!=null&&(He(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(He(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);let o=r==null?null:r.mask,i=r==null?null:r.training,s=r==null?null:r.initialState;return super.call(e,{mask:o,training:i,initialState:s})})}static fromConfig(e,r){return r.implmentation===0&&(r.implementation=1),new e(r)}}return n.className="GRU",n})();ge.registerClass(aX);var Qb=(()=>{class n extends Xf{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,wr(this.units,"units"),this.activation=Fl(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=Fl(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=_n(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=_n(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=_n(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=kn(e.kernelRegularizer),this.recurrentRegularizer=kn(e.recurrentRegularizer),this.biasRegularizer=kn(e.biasRegularizer),this.kernelConstraint=lr(e.kernelConstraint),this.recurrentConstraint=lr(e.recurrentConstraint),this.biasConstraint=lr(e.biasConstraint),this.dropout=Tm([1,Ml([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=Tm([1,Ml([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var r;e=wt(e);let o=e[e.length-1];this.kernel=this.addWeight("kernel",[o,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let i;if(this.useBias){if(this.unitForgetBias){let s=this.biasInitializer,a=this.units;i=new(r=class extends oi{apply(c,u){let d=s.apply([a]),p=new fE().apply([a]),f=s.apply([a*2]);return XF(XF(d,p),f)}},r.className="CustomInit",r)}else i=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,i,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,r){return Z(()=>{let o=r.training==null?!1:r.training;if(e=e,e.length!==3)throw new J(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let i=e[1],s=e[2];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=jd({ones:()=>Hr(e),rate:this.dropout,training:o,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=jd({ones:()=>Hr(i),rate:this.recurrentDropout,training:o,count:4,dropoutFunc:this.dropoutFunc}));let a=this.dropoutMask,l=this.recurrentDropoutMask,c,u,d,p;0<this.dropout&&this.dropout<1&&(e=U(e,a[0]));let f=ta(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(i=U(i,l[0])),f=ae(f,ta(i,this.recurrentKernel.read())),this.useBias&&(f=ri(f,this.bias.read()));let[h,m,g,y]=Lr(f,4,f.rank-1);c=this.recurrentActivation.apply(h),u=this.recurrentActivation.apply(m),d=ae(U(u,s),U(c,this.activation.apply(g))),p=this.recurrentActivation.apply(y);let v=U(p,this.activation.apply(d));return[v,v,d]})}getConfig(){let e=super.getConfig(),r={units:this.units,activation:Pl(this.activation),recurrentActivation:Pl(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Pn(this.kernelInitializer),recurrentInitializer:Pn(this.recurrentInitializer),biasInitializer:Pn(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:mn(this.kernelRegularizer),recurrentRegularizer:mn(this.recurrentRegularizer),biasRegularizer:mn(this.biasRegularizer),activityRegularizer:mn(this.activityRegularizer),kernelConstraint:ar(this.kernelConstraint),recurrentConstraint:ar(this.recurrentConstraint),biasConstraint:ar(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},e),r)}}return n.className="LSTMCell",n})();ge.registerClass(Qb);var lX=(()=>{class n extends Yf{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new Qb(e),super(e)}call(e,r){return Z(()=>{this.cell.dropoutMask!=null&&(He(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(He(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);let o=r==null?null:r.mask,i=r==null?null:r.training,s=r==null?null:r.initialState;return super.call(e,{mask:o,training:i,initialState:s})})}static fromConfig(e,r){return r.implmentation===0&&(r.implementation=1),new e(r)}}return n.className="LSTM",n})();ge.registerClass(lX);var _L=(()=>{class n extends Xf{constructor(e){super(e),this.cells=e.cells}get stateSize(){let e=[];for(let r of this.cells.slice().reverse())Array.isArray(r.stateSize)?e.push(...r.stateSize):e.push(r.stateSize);return e}call(e,r){return Z(()=>{e=e;let o=e.slice(1),i=[];for(let l of this.cells.slice().reverse())Array.isArray(l.stateSize)?i.push(o.splice(0,l.stateSize.length)):i.push(o.splice(0,1));i.reverse();let s=[],a;for(let l=0;l<this.cells.length;++l){let c=this.cells[l];o=i[l],l===0?a=[e[0]].concat(o):a=[a[0]].concat(o),a=c.call(a,r),s.push(a.slice(1))}o=[];for(let l of s.slice().reverse())o.push(...l);return[a[0]].concat(o)})}build(e){hE(e)&&(e=e[0]),e=e;let r;this.cells.forEach((o,i)=>{Ol(`RNNCell_${i}`,()=>{o.build(e),Array.isArray(o.stateSize)?r=o.stateSize[0]:r=o.stateSize,e=[e[0],r]})}),this.built=!0}getConfig(){let e=super.getConfig(),r=s=>({className:s.getClassName(),config:s.getConfig()}),i={cells:this.cells.map(r)};return Object.assign(Object.assign({},e),i)}static fromConfig(e,r,o={}){let i=[];for(let s of r.cells)i.push(qi(s,o));return new e({cells:i})}get trainableWeights(){if(!this.trainable)return[];let e=[];for(let r of this.cells)e.push(...r.trainableWeights);return e}get nonTrainableWeights(){let e=[];for(let r of this.cells)e.push(...r.nonTrainableWeights);if(!this.trainable){let r=[];for(let o of this.cells)r.push(...o.trainableWeights);return r.concat(e)}return e}getWeights(){let e=[];for(let r of this.cells)e.push(...r.weights);return Wb(e)}setWeights(e){let r=[];for(let o of this.cells){let i=o.weights.length,s=e.splice(i);for(let a=0;a<o.weights.length;++a)r.push([o.weights[a],s[a]])}Px(r)}}return n.className="StackedRNNCells",n})();ge.registerClass(_L);function jd(n){let{ones:t,rate:e,training:r=!1,count:o=1,dropoutFunc:i}=n,s=()=>i!=null?i(t(),e):pE(t(),e),a=()=>Hf(s,t,r);return!o||o<=1?Wn(a().clone()):Array(o).fill(void 0).map(a).map(c=>Wn(c.clone()))}var xOe=function(n,t){var e={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.indexOf(r)<0&&(e[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(n);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(n,r[o])&&(e[r[o]]=n[r[o]]);return e};var vOe=(()=>{class n extends Yf{constructor(e){if(e.unroll)throw new st("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new st("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new Dn({ndim:5})]}call(e,r){return Z(()=>{if(this.cell.dropoutMask!=null&&(He(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(He(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),r&&r.constants)throw new J("ConvRNN2D cell does not support constants");let o=r==null?null:r.mask,i=r==null?null:r.training,s=r==null?null:r.initialState;return super.call(e,{mask:o,training:i,initialState:s})})}computeOutputShape(e){let r=this.computeSingleOutputShape(e);return this.returnSequences||(r=[r[0],...r.slice(2)]),this.returnState&&(r=[r,...Array(2).fill([e[0],...r.slice(-3)])]),r}getInitialState(e){return Z(()=>{let{stateSize:r}=this.cell,o=e.shape,i=this.computeSingleOutputShape(o),s=[i[0],...i.slice(2)],a=hn(s);return Array.isArray(r)?Array(r.length).fill(a):[a]})}resetStates(e,r=!1){Z(()=>{if(!this.stateful)throw new ys("Cannot call resetStates() on an RNN Layer that is not stateful.");let o=this.inputSpec[0].shape,i=this.computeSingleOutputShape(o),s=[i[0],...i.slice(2)];if(o[0]==null)throw new J("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>hn(s)):this.states_=[hn(s)];else if(e==null)He(this.states_),this.keptStates!=null&&(He(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>hn(s)):this.states_[0]=hn(s);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new J(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);r?this.keptStates.push(this.states_.slice()):He(this.states_);for(let l=0;l<this.states_.length;++l){let c=e[l],u=s;if(!b.arraysEqual(c.shape,u))throw new J(`State ${l} is incompatible with layer ${this.name}: expected shape=${u}, received shape=${c.shape}`);this.states_[l]=c}}this.states_=this.states_.map(l=>Wn(l.clone()))})}computeSingleOutputShape(e){let{dataFormat:r,filters:o,kernelSize:i,padding:s,strides:a,dilationRate:l}=this.cell,c=r==="channelsFirst",u=e[c?3:2],d=e[c?4:3],p=vi(u,i[0],s,a[0],l[0]),f=vi(d,i[1],s,a[1],l[1]);return[...e.slice(0,2),...c?[o,p,f]:[p,f,o]]}}return n.className="ConvRNN2D",n})(),SL=(()=>{class n extends Qb{constructor(e){let{filters:r,kernelSize:o,strides:i,padding:s,dataFormat:a,dilationRate:l}=e;super(Object.assign(Object.assign({},e),{units:r})),this.filters=r,wr(this.filters,"filters"),this.kernelSize=Kf(o,2,"kernelSize"),this.kernelSize.forEach(c=>wr(c,"kernelSize")),this.strides=Kf(i||1,2,"strides"),this.strides.forEach(c=>wr(c,"strides")),this.padding=s||"valid",ei(this.padding),this.dataFormat=a||"channelsLast",Xn(this.dataFormat),this.dilationRate=Kf(l||1,2,"dilationRate"),this.dilationRate.forEach(c=>wr(c,"dilationRate"))}build(e){var r;e=wt(e);let o=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[o]==null)throw new J(`The channel dimension of the input should be defined. Found ${e[o]}`);let i=e[o],s=4,a=this.kernelSize.concat([i,this.filters*s]);this.kernel=this.addWeight("kernel",a,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);let l=this.kernelSize.concat([this.filters,this.filters*s]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",l,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let c;if(this.unitForgetBias){let u=this.biasInitializer,d=this.filters;c=new(r=class extends oi{apply(f,h){let m=u.apply([d]),g=Tr([d]),y=u.apply([d*2]);return Ax([m,g,y])}},r.className="CustomInit",r)}else c=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*s],null,c,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,r){return Z(()=>{if(e.length!==3)throw new J(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let o=r.training||!1,i=e[0],s=e[1],a=e[2],l=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=jd({ones:()=>Hr(i),rate:this.dropout,training:o,count:l,dropoutFunc:this.dropoutFunc}));let c=this.dropoutMask,u=(De,Fe,Re)=>!Fe||!Fe[Re]?De:U(Fe[Re],De),d=u(i,c,0),p=u(i,c,1),f=u(i,c,2),h=u(i,c,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=jd({ones:()=>Hr(s),rate:this.recurrentDropout,training:o,count:l,dropoutFunc:this.dropoutFunc}));let m=this.recurrentDropoutMask,g=u(s,m,0),y=u(s,m,1),v=u(s,m,2),w=u(s,m,3),C=3,[I,A,M,$]=Lr(this.kernel.read(),l,C),[V,W,K,te]=this.useBias?Lr(this.bias.read(),l):[null,null,null,null];d=this.inputConv(d,I,V,this.padding),p=this.inputConv(p,A,W,this.padding),f=this.inputConv(f,M,K,this.padding),h=this.inputConv(h,$,te,this.padding);let[ee,oe,ie,se]=Lr(this.recurrentKernel.read(),l,C);g=this.recurrentConv(g,ee),y=this.recurrentConv(y,oe),v=this.recurrentConv(v,ie),w=this.recurrentConv(w,se);let fe=this.recurrentActivation.apply(ae(d,g)),ue=this.recurrentActivation.apply(ae(p,y)),ye=ae(U(ue,a),U(fe,this.activation.apply(ae(f,v)))),Te=U(this.recurrentActivation.apply(ae(h,w)),this.activation.apply(ye));return[Te,Te,ye]})}getConfig(){let e=super.getConfig(),{units:r}=e,o=xOe(e,["units"]),i={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},o),i)}inputConv(e,r,o,i){let s=mi(e,r,this.strides,i||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return o?ri(s,o,this.dataFormat):s}recurrentConv(e,r){return mi(e,r,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}}return n.className="ConvLSTM2DCell",n})();ge.registerClass(SL);var cX=(()=>{class n extends vOe{constructor(e){let r=new SL(e);super(Object.assign(Object.assign({},e),{cell:r}))}static fromConfig(e,r){return new e(r)}}return n.className="ConvLSTM2D",n})();ge.registerClass(cX);var IL=(()=>{class n extends at{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(this.noiseShape==null)return this.noiseShape;let r=e.shape,o=[];for(let i=0;i<this.noiseShape.length;++i)o.push(this.noiseShape[i]==null?r[i]:this.noiseShape[i]);return o}call(e,r){return Z(()=>{this.invokeCallHook(e,r);let o=rt(e);if(0<this.rate&&this.rate<1){let i=r.training==null?!1:r.training,s=this.getNoiseShape(o);return Hf(()=>pE(o,this.rate,s,this.seed),()=>o,i)}return e})}getConfig(){let e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},r=super.getConfig();return Object.assign(e,r),e}dispose(){return super.dispose()}}return n.className="Dropout",n})();ge.registerClass(IL);var uX=(()=>{class n extends IL{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){let r=e.shape;return[r[0],1,r[2]]}}return n.className="SpatialDropout1D",n})();ge.registerClass(uX);var dX=(()=>{class n extends at{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.batchInputShape==null&&e.inputShape==null&&e.inputDim!=null){let r=null;e.batchSize!=null&&(r=e.batchSize),this.batchInputShape=[r,e.inputDim]}this.units=e.units,wr(this.units,"units"),this.activation=Fl(e.activation),e.useBias!=null&&(this.useBias=e.useBias),this.kernelInitializer=_n(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=_n(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=lr(e.kernelConstraint),this.biasConstraint=lr(e.biasConstraint),this.kernelRegularizer=kn(e.kernelRegularizer),this.biasRegularizer=kn(e.biasRegularizer),this.activityRegularizer=kn(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){e=wt(e);let r=e[e.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[r,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:r}}],this.built=!0}computeOutputShape(e){e=wt(e);let r=e.slice();return r[r.length-1]=this.units,r}call(e,r){return Z(()=>{this.invokeCallHook(e,r);let o=rt(e),i=oE(this.activation.getClassName()),s;return i!=null?s=ta(o,this.kernel.read(),i,this.bias?this.bias.read():null):(s=ta(o,this.kernel.read()),this.bias!=null&&(s=ri(s,this.bias.read())),this.activation!=null&&(s=this.activation.apply(s))),s})}getConfig(){let e={units:this.units,activation:Pl(this.activation),useBias:this.useBias,kernelInitializer:Pn(this.kernelInitializer),biasInitializer:Pn(this.biasInitializer),kernelRegularizer:mn(this.kernelRegularizer),biasRegularizer:mn(this.biasRegularizer),activityRegularizer:mn(this.activityRegularizer),kernelConstraint:ar(this.kernelConstraint),biasConstraint:ar(this.biasConstraint)},r=super.getConfig();return Object.assign(e,r),e}}return n.className="Dense",n})();ge.registerClass(dX);var pX=(()=>{class n extends at{constructor(e){e=e||{},super(e),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=wt(e);for(let r of e.slice(1))if(r==null)throw new J(`The shape of the input to "Flatten" is not fully defined (got ${e.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[e[0],ea(e,1)]}call(e,r){return Z(()=>{this.invokeCallHook(e,r);let o=rt(e);if(this.dataFormat==="channelsFirst"&&o.rank>1){let i=[0];for(let s=2;s<o.rank;++s)i.push(s);i.push(1),o=St(o,i)}return t9(o)})}getConfig(){let e={};this.dataFormat!=null&&(e.dataFormat=this.dataFormat);let r=super.getConfig();return Object.assign(e,r),e}}return n.className="Flatten",n})();ge.registerClass(pX);var fX=(()=>{class n extends at{constructor(e){super(e),this.supportsMasking=!0,this.activation=Fl(e.activation)}call(e,r){return Z(()=>{this.invokeCallHook(e,r);let o=rt(e);return this.activation.apply(o)})}getConfig(){let e={activation:Pl(this.activation)},r=super.getConfig();return Object.assign(e,r),e}}return n.className="Activation",n})();ge.registerClass(fX);var hX=(()=>{class n extends at{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,r){return Z(()=>(e=rt(e),J7(e,this.n)))}getConfig(){let e={n:this.n},r=super.getConfig();return Object.assign(e,r),e}}return n.className="RepeatVector",n})();ge.registerClass(hX);var mX=(()=>{class n extends at{constructor(e){super(e),this.targetShape=e.targetShape;for(let r=0;r<this.targetShape.length;++r)this.isUnknown(this.targetShape[r])&&(this.targetShape[r]=null)}isUnknown(e){return e<0||e==null}fixUnknownDimension(e,r){let o="Total size of new array must be unchanged.",i=r.slice(),s=1,a=null;for(let c=0;c<i.length;++c){let u=i[c];if(this.isUnknown(u))if(a===null)a=c;else throw new J("Can only specifiy one unknown dimension.");else s*=u}let l=ea(e);if(a!==null){if(s===0||l%s!==0)throw new J(o);i[a]=l/s}else if(l!==s)throw new J(o);return i}computeOutputShape(e){let r=!1;for(let o=0;o<e.length;++o)if(this.isUnknown(e[o])){r=!0;break}return r?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,r){return Z(()=>{this.invokeCallHook(e,r);let o=rt(e),i=o.shape,s=i.slice(0,1).concat(this.fixUnknownDimension(i.slice(1),this.targetShape));return G(o,s)})}getConfig(){let e={targetShape:this.targetShape},r=super.getConfig();return Object.assign(e,r),e}}return n.className="Reshape",n})();ge.registerClass(mX);var gX=(()=>{class n extends at{constructor(e){if(super(e),e.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${e.dims} instead.`);let r=ti(1,e.dims.length+1);if(!b.arraysEqual(e.dims.slice().sort(),r))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new Dn({ndim:this.dims.length+1})]}computeOutputShape(e){e=wt(e);let r=e.slice();return this.dims.forEach((o,i)=>{r[i+1]=e[o]}),r}call(e,r){return St(rt(e),this.dimsIncludingBatch)}getConfig(){let e={dims:this.dims},r=super.getConfig();return Object.assign(e,r),e}}return n.className="Permute",n})();ge.registerClass(gX);var yX=(()=>{class n extends at{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null?this.maskValue=e.maskValue==null?0:e.maskValue:this.maskValue=0}computeOutputShape(e){return e}getConfig(){let e=super.getConfig(),r={maskValue:this.maskValue};return Object.assign(r,e),r}computeMask(e,r){let o=rt(e);return dm(Nl(o,this.maskValue),-1)}call(e,r){return Z(()=>{this.invokeCallHook(e,r);let o=rt(e),a=dm(Nl(o,this.maskValue),-1,!0);return U(o,me(a,o.dtype))})}}return n.className="Masking",n})();ge.registerClass(yX);var xX=(()=>{class n extends at{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",e.batchInputShape==null&&e.inputShape==null){let r=null;e.batchSize!=null&&(r=e.batchSize),e.inputLength==null?this.batchInputShape=[r,null]:this.batchInputShape=[r].concat(cn(e.inputLength))}this.inputDim=e.inputDim,wr(this.inputDim,"inputDim"),this.outputDim=e.outputDim,wr(this.outputDim,"outputDim"),this.embeddingsInitializer=_n(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=kn(e.embeddingsRegularizer),this.activityRegularizer=kn(e.activityRegularizer),this.embeddingsConstraint=lr(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,r){return Z(()=>this.maskZero?(e=rt(e),Nl(e,tt(e))):null)}computeOutputShape(e){if(e=wt(e),this.inputLength==null)return[...e,this.outputDim];let r=cn(this.inputLength);if(r.length!==e.length-1)throw new J(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);{let o=0;for(let i=0;i<r.length;++i){let s=r[i],a=e[i+1];if(s!=null&&a!=null&&s!==a)throw new J(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);s==null&&(r[o]=a),o++}}return[e[0],...r,this.outputDim]}call(e,r){return Z(()=>{this.invokeCallHook(e,r);let o=rt(e);o.dtype!=="int32"&&(o=Lo(o,"int32"));let i=dE(this.embeddings.read(),G(o,[o.size]));return G(i,wt(this.computeOutputShape(o.shape)))})}getConfig(){let e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:Pn(this.embeddingsInitializer),embeddingsRegularizer:mn(this.embeddingsRegularizer),activityRegularizer:mn(this.activityRegularizer),embeddingsConstraint:ar(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},r=super.getConfig();return Object.assign(e,r),e}}return n.className="Embedding",n})();ge.registerClass(xX);var Hd=class extends at{constructor(t){super(t||{}),this.supportsMasking=!0}mergeFunction(t){throw new st}computeElementwiseOpOutputShape(t,e){if(t==null||e==null)return null;if(t.length<e.length)return this.computeElementwiseOpOutputShape(e,t);if(e.length===0)return t;let r=t.slice(0,t.length-e.length);for(let o=0;o<e.length;++o){let i=t[t.length-e.length+o],s=e[o];if(i==null||s==null||i<0||s<0)r.push(null);else if(i===1)r.push(s);else if(s===1)r.push(i);else{if(i!==s)throw new J("Operands could not be broadcast together with shapes "+JSON.stringify(t)+" "+JSON.stringify(e));r.push(i)}}return r}build(t){if(Array.isArray(t)&&!Array.isArray(t[0])&&(t=[wt(t)]),t=t,t.length<2)throw new J(`A merge layer should be called on an Array of at least 2 inputs. Got ${t.length} input(s).`);let e=[];for(let i of t)i!=null&&i[0]!==null&&e.push(i[0]);if(e=Js(e),e.length>1)throw new J(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(t)}.`);let r=t[0]==null?null:t[0].slice(1);for(let i=1;i<t.length;++i){let s=t[i]==null?null:t[i].slice(1);r=this.computeElementwiseOpOutputShape(r,s)}let o=t.map(i=>i.length);t.indexOf(null)===-1&&Js(o).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(t,e){return Z(()=>{if(t=t,this.reshapeRequired){let r=[],o=t.map(i=>i.rank);if(o.indexOf(null)===-1){let i=Ml(o);for(let s of t){let a=s.rank;for(let l=0;l<i-a;++l)s=zd(s,1);r.push(s)}return this.mergeFunction(r)}else{let i=!1;for(let l of t){let c=l.rank;if(c==null){let u=l.shape,d=u[0],p=u.slice(1).concat([d]),f=G(l,[d].concat(ea(u.slice(1))));f=St(f,[1,0]),f=G(f,p),r.push(f),i=!0}else if(c>1){let u=ti(1,c).concat([0]);r.push(St(l,u)),i=!0}else r.push(l)}let s=this.mergeFunction(r),a=s.rank;if(i){if(a==null){let l=s.shape,c=l.length,u=l[c-1],d=[u].concat(l.slice(0,l.length-1));s=G(St(G(s,[-1,u]),[1,0]),d)}else if(a>1){let l=[a-1].concat(ti(0,a-1));s=St(s,l)}}return s}}else return this.mergeFunction(t)})}computeOutputShape(t){t=t;let e;t[0]==null?e=null:e=t[0].slice(1);for(let o=1;o<t.length;++o){let i=t[o]==null?null:t[o].slice(1);e=this.computeElementwiseOpOutputShape(e,i)}let r=[];for(let o of t)o!=null&&o[0]!==null&&r.push(o[0]);return r=Js(r),r.length===1?e=r.concat(e):e=[null].concat(e),e}computeMask(t,e){return Z(()=>{if(e==null)return null;if(!Array.isArray(e))throw new J("`mask` should be an Array");if(!Array.isArray(t))throw new J("`inputs` should be an Array");if(e.length!==t.length)throw new J(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${t.length} vs ${e.length})`);if(e.every(o=>o==null))return null;e=e.map(o=>o==null?o:On(o,0));let r=e[0];for(let o=1;o<e.length-1;++o)r=Co(r,e[o]);return r})}},vX=(()=>{class n extends Hd{constructor(e){super(e)}mergeFunction(e){return Z(()=>{let r=e[0].clone();for(let o=1;o<e.length;++o)r=ae(r,e[o]);return r})}}return n.className="Add",n})();ge.registerClass(vX);var bX=(()=>{class n extends Hd{constructor(e){super(e)}mergeFunction(e){return Z(()=>{let r=e[0].clone();for(let o=1;o<e.length;++o)r=U(r,e[o]);return r})}}return n.className="Multiply",n})();ge.registerClass(bX);var wX=(()=>{class n extends Hd{constructor(e){super(e)}mergeFunction(e){return Z(()=>{let r=e[0].clone();for(let o=1;o<e.length;++o)r=ae(r,e[o]);return U(1/e.length,r)})}}return n.className="Average",n})();ge.registerClass(wX);var CX=(()=>{class n extends Hd{constructor(e){super(e)}mergeFunction(e){return Z(()=>{let r=e[0];for(let o=1;o<e.length;++o)r=yi(r,e[o]);return r})}}return n.className="Maximum",n})();ge.registerClass(CX);var _X=(()=>{class n extends Hd{constructor(e){super(e)}mergeFunction(e){return Z(()=>{let r=e[0];for(let o=1;o<e.length;++o)r=xi(r,e[o]);return r})}}return n.className="Minimum",n})();ge.registerClass(_X);var SX=(()=>{class n extends Hd{constructor(e){super(e),this.DEFAULT_AXIS=-1,e==null&&(e={}),this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!(Array.isArray(e)&&Array.isArray(e[0]))||e.length===1)throw new J("A `Concatenate` layer should be called on a list of at least 2 inputs");e=e;let r=!0;for(let i of e)if(i!=null){r=!1;break}if(r)return;let o=[];for(let i=0;i<e.length;++i){let s=e[i].slice();s.splice(this.axis,1);let a=!1;for(let l of o)if(b.arraysEqual(l,s)){a=!0;break}a||o.push(s)}if(o.length>1)throw new J("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return Z(()=>Ax(e,this.axis))}computeOutputShape(e){if(!(Array.isArray(e)&&Array.isArray(e[0])))throw new J("A `Concatenate` layer should be called on a list of inputs.");let r=e,o=r[0].slice(),i=this.axis<0?o.length+this.axis:this.axis;for(let s of r.slice(1)){if(o[i]==null||s[i]==null){o[i]=null;break}o[i]+=s[i]}return o}computeMask(e,r){if(r==null)return null;if(!Array.isArray(r))throw new J("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new J("`inputs` should be an array for Concatenate");if(r.length!==e.length)throw new J(`Mismatch in the length of mask (${r.length}) and the legnth of inputs (${e.length})`);return Z(()=>{let o=!0;if(r.forEach(a=>{if(a!=null){o=!1;return}}),o)return null;let i=[];for(let a=0;a<e.length;++a)r[a]==null?i.push(me(Hr(e[a]),"bool")):r[a].rank<e[a].rank?i.push(On(r[a],-1)):i.push(r[a]);let s=Gt(i,this.axis);return Qy(s,-1,!1)})}getConfig(){let e={axis:this.axis},r=super.getConfig();return Object.assign(e,r),e}}return n.className="Concatenate",n})();ge.registerClass(SX);function Jb(n,t){for(;n<0;)n+=t;return n}function bOe(n,t,e){if(n.shape.length>3||t.shape.length>3)throw new st("batchDot is not implemented for tensors of 4D or higher rank yet");if(b.assert(n.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${n.shape.length}`),b.assert(n.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${t.shape.length}`),typeof e=="number"&&(e=[e,e]),n.dtype==="complex64"||t.dtype==="complex64")throw new st("batchDot is not implemented for complex64-type Tensors yet.");let r=n.shape.length,o=t.shape.length;e==null&&(e=[r-1,o-2]);let i=e;return Z(()=>{let s;if(r>o){s=r-o;let l=[];for(let c=0;c<s;++c)l.push(1);t=G(t,t.shape.concat(l))}else if(o>r){s=o-r;let l=[];for(let c=0;c<s;++c)l.push(1);n=G(n,n.shape.concat(l))}else s=0;let a;if(n.shape.length===2&&t.shape.length===2)i[0]===i[1]?a=Pe(U(n,t),i[0]):a=Pe(U(St(n,[1,0]),t),i[1]);else{let l=i[0]!==n.shape.length-1,c=i[1]===t.shape.length-1;a=_t(n,t,l,c)}if(s>0){let l;r>o?l=r+o-3:l=r-1;let c=[];for(let u=l;u<l+s;++u)c.push(u);a=qt(a,c)}return a.shape.length===1&&(a=On(a,1)),a})}var IX=(()=>{class n extends Hd{constructor(e){super(e),this.axes=e.axes,this.normalize=e.normalize==null?!1:e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){b.assert(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");let r=e[0],o=e[1];if(r.length>3||o.length>3)throw new st("Dot layer does not support tensors of 4D or higher rank yet.");let i=this.interpretAxes(r,o);if(r[i[0]]!==o[i[1]])throw new J(`Dimension incompatibility: ${r[i[0]]} !== ${o[i[1]]}`)}mergeFunction(e){if(e.length!==2)throw new J(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${e.length} input(s).`);let r=e[0],o=e[1],i;return Array.isArray(this.axes)?i=this.axes.map((s,a)=>Jb(s,e[a].shape.length)):i=[Jb(this.axes,r.shape.length),Jb(this.axes,o.shape.length)],this.normalize&&(r=Gb(r,i[0]),o=Gb(o,i[1])),bOe(r,o,i)}interpretAxes(e,r){let o;return Array.isArray(this.axes)?o=this.axes:o=[Jb(this.axes,e.length),Jb(this.axes,r.length)],o}computeOutputShape(e){b.assert(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");let r=e[0].slice(),o=e[1].slice();if(r.length>3||o.length>3)throw new st("Dot layer does not support tensors of 4D or higher rank yet.");let i=this.interpretAxes(r,o);r.splice(i[0],1),o.splice(i[1],1),o.splice(0,1);let s=r.concat(o);return s.length===1&&s.push(1),s}computeMask(e,r){return null}getConfig(){let e={axes:this.axes,normalize:this.normalize},r=super.getConfig();return Object.assign(e,r),e}}return n.className="Dot",n})();ge.registerClass(IX);var EX=(()=>{class n extends at{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){let e=super.getConfig(),r={stddev:this.stddev};return Object.assign(r,e),r}call(e,r){return Z(()=>{this.invokeCallHook(e,r);let o=rt(e);return Hf(()=>ae(Rx(o.shape,0,this.stddev),o),()=>o,r.training||!1)})}}return n.className="GaussianNoise",n})();ge.registerClass(EX);var TX=(()=>{class n extends at{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){let e=super.getConfig(),r={rate:this.rate};return Object.assign(r,e),r}call(e,r){return Z(()=>{this.invokeCallHook(e,r);let o=rt(e);return this.rate>0&&this.rate<1?Hf(()=>{let s=Math.sqrt(this.rate/(1-this.rate));return U(o,Rx(o.shape,1,s))},()=>o,r.training||!1):o})}}return n.className="GaussianDropout",n})();ge.registerClass(TX);var DX=(()=>{class n extends at{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||rt(e).shape}computeOutputShape(e){return e}getConfig(){let e=super.getConfig(),r={rate:this.rate};return Object.assign(r,e),r}call(e,r){return Z(()=>{if(this.rate<1&&this.rate>0){let o=this._getNoiseShape(e);return Hf(()=>{let s=rt(e),c=-1.6732632423543772*1.0507009873554805,u=Qo(ji(o),this.rate);u=Lo(u,"float32");let d=((1-this.rate)*(1+this.rate*c**2))**-.5,p=-d*c*this.rate,f=ae(U(s,u),U(ae(u,-1),c));return ae(U(f,d),p)},()=>rt(e),r.training||!1)}return e})}}return n.className="AlphaDropout",n})();ge.registerClass(DX);function ew(n,t,e,r,o,i=.001){let s;if(n.rank===2)s=YI(n,t,e,r,o,i);else if(n.rank===3)s=ZI(n,t,e,r,o,i);else if(n.rank===4)s=QI(n,t,e,r,o,i);else throw new st(`batchNormalization is not implemented for array of rank ${n.rank} yet`);return s}function wOe(n,t,e,r,o=.001){return Z(()=>{let i=mm(n,r),s=i.mean,a=i.variance;return[ew(n,s,a,e,t,o),s,a]})}function COe(n,t,e,r,o=.001){return Z(()=>{let i=mm(n,r),s=i.mean,a=i.variance,l=[];for(let h of ti(0,n.rank))r.indexOf(h)!==-1?l.push(1):l.push(n.shape[h]);let c=G(s,l),u=G(a,l),d=t==null?null:G(t,l),p=e==null?null:G(e,l);return[ew(n,c,u,p,d,o),s,a]})}function _Oe(n,t,e,r,o=.001){return b.arraysEqual(r.slice().sort(),ti(0,n.rank-1))?wOe(n,t,e,r,o):COe(n,t,e,r,o)}var kX=(()=>{class n extends at{constructor(e){e==null&&(e={}),super(e),this.supportsMasking=!0,this.axis=e.axis==null?-1:e.axis,this.momentum=e.momentum==null?.99:e.momentum,this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=_n(e.betaInitializer||"zeros"),this.gammaInitializer=_n(e.gammaInitializer||"ones"),this.movingMeanInitializer=_n(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=_n(e.movingVarianceInitializer||"ones"),this.betaConstraint=lr(e.betaConstraint),this.gammaConstraint=lr(e.gammaConstraint),this.betaRegularizer=kn(e.betaRegularizer),this.gammaRegularizer=kn(e.gammaRegularizer)}build(e){e=wt(e);let r=this.axis>=0?this.axis:this.axis+e.length,o=e[r];if(o==null)throw new J(`Axis ${r} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(e)}.`);this.inputSpec=[new Dn({ndim:e.length,axes:{[r]:o}})];let i=[o];this.scale&&(this.gamma=this.addWeight("gamma",i,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",i,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",i,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",i,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,r){return Z(()=>{let o=r.training==null?!1:r.training,i=rt(e),s=i.shape,a=s.length,l=ti(0,a),c=this.axis>=0?this.axis:this.axis+a;l.splice(c,1);let u=Zs(1,a);u[c]=s[c];let d=l.slice();d.sort();let p=!b.arraysEqual(d,ti(0,a).slice(0,a-1)),f=()=>{if(p){let w=G(this.movingMean.read(),u),C=G(this.movingVariance.read(),u),I=this.center?G(this.beta.read(),u):null,A=this.scale?G(this.gamma.read(),u):null;return ew(i,w,C,I,A,this.epsilon)}else return ew(i,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!o)return f();let[h,m,g]=_Oe(i,this.gamma.read(),this.beta.read(),l,this.epsilon),y=(w,C,I)=>{Z(()=>{let A=1-I,M=w.read(),$=U(Ie(M,C),A);w.write(Ie(M,$))})};return(()=>{y(this.movingMean,m,this.momentum),y(this.movingVariance,g,this.momentum)})(),h})}getConfig(){let e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Pn(this.betaInitializer),gammaInitializer:Pn(this.gammaInitializer),movingMeanInitializer:Pn(this.movingMeanInitializer),movingVarianceInitializer:Pn(this.movingVarianceInitializer),betaRegularizer:mn(this.betaRegularizer),gammaRegularizer:mn(this.gammaRegularizer),betaConstraint:ar(this.betaConstraint),gammaConstraint:ar(this.gammaConstraint)},r=super.getConfig();return Object.assign(e,r),e}}return n.className="BatchNormalization",n})();ge.registerClass(kX);var NX=(()=>{class n extends at{constructor(e){if(e==null&&(e={}),super(e),this.axis=e.axis==null?-1:e.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(let r of this.axis)if(!Number.isInteger(r))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=_n(e.betaInitializer||"zeros"),this.gammaInitializer=_n(e.gammaInitializer||"ones"),this.betaRegularizer=kn(e.betaRegularizer),this.gammaRegularizer=kn(e.gammaRegularizer),this.supportsMasking=!0}build(e){e=wt(e);let r=e.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let s=0;s<this.axis.length;++s)this.axis[s]<0&&(this.axis[s]+=r);for(let s of this.axis)if(s<0||s>=r)throw new Error(`Invalid axis: ${s}`);if(this.axis.length!==Js(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);let o=this.axis.map(s=>e[s]),i=!0;this.scale?this.gamma=this.addWeight("gamma",o,"float32",this.gammaInitializer,this.gammaRegularizer,i):this.gamma=null,this.center?this.beta=this.addWeight("beta",o,"float32",this.betaInitializer,this.betaRegularizer,i):this.beta=null,this.built=!0}call(e,r){let o=rt(e),i=o.shape,s=i.length;return Z(()=>{let{mean:l,variance:c}=mm(o,this.axis,!0),u=Zs(1,s);for(let g of this.axis)u[g]=i[g];let d=g=>g!=null&&g.shape.length!==s?G(g,u):g,p=this.scale?d(this.gamma.read()):null,f=this.center?d(this.beta.read()):null,h=[],m=[];for(let g=0;g<s;++g)this.axis.indexOf(g)!==-1?(h.push(i[g]),m.push(1)):(h.push(1),m.push(i[g]));return l=fo(l,h),c=fo(c,h),p!=null&&(p=fo(p,m)),f!=null&&(f=fo(f,m)),ew(o,l,c,f,p,this.epsilon)})}getConfig(){let e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Pn(this.betaInitializer),gammaInitializer:Pn(this.gammaInitializer),betaRegularizer:mn(this.betaRegularizer),gammaRegularizer:mn(this.gammaRegularizer)},r=super.getConfig();return Object.assign(e,r),e}}return n.className="LayerNormalization",n})();ge.registerClass(NX);function SOe(n,t,e){return Z(()=>{if(n.rank!==4)throw new J(`temporalPadding expects input tensor to be 4-D, but received a ${n.rank}-D tensor.`);if(t==null&&(t=[[1,1],[1,1]]),t.length!==2||t[0].length!==2||t[1].length!==2)throw new J("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(e==null&&(e=ni()),e!=="channelsLast"&&e!=="channelsFirst")throw new J(`Unknown data format: ${e}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let r;return e==="channelsFirst"?r=[[0,0],[0,0],t[0],t[1]]:r=[[0,0],t[0],t[1],[0,0]],to(n,r)})}var AX=(()=>{class n extends at{constructor(e){if(e==null&&(e={}),super(e),this.dataFormat=e.dataFormat==null?ni():e.dataFormat,e.padding==null)this.padding=[[1,1],[1,1]];else if(typeof e.padding=="number")this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,e.padding.length!==2)throw new J(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${e.padding.length} array.`);let r,o;if(typeof e.padding[0]=="number")r=[e.padding[0],e.padding[0]],o=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,e.padding[0].length!==2)throw new J(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${e.padding[0].length} array.`);if(r=e.padding[0],e.padding[1].length!==2)throw new J(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${e.padding[1].length} array.`);o=e.padding[1]}this.padding=[r,o]}this.inputSpec=[new Dn({ndim:4})]}computeOutputShape(e){e=wt(e);let r,o;return this.dataFormat==="channelsFirst"?(e[2]!=null&&e[2]>=0?r=e[2]+this.padding[0][0]+this.padding[0][1]:r=null,e[3]!=null&&e[3]>=0?o=e[3]+this.padding[1][0]+this.padding[1][1]:o=null,[e[0],e[1],r,o]):(e[1]!=null&&e[1]>=0?r=e[1]+this.padding[0][0]+this.padding[0][1]:r=null,e[2]!=null&&e[2]>=0?o=e[2]+this.padding[1][0]+this.padding[1][1]:o=null,[e[0],r,o,e[3]])}call(e,r){return Z(()=>SOe(rt(e),this.padding,this.dataFormat))}getConfig(){let e={padding:this.padding,dataFormat:this.dataFormat},r=super.getConfig();return Object.assign(e,r),e}}return n.className="ZeroPadding2D",n})();ge.registerClass(AX);function WE(n,t,e,r,o,i){return Z(()=>{Xn(o),jF(i),ei(r),e==null&&(e=[1,1]),r==null&&(r="valid"),o==null&&(o=ni()),i==null&&(i="max"),n=Zb(n,o);let s,a=r==="same"?"same":"valid";return i==="max"?s=Lf(n,t,e,a):s=Df(n,t,e,a),o==="channelsFirst"&&(s=St(s,[0,3,1,2])),s})}function RX(n,t,e,r,o,i){return Z(()=>{Xn(o),jF(i),ei(r),e==null&&(e=[1,1,1]),r==null&&(r="valid"),o==null&&(o=ni()),i==null&&(i="max"),n=gL(n,o);let s,a=r==="same"?"same":"valid";return i==="max"?s=w1(n,t,e,a):s=XI(n,t,e,a),o==="channelsFirst"&&(s=St(s,[0,4,1,2,3])),s})}var $E=class extends at{constructor(t){if(t.poolSize==null&&(t.poolSize=2),super(t),typeof t.poolSize=="number")this.poolSize=[t.poolSize];else if(Array.isArray(t.poolSize)&&t.poolSize.length===1&&typeof t.poolSize[0]=="number")this.poolSize=t.poolSize;else throw new J(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(t.poolSize)}`);if(wr(this.poolSize,"poolSize"),t.strides==null)this.strides=this.poolSize;else if(typeof t.strides=="number")this.strides=[t.strides];else if(Array.isArray(t.strides)&&t.strides.length===1&&typeof t.strides[0]=="number")this.strides=t.strides;else throw new J(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(t.strides)}`);wr(this.strides,"strides"),this.padding=t.padding==null?"valid":t.padding,ei(this.padding),this.inputSpec=[new Dn({ndim:3})]}computeOutputShape(t){t=wt(t);let e=vi(t[1],this.poolSize[0],this.padding,this.strides[0]);return[t[0],e,t[2]]}call(t,e){return Z(()=>{this.invokeCallHook(t,e),t=zd(rt(t),2);let r=this.poolingFunction(rt(t),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return qt(r,[2])})}getConfig(){let t={poolSize:this.poolSize,padding:this.padding,strides:this.strides},e=super.getConfig();return Object.assign(t,e),t}},OX=(()=>{class n extends $E{constructor(e){super(e)}poolingFunction(e,r,o,i,s){return Xn(s),ei(i),WE(e,r,o,i,s,"max")}}return n.className="MaxPooling1D",n})();ge.registerClass(OX);var MX=(()=>{class n extends $E{constructor(e){super(e)}poolingFunction(e,r,o,i,s){return Xn(s),ei(i),WE(e,r,o,i,s,"avg")}}return n.className="AveragePooling1D",n})();ge.registerClass(MX);var VE=class extends at{constructor(t){if(t.poolSize==null&&(t.poolSize=[2,2]),super(t),this.poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize],t.strides==null)this.strides=this.poolSize;else if(Array.isArray(t.strides)){if(t.strides.length!==2)throw new J(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${t.strides.length}.`);this.strides=t.strides}else this.strides=[t.strides,t.strides];wr(this.poolSize,"poolSize"),wr(this.strides,"strides"),this.padding=t.padding==null?"valid":t.padding,this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,Xn(this.dataFormat),ei(this.padding),this.inputSpec=[new Dn({ndim:4})]}computeOutputShape(t){t=wt(t);let e=this.dataFormat==="channelsFirst"?t[2]:t[1],r=this.dataFormat==="channelsFirst"?t[3]:t[2];return e=vi(e,this.poolSize[0],this.padding,this.strides[0]),r=vi(r,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[t[0],t[1],e,r]:[t[0],e,r,t[3]]}call(t,e){return Z(()=>(this.invokeCallHook(t,e),this.poolingFunction(rt(t),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){let t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}},PX=(()=>{class n extends VE{constructor(e){super(e)}poolingFunction(e,r,o,i,s){return Xn(s),ei(i),WE(e,r,o,i,s,"max")}}return n.className="MaxPooling2D",n})();ge.registerClass(PX);var FX=(()=>{class n extends VE{constructor(e){super(e)}poolingFunction(e,r,o,i,s){return Xn(s),ei(i),WE(e,r,o,i,s,"avg")}}return n.className="AveragePooling2D",n})();ge.registerClass(FX);var BE=class extends at{constructor(t){if(t.poolSize==null&&(t.poolSize=[2,2,2]),super(t),this.poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize,t.poolSize],t.strides==null)this.strides=this.poolSize;else if(Array.isArray(t.strides)){if(t.strides.length!==3)throw new J(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${t.strides.length}.`);this.strides=t.strides}else this.strides=[t.strides,t.strides,t.strides];wr(this.poolSize,"poolSize"),wr(this.strides,"strides"),this.padding=t.padding==null?"valid":t.padding,this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,Xn(this.dataFormat),ei(this.padding),this.inputSpec=[new Dn({ndim:5})]}computeOutputShape(t){t=wt(t);let e=this.dataFormat==="channelsFirst"?t[2]:t[1],r=this.dataFormat==="channelsFirst"?t[3]:t[2],o=this.dataFormat==="channelsFirst"?t[4]:t[3];return e=vi(e,this.poolSize[0],this.padding,this.strides[0]),r=vi(r,this.poolSize[1],this.padding,this.strides[1]),o=vi(o,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[t[0],t[1],e,r,o]:[t[0],e,r,o,t[4]]}call(t,e){return Z(()=>(this.invokeCallHook(t,e),this.poolingFunction(rt(t),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){let t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}},LX=(()=>{class n extends BE{constructor(e){super(e)}poolingFunction(e,r,o,i,s){return Xn(s),ei(i),RX(e,r,o,i,s,"max")}}return n.className="MaxPooling3D",n})();ge.registerClass(LX);var $X=(()=>{class n extends BE{constructor(e){super(e)}poolingFunction(e,r,o,i,s){return Xn(s),ei(i),RX(e,r,o,i,s,"avg")}}return n.className="AveragePooling3D",n})();ge.registerClass($X);var zE=class extends at{constructor(t){super(t),this.inputSpec=[new Dn({ndim:3})]}computeOutputShape(t){return[t[0],t[2]]}call(t,e){throw new st}},VX=(()=>{class n extends zE{constructor(e){super(e||{})}call(e,r){return Z(()=>{let o=rt(e);return Mn(o,1)})}}return n.className="GlobalAveragePooling1D",n})();ge.registerClass(VX);var BX=(()=>{class n extends zE{constructor(e){super(e||{})}call(e,r){return Z(()=>{let o=rt(e);return Jr(o,1)})}}return n.className="GlobalMaxPooling1D",n})();ge.registerClass(BX);var UE=class extends at{constructor(t){super(t),this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,Xn(this.dataFormat),this.inputSpec=[new Dn({ndim:4})]}computeOutputShape(t){return t=t,this.dataFormat==="channelsLast"?[t[0],t[3]]:[t[0],t[1]]}call(t,e){throw new st}getConfig(){let t={dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}},zX=(()=>{class n extends UE{call(e,r){return Z(()=>{let o=rt(e);return this.dataFormat==="channelsLast"?Mn(o,[1,2]):Mn(o,[2,3])})}}return n.className="GlobalAveragePooling2D",n})();ge.registerClass(zX);var UX=(()=>{class n extends UE{call(e,r){return Z(()=>{let o=rt(e);return this.dataFormat==="channelsLast"?Jr(o,[1,2]):Jr(o,[2,3])})}}return n.className="GlobalMaxPooling2D",n})();ge.registerClass(UX);var GE=class extends at{constructor(t){super(t),this.layer=t.layer}build(t){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(t){this.layer!=null&&(this.layer.trainable=t)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(t){this.layer.setWeights(t)}getConfig(){let t={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},e=super.getConfig();return Object.assign(t,e),t}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(t)}static fromConfig(t,e,r={}){let o=e.layer,i=qi(o,r);delete e.layer;let s={layer:i};return Object.assign(s,e),new t(s)}},WX=(()=>{class n extends GE{constructor(e){super(e),this.supportsMasking=!0}build(e){if(e=wt(e),e.length<3)throw new J(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(e)}`);this.inputSpec=[{shape:e}];let r=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(r),this.layer.built=!0),super.build(e)}computeOutputShape(e){e=wt(e);let r=[e[0]].concat(e.slice(2)),o=this.layer.computeOutputShape(r),i=e[1];return[o[0],i].concat(o.slice(1))}call(e,r){return Z(()=>(e=rt(e),bL((a,l)=>[rt(this.layer.call(a,r)),[]],e,[],!1,null,null,!1,!0)[1]))}}return n.className="TimeDistributed",n})();ge.registerClass(WX);function IOe(n){Eu(K7,"BidirectionalMergeMode",n)}var EOe="concat",GX=(()=>{class n extends GE{constructor(e){super(e);let r=e.layer.getConfig(),o={};o.className=e.layer.getClassName(),o.config=r,this.forwardLayer=qi(o),r.goBackwards=r.goBackwards!==!0;let i={};if(i.className=e.layer.getClassName(),i.config=r,this.backwardLayer=qi(i),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=e.mergeMode===void 0?EOe:e.mergeMode,IOe(this.mergeMode),e.weights)throw new st("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,this.forwardLayer!=null&&(this.forwardLayer.trainable=e),this.backwardLayer!=null&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){let r=e.length,o=Math.floor(r/2);this.forwardLayer.setWeights(e.slice(0,o)),this.backwardLayer.setWeights(e.slice(o))}computeOutputShape(e){let r=this.forwardLayer.computeOutputShape(e);Array.isArray(r)&&Array.isArray(r[0])||(r=[r]),r=r;let o,i,s;return this.returnState&&(s=r.slice(1)),o=r[0],o=o,this.mergeMode==="concat"?(o[o.length-1]*=2,i=[o]):this.mergeMode==null?i=[o,o.slice()]:i=[o],this.returnState?this.mergeMode==null?i.concat(s).concat(s.slice()):[o].concat(s).concat(s.slice()):no(i)}apply(e,r){let o=r==null?null:r.initialState,i=r==null?null:r.constants;r==null&&(r={});let s=vL(e,o,i,this.numConstants);if(e=s.inputs,o=s.initialState,i=s.constants,Array.isArray(e)&&(o=e.slice(1),e=e[0]),(o==null||o.length===0)&&i==null)return super.apply(e,r);let a=[],l=[];if(o!=null){let u=o.length;if(u%2>0)throw new J("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");r.initialState=o,a.push(...o);let d=o.map(p=>new Dn({shape:p.shape}));this.forwardLayer.stateSpec=d.slice(0,u/2),this.backwardLayer.stateSpec=d.slice(u/2),l.push(...d)}if(i!=null)throw new st("Support for constants in Bidirectional layers is not implemented yet.");let c=a[0]instanceof $o;for(let u of a)if(u instanceof $o!==c)throw new J("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(c){let u=[e].concat(a),d=this.inputSpec.concat(l),p=this.inputSpec;this.inputSpec=d;let f=super.apply(u,r);return this.inputSpec=p,f}else return super.apply(e,r)}call(e,r){return Z(()=>{let o=r.initialState,i,s;if(o==null)i=this.forwardLayer.call(e,r),s=this.backwardLayer.call(e,r);else{let c=o.slice(0,o.length/2),u=o.slice(o.length/2);i=this.forwardLayer.call(e,Object.assign(r,{initialState:c})),s=this.backwardLayer.call(e,Object.assign(r,{initialState:u}))}let a;this.returnState&&(Array.isArray(i)&&(a=i.slice(1).concat(s.slice(1))),i=i[0],s=s[0]),this.returnSequences&&(s=Fr(s,1));let l;return this.mergeMode==="concat"?l=Ax([i,s]):this.mergeMode==="sum"?l=ae(i,s):this.mergeMode==="ave"?l=U(.5,ae(i,s)):this.mergeMode==="mul"?l=U(i,s):this.mergeMode==null&&(l=[i,s]),this.returnState?this.mergeMode==null?l.concat(a):[l].concat(a):l})}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){Ol(this.forwardLayer.name,()=>{this.forwardLayer.build(e)}),Ol(this.backwardLayer.name,()=>{this.backwardLayer.build(e)}),this.built=!0}computeMask(e,r){Array.isArray(r)&&(r=r[0]);let o;if(this.returnSequences?this.mergeMode==null?o=[r,r]:o=r:this.mergeMode==null?o=[null,null]:o=null,this.returnState){let s=this.forwardLayer.states.map(a=>null);return Array.isArray(o)?o.concat(s).concat(s):[o].concat(s).concat(s)}else return o}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(e),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){let e={mergeMode:this.mergeMode},r=super.getConfig();return Object.assign(e,r),e}static fromConfig(e,r){let o=qi(r.layer);if(delete r.layer,r.numConstants!=null)throw new st("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");let i=r;return i.layer=o,new e(i)}}return n.className="Bidirectional",n})();ge.registerClass(GX);var jX=(()=>{class n extends at{constructor(e){super(e),this.scale=e.scale,e.offset?this.offset=e.offset:this.offset=0}getConfig(){let e={scale:this.scale,offset:this.offset},r=super.getConfig();return Object.assign(e,r),e}call(e,r){return Z(()=>(e=rt(e),e.dtype!=="float32"&&(e=Lo(e,"float32")),ae(U(e,this.scale),this.offset)))}}return n.className="Rescaling",n})();ge.registerClass(jX);var{resizeBilinear:TOe,cropAndResize:DOe}=kr,HX=(()=>{class n extends at{constructor(e){super(e),this.height=e.height,this.width=e.width}centerCrop(e,r,o,i,s,a,l,c){return Z(()=>{let u,d=!1,p=r/a,f=o/l,h=(i+r)/a,m=(s+o)/l,g=[p,f,h,m],y=[];e.rank===3?(d=!0,u=sr([e])):u=e;for(let A=0;A<u.shape[0];A++)y.push(g);let v=Yr(y,[y.length,4]),w=Su(0,y.length,1,"int32"),I=DOe(u,v,w,[i,s],"nearest");return d?Lo(rt($r(I)),c):Lo(I,c)})}upsize(e,r,o,i){return Z(()=>{let s=TOe(e,[r,o]);return Lo(s,i)})}call(e,r){return Z(()=>{let o=rt(e),i=o.dtype,s=o.shape,a=s[s.length-3],l=s[s.length-2],c=0;a!==this.height&&(c=Math.floor((a-this.height)/2));let u=0;return l!==this.width&&(u=Math.floor((l-this.width)/2),u===0&&(u=1)),c>=0&&u>=0?this.centerCrop(o,c,u,this.height,this.width,a,l,i):this.upsize(e,this.height,this.width,i)})}getConfig(){let e={height:this.height,width:this.width},r=super.getConfig();return Object.assign(e,r),e}computeOutputShape(e){e=wt(e);let r=e.length-3,o=e.length-2;return e[r]=this.height,e[o]=this.width,e}}return n.className="CenterCrop",n})();ge.registerClass(HX);function qX(n,t,e,r){let o=rt(n);if(o.dtype!=="int32"&&(o=Lo(o,"int32")),t==="int")return o;let i=o.shape;if(o.rank===0&&(o=On(o,-1)),t==="oneHot"&&o.shape[o.shape.length-1]!==1&&(o=On(o,-1)),o.rank>2)throw new J(`When outputMode is not int, maximum output rank is 2 Received outputMode ${t} and input shape ${i} which would result in output rank ${o.rank}.`);let s=["multiHot","oneHot"].includes(t),a=o,l;if(typeof r<"u"&&t==="count"?l=Db(a,r,e,s):l=Db(a,[],e,s),t!=="tfIdf")return l;if(r)return U(l,r);throw new J("When outputMode is 'tfIdf', weights must be provided.")}var KX=(()=>{class n extends at{constructor(e){super(e),this.numTokens=e.numTokens,e.outputMode?this.outputMode=e.outputMode:this.outputMode="multiHot"}getConfig(){let e={numTokens:this.numTokens,outputMode:this.outputMode},r=super.getConfig();return Object.assign(e,r),e}computeOutputShape(e){return e=wt(e),e==null?[this.numTokens]:this.outputMode==="oneHot"&&e[e.length-1]!==1?(e.push(this.numTokens),e):(e[e.length-1]=this.numTokens,e)}call(e,r){return Z(()=>{e=rt(e),e.dtype!=="int32"&&(e=Lo(e,"int32"));let o;if(typeof r.countWeights<"u"){if(this.outputMode!=="count")throw new J(`countWeights is not used when outputMode !== count.
              Received countWeights=${r.countWeights}`);o=rt(r.countWeights)}let i=Jr(e),s=Rd(e),a=ir(this.numTokens,i).bufferSync().get(0),l=Qo(s,0).bufferSync().get(0);if(!(a&&l))throw new J(`Input values must be between 0 < values <= numTokens with numTokens=${this.numTokens}`);return qX(e,this.outputMode,this.numTokens,o)})}}return n.className="CategoryEncoding",n})();ge.registerClass(KX);var NOe=["bilinear","nearest"],XX=new Set(NOe),YX=(()=>{class n extends at{constructor(e){if(super(e),this.height=e.height,this.width=e.width,e.interpolation)if(XX.has(e.interpolation))this.interpolation=e.interpolation;else throw new J(`Invalid interpolation parameter: ${e.interpolation} is not implemented`);else this.interpolation="bilinear";this.cropToAspectRatio=!!e.cropToAspectRatio}computeOutputShape(e){e=wt(e);let r=e[2];return[this.height,this.width,r]}getConfig(){let e={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},r=super.getConfig();return Object.assign(e,r),e}call(e,r){return Z(()=>{let o=[this.height,this.width];if(this.interpolation==="bilinear")return kr.resizeBilinear(e,o,!this.cropToAspectRatio);if(this.interpolation==="nearest")return kr.resizeNearestNeighbor(e,o,!this.cropToAspectRatio);throw new Error(`Interpolation is ${this.interpolation} but only ${[...XX]} are supported`)})}}return n.className="Resizing",n})();ge.registerClass(YX);var ZX=(()=>{class n{constructor(e){this.seed=e}next(){if(this.seed!==void 0)return this.seed++}}return n.className="RandomSeed",n})();var QX=(()=>{class n extends at{constructor(e){super(e),this.randomGenerator=new ZX(e.seed)}getConfig(){let e={seed:this.randomGenerator.seed},r=super.getConfig();return Object.assign(e,r),e}}return n.className="BaseRandomLayer",n})();var AOe=["bilinear","nearest"],JX=new Set(AOe),eY=(()=>{class n extends QX{constructor(e){super(e);let{factor:r,interpolation:o="bilinear"}=e;if(this.factor=r,Array.isArray(this.factor)&&this.factor.length===2)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else if(!Array.isArray(this.factor)&&this.factor>0)this.widthLower=-this.factor,this.widthUpper=this.factor;else throw new J(`Invalid factor: ${this.factor}. Must be positive number or tuple of 2 numbers`);if(this.widthLower<-1||this.widthUpper<-1)throw new J(`factor must have values larger than -1. Got: ${this.factor}`);if(this.widthUpper<this.widthLower)throw new J(`factor cannot have upper bound less than lower bound.
        Got upper bound: ${this.widthUpper}.
        Got lower bound: ${this.widthLower}
      `);if(o)if(JX.has(o))this.interpolation=o;else throw new J(`Invalid interpolation parameter: ${o} is not implemented`)}getConfig(){let e={factor:this.factor,interpolation:this.interpolation},r=super.getConfig();return Object.assign(e,r),e}computeOutputShape(e){e=wt(e);let r=e[2];return[this.imgHeight,-1,r]}call(e,r){return Z(()=>{let o=rt(e);this.imgHeight=o.shape[o.shape.length-3];let i=o.shape[o.shape.length-2];this.widthFactor=ji([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let s=this.widthFactor.dataSync()[0]*i;s=Math.round(s);let a=[this.imgHeight,s];switch(this.interpolation){case"bilinear":return kr.resizeBilinear(e,a);case"nearest":return kr.resizeNearestNeighbor(e,a);default:throw new Error(`Interpolation is ${this.interpolation}
          but only ${[...JX]} are supported`)}})}}return n.className="RandomWidth",n})();ge.registerClass(eY);var LOe=q();LOe.registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,n=>{n&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});var Ki=function(n){return n[n.DT_INVALID=0]="DT_INVALID",n[n.DT_FLOAT=1]="DT_FLOAT",n[n.DT_DOUBLE=2]="DT_DOUBLE",n[n.DT_INT32=3]="DT_INT32",n[n.DT_UINT8=4]="DT_UINT8",n[n.DT_INT16=5]="DT_INT16",n[n.DT_INT8=6]="DT_INT8",n[n.DT_STRING=7]="DT_STRING",n[n.DT_COMPLEX64=8]="DT_COMPLEX64",n[n.DT_INT64=9]="DT_INT64",n[n.DT_BOOL=10]="DT_BOOL",n[n.DT_QINT8=11]="DT_QINT8",n[n.DT_QUINT8=12]="DT_QUINT8",n[n.DT_QINT32=13]="DT_QINT32",n[n.DT_BFLOAT16=14]="DT_BFLOAT16",n[n.DT_QINT16=15]="DT_QINT16",n[n.DT_QUINT16=16]="DT_QUINT16",n[n.DT_UINT16=17]="DT_UINT16",n[n.DT_COMPLEX128=18]="DT_COMPLEX128",n[n.DT_HALF=19]="DT_HALF",n[n.DT_RESOURCE=20]="DT_RESOURCE",n[n.DT_VARIANT=21]="DT_VARIANT",n[n.DT_UINT32=22]="DT_UINT32",n[n.DT_UINT64=23]="DT_UINT64",n[n.DT_FLOAT_REF=101]="DT_FLOAT_REF",n[n.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",n[n.DT_INT32_REF=103]="DT_INT32_REF",n[n.DT_UINT8_REF=104]="DT_UINT8_REF",n[n.DT_INT16_REF=105]="DT_INT16_REF",n[n.DT_INT8_REF=106]="DT_INT8_REF",n[n.DT_STRING_REF=107]="DT_STRING_REF",n[n.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",n[n.DT_INT64_REF=109]="DT_INT64_REF",n[n.DT_BOOL_REF=110]="DT_BOOL_REF",n[n.DT_QINT8_REF=111]="DT_QINT8_REF",n[n.DT_QUINT8_REF=112]="DT_QUINT8_REF",n[n.DT_QINT32_REF=113]="DT_QINT32_REF",n[n.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",n[n.DT_QINT16_REF=115]="DT_QINT16_REF",n[n.DT_QUINT16_REF=116]="DT_QUINT16_REF",n[n.DT_UINT16_REF=117]="DT_UINT16_REF",n[n.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",n[n.DT_HALF_REF=119]="DT_HALF_REF",n[n.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",n[n.DT_VARIANT_REF=121]="DT_VARIANT_REF",n[n.DT_UINT32_REF=122]="DT_UINT32_REF",n[n.DT_UINT64_REF=123]="DT_UINT64_REF",n}(Ki||{}),tY;(function(n){let t;(function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"})(t=n.CheckpointFormatVersion||(n.CheckpointFormatVersion={}))})(tY||(tY={}));var VOe={};function jE(n){return VOe[n]}function D(n,t,e,r,o){let i=t.inputParams[n];if(i&&i.inputIndexStart!==void 0){let a=i.inputIndexStart,l=i.inputIndexEnd===0?void 0:i.inputIndexEnd===void 0?a+1:i.inputIndexEnd,c=a<0?t.inputNames.length+a:a;if(i.type==="tensor")return Ar(t.inputNames[c],e,r,o);if(i.type==="tensors"){let p=t.inputs.slice(a,l);return t.inputNames.slice(a,l).filter((h,m)=>{var g;return((g=p[m])===null||g===void 0?void 0:g.op)!=="NoOp"}).map(h=>Ar(h,e,r,o))}let u=Ar(t.inputNames[c],e,r,o),d=u.dataSync();return i.type==="number"?d[0]:b.toNestedArray(u.shape,d)}let s=t.attrParams[n];return s&&s.value}function Ar(n,t,e,r){let[o,i]=ii(n,e);if(r!=null){let a=r.getHashTableHandleByName(o);if(a!=null)return a}let s=e.currentContextIds.find(a=>!!t[HE(o,a)]);return s!==void 0?t[HE(o,s)][i]:void 0}function EL(n,t,e){return t[HE(n,e.currentContextId)]}function $l(n,t){let[e,r,o]=ii(n,t);return[HE(e,t&&t.currentContextId),r,o]}function HE(n,t){return t?`${n}-${t}`:n}function ii(n,t){if(n==="")return["",0,void 0];let e=t!=null&&t.parseNodeNameCache!=null;if(e){let i=t.parseNodeNameCache.get(n);if(i!=null)return i}let r=n.split(":"),o;if(r.length===1)o=[n,0,void 0];else{let i=r[0],s=r.length===3?r[1]:void 0,a=Number(r[r.length-1]);o=[i,a,s]}return e&&t.parseNodeNameCache.set(n,o),o}function tw(n,t,e){let r=D("pad",n,t,e);if(r==="explicit"){r=D("explicitPaddings",n,t,e);let o=[[0,0],[0,0],[0,0],[0,0]];for(let i=0;i<4;i++)o[i][0]=r[i*2],o[i][1]=r[i*2+1];return o}return r}function Vl(n){return n.kept?n:Yo(n)}var TL={};bn(TL,{json:()=>BOe});var BOe=[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}];var DL={};bn(DL,{json:()=>zOe});var zOe=[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsNan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsFinite",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsInf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}];var kL={};bn(kL,{json:()=>UOe});var UOe=[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcatV2",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListLength",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}]},{tfOpName:"TensorListResize",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"size",type:"number"}]}];var NL={};bn(NL,{json:()=>WOe});var WOe=[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}];var AL={};bn(AL,{json:()=>GOe});var GOe=[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomStandardNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniformInt",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number"},{tfName:"maxval",name:"maxval",type:"number"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}];var RL={};bn(RL,{json:()=>jOe});var jOe=[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}];var OL={};bn(OL,{json:()=>HOe});var HOe=[{tfOpName:"LowerBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"UpperBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}];var ML={};bn(ML,{json:()=>qOe});var qOe=[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}];var PL={};bn(PL,{json:()=>KOe});var KOe=[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableSize",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"LookupTableSizeV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"InitializeTable",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]},{tfOpName:"InitializeTableV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]}];var FL={};bn(FL,{json:()=>XOe});var XOe=[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]},{tfOpName:"ImageProjectiveTransformV3",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"transforms",type:"tensor"},{start:2,name:"outputShape",type:"number[]"},{start:3,name:"fillValue",type:"number"}],attrs:[{tfName:"interpolation",name:"interpolation",type:"string"},{tfName:"fill_mode",name:"fillMode",type:"string"}]}];var LL={};bn(LL,{json:()=>YOe});var YOe=[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BitwiseAnd",category:"logical",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}]}];var $L={};bn($L,{json:()=>ZOe});var ZOe=[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Einsum",category:"matrices",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"equation",name:"equation",type:"string"},{tfName:"N",name:"n",type:"number",defaultValue:2},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"MatrixBandPart",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"numLower",type:"tensor"},{start:1,name:"numUpper",type:"tensor"}]}];var VL={};bn(VL,{json:()=>QOe});var QOe=[{tfOpName:"EuclideanNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",defaultValue:!1}]},{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]}];var BL={};bn(BL,{json:()=>JOe});var JOe=[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cumprod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}];var zL={};bn(zL,{json:()=>eMe});var eMe=[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]},{tfOpName:"TensorScatterUpdate",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"values",type:"tensor"}]}];var UL={};bn(UL,{json:()=>tMe});var tMe=[{tfOpName:"SparseFillEmptyRows",category:"sparse",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"denseShape",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}]},{tfOpName:"SparseReshape",category:"sparse",inputs:[{start:0,name:"inputIndices",type:"tensor"},{start:1,name:"inputShape",type:"tensor"},{start:2,name:"newShape",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SparseSegmentMean",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]},{tfOpName:"SparseSegmentSum",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]}];var WL={};bn(WL,{json:()=>nMe});var nMe=[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}];var GL={};bn(GL,{json:()=>rMe});var rMe=[{tfOpName:"StaticRegexReplace",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"pattern",name:"pattern",type:"string"},{tfName:"rewrite",name:"rewrite",type:"string"},{tfName:"replace_global",name:"replaceGlobal",type:"bool"}]},{tfOpName:"StringNGrams",category:"string",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"dataSplits",type:"tensor"}],attrs:[{tfName:"separator",name:"separator",type:"string"},{tfName:"ngram_widths",name:"nGramWidths",type:"number[]"},{tfName:"left_pad",name:"leftPad",type:"string"},{tfName:"right_pad",name:"rightPad",type:"string"},{tfName:"pad_width",name:"padWidth",type:"number"},{tfName:"preserve_short_sequences",name:"preserveShortSequences",type:"bool"}],outputs:["ngrams","ngrams_splits"]},{tfOpName:"StringSplit",category:"string",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"delimiter",type:"tensor"}],attrs:[{tfName:"skip_empty",name:"skipEmpty",type:"bool"}],outputs:["indices","values","shape"]},{tfOpName:"StringToHashBucketFast",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"num_buckets",name:"numBuckets",type:"number"}]}];var jL={};bn(jL,{json:()=>oMe});var oMe=[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"EnsureShape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]},{tfOpName:"BroadcastArgs",category:"transformation",inputs:[{start:0,name:"s0",type:"tensor"},{start:1,name:"s1",type:"tensor"}],attrs:[]}];var nw=class{static get Instance(){return this._instance||(this._instance=new this)}constructor(){let t=[TL,DL,kL,NL,AL,RL,OL,ML,PL,FL,LL,$L,VL,BL,zL,UL,WL,GL,jL],e=[].concat(...t.map(r=>r.json));this.opMappers=e.reduce((r,o)=>(r[o.tfOpName]=o,r),{})}transformGraph(t,e={}){let r=t.node,o=[],i=[],s=[],a=r.reduce((m,g)=>(m[g.name]=this.mapNode(g),g.op.startsWith("Placeholder")?o.push(m[g.name]):g.op==="Const"?i.push(m[g.name]):(g.input==null||g.input.length===0)&&s.push(m[g.name]),m),{}),l=[],c=[],u={},d={};e!=null&&(u=this.mapSignatureEntries(e.inputs),d=this.mapSignatureEntries(e.outputs));let p=Object.keys(a);p.forEach(m=>{let g=a[m];g.inputNames.forEach((y,v)=>{let[w,,C]=$l(y),I=a[w];if(I.outputs!=null){let A=I.outputs.indexOf(C);if(A!==-1){let M=`${w}:${A}`;g.inputNames[v]=M}}g.inputs.push(I),I.children.push(g)})}),Object.keys(d).length===0?p.forEach(m=>{let g=a[m];g.children.length===0&&c.push(g)}):Object.keys(d).forEach(m=>{let[g]=$l(m),y=a[g];y!=null&&(y.signatureKey=d[m],c.push(y))}),Object.keys(u).length>0?Object.keys(u).forEach(m=>{let[g]=$l(m),y=a[g];y&&(y.signatureKey=u[m],l.push(y))}):l=o;let f={};t.library!=null&&t.library.function!=null&&(f=t.library.function.reduce((m,g)=>(m[g.signature.name]=this.mapFunction(g),m),{}));let h={nodes:a,inputs:l,outputs:c,weights:i,placeholders:o,signature:e,functions:f};return s.length>0&&(h.initNodes=s),h}mapSignatureEntries(t){return Object.keys(t||{}).reduce((e,r)=>(e[t[r].name]=r,e),{})}mapNode(t){let e=jE(t.op)||this.opMappers[t.op]||{};t.attr==null&&(t.attr={});let r={name:t.name,op:t.op,category:e.category,inputNames:(t.input||[]).map(o=>o.startsWith("^")?o.slice(1):o),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:t.attr,outputs:e.outputs};return e.inputs!=null&&(r.inputParams=e.inputs.reduce((o,i)=>(o[i.name]={type:i.type,inputIndexStart:i.start,inputIndexEnd:i.end},o),{})),e.attrs!=null&&(r.attrParams=e.attrs.reduce((o,i)=>{let s=i.type,a;switch(i.type){case"string":a=qE(t.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=qE(t.attr,i.tfDeprecatedName,i.defaultValue));break;case"string[]":a=eT(t.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=eT(t.attr,i.tfDeprecatedName,i.defaultValue));break;case"number":a=XE(t.attr,i.tfName,i.defaultValue||0),a===void 0&&i.tfDeprecatedName&&(a=XE(t.attr,i.tfDeprecatedName,i.defaultValue));break;case"number[]":a=JE(t.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=JE(t.attr,i.tfDeprecatedName,i.defaultValue));break;case"bool":a=KE(t.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=KE(t.attr,i.tfDeprecatedName,i.defaultValue));break;case"bool[]":a=nT(t.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=nT(t.attr,i.tfDeprecatedName,i.defaultValue));break;case"shape":a=QE(t.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=QE(t.attr,i.tfDeprecatedName,i.defaultValue));break;case"shape[]":a=tT(t.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=tT(t.attr,i.tfDeprecatedName,i.defaultValue));break;case"dtype":a=YE(t.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=YE(t.attr,i.tfDeprecatedName,i.defaultValue));break;case"dtype[]":a=ZE(t.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=ZE(t.attr,i.tfDeprecatedName,i.defaultValue));break;case"func":a=nY(t.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=nY(t.attr,i.tfDeprecatedName,i.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error(`Unsupported param type: ${i.type} for op: ${t.op}`)}return o[i.name]={value:a,type:s},o},{})),r}mapFunction(t){let e=t.nodeDef,r=[],o=[],i={};e!=null&&(i=e.reduce((d,p)=>(d[p.name]=this.mapNode(p),p.op==="Const"&&o.push(d[p.name]),d),{}));let s=[],a=[];t.signature.inputArg.forEach(d=>{let[p]=$l(d.name),f={name:p,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:HL(d.type),type:"dtype"}},children:[]};f.signatureKey=d.name,s.push(f),i[p]=f}),Object.keys(i).forEach(d=>{let p=i[d];p.inputNames.forEach((f,h)=>{let[m,,g]=$l(f),y=i[m];if(y.outputs!=null){let v=y.outputs.indexOf(g);if(v!==-1){let w=`${m}:${v}`;p.inputNames[h]=w}}p.inputs.push(y),y.children.push(p)})});let c=t.ret;t.signature.outputArg.forEach(d=>{let[p,f]=$l(c[d.name]),h=i[p];h!=null&&(h.defaultOutput=f,a.push(h))});let u=this.mapArgsToSignature(t);return{nodes:i,inputs:s,outputs:a,weights:o,placeholders:r,signature:u}}mapArgsToSignature(t){return{methodName:t.signature.name,inputs:t.signature.inputArg.reduce((e,r)=>(e[r.name]=this.mapArgToTensorInfo(r),e),{}),outputs:t.signature.outputArg.reduce((e,r)=>(e[r.name]=this.mapArgToTensorInfo(r,t.ret),e),{})}}mapArgToTensorInfo(t,e){let r=t.name;return e!=null&&(r=e[r]),{name:r,dtype:t.type}}};function iMe(n){let t=q().global;if(typeof t.atob<"u")return t.atob(n);if(typeof Buffer<"u")return new Buffer(n,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}function rY(n,t){let e=Array.isArray(n)?String.fromCharCode.apply(null,n):iMe(n);return t?e:e.toLowerCase()}function qE(n,t,e,r=!1){let o=n[t];return o!=null?rY(o.s,r):e}function KE(n,t,e){let r=n[t];return r?r.b:e}function XE(n,t,e){let r=n[t]||{},o=r.i!=null?r.i:r.f!=null?r.f:e;return typeof o=="number"?o:parseInt(o,10)}function HL(n){switch(typeof n=="string"&&(n=Ki[n]),n){case Ki.DT_FLOAT:case Ki.DT_HALF:return"float32";case Ki.DT_INT32:case Ki.DT_INT64:case Ki.DT_INT8:case Ki.DT_UINT8:return"int32";case Ki.DT_BOOL:return"bool";case Ki.DT_DOUBLE:return"float32";case Ki.DT_STRING:return"string";case Ki.DT_COMPLEX64:case Ki.DT_COMPLEX128:return"complex64";default:return null}}function nY(n,t,e){let r=n[t];return r&&r.func?r.func.name:e}function YE(n,t,e){let r=n[t];return r&&r.type?HL(r.type):e}function ZE(n,t,e){let r=n[t];return r&&r.list&&r.list.type?r.list.type.map(o=>HL(o)):e}function oY(n){if(!n.unknownRank)return n.dim!=null?n.dim.map(t=>typeof t.size=="number"?t.size:parseInt(t.size,10)):[]}function QE(n,t,e){let r=n[t];return r&&r.shape?oY(r.shape):e}function JE(n,t,e){let r=n[t];return r?((r.list.f&&r.list.f.length?r.list.f:r.list.i)||[]).map(o=>typeof o=="number"?o:parseInt(o,10)):e}function eT(n,t,e,r=!1){let o=n[t];return o&&o.list&&o.list.s?o.list.s.map(i=>rY(i,r)):e}function tT(n,t,e){let r=n[t];return r&&r.list&&r.list.shape?r.list.shape.map(o=>oY(o)):e}function nT(n,t,e){let r=n[t];return r&&r.list&&r.list.b?r.list.b:e}var rT=class{constructor(t,e,r){this.node=t,this.tensorMap=e,this.context=r,this.inputs=[],this.attrs={},this.inputs=t.inputNames.map(o=>this.getInput(o)),t.rawAttrs!=null&&(this.attrs=Object.keys(t.rawAttrs).reduce((o,i)=>(o[i]=this.getAttr(i),o),{}))}getInput(t){return Ar(t,this.tensorMap,this.context)}getAttr(t,e){let r=this.node.rawAttrs[t];if(r.tensor!=null)return Ar(t,this.tensorMap,this.context);if(r.i!=null||r.f!=null)return XE(this.node.rawAttrs,t,e);if(r.s!=null)return qE(this.node.rawAttrs,t,e);if(r.b!=null)return KE(this.node.rawAttrs,t,e);if(r.shape!=null)return QE(this.node.rawAttrs,t,e);if(r.type!=null)return YE(this.node.rawAttrs,t,e);if(r.list!=null){if(r.list.i!=null||r.list.f!=null)return JE(this.node.rawAttrs,t,e);if(r.list.s!=null)return eT(this.node.rawAttrs,t,e);if(r.list.shape!=null)return tT(this.node.rawAttrs,t,e);if(r.list.b!=null)return nT(this.node.rawAttrs,t,e);if(r.list.type!=null)return ZE(this.node.rawAttrs,t,e)}return e}};var nn={};bn(nn,{OP_SCOPE_SUFFIX:()=>XP,abs:()=>Bn,acos:()=>zI,acosh:()=>UI,add:()=>ae,addN:()=>D5,all:()=>Qy,any:()=>dm,argMax:()=>js,argMin:()=>WI,asin:()=>GI,asinh:()=>jI,atan:()=>HI,atan2:()=>qI,atanh:()=>KI,avgPool:()=>Df,avgPool3d:()=>XI,basicLSTMCell:()=>A5,batchNorm:()=>xu,batchNorm2d:()=>YI,batchNorm3d:()=>ZI,batchNorm4d:()=>QI,batchToSpaceND:()=>kf,bincount:()=>JI,bitwiseAnd:()=>O5,booleanMaskAsync:()=>Gke,broadcastArgs:()=>M5,broadcastTo:()=>vu,buffer:()=>ze,cast:()=>me,ceil:()=>e1,clipByValue:()=>Pr,clone:()=>Yo,complex:()=>hi,concat:()=>Gt,concat1d:()=>t1,concat2d:()=>n1,concat3d:()=>r1,concat4d:()=>o1,conv1d:()=>ex,conv2d:()=>mi,conv2dTranspose:()=>nx,conv3d:()=>i1,conv3dTranspose:()=>a1,cos:()=>Nf,cosh:()=>rx,cosineWindow:()=>Mb,cumprod:()=>fm,cumsum:()=>ox,denseBincount:()=>Db,depthToSpace:()=>l1,depthwiseConv2d:()=>bu,diag:()=>P5,dilation2d:()=>c1,div:()=>Se,divNoNan:()=>u1,dot:()=>d1,dropout:()=>bF,einsum:()=>Af,elu:()=>wu,enclosingPowerOfTwo:()=>wF,ensureShape:()=>L5,equal:()=>Po,erf:()=>ix,euclideanNorm:()=>p1,exp:()=>Gn,expandDims:()=>On,expm1:()=>f1,eye:()=>hm,fft:()=>zf,fill:()=>Hs,floor:()=>Cu,floorDiv:()=>Zy,fused:()=>Wf,gather:()=>_u,gatherND:()=>eNe,greater:()=>ir,greaterEqual:()=>Qo,ifft:()=>Fd,imag:()=>Rf,image:()=>kr,inTopKAsync:()=>rNe,irfft:()=>xx,isFinite:()=>h1,isInf:()=>m1,isNaN:()=>g1,leakyRelu:()=>Of,less:()=>Md,lessEqual:()=>Gi,linalg:()=>_F,linspace:()=>B5,localResponseNormalization:()=>y1,log:()=>eo,log1p:()=>Mf,logSigmoid:()=>x1,logSoftmax:()=>sx,logSumExp:()=>Pf,logicalAnd:()=>Co,logicalNot:()=>Ff,logicalOr:()=>ax,logicalXor:()=>v1,losses:()=>iAe,lowerBound:()=>z5,matMul:()=>_t,max:()=>Jr,maxPool:()=>Lf,maxPool3d:()=>w1,maxPoolWithArgmax:()=>U5,maximum:()=>yi,mean:()=>Mn,meshgrid:()=>W5,min:()=>Rd,minimum:()=>xi,mirrorPad:()=>lx,mod:()=>C1,moments:()=>mm,movingAverage:()=>qke,mul:()=>U,multiRNNCell:()=>G5,multinomial:()=>j5,neg:()=>Dt,norm:()=>Od,notEqual:()=>Nl,oneHot:()=>gm,ones:()=>Tr,onesLike:()=>Hr,op:()=>R,outerProduct:()=>H5,pad:()=>to,pad1d:()=>q5,pad2d:()=>K5,pad3d:()=>X5,pad4d:()=>Y5,pool:()=>_1,pow:()=>wo,prelu:()=>Vf,print:()=>BI,prod:()=>S1,raggedGather:()=>Z5,raggedRange:()=>Q5,raggedTensorToTensor:()=>J5,rand:()=>eq,randomGamma:()=>yq,randomNormal:()=>vm,randomStandardNormal:()=>xq,randomUniform:()=>ji,randomUniformInt:()=>vq,range:()=>Su,real:()=>Pd,reciprocal:()=>k1,relu:()=>ho,relu6:()=>cx,reshape:()=>G,reverse:()=>Fr,reverse1d:()=>bq,reverse2d:()=>wq,reverse3d:()=>Cq,reverse4d:()=>_q,rfft:()=>Uf,round:()=>ux,rsqrt:()=>dx,scalar:()=>Ae,scatterND:()=>Xke,searchSorted:()=>Nb,selu:()=>px,separableConv2d:()=>fx,setdiff1dAsync:()=>Sq,sigmoid:()=>jr,sign:()=>N1,signal:()=>oAe,sin:()=>hx,sinh:()=>mx,slice:()=>Je,slice1d:()=>gx,slice2d:()=>Rb,slice3d:()=>yx,slice4d:()=>bm,softmax:()=>Bf,softplus:()=>kl,spaceToBatchND:()=>$f,sparse:()=>sAe,sparseToDense:()=>Qke,spectral:()=>rAe,split:()=>Lr,sqrt:()=>wn,square:()=>xt,squaredDifference:()=>vx,squeeze:()=>qt,stack:()=>sr,step:()=>Ks,stridedSlice:()=>A1,string:()=>aAe,sub:()=>Ie,sum:()=>Pe,tan:()=>R1,tanh:()=>Dl,tensor:()=>Yr,tensor1d:()=>Cn,tensor2d:()=>Fo,tensor3d:()=>O1,tensor4d:()=>Iq,tensor5d:()=>Eq,tensor6d:()=>Tq,tensorScatterUpdate:()=>Nq,tile:()=>fo,topk:()=>M1,transpose:()=>St,truncatedNormal:()=>bx,unique:()=>P1,unsortedSegmentSum:()=>wx,unstack:()=>$r,upperBound:()=>Aq,variable:()=>F1,where:()=>Rn,whereAsync:()=>$1,zeros:()=>hn,zerosLike:()=>tt});var iY=(n,t,e,r=nn)=>{switch(n.op){case"BiasAdd":case"AddV2":case"Add":return[r.add(D("a",n,t,e),D("b",n,t,e))];case"AddN":return[r.addN(D("tensors",n,t,e))];case"FloorMod":case"Mod":return[r.mod(D("a",n,t,e),D("b",n,t,e))];case"Mul":return[r.mul(D("a",n,t,e),D("b",n,t,e))];case"RealDiv":case"Div":return[r.div(D("a",n,t,e),D("b",n,t,e))];case"DivNoNan":return[r.divNoNan(D("a",n,t,e),D("b",n,t,e))];case"FloorDiv":return[r.floorDiv(D("a",n,t,e),D("b",n,t,e))];case"Sub":return[r.sub(D("a",n,t,e),D("b",n,t,e))];case"Minimum":return[r.minimum(D("a",n,t,e),D("b",n,t,e))];case"Maximum":return[r.maximum(D("a",n,t,e),D("b",n,t,e))];case"Pow":return[r.pow(D("a",n,t,e),D("b",n,t,e))];case"SquaredDifference":return[r.squaredDifference(D("a",n,t,e),D("b",n,t,e))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};var sY=(n,t,e,r=nn)=>{switch(n.op){case"Abs":case"ComplexAbs":return[r.abs(D("x",n,t,e))];case"Acos":return[r.acos(D("x",n,t,e))];case"Acosh":return[r.acosh(D("x",n,t,e))];case"Asin":return[r.asin(D("x",n,t,e))];case"Asinh":return[r.asinh(D("x",n,t,e))];case"Atan":return[r.atan(D("x",n,t,e))];case"Atan2":return[r.atan2(D("x",n,t,e),D("y",n,t,e))];case"Atanh":return[r.atanh(D("x",n,t,e))];case"Ceil":return[r.ceil(D("x",n,t,e))];case"Complex":return[r.complex(D("real",n,t,e),D("imag",n,t,e))];case"Cos":return[r.cos(D("x",n,t,e))];case"Cosh":return[r.cosh(D("x",n,t,e))];case"Elu":return[r.elu(D("x",n,t,e))];case"Erf":return[r.erf(D("x",n,t,e))];case"Exp":return[r.exp(D("x",n,t,e))];case"Expm1":return[r.expm1(D("x",n,t,e))];case"Floor":return[r.floor(D("x",n,t,e))];case"Log":return[r.log(D("x",n,t,e))];case"Log1p":return[r.log1p(D("x",n,t,e))];case"Imag":return[r.imag(D("x",n,t,e))];case"Neg":return[r.neg(D("x",n,t,e))];case"Reciprocal":return[r.reciprocal(D("x",n,t,e))];case"Real":return[r.real(D("x",n,t,e))];case"Relu":return[r.relu(D("x",n,t,e))];case"Round":return[r.round(D("x",n,t,e))];case"Selu":return[r.selu(D("x",n,t,e))];case"Sigmoid":return[r.sigmoid(D("x",n,t,e))];case"Sin":return[r.sin(D("x",n,t,e))];case"Sign":return[r.sign(D("x",n,t,e))];case"Sinh":return[r.sinh(D("x",n,t,e))];case"Softplus":return[r.softplus(D("x",n,t,e))];case"Sqrt":return[r.sqrt(D("x",n,t,e))];case"Square":return[r.square(D("x",n,t,e))];case"Tanh":return[r.tanh(D("x",n,t,e))];case"Tan":return[r.tan(D("x",n,t,e))];case"ClipByValue":return[r.clipByValue(D("x",n,t,e),D("clipValueMin",n,t,e),D("clipValueMax",n,t,e))];case"Relu6":return[r.relu6(D("x",n,t,e))];case"Rsqrt":return[r.rsqrt(Ar(n.inputNames[0],t,e))];case"LeakyRelu":return[r.leakyRelu(D("x",n,t,e),D("alpha",n,t,e))];case"Prelu":return[r.prelu(D("x",n,t,e),D("alpha",n,t,e))];case"IsNan":return[r.isNaN(Ar(n.inputNames[0],t,e))];case"IsInf":return[r.isInf(Ar(n.inputNames[0],t,e))];case"IsFinite":return[r.isFinite(Ar(n.inputNames[0],t,e))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};function Xi(n,t,e=""){if(!(typeof n=="number"||typeof t=="number")){b.assert(n.length===t.length,()=>e+` Shapes ${n} and ${t} must match`);for(let r=0;r<n.length;r++){let o=n[r],i=t[r];b.assert(o<0||i<0||o===i,()=>e+` Shapes ${n} and ${t} must match`)}}}function aY(n){return!(typeof n=="number"||n.some(t=>t<0))}function zx(n,t,e){let r=oT(n,e),o=!aY(r);if(o&&t.length===0)throw new Error(`Tried to calculate elements of an empty list with non-fully-defined elementShape: ${r}`);if(o&&t.forEach(i=>{r=oT(i.shape,r)}),!aY(r))throw new Error(`Non-fully-defined elementShape: ${r}`);return r}function oT(n,t){if(typeof n=="number")return t;if(typeof t=="number")return n;if(n.length!==t.length)throw new Error(`Incompatible ranks during merge: ${n} vs. ${t}`);let e=[];for(let r=0;r<n.length;++r){let o=n[r],i=t[r];if(o>=0&&i>=0&&o!==i)throw new Error(`Incompatible shape during merge: ${n} vs. ${t}`);e[r]=o>=0?o:i}return e}var iT=class{constructor(t,e,r,o,i,s,a){this.name=t,this.dtype=e,this.maxSize=r,this.elementShape=o,this.identicalElementShapes=i,this.dynamicSize=s,this.clearAfterRead=a,this.tensors=[],this.closed_=!1,this.idTensor=Ae(0),Wn(this.idTensor)}get id(){return this.idTensor.id}get closed(){return this.closed_}clearAndClose(t){this.tensors.forEach(e=>{(t==null||!t.has(e.tensor.id))&&e.tensor.dispose()}),this.tensors=[],this.closed_=!0,this.idTensor.dispose()}size(){return this.tensors.length}read(t){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(t<0||t>=this.size())throw new Error(`Tried to read from index ${t}, but array size is: ${this.size()}`);let e=this.tensors[t];if(e.cleared)throw new Error(`TensorArray ${this.name}: Could not read index ${t} twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?).`);return this.clearAfterRead&&(e.cleared=!0),e.read=!0,e.tensor}readMany(t){return t.map(e=>this.read(e))}write(t,e){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(t<0||!this.dynamicSize&&t>=this.maxSize)throw new Error(`Tried to write to index ${t}, but array is not resizeable and size is: ${this.maxSize}`);let r=this.tensors[t]||{};if(e.dtype!==this.dtype)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${t},
          because the value dtype is ${e.dtype}, but TensorArray dtype is ${this.dtype}.`);if(this.size()===0&&(this.elementShape==null||this.elementShape.length===0)&&(this.elementShape=e.shape),Xi(this.elementShape,e.shape,`TensorArray ${this.name}: Could not write to TensorArray index ${t}.`),r.read)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${t}, because it has already been read.`);if(r.written)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${t}, because it has already been written.`);r.tensor=e,Wn(e),r.written=!0,this.tensors[t]=r}writeMany(t,e){if(t.length!==e.length)throw new Error(`TensorArray ${this.name}: could not write multiple tensors,because the index size: ${t.length} is not the same as tensors size: ${e.length}.`);t.forEach((r,o)=>this.write(r,e[o]))}gather(t,e){if(e&&e!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but gather requested dtype ${e}`);if(t)t=t.slice(0,this.size());else{t=[];for(let o=0;o<this.size();o++)t.push(o)}if(t.length===0)return Yr([],[0].concat(this.elementShape));let r=this.readMany(t);return Xi(this.elementShape,r[0].shape,"TensorArray shape mismatch: "),sr(r,0)}concat(t){if(t&&t!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but concat requested dtype ${t}`);if(this.size()===0)return Yr([],[0].concat(this.elementShape));let e=[];for(let o=0;o<this.size();o++)e.push(o);let r=this.readMany(e);return Xi(this.elementShape,r[0].shape,`TensorArray shape mismatch: tensor array shape (${this.elementShape}) vs first tensor shape (${r[0].shape})`),Gt(r,0)}scatter(t,e){if(e.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${e.dtype}`);if(t.length!==e.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${t.length} vs. ${e.shape[0]}`);let r=Math.max(...t);if(!this.dynamicSize&&r>=this.maxSize)throw new Error(`Max index must be < array size (${r}  vs. ${this.maxSize})`);this.writeMany(t,$r(e,0))}split(t,e){if(e.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${e.dtype}`);let r=0,o=t.map(l=>(r+=l,r));if(r!==e.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        ${r}, and tensor's shape is: ${e.shape}`);if(!this.dynamicSize&&t.length!==this.maxSize)throw new Error(`TensorArray's size is not equal to the size of lengths (${this.maxSize} vs. ${t.length}), and the TensorArray is not marked as dynamically resizeable`);let i=r===0?0:e.size/r,s=[];Z(()=>{e=G(e,[1,r,i]);for(let l=0;l<t.length;++l){let u=[0,l===0?0:o[l-1],0],d=[1,t[l],i];s[l]=G(Je(e,u,d),this.elementShape)}return s});let a=[];for(let l=0;l<t.length;l++)a[l]=l;this.writeMany(a,s)}};var Ux=class n{get id(){return this.idTensor.id}constructor(t,e,r,o=-1){this.tensors=t,this.elementShape=e,this.elementDtype=r,t?.forEach(i=>{if(r!==i.dtype)throw new Error(`Invalid data types; op elements ${r}, but list elements ${i.dtype}`);Xi(e,i.shape,"TensorList shape mismatch: "),Wn(i)}),this.idTensor=Ae(0),this.maxNumElements=o,Wn(this.idTensor)}copy(){return new n([...this.tensors],this.elementShape,this.elementDtype)}clearAndClose(t){this.tensors.forEach(e=>{(t==null||!t.has(e.id))&&e.dispose()}),this.tensors.length=0,this.idTensor.dispose()}size(){return this.tensors.length}stack(t,e,r=-1){if(e!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e}, but list elements ${this.elementDtype}`);if(r!==-1&&this.tensors.length!==r)throw new Error(`Operation expected a list with ${r} elements but got a list with ${this.tensors.length} elements.`);Xi(t,this.elementShape,"TensorList shape mismatch: ");let o=zx(this.elementShape,this.tensors,t);return Z(()=>{let i=this.tensors.map(s=>G(s,o));return sr(i,0)})}popBack(t,e){if(e!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e}, but list elements ${this.elementDtype}`);if(this.size()===0)throw new Error("Trying to pop from an empty list.");let r=zx(this.elementShape,this.tensors,t),o=this.tensors.pop();return o.kept=!1,Xi(o.shape,t,"TensorList shape mismatch: "),G(o,r)}pushBack(t){if(t.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t.dtype}, but list elements ${this.elementDtype}`);if(Xi(t.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");Wn(t),this.tensors.push(t)}resize(t){if(t<0)throw new Error(`TensorListResize expects size to be non-negative. Got: ${t}`);if(this.maxNumElements!==-1&&t>this.maxNumElements)throw new Error(`TensorListResize input size ${t} is greater maxNumElement ${this.maxNumElements}.`);let e=new n([],this.elementShape,this.elementDtype,this.maxNumElements);e.tensors.length=t;for(let r=0;r<Math.min(this.tensors.length,t);++r)e.tensors[r]=this.tensors[r];return e}getItem(t,e,r){if(r!==this.elementDtype)throw new Error(`Invalid data types; op elements ${r}, but list elements ${this.elementDtype}`);if(t<0||t>this.tensors.length)throw new Error(`Trying to access element ${t} in a list with ${this.tensors.length} elements.`);if(this.tensors[t]==null)throw new Error(`element at index ${t} is null.`);Xi(this.tensors[t].shape,e,"TensorList shape mismatch: ");let o=zx(this.elementShape,this.tensors,e);return G(this.tensors[t],o)}setItem(t,e){if(e.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e.dtype}, but list elements ${this.elementDtype}`);if(t<0||this.maxNumElements!==-1&&t>=this.maxNumElements)throw new Error(`Trying to set element ${t} in a list with max ${this.maxNumElements} elements.`);Xi(this.elementShape,e.shape,"TensorList shape mismatch: "),Wn(e),this.tensors[t]!=null&&(this.tensors[t].kept=!1),this.tensors[t]=e}gather(t,e,r){if(e!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e}, but list elements ${this.elementDtype}`);Xi(this.elementShape,r,"TensorList shape mismatch: "),t=t.slice(0,this.size());let o=zx(this.elementShape,this.tensors,r);return t.length===0?Yr([],[0].concat(o)):Z(()=>{let i=t.map(s=>G(this.tensors[s],o));return sr(i,0)})}concat(t,e){if(t&&t!==this.elementDtype)throw new Error(`TensorList dtype is ${this.elementDtype} but concat requested dtype ${t}`);Xi(this.elementShape,e,"TensorList shape mismatch: ");let r=zx(this.elementShape,this.tensors,e);return this.size()===0?Yr([],[0].concat(r)):Z(()=>{let o=this.tensors.map(i=>G(i,r));return Gt(o,0)})}};function lY(n,t,e){let r=n.dtype;if(n.shape.length<1)throw new Error(`Tensor must be at least a vector, but saw shape: ${n.shape}`);if(n.dtype!==e)throw new Error(`Invalid data types; op elements ${n.dtype}, but list elements ${e}`);let o=n.shape.slice(1);Xi(o,t,"TensorList shape mismatch: ");let i=$r(n);return new Ux(i,t,r)}function cY(n,t,e,r){return new Ux([],n,t,r)}function uY(n,t,e,r){if(t.length!==n.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${t.length} vs. ${n.shape[0]}`);let o=Math.max(...t);if(r!=null&&r!==-1&&o>=r)throw new Error(`Max index must be < array size (${o}  vs. ${r})`);let i=new Ux([],e,n.dtype,r),s=$r(n,0);return t.forEach((a,l)=>{i.setItem(a,s[l])}),i}function dY(n,t,e){let r=0,o=t.map(u=>(r+=u,r));if(r!==n.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        ${r}, and tensor's shape is: ${n.shape}`);let i=n.shape.slice(1),s=oT(i,e),a=r===0?0:n.size/r,l=Z(()=>{let u=[];n=G(n,[1,r,a]);for(let d=0;d<t.length;++d){let f=[0,d===0?0:o[d-1],0],h=[1,t[d],a];u[d]=G(Je(n,f,h),s)}return n.dispose(),u}),c=new Ux([],e,n.dtype,t.length);for(let u=0;u<l.length;u++)c.setItem(u,l[u]);return c}var pY=(n,t,e)=>B(void 0,null,function*(){switch(n.op){case"If":case"StatelessIf":{let r=D("thenBranch",n,t,e),o=D("elseBranch",n,t,e),i=D("cond",n,t,e),s=D("args",n,t,e);return(yield i.data())[0]?e.functionMap[r].executeFunctionAsync(s,e.tensorArrayMap,e.tensorListMap):e.functionMap[o].executeFunctionAsync(s,e.tensorArrayMap,e.tensorListMap)}case"While":case"StatelessWhile":{let r=D("body",n,t,e),o=D("cond",n,t,e),i=D("args",n,t,e),s=yield e.functionMap[o].executeFunctionAsync(i,e.tensorArrayMap,e.tensorListMap),a=i.map(u=>u.id),l=yield s[0].data();s.forEach(u=>{!u.kept&&a.indexOf(u.id)===-1&&u.dispose()});let c=i;for(;l[0];){let u=c;c=yield e.functionMap[r].executeFunctionAsync(c,e.tensorArrayMap,e.tensorListMap);let d=c.map(f=>f.id);u.forEach(f=>{!f.kept&&a.indexOf(f.id)===-1&&d.indexOf(f.id)===-1&&f.dispose()});let p=yield e.functionMap[o].executeFunctionAsync(c,e.tensorArrayMap,e.tensorListMap);l=yield p[0].data(),p.forEach(f=>{!f.kept&&a.indexOf(f.id)===-1&&d.indexOf(f.id)===-1&&f.dispose()})}return c}case"LoopCond":{let r=D("pred",n,t,e);return[Vl(r)]}case"Switch":{let r=D("pred",n,t,e),o=D("data",n,t,e);return o.kept||(o=Vl(o)),(yield r.data())[0]?[void 0,o]:[o,void 0]}case"Merge":{let r=n.inputNames.find(o=>Ar(o,t,e)!==void 0);if(r){let o=Ar(r,t,e);return[Vl(o)]}return}case"Enter":{let r=D("frameName",n,t,e),o=D("tensor",n,t,e);return e.enterFrame(r),[Vl(o)]}case"Exit":{let r=D("tensor",n,t,e);return e.exitFrame(),[Vl(r)]}case"NextIteration":{let r=D("tensor",n,t,e);return e.nextIteration(),[Vl(r)]}case"TensorArrayV3":{let r=D("size",n,t,e),o=D("dtype",n,t,e),i=D("elementShape",n,t,e),s=D("dynamicSize",n,t,e),a=D("clearAfterRead",n,t,e),l=D("identicalElementShapes",n,t,e),c=D("name",n,t,e),u=new iT(c,o,r,i,l,s,a);return e.addTensorArray(u),[u.idTensor,Ae(1)]}case"TensorArrayWriteV3":{let r=D("tensorArrayId",n,t,e),o=D("index",n,t,e),i=D("tensor",n,t,e),s=e.getTensorArray(r.id);return s.write(o,i),[s.idTensor]}case"TensorArrayReadV3":{let r=D("tensorArrayId",n,t,e),o=D("index",n,t,e);return[e.getTensorArray(r.id).read(o)]}case"TensorArrayGatherV3":{let r=D("tensorArrayId",n,t,e),o=D("indices",n,t,e),i=D("dtype",n,t,e);return[e.getTensorArray(r.id).gather(o,i)]}case"TensorArrayScatterV3":{let r=D("tensorArrayId",n,t,e),o=D("indices",n,t,e),i=D("tensor",n,t,e),s=e.getTensorArray(r.id);return s.scatter(o,i),[s.idTensor]}case"TensorArrayConcatV3":{let r=D("tensorArrayId",n,t,e),o=e.getTensorArray(r.id),i=D("dtype",n,t,e);return[o.concat(i)]}case"TensorArraySplitV3":{let r=D("tensorArrayId",n,t,e),o=D("tensor",n,t,e),i=D("lengths",n,t,e),s=e.getTensorArray(r.id);return s.split(i,o),[s.idTensor]}case"TensorArraySizeV3":{let r=D("tensorArrayId",n,t,e),o=e.getTensorArray(r.id);return[Ae(o.size(),"int32")]}case"TensorArrayCloseV3":{let r=D("tensorArrayId",n,t,e),o=e.getTensorArray(r.id);return o.clearAndClose(),[o.idTensor]}case"TensorListSetItem":{let r=D("tensorListId",n,t,e),o=D("index",n,t,e),i=D("tensor",n,t,e),s=e.getTensorList(r.id);return s.setItem(o,i),[s.idTensor]}case"TensorListGetItem":{let r=D("tensorListId",n,t,e),o=D("index",n,t,e),i=D("elementShape",n,t,e),s=D("elementDType",n,t,e);return[e.getTensorList(r.id).getItem(o,i,s)]}case"TensorListScatterV2":case"TensorListScatter":{let r=D("indices",n,t,e),o=D("tensor",n,t,e),i=D("elementShape",n,t,e),s=D("numElements",n,t,e),a=uY(o,r,i,s);return e.addTensorList(a),[a.idTensor]}case"TensorListReserve":case"EmptyTensorList":{let r=D("elementShape",n,t,e),o=D("elementDType",n,t,e),i;n.op==="TensorListReserve"?i="numElements":i="maxNumElements";let s=D(i,n,t,e),a=n.op==="TensorListReserve"?-1:s,l=cY(r,o,s,a);return e.addTensorList(l),[l.idTensor]}case"TensorListGather":{let r=D("tensorListId",n,t,e),o=D("indices",n,t,e),i=D("elementShape",n,t,e),s=D("elementDType",n,t,e);return[e.getTensorList(r.id).gather(o,s,i)]}case"TensorListStack":{let r=D("tensorListId",n,t,e),o=D("elementShape",n,t,e),i=D("elementDType",n,t,e),s=D("numElements",n,t,e);return[e.getTensorList(r.id).stack(o,i,s)]}case"TensorListFromTensor":{let r=D("tensor",n,t,e),o=D("elementShape",n,t,e),i=D("elementDType",n,t,e),s=lY(r,o,i);return e.addTensorList(s),[s.idTensor]}case"TensorListConcat":case"TensorListConcatV2":{let r=D("tensorListId",n,t,e),o=e.getTensorList(r.id),i=D("dtype",n,t,e),s=D("elementShape",n,t,e);return[o.concat(i,s)]}case"TensorListPushBack":{let r=D("tensorListId",n,t,e),o=D("tensor",n,t,e),i=e.getTensorList(r.id);return i.pushBack(o),[i.idTensor]}case"TensorListPopBack":{let r=D("tensorListId",n,t,e),o=D("elementShape",n,t,e),i=D("elementDType",n,t,e);return[e.getTensorList(r.id).popBack(o,i)]}case"TensorListSplit":{let r=D("tensor",n,t,e),o=D("elementShape",n,t,e),i=D("lengths",n,t,e),s=dY(r,i,o);return e.addTensorList(s),[s.idTensor]}case"TensorListLength":{let r=D("tensorListId",n,t,e),o=e.getTensorList(r.id);return[Ae(o.size(),"int32")]}case"TensorListResize":{let r=D("tensorListId",n,t,e),o=D("size",n,t,e),s=e.getTensorList(r.id).resize(o);return e.addTensorList(s),[s.idTensor]}default:throw TypeError(`Node type ${n.op} is not implemented`)}});function fY(n,t,e){let[r,o]=D("fusedOps",n,t,e),i=r==="biasadd",s=!i,a=o==="prelu",l=r==="fusedbatchnorm",c=D("numArgs",n,t,e);if(i){if(a&&c!==2)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!a&&i&&c!==1)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(l)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported");let u=D("strides",n,t,e),d=tw(n,t,e),p=D("dataFormat",n,t,e).toUpperCase(),f=D("dilations",n,t,e),[h,m]=D("args",n,t,e);s&&(m=h,h=void 0);let g=D("leakyreluAlpha",n,t,e);return{stride:u,pad:d,dataFormat:p,dilations:f,biasArg:h,preluArg:m,activationFunc:o,leakyreluAlpha:g}}var hY=(n,t,e,r=nn)=>{switch(n.op){case"Conv1D":{let o=D("stride",n,t,e),i=D("pad",n,t,e),s=D("dataFormat",n,t,e).toUpperCase(),a=D("dilation",n,t,e);return[r.conv1d(D("x",n,t,e),D("filter",n,t,e),o,i,s,a)]}case"Conv2D":{let o=D("strides",n,t,e),i=tw(n,t,e),s=D("dataFormat",n,t,e).toUpperCase(),a=D("dilations",n,t,e);return[r.conv2d(D("x",n,t,e),D("filter",n,t,e),[o[1],o[2]],i,s,[a[1],a[2]])]}case"_FusedConv2D":{let{stride:o,pad:i,dataFormat:s,dilations:a,biasArg:l,preluArg:c,activationFunc:u,leakyreluAlpha:d}=fY(n,t,e);return[r.fused.conv2d({x:D("x",n,t,e),filter:D("filter",n,t,e),strides:[o[1],o[2]],pad:i,dataFormat:s,dilations:[a[1],a[2]],bias:l,activation:u,preluActivationWeights:c,leakyreluAlpha:d})]}case"FusedDepthwiseConv2dNative":{let{stride:o,pad:i,dataFormat:s,dilations:a,biasArg:l,preluArg:c,activationFunc:u,leakyreluAlpha:d}=fY(n,t,e);return[r.fused.depthwiseConv2d({x:D("x",n,t,e),filter:D("filter",n,t,e),strides:[o[1],o[2]],pad:i,dataFormat:s,dilations:[a[1],a[2]],bias:l,activation:u,preluActivationWeights:c,leakyreluAlpha:d})]}case"Conv2DBackpropInput":case"Conv2dTranspose":{let o=D("outputShape",n,t,e),i=D("strides",n,t,e),s=tw(n,t,e);return[r.conv2dTranspose(D("x",n,t,e),D("filter",n,t,e),o,[i[1],i[2]],s)]}case"DepthwiseConv2dNative":case"DepthwiseConv2d":{let o=D("strides",n,t,e),i=tw(n,t,e),s=D("dilations",n,t,e),a=D("dataFormat",n,t,e).toUpperCase();return[r.depthwiseConv2d(D("input",n,t,e),D("filter",n,t,e),[o[1],o[2]],i,a,[s[1],s[2]])]}case"Conv3D":{let o=D("strides",n,t,e),i=D("pad",n,t,e),s=D("dataFormat",n,t,e).toUpperCase(),a=D("dilations",n,t,e);return[r.conv3d(D("x",n,t,e),D("filter",n,t,e),[o[1],o[2],o[3]],i,s,[a[1],a[2],a[3]])]}case"AvgPool":{let o=D("strides",n,t,e),i=D("pad",n,t,e),s=D("kernelSize",n,t,e);return[r.avgPool(D("x",n,t,e),[s[1],s[2]],[o[1],o[2]],i)]}case"MaxPool":{let o=D("strides",n,t,e),i=D("pad",n,t,e),s=D("kernelSize",n,t,e);return[r.maxPool(D("x",n,t,e),[s[1],s[2]],[o[1],o[2]],i)]}case"MaxPoolWithArgmax":{let o=D("strides",n,t,e),i=D("pad",n,t,e),s=D("kernelSize",n,t,e),a=D("includeBatchInIndex",n,t,e),{result:l,indexes:c}=r.maxPoolWithArgmax(D("x",n,t,e),[s[1],s[2]],[o[1],o[2]],i,a);return[l,c]}case"AvgPool3D":{let o=D("strides",n,t,e),i=D("pad",n,t,e),s=D("kernelSize",n,t,e);return[r.avgPool3d(D("x",n,t,e),[s[1],s[2],s[3]],[o[1],o[2],o[3]],i)]}case"MaxPool3D":{let o=D("strides",n,t,e),i=D("pad",n,t,e),s=D("kernelSize",n,t,e);return[r.maxPool3d(D("x",n,t,e),[s[1],s[2],s[3]],[o[1],o[2],o[3]],i)]}case"Dilation2D":{let o=D("strides",n,t,e),i=D("pad",n,t,e),s=D("dilations",n,t,e),a=o[1],l=o[2],c=s[1],u=s[2];return[r.dilation2d(D("x",n,t,e),D("filter",n,t,e),[a,l],i,[c,u],"NHWC")]}default:throw TypeError(`Node type ${n.op} is not implemented`)}};var mY=(n,t,e,r=nn)=>{switch(n.op){case"Fill":{let o=D("shape",n,t,e),i=D("dtype",n,t,e),s=D("value",n,t,e);return[r.fill(o,s,i)]}case"LinSpace":{let o=D("start",n,t,e),i=D("stop",n,t,e),s=D("num",n,t,e);return[r.linspace(o,i,s)]}case"Multinomial":{let o=D("logits",n,t,e),i=D("numSamples",n,t,e),s=D("seed",n,t,e);return[r.multinomial(o,i,s)]}case"OneHot":{let o=D("indices",n,t,e),i=D("depth",n,t,e),s=D("onValue",n,t,e),a=D("offValue",n,t,e),l=D("dtype",n,t,e);return[r.oneHot(o,i,s,a,l)]}case"Ones":return[r.ones(D("shape",n,t,e),D("dtype",n,t,e))];case"OnesLike":return[r.onesLike(D("x",n,t,e))];case"RandomStandardNormal":return[r.randomStandardNormal(D("shape",n,t,e),D("dtype",n,t,e),D("seed",n,t,e))];case"RandomUniform":return[r.randomUniform(D("shape",n,t,e),D("minval",n,t,e),D("maxval",n,t,e),D("dtype",n,t,e))];case"RandomUniformInt":return[r.randomUniformInt(D("shape",n,t,e),D("minval",n,t,e),D("maxval",n,t,e),D("seed",n,t,e))];case"Range":{let o=D("start",n,t,e),i=D("stop",n,t,e),s=D("step",n,t,e);return[r.range(o,i,s,D("dtype",n,t,e))]}case"TruncatedNormal":{let o=D("shape",n,t,e),i=D("mean",n,t,e),s=D("stdDev",n,t,e),a=D("seed",n,t,e);return[r.truncatedNormal(o,i,s,D("dtype",n,t,e),a)]}case"Zeros":return[r.zeros(D("shape",n,t,e),D("dtype",n,t,e))];case"ZerosLike":return[r.zerosLike(D("x",n,t,e))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};function qL(n,t,e){let r=D("boxes",n,t,e),o=D("scores",n,t,e),i=D("maxOutputSize",n,t,e),s=D("iouThreshold",n,t,e),a=D("scoreThreshold",n,t,e),l=D("softNmsSigma",n,t,e);return{boxes:r,scores:o,maxOutputSize:i,iouThreshold:s,scoreThreshold:a,softNmsSigma:l}}var gY=(i,s,a,l,...c)=>B(void 0,[i,s,a,l,...c],function*(n,t,e,r,o=nn){switch(n.op){case"NonMaxSuppressionV5":{let{boxes:u,scores:d,maxOutputSize:p,iouThreshold:f,scoreThreshold:h,softNmsSigma:m}=qL(n,t,e),g=yield o.image.nonMaxSuppressionWithScoreAsync(u,d,p,f,h,m);return[g.selectedIndices,g.selectedScores]}case"NonMaxSuppressionV4":{let{boxes:u,scores:d,maxOutputSize:p,iouThreshold:f,scoreThreshold:h}=qL(n,t,e),m=D("padToMaxOutputSize",n,t,e),g=yield o.image.nonMaxSuppressionPaddedAsync(u,d,p,f,h,m);return[g.selectedIndices,g.validOutputs]}case"NonMaxSuppressionV3":case"NonMaxSuppressionV2":{let{boxes:u,scores:d,maxOutputSize:p,iouThreshold:f,scoreThreshold:h}=qL(n,t,e);return[yield o.image.nonMaxSuppressionAsync(u,d,p,f,h)]}case"Where":{let u=o.cast(D("condition",n,t,e),"bool"),d=[yield o.whereAsync(u)];return u.dispose(),d}case"ListDiff":return o.setdiff1dAsync(D("x",n,t,e),D("y",n,t,e));default:throw TypeError(`Node type ${n.op} is not implemented`)}});var yY=(n,t,e,r=nn)=>{switch(n.op){case"LowerBound":{let o=D("sortedSequence",n,t,e),i=D("values",n,t,e);return[r.lowerBound(o,i)]}case"TopKV2":{let o=D("x",n,t,e),i=D("k",n,t,e),s=D("sorted",n,t,e),a=r.topk(o,i,s);return[a.values,a.indices]}case"UpperBound":{let o=D("sortedSequence",n,t,e),i=D("values",n,t,e);return[r.upperBound(o,i)]}case"Unique":{let o=D("x",n,t,e),i=r.unique(o);return[i.values,i.indices]}case"UniqueV2":{let o=D("x",n,t,e),i=D("axis",n,t,e),s=r.unique(o,i);return[s.values,s.indices]}default:throw TypeError(`Node type ${n.op} is not implemented`)}};var xY=(n,t,e,r=nn)=>{switch(n.op){case"Const":return t[n.name];case"PlaceholderWithDefault":let o=D("default",n,t,e);return[Ar(n.name,t,e)||o];case"Placeholder":return[Ar(n.name,t,e)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":{let u=D("x",n,t,e);return[Vl(u)]}case"IdentityN":return D("x",n,t,e).map(u=>Vl(u));case"Snapshot":let i=D("x",n,t,e);return[Vl(i)];case"Shape":return[r.tensor1d(D("x",n,t,e).shape,"int32")];case"ShapeN":return D("x",n,t,e).map(u=>r.tensor1d(u.shape));case"Size":return[r.scalar(D("x",n,t,e).size,"int32")];case"Rank":return[r.scalar(D("x",n,t,e).rank,"int32")];case"NoOp":return[r.scalar(1)];case"Print":let s=D("x",n,t,e),a=D("data",n,t,e),l=D("message",n,t,e),c=D("summarize",n,t,e);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(l);for(let u=0;u<a.length;u++)console.log(Array.prototype.slice.call(a[u].dataSync()).slice(0,c));return[s];default:throw TypeError(`Node type ${n.op} is not implemented`)}};var sT=class{get id(){return this.handle.id}constructor(t,e){this.keyDType=t,this.valueDType=e,this.handle=Ae(0),this.tensorMap=new Map,Wn(this.handle)}clearAndClose(){this.tensorMap.forEach(t=>t.dispose()),this.tensorMap.clear(),this.handle.dispose()}size(){return this.tensorMap.size}tensorSize(){return Ae(this.size(),"int32")}import(t,e){return B(this,null,function*(){this.checkKeyAndValueTensor(t,e);let r=yield t.data();return this.tensorMap.forEach(o=>o.dispose()),this.tensorMap.clear(),Z(()=>{let o=$r(e),i=r.length,s=o.length;b.assert(i===s,()=>`The number of elements doesn't match, keys has ${i} elements, the values has ${s} elements.`);for(let a=0;a<i;a++){let l=r[a],c=o[a];Wn(c),this.tensorMap.set(l,c)}return this.handle})})}find(t,e){return B(this,null,function*(){this.checkKeyAndValueTensor(t,e);let r=yield t.data();return Z(()=>{let o=[];for(let i=0;i<r.length;i++){let s=r[i],a=this.findWithDefault(s,e);o.push(a)}return sr(o)})})}findWithDefault(t,e){let r=this.tensorMap.get(t);return r??e}checkKeyAndValueTensor(t,e){if(t.dtype!==this.keyDType)throw new Error(`Expect key dtype ${this.keyDType}, but got ${t.dtype}`);if(e.dtype!==this.valueDType)throw new Error(`Expect value dtype ${this.valueDType}, but got ${e.dtype}`)}};var vY=(n,t,e,r)=>B(void 0,null,function*(){switch(n.op){case"HashTable":case"HashTableV2":{let o=r.getHashTableHandleByName(n.name);if(o!=null)return[o];{let i=D("keyDType",n,t,e),s=D("valueDType",n,t,e),a=new sT(i,s);return r.addHashTable(n.name,a),[a.handle]}}case"InitializeTable":case"InitializeTableV2":case"LookupTableImport":case"LookupTableImportV2":{let o=D("tableHandle",n,t,e,r),i=D("keys",n,t,e),s=D("values",n,t,e);return[yield r.getHashTableById(o.id).import(i,s)]}case"LookupTableFind":case"LookupTableFindV2":{let o=D("tableHandle",n,t,e,r),i=D("keys",n,t,e),s=D("defaultValue",n,t,e);return[yield r.getHashTableById(o.id).find(i,s)]}case"LookupTableSize":case"LookupTableSizeV2":{let o=D("tableHandle",n,t,e,r);return[r.getHashTableById(o.id).tensorSize()]}default:throw TypeError(`Node type ${n.op} is not implemented`)}});var bY=(n,t,e,r=nn)=>{switch(n.op){case"ResizeBilinear":{let o=D("images",n,t,e),i=D("size",n,t,e),s=D("alignCorners",n,t,e),a=D("halfPixelCenters",n,t,e);return[r.image.resizeBilinear(o,[i[0],i[1]],s,a)]}case"ResizeNearestNeighbor":{let o=D("images",n,t,e),i=D("size",n,t,e),s=D("alignCorners",n,t,e),a=D("halfPixelCenters",n,t,e);return[r.image.resizeNearestNeighbor(o,[i[0],i[1]],s,a)]}case"CropAndResize":{let o=D("image",n,t,e),i=D("boxes",n,t,e),s=D("boxInd",n,t,e),a=D("cropSize",n,t,e),l=D("method",n,t,e),c=D("extrapolationValue",n,t,e);return[r.image.cropAndResize(o,i,s,a,l,c)]}case"ImageProjectiveTransformV3":{let o=D("images",n,t,e),i=D("transforms",n,t,e),s=D("outputShape",n,t,e),a=D("fillValue",n,t,e),l=D("interpolation",n,t,e),c=D("fillMode",n,t,e);return[r.image.transform(o,i,l.toLowerCase(),c.toLowerCase(),a,s)]}default:throw TypeError(`Node type ${n.op} is not implemented`)}};var wY=(n,t,e,r=nn)=>{switch(n.op){case"Equal":return[r.equal(D("a",n,t,e),D("b",n,t,e))];case"NotEqual":return[r.notEqual(D("a",n,t,e),D("b",n,t,e))];case"Greater":return[r.greater(D("a",n,t,e),D("b",n,t,e))];case"GreaterEqual":return[r.greaterEqual(D("a",n,t,e),D("b",n,t,e))];case"Less":return[r.less(D("a",n,t,e),D("b",n,t,e))];case"LessEqual":return[r.lessEqual(D("a",n,t,e),D("b",n,t,e))];case"LogicalAnd":return[r.logicalAnd(D("a",n,t,e),D("b",n,t,e))];case"LogicalNot":return[r.logicalNot(D("a",n,t,e))];case"LogicalOr":return[r.logicalOr(D("a",n,t,e),D("b",n,t,e))];case"Select":case"SelectV2":return[r.where(D("condition",n,t,e),D("a",n,t,e),D("b",n,t,e))];case"BitwiseAnd":return[r.bitwiseAnd(D("a",n,t,e),D("b",n,t,e))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};var CY=(n,t,e,r=nn)=>{switch(n.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[r.matMul(D("a",n,t,e),D("b",n,t,e),D("transposeA",n,t,e),D("transposeB",n,t,e))];case"Einsum":return[r.einsum(D("equation",n,t,e),...D("tensors",n,t,e))];case"Transpose":return[r.transpose(D("x",n,t,e),D("perm",n,t,e))];case"_FusedMatMul":let[o,i]=D("fusedOps",n,t,e),s=o==="biasadd",a=i==="prelu",l=D("numArgs",n,t,e),c=D("leakyreluAlpha",n,t,e);if(s){if(a&&l!==2)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!a&&l!==1)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}let[u,d]=D("args",n,t,e);return[r.fused.matMul({a:D("a",n,t,e),b:D("b",n,t,e),transposeA:D("transposeA",n,t,e),transposeB:D("transposeB",n,t,e),bias:u,activation:i,preluActivationWeights:d,leakyreluAlpha:c})];case"MatrixBandPart":return[r.linalg.bandPart(D("a",n,t,e),D("numLower",n,t,e),D("numUpper",n,t,e))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};var _Y=(n,t,e,r=nn)=>{switch(n.op){case"EuclideanNorm":return[r.euclideanNorm(D("x",n,t,e),D("axis",n,t,e),D("keepDims",n,t,e))];case"FusedBatchNorm":case"FusedBatchNormV2":return[r.batchNorm(D("x",n,t,e),D("mean",n,t,e),D("variance",n,t,e),D("offset",n,t,e),D("scale",n,t,e),D("epsilon",n,t,e))];case"FusedBatchNormV3":return[r.batchNorm(D("x",n,t,e),D("mean",n,t,e),D("variance",n,t,e),D("offset",n,t,e),D("scale",n,t,e),D("epsilon",n,t,e))];case"LRN":return[r.localResponseNormalization(D("x",n,t,e),D("radius",n,t,e),D("bias",n,t,e),D("alpha",n,t,e),D("beta",n,t,e))];case"Softmax":return[r.softmax(D("x",n,t,e))];case"LogSoftmax":return[r.logSoftmax(D("x",n,t,e))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};var SY=(n,t,e,r=nn)=>{switch(n.op){case"RaggedGather":{let{outputNestedSplits:o,outputDenseValues:i}=r.raggedGather(D("paramsNestedSplits",n,t,e),D("paramsDenseValues",n,t,e),D("indices",n,t,e),D("outputRaggedRank",n,t,e));return o.concat(i)}case"RaggedRange":{let{rtNestedSplits:o,rtDenseValues:i}=r.raggedRange(D("starts",n,t,e),D("limits",n,t,e),D("splits",n,t,e));return[o,i]}case"RaggedTensorToTensor":return[r.raggedTensorToTensor(D("shape",n,t,e),D("values",n,t,e),D("defaultValue",n,t,e),D("rowPartitionTensors",n,t,e),D("rowPartitionTypes",n,t,e))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};var IY=(n,t,e,r=nn)=>{switch(n.op){case"Max":{let a=D("axis",n,t,e),l=D("keepDims",n,t,e);return[r.max(D("x",n,t,e),a,l)]}case"Mean":{let a=D("axis",n,t,e),l=D("keepDims",n,t,e);return[r.mean(D("x",n,t,e),a,l)]}case"Min":{let a=D("axis",n,t,e),l=D("keepDims",n,t,e);return[r.min(D("x",n,t,e),a,l)]}case"Sum":{let a=D("axis",n,t,e),l=D("keepDims",n,t,e);return[r.sum(D("x",n,t,e),a,l)]}case"All":{let a=D("axis",n,t,e),l=D("keepDims",n,t,e);return[r.all(D("x",n,t,e),a,l)]}case"Any":{let a=D("axis",n,t,e),l=D("keepDims",n,t,e);return[r.any(D("x",n,t,e),a,l)]}case"ArgMax":{let a=D("axis",n,t,e);return[r.argMax(D("x",n,t,e),a)]}case"ArgMin":{let a=D("axis",n,t,e);return[r.argMin(D("x",n,t,e),a)]}case"Prod":{let a=D("axis",n,t,e),l=D("keepDims",n,t,e);return[r.prod(D("x",n,t,e),a,l)]}case"Cumprod":{let a=D("axis",n,t,e),l=D("exclusive",n,t,e),c=D("reverse",n,t,e);return[r.cumprod(D("x",n,t,e),a,l,c)]}case"Cumsum":{let a=D("axis",n,t,e),l=D("exclusive",n,t,e),c=D("reverse",n,t,e);return[r.cumsum(D("x",n,t,e),a,l,c)]}case"Bincount":let o=D("x",n,t,e),i=D("weights",n,t,e),s=D("size",n,t,e);return[r.bincount(o,i,s)];case"DenseBincount":{let a=D("x",n,t,e),l=D("weights",n,t,e),c=D("size",n,t,e),u=D("binaryOutput",n,t,e);return[r.denseBincount(a,l,c,u)]}default:throw TypeError(`Node type ${n.op} is not implemented`)}};var EY=(n,t,e,r=nn)=>{switch(n.op){case"ConcatV2":case"Concat":{let o=D("n",n,t,e),i=D("axis",n,t,e),s=D("tensors",n,t,e);return s=s.slice(0,o),[r.concat(s,i)]}case"Gather":{let o=D("x",n,t,e),i=D("indices",n,t,e);return[r.gather(o,r.cast(i,"int32"),0)]}case"GatherV2":{let o=D("axis",n,t,e),i=D("batchDims",n,t,e),s=D("x",n,t,e),a=D("indices",n,t,e);return[r.gather(s,r.cast(a,"int32"),o,i)]}case"Reverse":{let o=D("dims",n,t,e),i=[];for(let a=0;a<o.length;a++)o[a]&&i.push(a);let s=D("x",n,t,e);return[r.reverse(s,i)]}case"ReverseV2":{let o=D("axis",n,t,e),i=D("x",n,t,e);return[r.reverse(i,o)]}case"Slice":{let o=D("begin",n,t,e),i=D("size",n,t,e);return[r.slice(D("x",n,t,e),o,i)]}case"StridedSlice":{let o=D("begin",n,t,e),i=D("end",n,t,e),s=D("strides",n,t,e),a=D("beginMask",n,t,e),l=D("endMask",n,t,e),c=D("ellipsisMask",n,t,e),u=D("newAxisMask",n,t,e),d=D("shrinkAxisMask",n,t,e),p=D("x",n,t,e);return[r.stridedSlice(p,o,i,s,a,l,c,u,d)]}case"Pack":return Z(()=>{let o=D("axis",n,t,e),i=D("tensors",n,t,e),s=i[0].shape,a=r.squeeze(i[0]).shape,l=i.map(c=>{let u=b.arraysEqual(c.shape,s);if(!u&&!b.arraysEqual(r.squeeze(c).shape,a))throw new Error("the input tensors shape does not match");return u?c:r.reshape(c,s)});return[r.stack(l,o)]});case"Unpack":{let o=D("axis",n,t,e),i=D("tensor",n,t,e);return r.unstack(i,o)}case"Tile":{let o=D("reps",n,t,e);return[r.tile(D("x",n,t,e),o)]}case"Split":case"SplitV":{let o=D("axis",n,t,e),i=D("numOrSizeSplits",n,t,e),s=D("x",n,t,e);return r.split(s,i,o)}case"ScatterNd":{let o=D("indices",n,t,e),i=D("values",n,t,e),s=D("shape",n,t,e);return[r.scatterND(o,i,s)]}case"GatherNd":{let o=D("x",n,t,e),i=D("indices",n,t,e);return[r.gatherND(o,i)]}case"SparseToDense":{let o=D("sparseIndices",n,t,e),i=D("outputShape",n,t,e),s=D("sparseValues",n,t,e),a=D("defaultValue",n,t,e);return[r.sparseToDense(o,s,i,s.dtype===a.dtype?a:r.cast(a,s.dtype))]}case"TensorScatterUpdate":{let o=D("indices",n,t,e),i=D("values",n,t,e),s=D("tensor",n,t,e);return[r.tensorScatterUpdate(s,o,i)]}default:throw TypeError(`Node type ${n.op} is not implemented`)}};var TY=(n,t,e,r=nn)=>{switch(n.op){case"SparseFillEmptyRows":{let{outputIndices:o,outputValues:i,emptyRowIndicator:s,reverseIndexMap:a}=r.sparse.sparseFillEmptyRows(D("indices",n,t,e),D("values",n,t,e),D("denseShape",n,t,e),D("defaultValue",n,t,e));return[o,i,s,a]}case"SparseReshape":{let{outputIndices:o,outputShape:i}=r.sparse.sparseReshape(D("inputIndices",n,t,e),D("inputShape",n,t,e),D("newShape",n,t,e));return[o,i]}case"SparseSegmentMean":return[r.sparse.sparseSegmentMean(D("data",n,t,e),D("indices",n,t,e),D("segmentIds",n,t,e))];case"SparseSegmentSum":return[r.sparse.sparseSegmentSum(D("data",n,t,e),D("indices",n,t,e),D("segmentIds",n,t,e))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};var DY=(n,t,e,r=nn)=>{switch(n.op){case"FFT":return[r.fft(D("x",n,t,e))];case"IFFT":return[r.ifft(D("x",n,t,e))];case"RFFT":return[r.rfft(D("x",n,t,e))];case"IRFFT":return[r.irfft(D("x",n,t,e))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};var kY=(n,t,e,r=nn)=>{switch(n.op){case"StaticRegexReplace":return[r.string.staticRegexReplace(D("input",n,t,e),D("pattern",n,t,e),D("rewrite",n,t,e),D("replaceGlobal",n,t,e))];case"StringNGrams":{let{nGrams:o,nGramsSplits:i}=r.string.stringNGrams(D("data",n,t,e),D("dataSplits",n,t,e),D("separator",n,t,e),D("nGramWidths",n,t,e),D("leftPad",n,t,e),D("rightPad",n,t,e),D("padWidth",n,t,e),D("preserveShortSequences",n,t,e));return[o,i]}case"StringSplit":{let{indices:o,values:i,shape:s}=r.string.stringSplit(D("input",n,t,e),D("delimiter",n,t,e),D("skipEmpty",n,t,e));return[o,i,s]}case"StringToHashBucketFast":return[r.string.stringToHashBucketFast(D("input",n,t,e),D("numBuckets",n,t,e))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};var NY=(n,t,e,r=nn)=>{switch(n.op){case"Cast":return[r.cast(D("x",n,t,e),D("dtype",n,t,e))];case"ExpandDims":{let o=D("axis",n,t,e);return[r.expandDims(D("x",n,t,e),o)]}case"Squeeze":{let o=D("axis",n,t,e);return[r.squeeze(D("x",n,t,e),o)]}case"Reshape":return[r.reshape(D("x",n,t,e),D("shape",n,t,e))];case"EnsureShape":return[r.ensureShape(D("x",n,t,e),D("shape",n,t,e))];case"MirrorPad":return[r.mirrorPad(D("x",n,t,e),D("padding",n,t,e),D("mode",n,t,e))];case"PadV2":case"Pad":return[r.pad(D("x",n,t,e),D("padding",n,t,e),D("constantValue",n,t,e))];case"SpaceToBatchND":{let o=D("blockShape",n,t,e),i=D("paddings",n,t,e);return[r.spaceToBatchND(D("x",n,t,e),o,i)]}case"BatchToSpaceND":{let o=D("blockShape",n,t,e),i=D("crops",n,t,e);return[r.batchToSpaceND(D("x",n,t,e),o,i)]}case"DepthToSpace":{let o=D("blockSize",n,t,e),i=D("dataFormat",n,t,e).toUpperCase();return[r.depthToSpace(D("x",n,t,e),o,i)]}case"BroadcastTo":return[r.broadcastTo(D("x",n,t,e),D("shape",n,t,e))];case"BroadcastArgs":return[r.broadcastArgs(D("s0",n,t,e),D("s1",n,t,e))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};function KL(n,t,e,r,o=Z){let i=((s,a,l)=>{switch(s.category){case"arithmetic":return o(()=>iY(s,a,l));case"basic_math":return o(()=>sY(s,a,l));case"control":return pY(s,a,l);case"convolution":return o(()=>hY(s,a,l));case"creation":return o(()=>mY(s,a,l));case"dynamic":return gY(s,a,l);case"evaluation":return o(()=>yY(s,a,l));case"image":return o(()=>bY(s,a,l));case"graph":return o(()=>xY(s,a,l));case"logical":return o(()=>wY(s,a,l));case"matrices":return o(()=>CY(s,a,l));case"normalization":return o(()=>_Y(s,a,l));case"ragged":return o(()=>SY(s,a,l));case"reduction":return o(()=>IY(s,a,l));case"slice_join":return o(()=>EY(s,a,l));case"sparse":return o(()=>TY(s,a,l));case"spectral":return o(()=>DY(s,a,l));case"string":return o(()=>kY(s,a,l));case"transformation":return o(()=>NY(s,a,l));case"hash_table":return vY(s,a,l,r);case"custom":let c=jE(s.op);if(c&&c.customExecutor)return c.customExecutor(new rT(s,a,l));throw TypeError(`Custom op ${s.op} is not registered.`);default:throw TypeError(`Unknown op '${s.op}'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()`)}})(n,t,e);return b.isPromise(i)?i.then(s=>[].concat(s)):[].concat(i)}var rw=class{constructor(t={},e={},r={},o={},i){this.weightMap=t,this.tensorArrayMap=e,this.tensorListMap=r,this.functionMap=o,this.parseNodeNameCache=i,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}newFrame(t,e){return{id:t,frameName:e,iterationId:0}}set currentContext(t){this.contexts!==t&&(this.contexts=t,this.generateCurrentContextIds())}get currentContext(){return this.contexts}get currentContextId(){return this._currentContextIds[0]}get currentContextIds(){return this._currentContextIds}generateCurrentContextIds(){let t=[];for(let e=0;e<this.contexts.length-1;e++){let r=this.contexts.slice(0,this.contexts.length-e);t.push(this.contextIdforContexts(r))}t.push(""),this._currentContextIds=t}contextIdforContexts(t){return t?t.map(e=>e.id===0&&e.iterationId===0?"":`${e.frameName}-${e.iterationId}`).join("/"):""}enterFrame(t){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,t)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))}exitFrame(){if(this.contexts&&this.contexts.length>1)this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift();else throw new Error("Cannot exit frame, the context is empty")}nextIteration(){if(this.contexts&&this.contexts.length>0){this.contexts=this.contexts.slice(),this.lastId++;let t=Object.assign({},this.contexts[this.contexts.length-1]);t.iterationId+=1,t.id=this.lastId,this.contexts.splice(-1,1,t),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}else throw new Error("Cannot increase frame iteration, the context is empty")}getWeight(t){return this.weightMap[t]}addTensorArray(t){this.tensorArrayMap[t.id]=t}getTensorArray(t){return this.tensorArrayMap[t]}addTensorList(t){this.tensorListMap[t.id]=t}getTensorList(t){return this.tensorListMap[t]}dispose(t){for(let e in this.tensorArrayMap)this.tensorArrayMap[e].clearAndClose(t);for(let e in this.tensorListMap)this.tensorListMap[e].clearAndClose(t)}};function XL(n,t,e,r){let o=new Set,i=[],s=null,a=null,l=new Set,c=new Set(Object.keys(n).map(p=>ii(p)[0]));r=r||[];let u=new Set(r.map(p=>ii(p.name)[0])),d=[...t];for(;d.length>0;){let p=d.pop();if((Zf(p)||AMe(p)||RMe(p))&&s==null&&(s=p,a=s.children.map(f=>f.name).filter(f=>o.has(f))),o.add(p.name),e[p.name]==null&&!c.has(p.name)&&!u.has(p.name)){if(p.inputs.length===0){i.push(p.name);continue}p.inputs.forEach(f=>{l.has(f.name)||(l.add(f.name),d.push(f))})}}return{inputs:n,outputs:t,usedNodes:o,missingInputs:i,dynamicNode:s,syncInputs:a}}function AY(n,t){let{usedNodes:e,inputs:r}=t,o=Object.keys(r).map(g=>ii(g)[0]).map(g=>n.nodes[g]),i=n.initNodes||[],s=g=>e.has(typeof g=="string"?g:g.name);function a(g){return[...new Map(g.map(y=>[y.name,y])).values()]}let l=a([...o,...n.weights,...i]).filter(s),c=a([...l,...Object.values(n.nodes)]).filter(s),u=new Map(c.map(g=>[g.name,g])),d={};for(let g of c){d[g.name]=d[g.name]||0;for(let y of g.children)s(y)||(d[y.name]=Number.POSITIVE_INFINITY),d[y.name]=(d[y.name]||0)+1}let p=Object.entries(d).filter(([,g])=>g===0).map(([g])=>g),f=[...p];for(;p.length>0;){let g=p.pop(),y=u.get(g);for(let v of y.children.filter(s))--d[v.name]===0&&(f.push(v.name),p.push(v.name))}let h=f.map(g=>u.get(g)),m=EMe(h,l);return TMe(m,l),m}function EMe(n,t){let e=new Map(n.map(s=>[s.name,s])),r=t.map(s=>s.name),o=new Set(r);for(;r.length>0;){let s=r.pop(),a=e.get(s);for(let l of a.children)!e.has(l.name)||o.has(l.name)||(o.add(l.name),r.push(l.name))}return n.filter(s=>o.has(s.name))}var Wx=class extends Error{constructor(t){super(`NodesExecutionOrderError: ${t}`)}};function TMe(n,t){let e=new Map(n.map((a,l)=>[a.name,l])),r=new Set(t.map(a=>a.name)),o=a=>r.has(typeof a=="string"?a:a.name),i=new Set(n.map(a=>a.name)),s=a=>i.has(typeof a=="string"?a:a.name);for(let a of n){for(let l of a.children.filter(s)){if(!e.has(l.name))throw new Wx(`Child ${l.name} of node ${a.name} is unreachable.`);if(e.get(a.name)>e.get(l.name))throw new Wx(`Node ${a.name} is scheduled to run after its child ${l.name}.`)}if(!o(a))for(let l of a.inputs){if(!e.has(l.name))throw new Wx(`Input ${l.name} of node ${a.name} is unreachable.`);if(e.get(l.name)>e.get(a.name))throw new Wx(`Node ${a.name} is scheduled to run before its input ${l.name}.`)}}}function RY(n){let t=new Map(n.map((a,l)=>[a.name,l])),e=Number.MAX_SAFE_INTEGER,r=n.map((a,l)=>Zf(a)?e:l),o=a=>{let l=r[t.get(a.name)];return l??-1},i=n.map((a,l)=>a.children.map(o).reduce((c,u)=>Math.max(c,u),r[l])),s=new Map;for(let a=0;a<n.length;++a){let l=i[a];if(l===e)continue;let c=n[a],u=n[l];s.has(u.name)||s.set(u.name,[]),s.get(u.name).push(c)}return s}var DMe=new Set(["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"]),kMe=new Set(["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"]),NMe=new Set(["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"]);function Zf(n){return DMe.has(n.op)}function AMe(n){return kMe.has(n.op)}function RMe(n){return NMe.has(n.op)}var ow=class n{get weightIds(){return this.parent?this.parent.weightIds:this._weightIds}get functionExecutorMap(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap}get weightMap(){return this.parent?this.parent.weightMap:this._weightMap}set weightMap(t){let e=Object.keys(t).map(r=>t[r].map(o=>o.id));this._weightIds=[].concat(...e),this._weightMap=t}set resourceManager(t){this._resourceManager=t}get inputs(){return this._inputs.map(t=>({name:t.name,shape:t.attrParams.shape?t.attrParams.shape.value:void 0,dtype:t.attrParams.dtype?t.attrParams.dtype.value:void 0}))}get outputs(){return this._outputs.map(t=>({name:t.name,shape:t.attrParams.shape?t.attrParams.shape.value:void 0,dtype:t.attrParams.dtype?t.attrParams.dtype.value:void 0}))}get inputNodes(){return this._inputs.map(t=>t.signatureKey||t.name)}get outputNodes(){return this._outputs.map(t=>{let e=t.signatureKey||t.name;return t.defaultOutput?`${e}:${t.defaultOutput}`:e})}get functions(){return Object.keys(this._functions).reduce((t,e)=>(t[e]=this._functions[e].signature,t),{})}constructor(t,e){this.graph=t,this.parent=e,this.compiledMap=new Map,this.parseNodeNameCache=new Map,this._weightMap={},this.SEPARATOR=",",this._functions={},this._functionExecutorMap={},this.keepIntermediateTensors=!1,this._outputs=t.outputs,this._inputs=t.inputs,this._initNodes=t.initNodes,this._signature=t.signature,this._functions=t.functions,t.functions!=null&&Object.keys(t.functions).forEach(r=>{this._functionExecutorMap[r]=new n(t.functions[r],this)})}getCompilationKey(t,e){let r=t.map(i=>i.name).sort(),o=e.map(i=>i.name).sort();return r.join(this.SEPARATOR)+"--"+o.join(this.SEPARATOR)}compile(t,e){let r=XL(t,e,this.weightMap,this._initNodes),{missingInputs:o,dynamicNode:i,syncInputs:s}=r;if(i!=null)throw new Error(`This execution contains the node '${i.name}', which has the dynamic op '${i.op}'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs [${s}]`);if(o.length>0){let c=e.map(d=>d.name),u=Object.keys(t);throw new Error(`Cannot compute the outputs [${c}] from the provided inputs [${u}]. Missing the following inputs: [${o}]`)}let a=AY(this.graph,r),l=RY(a);return{orderedNodes:a,nodeLiveUntilMap:l}}cloneAndKeepTensor(t){if(t==null)return null;let e=t.clone();return Wn(e),e}cloneTensorList(t){return t?t.map(r=>this.cloneAndKeepTensor(r)):null}cloneTensorMap(t){return Object.fromEntries(Object.entries(t).map(([e,r])=>[e,this.cloneTensorList(r)]))}execute(t,e){this.disposeIntermediateTensors(),t=this.mapInputs(t);let r=Object.keys(t).sort();this.checkInputs(t),this.checkInputShapeAndType(t),e=this.mapOutputs(e),this.checkOutputs(e);let o=r.map(p=>this.graph.nodes[ii(p)[0]]),i=e.map(p=>ii(p)[0]),s=new Set(i),a=i.map(p=>this.graph.nodes[p]);a.length===0&&(a=this._outputs);let l=this.getCompilationKey(o,a),c=this.compiledMap.get(l);c==null&&(c=this.compile(t,a),this.compiledMap.set(l,c));try{this.keepIntermediateTensors=q().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(p){this.keepIntermediateTensors=!1,console.warn(p.message)}let u={},d={};return Z(()=>{let p=new rw(this.weightMap,u,d,this.functionExecutorMap,this.parseNodeNameCache),f=Object.assign({},this.weightMap);this.keepIntermediateTensors&&(this.clonedTensorsMap=this.cloneTensorMap(this.weightMap)),Object.keys(t).forEach(y=>{let[v,w]=ii(y,p),C=[];C[w]=t[y],f[v]=C,this.keepIntermediateTensors&&(this.clonedTensorsMap[v]=this.cloneTensorList(C))});let h=this.getFrozenTensorIds(f),{orderedNodes:m,nodeLiveUntilMap:g}=c;for(let y of m){if(f[y.name])continue;let v=KL(y,f,p,this._resourceManager);if(b.isPromise(v))throw new Error(`The execution of the op '${y.op}' returned a promise. Please use model.executeAsync() instead.`);f[y.name]=v,this.keepIntermediateTensors&&(this.clonedTensorsMap[y.name]=this.cloneTensorList(v)),this.checkTensorForDisposalWithNodeLiveUntilInfo(y,f,p,h,s,g.get(y.name))}return this.parent==null&&p.dispose(h),e.map(y=>Ar(y,f,p))})}getFrozenTensorIds(t){let e=[].concat.apply([],Object.keys(t).map(r=>t[r]).map(r=>r.map(o=>o.id)));return new Set(e)}checkTensorForDisposal(t,e,r,o,i,s,a){if(!(Zf(e)||s.has(t))){for(let l of r[t])l!=null&&(a[l.id]=(a[l.id]||0)+e.children.length);for(let l of e.inputs){if(Zf(l))continue;let c=EL(l.name,r,o);if(c!=null)for(let u of c){if(!u||u.kept||i.has(u.id))continue;let d=a[u.id];d===1?(u.dispose(),delete a[u.id]):d!=null&&a[u.id]--}}}}checkTensorForDisposalWithNodeLiveUntilInfo(t,e,r,o,i,s){function a(l){return Zf(l)||i.has(l.name)}if(!(Zf(t)||s==null))for(let l of s){if(a(l))continue;let c=EL(l.name,e,r);for(let u of c)!u||u.kept||o.has(u.id)||u.dispose()}}executeAsync(t,e){return B(this,null,function*(){return this._executeAsync(t,e)})}disposeIntermediateTensors(){this.clonedTensorsMap&&(Object.values(this.clonedTensorsMap).forEach(t=>{for(let e of t)e&&!e.isDisposed&&e.dispose()}),this.clonedTensorsMap=null)}getIntermediateTensors(){return this.clonedTensorsMap}_executeAsync(s,a){return B(this,arguments,function*(t,e,r=!1,o={},i={}){this.disposeIntermediateTensors(),r||(t=this.mapInputs(t),this.checkInputs(t),this.checkInputShapeAndType(t),e=this.mapOutputs(e),this.checkOutputs(e));try{this.keepIntermediateTensors=q().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(h){this.keepIntermediateTensors=!1,console.warn(h.message)}let l=new rw(this.weightMap,o,i,this.functionExecutorMap,this.parseNodeNameCache);this.keepIntermediateTensors&&(this.clonedTensorsMap=this.cloneTensorMap(this.weightMap));let c=yield this.executeWithControlFlow(t,l,e,r),u=e.map(h=>Ar(h,c,l)),d=u.map(h=>h.id),p=Object.keys(t).map(h=>t[h].id),f=new Set([...d,...p,...this.weightIds]);return Object.values(c).forEach(h=>{h.forEach(m=>{m&&!m.isDisposed&&!f.has(m.id)&&m.dispose()})}),this.parent==null&&l.dispose(f),u})}executeFunctionAsync(t,e,r){return B(this,null,function*(){let o=t.reduce((i,s,a)=>(i[this.inputs[a].name]=s,i),{});return this._executeAsync(o,this.outputNodes,!0,e,r)})}executeWithControlFlow(t,e,r,o){return B(this,null,function*(){let i=Object.keys(t),s=i.map(C=>this.graph.nodes[ii(C)[0]]),a=r.map(C=>ii(C)[0]),l=new Set(a),c=a.map(C=>this.graph.nodes[C]);c.length===0&&(c=this._outputs);let{usedNodes:u,missingInputs:d,dynamicNode:p,syncInputs:f}=XL(t,c,this.weightMap,this._initNodes),h=[...s,...this.graph.weights,...this._initNodes||[]].map(C=>({node:C,contexts:e.currentContext})),m=Object.assign({},this.weightMap);Object.keys(t).forEach(C=>{let[I,A]=ii(C),M=[];M[A]=t[C],m[I]=M});let g={},y=this.getFrozenTensorIds(m),v={};for(;h.length>0;){let C=this.processStack(s,h,e,m,v,y,l,g,u);yield Promise.all(C)}p==null&&!o&&console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead.");let w=c.filter(C=>!Zf(C)&&!Ar(C.name,m,e)).map(C=>C.name);if(w.length>0){let C="";throw p!=null&&(C=`Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs [${f}]`),new Error(`Cannot compute the outputs [${w}] from the provided inputs [${i}]. Consider providing the following inputs: [${d}]. ${C}`)}return m})}processStack(t,e,r,o,i,s,a,l,c){let u=[];for(;e.length>0;){let d=e.pop();r.currentContext=d.contexts;let p="";if(d.node.op==="Enter"&&D("isConstant",d.node,o,r)&&([p]=$l(d.node.name,r)),o[d.node.name]==null){let f=KL(d.node,o,r,this._resourceManager);p||([p]=$l(d.node.name,r));let h=r.currentContext;b.isPromise(f)?u.push(f.then(m=>(o[p]=m,this.keepIntermediateTensors&&(this.clonedTensorsMap[p]=this.cloneTensorList(m)),r.currentContext=h,this.checkTensorForDisposal(p,d.node,o,r,s,a,l),this.processChildNodes(d.node,e,r,o,i,c),m))):(o[p]=f,this.keepIntermediateTensors&&(this.clonedTensorsMap[p]=this.cloneTensorList(f)),this.checkTensorForDisposal(p,d.node,o,r,s,a,l),this.processChildNodes(d.node,e,r,o,i,c))}else this.processChildNodes(d.node,e,r,o,i,c)}return u}processChildNodes(t,e,r,o,i,s){t.children.forEach(a=>{let[l]=$l(a.name,r);i[l]||!s.has(a.name)||(a.op==="Merge"?a.inputNames.some(c=>!!Ar(c,o,r))&&(i[l]=!0,e.push({contexts:r.currentContext,node:a})):a.inputNames.every(c=>!!Ar(c,o,r))&&(i[l]=!0,e.push({contexts:r.currentContext,node:a})))})}dispose(){Object.keys(this.weightMap).forEach(t=>this.weightMap[t].forEach(e=>e.dispose()))}checkInputShapeAndType(t){Object.keys(t).forEach(e=>{let r=t[e],[o]=ii(e),i=this.graph.nodes[o];if(i.attrParams.shape&&i.attrParams.shape.value){let s=i.attrParams.shape.value,a=s.length===r.shape.length&&r.shape.every((l,c)=>s[c]===-1||s[c]===l);b.assert(a,()=>`The shape of dict['${i.name}'] provided in model.execute(dict) must be [${s}], but was [${r.shape}]`)}i.attrParams.dtype&&i.attrParams.dtype.value&&b.assert(r.dtype===i.attrParams.dtype.value,()=>`The dtype of dict['${i.name}'] provided in model.execute(dict) must be ${i.attrParams.dtype.value}, but was ${r.dtype}`)})}mapInputs(t){var e,r;let o={};for(let i in t){let s=(r=(e=this._signature)===null||e===void 0?void 0:e.inputs)===null||r===void 0?void 0:r[i];s!=null?o[s.name]=t[i]:o[i]=t[i]}return o}checkInputs(t){let e=Object.keys(t).filter(r=>{let[o]=ii(r);return this.graph.nodes[o]==null});if(e.length>0)throw new Error(`The dict provided in model.execute(dict) has keys: [${e}] that are not part of graph`)}mapOutputs(t){return t.map(e=>{var r,o;let i=(o=(r=this._signature)===null||r===void 0?void 0:r.outputs)===null||o===void 0?void 0:o[e];return i!=null?i.name:e},{})}checkOutputs(t){t.forEach(e=>{let[r]=ii(e);if(!this.graph.nodes[r])throw new Error(`The output '${e}' is not found in the graph`)})}};var aT=class{constructor(t={},e={}){this.hashTableNameToHandle=t,this.hashTableMap=e}addHashTable(t,e){this.hashTableNameToHandle[t]=e.handle,this.hashTableMap[e.id]=e}getHashTableHandleByName(t){return this.hashTableNameToHandle[t]}getHashTableById(t){return this.hashTableMap[t]}dispose(){for(let t in this.hashTableMap)this.hashTableMap[t].clearAndClose(),delete this.hashTableMap[t];for(let t in this.hashTableNameToHandle)this.hashTableNameToHandle[t].dispose(),delete this.hashTableNameToHandle[t]}};var OMe="?tfjs-format=file",MMe="model.json",lT=class{get modelVersion(){return this.version}get inputNodes(){return this.executor.inputNodes}get outputNodes(){return this.executor.outputNodes}get inputs(){return this.executor.inputs}get outputs(){return this.executor.outputs}get weights(){return this.executor.weightMap}get metadata(){return this.artifacts.userDefinedMetadata}get modelSignature(){return this.signature}get modelStructuredOutputKeys(){return this.structuredOutputKeys}constructor(t,e={},r=Al){this.modelUrl=t,this.loadOptions=e,this.version="n/a",this.io=r,e==null&&(this.loadOptions={}),this.resourceManager=new aT}findIOHandler(){let t=this.modelUrl;if(t.load!=null)this.handler=t;else if(this.loadOptions.requestInit!=null)this.handler=this.io.browserHTTPRequest(t,this.loadOptions);else{let e=this.io.getLoadHandlers(t,this.loadOptions);if(e.length===0)e.push(this.io.browserHTTPRequest(t,this.loadOptions));else if(e.length>1)throw new Error(`Found more than one (${e.length}) load handlers for URL '${[t]}'`);this.handler=e[0]}}load(){if(this.findIOHandler(),this.handler.load==null)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");let t=this.handler.load();return b.isPromise(t)?t.then(e=>e.getWeightStream==null?this.loadSync(e):this.loadStreaming(e)):this.loadSync(t)}loadSync(t){let e=this.io.decodeWeights(t.weightData,t.weightSpecs);return this.loadWithWeightMap(t,e)}loadStreaming(t){return B(this,null,function*(){if(t.getWeightStream==null)throw new Error("Model artifacts missing streamWeights function");let e=yield PI(t.getWeightStream(),t.weightSpecs);return this.loadWithWeightMap(t,e)})}loadWithWeightMap(t,e){this.artifacts=t;let r=this.artifacts.modelTopology,o=this.artifacts.signature;if(this.artifacts.userDefinedMetadata!=null){let i=this.artifacts.userDefinedMetadata;i.signature!=null&&(o=i.signature),i.structuredOutputKeys!=null&&(this.structuredOutputKeys=i.structuredOutputKeys)}if(this.signature=o,this.version=`${r.versions.producer}.${r.versions.minConsumer}`,this.executor=new ow(nw.Instance.transformGraph(r,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(e),this.executor.resourceManager=this.resourceManager,t.modelInitializer!=null&&t.modelInitializer.node!=null){let i=nw.Instance.transformGraph(t.modelInitializer);this.initializer=new ow(i),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializerSignature=t.initializerSignature}return!0}save(t,e){return B(this,null,function*(){if(typeof t=="string"){let r=this.io.getSaveHandlers(t);if(r.length===0)throw new Error(`Cannot find any save handlers for URL '${t}'`);if(r.length>1)throw new Error(`Found more than one (${r.length}) save handlers for URL '${t}'`);t=r[0]}if(t.save==null)throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return t.save(this.artifacts)})}addStructuredOutputNames(t){if(this.structuredOutputKeys){let e=t instanceof bt?[t]:t,r={};return e.forEach((o,i)=>r[this.structuredOutputKeys[i]]=o),r}return t}predict(t,e){let r=this.execute(t,this.outputNodes);return this.addStructuredOutputNames(r)}predictAsync(t,e){return B(this,null,function*(){let r=yield this.executeAsync(t,this.outputNodes);return this.addStructuredOutputNames(r)})}normalizeInputs(t){var e;if(!(t instanceof bt)&&!Array.isArray(t)){let i=(e=this.signature)===null||e===void 0?void 0:e.inputs;if(i!=null)for(let s in i){let a=i[s];a.resourceId!=null&&(t[s]=this.resourceIdToCapturedInput[a.resourceId])}return t}t=Array.isArray(t)?t:[t];let r=Object.keys(this.resourceIdToCapturedInput).length;if(t.length+r!==this.inputNodes.length)throw new Error(`Input tensor count mismatch, the graph model has ${this.inputNodes.length-r} non-resource placeholders, while there are ${t.length} input tensors provided.`);let o=0;return this.inputNodes.reduce((i,s)=>{var a,l,c;let u=(c=(l=(a=this.signature)===null||a===void 0?void 0:a.inputs)===null||l===void 0?void 0:l[s])===null||c===void 0?void 0:c.resourceId;return u!=null?i[s]=this.resourceIdToCapturedInput[u]:i[s]=t[o++],i},{})}normalizeOutputs(t){return t=t||this.outputNodes,Array.isArray(t)?t:[t]}executeInitializerGraph(){return this.initializer==null?[]:this.initializerSignature==null?this.initializer.execute({},[]):this.initializer.execute({},Object.keys(this.initializerSignature.outputs))}executeInitializerGraphAsync(){return B(this,null,function*(){return this.initializer==null?[]:this.initializerSignature==null?this.initializer.executeAsync({},[]):this.initializer.executeAsync({},Object.keys(this.initializerSignature.outputs))})}setResourceIdToCapturedInput(t){if(this.resourceIdToCapturedInput={},this.initializerSignature){let e=this.initializerSignature.outputs,r=Object.keys(e);for(let o=0;o<r.length;o++){let i=r[o],s=e[i];this.resourceIdToCapturedInput[s.resourceId]=t[o]}}}execute(t,e){this.resourceIdToCapturedInput==null&&this.setResourceIdToCapturedInput(this.executeInitializerGraph()),t=this.normalizeInputs(t),e=this.normalizeOutputs(e);let r=this.executor.execute(t,e);return r.length>1?r:r[0]}executeAsync(t,e){return B(this,null,function*(){this.resourceIdToCapturedInput==null&&this.setResourceIdToCapturedInput(yield this.executeInitializerGraphAsync()),t=this.normalizeInputs(t),e=this.normalizeOutputs(e);let r=yield this.executor.executeAsync(t,e);return r.length>1?r:r[0]})}getIntermediateTensors(){return this.executor.getIntermediateTensors()}disposeIntermediateTensors(){this.executor.disposeIntermediateTensors()}convertTensorMapToTensorsMap(t){return Object.keys(t).reduce((e,r)=>(e[r]=[t[r]],e),{})}dispose(){this.executor.dispose(),this.initializer&&(this.initializer.dispose(),this.resourceIdToCapturedInput&&He(this.resourceIdToCapturedInput)),this.resourceManager.dispose()}};function Qf(r){return B(this,arguments,function*(n,t={},e=Al){if(n==null)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");t==null&&(t={}),t.fromTFHub&&typeof n=="string"&&(n=PMe(n));let o=new lT(n,t,e);return yield o.load(),o})}function PMe(n){return n.endsWith("/")||(n=n+"/"),`${n}${MMe}${OMe}`}var UMe=rg(Ab());var BMe=rg(Ab());var pan=Symbol("out"),fan=Symbol("field"),han=Symbol("quote"),man=Symbol("quoteafterquote"),gan=Symbol("quoteinquote");function we(n,t){Array.isArray(n)||(n=[n]),n.forEach(e=>{e!=null&&b.assert(e.dtype!=="complex64",()=>`${t} does not support complex64 tensors in the CPU backend.`)})}var JMe=Vr.whereImpl,MY=(()=>{class n extends Ra{nextDataId(){return n.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new md(this,Zr())}write(e,r,o){this.firstUse&&(this.firstUse=!1,q().get("IS_NODE")&&T.warn(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));let i={id:this.nextDataId()};return this.data.set(i,{values:e,dtype:o,refCount:1}),i}makeTensorInfo(e,r,o){let i;if(r==="string"&&o!=null&&o.length>0&&b.isString(o[0])){let s=o.map(a=>b.encodeString(a));i=this.write(s,e,r)}else i=this.write(o,e,r);return{dataId:i,shape:e,dtype:r}}refCount(e){return this.data.has(e)?this.data.get(e).refCount:0}incRef(e){let r=this.data.get(e);r.refCount++}decRef(e){if(this.data.has(e)){let r=this.data.get(e);r.refCount--}}move(e,r,o,i,s){this.data.set(e,{values:r,dtype:i,refCount:s})}numDataIds(){return this.data.numDataIds()}read(e){return B(this,null,function*(){return this.readSync(e)})}readSync(e){let{dtype:r,complexTensorInfos:o}=this.data.get(e);if(r==="complex64"){let i=this.readSync(o.real.dataId),s=this.readSync(o.imag.dataId);return T.mergeRealAndImagArrays(i,s)}return b.convertBackendValuesAndArrayBuffer(this.data.get(e).values,r)}bufferSync(e){let r=this.readSync(e.dataId);if(e.dtype==="string")try{let o=r.map(i=>b.decodeString(i));return ze(e.shape,e.dtype,o)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return ze(e.shape,e.dtype,r)}makeOutput(e,r,o){return Zr().makeTensorFromTensorInfo(this.makeTensorInfo(r,o,e),this)}disposeData(e,r=!1){if(this.data.has(e)){if(this.data.get(e).refCount--,!r&&this.data.get(e).refCount>0)return!1;let{complexTensorInfos:o}=this.data.get(e);o!=null&&(this.disposeData(o.real.dataId,!0),this.disposeData(o.imag.dataId,!0)),this.data.delete(e)}return!0}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}time(e){return B(this,null,function*(){let r=b.now();return e(),{kernelMs:b.now()-r}})}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){we([e],"where");let r=this.readSync(e.dataId);return JMe(e.shape,r)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}return n.nextDataId=0,n})();var lw={};bn(lw,{addImpl:()=>JL,bincountImpl:()=>Hx,bincountReduceImpl:()=>cT,bitwiseAndImpl:()=>e$,castImpl:()=>QL,ceilImpl:()=>t$,concatImpl:()=>uT,equalImpl:()=>n$,expImpl:()=>o$,expm1Impl:()=>s$,floorDivImpl:()=>l$,floorImpl:()=>a$,gatherNdImpl:()=>dT,gatherV2Impl:()=>pT,greaterEqualImpl:()=>u$,greaterImpl:()=>c$,lessEqualImpl:()=>p$,lessImpl:()=>d$,linSpaceImpl:()=>fT,logImpl:()=>f$,maxImpl:()=>hT,maximumImpl:()=>h$,minimumImpl:()=>m$,multiplyImpl:()=>iw,negImpl:()=>g$,notEqualImpl:()=>y$,prodImpl:()=>x$,raggedGatherImpl:()=>mT,raggedRangeImpl:()=>gT,raggedTensorToTensorImpl:()=>yT,rangeImpl:()=>xT,rsqrtImpl:()=>b$,scatterImpl:()=>Bl,sigmoidImpl:()=>dZ,simpleAbsImpl:()=>ZL,sliceImpl:()=>C$,sparseFillEmptyRowsImpl:()=>vT,sparseReshapeImpl:()=>bT,sparseSegmentReductionImpl:()=>Kx,sqrtImpl:()=>hZ,squaredDifferenceImpl:()=>_$,staticRegexReplaceImpl:()=>S$,stridedSliceImpl:()=>wT,stringNGramsImpl:()=>CT,stringSplitImpl:()=>_T,stringToHashBucketFastImpl:()=>ST,subImpl:()=>E$,tileImpl:()=>IT,topKImpl:()=>ET,transposeImpl:()=>qx,uniqueImpl:()=>TT});function ZL(n){let t=new Float32Array(n.length);for(let e=0;e<n.length;++e)t[e]=Math.abs(n[e]);return t}var ePe=n=>{let{x:t}=n.inputs,e=n.backend;we(t,"abs");let r=new Float32Array(b.sizeFromShape(t.shape)),o=e.data.get(t.dataId).values;return r=ZL(o),e.makeOutput(r,t.shape,t.dtype)},PY={kernelName:wc,backendName:"cpu",kernelFunc:ePe};function $t(n){return(t,e,r,o,i)=>{let s=T.assertAndGetBroadcastShape(t,e),a=s.length,l=b.computeStrides(s),c=b.sizeFromShape(s),u=b.getTypedArrayFromDType(i,c),d=t.length,p=e.length,f=b.computeStrides(t),h=b.computeStrides(e),m=T.getBroadcastDims(t,s),g=T.getBroadcastDims(e,s);if(m.length+g.length===0)for(let y=0;y<u.length;++y)u[y]=n(r[y%r.length],o[y%o.length]);else for(let y=0;y<u.length;++y){let v=b.indexToLoc(y,a,l),w=v.slice(-d);m.forEach(M=>w[M]=0);let C=b.locToIndex(w,d,f),I=v.slice(-p);g.forEach(M=>I[M]=0);let A=b.locToIndex(I,p,h);u[y]=n(r[C],o[A])}return[u,s]}}function qr(n){let{inputs:t,backend:e}=n,{real:r,imag:o}=t,i=e.data.get(r.dataId).values,s=e.data.get(o.dataId).values,a=e.makeTensorInfo(r.shape,"complex64"),l=e.data.get(a.dataId);return l.complexTensorInfos={real:e.makeTensorInfo(r.shape,"float32",i),imag:e.makeTensorInfo(o.shape,"float32",s)},a}var FY={kernelName:Op,backendName:"cpu",kernelFunc:qr};function Gx(n,t,e="float32"){if(e==="complex64"){let o=Gx(n,t,"float32"),i=Gx(n,t,"float32");return qr({inputs:{real:o,imag:i},backend:n})}let r=b.makeZerosTypedArray(b.sizeFromShape(t),e);return n.makeTensorInfo(t,e,r)}function Io(n){let{inputs:t,backend:e}=n,{x:r}=t;return e.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var LY={kernelName:Vs,backendName:"cpu",kernelFunc:Io};function ra(n){let{inputs:t,backend:e}=n,{input:r}=t,o=e.data.get(r.dataId).complexTensorInfos.real,i=e.data.get(o.dataId).values;return e.makeTensorInfo(o.shape,o.dtype,i)}var $Y={kernelName:lf,backendName:"cpu",kernelFunc:ra};function QL(n,t,e,r){if(r==="int32"){let o=Int32Array.from(n);return[t,"int32",o]}if(r==="bool"){let o=b.toTypedArray([0],e),[i,s]=$t((a,l)=>a!==l?1:0)(t,[],n,o,"bool");return[s,"bool",i]}throw new Error(`Error in Cast: failed to cast ${e} to ${r}`)}function oa(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{dtype:i}=r;if(i==="complex64"){if(o.dtype==="complex64")return Io({inputs:{x:o},backend:e});let u=Gx(e,o.shape,o.dtype),d=oa({inputs:{x:o},backend:e,attrs:{dtype:"float32"}}),p=qr({inputs:{real:d,imag:u},backend:e});return e.disposeIntermediateTensorInfo(u),e.disposeIntermediateTensorInfo(d),p}if(o.dtype==="complex64"){let u=ra({inputs:{input:o},backend:e}),d=oa({inputs:{x:u},backend:e,attrs:{dtype:i}});return e.disposeIntermediateTensorInfo(u),d}if(!b.hasEncodingLoss(o.dtype,i)){let u=Io({inputs:{x:o},backend:e});return{dataId:u.dataId,shape:u.shape,dtype:i}}let s=e.data.get(o.dataId).values,[a,l,c]=QL(s,o.shape,o.dtype,i);return e.makeTensorInfo(a,l,c)}var VY={kernelName:$s,backendName:"cpu",kernelFunc:oa};function Xt(n,t,e,r){return e==null?({inputs:o,backend:i})=>{let{a:s,b:a}=o,l=i;we([s,a],n);let c=l.data.get(s.dataId).values,u=l.data.get(a.dataId).values,d=s.dtype==="string"?T.fromUint8ToStringArray(c):c,p=s.dtype==="string"?T.fromUint8ToStringArray(u):u,f=r||s.dtype,[h,m]=t(s.shape,a.shape,d,p,f);return l.makeTensorInfo(m,f,h)}:({inputs:o,backend:i})=>{let{a:s,b:a}=o,l=i;if(s.dtype==="complex64"||a.dtype==="complex64"){let c=oa({inputs:{x:s},backend:l,attrs:{dtype:"complex64"}}),u=l.data.get(c.dataId),d=u.complexTensorInfos.real,p=u.complexTensorInfos.imag,f=l.data.get(d.dataId).values,h=l.data.get(p.dataId).values,m=oa({inputs:{x:a},backend:l,attrs:{dtype:"complex64"}}),g=l.data.get(m.dataId),y=g.complexTensorInfos.real,v=g.complexTensorInfos.imag,w=l.data.get(y.dataId).values,C=l.data.get(v.dataId).values,[I,A,M]=e(s.shape,a.shape,f,h,w,C),$=l.makeTensorInfo(M,"float32",I),V=l.makeTensorInfo(M,"float32",A),W=qr({inputs:{real:$,imag:V},backend:l});return l.disposeIntermediateTensorInfo(c),l.disposeIntermediateTensorInfo(m),l.disposeIntermediateTensorInfo($),l.disposeIntermediateTensorInfo(V),W}else{let c=l.data.get(s.dataId).values,u=l.data.get(a.dataId).values,d=r||s.dtype,[p,f]=t(s.shape,a.shape,c,u,d);return l.makeTensorInfo(f,d,p)}}}function jx(n){return(t,e,r,o,i,s)=>{let a=T.assertAndGetBroadcastShape(t,e),l=b.sizeFromShape(a),c=a.length,u=b.computeStrides(a),d=b.getTypedArrayFromDType("float32",l),p=b.getTypedArrayFromDType("float32",l),f=T.getBroadcastDims(t,a),h=T.getBroadcastDims(e,a),m=T.mergeRealAndImagArrays(r,o),g=T.mergeRealAndImagArrays(i,s),y=t.length,v=b.computeStrides(t),w=e.length,C=b.computeStrides(e);if(f.length+h.length===0)for(let I=0;I<d.length;I++){let A=I%m.length,M=I%g.length,$=n(m[A*2],m[A*2+1],g[M*2],g[M*2+1]);d[I]=$.real,p[I]=$.imag}else for(let I=0;I<d.length;I++){let A=b.indexToLoc(I,c,u),M=A.slice(-y);f.forEach(te=>M[te]=0);let $=b.locToIndex(M,y,v),V=A.slice(-w);h.forEach(te=>V[te]=0);let W=b.locToIndex(V,w,C),K=n(m[$*2],m[$*2+1],g[W*2],g[W*2+1]);d[I]=K.real,p[I]=K.imag}return[d,p,a]}}var JL=$t((n,t)=>n+t),tPe=jx((n,t,e,r)=>({real:n+e,imag:t+r})),Du=Xt(hs,JL,tPe),BY={kernelName:hs,backendName:"cpu",kernelFunc:Du};function Hx(n,t,e,r,o){let i=b.sizeFromShape(r),s=b.makeZerosTypedArray(o,e);for(let a=0;a<n.length;a++){let l=n[a];if(l<0)throw new Error("Input x must be non-negative!");l>=o||(i>0?s[l]+=t[a]:s[l]+=1)}return s}function cT(n,t,e,r=!1){let o=n.shape[0],i=n.shape[1],s=ze([o,e],t.dtype);for(let a=0;a<o;a++)for(let l=0;l<i;l++){let c=n.get(a,l);if(c<0)throw new Error("Input x must be non-negative!");c>=e||(r?s.set(1,a,c):t.size>0?s.set(s.get(a,c)+t.get(a,l),a,c):s.set(s.get(a,c)+1,a,c))}return s}var e$=$t((n,t)=>n&t),nPe=Xt(Kh,e$),zY={kernelName:Kh,backendName:"cpu",kernelFunc:nPe};function oo(n){return(t,e,r)=>{let o=b.getArrayFromDType(e,t.length);for(let i=0;i<t.length;++i)o[i]=n(t[i],r);return o}}function ut(n,t,e){let r=oo(t);return bi(n,r,e)}function bi(n,t,e){return({inputs:r,attrs:o,backend:i})=>{let{x:s}=r;we(s,n);let a=i,l=a.data.get(s.dataId).values,c;if(s.dtype==="string"){if(!Array.isArray(l))throw new Error("String tensor's value was not an instance of Array");c=T.fromUint8ToStringArray(l)}else c=l;let u=e||s.dtype,d=t(c,u,o);return a.makeTensorInfo(s.shape,u,d)}}var t$=oo(n=>Math.ceil(n)),rPe=bi(Ba,t$),UY={kernelName:Ba,backendName:"cpu",kernelFunc:rPe};function uT(n,t,e,r){let o=b.getArrayFromDType(e,b.sizeFromShape(t));if(r&&e!=="string"){let i=0;n.forEach(s=>{let a=b.sizeFromShape(s.shape);o.set(s.vals,i),i+=a})}else{let i=0;n.forEach(s=>{let a=e==="string"?T.fromUint8ToStringArray(s.vals):s.vals,l=0;for(let c=0;c<s.shape[0];++c){let u=c*t[1]+i;for(let d=0;d<s.shape[1];++d)o[u+d]=a[l++]}i+=s.shape[1]})}return o}var n$=$t((n,t)=>n===t?1:0),r$=Xt(yd,n$,null,"bool"),WY={kernelName:yd,backendName:"cpu",kernelFunc:r$};var o$=oo(n=>Math.exp(n)),i$=bi(qa,o$,"float32"),GY={kernelName:qa,backendName:"cpu",kernelFunc:i$};var s$=oo(n=>Math.expm1(n)),oPe=bi(Ka,s$),jY={kernelName:Ka,backendName:"cpu",kernelFunc:oPe};var a$=oo(n=>Math.floor(n)),iPe=bi(Xa,a$),HY={kernelName:Xa,backendName:"cpu",kernelFunc:iPe};var l$=$t((n,t)=>Math.floor(n/t)),sPe=Xt(Ya,l$,null,"int32"),qY={kernelName:Ya,backendName:"cpu",kernelFunc:sPe};function dT(n,t,e,r,o,i,s,a,l){let c=ze([r,i],e);for(let u=0;u<r;u++){let d=[],p=0;for(let f=0;f<o;f++){let h=n[u*o+f];p+=h*s[f],d.push(h)}if(p<0||p>=l/i)throw new Error(`Invalid indices: ${d} does not index into ${a}`);for(let f=0;f<i;f++)c.values[u*i+f]=t.get(...t.indexToLoc(p*i+f))}return c}function pT(n,t,e){let r=ze(e,n.dtype);for(let o=0;o<r.size;++o){let s=r.indexToLoc(o).slice(),a=s[0],l=s[2],c=t.locToIndex([a,l]);s[2]=t.values[c];let u=n.locToIndex(s);0<=u&&u<n.values.length&&(r.values[o]=n.values[u])}return r}var c$=$t((n,t)=>n>t?1:0),aPe=Xt(xd,c$,null,"bool"),KY={kernelName:xd,backendName:"cpu",kernelFunc:aPe};var u$=$t((n,t)=>n>=t?1:0),lPe=Xt(Za,u$,null,"bool"),XY={kernelName:Za,backendName:"cpu",kernelFunc:lPe};var d$=$t((n,t)=>n<t?1:0),cPe=Xt(vd,d$,null,"bool"),YY={kernelName:vd,backendName:"cpu",kernelFunc:cPe};var p$=$t((n,t)=>n<=t?1:0),uPe=Xt(bd,p$,null,"bool"),ZY={kernelName:bd,backendName:"cpu",kernelFunc:uPe};function fT(n,t,e){let r=(t-n)/(e-1),o=b.makeZerosTypedArray(e,"float32");o[0]=n;for(let i=1;i<o.length;i++)o[i]=o[i-1]+r;return o}var f$=oo(n=>Math.log(n)),dPe=bi(tl,f$),QY={kernelName:tl,backendName:"cpu",kernelFunc:dPe};function hT(n,t,e,r){let o=b.getTypedArrayFromDType(r,b.sizeFromShape(e));for(let i=0;i<o.length;++i){let s=i*t,a=n[s];for(let l=0;l<t;++l){let c=n[s+l];(Number.isNaN(c)||c>a)&&(a=c)}o[i]=a}return o}var h$=$t((n,t)=>Math.max(n,t)),pPe=Xt(rl,h$),JY={kernelName:rl,backendName:"cpu",kernelFunc:pPe};var m$=$t((n,t)=>Math.min(n,t)),fPe=Xt(ol,m$),eZ={kernelName:ol,backendName:"cpu",kernelFunc:fPe};var iw=$t((n,t)=>n*t),hPe=jx((n,t,e,r)=>({real:n*e-t*r,imag:n*r+t*e})),Mm=Xt(sl,iw,hPe),tZ={kernelName:sl,backendName:"cpu",kernelFunc:Mm};function g$(n,t,e){let r=b.createScalarValue(-1,e);return iw([],t,r,n,e)}function mPe(n){let{inputs:t,backend:e}=n,{x:r}=t;we(r,"neg");let o=e.data.get(r.dataId).values,[i,s]=g$(o,r.shape,r.dtype);return e.makeTensorInfo(s,r.dtype,i)}var nZ={kernelName:Kc,backendName:"cpu",kernelFunc:mPe};var y$=$t((n,t)=>n!==t?1:0),gPe=Xt(Sd,y$,null,"bool"),rZ={kernelName:Sd,backendName:"cpu",kernelFunc:gPe};function qx(n,t,e,r,o){let i=t.length,s=b.sizeFromShape(t),a=b.computeStrides(t),l=b.computeStrides(o),c=b.getTypedArrayFromDType(e,b.sizeFromShape(o));for(let u=0;u<s;++u){let d=b.indexToLoc(u,i,a),p=new Array(d.length);for(let h=0;h<p.length;h++)p[h]=d[r[h]];let f=b.locToIndex(p,i,l);c[f]=n[u]}return c}function cr(n){let{inputs:t,attrs:e,backend:r}=n,{x:o}=t,{perm:i}=e;we(o,"transpose");let s=o.shape.length,a=new Array(s);for(let d=0;d<a.length;d++)a[d]=o.shape[i[d]];let l=r.data.get(o.dataId).values,c=qx(l,o.shape,o.dtype,i,a);return{dataId:r.write(c,a,o.dtype),shape:a,dtype:o.dtype}}var oZ={kernelName:zs,backendName:"cpu",kernelFunc:cr};function x$(n,t,e,r){let[o,i]=T.computeOutAndReduceShapes(n,r),s=En(t,"int32"),a=b.makeZerosTypedArray(b.sizeFromShape(o),s),l=b.sizeFromShape(i);for(let c=0;c<a.length;++c){let u=c*l,d=1;for(let p=0;p<l;++p)d*=e[u+p];a[c]=d}return{outVals:a,outShape:o,outDtype:s}}function yPe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{axis:i,keepDims:s}=r;we(o,"prod");let a=o.shape.length,l=b.parseAxisParam(i,o.shape),c=T.getAxesPermutation(l,a),u=l,d=o,p=[];c!=null&&(d=cr({inputs:{x:o},backend:e,attrs:{perm:c}}),p.push(d),u=T.getInnerMostAxes(u.length,a));let f=e.data.get(d.dataId).values,{outVals:h,outShape:m,outDtype:g}=x$(d.shape,d.dtype,f,u),y=m;return s&&(y=T.expandShapeToKeepDim(m,l)),p.forEach(v=>e.disposeIntermediateTensorInfo(v)),e.makeTensorInfo(y,g,h)}var iZ={kernelName:eu,backendName:"cpu",kernelFunc:yPe};function xPe(n,t,e){n.forEach((r,o)=>{if(r<0||r>=e){let i=b.indexToLoc(o,t.length,b.computeStrides(t)).join(",");throw new Error(`indices[${i}] = ${r} is not in [0, ${e})`)}})}function vPe(n,t){for(let e=0;e<n.length;++e){let r=n[e],o=e===n.length-1?t:n[e+1].length;if(r.length===0)throw new Error("Ragged splits may not be empty");if(r[0]<0)throw new Error("Ragged splits must be non-negative");if(r[r.length-1]>o)throw new Error("Ragged splits must not point past values");for(let i=1;i<r.length;++i)if(r[i-1]>r[i])throw new Error("Ragged splits must be sorted in ascending order")}}function bPe(n,t,e,r){let o=[],i=0,s=t.length-1+e.length,a=new Array(s).fill(null).map(()=>[0]);vPe(e,r);let l=1;for(let c=0;c<t.length-1;++c){l*=t[c];let u=t[c+1];for(let d=1;d<l+1;++d)a[c].push(d*u)}for(let c=0;c<n.length;++c){let u=n[c],d=n[c]+1;for(let p=0;p<e.length;++p){let f=e[p],h=p+t.length-1;if(h>=0){let m=a[h],g=m[m.length-1]-f[u];for(let y=u;y<d;++y)a[h].push(f[y+1]+g)}u=f[u],d=f[d]}d!==u&&(o.push([u,d]),i+=d-u)}return{outSplits:a,valueSlices:o,numValues:i}}function wPe(n){let t=[];for(let e=0;e<n.length;++e){let r=n[e].length,o=b.getArrayFromDType("int32",r);t.push(o),n[e].forEach((i,s)=>o[s]=i)}return t}function sZ(n,t){let e=n.slice(0,t);for(;e.length<t;)e.push(1);for(let r=t;r<n.length;r++)e[t-1]*=n[r];return e}function CPe(n,t,e,r,o,i){let s=sZ(t,2)[1],a=sZ(i,2)[1],l=0;for(let c of e)for(let u=c[0];u<c[1];++u){for(let d=0;d<r;++d)o[l*a+d]=n[u*s+d];++l}}function _Pe(n,t,e,r,o){let i=t.slice();i[0]=o;let s=b.getArrayFromDType(e,b.sizeFromShape(i)),a=n.length,l=a===0?0:a/t[0];return CPe(n,t,r,l,s,i),[s,i]}function mT(n,t,e,r,o,i,s,a){if(n.length===0)throw new Error("paramsNestedSplits must be non empty");if(t[0].length===0)throw new Error("Split tensors must not be scalars");let l=t[0][0]-1;if(xPe(i,s,l),r.length===0)throw new Error("params.rank must be nonzero");let c=r[0],{outSplits:u,valueSlices:d,numValues:p}=bPe(i,s,n,c),f=wPe(u),h=_Pe(e,r,o,d,p);return[f,h[0],h[1]]}var aZ=2147483647;function gT(n,t,e,r,o,i,s){if(t.length>1)throw new Error("starts must be a scalar or vector");if(o.length>1)throw new Error("limits must be a scalar or vector");if(s.length>1)throw new Error("deltas must be a scalar or vector");let a=t.length===0,l=o.length===0,c=s.length===0,u=[];a||u.push(t[0]),l||u.push(o[0]),c||u.push(s[0]);for(let g=1;g<u.length;++g)if(u[g]!==u[g-1])throw new Error("starts, limits, and deltas must have the same shape");let d=u.length===0?1:u[0],p=b.getArrayFromDType("int32",d+1);p[0]=0;for(let g=0;g<d;++g){let y=a?n[0]:n[g],v=l?r[0]:r[g],w=c?i[0]:i[g];if(w===0)throw new Error("Requires delta != 0");let C;if(w>0&&v<y||w<0&&v>y)C=0;else if(C=Math.ceil(Math.abs((v-y)/w)),C>aZ)throw new Error(`Requires ((limit - start) / delta) <= ${aZ}`);p[g+1]=p[g]+C}let f=p[d],h=b.getArrayFromDType(e,f),m=0;for(let g=0;g<d;++g){let y=p[g+1]-p[g],v=a?n[0]:n[g],w=c?i[0]:i[g];for(let C=0;C<y;++C)h[m++]=v,v+=w}return[p,h]}var ia=T.RowPartitionType,v$=class n{constructor(t,e,r,o,i,s,a,l,c,u){this.shape=t,this.shapeShape=e,this.values=r,this.valuesShape=o,this.valuesDType=i,this.defaultValue=s,this.defaultValueShape=a,this.rowPartitionValues=l,this.rowPartitionValuesShapes=c,this.rowPartitionTypes=T.getRowPartitionTypesHelper(u),this.raggedRank=T.getRaggedRank(this.rowPartitionTypes)}getRowPartitionTypeByDimension(t){return this.rowPartitionTypes[0]===ia.FIRST_DIM_SIZE?this.rowPartitionTypes[t+1]:this.rowPartitionTypes[t]}getRowPartitionTensor(t){return this.rowPartitionTypes[0]===ia.FIRST_DIM_SIZE?this.rowPartitionValues[t+1]:this.rowPartitionValues[t]}getMaxWidth(t){let e=this.getRowPartitionTensor(t-1);switch(this.getRowPartitionTypeByDimension(t-1)){case ia.VALUE_ROWIDS:return n.getMaxWidthValueRowID(e);case ia.ROW_SPLITS:return n.getMaxWidthRowSplit(e);default:throw new Error(`Cannot handle partition type ${ia[this.getRowPartitionTypeByDimension(t-1)]}`)}}static getMaxWidthRowSplit(t){let e=t.length;if(e===0||e===1)return 0;let r=0;for(let o=0;o<e-1;++o){let i=t[o+1]-t[o];i>r&&(r=i)}return r}static getMaxWidthValueRowID(t){let e=t.length;if(e===0)return 0;let r=0,o=t[0],i=0;for(let s=1;s<e;++s){let a=t[s];a!==o&&(o=a,i=Math.max(s-r,i),r=s)}return Math.max(e-r,i)}tensorShapeFromTensor(t,e,r=!0){if(e.length===0){if(t[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return cZ(t,r)}calculateOutputSize(t){let e=this.valuesShape,r=this.defaultValueShape;T.validateDefaultValueShape(r,e);let o=this.tensorShapeFromTensor(this.shape,this.shapeShape),s=T.combineRaggedTensorToTensorShapes(this.raggedRank,o,e);s[0]<0&&(s[0]=t);for(let a=1;a<=this.raggedRank;++a)s[a]<0&&(s[a]=this.getMaxWidth(a));return s}calculateFirstParentOutputIndex(t,e,r){let o=Math.min(t,r),i=[],s=0;for(let a=0;a<o;++a,s+=e)i.push(s);for(let a=o;a<t;++a)i.push(-1);return b.assert(i.length===t,()=>"Final length of result must be equal to firstDimension."),i}calculateOutputIndexRowSplit(t,e,r,o){let i=t.length,s=[];for(let a=0;a<i-1;++a){let l=t[a+1]-t[a],c=Math.min(o,l),u=e[a];u===-1&&(c=0);for(let d=0;d<c;++d)s.push(u),u+=r;for(let d=0;d<l-c;++d)s.push(-1)}if(i>0&&s.length!==t[i-1])throw new Error("Invalid row split size.");return s}calculateOutputIndexValueRowID(t,e,r,o){let i=t.length,s=[];if(i===0)return[];let a=0,l=t[0];if(l>=e.length)throw new Error(`Got currentValueRowId=${l}, which is not less than ${e.length}`);let c=e[l];s.push(c);for(let u=1;u<i;++u){let d=t[u];if(d===l)c>=0&&(++a,a<o?c+=r:c=-1);else{if(a=0,l=d,d>=e.length)throw new Error(`Got nextValueRowId=${d} which is not less than ${e.length}`);c=e[d]}s.push(c)}if(s.length!==t.length)throw new Error("Invalid row ids.");return s}calculateOutputIndex(t,e,r,o){let i=this.getRowPartitionTensor(t),s=this.getRowPartitionTypeByDimension(t);switch(s){case ia.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(i,e,r,o);case ia.ROW_SPLITS:if(i.length-1>e.length)throw new Error(`Row partition size is greater than output size: ${i.length-1} > ${e.length}`);return this.calculateOutputIndexRowSplit(i,e,r,o);default:throw new Error(`Unsupported partition type: ${ia[s]}`)}}getFirstDimensionSize(){let t=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");let e=this.rowPartitionTypes[0];switch(e){case ia.FIRST_DIM_SIZE:return t[0];case ia.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case ia.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${ia[e]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");let e=this.getFirstDimensionSize(),r=this.calculateOutputSize(e),o=new Array(this.raggedRank+1);o[o.length-1]=1;for(let l=o.length-2;l>=0;--l)o[l]=o[l+1]*r[l+1];let i=cZ(r,!1),s=b.getArrayFromDType(this.valuesDType,b.sizeFromShape(i));if(o[0]*r[0]>0){let l=this.calculateFirstParentOutputIndex(e,o[0],r[0]);for(let c=1;c<=this.raggedRank;++c)l=this.calculateOutputIndex(c-1,l,o[c],r[c]);this.setOutput(this.raggedRank,l,s,i)}return[i,s]}setOutput(t,e,r,o){if(r.length===0)return;let i=this.values,s=r,a=o.slice();a=a.slice(t+1);let l=b.sizeFromShape(a),c=e.length,u=this.defaultValue;if(u.length!==l&&u.length!==1){let h=this.defaultValueShape;Z(()=>{let m=G(u,h);u=vu(m,a).dataSync()})}let d=0,p=0,f=0;for(let h=0;h<=c;++h){let m=h<c?e[h]:-1;if(m===f){++f;continue}if(p<f){let g=i.subarray(d*l),y=s.subarray(p*l),v=(f-p)*l;lZ(y,g,v)}if(h>=c){let g=r.length;m=Math.floor(g/l)}if(m>f)if(this.defaultValue.length===1)s.subarray(f*l,m*l).fill(this.defaultValue[0]),f=m;else for(;m>f;){let g=s.slice(f*l);lZ(g,u,l),++f}m<0?(d=h+1,p=f):(d=h,p=f,f=p+1)}}};function lZ(n,t,e){for(let r=0;r<e;r++)n[r]=t[r]}function cZ(n,t){let e=[];for(let r of n){if(r<0){if(!t)throw new Error(`Dimension ${r} must be >= 0`);if(r<-1)throw new Error(`Dimension ${r} must be >= -1`);r=-1}e.push(r)}return e}function yT(n,t,e,r,o,i,s,a,l,c){return new v$(n,t,e,r,o,i,s,a,l,c).compute()}function xT(n,t,e,r){let o=n===t,i=n<t&&e<0,s=t<n&&e>1;if(o||i||s)return b.makeZerosTypedArray(0,r);let a=Math.abs(Math.ceil((t-n)/e)),l=b.makeZerosTypedArray(a,r);t<n&&e===1&&(e=-1),l[0]=n;for(let c=1;c<l.length;c++)l[c]=l[c-1]+e;return l}var b$=oo(n=>1/Math.sqrt(n)),SPe=bi(pl,b$),uZ={kernelName:pl,backendName:"cpu",kernelFunc:SPe};function Bl(n,t,e,r,o,i,s,a,l,c){let u=[r/o,o],d=n.values,p=t.values;if(r===0)return ze(e,t.dtype);let f=l instanceof an?l:ze(u,t.dtype);typeof l=="string"||typeof l=="number"?f.values.fill(l):typeof l=="boolean"&&f.values.fill(+l);for(let h=0;h<i;h++){let m=[],g=0;for(let y=0;y<s;y++){let v=d[h*s+y];m.push(v),g+=v*a[y]}if(g<0||g>=r/o)throw new Error(`Invalid indices: ${m} does not index into ${e}`);for(let y=0;y<o;y++)c?f.values[g*o+y]+=p[h*o+y]:f.values[g*o+y]=t.rank===0?p[0]:p[h*o+y]}return f}var dZ=oo(n=>1/(1+Math.exp(-n))),w$=ut(yl,n=>1/(1+Math.exp(-n))),pZ={kernelName:yl,backendName:"cpu",kernelFunc:w$};function C$(n,t,e,r,o){let i=yr.isSliceContinous(r,t,e),s=b.sizeFromShape(e),a=b.computeStrides(r);if(i){let d=yr.computeFlatOffset(t,a);return o==="string"?n.slice(d,d+s):n.subarray(d,d+s)}let l=o==="string"?T.fromUint8ToStringArray(n):n,c=ze(r,o,l),u=ze(e,o);for(let d=0;d<u.size;++d){let p=u.indexToLoc(d),f=p.map((h,m)=>h+t[m]);u.set(c.get(...f),...p)}return o==="string"?T.fromStringArrayToUint8(u.values):u.values}function sa(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{begin:i,size:s}=r;we(o,"slice");let[a,l]=yr.parseSliceParams(o,i,s);yr.assertParamsValid(o,a,l);let c=e.data.get(o.dataId).values,u=C$(c,a,l,o.shape,o.dtype);return e.makeTensorInfo(l,o.dtype,u)}var fZ={kernelName:su,backendName:"cpu",kernelFunc:sa};function vT(n,t,e,r,o,i,s){let a=t[0],l=i[0],c=new Array(l),u=new Array(a),d=t[1];if(l===0){if(a!==0)throw new Error(T.getSparseFillEmptyRowsIndicesDenseShapeMismatch(a));let g=b.getArrayFromDType(e,0),y=b.getArrayFromDType(o,0);return[g,[0,d],y,c,u]}let p=!0,f=0,h=new Array(l).fill(0);for(let g=0;g<a;++g){let y=n[g*d];if(y<0)throw new Error(T.getSparseFillEmptyRowsNegativeIndexErrorMessage(g,y));if(y>=l)throw new Error(T.getSparseFillEmptyRowsOutOfRangeIndexErrorMessage(g,y,l));++h[y],p=p&&y>=f,f=y}let m=!0;for(let g=0;g<l;++g){let y=h[g]===0;c[g]=y,m=m&&!y,h[g]=Math.max(h[g],1),g>0&&(h[g]+=h[g-1])}if(m&&p){let g=n,y=r;for(let v=0;v<a;++v)u[v]=v;return[g,[a,d],y,c,u]}else{let g=h[l-1],y=b.getArrayFromDType(e,g*d),v=b.getArrayFromDType(o,g),w=new Array(l).fill(0);for(let C=0;C<a;++C){let I=n[C*d],A=w[I],M=(I===0?0:h[I-1])+A;w[I]++;for(let $=0;$<d;++$)y[M*d+$]=n[C*d+$];v[M]=r[C],u[C]=M}for(let C=0;C<l;++C)if(w[C]===0){let A=C===0?0:h[C-1];y[A*d+0]=C;for(let M=1;M<d;++M)y[A*d+M]=0;v[A]=s}return[y,[g,d],v,c,u]}}function bT(n,t,e,r,o){let i=b.sizeFromShape(r),s=t[0],a=o.length,l=[],c=1,u=-1;for(let g=0;g<a;++g){let y=o[g];if(y===-1){if(u!==-1)throw new Error(T.getSparseReshapeMultipleNegativeOneOutputDimErrorMessage(u,g));u=g,l.push(1)}else{if(y<0)throw new Error(T.getSparseReshapeNegativeOutputDimErrorMessage(g,y));c*=y,l.push(y)}}if(u!==-1){if(c<=0)throw new Error(T.getSparseReshapeEmptyTensorZeroOutputDimErrorMessage());let g=Math.trunc(i/c);if(c*g!==i)throw new Error(T.getSparseReshapeInputOutputMultipleErrorMessage(r,l));l[u]=g}if(b.sizeFromShape(l)!==i)throw new Error(T.getSparseReshapeInputOutputMismatchErrorMessage(r,l));let p=r.length,f=[];if(p>0){f[p-1]=1;for(let g=p-2;g>=0;--g)f[g]=f[g+1]*r[g+1]}let h=[];if(a>0){h[a-1]=1;for(let g=a-2;g>=0;--g)h[g]=h[g+1]*l[g+1]}let m=b.getArrayFromDType(e,s*a);for(let g=0;g<s;++g){let y=0;for(let v=0;v<p;++v)y+=n[g*p+v]*f[v];for(let v=0;v<a;++v)m[g*a+v]=Math.trunc(y/h[v]),y%=h[v]}return[m,[s,a],l]}function Kx(n,t,e,r,o,i=!1,s=0){let a=r.length,l=[t[0],n.length/t[0]],c=l[1],d=a>0?o[a-1]+1:0;if(d<0)throw new Error(T.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());let p=t.slice();p[0]=d;let f=p.reduce((w,C)=>w*C,1),h=b.getArrayFromDType(e,f);if(a===0)return d>0&&h.fill(s),[h,p];if(d<=0)throw new Error(T.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());let m=0,g=1,y=0,v=o[m];for(;;){let w=0;if(g<a){if(w=o[g],v===w){++g;continue}if(v>=w)throw new Error(T.getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage())}if(v<0||v>=d)throw new Error(T.getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage(v,d));v>y&&h.fill(s,y*c,v*c);for(let C=m;C<g;++C){let I=r[C];if(I<0||I>=l[0])throw new Error(T.getSparseSegmentReductionIndicesOutOfRangeErrorMessage(C,r[C],l[0]));for(let A=0;A<c;A++)h[v*c+A]+=n[I*c+A]}if(i)for(let C=0;C<c;C++)h[v*c+C]/=g-m;if(m=g,++g,y=v+1,v=w,g>a)break}return y<d&&h.fill(s,y*c,d*c),[h,p]}var hZ=oo(n=>Math.sqrt(n)),IPe=ut(vl,n=>Math.sqrt(n)),mZ={kernelName:vl,backendName:"cpu",kernelFunc:IPe};var _$=$t((n,t)=>{let e=n-t;return e*e}),EPe=Xt(bl,_$),gZ={kernelName:bl,backendName:"cpu",kernelFunc:EPe};var S$=oo((n,t)=>{let{pattern:e,replaceGlobal:r,rewrite:o}=t;return n.replace(new RegExp(e,r?"g":""),o)}),TPe=bi(Qh,S$),yZ={kernelName:Qh,backendName:"cpu",kernelFunc:TPe};function wT(n,t,e,r){let o=ze(n,t.dtype);for(let i=0;i<o.size;i++){let s=o.indexToLoc(i),a=new Array(s.length);for(let l=0;l<a.length;l++)a[l]=s[l]*e[l]+r[l];o.set(t.get(...a),...s)}return o}var I$=class{constructor(t,e,r,o,i,s){this.separator=b.encodeString(t),this.nGramWidths=e,this.leftPad=b.encodeString(r),this.rightPad=b.encodeString(o),this.padWidth=i,this.preserveShort=s}getPadWidth(t){return Math.min(this.padWidth<0?t-1:this.padWidth,t-1)}getNumNGrams(t,e){let r=this.getPadWidth(e);return Math.max(0,t+2*r-e+1)}createNGrams(t,e,r,o,i,s){for(let a=0;a<i;++a){let l=this.getPadWidth(s),c=Math.max(0,l-a),u=Math.max(0,l-(i-(a+1))),d=s-(c+u),p=e+(c>0?0:a-l),f=0;f+=c*this.leftPad.length;for(let v=0;v<d;++v)f+=t[p+v].length;f+=u*this.rightPad.length;let h=c+u+d-1;f+=h*this.separator.length,r[o+a]=new Uint8Array(f);let m=r[o+a],g=0,y=v=>v.forEach(w=>m[g++]=w);for(let v=0;v<c;++v)y(this.leftPad),y(this.separator);for(let v=0;v<d-1;++v)y(t[p+v]),y(this.separator);if(d>0){y(t[p+d-1]);for(let v=0;v<u;++v)y(this.separator),y(this.rightPad)}else{for(let v=0;v<u-1;++v)y(this.rightPad),y(this.separator);y(this.rightPad)}}}compute(t,e){let r=t.length,o=e.length;if(o>0){let l=e[0];if(l!==0)throw new Error(`First split value must be 0, got ${l}`);for(let c=1;c<o;++c){let u=e[c]>=l;if(u=u&&e[c]<=r,!u)throw new Error(`Invalid split value ${e[c]}, must be in [${l}, ${r}]`);l=e[c]}if(l!==r)throw new Error(`Last split value must be data size. Expected ${r}, got ${l}`)}let i=o-1,s=b.getArrayFromDType("int32",o);if(r===0||o===0){let l=new Array(r);for(let c=0;c<=i;++c)s[c]=0;return[l,s]}s[0]=0;for(let l=1;l<=i;++l){let c=e[l]-e[l-1],u=0;this.nGramWidths.forEach(d=>{u+=this.getNumNGrams(c,d)}),this.preserveShort&&c>0&&u===0&&(u=1),s[l]=s[l-1]+u}let a=new Array(s[i]);for(let l=0;l<i;++l){let c=e[l],u=s[l];if(this.nGramWidths.forEach(d=>{let p=e[l+1]-e[l],f=this.getNumNGrams(p,d);this.createNGrams(t,c,a,u,f,d),u+=f}),this.preserveShort&&u===s[l]){let d=e[l+1]-e[l];if(d===0)continue;let p=d+2*this.padWidth;this.createNGrams(t,c,a,u,1,p)}}return[a,s]}};function CT(n,t,e,r,o,i,s,a){return new I$(e,r,o,i,s,a).compute(n,t)}function DPe(n,t,e,r){if(!n.length)return;if(t.length===0){for(let i=0;i<n.length;++i)r.push(n.subarray(i,i+1));return}if(t.length===1){let i=t[0],s=n.indexOf(i);for(;s!==-1;){let a=n.subarray(0,s);(!e||a.length!==0)&&r.push(a),n=n.subarray(s+1),s=n.indexOf(i)}(!e||n.length!==0)&&r.push(n);return}let o=0;for(let i=0;i<n.length+1;i++)if(i===n.length||t.indexOf(n[i])!==-1){let s=n.subarray(o,i);(!e||s.length!==0)&&r.push(s),o=i+1}}function _T(n,t,e){let r=n.length,o=[],i=0,s=0,a=new Array(r);for(let p=0;p<r;++p){let f=o.length;DPe(n[p],t,e,o);let h=o.length-f;a[p]=h,i+=h,s=Math.max(s,h)}let l=b.getArrayFromDType("int32",i*2),c=new Array(i),u=[r,s],d=0;for(let p=0;p<r;++p)for(let f=0;f<a[p];++f)l[d*2]=p,l[d*2+1]=f,c[d]=o[d],++d;return[l,c,u]}function ST(n,t){let e=b.getArrayFromDType("int32",n.length);for(let r=0;r<n.length;++r)e[r]=b.fingerPrint64(n[r]).modulo(t).getLowBitsUnsigned();return e}var E$=$t((n,t)=>n-t),kPe=jx((n,t,e,r)=>({real:n-e,imag:t-r})),sw=Xt(wl,E$,kPe),xZ={kernelName:wl,backendName:"cpu",kernelFunc:sw};function IT(n,t){let e=new Array(n.rank);for(let o=0;o<e.length;o++)e[o]=n.shape[o]*t[o];let r=ze(e,n.dtype);for(let o=0;o<r.values.length;++o){let i=r.indexToLoc(o),s=new Array(n.rank);for(let l=0;l<s.length;l++)s[l]=i[l]%n.shape[l];let a=n.locToIndex(s);r.values[o]=n.values[a]}return r}var aw=(n,t)=>{let e=t.value-n.value;return e===0?n.index-t.index:e};function vZ(n,t,e=0,r=n.length-1){for(;r>e;){if(r-e>600){let a=r-e+1,l=t-e+1,c=Math.log(a),u=.5*Math.exp(2*c/3),d=.5*Math.sqrt(c*u*(a-u)/a)*Math.sign(l-a/2),p=Math.max(e,Math.floor(t-l*u/a+d)),f=Math.min(r,Math.floor(t+(a-l)*u/a+d));vZ(n,t,p,f)}let o=n[t],i=e,s=r;for(b.swap(n,e,t),aw(n[r],o)>0&&b.swap(n,e,r);i<s;){for(b.swap(n,i,s),i++,s--;aw(n[i],o)<0;)i=i+1;for(;aw(n[s],o)>0;)s=s-1}aw(n[e],o)===0?b.swap(n,e,s):(s=s+1,b.swap(n,s,r)),s<=t&&(e=s+1),t<=s&&(r=s-1)}}function ET(n,t,e,r,o){let i=t[t.length-1],[s,a]=[n.length/i,i],l=b.getTypedArrayFromDType(e,s*r),c=b.getTypedArrayFromDType("int32",s*r);for(let d=0;d<s;d++){let p=d*a,f=n.subarray(p,p+a),h=new Array(f.length);f.forEach((v,w)=>h[w]={value:v,index:w}),r<h.length&&(vZ(h,r),h=h.slice(0,r)),o&&h.sort(aw);let m=d*r,g=l.subarray(m,m+r),y=c.subarray(m,m+r);for(let v=0;v<r;v++)g[v]=h[v].value,y[v]=h[v].index}let u=t.slice();return u[u.length-1]=r,[ze(u,e,l),ze(u,"int32",c)]}function TT(n,t,e,r){let o=b.parseAxisParam(t,e)[0],i=[1,e[0],1];for(let h=0;h<o;h++)i[0]*=e[h];i[1]=e[o];for(let h=o+1;h<e.length;h++)i[2]*=e[h];let s=new Map,a=new Int32Array(e[o]),l=new an(i,r,n),c=[],u=i[0]===1&&i[2]===1;for(let h=0;h<e[o];h++){let m;if(u)m=n[h].toString();else{let y=[];for(let v=0;v<i[0];v++)for(let w=0;w<i[2];w++)y.push(l.get(v,h,w));m=y.join(",")}let g=s.get(m);if(g!=null)a[h]=g;else{let y=s.size;s.set(m,y),a[h]=y,c.push(h)}}let d=i.slice();d[1]=s.size;let p=new an(d,r);c.forEach((h,m)=>{for(let g=0;g<i[0];g++)for(let y=0;y<i[2];y++)p.set(l.get(g,h,y),g,m,y)});let f=e.slice();return f[o]=d[1],{outputValues:p.values,outputShape:f,indices:a}}Hy("cpu",()=>new MY,1);var T$=ut(ja,n=>n>=0?n:Math.exp(n)-1),bZ={kernelName:ja,backendName:"cpu",kernelFunc:T$};function D$(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{alpha:i}=r;we([o],"leakyRelu");let s=b.sizeFromShape(o.shape),a=e.data.get(o.dataId).values,l=b.getTypedArrayFromDType("float32",s);for(let c=0;c<a.length;c++)l[c]=a[c]<0?i*a[c]:a[c];return e.makeTensorInfo(o.shape,"float32",l)}var wZ={kernelName:Bc,backendName:"cpu",kernelFunc:D$};var NPe=$t((n,t)=>n<0?t*n:n);function k$(n){let{inputs:t,backend:e}=n,{x:r,alpha:o}=t;we([r,o],"prelu");let i=e.data.get(r.dataId).values,s=e.data.get(o.dataId).values,[a,l]=NPe(r.shape,o.shape,i,s,"float32");return e.makeTensorInfo(l,"float32",a)}var CZ={kernelName:Jc,backendName:"cpu",kernelFunc:k$};var N$=ut(cl,n=>Math.max(0,n)),_Z={kernelName:cl,backendName:"cpu",kernelFunc:N$};var A$=ut(ul,n=>Math.min(Math.max(0,n),6)),SZ={kernelName:ul,backendName:"cpu",kernelFunc:A$};function Pm(n,t,e,r,o){if(e==="linear")return Io({inputs:{x:t},backend:n});if(e==="relu")return N$({inputs:{x:t},backend:n});if(e==="elu")return T$({inputs:{x:t},backend:n});if(e==="relu6")return A$({inputs:{x:t},backend:n});if(e==="prelu")return k$({inputs:{x:t,alpha:r},backend:n});if(e==="leakyrelu")return D$({inputs:{x:t},backend:n,attrs:{alpha:o}});if(e==="sigmoid")return w$({inputs:{x:t},backend:n});throw new Error(`Activation ${e} has not been implemented for the CPU backend.`)}function Vt(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{shape:i}=r,s=b.sizeFromShape(o.shape),a=b.inferFromImplicitShape(i,s),l=b.sizeFromShape(a);b.assert(s===l,()=>`The new shape (${a}) has ${l} elements and the old shape (${o.shape}) has ${s} elements. The new shape and old shape must have the same number of elements.`),e.incRef(o.dataId);let c=e.data.get(o.dataId);if(c.complexTensorInfos!=null){let u=c.complexTensorInfos.real,d=c.complexTensorInfos.imag;u.shape=a,d.shape=a}return{dataId:o.dataId,shape:a,dtype:o.dtype}}var IZ={kernelName:tu,backendName:"cpu",kernelFunc:Vt};function R$(n){let{inputs:t,backend:e,attrs:r}=n,{a:o,b:i}=t,{transposeA:s,transposeB:a}=r;we([o,i],"matMul");let l=o.shape.length,c=i.shape.length,u=s?o.shape[l-2]:o.shape[l-1],d=a?i.shape[c-1]:i.shape[c-2],p=s?o.shape[l-1]:o.shape[l-2],f=a?i.shape[c-2]:i.shape[c-1],h=o.shape.slice(0,-2),m=i.shape.slice(0,-2),g=b.sizeFromShape(h),y=b.sizeFromShape(m),w=Zo.assertAndGetBroadcastShape(o.shape.slice(0,-2),i.shape.slice(0,-2)).concat([p,f]);b.assert(u===d,()=>`Error in matMul: inner shapes (${u}) and (${d}) of Tensors with shapes ${o.shape} and ${i.shape} and transposeA=${s} and transposeB=${a} must match.`);let C=s?[g,u,p]:[g,p,u],I=a?[y,f,d]:[y,d,f],A=Vt({inputs:{x:o},backend:e,attrs:{shape:C}}),M=Vt({inputs:{x:i},backend:e,attrs:{shape:I}}),$=s?A.shape[1]:A.shape[2],V=s?A.shape[2]:A.shape[1],W=a?M.shape[1]:M.shape[2],K=Math.max(g,y),te=e.data.get(A.dataId).values,ee=e.data.get(M.dataId).values,oe=b.computeStrides(A.shape),ie=b.computeStrides(M.shape),[se,fe,ue]=s?[oe[0],1,oe[1]]:[oe[0],oe[1],1],[ye,Te,De]=a?[1,ie[1],ie[0]]:[ie[1],1,ie[0]],Fe=V*W,Re=ze([K,V,W],A.dtype),Ve=Re.values,Le=e.blockSize;for(let qe=0;qe<K;qe++){let lt=qe%g,mt=qe%y;for(let pt=0;pt<V;pt+=Le){let Rt=Math.min(pt+Le,V);for(let kt=0;kt<W;kt+=Le){let Sn=Math.min(kt+Le,W);for(let Nt=0;Nt<$;Nt+=Le){let Yt=Math.min(Nt+Le,$);for(let Fn=pt;Fn<Rt;Fn++)for(let Nn=kt;Nn<Sn;Nn++){let Qn=0;for(let jn=Nt;jn<Yt;jn++){let Cs=te[lt*se+Fn*fe+jn*ue],zr=ee[jn*ye+Nn*Te+mt*De];Qn+=Cs*zr}Ve[qe*Fe+(Fn*W+Nn)]+=Qn}}}}}return e.disposeIntermediateTensorInfo(A),e.disposeIntermediateTensorInfo(M),e.makeTensorInfo(w,Re.dtype,Re.values)}var EZ={kernelName:Tc,backendName:"cpu",kernelFunc:R$};function APe(n){let{inputs:t,backend:e,attrs:r}=n,{a:o,b:i,bias:s,preluActivationWeights:a}=t,{transposeA:l,transposeB:c,activation:u,leakyreluAlpha:d}=r,p,f,h,m=[];p=R$({inputs:{a:o,b:i},attrs:{transposeA:l,transposeB:c},backend:e}),s&&(f=Du({inputs:{a:p,b:s},backend:e}),m.push(p),p=f),u&&(h=Pm(e,p,u,a,d),m.push(p),p=h);for(let y of m)e.disposeIntermediateTensorInfo(y);return p}var TZ={kernelName:Id,backendName:"cpu",kernelFunc:APe};var RPe=ut(Oa,n=>Math.acos(n)),DZ={kernelName:Oa,backendName:"cpu",kernelFunc:RPe};var OPe=ut(Ma,n=>Math.acosh(n)),kZ={kernelName:Ma,backendName:"cpu",kernelFunc:OPe};function MPe(n){let{inputs:t,backend:e}=n,r=t;we(t,"addN");let o=r.map(a=>e.data.get(a.dataId).values),i=ze(r[0].shape,r[0].dtype),s=i.values;for(let a=0;a<r.length;a++){let l=o[a];for(let c=0;c<s.length;c++)s[c]+=l[c]}return e.makeTensorInfo(i.shape,i.dtype,i.values)}var NZ={kernelName:Cc,backendName:"cpu",kernelFunc:MPe};function PPe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{axis:i,keepDims:s}=r;we(o,"all");let a=b.parseAxisParam(i,o.shape),l=a,c=T.getAxesPermutation(l,o.shape.length),u=o;c!=null&&(u=cr({inputs:{x:o},backend:e,attrs:{perm:c}}),l=T.getInnerMostAxes(l.length,o.shape.length)),T.assertAxesAreInnerMostDims("all",l,u.shape.length);let[d,p]=T.computeOutAndReduceShapes(u.shape,l),f=b.sizeFromShape(p),h=b.makeZerosTypedArray(b.sizeFromShape(d),u.dtype),m=e.data.get(u.dataId).values;for(let y=0;y<h.length;++y){let v=y*f,w=m[v];for(let C=0;C<f;++C){let I=m[v+C];w=w&&I}h[y]=w}c!=null&&e.disposeIntermediateTensorInfo(u);let g=e.makeTensorInfo(d,u.dtype,h);if(s){let y=T.expandShapeToKeepDim(d,a),v=Vt({inputs:{x:g},backend:e,attrs:{shape:y}});return e.disposeIntermediateTensorInfo(g),v}return g}var AZ={kernelName:Tp,backendName:"cpu",kernelFunc:PPe};function FPe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{axis:i,keepDims:s}=r;we(o,"any");let a=b.parseAxisParam(i,o.shape),l=a,c=T.getAxesPermutation(l,o.shape.length),u=o;c!=null&&(u=cr({inputs:{x:o},backend:e,attrs:{perm:c}}),l=T.getInnerMostAxes(l.length,o.shape.length)),T.assertAxesAreInnerMostDims("any",l,u.shape.length);let[d,p]=T.computeOutAndReduceShapes(u.shape,l),f=b.sizeFromShape(p),h=b.makeZerosTypedArray(b.sizeFromShape(d),u.dtype),m=e.data.get(u.dataId).values;for(let y=0;y<h.length;++y){let v=y*f,w=m[v];for(let C=0;C<f;++C){let I=m[v+C];w=w||I}h[y]=w}c!=null&&e.disposeIntermediateTensorInfo(u);let g=e.makeTensorInfo(d,u.dtype,h);if(s){let y=T.expandShapeToKeepDim(d,a),v=Vt({inputs:{x:g},backend:e,attrs:{shape:y}});return e.disposeIntermediateTensorInfo(g),v}return g}var RZ={kernelName:Dp,backendName:"cpu",kernelFunc:FPe};function LPe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{axis:i}=r;we(o,"argMax");let s=b.parseAxisParam(i,o.shape),a=T.getAxesPermutation(s,o.shape.length),l=o,c=[];a!=null&&(l=cr({inputs:{x:o},backend:e,attrs:{perm:a}}),c.push(l),s=T.getInnerMostAxes(s.length,l.shape.length)),s=[s[0]],T.assertAxesAreInnerMostDims("argMax",s,l.shape.length);let[u,d]=T.computeOutAndReduceShapes(l.shape,s),p=b.sizeFromShape(u),f=b.makeZerosTypedArray(p,"int32"),h=b.sizeFromShape(d),m=e.data.get(l.dataId).values;for(let g=0;g<f.length;++g){let y=g*h,v=m[y],w=0;for(let C=0;C<h;++C){let I=m[y+C];I>v&&(v=I,w=C)}f[g]=w}return c.forEach(g=>e.disposeIntermediateTensorInfo(g)),e.makeTensorInfo(u,"int32",f)}var OZ={kernelName:_c,backendName:"cpu",kernelFunc:LPe};function $Pe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{axis:i}=r;we(o,"argMin");let s=b.parseAxisParam(i,o.shape),a=T.getAxesPermutation(s,o.shape.length),l=o,c=[];a!=null&&(l=cr({inputs:{x:o},backend:e,attrs:{perm:a}}),c.push(l),s=T.getInnerMostAxes(s.length,l.shape.length)),s=[s[0]],T.assertAxesAreInnerMostDims("argMin",s,l.shape.length);let[u,d]=T.computeOutAndReduceShapes(l.shape,s),p=b.sizeFromShape(u),f=b.makeZerosTypedArray(p,"int32"),h=b.sizeFromShape(d),m=e.data.get(l.dataId).values;for(let g=0;g<f.length;++g){let y=g*h,v=m[y],w=0;for(let C=0;C<h;++C){let I=m[y+C];I<v&&(v=I,w=C)}f[g]=w}return c.forEach(g=>e.disposeIntermediateTensorInfo(g)),e.makeTensorInfo(u,"int32",f)}var MZ={kernelName:Sc,backendName:"cpu",kernelFunc:$Pe};var VPe=ut(Pa,n=>Math.asin(n)),PZ={kernelName:Pa,backendName:"cpu",kernelFunc:VPe};var BPe=ut(Fa,n=>Math.asinh(n)),FZ={kernelName:Fa,backendName:"cpu",kernelFunc:BPe};var zPe=ut(La,n=>Math.atan(n)),LZ={kernelName:La,backendName:"cpu",kernelFunc:zPe};var UPe=$t((n,t)=>Math.atan2(n,t)),WPe=Xt(Va,UPe),$Z={kernelName:Va,backendName:"cpu",kernelFunc:WPe};var GPe=ut($a,n=>Math.atanh(n)),VZ={kernelName:$a,backendName:"cpu",kernelFunc:GPe};function Xx(n,t,e,r,o,i){let s=o.strideHeight,a=o.strideWidth,l=o.dilationHeight,c=o.dilationWidth,u=o.effectiveFilterHeight,d=o.effectiveFilterWidth,p=o.padInfo.top,f=o.padInfo.left,h=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=ze(o.outShape,e),g=m.values,y=o.outShape[1]*o.outShape[2]*o.outShape[3],v=o.outShape[2]*o.outShape[3],w=o.outShape[3];for(let C=0;C<o.batchSize;++C){let I=C*y,A=C*r[0];for(let M=0;M<o.inChannels;++M)for(let $=0;$<o.outHeight;++$){let V=$*s-p,W=Math.max(0,V),K=Math.min(o.inHeight,u+V),te=I+$*v;for(let ee=0;ee<o.outWidth;++ee){let oe=ee*a-f,ie=Math.max(0,oe),se=Math.min(o.inWidth,d+oe),fe=h,ue=0,ye=0;for(let De=W;De<K;De+=l){let Fe=A+De*r[1];for(let Re=ie;Re<se;Re+=c){let Ve=Fe+Re*r[2],Le=n[Ve+M];i==="max"&&Le>fe?fe=Le:i==="avg"&&(ue+=Le,ye++)}if(isNaN(fe))break}let Te=te+ee*w+M;g[Te]=i==="avg"?ue/ye:fe}}}return m}function DT(n,t,e,r,o=!1,i=!1){let s=ze(r.outShape,"int32"),a=r.strideHeight,l=r.strideWidth,c=r.dilationHeight,u=r.dilationWidth,d=r.effectiveFilterHeight,p=r.effectiveFilterWidth,f=r.padInfo.top,h=r.padInfo.left,m=ze(t,e,n);for(let g=0;g<r.batchSize;++g)for(let y=0;y<r.inChannels;++y)for(let v=0;v<r.outHeight;++v){let w=v*a-f,C=w;for(;C<0;)C+=c;let I=Math.min(r.inHeight,d+w);for(let A=0;A<r.outWidth;++A){let M=A*l-h,$=M;for(;$<0;)$+=u;let V=Math.min(r.inWidth,p+M),W=Number.NEGATIVE_INFINITY,K=-1;for(let te=C;te<I;te+=c){let ee=te-w;for(let oe=$;oe<V;oe+=u){let ie=oe-M,se=m.get(g,te,oe,y);se>W&&(W=se,o?K=i?((g*r.inHeight+te)*r.inWidth+oe)*r.inChannels+y:(te*r.inWidth+oe)*r.inChannels+y:K=ee*p+ie)}}s.set(K,g,v,A,y)}}return s}function kT(n,t,e,r,o,i){let s=o.strideDepth,a=o.strideHeight,l=o.strideWidth,c=o.dilationDepth,u=o.dilationHeight,d=o.dilationWidth,p=o.effectiveFilterDepth,f=o.effectiveFilterHeight,h=o.effectiveFilterWidth,m=o.padInfo.front,g=o.padInfo.top,y=o.padInfo.left,v=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,w=ze(o.outShape,e),C=w.values,I=o.outShape[1]*o.outShape[2]*o.outShape[3]*o.outShape[4],A=o.outShape[2]*o.outShape[3]*o.outShape[4],M=o.outShape[3]*o.outShape[4],$=o.outShape[4];for(let V=0;V<o.batchSize;++V){let W=V*I,K=V*r[0];for(let te=0;te<o.inChannels;++te)for(let ee=0;ee<o.outDepth;++ee){let oe=ee*s-m,ie=oe;for(;ie<0;)ie+=c;let se=Math.min(o.inDepth,p+oe),fe=W+ee*A;for(let ue=0;ue<o.outHeight;++ue){let ye=ue*a-g,Te=ye;for(;Te<0;)Te+=u;let De=Math.min(o.inHeight,f+ye),Fe=fe+ue*M;for(let Re=0;Re<o.outWidth;++Re){let Ve=Re*l-y,Le=Ve;for(;Le<0;)Le+=d;let qe=Math.min(o.inWidth,h+Ve),lt=Fe+Re*$,mt=v,pt=0,Rt=0;for(let Sn=ie;Sn<se;Sn+=c){let Nt=K+Sn*r[1];for(let Yt=Te;Yt<De;Yt+=u){let Fn=Nt+Yt*r[2];for(let Nn=Le;Nn<qe;Nn+=d){let Qn=Fn+Nn*r[3],jn=n[Qn+te];if(i==="max"&&jn>mt?mt=jn:i==="avg"&&(pt+=jn,Rt++),isNaN(mt))break}if(isNaN(mt))break}if(isNaN(mt))break}let kt=lt+te;C[kt]=i==="avg"?pt/Math.max(Rt,1):mt}}}}return w}function BZ(n,t){let e=ze(t.outShape,"int32"),r=t.strideDepth,o=t.strideHeight,i=t.strideWidth,s=t.dilationDepth,a=t.dilationHeight,l=t.dilationWidth,c=t.effectiveFilterDepth,u=t.effectiveFilterHeight,d=t.effectiveFilterWidth,p=t.padInfo.front,f=t.padInfo.top,h=t.padInfo.left;for(let m=0;m<t.batchSize;++m)for(let g=0;g<t.inChannels;++g)for(let y=0;y<t.outDepth;++y){let v=y*r-p,w=v;for(;w<0;)w+=s;let C=Math.min(t.inDepth,c+v);for(let I=0;I<t.outHeight;++I){let A=I*o-f,M=A;for(;M<0;)M+=a;let $=Math.min(t.inHeight,u+A);for(let V=0;V<t.outWidth;++V){let W=V*i-h,K=W;for(;K<0;)K+=l;let te=Math.min(t.inWidth,d+W),ee=Number.NEGATIVE_INFINITY,oe=-1;for(let ie=w;ie<C;ie+=s){let se=ie-v;for(let fe=M;fe<$;fe+=a){let ue=fe-A;for(let ye=K;ye<te;ye+=l){let Te=ye-W,De=n.get(m,ie,fe,ye,g);De>=ee&&(ee=De,oe=se*u*d+ue*u+Te)}}}e.set(oe,m,y,I,V,g)}}}return e}function jPe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t;we(o,"avgPool");let{filterSize:i,strides:s,pad:a,dimRoundingMode:l}=r,c=1;b.assert(T.eitherStridesOrDilationsAreOne(s,c),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${s} and dilations '${c}'`);let u=T.computePool2DInfo(o.shape,i,s,c,a,l),d;if(u.filterWidth===1&&u.filterHeight===1&&b.arraysEqual(u.inShape,u.outShape))d=Io({inputs:{x:o},backend:e});else{let p=e.data.get(o.dataId).values,f=b.computeStrides(o.shape),h=Xx(p,o.shape,o.dtype,f,u,"avg");d=e.makeTensorInfo(u.outShape,o.dtype,h.values)}return d}var zZ={kernelName:Ic,backendName:"cpu",kernelFunc:jPe};function HPe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{filterSize:i,strides:s,pad:a,dimRoundingMode:l,dataFormat:c}=r;we(o,"avgPool3d");let u=T.computePool3DInfo(o.shape,i,s,1,a,l,c),d=e.data.get(o.dataId).values,p=kT(d,o.shape,o.dtype,b.computeStrides(o.shape),u,"avg");return e.makeTensorInfo(p.shape,"float32",p.values)}var UZ={kernelName:Ec,backendName:"cpu",kernelFunc:HPe};function qPe(n){let{inputs:t,backend:e,attrs:r}=n,{dy:o,input:i}=t,{filterSize:s,strides:a,pad:l,dimRoundingMode:c}=r;we([o,i],"avgPool3DGrad");let u=T.computePool3DInfo(i.shape,s,a,1,l,c),d=u.strideDepth,p=u.strideHeight,f=u.strideWidth,h=u.filterDepth,m=u.filterHeight,g=u.filterWidth,y=u.dilationDepth,v=u.dilationHeight,w=u.dilationWidth,C=u.effectiveFilterDepth,I=u.effectiveFilterHeight,A=u.effectiveFilterWidth,M=C-1-u.padInfo.front,$=A-1-u.padInfo.left,V=I-1-u.padInfo.top,W=ze(i.shape,"float32"),K=1/(h*m*g),te=e.bufferSync(o);for(let ee=0;ee<u.batchSize;++ee)for(let oe=0;oe<u.inChannels;++oe)for(let ie=0;ie<u.inDepth;++ie)for(let se=0;se<u.inHeight;++se)for(let fe=0;fe<u.inWidth;++fe){let ue=ie-M,ye=se-V,Te=fe-$,De=0;for(let Fe=0;Fe<C;Fe+=y){let Re=(ue+Fe)/d;if(!(Re<0||Re>=u.outDepth||Math.floor(Re)!==Re))for(let Ve=0;Ve<I;Ve+=v){let Le=(ye+Ve)/p;if(!(Le<0||Le>=u.outHeight||Math.floor(Le)!==Le))for(let qe=0;qe<A;qe+=w){let lt=(Te+qe)/f;if(lt<0||lt>=u.outWidth||Math.floor(lt)!==lt)continue;let mt=te.get(ee,Re,Le,lt,oe);De+=mt}}}W.set(De*K,ee,ie,se,fe,oe)}return e.makeTensorInfo(W.shape,W.dtype,W.values)}var WZ={kernelName:Np,backendName:"cpu",kernelFunc:qPe};function KPe(n){let{inputs:t,backend:e,attrs:r}=n,{dy:o,input:i}=t,s=i;we([o,i],"avgPoolGrad");let{filterSize:a,strides:l,pad:c}=r,u=T.computePool2DInfo(s.shape,a,l,1,c),d=u.strideHeight,p=u.strideWidth,f=u.filterHeight,h=u.filterWidth,m=u.dilationHeight,g=u.dilationWidth,y=u.effectiveFilterHeight,v=u.effectiveFilterWidth,w=v-1-u.padInfo.left,C=y-1-u.padInfo.top,I=ze(s.shape,"float32"),A=1/(f*h),M=e.data.get(o.dataId).values,$=ze(o.shape,"float32",M);for(let V=0;V<u.batchSize;++V)for(let W=0;W<u.inChannels;++W)for(let K=0;K<u.inHeight;++K)for(let te=0;te<u.inWidth;++te){let ee=K-C,oe=te-w,ie=0;for(let se=0;se<y;se+=m){let fe=(ee+se)/d;if(!(fe<0||fe>=u.outHeight||Math.floor(fe)!==fe))for(let ue=0;ue<v;ue+=g){let ye=(oe+ue)/p;if(ye<0||ye>=u.outWidth||Math.floor(ye)!==ye)continue;let Te=$.get(V,fe,ye,W);ie+=Te}}I.set(ie*A,V,K,te,W)}return e.makeTensorInfo(I.shape,I.dtype,I.values)}var GZ={kernelName:kp,backendName:"cpu",kernelFunc:KPe};function XPe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,scale:i,offset:s,mean:a,variance:l}=t;b.assert(a.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),b.assert(s==null||a.shape.length===s.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),b.assert(i==null||a.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),we([o,a,l,i,s],"batchNorm");let{varianceEpsilon:c}=r;c==null&&(c=.001);let u=e.data.get(o.dataId).values,d=e.data.get(a.dataId).values,p=e.data.get(l.dataId).values,f=i?e.data.get(i.dataId).values:new Float32Array([1]),h=s?e.data.get(s.dataId).values:new Float32Array([0]),m=new Float32Array(u.length),g=h.length,y=f.length,v=p.length,w=d.length,C=0,I=0,A=0,M=0;for(let $=0;$<u.length;++$)m[$]=h[C++]+(u[$]-d[I++])*f[A++]/Math.sqrt(p[M++]+c),C>=g&&(C=0),I>=w&&(I=0),A>=y&&(A=0),M>=v&&(M=0);return e.makeTensorInfo(o.shape,o.dtype,m)}var jZ={kernelName:$c,backendName:"cpu",kernelFunc:XPe};function YPe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{blockShape:i,crops:s}=r;we([o],"batchToSpaceND");let a=i.reduce((y,v)=>y*v),l=T.getReshaped(o.shape,i,a),c=T.getPermuted(l.length,i.length),u=T.getReshapedPermuted(o.shape,i,a),d=T.getSliceBeginCoords(s,i.length),p=T.getSliceSize(u,s,i.length),f=Vt({inputs:{x:o},backend:e,attrs:{shape:l}}),h=cr({inputs:{x:f},backend:e,attrs:{perm:c}}),m=Vt({inputs:{x:h},backend:e,attrs:{shape:u}}),g=sa({inputs:{x:m},backend:e,attrs:{begin:d,size:p}});return e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(h),e.disposeIntermediateTensorInfo(m),g}var HZ={kernelName:Dc,backendName:"cpu",kernelFunc:YPe};function ZPe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,weights:i}=t,{size:s}=r,a=e.data.get(o.dataId).values,l=e.data.get(i.dataId).values,c=Hx(a,l,i.dtype,i.shape,s);return e.makeTensorInfo([s],i.dtype,c)}var qZ={kernelName:Ap,backendName:"cpu",kernelFunc:ZPe};function QPe(n){let{inputs:t,backend:e}=n,{s0:r,s1:o}=t,i=e.data.get(r.dataId).values,s=e.data.get(o.dataId).values,a=T.assertAndGetBroadcastShape(Array.from(i),Array.from(s));return e.makeTensorInfo([a.length],"int32",Int32Array.from(a))}var KZ={kernelName:Rp,backendName:"cpu",kernelFunc:QPe};var JPe=ut(za,(n,t)=>{let e=t;return n>e.clipValueMax?e.clipValueMax:n<e.clipValueMin?e.clipValueMin:n}),XZ={kernelName:za,backendName:"cpu",kernelFunc:JPe};var eFe=n=>{let{x:t}=n.inputs,e=n.backend,r=new Float32Array(b.sizeFromShape(t.shape)),o=e.data.get(t.dataId),i=o.complexTensorInfos.real,s=o.complexTensorInfos.imag,a=e.data.get(i.dataId).values,l=e.data.get(s.dataId).values;for(let c=0;c<a.length;c++){let u=a[c],d=l[c];r[c]=Math.hypot(u,d)}return e.makeOutput(r,t.shape,"float32")},YZ={kernelName:kc,backendName:"cpu",kernelFunc:eFe};function ku(n){let{inputs:t,backend:e}=n,{input:r}=t,o=e.data.get(r.dataId).complexTensorInfos.imag,i=e.data.get(o.dataId).values;return e.makeTensorInfo(o.shape,o.dtype,i)}var ZZ={kernelName:Zp,backendName:"cpu",kernelFunc:ku};function Jf(n){let{inputs:t,backend:e,attrs:r}=n,{axis:o}=r,i=b.parseAxisParam(o,t[0].shape)[0],s=t.map(m=>m.shape);T.assertParamsConsistent(s,i);let a=T.computeOutShape(t.map(m=>m.shape),i);if(b.sizeFromShape(a)===0)return e.makeTensorInfo(a,t[0].dtype,[]);let l=t.filter(m=>b.sizeFromShape(m.shape)>0);if(l.length===1)return Io({inputs:{x:l[0]},backend:e});if(l[0].dtype==="complex64"){let m=l.map(C=>ra({inputs:{input:C},backend:e})),g=l.map(C=>ku({inputs:{input:C},backend:e})),y=Jf({inputs:m,backend:e,attrs:{axis:i}}),v=Jf({inputs:g,backend:e,attrs:{axis:i}}),w=qr({inputs:{real:y,imag:v},backend:e});return m.forEach(C=>e.disposeIntermediateTensorInfo(C)),g.forEach(C=>e.disposeIntermediateTensorInfo(C)),e.disposeIntermediateTensorInfo(y),e.disposeIntermediateTensorInfo(v),w}let c=l.map(m=>{let y=[-1,b.sizeFromShape(m.shape.slice(i))];return Vt({inputs:{x:m},backend:e,attrs:{shape:y}})}),u=c.map(m=>({vals:e.data.get(m.dataId).values,shape:m.shape}));a=T.computeOutShape(c.map(m=>m.shape),1);let d=c[0].shape[0]===1,p=uT(u,a,t[0].dtype,d),f=T.computeOutShape(l.map(m=>m.shape),i),h=e.makeTensorInfo(f,t[0].dtype,p);return c.forEach(m=>e.disposeIntermediateTensorInfo(m)),h}var QZ={kernelName:Nc,backendName:"cpu",kernelFunc:Jf};function O$(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,filter:i}=t,{strides:s,pad:a,dataFormat:l,dilations:c,dimRoundingMode:u}=r;we([o,i],"conv2d");let d=T.convertConv2DDataFormat(l),p=T.computeConv2DInfo(o.shape,i.shape,s,c,a,u,!1,d),f=p.filterHeight,h=p.filterWidth,m=p.dilationHeight,g=p.dilationWidth,y=p.padInfo.left,v=p.padInfo.top,w=p.dataFormat==="channelsLast",C=new an(p.outShape,o.dtype),I=b.computeStrides(o.shape),A=b.computeStrides(i.shape),M=I[0],$=w?I[1]:I[2],V=w?I[2]:1,W=w?1:I[1],K=C.strides[0],te=w?C.strides[1]:C.strides[2],ee=w?C.strides[2]:1,oe=w?1:C.strides[1],ie=e.data.get(o.dataId).values,se=e.data.get(i.dataId).values,fe=C.values;for(let ue=0;ue<p.batchSize;++ue){let ye=ue*M,Te=ue*K;for(let De=0;De<p.outHeight;++De){let Fe=Te+De*te,Re=De*p.strideHeight-v;for(let Ve=0;Ve<f;++Ve){let Le=Re+Ve*m;if(Le<0||Le>=p.inHeight)continue;let qe=Ve*A[0],lt=ye+Le*$;for(let mt=0;mt<p.outWidth;++mt){let pt=Fe+mt*ee,Rt=mt*p.strideWidth-y;for(let kt=0;kt<h;++kt){let Sn=Rt+kt*g;if(Sn<0||Sn>=p.inWidth)continue;let Nt=qe+kt*A[1],Yt=lt+Sn*V,Fn=Nt;for(let Nn=0;Nn<p.inChannels;++Nn){let Qn=ie[Yt+Nn*W];for(let jn=0;jn<p.outChannels;++jn)fe[pt+jn*oe]+=Qn*se[Fn+jn];Fn+=p.outChannels}}}}}}return e.makeTensorInfo(C.shape,C.dtype,fe)}var JZ={kernelName:Ac,backendName:"cpu",kernelFunc:O$};function tFe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,dy:i}=t,{strides:s,pad:a,dataFormat:l,dimRoundingMode:c,filterShape:u}=r;we([o,i],"conv2dBackpropFilter");let d=T.convertConv2DDataFormat(l),p=T.computeConv2DInfo(o.shape,u,s,1,a,c,!1,d),{strideHeight:f,strideWidth:h,filterHeight:m,filterWidth:g}=p,y=p.dataFormat==="channelsLast",v=new an(p.filterShape,"float32"),w=p.padInfo.left,C=p.padInfo.top,I=e.data.get(o.dataId).values,A=e.data.get(i.dataId).values,M=new an(o.shape,o.dtype,I),$=new an(i.shape,i.dtype,A);for(let V=0;V<m;++V){let W=Math.max(0,Math.ceil((C-V)/f)),K=Math.min(p.outHeight,(p.inHeight+C-V)/f);for(let te=0;te<g;++te){let ee=Math.max(0,Math.ceil((w-te)/h)),oe=Math.min(p.outWidth,(p.inWidth+w-te)/h);for(let ie=0;ie<p.inChannels;++ie)for(let se=0;se<p.outChannels;++se){let fe=0;for(let ue=0;ue<p.batchSize;++ue)for(let ye=W;ye<K;++ye){let Te=V+ye*f-C;for(let De=ee;De<oe;++De){let Fe=te+De*h-w;y?fe+=M.get(ue,Te,Fe,ie)*$.get(ue,ye,De,se):fe+=M.get(ue,ie,Te,Fe)*$.get(ue,se,ye,De)}}v.set(fe,V,te,ie,se)}}}return e.makeTensorInfo(v.shape,v.dtype,v.values)}var eQ={kernelName:Mp,backendName:"cpu",kernelFunc:tFe};function nFe(n){let{inputs:t,backend:e,attrs:r}=n,{dy:o,filter:i}=t,{inputShape:s,strides:a,pad:l,dataFormat:c,dimRoundingMode:u}=r;we([o,i],"conv2dBackpropInput");let d=b.computeStrides(i.shape),p=b.computeStrides(o.shape),f=T.convertConv2DDataFormat(c),h=T.computeConv2DInfo(s,i.shape,a,1,l,u,!1,f),m=new an(h.inShape,"float32"),g=m.values,y=e.data.get(o.dataId).values,v=e.data.get(i.dataId).values,[w,C,I]=d,{batchSize:A,filterHeight:M,filterWidth:$,inChannels:V,inHeight:W,inWidth:K,outChannels:te,outHeight:ee,outWidth:oe,strideHeight:ie,strideWidth:se}=h;f=h.dataFormat;let fe=M-1-h.padInfo.top,ue=$-1-h.padInfo.left,ye=f==="channelsLast",Te=m.strides[0],De=ye?m.strides[1]:m.strides[2],Fe=ye?m.strides[2]:1,Re=ye?1:m.strides[1],Ve=p[0],Le=ye?p[1]:p[2],qe=ye?p[2]:1,lt=ye?1:p[1];for(let mt=0;mt<A;++mt)for(let pt=0;pt<V;++pt)for(let Rt=0;Rt<W;++Rt){let kt=Rt-fe,Sn=Math.max(0,Math.ceil(kt/ie)),Nt=Math.min(ee,(M+kt)/ie);for(let Yt=0;Yt<K;++Yt){let Fn=Yt-ue,Nn=Math.max(0,Math.ceil(Fn/se)),Qn=Math.min(oe,($+Fn)/se),jn=0;for(let zr=Sn;zr<Nt;++zr){let ca=zr*ie-kt;for(let Do=Nn;Do<Qn;++Do){let Hl=Do*se-Fn,io=Ve*mt+Le*zr+qe*Do,_s=w*(M-1-ca)+C*($-1-Hl)+I*pt;for(let os=0;os<te;++os){let Ss=y[io+lt*os],ql=v[_s+os];jn+=Ss*ql}}}let Cs=Te*mt+De*Rt+Fe*Yt+Re*pt;g[Cs]=jn}}return e.makeTensorInfo(m.shape,m.dtype,m.values)}var tQ={kernelName:Rc,backendName:"cpu",kernelFunc:nFe};function rFe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,filter:i}=t,{strides:s,pad:a,dilations:l}=r;we([o,i],"conv3d");let c=T.computeConv3DInfo(o.shape,i.shape,s,l,a),{filterDepth:u,filterHeight:d,filterWidth:p,dilationDepth:f,dilationHeight:h,dilationWidth:m,padInfo:g}=c,y=g.front,v=g.left,w=g.top,C=new an(c.outShape,o.dtype),I=e.data.get(o.dataId).values,A=e.data.get(i.dataId).values,M=C.values,$=b.computeStrides(o.shape),V=b.computeStrides(i.shape);for(let W=0;W<c.batchSize;++W){let K=W*$[0],te=W*C.strides[0];for(let ee=0;ee<c.outDepth;++ee){let oe=te+ee*C.strides[1],ie=ee*c.strideDepth-y;for(let se=0;se<u;++se){let fe=ie+se*f;if(fe<0||fe>=c.inDepth)continue;let ue=se*V[0],ye=K+fe*$[1];for(let Te=0;Te<c.outHeight;++Te){let De=oe+Te*C.strides[2],Fe=Te*c.strideHeight-w;for(let Re=0;Re<d;++Re){let Ve=Fe+Re*h;if(Ve<0||Ve>=c.inHeight)continue;let Le=ue+Re*V[1],qe=ye+Ve*$[2];for(let lt=0;lt<c.outWidth;++lt){let mt=De+lt*c.outChannels,pt=lt*c.strideWidth-v;for(let Rt=0;Rt<p;++Rt){let kt=pt+Rt*m;if(kt<0||kt>=c.inWidth)continue;let Sn=Le+Rt*V[2],Nt=qe+kt*c.inChannels,Yt=Sn;for(let Fn=0;Fn<c.inChannels;++Fn){let Nn=I[Nt+Fn];for(let Qn=0;Qn<c.outChannels;++Qn)M[mt+Qn]+=Nn*A[Yt+Qn];Yt+=c.outChannels}}}}}}}}return e.makeTensorInfo(C.shape,C.dtype,C.values)}var nQ={kernelName:Oc,backendName:"cpu",kernelFunc:rFe};function oFe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,dy:i}=t,{strides:s,pad:a,filterShape:l}=r;we([o,i],"conv3dBackpropFilterV2");let c=b.computeStrides(o.shape),u=b.computeStrides(i.shape),d=T.computeConv3DInfo(o.shape,l,s,1,a),p=d.strideDepth,f=d.strideHeight,h=d.strideWidth,m=d.filterDepth,g=d.filterHeight,y=d.filterWidth,v=new an(d.filterShape,"float32"),w=v.values,[C,I,A,M]=v.strides,$=e.data.get(i.dataId).values,[V,W,K,te]=u,ee=e.data.get(o.dataId).values,[oe,ie,se,fe]=c,ue=d.padInfo.front,ye=d.padInfo.left,Te=d.padInfo.top;for(let De=0;De<m;++De){let Fe=Math.max(0,Math.ceil((ue-De)/p)),Re=Math.min(d.outDepth,(d.inDepth+ue-De)/p),Ve=De*C;for(let Le=0;Le<g;++Le){let qe=Math.max(0,Math.ceil((Te-Le)/f)),lt=Math.min(d.outHeight,(d.inHeight+Te-Le)/f),mt=Le*I+Ve;for(let pt=0;pt<y;++pt){let Rt=Math.max(0,Math.ceil((ye-pt)/h)),kt=Math.min(d.outWidth,(d.inWidth+ye-pt)/h),Sn=pt*A+mt;for(let Nt=0;Nt<d.inChannels;++Nt){let Yt=Nt*M+Sn;for(let Fn=0;Fn<d.outChannels;++Fn){let Nn=0;for(let Qn=0;Qn<d.batchSize;++Qn){let jn=Qn*oe,Cs=Qn*V;for(let zr=Fe;zr<Re;++zr){let Do=(De+zr*p-ue)*ie+jn,Hl=zr*W+Cs;for(let io=qe;io<lt;++io){let os=(Le+io*f-Te)*se+Do,Ss=io*K+Hl;for(let ql=Rt;ql<kt;++ql){let Dv=(pt+ql*h-ye)*fe+os,eg=ql*te+Ss;Nn+=ee[Dv+Nt]*$[eg+Fn]}}}}w[Yt+Fn]=Nn}}}}}return e.makeTensorInfo(v.shape,v.dtype,v.values)}var rQ={kernelName:Pp,backendName:"cpu",kernelFunc:oFe};function iFe(n){let{inputs:t,backend:e,attrs:r}=n,{dy:o,filter:i}=t,{pad:s,strides:a,inputShape:l}=r;we([o],"conv3dBackpropInputV2");let c=b.computeStrides(o.shape),u=b.computeStrides(i.shape),d=T.computeConv3DInfo(l,i.shape,a,1,s),p=new an(d.inShape,"float32"),f=p.values,[h,m,g,y]=p.strides,v=e.data.get(o.dataId).values,[w,C,I,A]=c,M=e.data.get(i.dataId).values,[$,V,W,K]=u,{batchSize:te,filterDepth:ee,filterHeight:oe,filterWidth:ie,inChannels:se,inDepth:fe,inHeight:ue,inWidth:ye,outChannels:Te,outDepth:De,outHeight:Fe,outWidth:Re,strideDepth:Ve,strideHeight:Le,strideWidth:qe}=d,lt=ee-1-d.padInfo.front,mt=oe-1-d.padInfo.top,pt=ie-1-d.padInfo.left;for(let Rt=0;Rt<te;++Rt)for(let kt=0;kt<se;++kt)for(let Sn=0;Sn<fe;++Sn){let Nt=Sn-lt,Yt=Math.max(0,Math.ceil(Nt/Ve)),Fn=Math.min(De,(ee+Nt)/Ve);for(let Nn=0;Nn<ue;++Nn){let Qn=Nn-mt,jn=Math.max(0,Math.ceil(Qn/Le)),Cs=Math.min(Fe,(oe+Qn)/Le);for(let zr=0;zr<ye;++zr){let ca=zr-pt,Do=Math.max(0,Math.ceil(ca/qe)),Hl=Math.min(Re,(ie+ca)/qe),io=0;for(let _s=Yt;_s<Fn;++_s){let os=_s*Ve-Nt;for(let Ss=jn;Ss<Cs;++Ss){let ql=Ss*Le-Qn;for(let tp=Do;tp<Hl;++tp){let Dv=tp*qe-ca,eg=w*Rt+C*_s+I*Ss+A*tp,Bw=$*(ee-1-os)+V*(oe-1-ql)+W*(ie-1-Dv)+K*kt;for(let Kl=0;Kl<Te;++Kl){let kv=v[eg+Kl],zw=M[Bw+Kl];io+=kv*zw}}}}f[h*Rt+m*Sn+g*Nn+y*zr+kt]=io}}}return e.makeTensorInfo(p.shape,p.dtype,p.values)}var oQ={kernelName:Fp,backendName:"cpu",kernelFunc:iFe};var sFe=ut(Ua,n=>Math.cos(n)),iQ={kernelName:Ua,backendName:"cpu",kernelFunc:sFe};var aFe=ut(Wa,n=>Math.cosh(n)),sQ={kernelName:Wa,backendName:"cpu",kernelFunc:aFe};function lFe(n){let{inputs:t,backend:e,attrs:r}=n,{image:o,boxes:i,boxInd:s}=t,{cropSize:a,method:l,extrapolationValue:c}=r,[u,d,p,f]=o.shape,h=i.shape[0],[m,g]=a,y=ze([h,m,g,f],"float32"),v=e.data.get(i.dataId).values,w=e.data.get(s.dataId).values,C=e.data.get(o.dataId).values,I=b.computeStrides(o.shape),A=b.computeStrides(y.shape);for(let M=0;M<h;M++){let $=M*4,V=v[$],W=v[$+1],K=v[$+2],te=v[$+3],ee=w[M];if(ee>=u)continue;let oe=m>1?(K-V)*(d-1)/(m-1):0,ie=g>1?(te-W)*(p-1)/(g-1):0;for(let se=0;se<m;se++){let fe=m>1?V*(d-1)+se*oe:.5*(V+K)*(d-1);if(fe<0||fe>d-1){for(let ue=0;ue<g;ue++)for(let ye=0;ye<f;ye++){let Te=ye+ue*A[2]+se*A[1]+M*A[0];y.values[Te]=c}continue}if(l==="bilinear"){let ue=Math.floor(fe),ye=Math.ceil(fe),Te=fe-ue;for(let De=0;De<g;De++){let Fe=g>1?W*(p-1)+De*ie:.5*(W+te)*(p-1);if(Fe<0||Fe>p-1){for(let qe=0;qe<f;qe++){let lt=qe+De*A[2]+se*A[1]+M*A[0];y.values[lt]=c}continue}let Re=Math.floor(Fe),Ve=Math.ceil(Fe),Le=Fe-Re;for(let qe=0;qe<f;qe++){let lt=qe+Re*I[2]+ue*I[1]+ee*I[0],mt=C[lt];lt=qe+Ve*I[2]+ue*I[1]+ee*I[0];let pt=C[lt];lt=qe+Re*I[2]+ye*I[1]+ee*I[0];let Rt=C[lt];lt=qe+Ve*I[2]+ye*I[1]+ee*I[0];let kt=C[lt],Sn=mt+(pt-mt)*Le,Nt=Rt+(kt-Rt)*Le;lt=qe+De*A[2]+se*A[1]+M*A[0],y.values[lt]=Sn+(Nt-Sn)*Te}}}else for(let ue=0;ue<g;++ue){let ye=g>1?W*(p-1)+ue*ie:.5*(W+te)*(p-1);if(ye<0||ye>p-1){for(let Fe=0;Fe<f;Fe++){let Re=Fe+ue*A[2]+se*A[1]+M*A[0];y.values[Re]=c}continue}let Te=Math.round(ye),De=Math.round(fe);for(let Fe=0;Fe<f;Fe++){let Re=Fe+Te*I[2]+De*I[1]+ee*I[0],Ve=Fe+ue*A[2]+se*A[1]+M*A[0];y.values[Ve]=C[Re]}}}}return e.makeTensorInfo(y.shape,y.dtype,y.values)}var aQ={kernelName:$p,backendName:"cpu",kernelFunc:lFe};function cFe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{axis:i,exclusive:s,reverse:a}=r;we(o,"cumprod");let l=T.getAxesPermutation([i],o.shape.length),c=o;l!=null&&(c=cr({inputs:{x:o},backend:e,attrs:{perm:l}}));let u=T.getInnerMostAxes(1,o.shape.length)[0];if(u!==c.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${c.shape.length-1} but got axis=${u}`);let d=En(c.dtype,"int32"),p=b.makeOnesTypedArray(b.sizeFromShape(c.shape),d),f=e.data.get(c.dataId).values,h=c.shape[c.shape.length-1],m=a?(y,v)=>y+h-v-1:(y,v)=>y+v;for(let y=0;y<f.length;y+=h)for(let v=0;v<h;v++){let w=m(y,v);if(v===0)p[w]=s?1:f[w];else{let C=m(y,v-1);p[w]=s?f[C]*p[C]:f[w]*p[C]}}let g=e.makeTensorInfo(c.shape,d,p);if(l!=null){let y=T.getUndoAxesPermutation(l),v=cr({inputs:{x:g},backend:e,attrs:{perm:y}});return e.disposeIntermediateTensorInfo(g),e.disposeIntermediateTensorInfo(c),v}return g}var lQ={kernelName:Lp,backendName:"cpu",kernelFunc:cFe};function uFe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{axis:i,exclusive:s,reverse:a}=r;we(o,"cumsum");let l=T.getAxesPermutation([i],o.shape.length),c=o;l!=null&&(c=cr({inputs:{x:o},backend:e,attrs:{perm:l}}));let u=T.getInnerMostAxes(1,o.shape.length)[0];if(u!==c.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${c.shape.length-1} but got axis=${u}`);let d=En(c.dtype,"int32"),p=b.makeZerosTypedArray(b.sizeFromShape(c.shape),d),f=e.data.get(c.dataId).values,h=c.shape[c.shape.length-1],m=a?(y,v)=>y+h-v-1:(y,v)=>y+v;for(let y=0;y<f.length;y+=h)for(let v=0;v<h;v++){let w=m(y,v);if(v===0)p[w]=s?0:f[w];else{let C=m(y,v-1);p[w]=s?f[C]+p[C]:f[w]+p[C]}}let g=e.makeTensorInfo(c.shape,d,p);if(l!=null){let y=T.getUndoAxesPermutation(l),v=cr({inputs:{x:g},backend:e,attrs:{perm:y}});return e.disposeIntermediateTensorInfo(g),e.disposeIntermediateTensorInfo(c),v}return g}var cQ={kernelName:Mc,backendName:"cpu",kernelFunc:uFe};function dFe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,weights:i}=t,{size:s,binaryOutput:a}=r;if(o.shape.length===1){let l=e.data.get(o.dataId).values,c=e.data.get(i.dataId).values,u=Hx(l,c,i.dtype,i.shape,s);return e.makeTensorInfo([s],i.dtype,u)}else if(o.shape.length===2){let l=e.bufferSync(o),c=e.bufferSync(i),u=cT(l,c,s,a);return e.makeTensorInfo(u.shape,i.dtype,u.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${o.shape.length}.`)}var uQ={kernelName:Vp,backendName:"cpu",kernelFunc:dFe};function pFe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{blockSize:i,dataFormat:s}=r;b.assert(s==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${s}`);let a=o.shape[0],l=o.shape[1],c=o.shape[2],u=o.shape[3],d=l*i,p=c*i,f=u/(i*i),h=e.data.get(o.dataId).values,m=new Float32Array(a*d*p*f),g=0;for(let y=0;y<a;++y)for(let v=0;v<d;++v){let w=Math.floor(v/i),C=v%i;for(let I=0;I<p;++I){let A=Math.floor(I/i),M=I%i,$=(C*i+M)*f;for(let V=0;V<f;++V){let K=V+$+u*(A+c*(w+l*y));m[g++]=h[K]}}}return e.makeTensorInfo([a,d,p,f],o.dtype,m)}var dQ={kernelName:Bp,backendName:"cpu",kernelFunc:pFe};function M$(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,filter:i}=t,{strides:s,pad:a,dilations:l,dimRoundingMode:c}=r;we([o,i],"depthwiseConv2DNative");let u=b.computeStrides(o.shape),d=b.computeStrides(i.shape),p=l;p==null&&(p=[1,1]),b.assert(T.eitherStridesOrDilationsAreOne(s,p),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${s} and dilations '${p}'`);let f=T.computeConv2DInfo(o.shape,i.shape,s,p,a,c,!0),{filterHeight:h,filterWidth:m,dilationHeight:g,dilationWidth:y,padInfo:v}=f,w=v.left,C=v.top,I=f.outChannels/f.inChannels,A=new an(f.outShape,o.dtype),M=e.data.get(o.dataId).values,$=e.data.get(i.dataId).values,V=A.values;for(let W=0;W<f.batchSize;++W){let K=W*u[0],te=W*A.strides[0];for(let ee=0;ee<f.outHeight;++ee){let oe=te+ee*A.strides[1],ie=ee*f.strideHeight-C;for(let se=0;se<h;++se){let fe=ie+se*g;if(fe<0||fe>=f.inHeight)continue;let ue=se*d[0],ye=K+fe*u[1];for(let Te=0;Te<f.outWidth;++Te){let De=oe+Te*A.strides[2],Fe=Te*f.strideWidth-w;for(let Re=0;Re<m;++Re){let Ve=Fe+Re*y;if(Ve<0||Ve>=f.inWidth)continue;let Le=ue+Re*d[1],qe=ye+Ve*f.inChannels,lt=De,mt=Le;for(let pt=0;pt<f.inChannels;++pt){let Rt=M[qe+pt];for(let kt=0;kt<I;++kt)V[lt+kt]+=Rt*$[mt+kt];lt+=I,mt+=I}}}}}}return e.makeTensorInfo(A.shape,A.dtype,A.values)}var pQ={kernelName:Pc,backendName:"cpu",kernelFunc:M$};function fFe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,dy:i}=t,{strides:s,dilations:a,pad:l,dimRoundingMode:c,filterShape:u}=r;we([o,i],"depthwiseConv2dNativeBackpropFilter");let d=T.computeConv2DInfo(o.shape,u,s,a,l,c,!0),{strideHeight:p,strideWidth:f,filterHeight:h,filterWidth:m}=d,g=new an(d.filterShape,"float32"),y=d.padInfo.left,v=d.padInfo.top,w=d.outChannels/d.inChannels,C=e.data.get(o.dataId).values,I=new an(o.shape,o.dtype,C),A=e.data.get(i.dataId).values,M=new an(i.shape,i.dtype,A);for(let $=0;$<h;++$){let V=Math.max(0,Math.ceil((v-$)/p)),W=Math.min(d.outHeight,(d.inHeight+v-$)/p);for(let K=0;K<m;++K){let te=Math.max(0,Math.ceil((y-K)/f)),ee=Math.min(d.outWidth,(d.inWidth+y-K)/f);for(let oe=0;oe<d.outChannels;++oe){let ie=Math.trunc(oe/w),se=oe%w,fe=0;for(let ue=0;ue<d.batchSize;++ue)for(let ye=V;ye<W;++ye){let Te=$+ye*p-v;for(let De=te;De<ee;++De){let Fe=K+De*f-y;fe+=I.get(ue,Te,Fe,ie)*M.get(ue,ye,De,oe)}}g.set(fe,$,K,ie,se)}}}return e.makeTensorInfo(g.shape,g.dtype,g.values)}var fQ={kernelName:zp,backendName:"cpu",kernelFunc:fFe};function hFe(n){let{inputs:t,backend:e,attrs:r}=n,{dy:o,filter:i}=t,{strides:s,dilations:a,pad:l,dimRoundingMode:c,inputShape:u}=r;we([o,i],"depthwiseConv2DNativeBackpropInput");let d=b.computeStrides(o.shape),p=b.computeStrides(i.shape),f=T.computeConv2DInfo(u,i.shape,s,a,l,c,!0),h=new an(f.inShape,"float32"),m=h.values,[g,y,v]=h.strides,w=e.data.get(o.dataId).values,[C,I,A]=d,M=e.data.get(i.dataId).values,[$,V,W]=p,{batchSize:K,filterHeight:te,filterWidth:ee,inChannels:oe,inHeight:ie,inWidth:se,outChannels:fe,outHeight:ue,outWidth:ye,strideHeight:Te,strideWidth:De}=f,Fe=te-1-f.padInfo.top,Re=ee-1-f.padInfo.left,Ve=fe/oe;for(let Le=0;Le<K;++Le)for(let qe=0;qe<oe;++qe)for(let lt=0;lt<ie;++lt){let mt=lt-Fe,pt=Math.max(0,Math.ceil(mt/Te)),Rt=Math.min(ue,(te+mt)/Te);for(let kt=0;kt<se;++kt){let Sn=kt-Re,Nt=Math.max(0,Math.ceil(Sn/De)),Yt=Math.min(ye,(ee+Sn)/De),Fn=0;for(let Nn=pt;Nn<Rt;++Nn){let Qn=Nn*Te-mt;for(let jn=Nt;jn<Yt;++jn){let Cs=jn*De-Sn,zr=C*Le+I*Nn+A*jn,ca=$*(te-1-Qn)+V*(ee-1-Cs)+W*qe;for(let Do=0;Do<Ve;++Do){let Hl=qe*Ve+Do,io=w[zr+Hl],_s=M[ca+Do];Fn+=io*_s}}}m[g*Le+y*lt+v*kt+qe]=Fn}}return e.makeTensorInfo(h.shape,h.dtype,h.values)}var hQ={kernelName:Up,backendName:"cpu",kernelFunc:hFe};function mFe(n){let{inputs:t,backend:e}=n,{x:r}=t,o=b.sizeFromShape(r.shape),i=e.data.get(r.dataId).values,s=ze([o,o],r.dtype),a=s.values;for(let c=0;c<i.length;c++)a[c*o+c]=i[c];let l=[...r.shape,...r.shape];return e.makeTensorInfo(l,s.dtype,s.values)}var mQ={kernelName:Wp,backendName:"cpu",kernelFunc:mFe};var gQ={kernelName:Fc,backendName:"cpu",kernelFunc:({inputs:n,backend:t,attrs:e})=>{let{x:r,filter:o}=n,{strides:i,pad:s,dilations:a}=e,l=t,c=l.data.get(r.dataId).values,u=r.shape.length,d=l.data.get(o.dataId).values,p=o.shape.length,{batchSize:f,inHeight:h,inWidth:m,inChannels:g,outHeight:y,outWidth:v,padInfo:w,strideHeight:C,strideWidth:I,filterHeight:A,filterWidth:M,dilationHeight:$,dilationWidth:V,outShape:W}=T.computeDilation2DInfo(r.shape,o.shape,i,s,"NHWC",a),K=b.sizeFromShape(W),te=W.length,ee=b.getArrayFromDType(r.dtype,K);for(let ie=0;ie<f;++ie)for(let se=0;se<y;++se){let fe=se*C-w.top;for(let ue=0;ue<v;++ue){let ye=ue*I-w.left;for(let Te=0;Te<g;++Te){let De=Number.MIN_SAFE_INTEGER;for(let Re=0;Re<A;++Re){let Ve=fe+Re*$;if(Ve>=0&&Ve<h)for(let Le=0;Le<M;++Le){let qe=ye+Le*V;if(qe>=0&&qe<m){let lt=b.locToIndex([ie,Ve,qe,Te],u,b.computeStrides(r.shape)),mt=b.locToIndex([Re,Le,Te],p,b.computeStrides(o.shape)),pt=c[lt]+d[mt];pt>De&&(De=pt)}}}let Fe=b.locToIndex([ie,se,ue,Te],te,b.computeStrides(W));ee[Fe]=De}}}return{dataId:l.write(b.toTypedArray(ee,r.dtype),W,r.dtype),shape:W,dtype:r.dtype}}};var yQ={kernelName:Yh,backendName:"cpu",kernelFunc:({inputs:n,backend:t,attrs:e})=>{let{x:r,filter:o,dy:i}=n,{strides:s,pad:a,dilations:l}=e,c=t,u=b.toNestedArray(r.shape,c.data.get(r.dataId).values),d=b.toNestedArray(o.shape,c.data.get(o.dataId).values),{batchSize:p,inHeight:f,inWidth:h,inChannels:m,outHeight:g,outWidth:y,padInfo:v,strideHeight:w,strideWidth:C,filterHeight:I,filterWidth:A,dilationHeight:M,dilationWidth:$,outShape:V}=T.computeDilation2DInfo(r.shape,o.shape,s,a,"NHWC",l);b.assert(i.rank===V.length,()=>`Error in ${Yh}, dy must have the same rank as output ${V.length}, but got ${i.rank}`);let W=b.toNestedArray(V,c.data.get(i.dataId).values),K=b.makeZerosNestedTypedArray(o.shape,o.dtype);for(let ee=0;ee<p;++ee)for(let oe=0;oe<g;++oe){let ie=oe*w-v.top;for(let se=0;se<y;++se){let fe=se*C-v.left;for(let ue=0;ue<m;++ue){let ye=Number.MIN_SAFE_INTEGER,Te=0,De=0;for(let Fe=0;Fe<I;++Fe){let Re=ie+Fe*M;if(Re>=0&&Re<f)for(let Ve=0;Ve<A;++Ve){let Le=fe+Ve*$;if(Le>=0&&Le<h){let qe=u[ee][Re][Le][ue]+d[Fe][Ve][ue];qe>ye&&(ye=qe,Te=Fe,De=Ve)}}}K[Te][De][ue]+=W[ee][oe][se][ue]}}}return{dataId:c.write(b.toTypedArray(K,r.dtype),o.shape,o.dtype),shape:o.shape,dtype:o.dtype}}};var xQ={kernelName:Xh,backendName:"cpu",kernelFunc:({inputs:n,backend:t,attrs:e})=>{let{x:r,filter:o,dy:i}=n,{strides:s,pad:a,dilations:l}=e,c=t,u=b.toNestedArray(r.shape,c.data.get(r.dataId).values),d=b.toNestedArray(o.shape,c.data.get(o.dataId).values),{batchSize:p,inHeight:f,inWidth:h,inChannels:m,outHeight:g,outWidth:y,padInfo:v,strideHeight:w,strideWidth:C,filterHeight:I,filterWidth:A,dilationHeight:M,dilationWidth:$,outShape:V}=T.computeDilation2DInfo(r.shape,o.shape,s,a,"NHWC",l);b.assert(i.rank===V.length,()=>`Error in ${Xh}, dy must have the same rank as output ${V.length}, but got ${i.rank}`);let W=b.toNestedArray(V,c.data.get(i.dataId).values),K=b.makeZerosNestedTypedArray(r.shape,r.dtype);for(let ee=0;ee<p;++ee)for(let oe=0;oe<g;++oe){let ie=oe*w-v.top;for(let se=0;se<y;++se){let fe=se*C-v.left;for(let ue=0;ue<m;++ue){let ye=Number.MIN_SAFE_INTEGER,Te=ie<0?0:ie,De=fe<0?0:fe;for(let Fe=0;Fe<I;++Fe){let Re=ie+Fe*M;if(Re>=0&&Re<f)for(let Ve=0;Ve<A;++Ve){let Le=fe+Ve*$;if(Le>=0&&Le<h){let qe=u[ee][Re][Le][ue]+d[Fe][Ve][ue];qe>ye&&(ye=qe,Te=Re,De=Le)}}}K[ee][Te][De][ue]+=W[ee][oe][se][ue]}}}return{dataId:c.write(b.toTypedArray(K,r.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};function gFe(n){let{inputs:t,backend:e,attrs:r}=n,{image:o}=t,{canvas:i,options:s}=r,{contextOptions:a,imageOptions:l}=s||{},c=l?.alpha||1,u=a?.contextType||"2d";if(u!=="2d")throw new Error(`Context type ${a.contextType} is not supported by the CPU backend.`);let d=i.getContext(u,a?.contextAttributes||{});if(d==null)throw new Error(`Could not get the context with ${u} type.`);let[p,f]=o.shape.slice(0,2),h=o.shape.length===2?1:o.shape[2],m=e.data.get(o.dataId).values,g=o.dtype==="float32"?255:1,y=new Uint8ClampedArray(f*p*4);for(let w=0;w<p*f;++w){let C=[0,0,0,255*c];for(let A=0;A<h;A++){let M=m[w*h+A];if(o.dtype==="float32"){if(M<0||M>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${M}.`)}else if(o.dtype==="int32"&&(M<0||M>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${M}.`);h===1?(C[0]=M*g,C[1]=M*g,C[2]=M*g):C[A]=M*g}let I=w*4;y[I+0]=Math.round(C[0]),y[I+1]=Math.round(C[1]),y[I+2]=Math.round(C[2]),y[I+3]=Math.round(C[3])}i.width=f,i.height=p;let v=new ImageData(y,f,p);return d.putImageData(v,0,0),o}var vQ={kernelName:Zh,backendName:"cpu",kernelFunc:gFe};function qd(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{axis:i,keepDims:s}=r;we(o,"sum");let a;o.dtype==="bool"?a=oa({inputs:{x:o},backend:e,attrs:{dtype:"int32"}}):a=Io({inputs:{x:o},backend:e});let l=a.shape.length,c=b.parseAxisParam(i,a.shape),u=T.getAxesPermutation(c,l),d=c,p=a;u!=null&&(p=cr({inputs:{x:a},backend:e,attrs:{perm:u}}),d=T.getInnerMostAxes(d.length,l)),T.assertAxesAreInnerMostDims("sum",d,p.shape.length);let[f,h]=T.computeOutAndReduceShapes(p.shape,d),m=T.upcastType(p.dtype,"int32"),g=Gx(e,f,m),y=b.sizeFromShape(h),v=e.data.get(g.dataId).values,w=e.data.get(p.dataId).values;for(let C=0;C<v.length;++C){let I=C*y,A=0;for(let M=0;M<y;++M)A+=w[I+M];v[C]=A}if(s){let C=T.expandShapeToKeepDim(g.shape,c),I=g;g=Vt({inputs:{x:g},backend:e,attrs:{shape:C}}),e.disposeIntermediateTensorInfo(I)}return e.disposeIntermediateTensorInfo(a),u!=null&&e.disposeIntermediateTensorInfo(p),g}var bQ={kernelName:au,backendName:"cpu",kernelFunc:qd};function yFe(n){let{inputs:t,backend:e,attrs:r}=n,{equation:o}=r,i=t,{allDims:s,summedDims:a,idDims:l}=T.decodeEinsumEquation(o,i.length);T.checkEinsumDimSizes(s.length,l,i);let{path:c,steps:u}=T.getEinsumComputePath(a,l),d=u.length,p=null,f=s.length,h=[];for(let m=0;m<d;++m){for(let g of u[m]){let{permutationIndices:y,expandDims:v}=T.getEinsumPermutation(f,l[g]),w;T.isIdentityPermutation(y)?w=i[g]:(w=cr({inputs:{x:i[g]},backend:e,attrs:{perm:y}}),h.push(w));let C=w.shape.slice();for(let I=0;I<v.length;++I)C.splice(v[I],0,1);b.arraysEqual(w.shape,C)||(w=Vt({inputs:{x:w},backend:e,attrs:{shape:C}}),h.push(w)),p===null?p=w:(p=Mm({inputs:{a:w,b:p},backend:e}),h.push(p))}m<d-1&&(c[m]>=0&&(p=qd({inputs:{x:p},backend:e,attrs:{axis:c[m]-(s.length-f),keepDims:!1}}),h.push(p)),f--)}for(let m of h)m!==p&&e.disposeIntermediateTensorInfo(m);return p}var wQ={kernelName:Gp,backendName:"cpu",kernelFunc:yFe};function xFe(n){let{inputs:t,backend:e}=n,{dy:r,y:o}=t;we([r,o],"eluGrad");let i=new Float32Array(b.sizeFromShape(o.shape)),s=e.data.get(o.dataId).values,a=e.data.get(r.dataId).values;for(let l=0;l<s.length;++l){let c=s[l];c>=0?i[l]=a[l]:i[l]=a[l]*(c+1)}return e.makeTensorInfo(o.shape,"float32",i)}var CQ={kernelName:jp,backendName:"cpu",kernelFunc:xFe};var vFe=T.ERF_P,bFe=T.ERF_A1,wFe=T.ERF_A2,CFe=T.ERF_A3,_Fe=T.ERF_A4,SFe=T.ERF_A5,IFe=ut(Ha,n=>{let t=Math.sign(n),e=Math.abs(n),r=1/(1+vFe*e);return t*(1-((((SFe*r+_Fe)*r+CFe)*r+wFe)*r+bFe)*r*Math.exp(-e*e))}),_Q={kernelName:Ha,backendName:"cpu",kernelFunc:IFe};function Yx(n){let{inputs:t,backend:e,attrs:r}=n,{input:o}=t,{dim:i}=r,s=o.shape.length,a=o.shape.slice(),l=i;return i<0&&(b.assert(-(s+1)<=i,()=>`Axis must be in the interval [${-(s+1)}, ${s}]`),l=s+i+1),a.splice(l,0,1),Vt({inputs:{x:o},backend:e,attrs:{shape:a}})}var SQ={kernelName:Lc,backendName:"cpu",kernelFunc:Yx};var EFe=$t((n,t)=>n/t),cw=Xt(Ga,EFe),uw={kernelName:Ga,backendName:"cpu",kernelFunc:cw};function NT(n,t,e){let r=n.shape,o=r[0],i=r[1],s=e.data.get(n.dataId),a=s.complexTensorInfos.real,l=s.complexTensorInfos.imag,c=[o,i],u=b.sizeFromShape(c),d=b.getTypedArrayFromDType("float32",u),p=b.getTypedArrayFromDType("float32",u);for(let g=0;g<o;g++){let y=sa({inputs:{x:a},backend:e,attrs:{begin:[g,0],size:[1,i]}}),v=sa({inputs:{x:l},backend:e,attrs:{begin:[g,0],size:[1,i]}}),w=qr({inputs:{real:y,imag:v},backend:e}),{real:C,imag:I}=TFe(w,t,e),A=T.mergeRealAndImagArrays(C,I);for(let M=0;M<i;M++){let $=T.getComplexWithIndex(A,M);d[g*i+M]=$.real,p[g*i+M]=$.imag}e.disposeIntermediateTensorInfo(y),e.disposeIntermediateTensorInfo(v),e.disposeIntermediateTensorInfo(w)}let f=e.makeTensorInfo(c,"float32",d),h=e.makeTensorInfo(c,"float32",p),m=qr({inputs:{real:f,imag:h},backend:e});return e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(h),m}function TFe(n,t,e){let r=b.sizeFromShape(n.shape),o=e.data.get(n.dataId),i=e.data.get(o.complexTensorInfos.real.dataId).values,s=e.data.get(o.complexTensorInfos.imag.dataId).values;if(DFe(r)){let a=P$(i,s,r,t,e),l=[n.shape[0],n.shape[1]];if(t){let c=e.makeTensorInfo(l,"float32",a.real),u=e.makeTensorInfo(l,"float32",a.imag),d=e.makeTensorInfo([],"float32",b.createScalarValue(r,"float32")),p=Io({inputs:{x:d},backend:e}),f=uw.kernelFunc({inputs:{a:c,b:d},backend:e}),h=uw.kernelFunc({inputs:{a:u,b:p},backend:e}),m=e.data.get(f.dataId).values,g=e.data.get(h.dataId).values;return e.disposeIntermediateTensorInfo(c),e.disposeIntermediateTensorInfo(u),e.disposeIntermediateTensorInfo(d),e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(h),{real:m,imag:g}}return a}else{let a=T.mergeRealAndImagArrays(i,s),l=kFe(a,r,t);return T.splitRealAndImagArrays(l)}}function DFe(n){return(n&n-1)===0}function P$(n,t,e,r,o){if(e===1)return{real:n,imag:t};let i=T.mergeRealAndImagArrays(n,t),s=e/2,a=T.complexWithEvenIndex(i),l=a.real,c=a.imag,u=[l.length],d=o.makeTensorInfo(u,"float32",l),p=o.makeTensorInfo(u,"float32",c),f=qr({inputs:{real:d,imag:p},backend:o}),h=T.complexWithOddIndex(i),m=h.real,g=h.imag,y=[m.length],v=o.makeTensorInfo(y,"float32",m),w=o.makeTensorInfo(y,"float32",g),C=qr({inputs:{real:v,imag:w},backend:o}),I=P$(l,c,s,r,o),A=I.real,M=I.imag,$=[A.length],V=o.makeTensorInfo($,"float32",A),W=o.makeTensorInfo($,"float32",M),K=qr({inputs:{real:V,imag:W},backend:o}),te=P$(m,g,s,r,o),ee=te.real,oe=te.imag,ie=[ee.length],se=o.makeTensorInfo(ie,"float32",ee),fe=o.makeTensorInfo(ie,"float32",oe),ue=qr({inputs:{real:se,imag:fe},backend:o}),ye=T.exponents(e,r),Te=[ye.real.length],De=o.makeTensorInfo(Te,"float32",ye.real),Fe=o.makeTensorInfo(Te,"float32",ye.imag),Re=qr({inputs:{real:De,imag:Fe},backend:o}),Ve=Mm({inputs:{a:Re,b:ue},backend:o}),Le=Du({inputs:{a:K,b:Ve},backend:o}),qe=sw({inputs:{a:K,b:Ve},backend:o}),lt=ra({inputs:{input:Le},backend:o}),mt=ra({inputs:{input:qe},backend:o}),pt=ku({inputs:{input:Le},backend:o}),Rt=ku({inputs:{input:qe},backend:o}),kt=Jf({inputs:[lt,mt],backend:o,attrs:{axis:0}}),Sn=Jf({inputs:[pt,Rt],backend:o,attrs:{axis:0}}),Nt=o.data.get(kt.dataId).values,Yt=o.data.get(Sn.dataId).values;return o.disposeIntermediateTensorInfo(d),o.disposeIntermediateTensorInfo(p),o.disposeIntermediateTensorInfo(f),o.disposeIntermediateTensorInfo(v),o.disposeIntermediateTensorInfo(w),o.disposeIntermediateTensorInfo(C),o.disposeIntermediateTensorInfo(V),o.disposeIntermediateTensorInfo(W),o.disposeIntermediateTensorInfo(K),o.disposeIntermediateTensorInfo(se),o.disposeIntermediateTensorInfo(fe),o.disposeIntermediateTensorInfo(ue),o.disposeIntermediateTensorInfo(De),o.disposeIntermediateTensorInfo(Fe),o.disposeIntermediateTensorInfo(Re),o.disposeIntermediateTensorInfo(Ve),o.disposeIntermediateTensorInfo(Le),o.disposeIntermediateTensorInfo(qe),o.disposeIntermediateTensorInfo(lt),o.disposeIntermediateTensorInfo(pt),o.disposeIntermediateTensorInfo(mt),o.disposeIntermediateTensorInfo(Rt),o.disposeIntermediateTensorInfo(kt),o.disposeIntermediateTensorInfo(Sn),{real:Nt,imag:Yt}}function kFe(n,t,e){let r=new Float32Array(t*2);for(let o=0;o<t;o++){let i=0,s=0;for(let a=0;a<t;a++){let l=T.exponent(o*a,t,e),c=T.getComplexWithIndex(n,a);i+=c.real*l.real-c.imag*l.imag,s+=c.real*l.imag+c.imag*l.real}e&&(i/=t,s/=t),T.assignToTypedArray(r,i,s,o)}return r}function NFe(n){let{inputs:t,backend:e}=n,{input:r}=t,o=b.sizeFromShape(r.shape),i=r.shape[r.shape.length-1],s=o/i,a=Vt({inputs:{x:r},backend:e,attrs:{shape:[s,i]}}),l=NT(a,!1,e),c=Vt({inputs:{x:l},backend:e,attrs:{shape:r.shape}});return e.disposeIntermediateTensorInfo(a),e.disposeIntermediateTensorInfo(l),c}var IQ={kernelName:Hp,backendName:"cpu",kernelFunc:NFe};function dw(n){let{backend:t,attrs:e}=n,{shape:r,value:o,dtype:i}=e,s=i||b.inferDtype(o),a=b.getArrayFromDType(s,b.sizeFromShape(r));return AFe(a,o,s),t.makeTensorInfo(r,s,a)}var EQ={kernelName:qp,backendName:"cpu",kernelFunc:dw};function AFe(n,t,e){n.fill(t)}var TQ={kernelName:Kp,backendName:"cpu",kernelFunc:({inputs:n,attrs:t,backend:e})=>{let{image:r}=n,o=e,i=b.getTypedArrayFromDType(r.dtype,b.sizeFromShape(r.shape)),[s,a,l,c]=r.shape,u=o.data.get(r.dataId).values;for(let p=0;p<s;p++){let f=p*l*a*c;for(let h=0;h<a;h++){let m=h*(l*c);for(let g=0;g<l;g++){let y=g*c;for(let v=0;v<c;v++){let w=Math.round(l-g-1),C=f+m+y+v,I=u[C];if(w>=0&&w<l){let A=w*c,M=f+m+A+v;I=u[M]}i[C]=I}}}}return{dataId:o.write(i,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};function RFe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,filter:i,bias:s,preluActivationWeights:a}=t,{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:p,activation:f,leakyreluAlpha:h}=r,m=O$({inputs:{x:o,filter:i},backend:e,attrs:{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:p}});if(s){let g=m;if(u==="NCHW"&&s.shape.length===1&&s.shape[0]!==1){let y=Vt({inputs:{x:s},backend:e,attrs:{shape:[s.shape[0],1,1]}});m=Du({inputs:{a:m,b:y},backend:e}),e.disposeIntermediateTensorInfo(y)}else m=Du({inputs:{a:m,b:s},backend:e});e.disposeIntermediateTensorInfo(g)}if(f){let g=m;if(u==="NCHW"&&f==="prelu"&&a.shape.length===1&&a.shape[0]!==1){let y=Vt({inputs:{x:a},backend:e,attrs:{shape:[a.shape[0],1,1]}});m=Pm(e,m,f,y,h),e.disposeIntermediateTensorInfo(y)}else m=Pm(e,m,f,a,h);e.disposeIntermediateTensorInfo(g)}return m}var DQ={kernelName:Ed,backendName:"cpu",kernelFunc:RFe};function OFe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,filter:i,bias:s,preluActivationWeights:a}=t,{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:p,activation:f,leakyreluAlpha:h}=r,m=M$({inputs:{x:o,filter:i},backend:e,attrs:{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:p}});if(s){let g=m;m=Du({inputs:{a:m,b:s},backend:e}),e.disposeIntermediateTensorInfo(g)}if(f){let g=m;m=Pm(e,m,f,a,h),e.disposeIntermediateTensorInfo(g)}return m}var kQ={kernelName:Td,backendName:"cpu",kernelFunc:OFe};function MFe(n){let{inputs:t,backend:e}=n,{params:r,indices:o}=t,i=b.sizeFromShape(r.shape),s=o.shape,a=s[s.length-1],[l,c,u,d]=T.prepareAndValidate(r,o);if(c===0)return e.makeTensorInfo(l,r.dtype,[]);let p=e.data.get(o.dataId).values,f=e.bufferSync(r),h=dT(p,f,r.dtype,c,a,u,d,r.shape,i);return e.makeTensorInfo(l,r.dtype,h.values)}var NQ={kernelName:Xp,backendName:"cpu",kernelFunc:MFe};function PFe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,indices:i}=t,{axis:s,batchDims:a}=r;we([o,i],"gatherV2");let l=b.parseAxisParam(s,o.shape)[0],c=e.data.get(i.dataId).values,u=o.shape[l];for(let C=0;C<c.length;++C){let I=c[C];b.assert(I<=u-1&&I>=0,()=>`GatherV2: the index value ${I} is not in [0, ${u-1}]`)}let d=a;a==null&&(d=0);let p=b.sizeFromShape(i.shape),f=T.segment_util.collectGatherOpShapeInfo(o,i,l,d),h=Vt({inputs:{x:o},backend:e,attrs:{shape:[f.batchSize,f.outerSize,f.dimSize,f.sliceSize]}}),m=Vt({inputs:{x:i},backend:e,attrs:{shape:[f.batchSize,p/f.batchSize]}}),g=[f.batchSize,f.outerSize,p/f.batchSize,f.sliceSize],y=e.bufferSync(m),v=e.bufferSync(h),w=pT(v,y,g);return e.disposeIntermediateTensorInfo(h),e.disposeIntermediateTensorInfo(m),e.makeTensorInfo(f.outputShape,w.dtype,w.values)}var AQ={kernelName:Vc,backendName:"cpu",kernelFunc:PFe};function FFe(n){let{inputs:t,backend:e}=n,{input:r}=t,o=b.sizeFromShape(r.shape),i=r.shape[r.shape.length-1],s=o/i,a=Vt({inputs:{x:r},backend:e,attrs:{shape:[s,i]}}),l=NT(a,!0,e),c=Vt({inputs:{x:l},backend:e,attrs:{shape:r.shape}});return e.disposeIntermediateTensorInfo(a),e.disposeIntermediateTensorInfo(l),c}var RQ={kernelName:Yp,backendName:"cpu",kernelFunc:FFe};var LFe=ut(Qa,n=>Number.isFinite(n)?1:0,"bool"),OQ={kernelName:Qa,backendName:"cpu",kernelFunc:LFe};var $Fe=ut(Ja,n=>Math.abs(n)===1/0?1:0,"bool"),MQ={kernelName:Ja,backendName:"cpu",kernelFunc:$Fe};var VFe=ut(el,n=>Number.isNaN(n)?1:0,"bool"),PQ={kernelName:el,backendName:"cpu",kernelFunc:VFe};function BFe(n){let{backend:t,attrs:e}=n,{start:r,stop:o,num:i}=e,s=fT(r,o,i);return t.makeTensorInfo([s.length],"float32",s)}var FQ={kernelName:Qp,backendName:"cpu",kernelFunc:BFe};var zFe=ut(nl,n=>Math.log1p(n)),LQ={kernelName:nl,backendName:"cpu",kernelFunc:zFe};var UFe=$t((n,t)=>n&&t),WFe=Xt(wd,UFe,null,"bool"),$Q={kernelName:wd,backendName:"cpu",kernelFunc:WFe};var GFe=ut(Cd,n=>n?0:1,"bool"),VQ={kernelName:Cd,backendName:"cpu",kernelFunc:GFe};var jFe=$t((n,t)=>n||t),HFe=Xt(_d,jFe,null,"bool"),BQ={kernelName:_d,backendName:"cpu",kernelFunc:HFe};function qFe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{depthRadius:i,bias:s,alpha:a,beta:l}=r;we(o,"LRN");let c=o.shape[3],u=c-1,d=e.data.get(o.dataId).values,p=b.sizeFromShape(o.shape),f=new Float32Array(p);function h(m){let g=m%c,y=m-g+Math.max(0,g-i),v=m-g+Math.min(g+i,u),w=0;for(;y<=v;y++){let C=d[y];w+=C*C}return w}for(let m=0;m<p;m++){let g=h(m),y=d[m]*Math.pow(s+a*g,-l);f[m]=y}return e.makeTensorInfo(o.shape,o.dtype,f)}var zQ={kernelName:zc,backendName:"cpu",kernelFunc:qFe};function KFe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,y:i,dy:s}=t,{depthRadius:a,bias:l,alpha:c,beta:u}=r;we(s,"LRNGrad");let d=b.sizeFromShape(s.shape),p=s.shape[3],f=e.data.get(s.dataId).values,h=e.data.get(o.dataId).values,m=e.data.get(i.dataId).values,g=new Float32Array(d),y=d;for(let v=0;v<y;v++){let w=v%p,C=v-w+Math.max(0,w-a),I=v-w+Math.min(p,w+a+1),A=0;for(let M=C;M<I;M++)A+=Math.pow(h[M],2);A=c*A+l;for(let M=C;M<I;M++){let $=-2*c*u*h[M]*m[v]/A;v===M&&($+=Math.pow(A,-u)),$*=f[v],g[M]+=$}}return e.makeTensorInfo(s.shape,o.dtype,g)}var UQ={kernelName:Jp,backendName:"cpu",kernelFunc:KFe};function F$(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{reductionIndices:i,keepDims:s}=r,a=e,l=o.shape,c=l.length,u=b.parseAxisParam(i,l),d=u,p=T.getAxesPermutation(d,c),f=a.data.get(o.dataId).values;if(p!=null){let C=new Array(c);for(let I=0;I<C.length;I++)C[I]=l[p[I]];f=qx(f,l,o.dtype,p,C),d=T.getInnerMostAxes(d.length,c),l=C}we(o,"max"),T.assertAxesAreInnerMostDims("max",d,c);let[h,m]=T.computeOutAndReduceShapes(l,d),g=b.sizeFromShape(m),y=hT(f,g,h,o.dtype),v=a.write(y,h,o.dtype),w=h;return s&&(w=T.expandShapeToKeepDim(h,u)),{dataId:v,shape:w,dtype:o.dtype}}var WQ={kernelName:Uc,backendName:"cpu",kernelFunc:F$};function XFe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t;we(o,"maxPool");let{filterSize:i,strides:s,pad:a,dimRoundingMode:l}=r,c=1;b.assert(T.eitherStridesOrDilationsAreOne(s,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${s} and dilations '${c}'`);let u=T.computePool2DInfo(o.shape,i,s,c,a,l),d;if(u.filterWidth===1&&u.filterHeight===1&&b.arraysEqual(u.inShape,u.outShape))d=Io({inputs:{x:o},backend:e});else{let p=e.data.get(o.dataId).values,f=b.computeStrides(o.shape),h=Xx(p,o.shape,o.dtype,f,u,"max");d=e.makeTensorInfo(u.outShape,o.dtype,h.values)}return d}var GQ={kernelName:Wc,backendName:"cpu",kernelFunc:XFe};function YFe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{filterSize:i,strides:s,pad:a,dimRoundingMode:l,dataFormat:c}=r;we(o,"maxPool3d");let u=T.computePool3DInfo(o.shape,i,s,1,a,l,c),d=e.data.get(o.dataId).values,p=kT(d,o.shape,o.dtype,b.computeStrides(o.shape),u,"max");return e.makeTensorInfo(p.shape,"float32",p.values)}var jQ={kernelName:Gc,backendName:"cpu",kernelFunc:YFe};function ZFe(n){let{inputs:t,backend:e,attrs:r}=n,{dy:o,input:i}=t,{filterSize:s,strides:a,pad:l,dimRoundingMode:c}=r;we([o,i],"maxPool3DGrad");let u=T.computePool3DInfo(i.shape,s,a,1,l,c),d=e.bufferSync(i),p=BZ(d,u),f=u.strideDepth,h=u.strideHeight,m=u.strideWidth,g=u.dilationDepth,y=u.dilationHeight,v=u.dilationWidth,w=u.effectiveFilterDepth,C=u.effectiveFilterHeight,I=u.effectiveFilterWidth,A=w-1-u.padInfo.front,M=I-1-u.padInfo.left,$=C-1-u.padInfo.top,V=ze(i.shape,"float32"),W=e.bufferSync(o);for(let K=0;K<u.batchSize;++K)for(let te=0;te<u.inChannels;++te)for(let ee=0;ee<u.inDepth;++ee)for(let oe=0;oe<u.inHeight;++oe)for(let ie=0;ie<u.inWidth;++ie){let se=ee-A,fe=oe-$,ue=ie-M,ye=0;for(let Te=0;Te<w;Te+=g){let De=(se+Te)/f;if(!(De<0||De>=u.outDepth||Math.floor(De)!==De))for(let Fe=0;Fe<C;Fe+=y){let Re=(fe+Fe)/h;if(!(Re<0||Re>=u.outHeight||Math.floor(Re)!==Re))for(let Ve=0;Ve<I;Ve+=v){let Le=(ue+Ve)/m;if(Le<0||Le>=u.outWidth||Math.floor(Le)!==Le)continue;let qe=w*C*I-1-p.get(K,De,Re,Le,te),lt=Te*C*I+Fe*I+Ve,mt=qe===lt?1:0;if(mt===0)continue;let pt=W.get(K,De,Re,Le,te);ye+=pt*mt}}}V.set(ye,K,ee,oe,ie,te)}return e.makeTensorInfo(V.shape,V.dtype,V.values)}var HQ={kernelName:tf,backendName:"cpu",kernelFunc:ZFe};function QFe(n){let{inputs:t,backend:e,attrs:r}=n,{dy:o,input:i,output:s}=t,a=i;we([i,s],"maxPoolGrad");let{filterSize:l,strides:c,pad:u,dimRoundingMode:d}=r,p=T.computePool2DInfo(a.shape,l,c,1,u,d),f=e.data.get(a.dataId).values,h=ze(p.outShape,a.dtype,DT(f,a.shape,a.dtype,p).values),m=p.strideHeight,g=p.strideWidth,y=p.dilationHeight,v=p.dilationWidth,w=p.effectiveFilterHeight,C=p.effectiveFilterWidth,I=C-1-p.padInfo.left,A=w-1-p.padInfo.top,M=ze(a.shape,"float32"),$=e.data.get(o.dataId).values,V=ze(o.shape,"float32",$);for(let W=0;W<p.batchSize;++W)for(let K=0;K<p.inChannels;++K)for(let te=0;te<p.inHeight;++te)for(let ee=0;ee<p.inWidth;++ee){let oe=te-A,ie=ee-I,se=0;for(let fe=0;fe<w;fe+=y){let ue=(oe+fe)/m;if(!(ue<0||ue>=p.outHeight||Math.floor(ue)!==ue))for(let ye=0;ye<C;ye+=v){let Te=(ie+ye)/g;if(Te<0||Te>=p.outWidth||Math.floor(Te)!==Te)continue;let De=w*C-1-h.get(W,ue,Te,K),Fe=fe*C+ye,Re=De===Fe?1:0;if(Re===0)continue;let Ve=V.get(W,ue,Te,K);se+=Ve*Re}}M.set(se,W,te,ee,K)}return e.makeTensorInfo(M.shape,M.dtype,M.values)}var qQ={kernelName:ef,backendName:"cpu",kernelFunc:QFe};function KQ(n,t,e,r,o){let i=b.computeStrides(t),s=Xx(n,t,e,i,o,"max"),a=DT(n,t,e,o,!0,r);return[s.values,a.values]}var XQ={kernelName:nf,backendName:"cpu",kernelFunc:({inputs:n,attrs:t,backend:e})=>{let{x:r}=n,{filterSize:o,strides:i,pad:s,includeBatchInIndex:a}=t,l=e;we(r,"MaxPoolWithArgmax");let c=l.data.get(r.dataId).values,u=T.computePool2DInfo(r.shape,o,i,[1,1],s),[d,p]=KQ(c,r.shape,r.dtype,a,u),f=l.write(d,u.outShape,r.dtype),h=l.write(p,u.outShape,r.dtype);return[{dataId:f,shape:u.outShape,dtype:r.dtype},{dataId:h,shape:u.outShape,dtype:"int32"}]}};function JFe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{axis:i,keepDims:s}=r,a=b.parseAxisParam(i,o.shape),c=T.computeOutAndReduceShapes(o.shape,a)[1],u=b.sizeFromShape(c),d=[],p=e.makeTensorInfo([],"float32",new Float32Array([u]));d.push(p);let f=oa({inputs:{x:o},backend:e,attrs:{dtype:"float32"}});d.push(f);let h=cw({inputs:{a:f,b:p},backend:e});d.push(h);let m=qd({inputs:{x:h},backend:e,attrs:{axis:i,keepDims:s}});return d.forEach(g=>e.disposeIntermediateTensorInfo(g)),m}var YQ={kernelName:jc,backendName:"cpu",kernelFunc:JFe};function eLe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{axis:i,keepDims:s}=r;we(o,"min");let a=b.parseAxisParam(i,o.shape),l=a,c=T.getAxesPermutation(l,o.shape.length),u=o;c!=null&&(u=cr({inputs:{x:o},backend:e,attrs:{perm:c}}),l=T.getInnerMostAxes(l.length,o.shape.length)),T.assertAxesAreInnerMostDims("min",l,u.shape.length);let[d,p]=T.computeOutAndReduceShapes(u.shape,l),f=b.sizeFromShape(p),h=b.makeZerosTypedArray(b.sizeFromShape(d),u.dtype),m=e.data.get(u.dataId).values;for(let y=0;y<h.length;++y){let v=y*f,w=m[v];for(let C=0;C<f;++C){let I=m[v+C];(Number.isNaN(I)||I<w)&&(w=I)}h[y]=w}c!=null&&e.disposeIntermediateTensorInfo(u);let g=e.makeTensorInfo(d,u.dtype,h);if(s){let y=T.expandShapeToKeepDim(d,a),v=Vt({inputs:{x:g},backend:e,attrs:{shape:y}});return e.disposeIntermediateTensorInfo(g),v}return g}var ZQ={kernelName:Hc,backendName:"cpu",kernelFunc:eLe};function tLe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{paddings:i,mode:s}=r;we(o,"mirrorPad");let a=i.map((w,C)=>w[0]+o.shape[C]+w[1]),l=i.map(w=>w[0]),c=i.map((w,C)=>w[0]+o.shape[C]),u=s==="reflect"?0:1,d=e.data.get(o.dataId).values,p=o.shape.length,f=b.computeStrides(o.shape),h=b.sizeFromShape(a),m=a.length,g=b.computeStrides(a),y=b.getTypedArrayFromDType(o.dtype,h);for(let w=0;w<h;w++){let C=b.indexToLoc(w,m,g);for(let A=0;A<m;A++)C[A]<l[A]?C[A]=l[A]*2-C[A]-u:C[A]>=c[A]&&(C[A]=(c[A]-1)*2-C[A]+u);C=C.map((A,M)=>A-l[M]);let I=b.locToIndex(C,p,f);y[w]=d[I]}return{dataId:e.write(y,a,o.dtype),shape:a,dtype:o.dtype}}var QQ={kernelName:qc,backendName:"cpu",kernelFunc:tLe};var nLe=$t((n,t)=>{let e=n%t;return n<0&&t<0||n>=0&&t>=0?e:(e+t)%t}),rLe=Xt(il,nLe),JQ={kernelName:il,backendName:"cpu",kernelFunc:rLe};var tJ=rg(Ab());function L$(n){let{inputs:t,backend:e,attrs:r}=n,{logits:o}=t,{dim:i}=r,s=o.shape.length,a=i;if(a===-1&&(a=s-1),a!==s-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${s} and dim was ${a}`);let l=b.parseAxisParam([a],o.shape),c=F$({inputs:{x:o},backend:e,attrs:{reductionIndices:l,keepDims:!1}}),u=T.expandShapeToKeepDim(c.shape,l),d=Vt({inputs:{x:c},backend:e,attrs:{shape:u}}),p=sw({inputs:{a:o,b:d},backend:e}),f=i$({inputs:{x:p},backend:e}),h=qd({inputs:{x:f},backend:e,attrs:{axis:l,keepDims:!1}}),m=Vt({inputs:{x:h},backend:e,attrs:{shape:u}}),g=cw({inputs:{a:f,b:m},backend:e});return e.disposeIntermediateTensorInfo(c),e.disposeIntermediateTensorInfo(d),e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(h),e.disposeIntermediateTensorInfo(m),g}var eJ={kernelName:uu,backendName:"cpu",kernelFunc:L$};function oLe(n){let{inputs:t,backend:e,attrs:r}=n,{logits:o}=t,{numSamples:i,seed:s,normalized:a}=r;we(o,"multinomial");let l=a?o:L$({inputs:{logits:o},backend:e,attrs:{dim:-1}}),c=l.shape[0],u=l.shape[1],d=e.data.get(l.dataId).values,p=[c,i],f=b.makeZerosTypedArray(b.sizeFromShape(p),"int32");for(let h=0;h<c;++h){let m=h*u,g=new Float32Array(u-1);g[0]=d[m];for(let w=1;w<g.length;++w)g[w]=g[w-1]+d[m+w];let y=tJ.alea(s.toString()),v=h*i;for(let w=0;w<i;++w){let C=y();f[v+w]=g.length;for(let I=0;I<g.length;I++)if(C<g[I]){f[v+w]=I;break}}}return a||e.disposeIntermediateTensorInfo(l),e.makeTensorInfo(p,"int32",f)}var nJ={kernelName:rf,backendName:"cpu",kernelFunc:oLe};var iLe=Vr.nonMaxSuppressionV3Impl;function sLe(n){let{inputs:t,backend:e,attrs:r}=n,{boxes:o,scores:i}=t,{maxOutputSize:s,iouThreshold:a,scoreThreshold:l}=r;we(o,"NonMaxSuppression");let c=e.data.get(o.dataId).values,u=e.data.get(i.dataId).values,{selectedIndices:d}=iLe(c,u,s,a,l);return e.makeTensorInfo([d.length],"int32",new Int32Array(d))}var rJ={kernelName:of,backendName:"cpu",kernelFunc:sLe};var aLe=Vr.nonMaxSuppressionV4Impl;function lLe(n){let{inputs:t,backend:e,attrs:r}=n,{boxes:o,scores:i}=t,{maxOutputSize:s,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:c}=r;we(o,"NonMaxSuppressionPadded");let u=e.data.get(o.dataId).values,d=e.data.get(i.dataId).values,{selectedIndices:p,validOutputs:f}=aLe(u,d,s,a,l,c);return[e.makeTensorInfo([p.length],"int32",new Int32Array(p)),e.makeTensorInfo([],"int32",new Int32Array([f]))]}var oJ={kernelName:ky,backendName:"cpu",kernelFunc:lLe};var cLe=Vr.nonMaxSuppressionV5Impl;function uLe(n){let{inputs:t,backend:e,attrs:r}=n,{boxes:o,scores:i}=t,{maxOutputSize:s,iouThreshold:a,scoreThreshold:l,softNmsSigma:c}=r;we(o,"NonMaxSuppressionWithScore");let u=e.data.get(o.dataId).values,d=e.data.get(i.dataId).values,p=s,f=a,h=l,m=c,{selectedIndices:g,selectedScores:y}=cLe(u,d,p,f,h,m);return[e.makeTensorInfo([g.length],"int32",new Int32Array(g)),e.makeTensorInfo([y.length],"float32",new Float32Array(y))]}var iJ={kernelName:sf,backendName:"cpu",kernelFunc:uLe};function dLe(n){let{inputs:t,backend:e,attrs:r}=n,{indices:o}=t,{dtype:i,depth:s,onValue:a,offValue:l}=r;we(o,"oneHot");let c=b.sizeFromShape(o.shape),u=new Float32Array(c*s);u.fill(l);let d=e.data.get(o.dataId).values;for(let p=0;p<c;++p)d[p]>=0&&d[p]<s&&(u[p*s+d[p]]=a);return e.makeTensorInfo([...o.shape,s],i,u)}var sJ={kernelName:Yc,backendName:"cpu",kernelFunc:dLe};function pw(n){let{inputs:t,backend:e}=n,{x:r}=t;if(r.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(r.dtype==="complex64"){let o=ra({inputs:{input:r},backend:e}),i=pw({inputs:{x:o},backend:e}),s=ku({inputs:{input:r},backend:e}),a=pw({inputs:{x:s},backend:e}),l=qr({inputs:{real:i,imag:a},backend:e});return e.disposeIntermediateTensorInfo(o),e.disposeIntermediateTensorInfo(i),e.disposeIntermediateTensorInfo(s),e.disposeIntermediateTensorInfo(a),l}else return dw({backend:e,attrs:{shape:r.shape,value:0,dtype:r.dtype}})}var aJ={kernelName:fu,backendName:"cpu",kernelFunc:pw};function lJ(n){let{inputs:t,backend:e}=n,{x:r}=t;if(r.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(r.dtype==="complex64"){let o=ra({inputs:{input:r},backend:e}),i=lJ({inputs:{x:o},backend:e}),s=ku({inputs:{input:r},backend:e}),a=pw({inputs:{x:s},backend:e}),l=qr({inputs:{real:i,imag:a},backend:e});return e.disposeIntermediateTensorInfo(o),e.disposeIntermediateTensorInfo(i),e.disposeIntermediateTensorInfo(s),e.disposeIntermediateTensorInfo(a),l}else return dw({backend:e,attrs:{shape:r.shape,value:1,dtype:r.dtype}})}var cJ={kernelName:Xc,backendName:"cpu",kernelFunc:lJ};function $$(n){let{inputs:t,backend:e,attrs:r}=n,{axis:o}=r;if(t.length===1)return Yx({inputs:{input:t[0]},backend:e,attrs:{dim:o}});let i=t[0].shape,s=t[0].dtype;t.forEach(u=>{b.assertShapesMatch(i,u.shape,"All tensors passed to stack must have matching shapes"),b.assert(s===u.dtype,()=>"All tensors passed to stack must have matching dtypes")});let a=[],l=t.map(u=>{let d=Yx({inputs:{input:u},backend:e,attrs:{dim:o}});return a.push(d),d}),c=Jf({inputs:l,backend:e,attrs:{axis:o}});return a.forEach(u=>e.disposeIntermediateTensorInfo(u)),c}var uJ={kernelName:Zc,backendName:"cpu",kernelFunc:$$};function pLe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{paddings:i,constantValue:s}=r;we(o,"pad");let a=i.map((v,w)=>v[0]+o.shape[w]+v[1]),l=i.map(v=>v[0]),c=e.data.get(o.dataId).values,u=b.sizeFromShape(o.shape),d=o.shape.length,p=b.computeStrides(o.shape),f=b.sizeFromShape(a),h=a.length,m=b.computeStrides(a),g=b.getTypedArrayFromDType(o.dtype,f);s!==0&&g.fill(s);for(let v=0;v<u;v++){let C=b.indexToLoc(v,d,p).map((A,M)=>A+l[M]),I=b.locToIndex(C,h,m);g[I]=c[v]}return{dataId:e.write(g,a,o.dtype),shape:a,dtype:o.dtype}}var AT={kernelName:Qc,backendName:"cpu",kernelFunc:pLe};var fLe=$t((n,t)=>Math.pow(n,t)),hLe=Xt(al,fLe),dJ={kernelName:al,backendName:"cpu",kernelFunc:hLe};function mLe(n){let{inputs:t,backend:e,attrs:r}=n,{paramsNestedSplits:o,paramsDenseValues:i,indices:s}=t,{outputRaggedRank:a}=r,l=o.map(y=>e.data.get(y.dataId).values),c=o.map(y=>y.shape),u=e.data.get(i.dataId).values,d=e.data.get(s.dataId).values,[p,f,h]=mT(l,c,u,i.shape,i.dtype,d,s.shape,a),m=p.map(y=>e.makeTensorInfo([y.length],"int32",y)),g=e.makeTensorInfo(h,i.dtype,f);return m.concat([g])}var pJ={kernelName:Ny,backendName:"cpu",kernelFunc:mLe};function gLe(n){let{inputs:t,backend:e}=n,{starts:r,limits:o,deltas:i}=t,s=e.data.get(r.dataId).values,a=e.data.get(o.dataId).values,l=e.data.get(i.dataId).values,[c,u]=gT(s,r.shape,r.dtype,a,o.shape,l,i.shape),d=e.makeTensorInfo([c.length],"int32",c),p=e.makeTensorInfo([u.length],r.dtype,u);return[d,p]}var fJ={kernelName:Ay,backendName:"cpu",kernelFunc:gLe};function yLe(n){let{inputs:t,backend:e,attrs:r}=n,{shape:o,values:i,defaultValue:s,rowPartitionTensors:a}=t,{rowPartitionTypes:l}=r,c=e.data.get(o.dataId).values,u=e.data.get(i.dataId).values,d=e.data.get(s.dataId).values,p=a.map(g=>e.data.get(g.dataId).values),f=a.map(g=>g.shape),[h,m]=yT(c,o.shape,u,i.shape,i.dtype,d,s.shape,p,f,l);return e.makeTensorInfo(h,i.dtype,m)}var hJ={kernelName:Ry,backendName:"cpu",kernelFunc:yLe};function xLe(n){let{backend:t,attrs:e}=n,{start:r,stop:o,dtype:i,step:s}=e,a=xT(r,o,s,i);return t.makeTensorInfo([a.length],i,a)}var mJ={kernelName:af,backendName:"cpu",kernelFunc:xLe};var vLe=ut(ll,n=>1/n),gJ={kernelName:ll,backendName:"cpu",kernelFunc:vLe};function bLe(n){let{inputs:t,backend:e,attrs:r}=n,{images:o}=t,{alignCorners:i,halfPixelCenters:s,size:a}=r;we(o,"resizeBilinear");let l=b.computeStrides(o.shape),[c,u]=a,[d,p,f,h]=o.shape,m=e.data.get(o.dataId).values,g=new Float32Array(b.sizeFromShape([d,c,u,h])),y=[i&&c>1?p-1:p,i&&u>1?f-1:f],v=[i&&c>1?c-1:c,i&&u>1?u-1:u],w=0,C=y[0]/v[0],I=y[1]/v[1];for(let A=0;A<d;A++)for(let M=0;M<c;M++){let $;s?$=C*(M+.5)-.5:$=C*M;let V=Math.max(0,Math.floor($)),W=$-V,K=Math.min(p-1,Math.ceil($)),te=A*l[0]+V*l[1],ee=A*l[0]+K*l[1];for(let oe=0;oe<u;oe++){let ie;s?ie=I*(oe+.5)-.5:ie=I*oe;let se=Math.max(0,Math.floor(ie)),fe=ie-se,ue=Math.min(f-1,Math.ceil(ie)),ye=te+se*l[2],Te=ee+se*l[2],De=te+ue*l[2],Fe=ee+ue*l[2];for(let Re=0;Re<h;Re++){let Ve=m[ye+Re],Le=m[Te+Re],qe=m[De+Re],lt=m[Fe+Re],mt=Ve+(qe-Ve)*fe,pt=Le+(lt-Le)*fe,Rt=mt+(pt-mt)*W;g[w++]=Rt}}}return e.makeTensorInfo([d,c,u,h],"float32",g)}var yJ={kernelName:ru,backendName:"cpu",kernelFunc:bLe};function wLe(n){let{inputs:t,backend:e,attrs:r}=n,{images:o,dy:i}=t,{alignCorners:s}=r;we([i,o],"resizeBilinearGrad");let a=b.computeStrides(o.shape),[l,c,u,d]=o.shape,[,p,f]=i.shape,h=new Float32Array(l*c*u*d),m=[s&&p>1?c-1:c,s&&f>1?u-1:u],g=[s&&p>1?p-1:p,s&&f>1?f-1:f],y=m[0]/g[0],v=m[1]/g[1],w=e.data.get(i.dataId).values,C=0;for(let I=0;I<l;I++){let A=I*a[0];for(let M=0;M<p;M++){let $=M*y,V=Math.floor($),W=Math.min(Math.ceil($),c-1),K=A+V*a[1],te=A+W*a[1],ee=$-V,oe=1-ee;for(let ie=0;ie<f;ie++){let se=ie*v,fe=Math.floor(se),ue=Math.min(Math.ceil(se),u-1),ye=se-fe,Te=1-ye,De=K+fe*a[2],Fe=K+ue*a[2],Re=te+fe*a[2],Ve=te+ue*a[2],Le=oe*Te,qe=oe*ye,lt=ee*Te,mt=ee*ye;for(let pt=0;pt<d;pt++){let Rt=w[C++];h[De+pt]+=Rt*Le,h[Fe+pt]+=Rt*qe,h[Re+pt]+=Rt*lt,h[Ve+pt]+=Rt*mt}}}}return e.makeTensorInfo([l,u,c,d],"float32",h)}var xJ={kernelName:uf,backendName:"cpu",kernelFunc:wLe};function CLe(n){let{inputs:t,backend:e,attrs:r}=n,{images:o}=t,{alignCorners:i,halfPixelCenters:s,size:a}=r;we(o,"resizeNearestNeighbor");let l=b.computeStrides(o.shape),[c,u]=a,[d,p,f,h]=o.shape,m=e.data.get(o.dataId).values,g=new Float32Array(d*c*u*h),y=[i&&c>1?p-1:p,i&&u>1?f-1:f],v=[i&&c>1?c-1:c,i&&u>1?u-1:u],w=y[0]/v[0],C=y[1]/v[1],I=0;for(let A=0;A<d;A++){let M=A*l[0];for(let $=0;$<c;$++){let V=s?w*($+.5):w*$,W=Math.min(p-1,i?Math.round(V):Math.floor(V));s&&(W=Math.max(0,W));let K=M+W*l[1];for(let te=0;te<u;te++){let ee=s?C*(te+.5):C*te,oe=Math.min(f-1,i?Math.round(ee):Math.floor(ee));s&&(oe=Math.max(0,oe));let ie=K+oe*l[2];for(let se=0;se<h;se++){let fe=m[ie+se];g[I++]=fe}}}}return e.makeTensorInfo([d,c,u,h],o.dtype,g)}var vJ={kernelName:nu,backendName:"cpu",kernelFunc:CLe};function _Le(n){let{inputs:t,backend:e,attrs:r}=n,{images:o,dy:i}=t,{alignCorners:s}=r;we([i,o],"resizeNearestNeighborGrad");let a=b.computeStrides(o.shape),l=b.computeStrides(i.shape),[c,u,d,p]=o.shape,[,f,h]=i.shape,m=new Float32Array(c*u*d*p),g=e.data.get(i.dataId).values,y=[s&&f>1?u-1:u,s&&h>1?d-1:d],v=[s&&f>1?f-1:f,s&&h>1?h-1:h],w=y[0]/v[0],C=y[1]/v[1],I=1/w,A=1/C,M=Math.ceil(I)*2+2,$=Math.ceil(A)*2+2;for(let V=0;V<c;V++){let W=V*a[0];for(let K=0;K<u;K++){let te=W+K*a[1],ee=Math.floor(K*I),oe=Math.floor(ee-M/2);for(let ie=0;ie<d;ie++){let se=te+ie*a[2],fe=Math.floor(ie*A),ue=Math.floor(fe-$/2);for(let ye=0;ye<p;ye++){let Te=0;for(let De=0;De<M;De++){let Fe=De+oe;if(Fe<0||Fe>=f)continue;let Re=W+Fe*l[1],Ve=Fe*w,Le=Math.min(u-1,s?Math.round(Ve):Math.floor(Ve));if(K===Le)for(let qe=0;qe<$;qe++){let lt=qe+ue;if(lt<0||lt>=h)continue;let mt=Re+lt*l[2],pt=lt*C,Rt=Math.min(d-1,s?Math.round(pt):Math.floor(pt));ie===Rt&&(Te+=g[mt+ye])}}m[se+ye]=Te}}}}return e.makeTensorInfo(o.shape,o.dtype,m)}var bJ={kernelName:cf,backendName:"cpu",kernelFunc:_Le};function SLe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{dims:i}=r;we(o,"reverse");let s=o.shape.length,a=b.parseAxisParam(i,o.shape);if(s===0)return Io({inputs:{x:o},backend:e});let l=new an(o.shape,o.dtype),c=e.bufferSync(o);for(let u=0;u<l.size;u++){let d=l.indexToLoc(u),p=d.slice();a.forEach(f=>p[f]=o.shape[f]-1-p[f]),l.set(c.get(...p),...d)}return e.makeTensorInfo(l.shape,l.dtype,l.values)}var wJ={kernelName:ou,backendName:"cpu",kernelFunc:SLe};var CJ={kernelName:Cf,backendName:"cpu",kernelFunc:({inputs:n,attrs:t,backend:e})=>{let{image:r}=n,{radians:o,fillValue:i,center:s}=t,a=e,l=b.getTypedArrayFromDType(r.dtype,b.sizeFromShape(r.shape)),[c,u,d,p]=r.shape,[f,h]=T.getImageCenter(s,u,d),m=255,g=Math.sin(o),y=Math.cos(o),v=a.data.get(r.dataId).values;for(let C=0;C<c;C++){let I=C*d*u*p;for(let A=0;A<u;A++){let M=A*(d*p);for(let $=0;$<d;$++){let V=$*p;for(let W=0;W<p;W++){let K=[c,A,$,W],te=K[2],ee=K[1],oe=(te-f)*y-(ee-h)*g,ie=(te-f)*g+(ee-h)*y;oe=Math.round(oe+f),ie=Math.round(ie+h);let se=i;if(typeof i!="number"&&(W===3?se=m:se=i[W]),oe>=0&&oe<d&&ie>=0&&ie<u){let ue=ie*(d*p),ye=oe*p,Te=I+ue+ye+W;se=v[Te]}let fe=I+M+V+W;l[fe]=se}}}}return{dataId:a.write(l,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};var ILe=ut(dl,n=>{let t=Math.floor(n);return n-t<.5?Math.floor(n):n-t>.5?Math.ceil(n):t%2===0?t:t+1}),_J={kernelName:dl,backendName:"cpu",kernelFunc:ILe};function ELe(n){let{inputs:t,backend:e,attrs:r}=n,{indices:o,updates:i}=t,{shape:s}=r,{sliceRank:a,numUpdates:l,sliceSize:c,strides:u,outputSize:d}=T.calculateShapes(i,o,s),p=!0,f=e.bufferSync(o),h=e.bufferSync(i),m=Bl(f,h,s,d,c,l,a,u,0,p);return e.makeTensorInfo(s,m.dtype,m.values)}var SJ={kernelName:df,backendName:"cpu",kernelFunc:ELe};function TLe(n,t){let e=0,r=n.length,o=0;for(;e<r;)o=Math.floor((e+r)/2),n[o]<t?e=o+1:r=o;return r}function DLe(n,t){let e=0,r=n.length,o=0;for(;e<r;)o=Math.floor((e+r)/2),n[o]<=t?e=o+1:r=o;return r}function IJ(n,t,e,r,o,i){let s=b.getArrayFromDType("int32",e*o);for(let a=0;a<e;++a){let l=n.slice(a*r,(a+1)*r),c=a*o;for(let u=0;u<o;++u)s[c+u]=i==="left"?TLe(l,t[u+c]):DLe(l,t[u+c])}return s}function kLe(n){let{inputs:t,backend:e,attrs:r}=n,{sortedSequence:o,values:i}=t,{side:s}=r,a=e.data.get(o.dataId).values,l=e.data.get(i.dataId).values,c=IJ(a,l,o.shape[0],o.shape[1],i.shape[1],s);return e.makeTensorInfo(i.shape,"int32",c)}var EJ={kernelName:ff,backendName:"cpu",kernelFunc:kLe};function NLe(n){let{inputs:t,backend:e}=n,{condition:r,t:o,e:i}=t;we([r,o,i],"select");let s=r.shape.length,a=e.data.get(r.dataId).values,l=e.data.get(o.dataId).values,c=e.data.get(i.dataId).values,u=En(o.dtype,i.dtype),d=b.makeZerosTypedArray(b.sizeFromShape(o.shape),u),p=0,f=s===0||s>1||o.shape.length===1?1:b.sizeFromShape(o.shape.slice(1));for(let h=0;h<a.length;h++)for(let m=0;m<f;m++)a[h]===1?d[p++]=l[h]:d[p++]=c[h];return e.makeTensorInfo(o.shape,u,d)}var TJ={kernelName:iu,backendName:"cpu",kernelFunc:NLe};var ALe=T.SELU_SCALEALPHA,RLe=T.SELU_SCALE,OLe=ut(fl,n=>n>=0?RLe*n:ALe*(Math.exp(n)-1)),DJ={kernelName:fl,backendName:"cpu",kernelFunc:OLe};var MLe=ut(gl,n=>n<0?-1:n>0?1:0),kJ={kernelName:gl,backendName:"cpu",kernelFunc:MLe};var PLe=ut(hl,n=>Math.sin(n)),NJ={kernelName:hl,backendName:"cpu",kernelFunc:PLe};var FLe=ut(ml,n=>Math.sinh(n)),AJ={kernelName:ml,backendName:"cpu",kernelFunc:FLe};var LLe=11920928955078125e-23,RJ=Math.log(LLe)+2,$Le=ut(xl,n=>{let t=n>-RJ,e=n<RJ,r=Math.exp(n),o;return e?o=r:t?o=n:o=Math.log(1+r),o}),OJ={kernelName:xl,backendName:"cpu",kernelFunc:$Le};function VLe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{blockShape:i,paddings:s}=r;we([o],"spaceToBatchND");let a=b.sizeFromShape(i),l=[[0,0]];l.push(...s);for(let A=1+i.length;A<o.shape.length;++A)l.push([0,0]);let c=AT.kernelFunc({inputs:{x:o},backend:e,attrs:{paddings:l,constantValue:0}}),u=T.getReshaped(c.shape,i,a,!1),d=T.getPermuted(u.length,i.length,!1),p=T.getReshapedPermuted(c.shape,i,a,!1),m=Vt({inputs:{x:c},backend:e,attrs:{shape:u}}),v=cr({inputs:{x:m},backend:e,attrs:{perm:d}}),I=Vt({inputs:{x:v},backend:e,attrs:{shape:p}});return e.disposeIntermediateTensorInfo(c),e.disposeIntermediateTensorInfo(m),e.disposeIntermediateTensorInfo(v),I}var MJ={kernelName:lu,backendName:"cpu",kernelFunc:VLe};function BLe(n){let{inputs:t,backend:e}=n,{indices:r,values:o,denseShape:i,defaultValue:s}=t;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${i.shape}`);if(r.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${r.shape}`);if(o.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${o.shape}`);if(s.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${s.shape}`);let a=e.data.get(r.dataId).values,l=e.data.get(o.dataId).values,c=e.data.get(i.dataId).values,u=e.data.get(s.dataId).values[0],[d,p,f,h,m]=vT(a,r.shape,r.dtype,l,o.dtype,c,u);return[e.makeTensorInfo(p,r.dtype,d),e.makeTensorInfo([p[0]],o.dtype,f),e.makeTensorInfo([h.length],"bool",new Uint8Array(h.map(g=>Number(g)))),e.makeTensorInfo([m.length],r.dtype,new Int32Array(m))]}var PJ={kernelName:Oy,backendName:"cpu",kernelFunc:BLe};function zLe(n){let{inputs:t,backend:e}=n,{inputIndices:r,inputShape:o,newShape:i}=t;if(r.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${r.shape}`);if(o.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${o.shape}`);if(i.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${i.shape}`);let s=Array.from(e.data.get(o.dataId).values),a=e.data.get(r.dataId).values,l=Array.from(e.data.get(i.dataId).values),[c,u,d]=bT(a,r.shape,r.dtype,s,l);return[e.makeTensorInfo(u,r.dtype,c),e.makeTensorInfo([d.length],i.dtype,new Int32Array(d))]}var FJ={kernelName:My,backendName:"cpu",kernelFunc:zLe};function ULe(n){let{inputs:t,backend:e}=n,{data:r,indices:o,segmentIds:i}=t;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(o.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          ${o.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          ${i.shape}`);if(o.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");let s=e.data.get(r.dataId).values,a=e.data.get(o.dataId).values,l=e.data.get(i.dataId).values,[c,u]=Kx(s,r.shape,r.dtype,a,l,!0);return e.makeTensorInfo(u,r.dtype,c)}var LJ={kernelName:hf,backendName:"cpu",kernelFunc:ULe};function WLe(n){let{inputs:t,backend:e}=n,{data:r,indices:o,segmentIds:i}=t;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(o.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         ${o.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         ${i.shape}`);if(o.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");let s=e.data.get(r.dataId).values,a=e.data.get(o.dataId).values,l=e.data.get(i.dataId).values,[c,u]=Kx(s,r.shape,r.dtype,a,l);return e.makeTensorInfo(u,r.dtype,c)}var $J={kernelName:mf,backendName:"cpu",kernelFunc:WLe};function GLe(n){let{inputs:t,backend:e,attrs:r}=n,{sparseIndices:o,sparseValues:i,defaultValue:s}=t,{outputShape:a}=r,{sliceRank:l,numUpdates:c,sliceSize:u,strides:d,outputSize:p}=T.calculateShapes(i,o,a),f=!1,h=e.bufferSync(o),m;switch(i.dtype){case"bool":{let g=e.bufferSync(i),y=!!e.data.get(s.dataId).values[0];m=Bl(h,g,a,p,u,c,l,d,y,f);break}case"float32":{let g=e.bufferSync(i),y=e.data.get(s.dataId).values[0];m=Bl(h,g,a,p,u,c,l,d,y,f);break}case"int32":{let g=e.bufferSync(i),y=e.data.get(s.dataId).values[0];m=Bl(h,g,a,p,u,c,l,d,y,f);break}case"string":{let g=e.bufferSync(i),y=b.decodeString(e.data.get(s.dataId).values[0]);m=Bl(h,g,a,p,u,c,l,d,y,f);break}default:throw new Error(`Unsupported type ${i.dtype}`)}return e.makeTensorInfo(a,m.dtype,m.values)}var VJ={kernelName:gf,backendName:"cpu",kernelFunc:GLe};function jLe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{numOrSizeSplits:i,axis:s}=r,a=b.parseAxisParam(s,o.shape)[0],l=T.prepareSplitSize(o,i,a),c=new Array(o.shape.length).fill(0),u=o.shape.slice();return l.map(d=>{let p=[...u];p[a]=d;let f=sa({inputs:{x:o},backend:e,attrs:{begin:c,size:p}});return c[a]+=d,f})}var BJ={kernelName:cu,backendName:"cpu",kernelFunc:jLe};var zJ={kernelName:yf,backendName:"cpu",kernelFunc:({inputs:n,backend:t})=>{let{x:e}=n,r=t;we(e,"square");let o=r.data.get(e.dataId).values,i=new Float32Array(o.length);for(let a=0;a<o.length;++a){let l=o[a];i[a]=l*l}return{dataId:r.write(i,e.shape,e.dtype),shape:e.shape,dtype:e.dtype}}};var HLe=ut(Sl,(n,t)=>{let e=t;return isNaN(n)?NaN:n>0?1:e.alpha}),UJ={kernelName:Sl,backendName:"cpu",kernelFunc:HLe};function qLe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{begin:i,end:s,strides:a,beginMask:l,endMask:c,ellipsisMask:u,newAxisMask:d,shrinkAxisMask:p}=r;we(o,"stridedSlice");let{finalShapeSparse:f,finalShape:h,isIdentity:m,sliceDim0:g,isSimpleSlice:y,begin:v,end:w,strides:C}=yr.sliceInfo(o.shape,i,s,a,l,c,u,d,p),I;if(m)I=Vt({inputs:{x:o},backend:e,attrs:{shape:h}});else if(g||y){b.assert(o.shape.length>=1,()=>`Input must have rank at least 1, got: ${o.shape.length}`);let A=yr.computeOutShape(v,w,C),M=sa({inputs:{x:o},backend:e,attrs:{begin:v,size:A}});I=Vt({inputs:{x:M},backend:e,attrs:{shape:h}}),e.disposeIntermediateTensorInfo(M)}else{let A=e.bufferSync(o),M=wT(f,A,C,v);I=e.makeTensorInfo(h,M.dtype,M.values)}return I}var WJ={kernelName:xf,backendName:"cpu",kernelFunc:qLe};function KLe(n){let{inputs:t,backend:e,attrs:r}=n,{separator:o,nGramWidths:i,leftPad:s,rightPad:a,padWidth:l,preserveShortSequences:c}=r,{data:u,dataSplits:d}=t,p=e.data.get(u.dataId).values,f=e.data.get(d.dataId).values,[h,m]=CT(p,f,o,i,s,a,l,c);return[e.makeTensorInfo([h.length],"string",h),e.makeTensorInfo(d.shape,"int32",m)]}var GJ={kernelName:vf,backendName:"cpu",kernelFunc:KLe};function XLe(n){let{inputs:t,backend:e,attrs:r}=n,{skipEmpty:o}=r,{input:i,delimiter:s}=t;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(i.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${i.shape}`);if(s.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${s.shape}`);let a=e.data.get(i.dataId).values,l=e.data.get(s.dataId).values[0],[c,u,d]=_T(a,l,o),p=u.length;return[e.makeTensorInfo([p,2],"int32",c),e.makeTensorInfo([p],"string",u),e.makeTensorInfo([2],"int32",new Int32Array(d))]}var jJ={kernelName:Py,backendName:"cpu",kernelFunc:XLe};function YLe(n){let{inputs:t,backend:e,attrs:r}=n,{numBuckets:o}=r,{input:i}=t;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(o<=0)throw new Error("Number of buckets must be at least 1");let s=e.data.get(i.dataId).values,a=ST(s,o);return e.makeTensorInfo(i.shape,"int32",a)}var HJ={kernelName:Fy,backendName:"cpu",kernelFunc:YLe};var ZLe=ut(Cl,n=>Math.tan(n)),qJ={kernelName:Cl,backendName:"cpu",kernelFunc:ZLe};var QLe=ut(_l,n=>Math.tanh(n)),KJ={kernelName:_l,backendName:"cpu",kernelFunc:QLe};function JLe(n){let{inputs:t,backend:e}=n,{tensor:r,indices:o,updates:i}=t,{sliceRank:s,numUpdates:a,sliceSize:l,strides:c,outputSize:u}=T.calculateShapes(i,o,r.shape),d=!1,p=e.bufferSync(o),f=e.bufferSync(i),h=e.bufferSync(r),m=Bl(p,f,r.shape,u,l,a,s,c,h,d);return e.makeTensorInfo(r.shape,m.dtype,m.values)}var XJ={kernelName:pf,backendName:"cpu",kernelFunc:JLe};function e$e(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{reps:i}=r;we(o,"tile");let s=IT(e.bufferSync(o),i);return e.makeTensorInfo(s.shape,s.dtype,s.values)}var YJ={kernelName:Bs,backendName:"cpu",kernelFunc:e$e};function t$e(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{k:i,sorted:s}=r;we(o,"topk");let a=e.data.get(o.dataId).values,[l,c]=ET(a,o.shape,o.dtype,i,s);return[e.makeTensorInfo(l.shape,l.dtype,l.values),e.makeTensorInfo(c.shape,c.dtype,c.values)]}var ZJ={kernelName:bf,backendName:"cpu",kernelFunc:t$e};function n$e(n){let{inputs:t,attrs:e,backend:r}=n,{image:o,transforms:i}=t,{interpolation:s,fillMode:a,fillValue:l,outputShape:c}=e,[u,d,p,f]=o.shape,[h,m]=c??[d,p],g=[u,h,m,f],y=b.computeStrides(o.shape),v=y[0],w=y[1],C=y[2],I=b.computeStrides(g),A=I[0],M=I[1],$=I[2],V=b.getTypedArrayFromDType(o.dtype,b.sizeFromShape(g));V.fill(l);let W=r.data.get(o.dataId).values,K=r.data.get(i.dataId).values;for(let ee=0;ee<u;++ee){let oe=i.shape[0]===1?K:K.subarray(ee*8,ee*8+8);for(let ie=0;ie<h;++ie)for(let se=0;se<m;++se)for(let fe=0;fe<f;++fe){let ue,ye=oe[6]*se+oe[7]*ie+1;if(ye===0)continue;let Te=(oe[0]*se+oe[1]*ie+oe[2])/ye,De=(oe[3]*se+oe[4]*ie+oe[5])/ye,Fe=QJ(Te,p,a),Re=QJ(De,d,a);switch(s){case"nearest":ue=a$e(W,d,p,v,w,C,ee,Re,Fe,fe,l);break;case"bilinear":ue=l$e(W,d,p,v,w,C,ee,Re,Fe,fe,l);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${s}`)}let Ve=ee*A+ie*M+se*$+fe;V[Ve]=ue}return r.makeTensorInfo(g,o.dtype,V)}return{dataId:r.write(V,g,o.dtype),shape:o.shape,dtype:o.dtype}}var JJ={kernelName:wf,backendName:"cpu",kernelFunc:n$e};function QJ(n,t,e){switch(e){case"reflect":return r$e(n,t);case"wrap":return o$e(n,t);case"nearest":return s$e(n,t);case"constant":default:return i$e(n,t)}}function r$e(n,t){let e=n;if(e<0)if(t<=1)e=0;else{let r=2*t;e<r&&(e=r*Math.trunc(-e/r)+e),e=e<-t?e+r:-e-1}else if(e>t-1)if(t<=1)e=0;else{let r=2*t;e-=r*Math.trunc(e/r),e>=t&&(e=r-e-1)}return b.clamp(0,e,t-1)}function o$e(n,t){let e=n;if(e<0)if(t<=1)e=0;else{let r=t-1;e+=t*(Math.trunc(-e/r)+1)}else if(e>t-1)if(t<=1)e=0;else{let r=t-1;e-=t*Math.trunc(e/r)}return b.clamp(0,e,t-1)}function i$e(n,t){return n}function s$e(n,t){return b.clamp(0,n,t-1)}function fw(n,t,e,r,o,i,s,a,l,c,u){let d=s*r+a*o+l*i+c;return 0<=a&&a<t&&0<=l&&l<e?n[d]:u}function a$e(n,t,e,r,o,i,s,a,l,c,u){let d=Math.round(a),p=Math.round(l);return fw(n,t,e,r,o,i,s,d,p,c,u)}function l$e(n,t,e,r,o,i,s,a,l,c,u){let d=Math.floor(a),p=Math.floor(l),f=d+1,h=p+1,m=(h-l)*fw(n,t,e,r,o,i,s,d,p,c,u)+(l-p)*fw(n,t,e,r,o,i,s,d,h,c,u),g=(h-l)*fw(n,t,e,r,o,i,s,f,p,c,u)+(l-p)*fw(n,t,e,r,o,i,s,f,h,c,u);return(f-a)*m+(a-d)*g}function c$e(n){let{inputs:t,attrs:e,backend:r}=n,{axis:o}=e,{x:i}=t;we(i,"unique");let s=r.data.get(i.dataId).values,{outputValues:a,outputShape:l,indices:c}=TT(s,o,i.shape,i.dtype);return[r.makeTensorInfo(l,i.dtype,a),r.makeTensorInfo([c.length],"int32",c)]}var eee={kernelName:Ly,backendName:"cpu",kernelFunc:c$e};function u$e(n){let{inputs:t,backend:e,attrs:r}=n,{value:o}=t,{axis:i}=r;i<0&&(i+=o.shape.length);let s=o.shape.length,a=o.shape[i],l=new Array(s-1),c=0;for(let f=0;f<s;f++)f!==i&&(l[c++]=o.shape[f]);let u=new Array(s).fill(0),d=o.shape.slice();d[i]=1;let p=new Array(a);for(let f=0;f<p.length;f++){u[i]=f;let h=sa({inputs:{x:o},backend:e,attrs:{begin:u,size:d}});p[f]=Vt({inputs:{x:h},backend:e,attrs:{shape:l}}),e.disposeIntermediateTensorInfo(h)}return p}var tee={kernelName:du,backendName:"cpu",kernelFunc:u$e};function d$e(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,segmentIds:i}=t,{numSegments:s}=r;we(o,"unsortedSegmentSum");let a=o.shape.length,l=i.shape.length,c=[],u=[],d=a-l,p=i;for(let h=0;h<d;++h){let m=Yx({inputs:{input:p},backend:e,attrs:{dim:h+1}});p=m,u.push(m)}for(let h=0;h<s;++h){let m=b.createScalarValue(h,"int32"),g=e.makeTensorInfo([],"int32",m),y=r$({inputs:{a:g,b:p},backend:e}),v=oa({inputs:{x:y},backend:e,attrs:{dtype:"float32"}}),w=Mm({inputs:{a:v,b:o},backend:e}),C=qd({inputs:{x:w},backend:e,attrs:{axis:0,keepDims:!1}});c.push(C),u.push(g),u.push(y),u.push(v),u.push(w),u.push(C)}let f=$$({inputs:c,backend:e,attrs:{axis:0}});return u.forEach(h=>e.disposeIntermediateTensorInfo(h)),f}var nee={kernelName:pu,backendName:"cpu",kernelFunc:d$e};var p$e=[TZ,PY,DZ,kZ,BY,NZ,AZ,RZ,OZ,MZ,PZ,FZ,LZ,$Z,VZ,zZ,UZ,WZ,GZ,EZ,jZ,HZ,qZ,zY,KZ,VY,UY,XZ,FY,YZ,QZ,JZ,eQ,tQ,nQ,rQ,oQ,iQ,sQ,aQ,lQ,cQ,uQ,dQ,pQ,fQ,hQ,mQ,gQ,yQ,xQ,vQ,wQ,bZ,CQ,WY,_Q,GY,SQ,jY,IQ,EQ,TQ,HY,qY,DQ,kQ,NQ,AQ,KY,XY,LY,RQ,ZZ,OQ,MQ,PQ,wZ,YY,ZY,FQ,QY,LQ,$Q,VQ,BQ,zQ,UQ,WQ,JY,GQ,jQ,HQ,qQ,XQ,YQ,ZQ,eZ,QQ,JQ,nJ,tZ,nZ,rJ,oJ,iJ,rZ,sJ,cJ,uJ,AT,dJ,CZ,iZ,pJ,fJ,hJ,mJ,$Y,uw,gJ,_Z,SZ,IZ,yJ,xJ,vJ,bJ,wJ,CJ,_J,uZ,SJ,EJ,TJ,DJ,pZ,kJ,NJ,AJ,fZ,eJ,OJ,MJ,PJ,FJ,LJ,$J,VJ,BJ,mZ,zJ,gZ,yZ,UJ,WJ,GJ,jJ,HJ,xZ,bQ,qJ,KJ,XJ,YJ,ZJ,JJ,oZ,eee,tee,nee,aJ];for(let n of p$e)Vy(n);var Fm={},RT={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function ree(n,t){Fm[n]=t}function Yi(n,t){if(!(n in Fm)||t!=null){let r=h$e(n,t);if(r!==null)Fm[n]=r;else return console.log("Could not get context for WebGL version",n),null}let e=Fm[n];return e==null||e.isContextLost()?(delete Fm[n],Yi(n)):(e.disable(e.DEPTH_TEST),e.disable(e.STENCIL_TEST),e.disable(e.BLEND),e.disable(e.DITHER),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SAMPLE_COVERAGE),e.enable(e.SCISSOR_TEST),e.enable(e.CULL_FACE),e.cullFace(e.BACK),Fm[n])}function f$e(n){if(!q().getBool("IS_SAFARI")&&typeof OffscreenCanvas<"u"&&n===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function h$e(n,t){if(n!==1&&n!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");let e=t??f$e(n);return e.addEventListener("webglcontextlost",r=>{r.preventDefault(),delete Fm[n]},!1),q().getBool("SOFTWARE_WEBGL_ENABLED")&&(RT.failIfMajorPerformanceCaveat=!1),n===1?e.getContext("webgl",RT)||e.getContext("experimental-webgl",RT):e.getContext("webgl2",RT)}var Lm=function(n){return n[n.DENSE=0]="DENSE",n[n.SHARED_BATCH=1]="SHARED_BATCH",n}(Lm||{}),Vo=function(n){return n[n.RENDER=0]="RENDER",n[n.UPLOAD=1]="UPLOAD",n[n.PIXELS=2]="PIXELS",n[n.DOWNLOAD=3]="DOWNLOAD",n}(Vo||{}),Eo=function(n){return n[n.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",n[n.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",n[n.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",n[n.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",n[n.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16",n}(Eo||{});function $m(n,t){return[t,n]}function oee(n,t){return n*t}function hw(n){let t=b.sizeFromShape(n),e=Math.ceil(t/4);return b.sizeToSquarishShape(e)}function Nu(n,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(n/2))]}function iee(n,t){let[e,r]=Nu(n,t);return e*r*4}function mw(n,t){let e=n,r,o,i,s,a,l,c,u,d,p;return q().getNumber("WEBGL_VERSION")===2?(r=e.R32F,o=e.R16F,i=e.RGBA16F,s=e.RGBA32F,a=e.RED,c=4,u=1,d=e.HALF_FLOAT,p=e.FLOAT,l=e.RGBA8):(r=n.RGBA,o=n.RGBA,i=n.RGBA,s=e.RGBA,a=n.RGBA,c=4,u=4,d=t!=null?t.HALF_FLOAT_OES:null,p=n.FLOAT,l=n.RGBA),{internalFormatFloat:r,internalFormatHalfFloat:o,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:s,textureFormatFloat:a,downloadTextureFormat:l,downloadUnpackNumChannels:c,defaultNumChannels:u,textureTypeHalfFloat:d,textureTypeFloat:p}}function je(n,t){let e=t();return q().getBool("DEBUG")&&m$e(n),e}function m$e(n){let t=n.getError();if(t!==n.NO_ERROR)throw new Error("WebGL Error: "+x$e(n,t))}var g$e=596e-10,y$e=65504;function see(n){return!!(q().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||n===0||g$e<Math.abs(n)&&Math.abs(n)<y$e)}function x$e(n,t){switch(t){case n.NO_ERROR:return"NO_ERROR";case n.INVALID_ENUM:return"INVALID_ENUM";case n.INVALID_VALUE:return"INVALID_VALUE";case n.INVALID_OPERATION:return"INVALID_OPERATION";case n.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case n.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case n.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${t}`}}function gw(n,t){return Kd(n,()=>n.getExtension(t),'Extension "'+t+'" not supported on this browser.')}function aee(n,t){let e=Kd(n,()=>n.createShader(n.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(je(n,()=>n.shaderSource(e,t)),je(n,()=>n.compileShader(e)),n.getShaderParameter(e,n.COMPILE_STATUS)===!1)throw console.log(n.getShaderInfoLog(e)),new Error("Failed to compile vertex shader.");return e}function lee(n,t){let e=Kd(n,()=>n.createShader(n.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(je(n,()=>n.shaderSource(e,t)),je(n,()=>n.compileShader(e)),q().get("ENGINE_COMPILE_ONLY"))return e;if(n.getShaderParameter(e,n.COMPILE_STATUS)===!1)throw W$(t,n.getShaderInfoLog(e)),new Error("Failed to compile fragment shader.");return e}var v$e=/ERROR: [0-9]+:([0-9]+):/g;function W$(n,t){let e=v$e.exec(t);if(e==null){console.log(`Couldn't parse line number in error: ${t}`),console.log(n);return}let r=+e[1],o=n.split(`
`),i=o.length.toString().length+2,s=o.map((d,p)=>b.rightPad((p+1).toString(),i)+d),a=0;for(let d=0;d<s.length;d++)a=Math.max(s[d].length,a);let l=s.slice(0,r-1),c=s.slice(r-1,r),u=s.slice(r);console.log(l.join(`
`)),console.log(t.split(`
`)[0]),console.log(`%c ${b.rightPad(c[0],a)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(u.join(`
`))}function cee(n){return Kd(n,()=>n.createProgram(),"Unable to create WebGLProgram.")}function uee(n,t){if(je(n,()=>n.linkProgram(t)),!q().get("ENGINE_COMPILE_ONLY")&&n.getProgramParameter(t,n.LINK_STATUS)===!1)throw console.log(n.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}function MT(n,t){if(je(n,()=>n.validateProgram(t)),n.getProgramParameter(t,n.VALIDATE_STATUS)===!1)throw console.log(n.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function dee(n,t){let e=Kd(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return je(n,()=>n.bindBuffer(n.ARRAY_BUFFER,e)),je(n,()=>n.bufferData(n.ARRAY_BUFFER,t,n.STATIC_DRAW)),e}function pee(n,t){let e=Kd(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return je(n,()=>n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e)),je(n,()=>n.bufferData(n.ELEMENT_ARRAY_BUFFER,t,n.STATIC_DRAW)),e}function fee(n){return Kd(n,()=>n.createTexture(),"Unable to create WebGLTexture.")}function hee(n,t){let e=q().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n<=0||t<=0){let r=`[${n}x${t}]`;throw new Error("Requested texture size "+r+" is invalid.")}if(n>e||t>e){let r=`[${n}x${t}]`,o=`[${e}x${e}]`;throw new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+o+".")}}function mee(n){return Kd(n,()=>n.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function G$(n,t,e,r,o,i,s){let a=n.getAttribLocation(t,e);return a===-1?!1:(je(n,()=>n.bindBuffer(n.ARRAY_BUFFER,r)),je(n,()=>n.vertexAttribPointer(a,o,n.FLOAT,!1,i,s)),je(n,()=>n.enableVertexAttribArray(a)),!0)}function b$e(n,t,e){C$e(n,e),je(n,()=>n.activeTexture(n.TEXTURE0+e)),je(n,()=>n.bindTexture(n.TEXTURE_2D,t))}function gee(n,t,e){return Kd(n,()=>n.getUniformLocation(t,e),'uniform "'+e+'" not present in program.')}function yee(n,t,e){return n.getUniformLocation(t,e)}function xee(n,t,e,r){je(n,()=>b$e(n,t,r)),je(n,()=>n.uniform1i(e,r))}function PT(n,t,e){je(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,e)),je(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0))}function j$(n,t){je(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,t)),je(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0))}function yw(n){let t=n.checkFramebufferStatus(n.FRAMEBUFFER);if(t!==n.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+w$e(n,t))}function w$e(n,t){switch(t){case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case n.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${t}`}}function Kd(n,t,e){let r=je(n,()=>t());if(r==null)throw new Error(e);return r}function C$e(n,t){let e=n.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+n.TEXTURE0;if(r<n.TEXTURE0||r>e){let o=`[gl.TEXTURE0, gl.TEXTURE${e}]`;throw new Error(`textureUnit must be in ${o}.`)}}function eh(n,t=2){return b.sizeFromShape(n.slice(0,n.length-t))}function th(n){if(n.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[n.length>1?n[n.length-2]:1,n[n.length-1]]}function xw(n){let t=[1,1,1];return n.length===0||n.length===1&&n[0]===1||(t=[eh(n),...th(n)]),t}function vee(n,t=!1){let e=q().getNumber("WEBGL_MAX_TEXTURE_SIZE"),r=q().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");r===1/0&&q().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(r=e/2),t&&(e=e*2,r=r*2,n=n.map((a,l)=>l>=n.length-2?b.nearestLargerEven(n[l]):n[l]),n.length===1&&(n=[2,n[0]])),n.length!==2&&(n=b.squeezeShape(n).newShape);let o=b.sizeFromShape(n),i=null;n.length<=1&&o<=e?i=[1,o]:n.length===2&&n[0]<=e&&n[1]<=e?i=n:n.length===3&&n[0]*n[1]<=e&&n[2]<=e?i=[n[0]*n[1],n[2]]:n.length===3&&n[0]<=e&&n[1]*n[2]<=e?i=[n[0],n[1]*n[2]]:n.length===4&&n[0]*n[1]*n[2]<=e&&n[3]<=e?i=[n[0]*n[1]*n[2],n[3]]:n.length===4&&n[0]<=e&&n[1]*n[2]*n[3]<=e&&(i=[n[0],n[1]*n[2]*n[3]]);let s=i!=null&&Math.max(...i)>r&&Math.min(...i)<=(t?2:1)&&Math.min(...i)>0;if(i==null||s)if(t){let a=eh(n),l=2,c=2;n.length&&([l,c]=th(n)),o=a*(l/2)*(c/2),i=b.sizeToSquarishShape(o).map(u=>u*2)}else i=b.sizeToSquarishShape(o);return i}function OT(n){return n%2===0}function Vm(n,t){if(n=n.slice(-2),t=t.slice(-2),b.arraysEqual(n,t)||!n.length||!t.length||n[0]===0||n[1]===0||t[0]===0||t[1]===0)return!0;if(n.length!==t.length){let e=n[n.length-1],r=t[t.length-1];if(e===r||OT(e)&&OT(r)&&(n[0]===1||t[0]===1))return!0}return n[1]===t[1]&&OT(n[0])&&OT(t[0])}var B$,z$;function bee(n){if(B$==null){let t=Yi(n);B$=t.getParameter(t.MAX_TEXTURE_SIZE)}return B$}function wee(n){if(z$==null){let t=Yi(n);z$=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,z$)}function Cee(n){if(n===0)return 0;let t,e=Yi(n);return vs(e,"EXT_disjoint_timer_query_webgl2")&&n===2?t=2:vs(e,"EXT_disjoint_timer_query")?t=1:t=0,t}function vs(n,t){return n.getExtension(t)!=null}function H$(n){try{if(Yi(n)!=null)return!0}catch(t){return console.log("Error when getting WebGL context: ",t),!1}return!1}function _ee(n){if(n===0)return!1;let t=Yi(n);if(n===1){if(!vs(t,"OES_texture_float"))return!1}else if(!vs(t,"EXT_color_buffer_float"))return!1;return U$(t)}function See(n){if(n===0)return!1;let t=Yi(n);if(n===1){if(!vs(t,"OES_texture_float")||!vs(t,"WEBGL_color_buffer_float"))return!1}else{if(vs(t,"EXT_color_buffer_float"))return U$(t);let r="EXT_color_buffer_half_float";if(vs(t,r)){let o=t.getExtension(r);return _$e(t,o)}return!1}return U$(t)}function U$(n){let t=mw(n),e=n.createTexture();n.bindTexture(n.TEXTURE_2D,e),n.texImage2D(n.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);let i=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,i),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0);let s=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(e),n.deleteFramebuffer(i),s}function _$e(n,t){let e=mw(n,t),r=n.createTexture();n.bindTexture(n.TEXTURE_2D,r),n.texImage2D(n.TEXTURE_2D,0,e.internalFormatHalfFloat,1,1,0,e.textureFormatFloat,e.textureTypeHalfFloat,null);let s=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,s),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,r,0);let a=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(r),n.deleteFramebuffer(s),a}function Iee(n){return n!==2?!1:Yi(n).fenceSync!=null}function Au(n,t){Array.isArray(n)||(n=[n]),n.forEach(e=>{e!=null&&b.assert(e.dtype!=="complex64",()=>`${t} does not support complex64 tensors in the WebGL backend.`)})}var ot=q();ot.registerFlag("HAS_WEBGL",()=>ot.getNumber("WEBGL_VERSION")>0);ot.registerFlag("WEBGL_VERSION",()=>H$(2)?2:H$(1)?1:0);ot.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);ot.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>ot.get("WEBGL_VERSION")===2);ot.registerFlag("WEBGL_CPU_FORWARD",()=>!0);ot.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);ot.registerFlag("WEBGL_PACK",()=>ot.getBool("HAS_WEBGL"));ot.registerFlag("WEBGL_PACK_NORMALIZATION",()=>ot.getBool("WEBGL_PACK"));ot.registerFlag("WEBGL_PACK_CLIP",()=>ot.getBool("WEBGL_PACK"));ot.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>ot.getBool("WEBGL_PACK"));ot.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>ot.getBool("WEBGL_PACK"));ot.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>ot.getBool("WEBGL_PACK"));ot.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>ot.getBool("WEBGL_PACK"));ot.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>ot.getBool("WEBGL_PACK"));ot.registerFlag("WEBGL_PACK_REDUCE",()=>ot.getBool("WEBGL_PACK"));ot.registerFlag("WEBGL_LAZILY_UNPACK",()=>ot.getBool("WEBGL_PACK"));ot.registerFlag("WEBGL_CONV_IM2COL",()=>ot.getBool("WEBGL_PACK"));ot.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",()=>ot.getBool("WEBGL_PACK"));ot.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>bee(ot.getNumber("WEBGL_VERSION")));ot.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>wee(ot.getNumber("WEBGL_VERSION")));ot.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{let n=ot.getNumber("WEBGL_VERSION");return n===0?0:Cee(n)});ot.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>ot.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!If.isMobile());ot.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>_ee(ot.getNumber("WEBGL_VERSION")));ot.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>ot.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:ot.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));ot.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>See(ot.getNumber("WEBGL_VERSION")));ot.registerFlag("WEBGL_FENCE_API_ENABLED",()=>Iee(ot.getNumber("WEBGL_VERSION")));ot.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>ot.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);ot.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,n=>{if(typeof n!="number")throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but got ${n}.`);if(n<0&&n!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${n}.`)});ot.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>If.isMobile()?1:-1,n=>{if(typeof n!="number")throw new Error(`WEBGL_FLUSH_THRESHOLD must be a number but got ${n}.`);if(n<0&&n!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${n}.`)});ot.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128);ot.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1);ot.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5);ot.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128);ot.registerFlag("WEBGL_EXP_CONV",()=>!1);ot.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>ot.getBool("IS_TEST"));ot.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0);ot.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1);ot.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1);ot.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);function ur(){let n,t,e,r,o,i,s,a,l,c;return q().getNumber("WEBGL_VERSION")===2?(n="#version 300 es",t="in",e="out",r="in",o="texture",i="outputColor",s="out vec4 outputColor;",a=q().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",l="",c=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(n="",t="attribute",e="varying",r="varying",o="texture2D",i="gl_FragColor",s="",a=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,l=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,c=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:n,attribute:t,varyingVs:e,varyingFs:r,texture2D:o,output:i,defineOutput:s,defineSpecialNaN:a,defineSpecialInf:l,defineRound:c}}function zl(n,t,e="index"){let r=b.computeStrides(t);return r.map((o,i)=>{let s=`int ${n[i]} = ${e} / ${o}`,a=i===r.length-1?`int ${n[i+1]} = ${e} - ${n[i]} * ${o}`:`index -= ${n[i]} * ${o}`;return`${s}; ${a};`}).join("")}function Bm(n,t,e="index"){let r=b.computeStrides(t);return r.map((o,i)=>{let s=`int ${n[i]} = ${e} / outShapeStrides[${i}]`,a=i===r.length-1?`int ${n[i+1]} = ${e} - ${n[i]} * outShapeStrides[${i}]`:`index -= ${n[i]} * outShapeStrides[${i}]`;return`${s}; ${a};`}).join("")}function S$e(n,t){let e=n.length,r=n.map(i=>`${t}[${i}]`),o=new Array(e-1);o[e-2]=r[e-1];for(let i=e-3;i>=0;--i)o[i]=`(${o[i+1]} * ${r[i+1]})`;return o}function Eee(n,t,e="index"){let r=n.map((i,s)=>s),o=S$e(r,t);return o.map((i,s)=>{let a=`int ${n[s]} = ${e} / ${o[s]}`,l=s===o.length-1?`int ${n[s+1]} = ${e} - ${n[s]} * ${o[s]}`:`index -= ${n[s]} * ${o[s]}`;return`${a}; ${l};`}).join("")}function Zx(n){let t=b.computeStrides(n).map(e=>e.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${t[0]} + coords.y * ${t[1]} + coords.z;
  }
`}function Qx(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}var LT=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;var{getBroadcastDims:Tee}=T;function Dee(n,t,e){let r=[];if(n.forEach(f=>{let h=b.sizeFromShape(f.shapeInfo.logicalShape);if(f.shapeInfo.isUniform?r.push(`uniform float ${f.name}${h>1?`[${h}]`:""};`):(r.push(`uniform sampler2D ${f.name};`),r.push(`uniform int offset${f.name};`)),e.enableShapeUniforms){let{uniformShape:m}=$T(e.packedInputs,f.shapeInfo.logicalShape,f.shapeInfo.texShape);switch(m.length){case 1:r.push(`uniform int ${f.name}Shape;`);break;case 2:r.push(`uniform ivec2 ${f.name}Shape;`);break;case 3:r.push(`uniform ivec3 ${f.name}Shape;`);break;case 4:r.push(`uniform ivec4 ${f.name}Shape;`);break;default:break}r.push(`uniform ivec2 ${f.name}TexShape;`)}}),e.enableShapeUniforms){switch(t.logicalShape.length){case 1:r.push("uniform int outShape;");break;case 2:r.push("uniform ivec2 outShape;"),r.push("uniform int outShapeStrides;");break;case 3:r.push("uniform ivec3 outShape;"),r.push("uniform ivec2 outShapeStrides;");break;case 4:r.push("uniform ivec4 outShape;"),r.push("uniform ivec3 outShapeStrides;");break;default:break}r.push("uniform ivec2 outTexShape;")}e.customUniforms&&e.customUniforms.forEach(f=>{r.push(`uniform ${f.type} ${f.name}${f.arrayIndex?`[${f.arrayIndex}]`:""};`)});let o=r.join(`
`),i=n.map(f=>I$e(f,t,e.packedInputs,e.enableShapeUniforms)).join(`
`),s=t.texShape,a=ur(),l=D$e(a),c,u,d=A$e(a);return t.isPacked?(c=E$e(t.logicalShape,s,e.enableShapeUniforms),u=N$e(a)):(c=T$e(t.logicalShape,s,e.enableShapeUniforms),u=k$e(a)),e.packedInputs&&(d+=P$e),[d,l,u,o,c,i,e.userCode].join(`
`)}function ev(n,t=!1){let e=n.shapeInfo.logicalShape;switch(e.length){case 0:return q$e(n,t);case 1:return X$e(n,t);case 2:return Z$e(n,t);case 3:return J$e(n,t);case 4:return t3e(n,t);case 5:return n3e(n);case 6:return r3e(n);default:throw new Error(`${e.length}-D input sampling is not yet supported`)}}function kee(n,t){switch(n.shapeInfo.logicalShape.length){case 0:return H$e(n);case 1:return K$e(n,t);case 2:return Y$e(n,t);case 3:return Q$e(n,t);default:return e3e(n,t)}}function I$e(n,t,e=!1,r){let o="";e?o+=kee(n,r):o+=ev(n,r);let i=n.shapeInfo.logicalShape,s=t.logicalShape;return i.length<=s.length&&(e?o+=o3e(n,t):o+=i3e(n,t)),o}function E$e(n,t,e){switch(n.length){case 0:return Nee();case 1:return F$e(n,t,e);case 2:return G$e(n,t,e);case 3:return $$e(n,t,e);default:return B$e(n,t,e)}}function T$e(n,t,e){switch(n.length){case 0:return Nee();case 1:return L$e(n,t,e);case 2:return j$e(n,t,e);case 3:return V$e(n,t,e);case 4:return z$e(n,t,e);case 5:return U$e(n,t);case 6:return W$e(n,t);default:throw new Error(`${n.length}-D output sampling is not yet supported`)}}function D$e(n){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${n.texture2D}(textureSampler, uv).r;
    }
  `}function k$e(n){return`
    void setOutput(float val) {
      ${n.output} = vec4(val, 0, 0, 0);
    }
  `}function N$e(n){return`
    void setOutput(vec4 val) {
      ${n.output} = val;
    }
  `}function A$e(n){return`${n.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${n.varyingFs} vec2 resultUV;
    ${n.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${n.defineSpecialNaN}
    ${n.defineSpecialInf}
    ${n.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${R$e}
    ${O$e}
    ${M$e}
  `}var R$e=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,O$e=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,M$e=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,P$e=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function Nee(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function F$e(n,t,e){let r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];return r[0]===1?e?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${r[1]}.0);
      }
    `:r[1]===1?e?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${r[0]}.0);
      }
    `:e?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));
      return 2 * (resTexRC.x * ${r[1]} + resTexRC.y);
    }
  `}function L$e(n,t,e){return t[0]===1?e?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${t[1]}.0);
      }
    `:t[1]===1?e?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${t[0]}.0);
      }
    `:e?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${t[0]}, ${t[1]}));
      return resTexRC.x * ${t[1]} + resTexRC.y;
    }
  `}function $$e(n,t,e){if(e)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;let r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],o=Math.ceil(n[2]/2),i=o*Math.ceil(n[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));
      int index = resTexRC.x * ${r[1]} + resTexRC.y;

      int b = index / ${i};
      index -= b * ${i};

      int r = 2 * (index / ${o});
      int c = imod(index, ${o}) * 2;

      return ivec3(b, r, c);
    }
  `}function V$e(n,t,e){if(e)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${Bm(["r","c","d"],n)}
    return ivec3(r, c, d);
  }
`;let r=zl(["r","c","d"],n);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;
      ${r}
      return ivec3(r, c, d);
    }
  `}function B$e(n,t,e){if(e)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;let r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],o=Math.ceil(n[n.length-1]/2),i=o*Math.ceil(n[n.length-2]/2),s=i,a="",l="b, r, c";for(let c=2;c<n.length-1;c++)s*=n[n.length-c-1],a=`
      int b${c} = index / ${s};
      index -= b${c} * ${s};
    `+a,l=`b${c}, `+l;return`
    ivec${n.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));
      int index = resTexRC.x * ${r[1]} + resTexRC.y;

      ${a}

      int b = index / ${i};
      index -= b * ${i};

      int r = 2 * (index / ${o});
      int c = imod(index, ${o}) * 2;

      return ivec${n.length}(${l});
    }
  `}function z$e(n,t,e){if(e)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${Bm(["r","c","d","d2"],n)}
      return ivec4(r, c, d, d2);
    }
  `;let r=zl(["r","c","d","d2"],n);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;
      ${r}
      return ivec4(r, c, d, d2);
    }
  `}function U$e(n,t){let e=zl(["r","c","d","d2","d3"],n);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${t[0]},
                             ${t[1]}));

      int index = resTexRC.x * ${t[1]} + resTexRC.y;

      ${e}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function W$e(n,t){let e=zl(["r","c","d","d2","d3","d4"],n);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;

      ${e}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function G$e(n,t,e){let r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(b.arraysEqual(n,t))return e?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${r[0]}, ${r[1]}));
      }
    `;let o=Math.ceil(n[1]/2);return e?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));

      int index = resTexRC.x * ${r[1]} + resTexRC.y;
      int r = 2 * (index / ${o});
      int c = imod(index, ${o}) * 2;

      return ivec2(r, c);
    }
  `}function j$e(n,t,e){return b.arraysEqual(n,t)?e?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${t[0]}, ${t[1]}));
      }
    `:n[1]===1?e?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${t[0]}, ${t[1]}));
        int index = resTexRC.x * ${t[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:n[0]===1?e?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${t[0]}, ${t[1]}));
        int index = resTexRC.x * ${t[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:e?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;
      int r = index / ${n[1]};
      int c = index - r * ${n[1]};
      return ivec2(r, c);
    }
  `}function zm(n){return`offset${n}`}function H$e(n){let t=n.name,e="get"+t.charAt(0).toUpperCase()+t.slice(1),r=ur();return`
    vec4 ${e}() {
      return ${r.texture2D}(${t}, halfCR);
    }
  `}function q$e(n,t){let e=n.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1);if(n.shapeInfo.isUniform)return`float ${r}() {return ${e};}`;let[o,i]=n.shapeInfo.texShape;if(o===1&&i===1)return`
      float ${r}() {
        return sampleTexture(${e}, halfCR);
      }
    `;let s=zm(e);if(t)return`
    float ${r}() {
      vec2 uv = uvFromFlat(${e}TexShape[0], ${e}TexShape[1], ${s});
      return sampleTexture(${e}, uv);
    }
  `;let[a,l]=n.shapeInfo.texShape;return`
    float ${r}() {
      vec2 uv = uvFromFlat(${a}, ${l}, ${s});
      return sampleTexture(${e}, uv);
    }
  `}function K$e(n,t){let e=n.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1),o=n.shapeInfo.texShape,i=ur();if(t)return`
    vec4 ${r}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${e}TexShape[0]) / 2.0), ceil(float(${e}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${i.texture2D}(${e}, uv);
    }
  `;let s=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];return`
    vec4 ${r}(int index) {
      vec2 uv = packedUVfrom1D(
        ${s[0]}, ${s[1]}, index);
      return ${i.texture2D}(${e}, uv);
    }
  `}function X$e(n,t){let e=n.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1);if(n.shapeInfo.isUniform)return`
      float ${r}(int index) {
        ${tv(n)}
      }
    `;let o=n.shapeInfo.texShape,i=o[0],s=o[1];if(s===1&&i===1)return`
      float ${r}(int index) {
        return sampleTexture(${e}, halfCR);
      }
    `;let a=zm(e);return s===1?t?`
      float ${r}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / float(${e}TexShape[0]));
        return sampleTexture(${e}, uv);
      }
    `:`
      float ${r}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / ${i}.0);
        return sampleTexture(${e}, uv);
      }
    `:i===1?t?`
      float ${r}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / float(${e}TexShape[1]), 0.5);
        return sampleTexture(${e}, uv);
      }
    `:`
      float ${r}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / ${s}.0, 0.5);
        return sampleTexture(${e}, uv);
      }
    `:t?`
    float ${r}(int index) {
      vec2 uv = uvFromFlat(${e}TexShape[0], ${e}TexShape[1], index + ${a});
      return sampleTexture(${e}, uv);
    }
  `:`
    float ${r}(int index) {
      vec2 uv = uvFromFlat(${i}, ${s}, index + ${a});
      return sampleTexture(${e}, uv);
    }
  `}function Y$e(n,t){let e=n.shapeInfo.logicalShape,r=n.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n.shapeInfo.texShape,s=i[0],a=i[1],l=ur();if(i!=null&&b.arraysEqual(e,i))return t?`
      vec4 ${o}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);

        return ${l.texture2D}(${r}, uv);
      }
    `:`
      vec4 ${o}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${a}.0, ${s}.0);

        return ${l.texture2D}(${r}, uv);
      }
    `;if(t)return`
    vec4 ${o}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${r}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${l.texture2D}(${r}, uv);
    }
  `;let c=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],u=Math.ceil(e[1]/2);return`
    vec4 ${o}(int row, int col) {
      vec2 uv = packedUVfrom2D(${u}, ${c[0]}, ${c[1]}, row, col);
      return ${l.texture2D}(${r}, uv);
    }
  `}function Z$e(n,t){let e=n.shapeInfo.logicalShape,r=n.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n.shapeInfo.texShape;if(i!=null&&b.arraysEqual(e,i)){if(t)return`
      float ${o}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `;let p=i[0],f=i[1];return`
    float ${o}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${f}.0, ${p}.0);
      return sampleTexture(${r}, uv);
    }
  `}let{newShape:s,keptDims:a}=b.squeezeShape(e),l=s;if(l.length<e.length){let p=nv(n,l),f=["row","col"];return`
      ${ev(p,t)}
      float ${o}(int row, int col) {
        return ${o}(${rv(f,a)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${o}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${e[1]}, 1)));
        ${tv(n)}
      }
    `;let c=i[0],u=i[1],d=zm(r);return u===1?t?`
      float ${o}(int row, int col) {
        float index = dot(vec3(row, col, ${d}), vec3(${r}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${r}TexShape[0]));
        return sampleTexture(${r}, uv);
      }
    `:`
    float ${o}(int row, int col) {
      float index = dot(vec3(row, col, ${d}), vec3(${e[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${c}.0);
      return sampleTexture(${r}, uv);
    }
  `:c===1?t?`
      float ${o}(int row, int col) {
        float index = dot(vec3(row, col, ${d}), vec3(${r}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${r}TexShape[1]), 0.5);
        return sampleTexture(${r}, uv);
      }
    `:`
    float ${o}(int row, int col) {
      float index = dot(vec3(row, col, ${d}), vec3(${e[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${u}.0, 0.5);
      return sampleTexture(${r}, uv);
    }
  `:t?`
      float ${o}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${r}Shape[1] + col + ${d};
        vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index);
        return sampleTexture(${r}, uv);
      }
    `:`
  float ${o}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${e[1]} + col + ${d};
    vec2 uv = uvFromFlat(${c}, ${u}, index);
    return sampleTexture(${r}, uv);
  }
`}function Q$e(n,t){let e=n.shapeInfo.logicalShape,r=n.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n.shapeInfo.texShape,s=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(e[0]===1){let p=e.slice(1),f=[1,2],h=nv(n,p),m=["b","row","col"];return`
        ${kee(h,t)}
        vec4 ${o}(int b, int row, int col) {
          return ${o}(${rv(m,f)});
        }
      `}let a=ur();if(t)return`
    vec4 ${o}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${r}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${r}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${a.texture2D}(${r}, uv);
    }
  `;let l=s[0],c=s[1],u=Math.ceil(e[2]/2),d=u*Math.ceil(e[1]/2);return`
    vec4 ${o}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${l}, ${c}, ${d}, ${u}, b, row, col);
      return ${a.texture2D}(${r}, uv);
    }
  `}function J$e(n,t){let e=n.shapeInfo.logicalShape,r=n.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e[1]*e[2],s=e[2],{newShape:a,keptDims:l}=b.squeezeShape(e),c=a;if(c.length<e.length){let m=nv(n,c),g=["row","col","depth"];return`
        ${ev(m,t)}
        float ${o}(int row, int col, int depth) {
          return ${o}(${rv(g,l)});
        }
      `}if(n.shapeInfo.isUniform)return`
      float ${o}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${i}, ${s}, 1)));
        ${tv(n)}
      }
    `;let u=n.shapeInfo.texShape,d=u[0],p=u[1],f=n.shapeInfo.flatOffset;if(p===i&&f==null)return t?`
      float ${o}(int row, int col, int depth) {
        int stride1 = ${r}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
        float ${o}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${s}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${p}.0, ${d}.0);
          return sampleTexture(${r}, uv);
        }
      `;if(p===s&&f==null)return t?`
      float ${o}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${r}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
    float ${o}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${e[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${p}.0, ${d}.0);
      return sampleTexture(${r}, uv);
    }
  `;let h=zm(r);return t?`
    float ${o}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${r}Shape[1] * ${r}Shape[2];
      int stride1 = ${r}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${h};
      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index);
      return sampleTexture(${r}, uv);
    }
    `:`
      float ${o}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${i} + col * ${s} + depth + ${h};
        vec2 uv = uvFromFlat(${d}, ${p}, index);
        return sampleTexture(${r}, uv);
      }
  `}function e3e(n,t){let e=n.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1),o=ur();if(t)return`
    vec4 ${r}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${e}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${e}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${e}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${e}TexShape[0]) / 2.0), ceil(float(${e}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${o.texture2D}(${e}, uv);
    }
  `;let i=n.shapeInfo.logicalShape,s=i.length,a=n.shapeInfo.texShape,l=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],c=l[0],u=l[1],d=Math.ceil(i[s-1]/2),p=d*Math.ceil(i[s-2]/2),f="int b, int row, int col",h=`b * ${p} + (row / 2) * ${d} + (col / 2)`;for(let m=2;m<s-1;m++)f=`int b${m}, `+f,p*=i[s-m-1],h=`b${m} * ${p} + `+h;return`
    vec4 ${r}(${f}) {
      int index = ${h};
      int texR = index / ${u};
      int texC = index - texR * ${u};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${u}, ${c});
      return ${o.texture2D}(${e}, uv);
    }
  `}function t3e(n,t){let e=n.shapeInfo.logicalShape,r=n.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e[3],s=e[2]*i,a=e[1]*s,{newShape:l,keptDims:c}=b.squeezeShape(e);if(l.length<e.length){let v=nv(n,l),w=["row","col","depth","depth2"];return`
      ${ev(v,t)}
      float ${o}(int row, int col, int depth, int depth2) {
        return ${o}(${rv(w,c)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${o}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${a}, ${s}, ${i}, 1)));
        ${tv(n)}
      }
    `;let u=n.shapeInfo.flatOffset,d=n.shapeInfo.texShape,p=d[0],f=d[1],h=`int stride2 = ${r}Shape[3];`,m=`int stride1 = ${r}Shape[2] * stride2;`,g=`int stride0 = ${r}Shape[1] * stride1;`;if(f===a&&u==null)return t?`
      float ${o}(int row, int col, int depth, int depth2) {
        ${h}
        ${m}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
      float ${o}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${s}, ${i}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${f}.0, ${p}.0);
        return sampleTexture(${r}, uv);
      }
    `;if(f===i&&u==null)return t?`
      float ${o}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${r}Shape[1] * ${r}Shape[2], ${r}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
      float ${o}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${e[1]*e[2]}, ${e[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${f}.0, ${p}.0);
        return sampleTexture(${r}, uv);
      }
    `;let y=zm(r);return t?`
    float ${o}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${h}
      ${m}
      ${g}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index + ${y});
      return sampleTexture(${r}, uv);
    }
  `:`
    float ${o}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${s} +
          depth * ${i} + depth2;
      vec2 uv = uvFromFlat(${p}, ${f}, index + ${y});
      return sampleTexture(${r}, uv);
    }
  `}function n3e(n){let t=n.shapeInfo.logicalShape,e=n.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1),o=t[4],i=t[3]*o,s=t[2]*i,a=t[1]*s,{newShape:l,keptDims:c}=b.squeezeShape(t);if(l.length<t.length){let m=nv(n,l),g=["row","col","depth","depth2","depth3"];return`
      ${ev(m)}
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        return ${r}(${rv(g,c)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${a}, ${s}, ${i}, ${o})) +
          depth3;
        ${tv(n)}
      }
    `;let u=n.shapeInfo.flatOffset,d=n.shapeInfo.texShape,p=d[0],f=d[1];if(f===a&&u==null)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${s}, ${i}, ${o}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${f}.0, ${p}.0);
        return sampleTexture(${e}, uv);
      }
    `;if(f===o&&u==null)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${t[1]*t[2]*t[3]},
               ${t[2]*t[3]}, ${t[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${f}.0, ${p}.0);
        return sampleTexture(${e}, uv);
      }
    `;let h=zm(e);return`
    float ${r}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${s} + depth * ${i} +
          depth2 * ${o} + depth3 + ${h};
      vec2 uv = uvFromFlat(${p}, ${f}, index);
      return sampleTexture(${e}, uv);
    }
  `}function r3e(n){let t=n.shapeInfo.logicalShape,e=n.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1),{newShape:o,keptDims:i}=b.squeezeShape(t);if(o.length<t.length){let g=nv(n,o),y=["row","col","depth","depth2","depth3","depth4"];return`
      ${ev(g)}
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${r}(${rv(y,i)});
      }
    `}let s=t[5],a=t[4]*s,l=t[3]*a,c=t[2]*l,u=t[1]*c;if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${u}, ${c}, ${l}, ${a})) +
          dot(
            vec2(depth3, depth4),
            vec2(${s}, 1)));
        ${tv(n)}
      }
    `;let d=n.shapeInfo.flatOffset,p=n.shapeInfo.texShape,f=p[0],h=p[1];if(h===u&&d==null)return`
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${c}, ${l}, ${a}, ${s})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${h}.0, ${f}.0);
        return sampleTexture(${e}, uv);
      }
    `;if(h===s&&d==null)return`
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${t[1]*t[2]*t[3]*t[4]},
               ${t[2]*t[3]*t[4]},
               ${t[3]*t[4]},
               ${t[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${h}.0, ${f}.0);
        return sampleTexture(${e}, uv);
      }
    `;let m=zm(e);return`
    float ${r}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${u} + col * ${c} + depth * ${l} +
          depth2 * ${a} + depth3 * ${s} + depth4 + ${m};
      vec2 uv = uvFromFlat(${f}, ${h}, index);
      return sampleTexture(${e}, uv);
    }
  `}function tv(n){let t=n.name,e=b.sizeFromShape(n.shapeInfo.logicalShape);return e<2?`return ${t};`:`
    for (int i = 0; i < ${e}; i++) {
      if (i == index) {
        return ${t}[i];
      }
    }
  `}function o3e(n,t){let e=n.name,r=e.charAt(0).toUpperCase()+e.slice(1),o="get"+r+"AtOutCoords",i=n.shapeInfo.logicalShape.length,s=t.logicalShape.length,a=Tee(n.shapeInfo.logicalShape,t.logicalShape),l=vt(s),c=s-i,u,d=["x","y","z","w","u","v"];i===0?u="":s<2&&a.length>=1?u="coords = 0;":u=a.map(v=>`coords.${d[v+c]} = 0;`).join(`
`);let p="";s<2&&i>0?p="coords":p=n.shapeInfo.logicalShape.map((v,w)=>`coords.${d[w+c]}`).join(", ");let f="return outputValue;",m=b.sizeFromShape(n.shapeInfo.logicalShape)===1,y=b.sizeFromShape(t.logicalShape)===1;if(i===1&&!m&&!y)f=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(m&&!y)s===1?f=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:f=`
        return vec4(outputValue.x);
      `;else if(a.length){let v=i-2,w=i-1;a.indexOf(v)>-1&&a.indexOf(w)>-1?f="return vec4(outputValue.x);":a.indexOf(v)>-1?f="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":a.indexOf(w)>-1&&(f="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${o}() {
      ${l} coords = getOutputCoords();
      ${u}
      vec4 outputValue = get${r}(${p});
      ${f}
    }
  `}function i3e(n,t){let e=n.name,r=e.charAt(0).toUpperCase()+e.slice(1),o="get"+r+"AtOutCoords",i=t.texShape,s=n.shapeInfo.texShape,a=n.shapeInfo.logicalShape.length,l=t.logicalShape.length;if(!n.shapeInfo.isUniform&&a===l&&n.shapeInfo.flatOffset==null&&b.arraysEqual(s,i))return`
      float ${o}() {
        return sampleTexture(${e}, resultUV);
      }
    `;let c=vt(l),u=Tee(n.shapeInfo.logicalShape,t.logicalShape),d=l-a,p,f=["x","y","z","w","u","v"];a===0?p="":l<2&&u.length>=1?p="coords = 0;":p=u.map(m=>`coords.${f[m+d]} = 0;`).join(`
`);let h="";return l<2&&a>0?h="coords":h=n.shapeInfo.logicalShape.map((m,g)=>`coords.${f[g+d]}`).join(", "),`
    float ${o}() {
      ${c} coords = getOutputCoords();
      ${p}
      return get${r}(${h});
    }
  `}function vt(n){if(n<=1)return"int";if(n===2)return"ivec2";if(n===3)return"ivec3";if(n===4)return"ivec4";if(n===5)return"ivec5";if(n===6)return"ivec6";throw Error(`GPU for rank ${n} is not yet supported`)}function $T(n,t,e){let{newShape:r,keptDims:o}=b.squeezeShape(t),i=t.length,s=n&&i===3&&t[0]===1,a=s?t.slice(1):r,l=!n&&i>1&&!b.arraysEqual(t,e)&&r.length<i||s;return{useSqueezeShape:l,uniformShape:l?a:t,keptDims:o}}function nv(n,t){let e=JSON.parse(JSON.stringify(n));return e.shapeInfo.logicalShape=t,e}function rv(n,t){return t.map(e=>n[e]).join(", ")}function Ree(n,t,e,r){let o=e.map((u,d)=>{let p={logicalShape:u.shape,texShape:u.isUniform?null:u.texData.texShape,isUniform:u.isUniform,isPacked:u.isUniform?!1:u.texData.isPacked,flatOffset:null};return u.texData!=null&&u.texData.slice!=null&&u.texData.slice.flatOffset>0&&(p.flatOffset=u.texData.slice.flatOffset),{name:t.variableNames[d],shapeInfo:p}}),i=o.map(u=>u.shapeInfo),s={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},a=Dee(o,s,t),l=lee(n.gl,a),c=n.createProgram(l);return q().get("ENGINE_COMPILE_ONLY")?{program:t,fragmentShader:l,source:a,webGLProgram:c,inShapeInfos:i,outShapeInfo:s,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(n.buildVao(c),Object.assign({program:t,fragmentShader:l,source:a,webGLProgram:c,inShapeInfos:i,outShapeInfo:s},q$(n,t,c)))}function q$(n,t,e){let r=[],o=[],i,s,a,l=null,c=null;c=n.getUniformLocation(e,"NAN",!1),q().getNumber("WEBGL_VERSION")===1&&(l=n.getUniformLocation(e,"INFINITY",!1));let u=!1;for(let d of t.variableNames){let p={name:d,uniform:n.getUniformLocation(e,d,u),offset:n.getUniformLocation(e,`offset${d}`,u)};t.enableShapeUniforms&&(p.shape=n.getUniformLocation(e,`${d}Shape`,u),p.texShape=n.getUniformLocation(e,`${d}TexShape`,u)),r.push(p)}if(t.enableShapeUniforms&&(i=n.getUniformLocation(e,"outShape",u),a=n.getUniformLocation(e,"outShapeStrides",u),s=n.getUniformLocation(e,"outTexShape",u)),t.customUniforms)for(let d of t.customUniforms)o.push(n.getUniformLocation(e,d.name,u));return{variablesLocations:r,customUniformLocations:o,infLoc:l,nanLoc:c,outShapeLocation:i,outShapeStridesLocation:a,outTexShapeLocation:s}}function Aee(n,t){if(n.length!==t.length)throw Error(`Binary was compiled with ${n.length} inputs, but was executed with ${t.length} inputs`);n.forEach((e,r)=>{let o=e.logicalShape,i=t[r],s=i.shape;if(!b.arraysEqual(o,s))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${o} and ${s} must match`);if(e.isUniform&&i.isUniform)return;let a=e.texShape,l=i.isUniform?null:i.texData.texShape;if(!b.arraysEqual(a,l))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${a} and ${l} must match`)})}function Oee(n,t,e,r,o){t.program.enableShapeUniforms||(Aee(t.inShapeInfos,e),Aee([t.outShapeInfo],[r]));let i=r.texData.texture,s=r.texData.texShape;r.texData.isPacked?n.setOutputPackedMatrixTexture(i.texture,s[0],s[1]):n.setOutputMatrixTexture(i.texture,s[0],s[1]),n.setProgram(t.webGLProgram),n.bindVertexArray(t.webGLProgram.vao),q().getNumber("WEBGL_VERSION")===1&&t.infLoc!==null&&n.gl.uniform1f(t.infLoc,1/0),t.nanLoc!==null&&n.gl.uniform1f(t.nanLoc,NaN);for(let l=0;l<e.length;++l){let c=e[l],{uniform:u,offset:d,shape:p,texShape:f}=t.variablesLocations[l];if(p){let{uniformShape:h}=$T(t.program.packedInputs,c.shape,c.texData.texShape);switch(h.length){case 1:n.gl.uniform1iv(p,new Int32Array(h));break;case 2:n.gl.uniform2iv(p,new Int32Array(h));break;case 3:n.gl.uniform3iv(p,new Int32Array(h));break;case 4:n.gl.uniform4iv(p,new Int32Array(h));break;default:break}}if(f&&n.gl.uniform2i(f,c.texData.texShape[0],c.texData.texShape[1]),u!=null){if(c.isUniform){if(b.sizeFromShape(c.shape)<2)n.gl.uniform1f(u,c.uniformValues[0]);else{let h=c.uniformValues;h instanceof Float32Array||(h=new Float32Array(h)),n.gl.uniform1fv(u,h)}continue}c.texData.slice!=null&&d!=null&&n.gl.uniform1i(d,c.texData.slice.flatOffset),n.setInputMatrixTexture(c.texData.texture.texture,u,l)}}let a=t.outShapeLocation;if(a)switch(r.shape.length){case 1:n.gl.uniform1iv(a,new Int32Array(r.shape));break;case 2:n.gl.uniform2iv(a,new Int32Array(r.shape));break;case 3:n.gl.uniform3iv(a,new Int32Array(r.shape));break;case 4:n.gl.uniform4iv(a,new Int32Array(r.shape));break;default:break}if(t.outShapeStridesLocation){let l=b.computeStrides(r.shape);switch(r.shape.length){case 2:n.gl.uniform1iv(t.outShapeStridesLocation,new Int32Array(l));break;case 3:n.gl.uniform2iv(t.outShapeStridesLocation,new Int32Array(l));break;case 4:n.gl.uniform3iv(t.outShapeStridesLocation,new Int32Array(l));break;default:break}}if(t.outTexShapeLocation&&n.gl.uniform2i(t.outTexShapeLocation,r.texData.texShape[0],r.texData.texShape[1]),t.program.customUniforms&&o)for(let l=0;l<t.program.customUniforms.length;++l){let c=t.program.customUniforms[l],u=t.customUniformLocations[l],d=o[l];if(c.type==="float")n.gl.uniform1fv(u,d);else if(c.type==="vec2")n.gl.uniform2fv(u,d);else if(c.type==="vec3")n.gl.uniform3fv(u,d);else if(c.type==="vec4")n.gl.uniform4fv(u,d);else if(c.type==="int")n.gl.uniform1iv(u,d);else if(c.type==="ivec2")n.gl.uniform2iv(u,d);else if(c.type==="ivec3")n.gl.uniform3iv(u,d);else if(c.type==="ivec4")n.gl.uniform4iv(u,d);else throw Error(`uniform type ${c.type} is not supported yet.`)}n.executeProgram()}function Mee(n,t,e){let r="";t.concat(e).forEach(s=>{let a=s.texData!=null&&s.texData.slice!=null&&s.texData.slice.flatOffset>0;if(n.enableShapeUniforms&&!s.isUniform){let l=s.texData.texShape,{useSqueezeShape:c,uniformShape:u,keptDims:d}=$T(n.packedInputs,s.shape,l),p="",f="",h="";if(u.length===1&&n.packedInputs){let I=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)];p=`${I[0]>1}_${I[1]>1}`}else if(u.length===2&&!n.packedInputs)f=`${u[0]>1}_${u[1]>1}`;else if(u.length>2&&!n.packedInputs){let I=b.computeStrides(u);h=`${I[0]===l[1]}_${I[I.length-1]===l[1]}`}let m=s.shape.length,g=u.length===2&&b.arraysEqual(s.shape,l),y=b.sizeFromShape(s.shape)===1,v=T.getBroadcastDims(s.shape,e.shape),w=!n.packedInputs&&m===e.shape.length&&b.arraysEqual(l,e.texData.texShape),C=n.packedInputs||u.length>2?"":`${l[0]>1}_${l[1]>1}`;r+=`${m}_${w}_${c?d:""}_${u.length}_${y}_${v}_${g}_${p}_${f}_${h}_${C}_${a}`}else{let l=s.isUniform?"uniform":s.texData.texShape;r+=`${s.shape}_${l}_${a}`}});let o=n.userCode,i=n.constructor.name;return i+="_"+r+"_"+o+`${q().getNumber("WEBGL_VERSION")}`,i}function vn(n){return q().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&n<=4}var VT=class{constructor(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Lm.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];let e=ur();this.outputShape=t,this.enableShapeUniforms=vn(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?Bm(["r","c","d"],t):zl(["r","c","d"],t)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${e.output} = result;
      }
    `}};var BT=class{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Lm.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];let e=ur();this.outputShape=t,this.enableShapeUniforms=vn(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?Bm(["r","c","d"],t):zl(["r","c","d"],t)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${e.output} = result;
      }
    `}};var zT=class{constructor(t){this.variableNames=["A"],this.outTexUsage=Vo.DOWNLOAD;let e=ur();this.outputShape=t,this.userCode=`
      ${LT}

      void main() {
        float x = getAAtOutCoords();
        ${e.output} = encode_float(x);
      }
    `}};var UT=class{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Vo.DOWNLOAD;let e=ur();this.outputShape=t,this.userCode=`
      ${LT}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${e.output} = encode_float(x);
      }
    `}};var l3e={R:0,G:1,B:2,A:3},vw=class{constructor(t,e=!1,r="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];let o=ur();this.outputShape=t,this.enableShapeUniforms=vn(this.outputShape.length);let i="result";e&&(i="floor(result * 255. + 0.5)");let s="";for(let a=0;a<r.length;a++){let l=r[a];s+=`
          if(offset == ${a}) {
            result = values[${l3e[l]}];
          }`}this.userCode=`
      ${this.enableShapeUniforms?Qx():Zx(t)}

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, ${r.length});

        flatIndex = idiv(flatIndex, ${r.length}, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = ${o.texture2D}(A, uv);
          ${s}
        }
        ${o.output} = vec4(${i}, 0., 0., 0.);
      }
    `}};var WT=class{constructor(t,e=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];let r=ur();this.outputShape=t,this.enableShapeUniforms=vn(this.outputShape.length);let o="",i="result";e&&(i="floor(result * 255. + 0.5)");for(let s=0;s<=1;s++)for(let a=0;a<=1;a++){let l=s*2+a;o+=`
          localCoords = coords;
          if(localCoords[2] + ${a} < ${this.enableShapeUniforms?"outShape[2]":`${t[2]}`}) {
          localCoords[2] += ${a};
          if (localCoords[1] + ${s} < ${this.enableShapeUniforms?"outShape[1]":`${t[1]}`}) {
            localCoords[1] += ${s};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${r.texture2D}(A, uv);

            if (offset == 0) {
              result[${l}] = values[0];
            } else if (offset == 1) {
              result[${l}] = values[1];
            } else if (offset == 2) {
              result[${l}] = values[2];
            } else {
              result[${l}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?Qx():Zx(t)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${o}

          ${r.output} = ${i};
        }
    `}};function Pee(n){let t=ur(),e=`${t.version}
    precision highp float;
    ${t.attribute} vec3 clipSpacePos;
    ${t.attribute} vec2 uv;
    ${t.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return aee(n,e)}function Fee(n){let t=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return dee(n,t)}function Lee(n){let t=new Uint16Array([0,1,2,2,1,3]);return pee(n,t)}function bw(n,t,e,r,o,i){hee(t,e);let s=fee(n),a=n.TEXTURE_2D;return je(n,()=>n.bindTexture(a,s)),je(n,()=>n.texParameteri(a,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE)),je(n,()=>n.texParameteri(a,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)),je(n,()=>n.texParameteri(a,n.TEXTURE_MIN_FILTER,n.NEAREST)),je(n,()=>n.texParameteri(a,n.TEXTURE_MAG_FILTER,n.NEAREST)),q().getNumber("WEBGL_VERSION")===1?je(n,()=>n.texImage2D(a,0,r,t,e,0,o,i,null)):je(n,()=>n.texStorage2D(a,1,r,t,e)),je(n,()=>n.bindTexture(n.TEXTURE_2D,null)),{texture:s,texShape:[e,t]}}function K$(n){return n.internalFormatFloat}function $ee(n,t,e,r){let[o,i]=$m(t,e);return bw(n,o,i,K$(r),r.textureFormatFloat,n.FLOAT)}function X$(n){return n.internalFormatHalfFloat}function Vee(n,t,e,r){let[o,i]=$m(t,e);return bw(n,o,i,X$(r),r.textureFormatFloat,r.textureTypeHalfFloat)}function Y$(n){return n.downloadTextureFormat}function Bee(n,t,e,r){let[o,i]=$m(t,e);return bw(n,o,i,Y$(r),n.RGBA,n.UNSIGNED_BYTE)}function Z$(n){return n.internalFormatPackedFloat}function zee(n,t,e,r){let[o,i]=Nu(t,e);return bw(n,o,i,Z$(r),n.RGBA,n.FLOAT)}function Q$(n){return n.internalFormatPackedHalfFloat}function Uee(n,t,e,r){let[o,i]=Nu(t,e);return bw(n,o,i,Q$(r),n.RGBA,r.textureTypeHalfFloat)}function Wee(n,t,e){return je(n,()=>n.bindBuffer(n.ARRAY_BUFFER,e)),G$(n,t,"clipSpacePos",e,3,20,0)&&G$(n,t,"uv",e,2,20,12)}function Gee(n,t,e,r,o,i){je(n,()=>n.bindTexture(n.TEXTURE_2D,t));let s,a,l;o instanceof Uint8Array?(s=new Uint8Array(e*r*4),a=n.UNSIGNED_BYTE,l=n.RGBA):(s=new Float32Array(e*r*4),a=n.FLOAT,l=i.internalFormatPackedFloat),s.set(o),q().getNumber("WEBGL_VERSION")===2?je(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,e,r,n.RGBA,a,s)):je(n,()=>n.texImage2D(n.TEXTURE_2D,0,l,e,r,0,n.RGBA,a,s)),je(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function jee(n,t,e){je(n,()=>n.bindTexture(n.TEXTURE_2D,t)),e.data instanceof Uint8Array?q().getNumber("WEBGL_VERSION")===2?je(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,e.width,e.height,n.RGBA,n.UNSIGNED_BYTE,e.data)):je(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,e.width,e.height,0,n.RGBA,n.UNSIGNED_BYTE,e.data)):q().getNumber("WEBGL_VERSION")===2?je(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,e)):je(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,e)),je(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function Hee(n,t,e,r){let o=n.createBuffer();je(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,o));let a=4*4*t*e;return je(n,()=>n.bufferData(n.PIXEL_PACK_BUFFER,a,n.STREAM_READ)),je(n,()=>n.readPixels(0,0,e,t,n.RGBA,n.FLOAT,0)),je(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,null)),o}function qee(n,t,e){let r=n,o=new Float32Array(e);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,o),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),o}function Kee(n,t,e,r){let[o,i]=$m(t,e),s=4,a=new Uint8Array(oee(t*e,s));return je(n,()=>n.readPixels(0,0,o,i,r.downloadTextureFormat,n.UNSIGNED_BYTE,a)),new Float32Array(a.buffer)}function Xee(n,t,e,r,o,i,s,a){let l=n,c=new Float32Array(iee(i,s));return l.bindBuffer(l.PIXEL_PACK_BUFFER,t),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,c),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),c}function Yee(n,t,e){let r=new Float32Array(t*e*4);return je(n,()=>n.readPixels(0,0,e,t,n.RGBA,n.FLOAT,r)),r}var ov=class{constructor(t){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];let e=q().getNumber("WEBGL_VERSION");if(t!=null?(this.gl=t,ree(e,t)):this.gl=Yi(e),t=this.gl,q().getNumber("WEBGL_VERSION")===2){let i=t;this.createVertexArray=()=>je(i,()=>i.createVertexArray()),this.bindVertexArray=s=>je(i,()=>i.bindVertexArray(s)),this.deleteVertexArray=s=>je(i,()=>i.deleteVertexArray(s)),this.getVertexArray=()=>je(i,()=>i.getParameter(i.VERTEX_ARRAY_BINDING))}else if(t!=null){let i=t.getExtension("OES_vertex_array_object");if(i==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>je(t,()=>i.createVertexArrayOES()),this.bindVertexArray=s=>je(t,()=>i.bindVertexArrayOES(s)),this.deleteVertexArray=s=>je(t,()=>i.deleteVertexArrayOES(s)),this.getVertexArray=()=>je(t,()=>t.getParameter(i.VERTEX_ARRAY_BINDING_OES))}let r="WEBGL_color_buffer_float",o="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),q().getNumber("WEBGL_VERSION")===1){let i="OES_texture_float",s="OES_texture_half_float";if(this.textureFloatExtension=gw(this.gl,i),vs(this.gl,s))this.textureHalfFloatExtension=gw(this.gl,s);else if(q().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),vs(this.gl,o))this.colorBufferHalfFloatExtension=gw(this.gl,o);else if(q().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(r="EXT_color_buffer_float",vs(this.gl,r))this.colorBufferFloatExtension=this.gl.getExtension(r);else if(vs(this.gl,o))this.colorBufferHalfFloatExtension=this.gl.getExtension(o);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=Fee(this.gl),this.indexBuffer=Lee(this.gl),this.framebuffer=mee(this.gl),this.textureConfig=mw(this.gl,this.textureHalfFloatExtension)}get debug(){return q().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");let t=this.gl;je(t,()=>t.finish()),je(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,null)),je(t,()=>t.deleteFramebuffer(this.framebuffer)),je(t,()=>t.bindBuffer(t.ARRAY_BUFFER,null)),je(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)),je(t,()=>t.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(t,e){return this.throwIfDisposed(),$ee(this.gl,t,e,this.textureConfig)}createFloat16MatrixTexture(t,e){return this.throwIfDisposed(),Vee(this.gl,t,e,this.textureConfig)}createUnsignedBytesMatrixTexture(t,e){return this.throwIfDisposed(),Bee(this.gl,t,e,this.textureConfig)}uploadPixelDataToTexture(t,e){this.throwIfDisposed(),jee(this.gl,t,e)}uploadDenseMatrixToTexture(t,e,r,o){this.throwIfDisposed(),Gee(this.gl,t,e,r,o,this.textureConfig)}createFloat16PackedMatrixTexture(t,e){return this.throwIfDisposed(),Uee(this.gl,t,e,this.textureConfig)}createPackedMatrixTexture(t,e){return this.throwIfDisposed(),zee(this.gl,t,e,this.textureConfig)}deleteMatrixTexture(t){this.throwIfDisposed(),this.outputTexture===t&&(j$(this.gl,this.framebuffer),this.outputTexture=null),je(this.gl,()=>this.gl.deleteTexture(t))}downloadByteEncodedFloatMatrixFromOutputTexture(t,e,r){return this.downloadMatrixDriver(t,()=>Kee(this.gl,e,r,this.textureConfig))}downloadPackedMatrixFromBuffer(t,e,r,o,i,s){return Xee(this.gl,t,e,r,o,i,s,this.textureConfig)}downloadFloat32MatrixFromBuffer(t,e){return qee(this.gl,t,e)}createBufferFromTexture(t,e,r){this.bindTextureToFrameBuffer(t);let o=Hee(this.gl,e,r,this.textureConfig);return this.unbindTextureToFrameBuffer(),o}createAndWaitForFence(){let t=this.createFence(this.gl);return this.pollFence(t)}createFence(t){let e,r;if(q().getBool("WEBGL_FENCE_API_ENABLED")){let o=t,i=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0);t.flush(),r=()=>{let s=o.clientWaitSync(i,0,0);return s===o.ALREADY_SIGNALED||s===o.CONDITION_SATISFIED},e=i}else q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(e=this.beginQuery(),this.endQuery(),r=()=>this.isQueryAvailable(e,q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):r=()=>!0;return{query:e,isFencePassed:r}}downloadMatrixFromPackedTexture(t,e,r){return this.downloadMatrixDriver(t,()=>Yee(this.gl,e,r))}createProgram(t){this.throwIfDisposed();let e=this.gl;this.vertexShader==null&&(this.vertexShader=Pee(e));let r=cee(e);je(e,()=>e.attachShader(r,this.vertexShader)),je(e,()=>e.attachShader(r,t)),uee(e,r);let o=Object.assign(r,{vao:this.createVertexArray()});return this.debug&&MT(e,o),o}buildVao(t){this.setProgram(t),this.bindVertexArray(t.vao);let e=this.gl;je(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),Wee(e,t,this.vertexBuffer)}deleteProgram(t){this.throwIfDisposed(),t===this.program&&(this.program=null),t!=null&&(je(this.gl,()=>this.gl.deleteProgram(t)),this.deleteVertexArray(t.vao))}setProgram(t){this.throwIfDisposed(),this.program=t,this.program!=null&&this.debug&&MT(this.gl,this.program),je(this.gl,()=>this.gl.useProgram(t))}getUniformLocation(t,e,r=!0){return this.throwIfDisposed(),r?gee(this.gl,t,e):yee(this.gl,t,e)}getAttributeLocation(t,e){return this.throwIfDisposed(),je(this.gl,()=>this.gl.getAttribLocation(t,e))}getUniformLocationNoThrow(t,e){return this.throwIfDisposed(),this.gl.getUniformLocation(t,e)}setInputMatrixTexture(t,e,r){this.throwIfDisposed(),this.throwIfNoProgram(),xee(this.gl,t,e,r)}setOutputMatrixTexture(t,e,r){this.setOutputMatrixTextureDriver(t,r,e)}setOutputPackedMatrixTexture(t,e,r){this.throwIfDisposed();let[o,i]=Nu(e,r);this.setOutputMatrixTextureDriver(t,o,i)}setOutputMatrixWriteRegion(t,e,r,o){this.setOutputMatrixWriteRegionDriver(r,t,o,e)}setOutputPackedMatrixWriteRegion(t,e,r,o){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&MT(this.gl,this.program),yw(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();let t=this.gl;if(this.debug){let e=this.getVertexArray();console.assert(e===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}je(t,()=>t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),je(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=gw(this.gl,q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){let r=this.gl,o=this.getQueryTimerExtensionWebGL2(),i=r.createQuery();return r.beginQuery(o.TIME_ELAPSED_EXT,i),i}let t=this.getQueryTimerExtensionWebGL1(),e=t.createQueryEXT();return t.beginQueryEXT(t.TIME_ELAPSED_EXT,e),e}endQuery(){if(q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){let e=this.gl,r=this.getQueryTimerExtensionWebGL2();e.endQuery(r.TIME_ELAPSED_EXT);return}let t=this.getQueryTimerExtensionWebGL1();t.endQueryEXT(t.TIME_ELAPSED_EXT)}waitForQueryAndGetTime(t){return B(this,null,function*(){return yield b.repeatedTry(()=>this.disposed||this.isQueryAvailable(t,q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(t,q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})}getQueryTime(t,e){if(e===0)return null;if(e===2){let r=this.gl;return r.getQueryParameter(t,r.QUERY_RESULT)/1e6}else{let r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(t,r.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(t,e){if(e===0)return!0;if(e===2){let r=this.gl,o=this.getQueryTimerExtensionWebGL2(),i=r.getQueryParameter(t,r.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(o.GPU_DISJOINT_EXT)),i&&!this.disjoint}else{let r=this.getQueryTimerExtensionWebGL1(),o=r.getQueryObjectEXT(t,r.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),o&&!this.disjoint}}pollFence(t){return new Promise(e=>{this.addItemToPoll(()=>t.isFencePassed(),()=>e())})}pollItems(){let t=u3e(this.itemsToPoll.map(e=>e.isDoneFn));for(let e=0;e<=t;++e){let{resolveFn:r}=this.itemsToPoll[e];r()}this.itemsToPoll=this.itemsToPoll.slice(t+1)}addItemToPoll(t,e){if(this.itemsToPoll.push({isDoneFn:t,resolveFn:e}),this.itemsToPoll.length>1)return;let r;"setTimeoutCustom"in q().platform&&(r=q().platform.setTimeoutCustom.bind(q().platform)),b.repeatedTry(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,r)}bindTextureToFrameBuffer(t){this.throwIfDisposed(),PT(this.gl,t,this.framebuffer),this.debug&&yw(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(PT(this.gl,this.outputTexture,this.framebuffer),this.debug&&yw(this.gl)):j$(this.gl,this.framebuffer)}downloadMatrixDriver(t,e){this.bindTextureToFrameBuffer(t);let r=e();return this.unbindTextureToFrameBuffer(),r}setOutputMatrixTextureDriver(t,e,r){this.throwIfDisposed();let o=this.gl;PT(o,t,this.framebuffer),this.debug&&yw(o),this.outputTexture=t,je(o,()=>o.viewport(0,0,e,r)),je(o,()=>o.scissor(0,0,e,r))}setOutputMatrixWriteRegionDriver(t,e,r,o){this.throwIfDisposed(),je(this.gl,()=>this.gl.scissor(t,e,r,o))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}};function u3e(n){let t=0;for(;t<n.length&&n[t]();++t);return t-1}var{addImpl:Zee,bincountImpl:GT,bincountReduceImpl:Qee,bitwiseAndImpl:Jee,castImpl:ete,ceilImpl:tte,concatImpl:nte,equalImpl:rte,expImpl:ote,expm1Impl:ite,floorImpl:ste,gatherNdImpl:ate,gatherV2Impl:lte,greaterImpl:cte,greaterEqualImpl:ute,lessImpl:dte,lessEqualImpl:pte,linSpaceImpl:fte,logImpl:hte,maxImpl:mte,maximumImpl:gte,minimumImpl:yte,multiplyImpl:xte,negImpl:vte,notEqualImpl:bte,prodImpl:wte,raggedGatherImpl:Cte,raggedRangeImpl:_te,raggedTensorToTensorImpl:Ste,rangeImpl:Ite,rsqrtImpl:Ete,scatterImpl:Tte,sigmoidImpl:Dte,simpleAbsImpl:jT,sliceImpl:kte,sparseFillEmptyRowsImpl:Nte,sparseReshapeImpl:Ate,sparseSegmentReductionImpl:HT,sqrtImpl:Rte,staticRegexReplaceImpl:Ote,stridedSliceImpl:Mte,stringNGramsImpl:Pte,stringSplitImpl:Fte,stringToHashBucketFastImpl:Lte,subImpl:$te,tileImpl:Vte,topKImpl:Bte,transposeImpl:Um,uniqueImpl:zte}=lw;function J$(n,t){return["x","y","z","w","u","v"].slice(0,t).map(e=>`${n}.${e}`)}function Cr(n,t){return t===1?[n]:J$(n,t)}function Ute(n,t){if(n===1)return"rc";let e="";for(let r=0;r<n;r++)e+=t[r],r<n-1&&(e+=",");return e}var qT=class{constructor(t){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.enableShapeUniforms=vn(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{let e=Cr("rc",this.rank),r=vt(this.rank),o=this.getOutOfBoundsCondition(e),i=this.getSetup(e),s=this.getOutput(e);this.userCode=`
        void main() {
          ${r} rc = getOutputCoords();

          if(${o}) {
            setOutput(vec4(0));
          } else {
            ${i}

            setOutput(vec4(${s}));
          }
        }
      `}}getSourceCoordsArr(t){let e=[];for(let r=0;r<=1;r++)for(let o=0;o<=1;o++){let i=`${r===0?"r":"rp1"}, ${o===0?"c":"cp1"}`;for(let s=2;s<this.rank;s++)i=`${t[t.length-1-s]},`+i;e.push(i)}return e}getOutOfBoundsCondition(t){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let e="";for(let r=this.rank-2;r<this.rank;r++)e+=`${t[r]} >= ${this.enableShapeUniforms?`outShape[${r}]`:this.outputShape[r]}`,r<this.rank-1&&(e+="||");return e}getSetup(t){if(this.rank===1)return"";let e=t.slice(-2),r=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],o=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${e[0]};
      int c = ${e[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${r};
      bool rEdge = rp1 >= ${o};
    `}getOutput(t){let e=this.getSourceCoordsArr(t);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${e[0]}),
            cEdge ? 0. : getA(${e[1]}),
            rEdge ? 0. : getA(${e[2]}),
            rEdge || cEdge ? 0. : getA(${e[3]})`}};var iv=class{constructor(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=t,this.enableShapeUniforms=vn(this.outputShape.length);let r="";for(let o=0;o<4;o++){let i="thisRC = rc;";o%2===1&&(i+="thisRC.z += 1;"),o>1&&(i+="thisRC.y += 1;"),r+=`
        ${i}
        ${o>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${o}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${o>0?"}":""}
      `}this.userCode=`
      ${d3e(e,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?Qx():Zx(t)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":t[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":t[2]};

        ${r}

        setOutput(result);
      }
    `}};function d3e(n,t){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${t?Eee(["r","c","d"],"inputShape"):zl(["r","c","d"],n)}
      return ivec3(r, c, d);
    }
  `}var KT=class{constructor(t){this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(t,e,r){let o=Gte(e,r),i=jte(t,o,r);i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]);let s=Wte(t,o,this.gpgpu.gl,this.gpgpu.textureConfig,r);if(this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=s,this.log();let l=this.freeTextures[i].pop();return this.usedTextures[i].push(l),l}let a;return o===Eo.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(t[0],t[1]):o===Eo.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(t[0],t[1]):o===Eo.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(t[0],t[1]):o===Eo.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(t[0],t[1]):o===Eo.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(t[0],t[1])),this.usedTextures[i].push(a),this.numUsedTextures++,this._numBytesAllocated+=s,this.log(),a}releaseTexture(t,e,r,o){if(this.freeTextures==null)return;let i=Gte(r,o),s=jte(e,i,o);s in this.freeTextures||(this.freeTextures[s]=[]);let a=Wte(e,i,this.gpgpu.gl,this.gpgpu.textureConfig,o),l=q().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");l!==-1&&this._numBytesAllocated>l?(this.gpgpu.deleteMatrixTexture(t.texture),this._numBytesAllocated-=a):(this.freeTextures[s].push(t),this.numFreeTextures++,this._numBytesFree+=a),this.numUsedTextures--;let c=this.usedTextures[s],u=c&&c.indexOf(t);if(u==null||u<0)throw new Error("Cannot release a texture that was never provided by this texture manager");c[u]=c[c.length-1],c.pop(),this.log()}log(){if(!this.logEnabled)return;let t=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${t})`);let e=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*e)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(let t in this.freeTextures)this.freeTextures[t].forEach(e=>{this.gpgpu.deleteMatrixTexture(e.texture)});for(let t in this.usedTextures)this.usedTextures[t].forEach(e=>{this.gpgpu.deleteMatrixTexture(e.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}};function p3e(n,t){let e=n;if(t===e.R32F)return 4;if(t===e.R16F)return 2;if(t===e.RGBA32F)return 16;if(t===n.RGBA)return 16;if(t===e.RGBA16F)return 8;if(t===e.RGBA8)return 4;throw new Error(`Unknown internal format ${t}`)}function Wte(n,t,e,r,o){let i=f3e(t,r),s;if(o){let[l,c]=Nu(n[0],n[1]);s=l*c}else{let[l,c]=$m(n[0],n[1]);s=l*c}let a=p3e(e,i);return s*a}function f3e(n,t){switch(n){case Eo.PACKED_2X2_FLOAT32:return Z$(t);case Eo.PACKED_2X2_FLOAT16:return Q$(t);case Eo.UNPACKED_FLOAT32:return K$(t);case Eo.UNPACKED_FLOAT16:return X$(t);case Eo.PACKED_4X1_UNSIGNED_BYTE:return Y$(t);default:throw new Error(`Unknown physical texture type ${n}`)}}function h3e(n){return q().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?n?Eo.PACKED_2X2_FLOAT32:Eo.UNPACKED_FLOAT32:n?Eo.PACKED_2X2_FLOAT16:Eo.UNPACKED_FLOAT16}function Gte(n,t){if(n===Vo.UPLOAD)return Eo.PACKED_2X2_FLOAT32;if(n===Vo.RENDER||n==null)return h3e(t);if(n===Vo.DOWNLOAD||n===Vo.PIXELS)return Eo.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${n}`)}function jte(n,t,e){return`${n[0]}_${n[1]}_${t}_${e}`}var go=class{constructor(t,e){this.variableNames=["A"],this.outputShape=t,this.enableShapeUniforms=vn(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${e}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}},Br="if (isnan(x)) return x;",Hte="return x;",e3="return abs(x);";var qte="return (x >= 0.0) ? x : (exp(x) - 1.0);",Kte=Br+`
  return (x < 0.0) ? 0.0 : x;
`,Xte=Br+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Ru="return x;",Yte="return 1.0 / (1.0 + exp(-1.0 * x));";var Qte="return x;",Jte=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,ene=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,tne=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,nne="return 1.0 / (1.0 + exp(-1.0 * x));",wi=class{constructor(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.enableShapeUniforms=vn(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${e}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}};var XT=class{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=t,this.enableShapeUniforms=vn(this.outputShape.length);let e=t.length,r=Cr("rc",e),o=vt(e),i=Ute(e,r),s=r.slice(-2),a=e<=1?"rc":`vec2(${s.join(",")})`;this.userCode=`
      void main() {
        ${o} rc = getOutputCoords();
        vec4 packedInput = getA(${i});

        setOutput(getChannel(packedInput, ${a}));
      }
    `}};var g3e=Vr.whereImpl,y3e=1e-7,x3e=1e-4,YT={};function v3e(n){return n in YT||(YT[n]={}),YT[n]}var b3e=q().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),w3e=600;function C3e(){return q().global.screen==null?1024:q().global.screen.height*q().global.screen.width*window.devicePixelRatio*w3e/1024/1024}var rne=(()=>{class n extends Ra{nextDataId(){return n.nextDataId++}constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!q().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let r;if(e!=null){if(e instanceof ov)r=e;else{let o=Yi(q().getNumber("WEBGL_VERSION"),e);r=new ov(o)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{let o=Yi(q().getNumber("WEBGL_VERSION"));r=new ov(o),this.binaryCache=v3e(q().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=r,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new KT(this.gpgpu),this.numMBBeforeWarning=C3e(),this.texData=new md(this,Zr())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(e,r,o,i,s,a){let l=this.makeTensorInfo(r,o),c=this.texData.get(l.dataId);c.isPacked=!1,c.texture={texture:e,texShape:[i,s]},c.texShape=[i,s];let u=xw(r),d=new vw(u,!1,a),p=this.runWebGLProgram(d,[l],o,[[i,s]]);return p.shape=r,c.texture=null,this.disposeIntermediateTensorInfo(l),p.dataId}write(e,r,o){if((q().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||q().getBool("DEBUG"))&&this.checkNumericalProblems(e),o==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");let i={id:this.nextDataId()};return this.texData.set(i,{shape:r,dtype:o,values:e,usage:Vo.UPLOAD,refCount:1}),i}refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}incRef(e){let r=this.texData.get(e);r.refCount++}decRef(e){if(this.texData.has(e)){let r=this.texData.get(e);r.refCount--}}move(e,r,o,i,s){if(q().getBool("DEBUG")&&this.checkNumericalProblems(r),i==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:o,dtype:i,values:r,usage:Vo.UPLOAD,refCount:s})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){let r=this.texData.get(e),{values:o,dtype:i,complexTensorInfos:s,slice:a,shape:l,isPacked:c}=r;if(a!=null){let f;c?f=new wi(l,Ru):f=new go(l,Ru);let h=this.runWebGLProgram(f,[{dataId:e,shape:l,dtype:i}],i),m=this.readSync(h.dataId);return this.disposeIntermediateTensorInfo(h),m}if(o!=null)return this.convertAndCacheOnCPU(e);if(i==="string")return o;let u=this.activeTimers!=null,d;u&&(d=b.now());let p;if(i==="complex64"){let f=this.readSync(s.real.dataId),h=this.readSync(s.imag.dataId);p=T.mergeRealAndImagArrays(f,h)}else p=this.getValuesFromTexture(e);return u&&(this.downloadWaitMs+=b.now()-d),this.convertAndCacheOnCPU(e,p)}read(e){return B(this,null,function*(){if(this.pendingRead.has(e)){let m=this.pendingRead.get(e);return new Promise(g=>m.push(g))}let r=this.texData.get(e),{values:o,shape:i,slice:s,dtype:a,complexTensorInfos:l,isPacked:c}=r;if(s!=null){let m;c?m=new wi(i,Ru):m=new go(i,Ru);let g=this.runWebGLProgram(m,[{dataId:e,shape:i,dtype:a}],a),y=this.read(g.dataId);return this.disposeIntermediateTensorInfo(g),y}if(o!=null)return this.convertAndCacheOnCPU(e);if(q().getBool("DEBUG")&&!q().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&q().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let u=null,d;if(a!=="complex64"&&q().get("WEBGL_BUFFER_SUPPORTED")){d=this.decode(e);let m=this.texData.get(d.dataId);u=this.gpgpu.createBufferFromTexture(m.texture.texture,...hw(i))}this.pendingRead.set(e,[]),a!=="complex64"&&(yield this.gpgpu.createAndWaitForFence());let p;if(a==="complex64"){let m=yield Promise.all([this.read(l.real.dataId),this.read(l.imag.dataId)]),g=m[0],y=m[1];p=T.mergeRealAndImagArrays(g,y)}else if(u==null)p=this.getValuesFromTexture(e);else{let m=b.sizeFromShape(i);p=this.gpgpu.downloadFloat32MatrixFromBuffer(u,m)}if(d!=null&&this.disposeIntermediateTensorInfo(d),u!=null){let m=this.gpgpu.gl;je(m,()=>m.deleteBuffer(u))}let f=this.convertAndCacheOnCPU(e,p),h=this.pendingRead.get(e);return this.pendingRead.delete(e),h.forEach(m=>m(f)),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&Zr().removeDataId(e,this),this.pendingDeletes--),f})}readToGPU(e,r={}){let o=this.texData.get(e),{values:i,shape:s,slice:a,dtype:l,isPacked:c,texture:u}=o;if(l==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(a!=null){let h;c?h=new wi(s,Ru):h=new go(s,Ru);let m=this.runWebGLProgram(h,[{dataId:e,shape:s,dtype:l}],l),g=this.readToGPU(m,r);return this.disposeIntermediateTensorInfo(m),g}if(u==null)throw i!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");let d=this.decode(e,r.customTexShape),p=Zr().makeTensorFromTensorInfo(d),f=this.texData.get(d.dataId);return Object.assign({tensorRef:p},f.texture)}bufferSync(e){let r=this.readSync(e.dataId);if(e.dtype==="string")try{let o=r.map(i=>b.decodeString(i));return ze(e.shape,e.dtype,o)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return ze(e.shape,e.dtype,r)}checkNumericalProblems(e){if(e!=null)for(let r=0;r<e.length;r++){let o=e[r];if(!see(o))throw q().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${o} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${o} cannot be represented on this device.`)}}getValuesFromTexture(e){let{shape:r,dtype:o,isPacked:i}=this.texData.get(e),s=b.sizeFromShape(r);if(q().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){let f=this.decode(e),h=this.texData.get(f.dataId),m=this.gpgpu.downloadMatrixFromPackedTexture(h.texture.texture,...hw(r)).subarray(0,s);return this.disposeIntermediateTensorInfo(f),m}let a=q().getBool("WEBGL_PACK")&&i===!0,l=a?xw(r):r,c=a?new UT(l):new zT(l),u=this.runWebGLProgram(c,[{shape:l,dtype:o,dataId:e}],"float32"),d=this.texData.get(u.dataId),p=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(d.texture.texture,d.texShape[0],d.texShape[1]).subarray(0,s);return this.disposeIntermediateTensorInfo(u),p}timerAvailable(){return q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(e){let r=this.activeTimers,o=[],i=!1;this.programTimersStack==null?(this.programTimersStack=o,i=!0):this.activeTimers.push(o),this.activeTimers=o,e();let s=b.flatten(this.activeTimers.map(c=>c.query)).filter(c=>c!=null),a=b.flatten(this.activeTimers.map(c=>c.name)).filter(c=>c!=null);this.activeTimers=r,i&&(this.programTimersStack=null);let l={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return B(this,null,function*(){if(q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){let c=yield Promise.all(s);l.kernelMs=b.sum(c),l.getExtraProfileInfo=()=>c.map((u,d)=>({name:a[d],ms:u})).map(u=>`${u.name}: ${u.ms}`).join(", ")}else l.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,l})}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:b.now(),endMs:null}}endTimer(e){return q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=b.now(),e)}getQueryTime(e){return B(this,null,function*(){if(q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);let r=e;return r.endMs-r.startMs})}disposeData(e,r=!1){if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(r?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!r&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);let{complexTensorInfos:o}=this.texData.get(e);return o!=null&&(this.disposeData(o.real.dataId,r),this.disposeData(o.imag.dataId,r)),this.texData.delete(e),!0}releaseGPUData(e){let{texture:r,dtype:o,texShape:i,usage:s,isPacked:a,slice:l}=this.texData.get(e),c=l&&l.origDataId||e,u=this.dataRefCount.get(c);u>1?this.dataRefCount.set(c,u-1):(this.dataRefCount.delete(c),r!=null&&(this.numBytesInGPU-=this.computeBytes(i,o),this.textureManager.releaseTexture(r,i,s,a)));let d=this.texData.get(e);d.texture=null,d.texShape=null,d.isPacked=!1,d.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e,r=b3e){return q().getBool("WEBGL_CPU_FORWARD")&&e.every(o=>this.texData.get(o.dataId).texture==null&&b.sizeFromShape(o.shape)<r)}getGPGPUContext(){return this.gpgpu}where(e){T.warn("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");let r=e.dataSync();return g3e(e.shape,r)}packedUnaryOp(e,r,o){let i=new wi(e.shape,r),s=this.compileAndRun(i,[e],o);return Zr().makeTensorFromTensorInfo(s)}abs(e){if(this.shouldExecuteOnCPU([e])&&e.dtype!=="complex64"){let i=jT(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,i)}if(q().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,e3,e.dtype);let r=new go(e.shape,e3),o=this.compileAndRun(r,[e]);return Zr().makeTensorFromTensorInfo(o)}makeTensorInfo(e,r,o){let i;if(r==="string"&&o!=null&&o.length>0&&b.isString(o[0])){let s=o.map(a=>b.encodeString(a));i=this.write(s,e,r)}else i=this.write(o,e,r);return this.texData.get(i).usage=null,{dataId:i,shape:e,dtype:r}}makeOutput(e,r,o){return Zr().makeTensorFromTensorInfo(this.makeTensorInfo(e,r,o),this)}unpackTensor(e){let r=new XT(e.shape);return this.runWebGLProgram(r,[e],e.dtype)}packTensor(e){let r=new qT(e.shape);return this.runWebGLProgram(r,[e],e.dtype,null,!0)}packedReshape(e,r){let o=[eh(e.shape),...th(e.shape)],i={dtype:e.dtype,shape:o,dataId:e.dataId},s=[eh(r),...th(r)],a=new iv(s,o),l=!0,c=[o],u=this.runWebGLProgram(a,[i],e.dtype,c,l);return{dataId:u.dataId,shape:r,dtype:u.dtype}}decode(e,r){let o=this.texData.get(e),{isPacked:i,shape:s,dtype:a}=o;if(r!=null){let f=b.sizeFromShape(s),h=r[0]*r[1]*4;b.assert(f<=h,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}let l=xw(s),c;i?c=new BT(l):c=new VT(l);let u=!0,d=[r??hw(l)],p=this.runWebGLProgram(c,[{shape:l,dtype:a,dataId:e}],a,d,u,r);return{dtype:a,shape:s,dataId:p.dataId}}runWebGLProgram(e,r,o,i,s=!1,a){let l=this.makeTensorInfo(e.outputShape,o),c=this.texData.get(l.dataId);if(e.packedOutput&&(c.isPacked=!0),e.outPackingScheme===Lm.DENSE){let v=a??hw(e.outputShape);c.texShape=v.map(w=>w*2)}if(e.outTexUsage!=null&&(c.usage=e.outTexUsage),b.sizeFromShape(l.shape)===0)return c.values=b.getTypedArrayFromDType(l.dtype,0),l;let u=[],d=r.map(v=>{if(v.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let w=this.texData.get(v.dataId);if(w.texture==null){if(!e.packedInputs&&b.sizeFromShape(v.shape)<=q().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:v.shape,texData:null,isUniform:!0,uniformValues:w.values};e.packedInputs&&(w.isPacked=!0,w.shape=v.shape)}if(this.uploadToGPU(v.dataId),!!w.isPacked!=!!e.packedInputs)v=w.isPacked?this.unpackTensor(v):this.packTensor(v),u.push(v),w=this.texData.get(v.dataId);else if(w.isPacked&&!Vm(w.shape,v.shape)){let C=v,I=v.shape;v.shape=w.shape,v=this.packedReshape(v,I),u.push(v),w=this.texData.get(v.dataId),C.shape=I}return{shape:v.shape,texData:w,isUniform:!1}});this.uploadToGPU(l.dataId);let p={shape:l.shape,texData:c,isUniform:!1},f=Mee(e,d,p),h=this.getAndSaveBinary(f,()=>Ree(this.gpgpu,e,d,p)),m=this.activeTimers!=null,g;m&&(g=this.startTimer()),q().get("ENGINE_COMPILE_ONLY")||Oee(this.gpgpu,h,d,p,i),u.forEach(v=>this.disposeIntermediateTensorInfo(v)),m&&(g=this.endTimer(g),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(g)}));let y=q().getNumber("WEBGL_FLUSH_THRESHOLD");if(y>0){let v=b.now();v-this.lastGlFlushTime>y&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=v)}if(!q().getBool("WEBGL_LAZILY_UNPACK")&&c.isPacked&&s===!1){let v=this.unpackTensor(l);return this.disposeIntermediateTensorInfo(l),v}return l}compileAndRun(e,r,o,i,s=!1){return o=o||r[0].dtype,this.runWebGLProgram(e,r,o,i,s)}getAndSaveBinary(e,r){return e in this.binaryCache||(this.binaryCache[e]=r()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(q().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(r=>{this.gpgpu.deleteProgram(this.binaryCache[r].webGLProgram),delete this.binaryCache[r]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=Z(()=>{if(!q().get("WEBGL_RENDER_FLOAT32_ENABLED")){let e=q().getBool("DEBUG");q().set("DEBUG",!1);let r=this.abs(Ae(1e-8)).dataSync()[0];if(q().set("DEBUG",e),r>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?y3e:x3e}uploadToGPU(e){let r=this.texData.get(e),{shape:o,dtype:i,values:s,texture:a,usage:l,isPacked:c}=r;if(a!=null)return;let u=this.activeTimers!=null,d;u&&(d=b.now());let p=r.texShape;if(p==null&&(p=vee(o,c),r.texShape=p),s!=null){let f=xw(o),h,m=p[1],g=p[0],y=s instanceof Uint8Array||s instanceof Uint8ClampedArray;(c||!y)&&([m,g]=Nu(p[0],p[1])),c?h=new WT(f,y):h=new vw(f,y);let v=y?[g,m]:p,w=this.makeTensorInfo(v,i),C=this.texData.get(w.dataId);y?C.usage=Vo.PIXELS:C.usage=Vo.UPLOAD,C.texShape=v,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(w.dataId),m,g,s);let I=[[g,m]],M=this.runWebGLProgram(h,[w],i,I,!0),$=this.texData.get(M.dataId);r.texShape=$.texShape,r.isPacked=$.isPacked,r.usage=$.usage,q().get("ENGINE_COMPILE_ONLY")?this.disposeData(M.dataId):(r.texture=$.texture,r.values=null,this.texData.delete(M.dataId)),this.disposeIntermediateTensorInfo(w),u&&(this.uploadWaitMs+=b.now()-d)}else{let f=this.acquireTexture(p,l,i,c);r.texture=f}}convertAndCacheOnCPU(e,r){let o=this.texData.get(e),{dtype:i}=o;return r!=null&&(o.values=_3e(r,i)),o.values}acquireTexture(e,r,o,i){if(this.numBytesInGPU+=this.computeBytes(e,o),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){let s=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${s} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,r,i)}computeBytes(e,r){return e[0]*e[1]*b.bytesPerElement(r)}checkCompileCompletion(){for(let[,e]of Object.entries(this.binaryCache))this.checkCompletion_(e)}checkCompileCompletionAsync(){return B(this,null,function*(){let e=[];if(this.gpgpu.parallelCompilationExtension){for(let[,r]of Object.entries(this.binaryCache))e.push(this.checkCompletionAsync_(r));return Promise.all(e)}else{for(let[,r]of Object.entries(this.binaryCache)){let o=new Promise(i=>{try{this.checkCompletion_(r),i(!0)}catch(s){throw s}});e.push(o)}return Promise.all(e)}})}checkCompletionAsync_(e){return B(this,null,function*(){return this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(e):(yield Lb(),this.checkCompletionAsync_(e))})}checkCompletion_(e){if(this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(W$(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(let e of Object.values(this.binaryCache)){this.gpgpu.buildVao(e.webGLProgram);let{variablesLocations:r,customUniformLocations:o,infLoc:i,nanLoc:s,outShapeLocation:a,outShapeStridesLocation:l,outTexShapeLocation:c}=q$(this.gpgpu,e.program,e.webGLProgram);e.variablesLocations=r,e.customUniformLocations=o,e.infLoc=i,e.nanLoc=s,e.outShapeLocation=a,e.outShapeStridesLocation=l,e.outTexShapeLocation=c}}createTensorFromGPUData(e,r,o){e.channels=e.channels||"RGBA";let{texture:i,height:s,width:a,channels:l}=e,c=Zr().backend;if(!c.gpgpu.gl.isTexture(i))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");let u=c.writeTexture(i,r,o,s,a,l);return Zr().makeTensorFromDataId(u,r,o,c)}}return n.nextDataId=0,n})();function _3e(n,t){if(t==="float32"||t==="complex64")return n;if(t==="int32"||t==="bool"){let e=t==="int32"?new Int32Array(n.length):new Uint8Array(n.length);for(let r=0;r<e.length;++r)e[r]=Math.round(n[r]);return e}else throw new Error(`Unknown dtype ${t}`)}If.isBrowser()&&Hy("webgl",()=>new rne,2);var sv=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;var Ci=class{constructor(t,e,r){this.variableNames=["A","B"],this.outputShape=T.assertAndGetBroadcastShape(e,r),this.enableShapeUniforms=vn(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${t}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}};var Qi=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`;var Zi=class{constructor(t,e,r,o=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=T.assertAndGetBroadcastShape(e,r);let i=this.outputShape.length;this.enableShapeUniforms=vn(i);let s="";if(o)if(i===0||b.sizeFromShape(this.outputShape)===1)s=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(s=`
          ${vt(i)} coords = getOutputCoords();
        `,i===1)this.enableShapeUniforms?s+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:s+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{let l=Cr("coords",i);this.enableShapeUniforms?s+=`
            bool nextRowOutOfBounds =
              (${l[i-2]} + 1) >= outShape[${i} - 2];
            bool nextColOutOfBounds =
              (${l[i-1]} + 1) >= outShape[${i} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:s+=`
            bool nextRowOutOfBounds =
              (${l[i-2]} + 1) >= ${this.outputShape[i-2]};
            bool nextColOutOfBounds =
              (${l[i-1]} + 1) >= ${this.outputShape[i-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${t}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${s}

        setOutput(result);
      }
    `}};function _r(n){let{inputs:t,backend:e}=n,{x:r}=t;return e.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var one={kernelName:Vs,backendName:"webgl",kernelFunc:_r};function _i(n){let{inputs:t,backend:e}=n,{real:r,imag:o}=t,i=e.makeTensorInfo(r.shape,"complex64"),s=e.texData.get(i.dataId),a=_r({inputs:{x:r},backend:e}),l=_r({inputs:{x:o},backend:e});return s.complexTensorInfos={real:a,imag:l},i}var ine={kernelName:Op,backendName:"webgl",kernelFunc:_i};var t3="return (a < 0.) ? b * a : a;",n3=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function S3e(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{alpha:i}=r,s=e.makeTensorInfo([],"float32",b.createScalarValue(i,"float32")),a=q().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Zi(n3,o.shape,s.shape):new Ci(t3,o.shape,s.shape),l=e.runWebGLProgram(a,[o,s],"float32");return e.disposeIntermediateTensorInfo(s),l}var sne={kernelName:Bc,backendName:"webgl",kernelFunc:S3e};var r3="return (a < 0.) ? b * a : a;",o3=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function I3e(n){let{inputs:t,backend:e}=n,{x:r,alpha:o}=t,i=q().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Zi(o3,r.shape,o.shape):new Ci(r3,r.shape,o.shape);return e.runWebGLProgram(i,[r,o],"float32")}var ane={kernelName:Jc,backendName:"webgl",kernelFunc:I3e};var aa="if (isnan(x)) return x;";function Ze({opSnippet:n,packedOpSnippet:t,cpuKernelImpl:e,dtype:r}){return({inputs:o,backend:i})=>{let{x:s}=o,a=i,l=r||s.dtype;if(a.shouldExecuteOnCPU([s])&&e!=null){let d=a.texData.get(s.dataId),p=e(d.values,l);return a.makeTensorInfo(s.shape,l,p)}let c=q().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&t!=null,u;return c?u=new wi(s.shape,t):u=new go(s.shape,n),a.runWebGLProgram(u,[s],l)}}function un({opSnippet:n,packedOpSnippet:t,checkOutOfBounds:e=!1,supportsComplex:r=!1,cpuKernelImpl:o,dtype:i}){return({inputs:s,backend:a})=>{let{a:l,b:c}=s,u=a;if(r&&l.dtype==="complex64"){let h=u.texData.get(l.dataId),m=u.texData.get(c.dataId),[g,y]=[[h.complexTensorInfos.real,m.complexTensorInfos.real],[h.complexTensorInfos.imag,m.complexTensorInfos.imag]].map(w=>{let[C,I]=w,A={dataId:C.dataId,dtype:C.dtype,shape:l.shape},M={dataId:I.dataId,dtype:I.dtype,shape:c.shape},$=new Ci(n,l.shape,c.shape);return u.runWebGLProgram($,[A,M],En(C.dtype,I.dtype))}),v=_i({inputs:{real:g,imag:y},backend:u});return u.disposeIntermediateTensorInfo(g),u.disposeIntermediateTensorInfo(y),v}let d=i||En(l.dtype,c.dtype);if((l.dtype==="string"||c.dtype==="string"||u.shouldExecuteOnCPU([l,c]))&&o!=null){let h=u.texData.get(l.dataId).values,m=u.texData.get(c.dataId).values,g=l.dtype==="string"?T.fromUint8ToStringArray(h):h,y=l.dtype==="string"?T.fromUint8ToStringArray(m):m,[v,w]=o(l.shape,c.shape,g,y,d),C=u.makeTensorInfo(w,d),I=u.texData.get(C.dataId);return I.values=v,C}let p=q().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&t!=null,f;return p?f=new Zi(t,l.shape,c.shape,e):f=new Ci(n,l.shape,c.shape),u.runWebGLProgram(f,[l,c],d)}}function Xd(n,t=!1){if(n==="linear")return t?Qte:Hte;if(n==="relu")return t?ene:Kte;if(n==="elu")return t?Jte:qte;if(n==="relu6")return t?tne:Xte;if(n==="prelu")return t?o3:r3;if(n==="leakyrelu")return t?n3:t3;if(n==="sigmoid")return t?nne:Yte;throw new Error(`Activation ${n} has not been implemented for the WebGL backend.`)}var av=class{constructor(t,e,r,o=!1,i=!1,s=!1,a=null,l=!1,c=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r,this.enableShapeUniforms=vn(this.outputShape.length);let u=o?t[1]:t[2],d=Math.ceil(u/2),p=o?"i * 2, rc.y":"rc.y, i * 2",f=i?"rc.z, i * 2":"i * 2, rc.z",h=o?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],m=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],g="",y="";a&&(l?g=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${a}
        }`:c?g=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${a}
        }`:g=`vec4 activation(vec4 x) {
          ${a}
        }`,y="result = activation(result);");let v=s?"result += getBiasAtOutCoords();":"";s&&this.variableNames.push("bias"),l&&this.variableNames.push("preluActivationWeights"),c&&this.variableNames.push("leakyreluAlpha");let w="rc.x",C="rc.x";t[0]<e[0]?w=`imod(rc.x, ${t[0]})`:e[0]<t[0]&&(C=`imod(rc.x, ${e[0]})`),this.userCode=`
      ${g}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${d}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = ${w};
        int batchB = ${C};
        for (int i = 0; i < ${d}; i++) {
          vec4 a = getMatrixA(batchA, ${p});
          vec4 b = getMatrixB(batchB, ${f});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${h[0]} * ${m[0]});
          result += (${h[1]} * ${m[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${v}

        ${y}

        setOutput(result);
      }
    `}};var i3={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"},ww=class{constructor(t,e,r){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=T.assertAndGetBroadcastShape(e,r),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${t}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}};var lne="return a * b;";function Cw(n){let{inputs:t,backend:e}=n,{a:r,b:o}=t,i=T.upcastType(r.dtype,o.dtype);if(r.dtype==="complex64"){let a=e.texData.get(r.dataId),l=e.texData.get(o.dataId),c=new ww(i3.REAL,r.shape,o.shape),u=new ww(i3.IMAG,r.shape,o.shape),d=[{dataId:a.complexTensorInfos.real.dataId,dtype:a.complexTensorInfos.real.dtype,shape:r.shape},{dataId:a.complexTensorInfos.imag.dataId,dtype:a.complexTensorInfos.imag.dtype,shape:r.shape},{dataId:l.complexTensorInfos.real.dataId,dtype:l.complexTensorInfos.real.dtype,shape:o.shape},{dataId:l.complexTensorInfos.imag.dataId,dtype:l.complexTensorInfos.imag.dtype,shape:o.shape}],p=e.runWebGLProgram(c,d,"float32"),f=e.runWebGLProgram(u,d,"float32"),h=_i({inputs:{real:p,imag:f},backend:e});return e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(f),h}if(e.shouldExecuteOnCPU([r,o])){let a=e.texData.get(r.dataId),l=e.texData.get(o.dataId),[c,u]=xte(r.shape,o.shape,a.values,l.values,i),d=e.makeTensorInfo(u,i),p=e.texData.get(d.dataId);return p.values=c,d}let s;return q().getBool("WEBGL_PACK_BINARY_OPERATIONS")?s=new Zi(lne,r.shape,o.shape):s=new Ci(lne,r.shape,o.shape),e.runWebGLProgram(s,[r,o],i)}var cne={kernelName:sl,backendName:"webgl",kernelFunc:Cw};function une(n,t,e){let r=[eh(n.shape),...th(n.shape)],o={dtype:n.dtype,shape:r,dataId:n.dataId},i=[eh(t),...th(t)],s=new iv(i,r),a=!0,l=[r],c=e.runWebGLProgram(s,[o],n.dtype,l,a);return{dataId:c.dataId,shape:t,dtype:c.dtype}}function Ee(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{shape:i}=r,s=e,a=b.sizeFromShape(o.shape),l=b.inferFromImplicitShape(i,a),c=b.sizeFromShape(l);b.assert(a===c,()=>`The new shape (${l}) has ${c} elements and the old shape (${o.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`);let u=s.texData.get(o.dataId);return u.isPacked&&!Vm(o.shape,l)&&!(u.texture!==null&&Vm(u.shape,l))?une(o,l,s):(s.incRef(o.dataId),{dataId:o.dataId,shape:l,dtype:o.dtype})}var dne={kernelName:tu,backendName:"webgl",kernelFunc:Ee};var _w=class{constructor(t,e){this.variableNames=["x"];let{windowSize:r,batchSize:o,inSize:i,outSize:s}=t;this.outputShape=[o,s];let a=Math.floor(r/4)*4,l=r%4,c="sumValue += dot(values, ones);";if(e!=null){let d=1/e;c=`sumValue += dot(values * ${b.isInt(d)?d.toPrecision(2):d}, ones);`}let u="";i%r>0&&(u=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${u}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        float sumValue = 0.0;

        for (int i = 0; i < ${a}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${c}
        }

        int inIdx = inOffset + ${a};
        if (${l===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${c}
        } else if (${l===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${c}
        } else if (${l===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${c}
        }
        setOutput(sumValue);
      }
    `}};var ZT=class{constructor(t,e){this.variableNames=["x"];let{windowSize:r,batchSize:o,inSize:i,outSize:s}=t;this.outputShape=[o,s];let a="0.0",l="";e==="prod"?a="1.0":e==="min"?(a="1.0 / 1e-20",l="min"):e==="max"&&(a="-1.0 / 1e-20",l="max");let c=`${e}(${e}(${e}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;e==="sum"?c="sumValue":e==="prod"?c="prodValue":e==="all"?c="allValue":e==="any"&&(c="anyValue");let u=Math.floor(r/4)*4,d=r%4,p=`
      if (${e==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${e==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${l}(values, minMaxValue);
        if (${e==="min"} || ${e==="max"}) {
          minMaxValue = ${l}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,f="vec4";e==="all"?(a="1.0",p=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,f="bvec4"):e==="any"&&(a="0.0",p=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,f="bvec4");let h="";i%r>0&&(h=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${a};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${h}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        vec4 minMaxValue = vec4(${a});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${u}; i += 4) {
          int inIdx = inOffset + i;
          ${f} values = ${f}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${p}
        }

        int inIdx = inOffset + ${u};
        if (${d===1}) {
          ${f} values = ${f}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${p}
        } else if (${d===2}) {
          ${f} values = ${f}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${p}
        } else if (${d===3}) {
          ${f} values = ${f}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${p}
        }
        setOutput(${c});
      }
    `}};function T3e(n){let t=[];for(;t.length===0||t[t.length-1].outSize!==1;){let e=t.length?t[t.length-1].outSize:n[1],r=T.computeOptimalWindowSize(e);t.push({inSize:e,windowSize:r,outSize:Math.ceil(e/r)})}return t}function Ji(n,t,e,r){let o=T3e(n.shape),i=n;for(let s=0;s<o.length;s++){let{inSize:a,windowSize:l,outSize:c}=o[s],u,d;e==="mean"?u=s===0?new _w({windowSize:l,inSize:a,batchSize:n.shape[0],outSize:c},a):new _w({windowSize:l,inSize:a,batchSize:n.shape[0],outSize:c}):u=new ZT({windowSize:l,inSize:a,batchSize:n.shape[0],outSize:c},e),d=i,i=r.runWebGLProgram(u,[i],t),d.dataId!==n.dataId&&r.disposeIntermediateTensorInfo(d)}return i}var QT=class{constructor(t,e){this.variableNames=["A"];let r=new Array(t.length);for(let s=0;s<r.length;s++)r[s]=t[e[s]];this.outputShape=r,this.rank=r.length;let o=vt(this.rank),i=D3e(e);this.userCode=`
    void main() {
      ${o} resRC = getOutputCoords();
      setOutput(getA(${i}));
    }
    `}};function D3e(n){let t=n.length;if(t>6)throw Error(`Transpose for rank ${t} is not yet supported`);let e=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t);for(let o=0;o<n.length;o++)r[n[o]]=e[o];return r.join()}var JT=class{constructor(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;let r=new Array(t.length);for(let u=0;u<r.length;u++)r[u]=t[e[u]];if(this.outputShape=r,this.rank=r.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);let o=vt(this.rank),i=J$("rc",this.rank),s=new Array(this.rank);for(let u=0;u<e.length;u++)s[e[u]]=i[u];let a=`vec2(${s.slice(-2).join()})`,l=`++${i[this.rank-1]} < ${r[this.rank-1]}`,c=`getChannel(getA(${s.join()}), ${a})`;this.userCode=`
    void main() {
      ${o} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${c};
      if(${l}) {
        result[1] = ${c};
      }
      --${i[this.rank-1]};
      if(++${i[this.rank-2]} < ${r[this.rank-2]}) {
        result[2] = ${c};
        if(${l}) {
          result[3] = ${c};
        }
      }
      setOutput(result);
    }
    `}};function nh(n,t,e){let r=q().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new JT(n.shape,t):new QT(n.shape,t);return e.runWebGLProgram(r,[n],n.dtype)}function pne(n,t,e,r){let o=t,i=n.shape.length,s=b.parseAxisParam(o,n.shape),a=s,l=T.getAxesPermutation(a,i),c=l!=null,u=n;c&&(u=nh(n,l,r),a=T.getInnerMostAxes(a.length,i)),T.assertAxesAreInnerMostDims("sum",a,i);let[d,p]=T.computeOutAndReduceShapes(u.shape,a),f=d;e&&(f=T.expandShapeToKeepDim(d,s));let h=b.sizeFromShape(p),g=b.sizeFromShape(n.shape)/h,y=Ee({inputs:{x:u},attrs:{shape:[g,h]},backend:r}),v=kd(n.dtype),w=Ji(y,v,"sum",r),C=Ee({inputs:{x:w},attrs:{shape:f},backend:r});return r.disposeIntermediateTensorInfo(y),r.disposeIntermediateTensorInfo(w),c&&r.disposeIntermediateTensorInfo(u),C}function Wm(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{axis:i,keepDims:s}=r;return pne(o,i,s,e)}var fne={kernelName:au,backendName:"webgl",kernelFunc:Wm};function Yn(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{perm:i}=r,s=e,a=o.shape.length,l=new Array(a);for(let u=0;u<l.length;u++)l[u]=o.shape[i[u]];let c;if(s.shouldExecuteOnCPU([o])){let d=s.texData.get(o.dataId).values,p=Um(d,o.shape,o.dtype,i,l);c=s.makeTensorInfo(l,o.dtype);let f=s.texData.get(c.dataId);f.values=p}else c=nh(o,i,s);return c}var hne={kernelName:zs,backendName:"webgl",kernelFunc:Yn};var s3=1e3;function Gm({a:n,b:t,transposeA:e,transposeB:r,backend:o,bias:i=null,preluActivationWeights:s=null,leakyreluAlpha:a=0,activation:l=null}){let c=n.shape.length,u=t.shape.length,d=e?n.shape[c-2]:n.shape[c-1],p=r?t.shape[u-1]:t.shape[u-2],f=e?n.shape[c-1]:n.shape[c-2],h=r?t.shape[u-2]:t.shape[u-1],m=n.shape.slice(0,-2),g=t.shape.slice(0,-2),y=b.sizeFromShape(m),v=b.sizeFromShape(g),C=Zo.assertAndGetBroadcastShape(n.shape.slice(0,-2),t.shape.slice(0,-2)).concat([f,h]);b.assert(d===p,()=>`Error in matMul: inner shapes (${d}) and (${p}) of Tensors with shapes ${n.shape} and ${t.shape} and transposeA=${e} and transposeB=${r} must match.`);let I=e?[y,d,f]:[y,f,d],A=r?[v,h,p]:[v,p,h],M=Ee({inputs:{x:n},backend:o,attrs:{shape:I}}),$=Ee({inputs:{x:t},backend:o,attrs:{shape:A}}),V=[M,$],W=Math.max(y,v),K=e?M.shape[1]:M.shape[2],te=i!=null,ee=s!=null,oe=l==="leakyrelu",ie=l!=null?Xd(l,!0):null,se=te||ee||oe||ie!=null,fe;if((f===1||h===1)&&K>s3&&se===!1){let ye=M,Te=$;e&&(ye=Yn({inputs:{x:M},backend:o,attrs:{perm:[0,2,1]}}),V.push(ye)),r&&(Te=Yn({inputs:{x:$},backend:o,attrs:{perm:[0,2,1]}}),V.push(Te));let De=h!==1,Fe=h===1,Re=ye;De&&(Re=Ee({inputs:{x:ye},backend:o,attrs:{shape:[W,K,1]}}),V.push(Re));let Ve=h===1?2:1,Le=Te;Fe&&(Le=Ee({inputs:{x:Te},backend:o,attrs:{shape:[W,1,K]}}),V.push(Le));let qe=Cw({inputs:{a:Re,b:Le},backend:o});fe=Wm({inputs:{x:qe},backend:o,attrs:{axis:Ve,keepDims:!0}}),V.push(qe)}else{let ye=En(n.dtype,t.dtype),Te=new av(I,A,[W,f,h],e,r,te,ie,ee,oe),De=[M,$];if(i!=null&&De.push(i),ee&&De.push(s),oe){let Fe=o.makeTensorInfo([],"float32",b.createScalarValue(a,"float32"));De.push(Fe),V.push(Fe)}fe=o.runWebGLProgram(Te,De,ye)}let ue=Ee({inputs:{x:fe},backend:o,attrs:{shape:C}});V.push(fe);for(let ye of V)o.disposeIntermediateTensorInfo(ye);return ue}function k3e(n){let{inputs:t,backend:e,attrs:r}=n,{a:o,b:i,bias:s,preluActivationWeights:a}=t,{transposeA:l,transposeB:c,activation:u,leakyreluAlpha:d}=r;return Gm({a:o,b:i,transposeA:l,transposeB:c,backend:e,bias:s,preluActivationWeights:a,leakyreluAlpha:d,activation:u})}var mne={kernelName:Id,backendName:"webgl",kernelFunc:k3e};var gne="return abs(x);";function N3e(n){let{inputs:t,backend:e}=n,{x:r}=t;if(e.shouldExecuteOnCPU([r])&&r.dtype!=="complex64"){let i=e.texData.get(r.dataId),s=jT(i.values);return e.makeTensorInfo(r.shape,r.dtype,s)}let o;return q().getBool("WEBGL_PACK_UNARY_OPERATIONS")?o=new wi(r.shape,gne):o=new go(r.shape,gne),e.runWebGLProgram(o,[r],r.dtype)}var yne={kernelName:wc,backendName:"webgl",kernelFunc:N3e};var A3e=Br+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,R3e=Ze({opSnippet:A3e}),xne={kernelName:Oa,backendName:"webgl",kernelFunc:R3e};var O3e=Br+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,M3e=Ze({opSnippet:O3e}),vne={kernelName:Ma,backendName:"webgl",kernelFunc:M3e};var bne="return a + b;",P3e=un({opSnippet:bne,packedOpSnippet:bne,supportsComplex:!0,cpuKernelImpl:Zee}),wne={kernelName:hs,backendName:"webgl",kernelFunc:P3e};var eD=class{constructor(t,e){this.outputShape=[],this.outputShape=t,this.variableNames=e.map((i,s)=>`T${s}`);let r=[];this.variableNames.forEach(i=>{r.push(`float v${i} = get${i}AtOutCoords();`)});let o=this.variableNames.map(i=>`v${i}`).join(" + ");this.userCode=`
      void main() {
        ${r.join(`
        `)}

        float result = ${o};
        setOutput(result);
      }
    `}};var tD=class{constructor(t,e){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.variableNames=e.map((i,s)=>`T${s}`);let r=[];this.variableNames.forEach(i=>{r.push(`vec4 v${i} = get${i}AtOutCoords();`)});let o=this.variableNames.map(i=>`v${i}`).join(" + ");this.userCode=`
      void main() {
        ${r.join(`
        `)}

        vec4 result = ${o};
        setOutput(result);
      }
    `}};function nD(n){let{inputs:t,backend:e}=n,r=t;if(r.length===1)return _r({inputs:{x:r[0]},backend:e});if(r.length>q().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){let l=Math.floor(r.length/2),c=nD({inputs:r.slice(0,l),backend:e}),u=nD({inputs:r.slice(l),backend:e});return nD({inputs:[c,u],backend:e})}let o=r.map(l=>l.dtype).reduce((l,c)=>En(l,c)),i=r.map(l=>l.shape),a=q().getBool("WEBGL_PACK")?new tD(r[0].shape,i):new eD(r[0].shape,i);return e.runWebGLProgram(a,r,o)}var Cne={kernelName:Cc,backendName:"webgl",kernelFunc:nD};function F3e(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{axis:i,keepDims:s}=r,a=o.shape.length,l=b.parseAxisParam(i,o.shape),c=l,u=T.getAxesPermutation(c,a),d=o;u!=null&&(d=Yn({inputs:{x:o},backend:e,attrs:{perm:u}}),c=T.getInnerMostAxes(c.length,a)),T.assertAxesAreInnerMostDims("all",c,a);let[p,f]=T.computeOutAndReduceShapes(d.shape,c),h=b.sizeFromShape(f),m=Ee({inputs:{x:d},backend:e,attrs:{shape:[-1,h]}}),g=Ji(m,m.dtype,"all",e),y;if(s){let v=T.expandShapeToKeepDim(p,l);y=Ee({inputs:{x:g},backend:e,attrs:{shape:v}})}else y=Ee({inputs:{x:g},backend:e,attrs:{shape:p}});return e.disposeIntermediateTensorInfo(m),e.disposeIntermediateTensorInfo(g),u!=null&&e.disposeIntermediateTensorInfo(d),y}var _ne={kernelName:Tp,backendName:"webgl",kernelFunc:F3e};function L3e(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{axis:i,keepDims:s}=r,a=o.shape.length,l=b.parseAxisParam(i,o.shape),c=l,u=T.getAxesPermutation(c,a),d=o;u!=null&&(d=Yn({inputs:{x:o},backend:e,attrs:{perm:u}}),c=T.getInnerMostAxes(c.length,a)),T.assertAxesAreInnerMostDims("any",c,a);let[p,f]=T.computeOutAndReduceShapes(d.shape,c),h=b.sizeFromShape(f),m=Ee({inputs:{x:d},backend:e,attrs:{shape:[-1,h]}}),g=Ji(m,m.dtype,"any",e),y;if(s){let v=T.expandShapeToKeepDim(p,l);y=Ee({inputs:{x:g},backend:e,attrs:{shape:v}})}else y=Ee({inputs:{x:g},backend:e,attrs:{shape:p}});return e.disposeIntermediateTensorInfo(m),e.disposeIntermediateTensorInfo(g),u!=null&&e.disposeIntermediateTensorInfo(d),y}var Sne={kernelName:Dp,backendName:"webgl",kernelFunc:L3e};var rD=class{constructor(t,e,r){this.variableNames=["A"];let{windowSize:o,batchSize:i,outSize:s}=t;r||this.variableNames.push("bestIndicesA"),this.outputShape=[i,s];let a=e==="max"?">":"<",l=r?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${o};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${o}; i++) {
          int inIdx = ${l};
          float candidate = getA(batch, inIdx);
          if (candidate ${a} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}};var oD=class{constructor(t,e,r,o){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,b.assert(t.length>2,()=>`Packed arg${r.charAt(0).toUpperCase()+r.slice(1)} supports only inputs with rank above 2.`);let i=t[t.length-1],s=Math.ceil(i/e);this.outputShape=t.slice(0,-1),s>1&&this.outputShape.push(s),o||this.variableNames.push("bestIndicesA");let a=this.outputShape,l=a.length,c=vt(l),u=Cr("coords",l),d,p;if(s===1){p=l+1;let $=vt(p);d=`
        ${$} sourceLocR = ${$}(${u.join()}, 0);
        ++${u[l-1]};
        ${$} sourceLocG = ${$}(${u.join()}, 0);
        ++${u[l-2]};
        ${$} sourceLocA = ${$}(${u.join()}, 0);
        --${u[l-1]};
        ${$} sourceLocB = ${$}(${u.join()}, 0);
        --${u[l-2]};`}else p=l,d=`
        ${c} sourceLocR = coords;
        ++${u[l-1]};
        ${c} sourceLocG = coords;
        ++${u[l-2]};
        ${c} sourceLocA = coords;
        --${u[l-1]};
        ${c} sourceLocB = coords;
        --${u[l-2]};`;let f=["x","y","z","w","u","v"].slice(0,p),h="."+f[p-1],m=f.map($=>"int "+$),g=Cr("sourceLocR",p-1).concat("inIdx.r"),y=Cr("sourceLocG",p-1).concat("inIdx.g"),v=Cr("sourceLocB",p-1).concat("inIdx.b"),w=Cr("sourceLocA",p-1).concat("inIdx.a"),C=r==="max"?"greaterThan":"lessThan",I=o?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${g.join()}),
                             getBestIndicesAChannel(${y.join()}),
                             getBestIndicesAChannel(${v.join()}),
                             getBestIndicesAChannel(${w.join()})));`,A=`vec4(
            getAChannel(${g.join()}),
            hasNextCol ? getAChannel(${y.join()}) : 0.,
            hasNextRow ? getAChannel(${v.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${w.join()}) : 0.)`,M=o?"":`
      float getBestIndicesAChannel(${m.join()}) {
        return getChannel(getBestIndicesA(${f.join()}),
                                          vec2(${f.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${m.join()}) {
        return getChannel(getA(${f.join()}),
                               vec2(${f.slice(-2).join()}));
      }
      ${M}
      void main() {
        ${c} coords = getOutputCoords();
        bool hasNextCol = ${u[l-1]} < ${a[l-1]-1};
        bool hasNextRow = ${u[l-2]} < ${a[l-2]-1};
        ${d}
        ivec4 srcIdx = ivec4(sourceLocR${h}, sourceLocG${h},
          sourceLocB${h}, sourceLocA${h}) * ${e};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${A};

        for (int i = 0; i < ${e}; i++) {
          inIdx = srcIdx;
          ${I}
          vec4 candidate = ${A};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${C}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}};function Ine(n,t,e,r=null){let o=t.shape[0],i=t.shape[1];r!=null&&(o=r.shape[0],i=r.shape[1]);let s=T.computeOptimalWindowSize(i),a={windowSize:s,inSize:i,batchSize:o,outSize:Math.ceil(i/s)},l=new rD(a,e,r==null),c=[t];r!=null&&c.push(r);let u=n.runWebGLProgram(l,c,"int32");if(u.shape[1]===1)return u;let d=Ine(n,t,e,u);return n.disposeIntermediateTensorInfo(u),d}function Ene(n,t,e,r=null){let o=r!=null?r.shape:t.shape,i=o[o.length-1],s=T.computeOptimalWindowSize(i),a=new oD(o,s,e,r==null),l=r==null?[t]:[t,r],c=n.runWebGLProgram(a,l,"int32");if(c.shape.length===t.shape.length){let u=Ene(n,t,e,c);return n.disposeIntermediateTensorInfo(c),u}return c}function iD(n,t,e,r){let o=[e];if(T.assertAxesAreInnerMostDims("arg"+r.charAt(0).toUpperCase()+r.slice(1),o,t.shape.length),!q().getBool("WEBGL_PACK_REDUCE")||t.shape.length<=2){let i=[],s=n.texData.get(t.dataId),a=s!==null&&s.isPacked,l=t;a&&(l=n.unpackTensor(t),i.push(l));let[c,u]=T.computeOutAndReduceShapes(l.shape,o),d=b.sizeFromShape(u),p=Ee({inputs:{x:l},backend:n,attrs:{shape:[-1,d]}});i.push(p);let f=Ine(n,p,r);i.push(f);let h=Ee({inputs:{x:f},backend:n,attrs:{shape:c}});return i.forEach(m=>n.disposeIntermediateTensorInfo(m)),h}return Ene(n,t,r)}function $3e(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{axis:i}=r,s=b.parseAxisParam(i,o.shape),a=T.getAxesPermutation(s,o.shape.length),l=o,c=[];a!=null&&(l=Yn({inputs:{x:o},backend:e,attrs:{perm:a}}),c.push(l),s=T.getInnerMostAxes(s.length,l.shape.length)),T.assertAxesAreInnerMostDims("argMax",[s[0]],l.shape.length);let u=iD(e,l,s[0],"max");return c.forEach(d=>e.disposeIntermediateTensorInfo(d)),u}var Tne={kernelName:_c,backendName:"webgl",kernelFunc:$3e};function V3e(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{axis:i}=r,s=b.parseAxisParam(i,o.shape),a=T.getAxesPermutation(s,o.shape.length),l=o,c=[];a!=null&&(l=Yn({inputs:{x:o},backend:e,attrs:{perm:a}}),c.push(l),s=T.getInnerMostAxes(s.length,l.shape.length)),T.assertAxesAreInnerMostDims("argMin",[s[0]],l.shape.length);let u=iD(e,l,s[0],"min");return c.forEach(d=>e.disposeIntermediateTensorInfo(d)),u}var Dne={kernelName:Sc,backendName:"webgl",kernelFunc:V3e};var B3e=Br+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,z3e=Ze({opSnippet:B3e}),kne={kernelName:Pa,backendName:"webgl",kernelFunc:z3e};var U3e=Br+"return log(x + sqrt(x * x + 1.0));",W3e=Ze({opSnippet:U3e}),Nne={kernelName:Fa,backendName:"webgl",kernelFunc:W3e};var G3e=Br+`
  return atan(x);
`,j3e=Ze({opSnippet:G3e}),Ane={kernelName:La,backendName:"webgl",kernelFunc:j3e};var H3e=sv+`
  return atan(a, b);
`,q3e=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Qi+`
  return result;
`,K3e=un({opSnippet:H3e,packedOpSnippet:q3e}),Rne={kernelName:Va,backendName:"webgl",kernelFunc:K3e};var X3e=Br+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,Y3e=Ze({opSnippet:X3e}),One={kernelName:$a,backendName:"webgl",kernelFunc:Y3e};var Ul=class{constructor(t,e,r,o=!1,i=!1){if(this.variableNames=["x"],e==="avg"&&r)throw new Error("Cannot compute positions for average pool.");let s=t.filterWidth,a=t.strideHeight,l=t.strideWidth,c=t.dilationHeight,u=t.dilationWidth,d=t.effectiveFilterHeight,p=t.effectiveFilterWidth,f=t.padInfo.top,h=t.padInfo.left;this.outputShape=t.outShape;let m=e==="avg",g=`((batch  * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + d`,y=`(xR * ${t.inWidth} + xC) * ${t.inChannels} + d`,v="0.0";if(m||(v="-1.0 / 1e-20"),r){let $=">=";this.userCode=`
        const ivec2 strides = ivec2(${a}, ${l});
        const ivec2 pads = ivec2(${f}, ${h});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${d};
              wR += ${c}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${p};
                wC += ${u}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${t.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value ${$} currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${o?i?g:y:`wR * ${p} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}let w="max",C=`${e}(${e}(${e}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;e==="avg"&&(C="avgValue / max(count, 1.0)");let I=Math.floor(s/4)*4,A=s%4,M=`
      if (${m}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${w}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${a}, ${l});
      const ivec2 pads = ivec2(${f}, ${h});
      const float initializationValue = ${v};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${t.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${v});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${d};
            wR += ${c}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${t.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${I}; wC += 4) {
            int xC = xCCorner + wC * ${u};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              getValue(batch, xR, xC + 2 * ${u}, d),
              getValue(batch, xR, xC + 3 * ${u}, d)
            );

            ${M}
          }

          int xC = xCCorner + ${I};
          if (${A===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${M}
          } else if (${A===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              initializationValue,
              initializationValue
            );

            ${M}
          } else if (${A===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              getValue(batch, xR, xC + 2 * ${u}, d),
              initializationValue
            );

            ${M}
          }
        }
        setOutput(${C});
      }
    `}},rh=class{constructor(t,e,r,o=!1,i=!1){if(this.variableNames=["x"],e==="avg"&&r)throw new Error("Cannot compute positions for average pool.");let s=t.filterWidth,a=t.strideDepth,l=t.strideHeight,c=t.strideWidth,u=t.dilationDepth,d=t.dilationHeight,p=t.dilationWidth,f=t.effectiveFilterDepth,h=t.effectiveFilterHeight,m=t.effectiveFilterWidth,g=t.padInfo.front,y=t.padInfo.top,v=t.padInfo.left;this.outputShape=t.outShape;let w=e==="avg",C="0.0";if(w||(C="-1.0 / 1e-20"),r){let W=">=";this.userCode=`
        const ivec3 strides =
            ivec3(${a}, ${l}, ${c});
        const ivec3 pads = ivec3(${g}, ${y}, ${v});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${f};
              wD += ${u}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${t.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${h};
                wR += ${d}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${t.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${m};
                  wC += ${p}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${t.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value ${W} currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${o?i?`(((batch * ${t.inDepth} + xD) * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + ch`:`((xD * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + ch`:`wD * ${h} * ${m} +
                      wR * ${m} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}let I="max",A=`${e}(${e}(${e}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;e==="avg"&&(A="avgValue / max(count, 1.0)");let M=Math.floor(s/4)*4,$=s%4,V=`
      if (${w}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${I}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${a}, ${l}, ${c});
      const ivec3 pads = ivec3(${g}, ${y}, ${v});
      const float initializationValue = ${C};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${t.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${C});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${f};
            wD += ${u}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${t.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${h};
            wR += ${d}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${M}; wC += 4) {
              int xC = xCCorner + wC * ${p};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${p}, ch),
                getValue(batch, xD, xR, xC + 2 * ${p}, ch),
                getValue(batch, xD, xR, xC + 3 * ${p}, ch)
              );

              ${V}
            }

            int xC = xCCorner + ${M};
            if (${$===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${V}
            } else if (${$===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${p}, ch),
                initializationValue,
                initializationValue
              );

              ${V}
            } else if (${$===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${p}, ch),
                getValue(batch, xD, xR, xC + 2 * ${p}, ch),
                initializationValue
              );

              ${V}
            }
          }
        }
        setOutput(${A});
      }
    `}};function Z3e(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t;Au(o,"avgPool");let{filterSize:i,strides:s,pad:a,dimRoundingMode:l}=r,c=1;b.assert(T.eitherStridesOrDilationsAreOne(s,c),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${s} and dilations '${c}'`);let u=T.computePool2DInfo(o.shape,i,s,c,a,l);if(u.filterWidth===1&&u.filterHeight===1&&b.arraysEqual(u.inShape,u.outShape))return _r({inputs:{x:o},backend:e});let d=new Ul(u,"avg",!1);return e.runWebGLProgram(d,[o],"float32")}var Mne={kernelName:Ic,backendName:"webgl",kernelFunc:Z3e};function Q3e(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{filterSize:i,strides:s,pad:a,dimRoundingMode:l,dataFormat:c}=r,u=[1,1,1],d=T.computePool3DInfo(o.shape,i,s,u,a,l,c),p=new rh(d,"avg",!1);return e.runWebGLProgram(p,[o],"float32")}var Pne={kernelName:Ec,backendName:"webgl",kernelFunc:Q3e};var sD=class{constructor(t){this.variableNames=["dy"],this.outputShape=t.inShape;let e=t.filterHeight,r=t.filterWidth,o=t.strideHeight,i=t.strideWidth,s=t.dilationHeight,a=t.dilationWidth,l=t.effectiveFilterHeight,c=t.effectiveFilterWidth,u=l-1-t.padInfo.top,d=c-1-t.padInfo.left,p=1/(e*r);this.userCode=`
      const ivec2 pads = ivec2(${u}, ${d});
      const float avgMultiplier = float(${p});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${l};
            wR += ${s}) {
          float dyR = float(dyRCorner + wR) / ${o}.0;

          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${c};
            wC+= ${a}) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}},aD=class{constructor(t){this.variableNames=["dy"],this.outputShape=t.inShape;let e=t.filterDepth,r=t.filterHeight,o=t.filterWidth,i=t.strideDepth,s=t.strideHeight,a=t.strideWidth,l=t.dilationDepth,c=t.dilationHeight,u=t.dilationWidth,d=t.effectiveFilterDepth,p=t.effectiveFilterHeight,f=t.effectiveFilterWidth,h=d-1-t.padInfo.front,m=p-1-t.padInfo.top,g=f-1-t.padInfo.left,y=1/(e*r*o);this.userCode=`
      const ivec3 pads = ivec3(${h}, ${m}, ${g});
      const float avgMultiplier = float(${y});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${d};
            wD += ${l}) {
          float dyD = float(dyDCorner + wD) / ${i}.0;

          if (dyD < 0.0 || dyD >= ${t.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${p};
              wR += ${c}) {
            float dyR = float(dyRCorner + wR) / ${s}.0;

            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${f};
                wC += ${u}) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}};function J3e(n){let{inputs:t,backend:e,attrs:r}=n,{dy:o,input:i}=t,s=i,{filterSize:a,strides:l,pad:c,dimRoundingMode:u}=r,d=[1,1,1],p=T.computePool3DInfo(s.shape,a,l,d,c,u),f=new aD(p);return e.runWebGLProgram(f,[o],s.dtype)}var Fne={kernelName:Np,backendName:"webgl",kernelFunc:J3e};function eVe(n){let{inputs:t,backend:e,attrs:r}=n,{dy:o,input:i}=t,s=i;Au([o,i],"avgPoolGrad");let{filterSize:a,strides:l,pad:c}=r,u=T.computePool2DInfo(s.shape,a,l,1,c),d=new sD(u);return e.runWebGLProgram(d,[o],s.dtype)}var Lne={kernelName:kp,backendName:"webgl",kernelFunc:eVe};function tVe(n){let{inputs:t,backend:e,attrs:r}=n,{a:o,b:i}=t,{transposeA:s,transposeB:a}=r;return Gm({a:o,b:i,transposeA:s,transposeB:a,backend:e})}var $ne={kernelName:Tc,backendName:"webgl",kernelFunc:tVe};var lD=class{constructor(t,e,r,o,i,s){this.outputShape=[],this.variableNames=["x","mean","variance"],T.assertAndGetBroadcastShape(t,e),T.assertAndGetBroadcastShape(t,r);let a="0.0";o!=null&&(T.assertAndGetBroadcastShape(t,o),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="1.0";i!=null&&(T.assertAndGetBroadcastShape(t,i),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=t,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${a};
        float scale = ${l};
        float inv = scale * inversesqrt(variance + float(${s}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}};var cD=class{constructor(t,e,r,o,i,s){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],T.assertAndGetBroadcastShape(t,e),T.assertAndGetBroadcastShape(t,r);let a="vec4(0.0)";o!=null&&(T.assertAndGetBroadcastShape(t,o),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="vec4(1.0)";i!=null&&(T.assertAndGetBroadcastShape(t,i),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=t,this.userCode=`
      void main() {
        vec4 offset = ${a};
        vec4 scale = ${l};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${s}));

        setOutput((x - mean) * inv + offset);
      }
    `}};var nVe=({inputs:n,backend:t,attrs:e})=>{let{x:r,mean:o,variance:i,offset:s,scale:a}=n;b.assert(o.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),b.assert(s==null||o.shape.length===s.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),b.assert(a==null||o.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:l}=e;l==null&&(l=.001);let c=[r,o,i],u=null;s!=null&&(u=s.shape,c.push(s));let d=null;a!=null&&(d=a.shape,c.push(a));let p=q().getBool("WEBGL_PACK_NORMALIZATION")?new cD(r.shape,o.shape,i.shape,u,d,l):new lD(r.shape,o.shape,i.shape,u,d,l);return t.runWebGLProgram(p,c,c[0].dtype)},Vne={kernelName:$c,backendName:"webgl",kernelFunc:nVe};var uD=class{constructor(t){this.variableNames=["source"],this.outputShape=t,this.rank=t.length;let e=vt(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];let r=rVe(this.rank),o,i=t.map((s,a)=>`sourceLoc.${a3[a]} = start[${a}] + coords.${a3[a]};`);o=`
        ${e} sourceLoc;
        ${e} coords = getOutputCoords();
        ${i.join(`
`)}
      `,this.userCode=`
      void main() {
        ${o}
        setOutput(getSource(${r}));
      }
    `}},a3=["x","y","z","w","u","v"];function rVe(n){if(n===1)return"sourceLoc";if(n<=6)return a3.slice(0,n).map(t=>"sourceLoc."+t).join(",");throw Error(`Slicing for rank ${n} is not yet supported`)}var dD=class{constructor(t){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];let e=vt(this.rank),r=Cr("coords",this.rank),o=Cr("sourceLoc",this.rank),i=this.rank===1?"sourceLoc":`vec2(${o.slice(-2).join()})`,s=`getChannel(getSource(${o.join()}), ${i})`,a=`
      result.x = ${s};
      if (++${r[this.rank-1]} < ${t[this.rank-1]}) {
        ++${o[this.rank-1]};
        result.y = ${s};
        --${o[this.rank-1]};
      }
    `,l=this.rank===1?"":`
      --${r[this.rank-1]};
      if (++${r[this.rank-2]} < ${t[this.rank-2]}) {
        ++${o[this.rank-2]};
        result.z = ${s};
        if (++${r[this.rank-1]} < ${t[this.rank-1]}) {
          ++${o[this.rank-1]};
          result.w = ${s};
        }
      }
    `,c=this.rank<=4?`sourceLoc = coords +
            ${e}(${t.map((u,d)=>`start[${d}]`).join()});`:t.map((u,d)=>`${o[d]} = ${r[d]} + start[${d}];`).join(`
`);this.userCode=`
      void main() {
        ${e} coords = getOutputCoords();
        ${e} sourceLoc;
        ${c}
        vec4 result = vec4(0.);
        ${a}
        ${l}
        setOutput(result);
      }
    `}};function oVe(n,t,e,r){let o=r.texData.get(n.dataId),i=r.makeTensorInfo(e,n.dtype),s=r.texData.get(i.dataId);Object.assign(s,o),s.refCount=1,s.shape=e,s.dtype=n.dtype;let a=yr.computeFlatOffset(t,b.computeStrides(n.shape));o.slice&&(a+=o.slice.flatOffset),s.slice={flatOffset:a,origDataId:o.slice&&o.slice.origDataId||n.dataId};let l=r.dataRefCount.get(s.slice.origDataId)||1;return r.dataRefCount.set(s.slice.origDataId,l+1),i}function Wl(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{begin:i,size:s}=r,[a,l]=yr.parseSliceParams(o,i,s);if(yr.assertParamsValid(o,a,l),b.sizeFromShape(l)===0)return e.makeTensorInfo(l,o.dtype,[]);if(e.shouldExecuteOnCPU([o])||o.dtype==="string"){let d=e.texData.get(o.dataId),p=kte(d.values,a,l,o.shape,o.dtype);return e.makeTensorInfo(l,o.dtype,p)}let{isPacked:c}=e.texData.get(o.dataId),u=yr.isSliceContinous(o.shape,a,l);if(c||!u){let d=q().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new dD(l):new uD(l),p=[a];return e.runWebGLProgram(d,[o],o.dtype,p)}return e.uploadToGPU(o.dataId),oVe(o,a,l,e)}var Bne={kernelName:su,backendName:"webgl",kernelFunc:Wl};var iVe=n=>{let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{blockShape:i,crops:s}=r;b.assert(o.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");let a=i.reduce((v,w)=>v*w),l=T.getReshaped(o.shape,i,a),c=T.getPermuted(l.length,i.length),u=T.getReshapedPermuted(o.shape,i,a),d=T.getSliceBeginCoords(s,i.length),p=T.getSliceSize(u,s,i.length),f=[],h=Ee({inputs:{x:o},backend:e,attrs:{shape:l}}),m=Yn({inputs:{x:h},backend:e,attrs:{perm:c}}),g=Ee({inputs:{x:m},backend:e,attrs:{shape:u}}),y=Wl({inputs:{x:g},backend:e,attrs:{begin:d,size:p}});return f.push(h),f.push(m),f.push(g),f.forEach(v=>e.disposeIntermediateTensorInfo(v)),y},zne={kernelName:Dc,backendName:"webgl",kernelFunc:iVe};function sVe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,weights:i}=t,{size:s}=r,a=e.readSync(o.dataId),l=e.readSync(i.dataId),c=GT(a,l,i.dtype,i.shape,s);return e.makeTensorInfo([s],i.dtype,c)}var Une={kernelName:Ap,backendName:"webgl",kernelFunc:sVe};var aVe=`
  int r = int(a.r) & int(b.r);
  int g = int(a.g) & int(b.g);
  int rb = int(a.b) & int(b.b);
  int ra = int(a.a) & int(b.a);
  return vec4(r, g, rb, ra);
`,lVe=`
  return float(int(a.r) & int(b.r));
`;function cVe(n){let{inputs:t,backend:e}=n,{a:r,b:o}=t,i=q().getBool("WEBGL_PACK_BINARY_OPERATIONS"),s=q().getNumber("WEBGL_VERSION");if(e.shouldExecuteOnCPU([r,o])||s===1){let l=e.texData.get(r.dataId).values,c=e.texData.get(o.dataId).values,[u,d]=Jee(r.shape,o.shape,l,c,r.dtype),p=e.makeTensorInfo(d,r.dtype),f=e.texData.get(p.dataId);return f.values=u,p}let a;return i?a=new Zi(aVe,r.shape,o.shape,!1):a=new Ci(lVe,r.shape,o.shape),e.runWebGLProgram(a,[r,o],r.dtype)}var Wne={kernelName:Kh,backendName:"webgl",kernelFunc:cVe};function uVe(n){let{inputs:t,backend:e}=n,{s0:r,s1:o}=t,i=e.readSync(r.dataId),s=e.readSync(o.dataId),a=T.assertAndGetBroadcastShape(Array.from(i),Array.from(s));return e.makeTensorInfo([a.length],"int32",Int32Array.from(a))}var Gne={kernelName:Rp,backendName:"webgl",kernelFunc:uVe};var dVe="return float(a != b);",l3=un({opSnippet:dVe,cpuKernelImpl:bte,dtype:"bool"}),jne={kernelName:Sd,backendName:"webgl",kernelFunc:l3};function Yd(n){let{inputs:t,backend:e}=n,{input:r}=t,o=e.texData.get(r.dataId);return _r({inputs:{x:o.complexTensorInfos.real},backend:e})}var Hne={kernelName:lf,backendName:"webgl",kernelFunc:Yd};var pVe="return float(int(x));";function qne(n,t){let e=new go(n.shape,pVe),r=t.runWebGLProgram(e,[n],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}function c3(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{dtype:i}=r;if(i==="complex64"){if(o.dtype==="complex64")return _r({inputs:{x:o},backend:e});let s=hn(o.shape),a=c3({inputs:{x:o},backend:e,attrs:{dtype:"float32"}}),l=_i({inputs:{real:a,imag:s},backend:e});return s.dispose(),e.disposeIntermediateTensorInfo(a),l}if(o.dtype==="complex64"){let s=Yd({inputs:{input:o},backend:e}),a=c3({inputs:{x:s},backend:e,attrs:{dtype:i}});return e.disposeIntermediateTensorInfo(s),a}if(!b.hasEncodingLoss(o.dtype,i)){let s=_r({inputs:{x:o},backend:e});return{dataId:s.dataId,shape:s.shape,dtype:i}}if(e.shouldExecuteOnCPU([o])){let s=e.texData.get(o.dataId).values,[a,l,c]=ete(s,o.shape,o.dtype,i);return e.makeTensorInfo(a,l,c)}if(i==="int32")return qne(o,e);if(i==="bool"){let s=e.makeTensorInfo([],"bool",b.getTypedArrayFromDType("bool",1)),l=l3({inputs:{a:o,b:s},backend:e});return e.disposeIntermediateTensorInfo(s),l}throw new Error(`Error in Cast: failed to cast ${o.dtype} to ${i}`)}var Kne={kernelName:$s,backendName:"webgl",kernelFunc:c3};var Xne="return ceil(x);",fVe=Ze({opSnippet:Xne,packedOpSnippet:Xne,cpuKernelImpl:tte}),Yne={kernelName:Ba,backendName:"webgl",kernelFunc:fVe};var pD=class{constructor(t){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}};var fD=class{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}};function hVe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{clipValueMin:i,clipValueMax:s}=r,a;q().getBool("WEBGL_PACK_CLIP")?a=new fD(o.shape):a=new pD(o.shape);let l=[[i],[s]];return e.runWebGLProgram(a,[o],o.dtype,l)}var Zne={kernelName:za,backendName:"webgl",kernelFunc:hVe};var hD=class{constructor(t){this.variableNames=["real","imag"],this.outputShape=t,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}};function Qne(n,t){return{dataId:t.dataId,dtype:t.dtype,shape:n.shape}}function mVe(n){let{inputs:t,backend:e}=n,{x:r}=t,o=e.texData.get(r.dataId),i=new hD(r.shape),s=[Qne(r,o.complexTensorInfos.real),Qne(r,o.complexTensorInfos.imag)];return e.runWebGLProgram(i,s,s[0].dtype)}var Jne={kernelName:kc,backendName:"webgl",kernelFunc:mVe};var mD=class{constructor(t){this.outputShape=[],this.outputShape=T.computeOutShape(t,1),this.variableNames=t.map((s,a)=>`T${a}`);let e=new Array(t.length-1);e[0]=t[0][1];for(let s=1;s<e.length;s++)e[s]=e[s-1]+t[s][1];let r=[`if (yC < ${e[0]}) setOutput(getT0(yR, yC));`];for(let s=1;s<e.length;s++){let a=e[s-1];r.push(`else if (yC < ${e[s]}) setOutput(getT${s}(yR, yC-${a}));`)}let o=e.length,i=e[e.length-1];r.push(`else setOutput(getT${o}(yR, yC-${i}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${r.join(`
        `)}
      }
    `}};var yD=class{constructor(t,e){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=T.computeOutShape(t,e);let r=this.outputShape,o=r.length,i=vt(o),s=Cr("coords",o),a=["x","y","z","w","u","v"].slice(0,o);this.variableNames=t.map((m,g)=>`T${g}`);let l=new Array(t.length-1);l[0]=t[0][e];for(let m=1;m<l.length;m++)l[m]=l[m-1]+t[m][e];let c=a[e],u=a.slice(-2),d=a.join(),p=`if (${c} < ${l[0]}) {
        return getChannel(
            getT0(${d}), vec2(${u.join()}));
        }`;for(let m=1;m<l.length;m++){let g=l[m-1];p+=`
        if (${c} < ${l[m]}  && ${c} >= ${l[m-1]}) {
          return getChannel(
            getT${m}(${gD(a,c,g)}),
            vec2(${gD(u,c,g)}));
        }`}let f=l.length,h=l[l.length-1];p+=`
        return getChannel(
          getT${f}(${gD(a,c,h)}),
          vec2(${gD(u,c,h)}));`,this.userCode=`
      float getValue(${a.map(m=>"int "+m)}) {
        ${p}
      }

      void main() {
        ${i} coords = getOutputCoords();
        vec4 result = vec4(getValue(${s}), 0., 0., 0.);

        ${s[o-1]} = ${s[o-1]} + 1;
        if (${s[o-1]} < ${r[o-1]}) {
          result.g = getValue(${s});
        }

        ${s[o-2]} = ${s[o-2]} + 1;
        if (${s[o-2]} < ${r[o-2]}) {
          result.a = getValue(${s});
        }

        ${s[o-1]} = ${s[o-1]} - 1;
        if (${s[o-2]} < ${r[o-2]} &&
            ${s[o-1]} < ${r[o-1]}) {
          result.b = getValue(${s});
        }
        setOutput(result);
      }
    `}};function gD(n,t,e){let r=n.indexOf(t);return n.map((i,s)=>s===r?`${i} - ${e}`:i).join()}function jm(n){let{inputs:t,backend:e}=n,{input:r}=t,o=e.texData.get(r.dataId);return _r({inputs:{x:o.complexTensorInfos.imag},backend:e})}var ere={kernelName:Zp,backendName:"webgl",kernelFunc:jm};function lv(n,t,e){let r=n[0].dtype;if(r==="complex64"){let f=n.map(v=>Yd({inputs:{input:v},backend:e})),h=n.map(v=>jm({inputs:{input:v},backend:e})),m=lv(f,t,e),g=lv(h,t,e),y=_i({inputs:{real:m,imag:g},backend:e});return f.forEach(v=>e.disposeIntermediateTensorInfo(v)),h.forEach(v=>e.disposeIntermediateTensorInfo(v)),e.disposeIntermediateTensorInfo(m),e.disposeIntermediateTensorInfo(g),y}let o=e.shouldExecuteOnCPU(n);if(r==="string"&&(o=!0),o){let f=n.map(C=>{let A=[-1,b.sizeFromShape(C.shape.slice(t))];return Ee({inputs:{x:C},backend:e,attrs:{shape:A}})}),h=f.map(C=>({vals:e.readSync(C.dataId),shape:C.shape})),m=T.computeOutShape(f.map(C=>C.shape),1),g=f[0].shape[0]===1,y=nte(h,m,r,g),v=T.computeOutShape(n.map(C=>C.shape),t),w=e.makeTensorInfo(v,r,y);return f.forEach(C=>e.disposeIntermediateTensorInfo(C)),w}let i=n.filter(f=>b.sizeFromShape(f.shape)>0),s=q().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&i[0].shape.length>1;if(i.length===1){let f=s?new go(n[0].shape,Ru):new wi(n[0].shape,Ru);return e.runWebGLProgram(f,n,r)}let a=q().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(i.length>a){let f=[];for(let m=0;m<i.length;m+=a){let g=i.slice(m,m+a);f.push(lv(g,t,e))}let h=lv(f,t,e);for(let m of f)e.disposeIntermediateTensorInfo(m);return h}if(s){let f=new yD(i.map(h=>h.shape),t);return e.runWebGLProgram(f,i,r)}let{tensors2D:l,outShape:c}=gVe(i,t,e),u=new mD(l.map(f=>f.shape)),d=e.runWebGLProgram(u,l,r);l.forEach(f=>e.disposeIntermediateTensorInfo(f));let p=Ee({inputs:{x:d},attrs:{shape:c},backend:e});return e.disposeIntermediateTensorInfo(d),p}function gVe(n,t,e){let r=T.computeOutShape(n.map(i=>i.shape),t);return{tensors2D:n.map(i=>Ee({inputs:{x:i},attrs:{shape:[-1,b.sizeFromShape(i.shape.slice(t))]},backend:e})),outShape:r}}function u3(n){let{inputs:t,backend:e,attrs:r}=n,{axis:o}=r,i=b.parseAxisParam(o,t[0].shape)[0],s=t.map(c=>c.shape);T.assertParamsConsistent(s,i);let a=T.computeOutShape(t.map(c=>c.shape),i);if(b.sizeFromShape(a)===0)return e.makeTensorInfo(a,t[0].dtype,[]);let l=t.filter(c=>b.sizeFromShape(c.shape)>0);return l.length===1?_r({inputs:{x:l[0]},backend:e}):lv(l,i,e)}var tre={kernelName:Nc,backendName:"webgl",kernelFunc:u3};var cv=class{constructor(t,e=!1,r=null,o=!1,i=!1){this.variableNames=["x","W"],this.outputShape=t.outShape;let s=t.padInfo.top,a=t.padInfo.left,l=t.strideHeight,c=t.strideWidth,u=t.dilationHeight,d=t.dilationWidth,p=t.filterHeight,f=t.filterWidth,h=Math.floor(t.inChannels/4)*4,m=t.inChannels%4,g=t.dataFormat==="channelsLast",y=g?1:2,v=g?2:3,w=g?3:1,C="",I="";r&&(o?C=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:i?C=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:C=`
          float activation(float x) {
            ${r}
          }
        `,I="result = activation(result);");let A=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${C}

      const ivec2 strides = ivec2(${l}, ${c});
      const ivec2 pads = ivec2(${s}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${w}];

        ivec2 xRCCorner =
            ivec2(coords[${y}], coords[${v}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${p}; wR++) {
          int xR = xRCorner + wR * ${u};

          if (xR < 0 || xR >= ${t.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${f}; wC++) {
            int xC = xCCorner + wC * ${d};

            if (xC < 0 || xC >= ${t.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${h}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${g}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${m===1}) {

              if (${g}) {
                dotProd +=
                    getX(batch, xR, xC, ${h}) *
                    getW(wR, wC, ${h}, d2);
              } else {
                dotProd +=
                    getX(batch, ${h}, xR, xC) *
                    getW(wR, wC, ${h}, d2);
              }

            } else if (${m===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${h}, d2),
                getW(wR, wC, ${h} + 1, d2)
              );

              if (${g}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${h}),
                  getX(batch, xR, xC, ${h} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${h}, xR, xC),
                  getX(batch, ${h} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${m===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${h}, d2),
                getW(wR, wC, ${h} + 1, d2),
                getW(wR, wC, ${h} + 2, d2)
              );

              if (${g}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${h}),
                  getX(batch, xR, xC, ${h} + 1),
                  getX(batch, xR, xC, ${h} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${h}, xR, xC),
                  getX(batch, ${h} + 1, xR, xC),
                  getX(batch, ${h} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${A}
        ${I}
        setOutput(result);
      }
    `}},xD=class{constructor(t){this.variableNames=["x","W"],this.outputShape=t.outShape;let e=t.padInfo.front,r=t.padInfo.top,o=t.padInfo.left,i=t.strideDepth,s=t.strideHeight,a=t.strideWidth,l=t.dilationDepth,c=t.dilationHeight,u=t.dilationWidth,d=t.filterDepth,p=t.filterHeight,f=t.filterWidth,h=Math.floor(t.inChannels/4)*4,m=t.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${i}, ${s}, ${a});
      const ivec3 pads = ivec3(${e}, ${r}, ${o});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${d}; wF++) {
          int xF = xFCorner + wF * ${l};

          if (xF < 0 || xF >= ${t.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${p}; wR++) {
            int xR = xRCorner + wR * ${c};

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${f}; wC++) {
              int xC = xCCorner + wC * ${u};

              if (xC < 0 || xC >= ${t.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${h}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${m===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${h}) *
                  getW(wF, wR, wC, ${h}, d2);
              } else if (${m===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${h}),
                  getX(batch, xF, xR, xC, ${h} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${h}, d2),
                  getW(wF, wR, wC, ${h} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${m===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${h}),
                  getX(batch, xF, xR, xC, ${h} + 1),
                  getX(batch, xF, xR, xC, ${h} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${h}, d2),
                  getW(wF, wR, wC, ${h} + 1, d2),
                  getW(wF, wR, wC, ${h} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}};var uv=class{constructor(t,e=!1,r=null,o=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=vn(this.outputShape.length);let s=t.padInfo.left,a=t.strideWidth,l=t.dilationWidth,c=t.filterHeight,u=t.filterWidth,d=u,p=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let g=0;g<u;g++)p+=`
           vec4 xTexelC${g*2};
           int xTexelC${g*2}Ready;
           vec4 xTexelC${g*2+1};
           int xTexelC${g*2+1}Ready;
           vec4 xC${g};`;p+=`
     for (int r = 0; r < ${c}; r++) {
      for (int d1 = 0; d1 < ${t.inChannels}; d1 += 2) {
       `;for(let g=0;g<u;g++)p+=`
           xTexelC${g*2} = vec4(0.0);
           xTexelC${g*2}Ready = 0;
           xTexelC${g*2+1} = vec4(0.0);
           xTexelC${g*2+1}Ready = 0;
           xC${g} = vec4(0.0);`;p+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let g=0;g<(d+1)/2;g++){let y=g*2;if(p+=`
           xC = xCCorner + ${y*l};
           `,a===1){if(y<u&&(s%2===1?(p+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }
               `,l===1&&y>0?p+=`
                 xC${y} = vec4(xTexelC${y-2}.zw, xTexelC${y}.xy);
                 `:p+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${y} = vec4(previous.zw, xTexelC${y}.xy);
                   } else {
                     xC${y} = vec4(0.0, 0.0, xTexelC${y}.xy);
                   }
                   `):p+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }

                 xC${y} = xTexelC${y};
                 `,y+1<u)){let v=s%2===0?b.nearestLargerEven(l):l;l%2===0&&s%2===1||l%2!==0&&s%2!==1?(p+=`
                   xCOffset = xC + imod(pads[1], 2) + ${v};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                     xTexelC${y+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${y+1}.zw = vec2(0.0);
                     }
                     xTexelC${y+1}Ready = 1;
                   }
                   `,l>1?p+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${y+1} = vec4(previous.zw, xTexelC${y+1}.xy);
                     } else {
                      xC${y+1} = vec4(0.0, 0.0, xTexelC${y+1}.xy);
                     }
                     `:p+=`
                     xC${y+1} = vec4(xTexelC${y}.zw, xTexelC${y+1}.xy);
                     `):v===1?p+=`
                     xC${y+1} = xTexelC${y};
                     `:p+=`
                     xCOffset = xC + ${v};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                       xTexelC${y+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${y+1}.zw = vec2(0.0);
                       }
                       xTexelC${y+1}Ready = 1;
                     }

                     xC${y+1} = xTexelC${y+1};
                     `}}else y<u&&(s%2===1?(p+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${y+1}Ready == 0) {
                   xTexelC${y+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${y+1}.zw = vec2(0.0);
                   }
                   xTexelC${y+1}Ready = 1;
                 }

                 xC${y} = vec4(xTexelC${y}.zw, xTexelC${y+1}.zw);
               `,y+1<u&&(p+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${y+1} = vec4(xTexelC${y+1}.xy, final.xy);
                 `)):(p+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                   xTexelC${y+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${y+1}.zw = vec2(0.);
                   }
                   xTexelC${y+1}Ready = 1;
                 }

                 xC${y} = vec4(
                   xTexelC${y}.xy, xTexelC${y+1}.xy);
               `,y+1<u&&(p+=`
                   xC${y+1} = vec4(xTexelC${y}.zw, xTexelC${y+1}.zw);
                 `)));y<u&&(p+=`
             wTexel = getW(r, ${y}, d1, d2);
             dotProd += xC${y}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${t.inChannels}) {
               dotProd += xC${y}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,y+1<u&&(p+=`
               wTexel = getW(r, ${y+1}, d1, d2);
               dotProd += xC${y+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${t.inChannels}) {
                 dotProd += xC${y+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}p+=`
     }
   `,p+=`
     }
   `,p+=`
     }
   `;let f="",h="";r&&(o?f=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${r}
         }`:i?f=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${r}
         }`:f=`vec4 activation(vec4 x) {
           ${r}
         }`,h="result = activation(result);");let m=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${f}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${p}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${m}
         ${h}
         setOutput(result);
       }
     `}};var vD=class{constructor(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=t,this.enableShapeUniforms=vn(this.outputShape.length);let{dataFormat:r}=e,o=ur(),i=r==="channelsLast",s=i?1:2,a=i?2:3,l=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${t[2]} && pos < ${t[1]}) {`,c="";for(let u=0;u<=1;u++)for(let d=0;d<=1;d++)c+=`
          blockIndex = rc.z + ${d};
          pos = rc.y + ${u};

          ${l}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${s}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${a}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${i}) {
                  innerDims = vec2(d1, ch);
                  result[${u*2+d}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${u*2+d}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${c}

        ${o.output} = result;
      }
    `}};function bD(n,t){let e=n.length;return e>=3?t?[...n.slice(0,-3),n[e-3]*n[e-2],n[e-1]]:[...n.slice(0,-3),n[e-3],n[e-2]*n[e-1]]:!t&&e===1&&n[0]>1?[n[0],1]:null}function wD({x:n,filter:t,convInfo:e,backend:r,bias:o=null,preluActivationWeights:i=null,leakyreluAlpha:s=0,activation:a=null}){let l=n.shape,c=r.texData.get(n.dataId),u=e.inChannels,d=l[0]*l[1]*l[2],p=e.outChannels,f=e.dataFormat==="channelsLast",h=!1,m=!1,g,y=[];if(i!=null){let C=bD(i.shape,f);C!=null&&(i=Ee({inputs:{x:i},backend:r,attrs:{shape:C}}),y.push(i))}if(o!=null){let C=bD(o.shape,f);C!=null&&(o=Ee({inputs:{x:o},backend:r,attrs:{shape:C}}),y.push(o))}if(!((d===1||p===1)&&u>s3)&&c.isPacked&&f&&c.texture!=null&&l[2]%2!==0&&b.arraysEqual(c.shape.slice(-3),l.slice(-3))){let C=l[0]*l[1]*(l[2]+1),I={dataId:n.dataId,shape:[1,C,e.inChannels],dtype:n.dtype},A=c.shape;c.shape=c.shape.slice(),c.shape[c.shape.length-2]++,b.assert(Vm(c.shape,I.shape),()=>`packed reshape ${c.shape} to ${I.shape} isn't free`);let M=Ee({inputs:{x:t},backend:r,attrs:{shape:[1,e.inChannels,e.outChannels]}});y.push(M);let $=Gm({a:I,b:M,backend:r,transposeA:h,transposeB:m,bias:o,activation:a,preluActivationWeights:i,leakyreluAlpha:s}),V=r.texData.get($.dataId);b.assert(V.isPacked,()=>"batchMatMul result is expected to be packed"),c.shape=A,V.shape=e.outShape,g=_r({inputs:{x:$},backend:r}),g.shape=e.outShape,y.push($)}else{let C=e.outHeight*e.outWidth,I=Ee({inputs:{x:n},backend:r,attrs:{shape:f?[e.batchSize,C,e.inChannels]:[e.batchSize,e.inChannels,C]}}),A=Ee({inputs:{x:t},backend:r,attrs:{shape:[1,e.inChannels,e.outChannels]}}),M=Gm({a:f?I:A,b:f?A:I,transposeA:!f,transposeB:m,backend:r,bias:o,activation:a,preluActivationWeights:i,leakyreluAlpha:s});g=Ee({inputs:{x:M},backend:r,attrs:{shape:e.outShape}}),y.push(I),y.push(A),y.push(M)}for(let C of y)r.disposeIntermediateTensorInfo(C);return g}function CD({x:n,filter:t,convInfo:e,backend:r,bias:o=null,preluActivationWeights:i=null,leakyreluAlpha:s=0,activation:a=null}){let{filterWidth:l,filterHeight:c,inChannels:u,outWidth:d,outHeight:p,dataFormat:f}=e,h=f==="channelsLast",m=l*c*u,g=p*d,y=[e.batchSize,m,g],v=!0,w=!1,C=[];if(i!=null){let ue=bD(i.shape,h);ue!=null&&(i=Ee({inputs:{x:i},backend:r,attrs:{shape:ue}}),C.push(i))}if(o!=null){let ue=bD(o.shape,h);ue!=null&&(o=Ee({inputs:{x:o},backend:r,attrs:{shape:ue}}),C.push(o))}let I=Ee({inputs:{x:t},backend:r,attrs:{shape:[1,m,b.sizeFromShape(t.shape)/m]}});C.push(I);let A=new vD(y,e),M=[n.shape,[e.padInfo.top,e.padInfo.left],[e.strideHeight,e.strideWidth],[e.dilationHeight,e.dilationWidth],[e.inChannels],[e.filterWidth*e.inChannels],[e.outWidth]],$=r.runWebGLProgram(A,[n],"float32",M),V=Ee({inputs:{x:$},backend:r,attrs:{shape:y}});C.push($),C.push(V);let W=o!=null,K=i!=null,te=a==="leakyrelu",ee=a?Xd(a,!0):null,oe=new av(h?V.shape:I.shape,h?I.shape:V.shape,h?[e.batchSize,g,e.outChannels]:[e.batchSize,e.outChannels,g],v,w,W,ee,K,te),ie=h?[V,I]:[I,V];if(o&&ie.push(o),K&&ie.push(i),te){let ue=r.makeTensorInfo([],"float32",b.createScalarValue(s,"float32"));ie.push(ue),C.push(ue)}let se=r.runWebGLProgram(oe,ie,"float32"),fe=Ee({inputs:{x:se},backend:r,attrs:{shape:e.outShape}});C.push(se);for(let ue of C)r.disposeIntermediateTensorInfo(ue);return fe}function yVe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,filter:i}=t,{strides:s,pad:a,dataFormat:l,dilations:c,dimRoundingMode:u}=r,d=T.convertConv2DDataFormat(l),p=T.computeConv2DInfo(o.shape,i.shape,s,c,a,u,!1,d),f;if(p.filterHeight===1&&p.filterWidth===1&&p.dilationHeight===1&&p.dilationWidth===1&&p.strideHeight===1&&p.strideWidth===1&&(p.padInfo.type==="SAME"||p.padInfo.type==="VALID"))f=wD({x:o,filter:i,convInfo:p,backend:e});else if(p.strideWidth<=2&&d==="channelsLast"&&q().getBool("WEBGL_EXP_CONV")){let m=new uv(p),g=[[p.padInfo.top,p.padInfo.left],[p.strideHeight,p.strideWidth],[p.dilationHeight,p.dilationWidth],[p.inHeight,p.inWidth]];f=e.runWebGLProgram(m,[o,i],"float32",g)}else if(q().getBool("WEBGL_CONV_IM2COL"))f=CD({x:o,filter:i,convInfo:p,backend:e});else{let m=new cv(p);f=e.runWebGLProgram(m,[o,i],"float32")}let h=Ee({inputs:{x:f},backend:e,attrs:{shape:p.outShape}});return e.disposeIntermediateTensorInfo(f),h}var nre={kernelName:Ac,backendName:"webgl",kernelFunc:yVe};var _D=class{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;let e=t.strideHeight,r=t.strideWidth,o=t.padInfo.top,i=t.padInfo.left,s=t.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${t.batchSize}; b++) {
          for (int yR = 0; yR < ${t.outHeight}; yR++) {
            int xR = wR + yR * ${e} - ${o};

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${t.outWidth}; yC++) {
              int xC = wC + yC * ${r} - ${i};

              if (xC < 0 || xC >= ${t.inWidth}) {
                continue;
              }

              ${s?`float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);`:`float dyValue = getDy(b, d2, yR, yC);
              float xValue = getX(b, d1, xR, xC);
              dotProd += (xValue * dyValue);`}
            }
          }
        }
        setOutput(dotProd);
      }
    `}},SD=class{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;let e=t.filterHeight,r=t.filterWidth,o=t.strideHeight,i=t.strideWidth,s=t.dataFormat==="channelsLast",a=e-1-t.padInfo.top,l=r-1-t.padInfo.left,c=s?1:2,u=s?2:3,d=s?3:1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${d}];

        ivec2 dyCorner = ivec2(coords[${c}], coords[${u}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${e}; wR++) {
          float dyR = float(dyRCorner + wR) / ${o}.0;

          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${e} - 1 - wR;

          for (int wC = 0; wC < ${r}; wC++) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${r} - 1 - wC;

            for (int d2 = 0; d2 < ${t.outChannels}; d2++) {

              if (${s}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}},ID=class{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;let e=t.strideDepth,r=t.strideHeight,o=t.strideWidth,i=t.padInfo.front,s=t.padInfo.top,a=t.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${t.batchSize}; b++) {
          for (int yF = 0; yF < ${t.outDepth}; yF++) {
            int xF = wF + yF * ${e} - ${i};

            if (xF < 0 || xF >= ${t.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${t.outHeight}; yR++) {
              int xR = wR + yR * ${r} - ${s};

              if (xR < 0 || xR >= ${t.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${t.outWidth}; yC++) {
                int xC = wC + yC * ${o} - ${a};

                if (xC < 0 || xC >= ${t.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}},ED=class{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;let e=t.filterDepth,r=t.filterHeight,o=t.filterWidth,i=t.strideDepth,s=t.strideHeight,a=t.strideWidth,l=e-1-t.padInfo.front,c=r-1-t.padInfo.top,u=o-1-t.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${l}, ${c}, ${u});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${e}; wF++) {
          float dyF = float(dyFCorner + wF) / ${i}.0;

          if (dyF < 0.0 || dyF >= ${t.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${e} - 1 - wF;

          for (int wR = 0; wR < ${r}; wR++) {
            float dyR = float(dyRCorner + wR) / ${s}.0;

            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${r} - 1 - wR;

            for (int wC = 0; wC < ${o}; wC++) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${o} - 1 - wC;

              for (int d2 = 0; d2 < ${t.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}};function xVe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,dy:i}=t,{strides:s,pad:a,dataFormat:l,dimRoundingMode:c,filterShape:u}=r,d=T.convertConv2DDataFormat(l),p=T.computeConv2DInfo(o.shape,u,s,1,a,c,!1,d),f=new _D(p);return e.runWebGLProgram(f,[o,i],"float32")}var rre={kernelName:Mp,backendName:"webgl",kernelFunc:xVe};var TD=class{constructor(t){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=t.inShape,this.enableShapeUniforms=vn(this.outputShape.length);let e=t.filterHeight,r=t.filterWidth,o=e-1-t.padInfo.top,i=r-1-t.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(${o}, ${i});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        vec4 result = vec4(0.);
        for (int wR = 0; wR < ${e}; wR++) {
          float dyR = float(dyRCorner + wR) / strides[0];
          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);
          int wRPerm = ${e} - 1 - wR;

          for (int wC = 0; wC < ${r}; wC++) {
            int wCPerm = ${r} - 1 - wC;

            float dyC = float(dyCCorner + wC) / strides[1];
            bool idyCVal = (dyC >= 0.0) && (dyC < ${t.outWidth}.0)
              && (fract(dyC) == 0.0);
            int idyC = int(dyC);

            float dyC2 = float(dyCCorner + wC + 1) / strides[1];
            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${t.outWidth}.0)
              && (fract(dyC2) == 0.0);
            int idyC2 = int(dyC2);

            if (idyCVal && idyCVal2) {
              for (int d2 = 0; d2 < ${t.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?
                  dySample : getDy(batch, idyR, idyC2, d2);

                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));

                dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample2.xy : dySample2.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal) {
              for (int d2 = 0; d2 < ${t.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal2) {
              for (int d2 = 0; d2 < ${t.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC2, d2);
                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            }
          }
        }
        setOutput(result);
      }
    `}};function vVe(n){let{inputs:t,backend:e,attrs:r}=n,{dy:o,filter:i}=t,{inputShape:s,strides:a,pad:l,dataFormat:c,dimRoundingMode:u}=r,d=T.convertConv2DDataFormat(c),p=T.computeConv2DInfo(s,i.shape,a,1,l,u,!1,d);if(q().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&d==="channelsLast"){let f=[[p.strideHeight,p.strideWidth]],h=new TD(p);return e.runWebGLProgram(h,[o,i],"float32",f)}else{let f=new SD(p);return e.runWebGLProgram(f,[o,i],"float32")}}var ore={kernelName:Rc,backendName:"webgl",kernelFunc:vVe};function bVe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,filter:i}=t,{strides:s,pad:a,dilations:l}=r,c=T.computeConv3DInfo(o.shape,i.shape,s,l,a),u=new xD(c);return e.runWebGLProgram(u,[o,i],"float32")}var ire={kernelName:Oc,backendName:"webgl",kernelFunc:bVe};function wVe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,dy:i}=t,{strides:s,pad:a,filterShape:l}=r,c=T.computeConv3DInfo(o.shape,l,s,1,a),u=new ID(c);return e.runWebGLProgram(u,[o,i],"float32")}var sre={kernelName:Pp,backendName:"webgl",kernelFunc:wVe};function CVe(n){let{inputs:t,backend:e,attrs:r}=n,{dy:o,filter:i}=t,{pad:s,strides:a,inputShape:l}=r,c=T.computeConv3DInfo(l,i.shape,a,1,s),u=new ED(c);return e.runWebGLProgram(u,[o,i],"float32")}var are={kernelName:Fp,backendName:"webgl",kernelFunc:CVe};var _Ve=aa+`
  return cos(x);
`,SVe=`
  vec4 result = cos(x);
  bvec4 isNaN = isnan(x);
  ${Qi}
  return result;
`,IVe=Ze({opSnippet:_Ve,packedOpSnippet:SVe}),lre={kernelName:Ua,backendName:"webgl",kernelFunc:IVe};var EVe=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,TVe=Ze({opSnippet:EVe}),cre={kernelName:Wa,backendName:"webgl",kernelFunc:TVe};var DD=class{constructor(t,e,r,o,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];let[s,a,l,c]=t,[u]=e,[d,p]=r;this.outputShape=[u,d,p,c];let f=o==="bilinear"?1:0,[h,m]=[`${a-1}.0`,`${l-1}.0`],[g,y,v]=d>1?[`${(a-1)/(d-1)}`,"(y2-y1) * height_ratio",`y1*${h} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${h}`],[w,C,I]=p>1?[`${(l-1)/(p-1)}`,"(x2-x1) * width_ratio",`x1*${m} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${m}`];this.userCode=`
      const float height_ratio = float(${g});
      const float width_ratio = float(${w});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${s}) {
          return;
        }

        float height_scale = ${y};
        float width_scale = ${C};

        float in_y = ${v};
        if( in_y < 0.0 || in_y > ${h} ) {
          setOutput(float(${i}));
          return;
        }
        float in_x = ${I};
        if( in_x < 0.0 || in_x > ${m} ) {
          setOutput(float(${i}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${f} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}};var DVe=n=>{let{inputs:t,backend:e,attrs:r}=n,{image:o,boxes:i,boxInd:s}=t,{cropSize:a,method:l,extrapolationValue:c}=r,u=new DD(o.shape,i.shape,a,l,c);return e.runWebGLProgram(u,[o,i,s],"float32")},ure={kernelName:$p,backendName:"webgl",kernelFunc:DVe};var dv=function(n){return n.Prod="*",n.Sum="+",n}(dv||{}),Sw=class{constructor(t,e,r,o){this.op=t,this.outputShape=e,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];let i=this.outputShape.length,s=this.op===dv.Prod?"1.0":"0.0",a=r?s:`getX(${dre(i,"coords",this.op)})`,l=this.outputShape[this.outputShape.length-1],c="",u="";r?(c=o?`end != ${l-1}`:"end != 0",u=o?"end + 1":"end - 1"):(c=o?`end + pow2 < ${l}`:"end >= pow2",u=o?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${vt(i)} coords = getOutputCoords();
        int end = ${pre(i,"coords",this.op)};
        float val = ${a};
        int pow2 = int(pow(2.0, index));
        if (${c}) {
          int idx = ${u};
          ${pre(i,"coords",this.op)} = idx;
          val ${this.op}= getX(${dre(i,"coords",this.op)});
        }
        setOutput(val);
      }
    `}};function dre(n,t,e){if(n===1)return`${t}`;if(n===2)return`${t}.x, ${t}.y`;if(n===3)return`${t}.x, ${t}.y, ${t}.z`;if(n===4)return`${t}.x, ${t}.y, ${t}.z, ${t}.w`;throw new Error(`Cumulative ${e} for rank ${n} is not yet supported`)}function pre(n,t,e){if(n===1)return`${t}`;if(n===2)return`${t}.y`;if(n===3)return`${t}.z`;if(n===4)return`${t}.w`;throw new Error(`Cumulative ${e} for rank ${n} is not yet supported`)}function kD(n,t,e,r,o,i){let s=t.shape.length,a=T.getAxesPermutation([r],s),l=t;a!=null&&(l=Yn({inputs:{x:t},backend:e,attrs:{perm:a}}));let c=T.getInnerMostAxes(1,s)[0];if(c!==s-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${t.shape.length-1} but got axis=${r}`);let u=l.shape[c],d=_r({inputs:{x:l},backend:e});for(let p=0;p<=Math.ceil(Math.log2(u))-1;p++){let f=new Sw(n,l.shape,!1,i),h=[[p]],m=d;d=e.runWebGLProgram(f,[d],d.dtype,h),e.disposeIntermediateTensorInfo(m)}if(o){let p=new Sw(n,l.shape,o,i),f=d;d=e.runWebGLProgram(p,[d],d.dtype),e.disposeIntermediateTensorInfo(f)}if(a!=null){let p=T.getUndoAxesPermutation(a),f=Yn({inputs:{x:d},backend:e,attrs:{perm:p}});return e.disposeIntermediateTensorInfo(d),e.disposeIntermediateTensorInfo(l),f}return d}function kVe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{axis:i,exclusive:s,reverse:a}=r;return kD(dv.Prod,o,e,i,s,a)}var fre={kernelName:Lp,backendName:"webgl",kernelFunc:kVe};function NVe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{axis:i,exclusive:s,reverse:a}=r;return kD(dv.Sum,o,e,i,s,a)}var hre={kernelName:Mc,backendName:"webgl",kernelFunc:NVe};function AVe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,weights:i}=t,{size:s,binaryOutput:a}=r;if(o.shape.length===1){let l=e.readSync(o.dataId),c=e.readSync(i.dataId),u=GT(l,c,i.dtype,i.shape,s);return e.makeTensorInfo([s],i.dtype,u)}else if(o.shape.length===2){let l=e.bufferSync(o),c=e.bufferSync(i),u=Qee(l,c,s,a);return e.makeTensorInfo(u.shape,i.dtype,u.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${o.shape.length}.`)}var mre={kernelName:Vp,backendName:"webgl",kernelFunc:AVe};var ND=class{constructor(t,e,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=e,this.dataFormat=r,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${e};
      int offset_h = imod(h, ${e});
      int in_w = w / ${e};
      int offset_w = imod(w, ${e});
      int offset_d = (offset_h * ${e} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}};function RVe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{blockSize:i,dataFormat:s}=r,a=o.shape[0],l=s==="NHWC"?o.shape[1]:o.shape[2],c=s==="NHWC"?o.shape[2]:o.shape[3],u=s==="NHWC"?o.shape[3]:o.shape[1],d=l*i,p=c*i,f=u/(i*i),h=s==="NHWC"?[a,d,p,f]:[a,f,d,p],m=new ND(h,i,s);return e.runWebGLProgram(m,[o],o.dtype)}var gre={kernelName:Bp,backendName:"webgl",kernelFunc:RVe};var pv=class{constructor(t,e=!1,r=null,o=!1,i=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=vn(this.outputShape.length);let s=t.filterHeight,a=t.filterWidth,l=t.outChannels/t.inChannels,c="",u="";r&&(o?c=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:i?c=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:c=`
          float activation(float x) {
            ${r}
          }
        `,u="result = activation(result);");let d=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${c}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${l};
        int q = d2 - d1 * ${l};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${s}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${a}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${d}
        ${u}
        setOutput(result);
      }
    `}};var fv=class{constructor(t,e=!1,r=null,o=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=vn(this.outputShape.length);let s=t.outChannels/t.inChannels,a=t.padInfo.left,l=t.strideWidth,c=t.dilationWidth,u=t.filterHeight,d=t.filterWidth,p=d,f=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let y=0;y<d;y++)f+=`
          vec4 xTexelC${y*2};
          int xTexelC${y*2}Ready;
          vec4 xTexelC${y*2+1};
          int xTexelC${y*2+1}Ready;
          vec4 xC${y};`;f+=`
    for (int r = 0; r < ${u}; r++) {
      `;for(let y=0;y<d;y++)f+=`
          xTexelC${y*2} = vec4(0.0);
          xTexelC${y*2}Ready = 0;
          xTexelC${y*2+1} = vec4(0.0);
          xTexelC${y*2+1}Ready = 0;
          xC${y} = vec4(0.0);`;f+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let y=0;y<(p+1)/2;y++){let v=y*2;if(f+=`
          xC = xCCorner + ${v*c};
          `,l===1){if(v<d&&(a%2===1?(f+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${v}Ready == 0) {
                  xTexelC${v} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${v}.zw = vec2(0.0);
                  }
                  xTexelC${v}Ready = 1;
                }
              `,c===1&&v>0?f+=`
                xC${v} = vec4(xTexelC${v-2}.zw, xTexelC${v}.xy);
                `:f+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${v} = vec4(previous.zw, xTexelC${v}.xy);
                  } else {
                    xC${v} = vec4(0.0, 0.0, xTexelC${v}.xy);
                  }
                  `):f+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${v}Ready == 0) {
                  xTexelC${v} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${v}.zw = vec2(0.0);
                  }
                  xTexelC${v}Ready = 1;
                }

                xC${v} = xTexelC${v};
                `,v+1<d)){let w=a%2===0?b.nearestLargerEven(c):c;c%2===0&&a%2===1||c%2!==0&&a%2!==1?(f+=`
                  xCOffset = xC + imod(pads[1], 2) + ${w};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${v+1}Ready == 0) {
                    xTexelC${v+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${v+1}.zw = vec2(0.0);
                    }
                    xTexelC${v+1}Ready = 1;
                  }
                  `,c>1?f+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${v+1} = vec4(previous.zw, xTexelC${v+1}.xy);
                    } else {
                     xC${v+1} = vec4(0.0, 0.0, xTexelC${v+1}.xy);
                    }
                    `:f+=`
                    xC${v+1} = vec4(xTexelC${v}.zw, xTexelC${v+1}.xy);
                    `):w===1?f+=`
                    xC${v+1} = xTexelC${v};
                    `:f+=`
                    xCOffset = xC + ${w};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${v+1}Ready == 0) {
                      xTexelC${v+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${v+1}.zw = vec2(0.0);
                      }
                      xTexelC${v+1}Ready = 1;
                    }

                    xC${v+1} = xTexelC${v+1};
                    `}}else v<d&&(a%2===1?(f+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${v}Ready == 0) {
                  xTexelC${v} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${v}.zw = vec2(0.0);
                  }
                  xTexelC${v}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${v+1}Ready == 0) {
                  xTexelC${v+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${v+1}.zw = vec2(0.0);
                  }
                  xTexelC${v+1}Ready = 1;
                }

                xC${v} = vec4(xTexelC${v}.zw, xTexelC${v+1}.zw);
              `,v+1<d&&(f+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${v+1} = vec4(xTexelC${v+1}.xy, final.xy);
                `)):(f+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${v}Ready == 0) {
                  xTexelC${v} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${v}.zw = vec2(0.0);
                  }
                  xTexelC${v}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${v+1}Ready == 0) {
                  xTexelC${v+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${v+1}.zw = vec2(0.);
                  }
                  xTexelC${v+1}Ready = 1;
                }

                xC${v} = vec4(
                  xTexelC${v}.xy, xTexelC${v+1}.xy);
              `,v+1<d&&(f+=`
                  xC${v+1} = vec4(xTexelC${v}.zw, xTexelC${v+1}.zw);
                `)));v<d&&(f+=`
            wTexel = getW(r, ${v}, d1, q);
            dotProd += xC${v} * vec4(wTexel.xz, wTexel.xz);
          `,v+1<d&&(f+=`
              wTexel = getW(r, ${v+1}, d1, q);
              dotProd += xC${v+1} * vec4(wTexel.xz, wTexel.xz);
            `))}f+=`
    }
  `,f+=`
      }
    `;let h="",m="";r&&(o?h=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:i?h=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:h=`vec4 activation(vec4 x) {
          ${r}
        }`,m="result = activation(result);");let g=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${h}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${s};
        int q = d2 - d1 * ${s};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${f}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${g}
        ${m}
        setOutput(result);
      }
    `}};function OVe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,filter:i}=t,{strides:s,pad:a,dilations:l,dimRoundingMode:c}=r,u=l;u==null&&(u=[1,1]),b.assert(T.eitherStridesOrDilationsAreOne(s,u),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${s} and dilations '${u}'`);let d=T.computeConv2DInfo(o.shape,i.shape,s,u,a,c,!0),p;q().getBool("WEBGL_PACK_DEPTHWISECONV")&&d.strideWidth<=2&&d.outChannels/d.inChannels===1?p=new fv(d):p=new pv(d);let f=[[d.padInfo.top,d.padInfo.left],[d.strideHeight,d.strideWidth],[d.dilationHeight,d.dilationWidth],[d.inHeight,d.inWidth]];return e.runWebGLProgram(p,[o,i],"float32",f)}var yre={kernelName:Pc,backendName:"webgl",kernelFunc:OVe};var AD=class{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;let e=t.strideHeight,r=t.strideWidth,o=t.padInfo.top,i=t.padInfo.left,s=t.outChannels/t.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${s} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${t.batchSize}; b++) {
          for (int yR = 0; yR < ${t.outHeight}; yR++) {
            int xR = wR + yR * ${e} - ${o};

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${t.outWidth}; yC++) {
              int xC = wC + yC * ${r} - ${i};

              if (xC < 0 || xC >= ${t.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}},RD=class{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;let e=t.filterHeight,r=t.filterWidth,o=t.strideHeight,i=t.strideWidth,s=e-1-t.padInfo.top,a=r-1-t.padInfo.left,l=t.outChannels/t.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${s}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${e}; wR++) {
          float dyR = float(dyRCorner + wR) / ${o}.0;

          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${e} - 1 - wR;

          for (int wC = 0; wC < ${r}; wC++) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${r} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${l}; dm++) {
              int d2 = d1 * ${l} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}};function MVe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,dy:i}=t,{strides:s,dilations:a,pad:l,dimRoundingMode:c,filterShape:u}=r,d=T.computeConv2DInfo(o.shape,u,s,a,l,c,!0),p=new AD(d);return e.runWebGLProgram(p,[o,i],"float32")}var xre={kernelName:zp,backendName:"webgl",kernelFunc:MVe};function PVe(n){let{inputs:t,backend:e,attrs:r}=n,{dy:o,filter:i}=t,{strides:s,dilations:a,pad:l,dimRoundingMode:c,inputShape:u}=r,d=T.computeConv2DInfo(u,i.shape,s,a,l,c,!0),p=new RD(d);return e.runWebGLProgram(p,[o,i],"float32")}var vre={kernelName:Up,backendName:"webgl",kernelFunc:PVe};var OD=class{constructor(t){this.variableNames=["X"],this.outputShape=[t,t],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}};function FVe(n){let{inputs:t,backend:e}=n,{x:r}=t,o=[...r.shape,...r.shape],i=b.sizeFromShape(r.shape),s=Ee({inputs:{x:r},backend:e,attrs:{shape:[i]}}),a=new OD(i),l=e.runWebGLProgram(a,[s],s.dtype),c=Ee({inputs:{x:l},backend:e,attrs:{shape:o}});return e.disposeIntermediateTensorInfo(s),e.disposeIntermediateTensorInfo(l),c}var bre={kernelName:Wp,backendName:"webgl",kernelFunc:FVe};var MD=class{constructor(t){this.variableNames=["x","W"],this.outputShape=t.outShape;let{inHeight:e,inWidth:r,padInfo:o,strideHeight:i,strideWidth:s,filterHeight:a,filterWidth:l,dilationHeight:c,dilationWidth:u}=t,{top:d,left:p}=o;this.userCode=`
      const ivec2 strides = ivec2(${i}, ${s});
      const ivec2 pads = ivec2(${d}, ${p});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${a}; h++) {
          int hIn = hBeg + h * ${c};

          if (hIn >= 0 && hIn < ${e}) {
            for (int w = 0; w < ${l}; w++) {
              int wIn = wBeg + w * ${u};

              if (wIn >= 0 && wIn < ${r}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}};function LVe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,filter:i}=t,{strides:s,pad:a,dilations:l}=r,c=T.computeDilation2DInfo(o.shape,i.shape,s,a,"NHWC",l),u,d=new MD(c);u=e.runWebGLProgram(d,[o,i],"float32");let p=Ee({inputs:{x:u},backend:e,attrs:{shape:c.outShape}});return e.disposeIntermediateTensorInfo(u),p}var wre={kernelName:Fc,backendName:"webgl",kernelFunc:LVe};function $Ve(n){let{inputs:t,backend:e,attrs:r}=n,{equation:o}=r,i=t,{allDims:s,summedDims:a,idDims:l}=T.decodeEinsumEquation(o,i.length);T.checkEinsumDimSizes(s.length,l,i);let{path:c,steps:u}=T.getEinsumComputePath(a,l),d=u.length,p=null,f=s.length,h=[];for(let m=0;m<d;++m){for(let g of u[m]){let{permutationIndices:y,expandDims:v}=T.getEinsumPermutation(f,l[g]),w;T.isIdentityPermutation(y)?w=i[g]:(w=Yn({inputs:{x:i[g]},backend:e,attrs:{perm:y}}),h.push(w));let C=w.shape.slice();for(let I=0;I<v.length;++I)C.splice(v[I],0,1);b.arraysEqual(w.shape,C)||(w=Ee({inputs:{x:w},backend:e,attrs:{shape:C}}),h.push(w)),p===null?p=w:(p=Cw({inputs:{a:w,b:p},backend:e}),h.push(p))}m<d-1&&(c[m]>=0&&(p=Wm({inputs:{x:p},backend:e,attrs:{axis:c[m]-(s.length-f),keepDims:!1}}),h.push(p)),f--)}for(let m of h)m!==p&&e.disposeIntermediateTensorInfo(m);return p}var Cre={kernelName:Gp,backendName:"webgl",kernelFunc:$Ve};var VVe="return (x >= 0.0) ? x : (exp(x) - 1.0);",BVe=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,zVe=Ze({opSnippet:VVe,packedOpSnippet:BVe}),_re={kernelName:ja,backendName:"webgl",kernelFunc:zVe};var UVe="return (b >= 0.0) ? a : a * (b + 1.0);",WVe=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,GVe=n=>{let{inputs:t,backend:e}=n,{dy:r,y:o}=t,i=q().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Zi(WVe,r.shape,o.shape):new Ci(UVe,r.shape,o.shape);return e.runWebGLProgram(i,[r,o],r.dtype)},Sre={kernelName:jp,backendName:"webgl",kernelFunc:GVe};var jVe=`
  return vec4(equal(a, b));
`,HVe="return float(a == b);",qVe=un({opSnippet:HVe,packedOpSnippet:jVe,dtype:"bool",cpuKernelImpl:rte}),Ire={kernelName:yd,backendName:"webgl",kernelFunc:qVe};var KVe=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${T.ERF_P};
  float a1 = ${T.ERF_A1};
  float a2 = ${T.ERF_A2};
  float a3 = ${T.ERF_A3};
  float a4 = ${T.ERF_A4};
  float a5 = ${T.ERF_A5};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,XVe=Ze({opSnippet:KVe}),Ere={kernelName:Ha,backendName:"webgl",kernelFunc:XVe};var YVe=aa+`
  return exp(x);
`,ZVe=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,d3=Ze({opSnippet:YVe,packedOpSnippet:ZVe,cpuKernelImpl:ote,dtype:"float32"}),Tre={kernelName:qa,backendName:"webgl",kernelFunc:d3};function PD(n){let{inputs:t,attrs:e,backend:r}=n,{dim:o}=e,{input:i}=t,s=i.shape.length,a=i.shape.slice(),l=o;return o<0&&(b.assert(-(s+1)<=o,()=>`Axis must be in the interval [${-(s+1)}, ${s}]`),l=s+o+1),a.splice(l,0,1),Ee({inputs:{x:i},backend:r,attrs:{shape:a}})}var Dre={kernelName:Lc,backendName:"webgl",kernelFunc:PD};var kre="return exp(x) - 1.0;",QVe=Ze({opSnippet:kre,packedOpSnippet:kre,cpuKernelImpl:ite}),Nre={kernelName:Ka,backendName:"webgl",kernelFunc:QVe};var Iw=class{constructor(t,e,r){this.variableNames=["real","imag"];let o=e[1];this.outputShape=e;let i=r?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,s=r?`${o}.0`:"1.0",a;if(t==="real")a="return real * expR - imag * expI;";else if(t==="imag")a="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${t}.`);this.userCode=`
      const float exponentMultiplier = ${i};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${a}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${o});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${o}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${s};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}};function FD(n,t,e){let r=e.texData.get(n.dataId),o=b.sizeFromShape(n.shape),i=n.shape[n.shape.length-1],s=o/i,a=Ee({inputs:{x:n},backend:e,attrs:{shape:[s,i]}}),l=a.shape,c=new Iw("real",l,t),u=new Iw("imag",l,t),d=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:l},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:l}],p=e.runWebGLProgram(c,d,"float32"),f=e.runWebGLProgram(u,d,"float32"),h=_i({inputs:{real:p,imag:f},backend:e});e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(f);let m=Ee({inputs:{x:h},backend:e,attrs:{shape:n.shape}});return e.disposeIntermediateTensorInfo(a),e.disposeIntermediateTensorInfo(h),m}function JVe(n){let{inputs:t,backend:e}=n,{input:r}=t;return FD(r,!1,e)}var Are={kernelName:Hp,backendName:"webgl",kernelFunc:JVe};var LD=class{constructor(t,e){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=t,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}};function Zd(n){let{backend:t,attrs:e}=n,{shape:r,value:o}=e,{dtype:i}=e;if(i=i||b.inferDtype(o),i==="string"){let s=b.getArrayFromDType(i,b.sizeFromShape(r));return s.fill(o),t.makeTensorInfo(r,i,s)}else{let s=new LD(r,o),a=[[o]];return t.runWebGLProgram(s,[],i,a)}}var Rre={kernelName:qp,backendName:"webgl",kernelFunc:Zd};var $D=class{constructor(t){this.variableNames=["Image"],this.outputShape=[];let e=t[2];this.outputShape=t,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${e} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${e}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}};var Ore={kernelName:Kp,backendName:"webgl",kernelFunc:({inputs:n,backend:t})=>{let{image:e}=n,r=t,o=new $D(e.shape);return r.runWebGLProgram(o,[e],e.dtype)}};var Mre="return floor(x);",eBe=Ze({opSnippet:Mre,packedOpSnippet:Mre,cpuKernelImpl:ste}),Pre={kernelName:Xa,backendName:"webgl",kernelFunc:eBe};var tBe=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,nBe=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,rBe=un({opSnippet:tBe,packedOpSnippet:nBe,dtype:"int32"}),Fre={kernelName:Ya,backendName:"webgl",kernelFunc:rBe};var VD=class{constructor(t){this.variableNames=["A"];let e=ur(),[r,o]=t;this.outputShape=t,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${o}.0, ${r}.0);

        vec4 values = ${e.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}};var BD=class{constructor(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;let e=ur(),[r,o]=t;this.outputShape=t,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${o}.0, ${r}.0);
            vec4 values = ${e.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${e.output} = result;
      }
    `}};var Lre={kernelName:Jh,backendName:"webgl",kernelFunc:oBe},hv,p3=q().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function oBe(n){let{inputs:t,backend:e,attrs:r}=n,{pixels:o}=t,{numChannels:i}=r,s=typeof HTMLVideoElement<"u"&&o instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&o instanceof HTMLImageElement,[l,c]=s?[o.videoWidth,o.videoHeight]:[o.width,o.height],u=[c,l],d=[c,l,i];if(a||s){let m=q().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(hv==null||m!==p3)&&(p3=m,hv=document.createElement("canvas").getContext("2d",{willReadFrequently:p3})),hv.canvas.width=l,hv.canvas.height=c,hv.drawImage(o,0,0,l,c),o=hv.canvas}let p=e.makeTensorInfo(u,"int32");e.texData.get(p.dataId).usage=Vo.PIXELS,e.gpgpu.uploadPixelDataToTexture(e.getTexture(p.dataId),o);let f=q().getBool("WEBGL_PACK")?new BD(d):new VD(d),h=e.runWebGLProgram(f,[p],"int32");return e.disposeData(p.dataId),h}function iBe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,filter:i,bias:s,preluActivationWeights:a}=t,{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:p,activation:f,leakyreluAlpha:h}=r,m=T.convertConv2DDataFormat(u),g=T.computeConv2DInfo(o.shape,i.shape,l,d,c,p,!1,m),y,v=[],w=s!=null,C=a!=null,I=f==="leakyrelu",A=()=>{let $=[o,i],V=(W,K)=>{if(K==="NCHW"&&W.shape.length===1&&W.shape[0]!==1){let te=Ee({inputs:{x:W},backend:e,attrs:{shape:[W.shape[0],1,1]}});return v.push(te),te}return W};if(w&&$.push(V(s,u)),C&&$.push(V(a,u)),I){let W=e.makeTensorInfo([],"float32",b.createScalarValue(h,"float32"));$.push(W),v.push(W)}return $};if(g.filterHeight===1&&g.filterWidth===1&&g.dilationHeight===1&&g.dilationWidth===1&&g.strideHeight===1&&g.strideWidth===1&&(g.padInfo.type==="SAME"||g.padInfo.type==="VALID"))y=wD({x:o,filter:i,convInfo:g,backend:e,bias:s,activation:f,preluActivationWeights:a,leakyreluAlpha:h});else if(g.strideWidth<=2&&m==="channelsLast"&&q().getBool("WEBGL_EXP_CONV")){let $=f?Xd(f,!0):null,V=new uv(g,w,$,C,I),W=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]],K=A();y=e.runWebGLProgram(V,K,"float32",W)}else if(q().getBool("WEBGL_CONV_IM2COL"))y=CD({x:o,filter:i,convInfo:g,backend:e,bias:s,activation:f,preluActivationWeights:a,leakyreluAlpha:h});else{let $=f?Xd(f,!1):null,V=new cv(g,w,$,C,I),W=A();y=e.runWebGLProgram(V,W,"float32")}let M=Ee({inputs:{x:y},backend:e,attrs:{shape:g.outShape}});return v.push(y),v.forEach($=>e.disposeIntermediateTensorInfo($)),M}var $re={kernelName:Ed,backendName:"webgl",kernelFunc:iBe};function sBe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,filter:i,bias:s,preluActivationWeights:a}=t,{strides:l,pad:c,dilations:u,dimRoundingMode:d,activation:p,leakyreluAlpha:f}=r,h=[],m=u;m==null&&(m=[1,1]),b.assert(T.eitherStridesOrDilationsAreOne(l,m),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${l} and dilations '${m}'`);let g=T.computeConv2DInfo(o.shape,i.shape,l,m,c,d,!0),y=q().getBool("WEBGL_PACK_DEPTHWISECONV")&&g.strideWidth<=2&&g.outChannels/g.inChannels===1,v=p?Xd(p,y):null,w=[o,i],C=s!=null,I=a!=null,A=p==="leakyrelu";if(C&&w.push(s),I&&w.push(a),A){let W=e.makeTensorInfo([],"float32",b.createScalarValue(f,"float32"));w.push(W),h.push(W)}let M;y?M=new fv(g,C,v,I,A):M=new pv(g,C,v,I,A);let $=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]],V=e.runWebGLProgram(M,w,"float32",$);return h.forEach(W=>e.disposeIntermediateTensorInfo(W)),V}var Vre={kernelName:Td,backendName:"webgl",kernelFunc:sBe};var zD=class{constructor(t,e,r,o){this.sliceDim=t,this.strides=e,this.paramsShape=o,this.variableNames=["x","indices"],this.outputShape=r;let i=vt(r.length),s=`
    int index;`;for(let a=0;a<this.sliceDim;a++)s+=`
          index = round(getIndices(coords[0], ${a}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[a]};
          flattenIndex += index * ${this.strides[a]};`;this.userCode=`
         void main() {
          ${i} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${s}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}};function aBe(n){let{inputs:t,backend:e}=n,{params:r,indices:o}=t,i=o.shape,s=i[i.length-1],a=b.sizeFromShape(r.shape),[l,c,u,d]=T.prepareAndValidate(r,o),p=Ee({inputs:{x:o},backend:e,attrs:{shape:[c,s]}}),f=Ee({inputs:{x:r},backend:e,attrs:{shape:[b.sizeFromShape(r.shape)/u,u]}});if(e.shouldExecuteOnCPU([r,o])||r.dtype==="string"){let y=e.readSync(o.dataId),v=e.bufferSync(r),w=ate(y,v,r.dtype,c,s,u,d,r.shape,a);return e.makeTensorInfo(l,r.dtype,w.values)}let h=new zD(s,d,[c,u],r.shape),m=e.runWebGLProgram(h,[f,p],f.dtype),g=Ee({inputs:{x:m},backend:e,attrs:{shape:l}});return e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(m),g}var Bre={kernelName:Xp,backendName:"webgl",kernelFunc:aBe};var UD=class{constructor(t,e){this.variableNames=["A","indices"],this.outputShape=e,this.rank=e.length;let r=vt(this.rank),o=lBe(t,2);this.userCode=`
      void main() {
        ${r} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${t[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${o}));
      }
    `}};function lBe(n,t){let e=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[];for(let o=0;o<n.length;o++)o===2?r.push("index"):r.push(`${e[o]}`);return r.join()}function f3(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,indices:i}=t,{axis:s,batchDims:a}=r,l=b.parseAxisParam(s,o.shape)[0];if(q().get("DEBUG")){let v=e.readSync(i.dataId),w=o.shape[l];for(let C=0;C<v.length;++C){let I=v[C];b.assert(I<=w-1&&I>=0,()=>`GatherV2: the index value ${I} is not in [0, ${w-1}]`)}}let c=T.segment_util.collectGatherOpShapeInfo(o,i,l,a),u=b.sizeFromShape(i.shape),d=[],p=Ee({inputs:{x:o},backend:e,attrs:{shape:[c.batchSize,c.outerSize,c.dimSize,c.sliceSize]}}),f=Ee({inputs:{x:i},backend:e,attrs:{shape:[c.batchSize,u/c.batchSize]}});d.push(p),d.push(f);let h=[c.batchSize,c.outerSize,u/c.batchSize,c.sliceSize];if(e.shouldExecuteOnCPU([o,i])||o.dtype==="string"){let v=e.bufferSync(f),w=e.bufferSync(p),C=lte(w,v,h);return d.forEach(I=>e.disposeIntermediateTensorInfo(I)),e.makeTensorInfo(c.outputShape,C.dtype,C.values)}let m=new UD(p.shape,h),g=e.runWebGLProgram(m,[p,f],p.dtype);d.push(g);let y=Ee({inputs:{x:g},backend:e,attrs:{shape:c.outputShape}});return d.forEach(v=>e.disposeIntermediateTensorInfo(v)),y}var zre={kernelName:Vc,backendName:"webgl",kernelFunc:f3};var cBe="return float(a > b);",uBe=`
  return vec4(greaterThan(a, b));
`,dBe=un({opSnippet:cBe,packedOpSnippet:uBe,cpuKernelImpl:cte,dtype:"bool"}),Ure={kernelName:xd,backendName:"webgl",kernelFunc:dBe};var pBe="return float(a >= b);",fBe=`
  return vec4(greaterThanEqual(a, b));
`,hBe=un({opSnippet:pBe,packedOpSnippet:fBe,dtype:"bool",cpuKernelImpl:ute}),Wre={kernelName:Za,backendName:"webgl",kernelFunc:hBe};function mBe(n){let{inputs:t,backend:e}=n,{input:r}=t;return FD(r,!0,e)}var Gre={kernelName:Yp,backendName:"webgl",kernelFunc:mBe};var gBe="return float(!isnan(x) && !isinf(x));",yBe=Ze({opSnippet:gBe,dtype:"bool"}),jre={kernelName:Qa,backendName:"webgl",kernelFunc:yBe};var xBe="return float(isinf(x));",vBe=Ze({opSnippet:xBe,dtype:"bool"}),Hre={kernelName:Ja,backendName:"webgl",kernelFunc:vBe};var bBe="return float(isnan(x));",wBe=Ze({opSnippet:bBe,dtype:"bool"}),qre={kernelName:el,backendName:"webgl",kernelFunc:wBe};var CBe="return float(a < b);",_Be=`
  return vec4(lessThan(a, b));
`,SBe=un({opSnippet:CBe,packedOpSnippet:_Be,cpuKernelImpl:dte,dtype:"bool"}),Kre={kernelName:vd,backendName:"webgl",kernelFunc:SBe};var IBe="return float(a <= b);",EBe=`
  return vec4(lessThanEqual(a, b));
`,TBe=un({opSnippet:IBe,packedOpSnippet:EBe,cpuKernelImpl:pte,dtype:"bool"}),Xre={kernelName:bd,backendName:"webgl",kernelFunc:TBe};function DBe(n){let{backend:t,attrs:e}=n,{start:r,stop:o,num:i}=e,s=fte(r,o,i);return t.makeTensorInfo([s.length],"float32",s)}var Yre={kernelName:Qp,backendName:"webgl",kernelFunc:DBe};var kBe=aa+`
  return x < 0.0 ? 0./0. : log(x);
`,NBe=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,ABe=Ze({opSnippet:kBe,packedOpSnippet:NBe,cpuKernelImpl:hte}),Zre={kernelName:tl,backendName:"webgl",kernelFunc:ABe};var RBe=aa+`
  return log(1.0 + x);
`,OBe=Ze({opSnippet:RBe}),Qre={kernelName:nl,backendName:"webgl",kernelFunc:OBe};var MBe="return float(a >= 1.0 && b >= 1.0);",PBe=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,FBe=un({opSnippet:MBe,packedOpSnippet:PBe,dtype:"bool"}),Jre={kernelName:wd,backendName:"webgl",kernelFunc:FBe};var LBe="return float(!(x >= 1.0));",$Be=Ze({opSnippet:LBe}),eoe={kernelName:Cd,backendName:"webgl",kernelFunc:$Be};var VBe="return float(a >= 1.0 || b >= 1.0);",BBe=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,zBe=un({opSnippet:VBe,packedOpSnippet:BBe,dtype:"bool"}),toe={kernelName:_d,backendName:"webgl",kernelFunc:zBe};var WD=class{constructor(t,e,r,o,i){this.variableNames=["x"],this.outputShape=[];let s=e,a=t[3]-1;this.outputShape=t;let l,c=`float(${r}) + float(${o}) * sum`;i===.5?l=`inversesqrt(${c})`:i===1?l=`1.0/(${c})`:l=`exp(log(${c}) * float(-${i}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${s}; j <= ${s}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${a}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${l};
        setOutput(val);
      }
    `}};var GD=class{constructor(t,e,r,o,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;let s=e,a=t[3]-1;this.outputShape=t;let l,c=`float(${r}) + float(${o}) * sum`;i===.5?l=`inversesqrt(${c})`:i===1?l=`1.0/(${c})`:l=`exp(log(${c}) * float(-${i}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${s};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${s}; j <= ${s}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${a}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${l};
        setOutput(result);
      }
    `}};var UBe=n=>{let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{depthRadius:i,bias:s,alpha:a,beta:l}=r,c=q().getBool("WEBGL_PACK_NORMALIZATION")?new GD(o.shape,i,s,a,l):new WD(o.shape,i,s,a,l);return e.runWebGLProgram(c,[o],o.dtype)},noe={kernelName:zc,backendName:"webgl",kernelFunc:UBe};var jD=class{constructor(t,e,r,o,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=t,this.depth=t[3],this.depthRadius=e,this.bias=r,this.alpha=o,this.beta=i,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${e})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${e} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${o}) * norm + float(${r});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${o})
                * float(${i})
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${i});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}};var WBe=n=>{let{inputs:t,backend:e,attrs:r}=n,{x:o,y:i,dy:s}=t,{depthRadius:a,bias:l,alpha:c,beta:u}=r,d=new jD(o.shape,a,l,c,u);return e.runWebGLProgram(d,[o,i,s],o.dtype)},roe={kernelName:Jp,backendName:"webgl",kernelFunc:WBe};function ooe(n,t,e,r){let o=b.sizeFromShape(t),s=b.sizeFromShape(n.shape)/o,a=Ee({inputs:{x:n},attrs:{shape:[s,o]},backend:r}),l=Ji(a,n.dtype,"max",r),c=Ee({inputs:{x:l},attrs:{shape:e},backend:r});return r.disposeIntermediateTensorInfo(a),r.disposeIntermediateTensorInfo(l),c}function h3(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{reductionIndices:i,keepDims:s}=r,a=o.shape.length,l=b.parseAxisParam(i,o.shape),c=l,u=T.getAxesPermutation(c,a),d=u!=null,p=e.shouldExecuteOnCPU([o]),f=o;if(d){if(p){let w=e.texData.get(f.dataId).values,C=new Array(a);for(let M=0;M<C.length;M++)C[M]=o.shape[u[M]];let I=Um(w,o.shape,o.dtype,u,C);f=e.makeTensorInfo(C,o.dtype);let A=e.texData.get(f.dataId);A.values=I}else f=nh(o,u,e);c=T.getInnerMostAxes(c.length,a)}T.assertAxesAreInnerMostDims("max",c,a);let[h,m]=T.computeOutAndReduceShapes(f.shape,c),g=h;s&&(g=T.expandShapeToKeepDim(h,l));let y;if(p){let w=e.texData.get(f.dataId).values,C=mte(w,b.sizeFromShape(m),g,o.dtype);y=e.makeTensorInfo(g,o.dtype);let I=e.texData.get(y.dataId);I.values=C}else y=ooe(f,m,g,e);return d&&e.disposeIntermediateTensorInfo(f),y}var ioe={kernelName:Uc,backendName:"webgl",kernelFunc:h3};var GBe=sv+`
  return max(a, b);
`,jBe=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Qi+`
  return result;
`,HBe=un({opSnippet:GBe,packedOpSnippet:jBe,cpuKernelImpl:gte}),soe={kernelName:rl,backendName:"webgl",kernelFunc:HBe};function qBe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t;Au(o,"maxPool");let{filterSize:i,strides:s,pad:a,dimRoundingMode:l}=r,c=1;b.assert(T.eitherStridesOrDilationsAreOne(s,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${s} and dilations '${c}'`);let u=T.computePool2DInfo(o.shape,i,s,c,a,l);if(u.filterWidth===1&&u.filterHeight===1&&b.arraysEqual(u.inShape,u.outShape))return _r({inputs:{x:o},backend:e});let d=new Ul(u,"max",!1);return e.runWebGLProgram(d,[o],o.dtype)}var aoe={kernelName:Wc,backendName:"webgl",kernelFunc:qBe};function KBe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{filterSize:i,strides:s,pad:a,dataFormat:l,dimRoundingMode:c}=r,u=[1,1,1],d=T.computePool3DInfo(o.shape,i,s,u,a,c,l),p=new rh(d,"max",!1);return e.runWebGLProgram(p,[o],o.dtype)}var loe={kernelName:Gc,backendName:"webgl",kernelFunc:KBe};var HD=class{constructor(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;let e=t.strideHeight,r=t.strideWidth,o=t.dilationHeight,i=t.effectiveFilterHeight,s=t.effectiveFilterWidth,a=i-1-t.padInfo.top,l=s-1-t.padInfo.left,c=i*s-1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${i};
          wR += ${o}) {
          float dyR = float(dyRCorner + wR) / ${e}.0;

          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${r}.0;

            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${c} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${s} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}},qD=class{constructor(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;let e=t.strideDepth,r=t.strideHeight,o=t.strideWidth,i=t.dilationDepth,s=t.dilationHeight,a=t.dilationWidth,l=t.effectiveFilterDepth,c=t.effectiveFilterHeight,u=t.effectiveFilterWidth,d=l-1-t.padInfo.front,p=c-1-t.padInfo.top,f=u-1-t.padInfo.left,h=l*c*u-1;this.userCode=`
      const ivec3 pads = ivec3(${d}, ${p}, ${f});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${l};
           wD += ${i}) {
          float dyD = float(dyDCorner + wD) / ${e}.0;

          if (dyD < 0.0 || dyD >= ${t.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${c};
              wR += ${s}) {
            float dyR = float(dyRCorner + wR) / ${r}.0;

            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${u};
                wC += ${a}) {
              float dyC = float(dyCCorner + wC) / ${o}.0;

              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${h} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${c} * ${u} +
                  wR * ${u} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}};function XBe(n){let{inputs:t,backend:e,attrs:r}=n,{dy:o,input:i}=t,s=i,{filterSize:a,strides:l,pad:c,dimRoundingMode:u}=r,d=[1,1,1],p=T.computePool3DInfo(s.shape,a,l,d,c,u),f=new rh(p,"max",!0),h=e.runWebGLProgram(f,[s],s.dtype),m=new qD(p),g=e.runWebGLProgram(m,[o,h],s.dtype);return e.disposeIntermediateTensorInfo(h),g}var coe={kernelName:tf,backendName:"webgl",kernelFunc:XBe};function YBe(n){let{inputs:t,backend:e,attrs:r}=n,{dy:o,input:i,output:s}=t,a=i;Au([i,s],"maxPoolGrad");let{filterSize:l,strides:c,pad:u,dimRoundingMode:d}=r,p=T.computePool2DInfo(a.shape,l,c,1,u,d),f=!0,h=new Ul(p,"max",f),m=e.runWebGLProgram(h,[a],a.dtype),g=new HD(p),y=e.runWebGLProgram(g,[o,m],a.dtype);return e.disposeIntermediateTensorInfo(m),y}var uoe={kernelName:ef,backendName:"webgl",kernelFunc:YBe};function doe(n,t,e,r){let o=new Ul(e,"max",!1),i=r.runWebGLProgram(o,[n],"float32");o=new Ul(e,"max",!0,!0,t);let s=r.runWebGLProgram(o,[n],"float32");return[i,s]}var poe={kernelName:nf,backendName:"webgl",kernelFunc:({inputs:n,attrs:t,backend:e})=>{let{x:r}=n,{filterSize:o,strides:i,pad:s,includeBatchInIndex:a}=t,l=e;b.assert(r.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${r.shape.length}.`);let c=[1,1];b.assert(T.eitherStridesOrDilationsAreOne(i,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${c}'`);let u=T.computePool2DInfo(r.shape,o,i,c,s),[d,p]=doe(r,a,u,l);return[d,p]}};function foe(n,t,e,r){let o=b.sizeFromShape(t),s=b.sizeFromShape(n.shape)/o,a=Ee({inputs:{x:n},attrs:{shape:[s,o]},backend:r}),l=Ji(a,"float32","mean",r),c=Ee({inputs:{x:l},attrs:{shape:e},backend:r});return r.disposeIntermediateTensorInfo(a),r.disposeIntermediateTensorInfo(l),c}var hoe={kernelName:jc,backendName:"webgl",kernelFunc:({inputs:n,attrs:t,backend:e})=>{let{x:r}=n,{keepDims:o,axis:i}=t,s=e,a=r.shape.length,l=b.parseAxisParam(i,r.shape),c=l,u=T.getAxesPermutation(c,a),d=u!=null,p=s.shouldExecuteOnCPU([r]),f=[],h=r;if(d){if(p){let C=s.texData.get(h.dataId).values,I=new Array(a);for(let $=0;$<I.length;$++)I[$]=r.shape[u[$]];let A=Um(C,r.shape,r.dtype,u,I);h=s.makeTensorInfo(I,r.dtype);let M=s.texData.get(h.dataId);M.values=A}else h=nh(r,u,s);f.push(h),c=T.getInnerMostAxes(c.length,a)}T.assertAxesAreInnerMostDims("sum",c,a);let[m,g]=T.computeOutAndReduceShapes(h.shape,c),y=m;o&&(y=T.expandShapeToKeepDim(m,l));let v=foe(h,g,y,s);for(let w of f)s.disposeIntermediateTensorInfo(w);return v}};function ZBe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{axis:i,keepDims:s}=r,a=o.shape.length,l=b.parseAxisParam(i,o.shape),c=l,u=T.getAxesPermutation(c,a),d=o;u!=null&&(d=Yn({inputs:{x:o},backend:e,attrs:{perm:u}}),c=T.getInnerMostAxes(c.length,o.shape.length)),T.assertAxesAreInnerMostDims("min",c,a);let[p,f]=T.computeOutAndReduceShapes(d.shape,c),h=b.sizeFromShape(f),m=Ee({inputs:{x:d},backend:e,attrs:{shape:[-1,h]}}),g=Ji(m,m.dtype,"min",e),y;if(s){let v=T.expandShapeToKeepDim(p,l);y=Ee({inputs:{x:g},backend:e,attrs:{shape:v}})}else y=Ee({inputs:{x:g},backend:e,attrs:{shape:p}});return e.disposeIntermediateTensorInfo(m),e.disposeIntermediateTensorInfo(g),u!=null&&e.disposeIntermediateTensorInfo(d),y}var moe={kernelName:Hc,backendName:"webgl",kernelFunc:ZBe};var QBe=sv+`
  return min(a, b);
`,JBe=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Qi+`
  return result;
`,eze=un({opSnippet:QBe,packedOpSnippet:JBe,cpuKernelImpl:yte}),goe={kernelName:ol,backendName:"webgl",kernelFunc:eze};var KD=class{constructor(t,e,r){this.variableNames=["x"],this.outputShape=e.map((u,d)=>u[0]+t[d]+u[1]);let o=t.length,i=vt(o),s=e.map(u=>u[0]).join(","),a=e.map((u,d)=>u[0]+t[d]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,o),c=r==="reflect"?0:1;if(o===1){this.userCode=`
        int start = ${s};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${c};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${c};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${i} start = ${i}(${s});
      ${i} end = ${i}(${a});

      void main() {
        ${i} outC = getOutputCoords();
        for (int i = 0; i < ${o}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${c};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${c};
          }
        }
        ${i} coords = outC - start;
        setOutput(getX(${l}));
      }
    `}};var XD=class{constructor(t,e,r){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.map((h,m)=>h[0]+t[m]+h[1]);let o=t.length,i=vt(o),s=e.map(h=>h[0]).join(","),a=e.map((h,m)=>h[0]+t[m]).join(","),l=Cr("rc",o),c=Cr("source",o),u=`${l[o-1]} < ${this.outputShape[o-1]}`,d=o===1?"source":`vec2(${c.slice(-2).join()})`,p=r==="reflect"?0:1,f="";if(o===1){let h=`
        ${i} source = rc;
        if (source < start) {
          source = start * 2 - source - ${p};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${p};
        }
        source -= start;
      `;f=`
        ${i} rc = outputLoc;
        ${h}
        result[0] = getChannel(getX(${c.join()}), ${d});
        ${l[o-1]} += 1;
        if(${u}) {
          ${h}
          result[1] = getChannel(getX(${c.join()}), ${d});
        }
      `}else{let h=`
        ${i} source = rc;
        ${i} lt = ${i}(lessThan(source, start));
        ${i} gte = ${i}(greaterThanEqual(source, end));
        ${i} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${p}) +
                gte * ((end - 1) * 2 - source + ${p});
        source -= start;
      `;f=`
        ${i} rc = outputLoc;
        ${h}
        result[0] = getChannel(getX(${c.join()}), ${d});
        ${l[o-1]} += 1;
        if(${u}) {
          ${h}
          result[1] = getChannel(getX(${c.join()}), ${d});
        }
        rc = outputLoc;
        ${l[o-2]} += 1;
        if(${l[o-2]} < ${this.outputShape[o-2]}) {
          ${h}
          result[2] = getChannel(getX(${c.join()}), ${d});
          ${l[o-1]} += 1;
          if(${u}) {
            ${h}
            result[3] = getChannel(getX(${c.join()}), ${d});
          }
        }
      `}this.userCode=`
      const ${i} start = ${i}(${s});
      const ${i} end = ${i}(${a});

      void main() {
        ${i} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${f}
        setOutput(result);
      }
    `}};var tze=({inputs:n,backend:t,attrs:e})=>{let{x:r}=n,{paddings:o,mode:i}=e,s=q().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new XD(r.shape,o,i):new KD(r.shape,o,i);return t.runWebGLProgram(s,[r],r.dtype)},yoe={kernelName:qc,backendName:"webgl",kernelFunc:tze};var nze=`if (b == 0.0) return NAN;
  return mod(a, b);`,rze=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+Qi+`
  return result;
`,oze=un({opSnippet:nze,packedOpSnippet:rze}),xoe={kernelName:il,backendName:"webgl",kernelFunc:oze};var YD=class{constructor(t,e,r){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[t,r],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${e-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${e-1}));
      }
    `}};var ize=`
if (a == b) {
  return 1.0;
};
return a / b;`,sze=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,m3=un({opSnippet:ize,packedOpSnippet:sze,checkOutOfBounds:!0}),voe={kernelName:Ga,backendName:"webgl",kernelFunc:m3};var boe="return a - b;",g3=un({opSnippet:boe,packedOpSnippet:boe,supportsComplex:!0,cpuKernelImpl:$te}),woe={kernelName:wl,backendName:"webgl",kernelFunc:g3};function y3(n){let{inputs:t,backend:e,attrs:r}=n,{logits:o}=t,{dim:i}=r,s=b.parseAxisParam([i],o.shape),a=h3({inputs:{x:o},backend:e,attrs:{reductionIndices:s,keepDims:!1}}),l=T.expandShapeToKeepDim(a.shape,s),c=Ee({inputs:{x:a},backend:e,attrs:{shape:l}}),u=g3({inputs:{a:o,b:c},backend:e}),d=d3({inputs:{x:u},backend:e}),p=Wm({inputs:{x:d},backend:e,attrs:{axis:s,keepDims:!1}}),f=Ee({inputs:{x:p},backend:e,attrs:{shape:l}}),h=m3({inputs:{a:d,b:f},backend:e});return e.disposeIntermediateTensorInfo(a),e.disposeIntermediateTensorInfo(c),e.disposeIntermediateTensorInfo(u),e.disposeIntermediateTensorInfo(d),e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(f),h}var Coe={kernelName:uu,backendName:"webgl",kernelFunc:y3};function aze(n){let{inputs:t,backend:e,attrs:r}=n,{logits:o}=t,{numSamples:i,seed:s,normalized:a}=r,l=a?o:y3({inputs:{logits:o},backend:e,attrs:{dim:o.shape.length-1}}),c=l.shape[0],u=l.shape[1],d=new YD(c,u,i),p=[[s]],f=e.runWebGLProgram(d,[l],"int32",p);return a||e.disposeIntermediateTensorInfo(l),f}var _oe={kernelName:rf,backendName:"webgl",kernelFunc:aze};var lze=Br+`
  return -x;
`,cze=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function uze(n){let{inputs:t,backend:e}=n,{x:r}=t;if(e.shouldExecuteOnCPU([r])){let i=e.texData.get(r.dataId),[s,a]=vte(i.values,r.shape,r.dtype);return e.makeTensorInfo(a,r.dtype,s)}let o;return q().getBool("WEBGL_PACK_UNARY_OPERATIONS")?o=new wi(r.shape,cze):o=new go(r.shape,lze),e.runWebGLProgram(o,[r],r.dtype)}var Soe={kernelName:Kc,backendName:"webgl",kernelFunc:uze};var dze=Vr.nonMaxSuppressionV3Impl;function pze(n){T.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");let{inputs:t,backend:e,attrs:r}=n,{boxes:o,scores:i}=t,{maxOutputSize:s,iouThreshold:a,scoreThreshold:l}=r,c=e.readSync(o.dataId),u=e.readSync(i.dataId),{selectedIndices:d}=dze(c,u,s,a,l);return e.makeTensorInfo([d.length],"int32",new Int32Array(d))}var Ioe={kernelName:of,backendName:"webgl",kernelFunc:pze};var fze=Vr.nonMaxSuppressionV4Impl;function hze(n){T.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");let{inputs:t,backend:e,attrs:r}=n,{boxes:o,scores:i}=t,{maxOutputSize:s,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:c}=r,u=e.readSync(o.dataId),d=e.readSync(i.dataId),{selectedIndices:p,validOutputs:f}=fze(u,d,s,a,l,c);return[e.makeTensorInfo([p.length],"int32",new Int32Array(p)),e.makeTensorInfo([],"int32",new Int32Array([f]))]}var Eoe={kernelName:ky,backendName:"webgl",kernelFunc:hze};var mze=Vr.nonMaxSuppressionV5Impl;function gze(n){T.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");let{inputs:t,backend:e,attrs:r}=n,{boxes:o,scores:i}=t,{maxOutputSize:s,iouThreshold:a,scoreThreshold:l,softNmsSigma:c}=r,u=e.readSync(o.dataId),d=e.readSync(i.dataId),p=s,f=a,h=l,m=c,{selectedIndices:g,selectedScores:y}=mze(u,d,p,f,h,m);return[e.makeTensorInfo([g.length],"int32",new Int32Array(g)),e.makeTensorInfo([y.length],"float32",new Float32Array(y))]}var Toe={kernelName:sf,backendName:"webgl",kernelFunc:gze};var ZD=class{constructor(t,e,r,o){this.variableNames=["indices"],this.outputShape=[t,e],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${o}), float(${r}),
                      float(index == coords.y)));
      }
    `}};var yze=n=>{let{inputs:t,backend:e,attrs:r}=n,{indices:o}=t,{dtype:i,depth:s,onValue:a,offValue:l}=r,c=b.sizeFromShape(o.shape),u=new ZD(c,s,a,l),d=Ee({inputs:{x:o},backend:e,attrs:{shape:[c]}}),p=e.runWebGLProgram(u,[d],i);e.disposeIntermediateTensorInfo(d);let f=[...o.shape,s],h=Ee({inputs:{x:p},backend:e,attrs:{shape:f}});return e.disposeIntermediateTensorInfo(p),h},Doe={kernelName:Yc,backendName:"webgl",kernelFunc:yze};function Ew(n){let{inputs:t,backend:e}=n,{x:r}=t;if(r.dtype==="complex64"){let o=Yd({inputs:{input:r},backend:e}),i=Ew({inputs:{x:o},backend:e}),s=jm({inputs:{input:r},backend:e}),a=Ew({inputs:{x:s},backend:e}),l=_i({inputs:{real:i,imag:a},backend:e});return e.disposeIntermediateTensorInfo(o),e.disposeIntermediateTensorInfo(i),e.disposeIntermediateTensorInfo(s),e.disposeIntermediateTensorInfo(a),l}else return Zd({attrs:{shape:r.shape,dtype:r.dtype,value:r.dtype==="string"?"":0},backend:e})}var koe={kernelName:fu,backendName:"webgl",kernelFunc:Ew};function Noe(n){let{inputs:t,backend:e}=n,{x:r}=t;if(r.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(r.dtype==="complex64"){let o=Yd({inputs:{input:r},backend:e}),i=Noe({inputs:{x:o},backend:e}),s=jm({inputs:{input:r},backend:e}),a=Ew({inputs:{x:s},backend:e}),l=_i({inputs:{real:i,imag:a},backend:e});return e.disposeIntermediateTensorInfo(o),e.disposeIntermediateTensorInfo(i),e.disposeIntermediateTensorInfo(s),e.disposeIntermediateTensorInfo(a),l}else return Zd({attrs:{shape:r.shape,dtype:r.dtype,value:1},backend:e})}var Aoe={kernelName:Xc,backendName:"webgl",kernelFunc:Noe};function xze(n){let{inputs:t,backend:e,attrs:r}=n,{axis:o}=r;if(t.length===1)return PD({inputs:{input:t[0]},backend:e,attrs:{dim:o}});let i=t[0].shape,s=t[0].dtype;t.forEach(u=>{b.assertShapesMatch(i,u.shape,"All tensors passed to stack must have matching shapes"),b.assert(s===u.dtype,()=>"All tensors passed to stack must have matching dtypes")});let a=[],l=t.map(u=>{let d=PD({inputs:{input:u},backend:e,attrs:{dim:o}});return a.push(d),d}),c=u3({inputs:l,backend:e,attrs:{axis:o}});return a.forEach(u=>e.disposeIntermediateTensorInfo(u)),c}var Roe={kernelName:Zc,backendName:"webgl",kernelFunc:xze};var QD=class{constructor(t,e,r){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=e.map((c,u)=>c[0]+t[u]+c[1]);let o=t.length,i=vt(o),s=e.map(c=>c[0]).join(","),a=e.map((c,u)=>c[0]+t[u]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,o);if(o===1){this.userCode=`
        int start = ${s};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${i} start = ${i}(${s});
      ${i} end = ${i}(${a});

      void main() {
        ${i} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${i} coords = outC - start;
          setOutput(getX(${l}));
        }
      }
    `}};var JD=class{constructor(t,e,r){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=e.map((m,g)=>m[0]+t[g]+m[1]);let o=t.length,i=vt(o),s=e.map(m=>m[0]).join(","),a=e.map((m,g)=>m[0]+t[g]).join(","),l=Cr("rc",o),c=Cr("source",o),u=`${l[o-1]} < ${this.outputShape[o-1]}`,d=o===1?"source":`vec2(${c.slice(-2).join()})`,p=[`${i} rc = outputLoc;`,`${l[o-1]} += 1;
       if(${u}) {
      `,o===1?"":`}
       rc = outputLoc;
       ${l[o-2]} += 1;
       if(${l[o-2]} < ${this.outputShape[o-2]}) {`,o===1?"":`  ${l[o-1]} += 1;
         if(${u}) {`],f=o===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",h="";for(let m=0,g=o===1?2:4;m<g;m++)h+=`
        ${p[m]}
        if (${f}) {
          result[${m}] = float(value);
        } else {
          ${i} source = rc - start;
          result[${m}] = getChannel(getX(${c.join()}), ${d});
        }
      `;h+=o===1?"} ":"}}",this.userCode=`
      const ${i} start = ${i}(${s});
      const ${i} end = ${i}(${a});

      void main() {
        ${i} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${h}
        setOutput(result);
      }
    `}};var x3=n=>{let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{paddings:i,constantValue:s}=r;if(b.sizeFromShape(o.shape)===0){let c=i.map((u,d)=>u[0]+o.shape[d]+u[1]);return Zd({backend:e,attrs:{shape:c,value:s,dtype:o.dtype}})}let a=q().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new JD(o.shape,i,s):new QD(o.shape,i,s),l=[[s]];return e.runWebGLProgram(a,[o],o.dtype,l)},Ooe={kernelName:Qc,backendName:"webgl",kernelFunc:x3};var vze=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,bze=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+Qi+`
  return result;
`,wze=un({opSnippet:vze,packedOpSnippet:bze}),Moe={kernelName:al,backendName:"webgl",kernelFunc:wze};function Cze(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{axis:i,keepDims:s}=r,a=o.shape.length,l=[],c=b.parseAxisParam(i,o.shape),u=c,d=T.getAxesPermutation(u,a),p=o;d!=null&&(p=Yn({inputs:{x:o},backend:e,attrs:{perm:d}}),u=T.getInnerMostAxes(u.length,a),l.push(p)),T.assertAxesAreInnerMostDims("prod",u,a);let f;if(e.shouldExecuteOnCPU([p])){let h=e.texData.get(p.dataId).values,{outVals:m,outShape:g,outDtype:y}=wte(p.shape,p.dtype,h,u);f=e.makeTensorInfo(g,y,m)}else{let[h,m]=T.computeOutAndReduceShapes(p.shape,u),g=b.sizeFromShape(m),y=Ee({inputs:{x:p},backend:e,attrs:{shape:[-1,g]}}),v=kd(o.dtype),w=Ji(y,v,"prod",e);f=Ee({inputs:{x:w},backend:e,attrs:{shape:h}}),l.push(y),l.push(w)}if(s){l.push(f);let h=T.expandShapeToKeepDim(f.shape,c);f=Ee({inputs:{x:f},backend:e,attrs:{shape:h}})}return l.forEach(h=>e.disposeIntermediateTensorInfo(h)),f}var Poe={kernelName:eu,backendName:"webgl",kernelFunc:Cze};function _ze(n){let{inputs:t,backend:e,attrs:r}=n,{paramsNestedSplits:o,paramsDenseValues:i,indices:s}=t,{outputRaggedRank:a}=r,l=o.map(y=>e.readSync(y.dataId)),c=o.map(y=>y.shape),u=e.readSync(i.dataId),d=e.readSync(s.dataId),[p,f,h]=Cte(l,c,u,i.shape,i.dtype,d,s.shape,a),m=p.map(y=>e.makeTensorInfo([y.length],"int32",y)),g=e.makeTensorInfo(h,i.dtype,f);return m.concat([g])}var Foe={kernelName:Ny,backendName:"webgl",kernelFunc:_ze};function Sze(n){let{inputs:t,backend:e}=n,{starts:r,limits:o,deltas:i}=t,s=e.readSync(r.dataId),a=e.readSync(o.dataId),l=e.readSync(i.dataId),[c,u]=_te(s,r.shape,r.dtype,a,o.shape,l,i.shape),d=e.makeTensorInfo([c.length],"int32",c),p=e.makeTensorInfo([u.length],r.dtype,u);return[d,p]}var Loe={kernelName:Ay,backendName:"webgl",kernelFunc:Sze};function Ize(n){let{inputs:t,backend:e,attrs:r}=n,{shape:o,values:i,defaultValue:s,rowPartitionTensors:a}=t,{rowPartitionTypes:l}=r,c=e.readSync(o.dataId),u=e.readSync(i.dataId),d=e.readSync(s.dataId),p=a.map(g=>e.readSync(g.dataId)),f=a.map(g=>g.shape),[h,m]=Ste(c,o.shape,u,i.shape,i.dtype,d,s.shape,p,f,l);return e.makeTensorInfo(h,i.dtype,m)}var $oe={kernelName:Ry,backendName:"webgl",kernelFunc:Ize};var v3=n=>{let{backend:t,attrs:e}=n,{start:r,stop:o,step:i,dtype:s}=e,a=Ite(r,o,i,s);return t.makeTensorInfo([a.length],s,a)},Voe={kernelName:af,backendName:"webgl",kernelFunc:v3};var Eze="return 1.0 / x;",Tze=Ze({opSnippet:Eze}),Boe={kernelName:ll,backendName:"webgl",kernelFunc:Tze};var Dze=Br+`
  return (x < 0.0) ? 0.0 : x;
`,kze=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Nze=Ze({opSnippet:Dze,packedOpSnippet:kze}),zoe={kernelName:cl,backendName:"webgl",kernelFunc:Nze};var Aze=Br+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Rze=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Oze=Ze({opSnippet:Aze,packedOpSnippet:Rze}),Uoe={kernelName:ul,backendName:"webgl",kernelFunc:Oze};var ek=class{constructor(t,e,r,o,i){this.variableNames=["A"],this.outputShape=[];let[s,a,l,c]=t;this.outputShape=[s,e,r,c];let u=[o&&e>1?a-1:a,o&&r>1?l-1:l],d=[o&&e>1?e-1:e,o&&r>1?r-1:r],p;i?p="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":p="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${u[0]/d[0]},
          ${u[1]/d[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${p};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}};var tk=class{constructor(t,e,r,o,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];let[s,a,l,c]=t;this.outputShape=[s,e,r,c];let u=[o&&e>1?a-1:a,o&&r>1?l-1:l],d=[o&&e>1?e-1:e,o&&r>1?r-1:r],p;i?p="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":p="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${u[0]/d[0]},
          ${u[1]/d[1]},
          ${u[1]/d[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${p};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${c-1};
        bool hasNextRow = coords.z < ${r-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}};function Mze(n){let{inputs:t,backend:e,attrs:r}=n,{images:o}=t,{alignCorners:i,halfPixelCenters:s,size:a}=r,[l,c]=a,u=q().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new tk(o.shape,l,c,i,s):new ek(o.shape,l,c,i,s);return e.runWebGLProgram(u,[o],"float32")}var Woe={kernelName:ru,backendName:"webgl",kernelFunc:Mze};var nk=class{constructor(t,e,r){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e;let[,o,i]=e,[,s,a]=t,l=[r&&s>1?o-1:o,r&&a>1?i-1:i],c=[r&&s>1?s-1:s,r&&a>1?a-1:a],u=l[0]/c[0],d=l[1]/c[1],p=1/u,f=1/d,h=Math.ceil(p)*2+2,m=Math.ceil(f)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${u});
        const float widthScale = float(${d});

        const float invHeightScale = float(${p});
        const float invWidthScale = float(${f});

        const int winHeight = int(${h});
        const int winWidth = int(${m});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${s}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${o-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${i-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}};function Pze(n){let{inputs:t,backend:e,attrs:r}=n,{images:o,dy:i}=t,{alignCorners:s}=r,a=new nk(i.shape,o.shape,s);return e.runWebGLProgram(a,[i],i.dtype)}var Goe={kernelName:uf,backendName:"webgl",kernelFunc:Pze};var rk=class{constructor(t,e,r,o,i){this.variableNames=["A"],this.outputShape=[];let[s,a,l,c]=t;this.outputShape=[s,e,r,c];let u=[o&&e>1?a-1:a,o&&r>1?l-1:l],d=[o&&e>1?e-1:e,o&&r>1?r-1:r],p=o?"0.5":"0.0",f;i?f="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":f="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${u[0]/d[0]},
          ${u[1]/d[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${f};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${p})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}};var ok=class{constructor(t,e,r,o,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];let[s,a,l,c]=t;this.outputShape=[s,e,r,c];let u=[o&&e>1?a-1:a,o&&r>1?l-1:l],d=[o&&e>1?e-1:e,o&&r>1?r-1:r],p=o?"0.5":"0.0",f;i?f="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":f="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${u[0]/d[0]},
          ${u[1]/d[1]},
          ${u[1]/d[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${f};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${p})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${c-1};
        bool hasNextRow = coords.z < ${r-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}};function Fze(n){let{inputs:t,backend:e,attrs:r}=n,{images:o}=t,{alignCorners:i,halfPixelCenters:s,size:a}=r,[l,c]=a,u=q().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new ok(o.shape,l,c,i,s):new rk(o.shape,l,c,i,s);return e.runWebGLProgram(u,[o],o.dtype)}var joe={kernelName:nu,backendName:"webgl",kernelFunc:Fze};var ik=class{constructor(t,e,r){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e;let[,o,i]=e,[,s,a]=t,l=[r&&s>1?o-1:o,r&&a>1?i-1:i],c=[r&&s>1?s-1:s,r&&a>1?a-1:a],u=l[0]/c[0],d=l[1]/c[1],p=1/u,f=1/d,h=Math.ceil(p)*2+2,m=Math.ceil(f)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${u});
        const float widthScale = float(${d});

        const float invHeightScale = float(${p});
        const float invWidthScale = float(${f});

        const int winHeight = int(${h});
        const int winWidth = int(${m});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${s}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float sourceFracRow =
              float(${l[0]}) *
                (float(dyR) / float(${c[0]}));

            float sourceFracCol =
                float(${l[1]}) *
                  (float(dyC) / float(${c[1]}));

            int sourceNearestRow = int(min(
                float(int(${o}) - 1),
                ${r} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${i}) - 1),
                ${r} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}};function Lze(n){let{inputs:t,backend:e,attrs:r}=n,{images:o,dy:i}=t,{alignCorners:s}=r,a=new ik(i.shape,o.shape,s);return e.runWebGLProgram(a,[i],i.dtype)}var Hoe={kernelName:cf,backendName:"webgl",kernelFunc:Lze};var sk=class{constructor(t,e){this.variableNames=["x"];let r=t.length;if(r>4)throw new Error(`WebGL backend: Reverse of rank-${r} tensor is not yet supported`);if(this.outputShape=t,r===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${t[0]} - coord - 1));
        }
      `;return}let o=a=>e.indexOf(a)!==-1&&t[a]!==1?`${t[a]} - coords[${a}] - 1`:`coords[${a}]`,i=t.map((a,l)=>o(l)).join(","),s=vt(r);this.userCode=`
      void main() {
        ${s} coords = getOutputCoords();
        setOutput(getX(${i}));
      }
    `}};var ak=class{constructor(t,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;let r=t.length;if(r>4)throw new Error(`WebGL backend: Reverse of rank-${r} tensor is not yet supported`);this.outputShape=t;let o=Cr("rc",r),i=`${o[r-1]} + 1 < ${this.outputShape[r-1]}`,s=`${o[r-2]} + 1 < ${this.outputShape[r-2]}`,a=vt(r);r===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${t[0]} - rc - 1),
            ${t[0]} - rc - 1);
          if(${i}){
              result.g = getChannel(getX(${t[0]} - (rc  + 1) - 1),
                ${t[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${a} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${l(o.slice())};
          if(${i}){
            result.g = ${c(o.slice())};
          }
          if(${s}) {
            result.b = ${u(o.slice())};
            if(${i}) {
              result.a = ${d(o.slice())};
            }
          }
          setOutput(result);
        }
    `;function l(h){return p(h)}function c(h){return h[r-1]="("+h[r-1]+" + 1)",p(h)}function u(h){return h[r-2]="("+h[r-2]+" + 1)",p(h)}function d(h){return h[r-1]="("+h[r-1]+" + 1)",h[r-2]="("+h[r-2]+" + 1)",p(h)}function p(h){let m=t.map((v,w)=>f(w,h)),g=m.join(","),y=m.slice(-2).join(",");return`getChannel(getX(${g}), vec2(${y}))`}function f(h,m){return e.indexOf(h)!==-1&&t[h]!==1?`${t[h]} - ${m[h]} - 1`:`${m[h]}`}}};function $ze(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{dims:i}=r,s=o.shape.length,a=b.parseAxisParam(i,o.shape);if(s===0)return _r({inputs:{x:o},backend:e});let l=q().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new ak(o.shape,a):new sk(o.shape,a);return e.runWebGLProgram(l,[o],o.dtype)}var qoe={kernelName:ou,backendName:"webgl",kernelFunc:$ze};var lk=class{constructor(t,e){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];let r=t[1],o=t[2];this.outputShape=t;let i="";typeof e=="number"?i=`float outputValue = ${e.toFixed(2)};`:i=`
        vec3 fill = vec3(${e.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${i}
          if(coordX >= 0 && coordX < ${o} && coordY >= 0 && coordY < ${r}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}};var Koe={kernelName:Cf,backendName:"webgl",kernelFunc:({inputs:n,attrs:t,backend:e})=>{let{image:r}=n,{radians:o,fillValue:i,center:s}=t,a=e,l=new lk(r.shape,i),[c,u]=T.getImageCenter(s,r.shape[1],r.shape[2]),d=[[c,u,Math.sin(o),Math.cos(o)]];return a.runWebGLProgram(l,[r],r.dtype,d)}};var Vze=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,Bze=Ze({opSnippet:Vze}),Xoe={kernelName:dl,backendName:"webgl",kernelFunc:Bze};var zze="return inversesqrt(x);",Uze=Ze({opSnippet:zze,cpuKernelImpl:Ete}),Yoe={kernelName:pl,backendName:"webgl",kernelFunc:Uze};var oh=class{constructor(t,e,r,o,i,s,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.outputShape=s;let c=vt(i.length),u=vt(s.length),d="";r===1?d="i":r===2&&(d="i, j");let p=`getIndices(${d})`,f="";o===1?f="i":o===2&&(f="i, coords[1]");let h=`getUpdates(${f})`,m="";l&&(m="coords[0], coords[1]");let g=`getDefaultValue(${m})`,y=e>1?"strides[j]":"strides";this.userCode=`
        ${c} strides = ${c}(${i});

        void main() {
          ${u} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${t}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${e}; j++) {
              int index = round(${p});
              flattenedIndex += index * ${y};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${h};
              found = true;
            }
          }
          setOutput(mix(${g}, sum, float(found)));
        }
      `}};var ck=class{constructor(t,e,r,o,i,s,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=s;let c=vt(i.length),u=vt(s.length),d="";r===1?d="i":r===2&&(d="i, j");let p=`getIndices(${d})`,f="";o===1?f="i":o===2&&(f="i, coords[1]");let h=`getUpdates(${f})`,m="";l&&(m="coords[0], coords[1]");let g=`getDefaultValue(${m})`,y=e>1?"strides[j]":"strides",v=e>1?"strides[j + 1]":"strides";this.userCode=`
        ${c} strides = ${c}(${i});

        void main() {
          ${u} coords = getOutputCoords();
          vec4 sum = vec4(0.);
          vec4 found = vec4(0.);
          for (int i = 0; i < ${t}; i+=2) {
            ivec2 flattenedIndex = ivec2(0);
            for (int j = 0; j < ${e}; j+=2) {
              ivec4 index = round(${p});
              flattenedIndex += index.xz * ${y};
              if (j + 1 < ${e}) {
                flattenedIndex += index.yw * ${v};
              }
            }
            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||
                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {
              vec4 updVals = ${h};
              if (flattenedIndex[0] == coords[0]) {
                sum.xy += updVals.xy;
                found.xy = vec2(1.);
              } else if (flattenedIndex[0] == coords[0] + 1) {
                sum.zw += updVals.xy;
                found.zw = vec2(1.);
              }
              if (flattenedIndex[1] == coords[0]) {
                sum.xy += updVals.zw;
                found.xy = vec2(1.);
              } else if (flattenedIndex[1] == coords[0] + 1) {
                sum.zw += updVals.zw;
                found.zw = vec2(1.);
              }
            }
          }
          setOutput(mix(${g}, sum, found));
        }
      `}};function Wze(n){let{inputs:t,backend:e,attrs:r}=n,{indices:o,updates:i}=t,{shape:s}=r,{sliceRank:a,numUpdates:l,sliceSize:c,strides:u,outputSize:d}=T.calculateShapes(i,o,s),p=[d/c,c];if(d===0)return e.makeTensorInfo(s,o.dtype);let f=Ee({inputs:{x:o},backend:e,attrs:{shape:[l,a]}}),h=Ee({inputs:{x:i},backend:e,attrs:{shape:[l,c]}}),m=e.makeTensorInfo([],"float32",new Float32Array([0])),g;q().getBool("WEBGL_PACK")?g=new ck(l,a,f.shape.length,h.shape.length,u,p):g=new oh(l,a,f.shape.length,h.shape.length,u,p);let y=e.runWebGLProgram(g,[h,f,m],h.dtype),v=Ee({inputs:{x:y},backend:e,attrs:{shape:s}});return e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(h),e.disposeIntermediateTensorInfo(y),e.disposeIntermediateTensorInfo(m),v}var Zoe={kernelName:df,backendName:"webgl",kernelFunc:Wze};var uk=class{constructor(t,e,r,o){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[t,r];let i="while (left < right) {",s=`for (int i = 0; i < ${Math.ceil(Math.log2(e+1))}; ++i) { if (left >= right) break;`,a=q().getNumber("WEBGL_VERSION")===2?i:s,l=o==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${a}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${l} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}};function Gze(n){let{inputs:t,backend:e,attrs:r}=n,{sortedSequence:o,values:i}=t,{side:s}=r,a=new uk(o.shape[0],o.shape[1],i.shape[1],s),l=[[o.shape[1]]];return e.runWebGLProgram(a,[o,i],"int32",l)}var Qoe={kernelName:ff,backendName:"webgl",kernelFunc:Gze};var dk=class{constructor(t,e,r){this.variableNames=["c","a","b"],this.outputShape=e;let o,i;if(r>4)throw Error(`Where for rank ${r} is not yet supported`);if(r===1)i="resRC",o="resRC";else{let a=["resRC.x","resRC.y","resRC.z","resRC.w"],l=[],c=[];for(let u=0;u<e.length;u++)c.push(`${a[u]}`),u<t&&l.push(`${a[u]}`);o=l.join(),i=c.join()}let s=vt(r);this.userCode=`
      void main() {
        ${s} resRC = getOutputCoords();
        float cVal = getC(${o});
        if (cVal >= 1.0) {
          setOutput(getA(${i}));
        } else {
          setOutput(getB(${i}));
        }
      }
    `}};function jze(n){let{inputs:t,backend:e}=n,{condition:r,t:o,e:i}=t,s=new dk(r.shape.length,o.shape,o.shape.length);return e.runWebGLProgram(s,[r,o,i],En(o.dtype,i.dtype))}var Joe={kernelName:iu,backendName:"webgl",kernelFunc:jze};var Hze=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${T.SELU_SCALEALPHA};
  float scale = ${T.SELU_SCALE};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,qze=Ze({opSnippet:Hze}),eie={kernelName:fl,backendName:"webgl",kernelFunc:qze};var Kze=aa+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,Xze=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Yze=Ze({opSnippet:Kze,packedOpSnippet:Xze,cpuKernelImpl:Dte}),tie={kernelName:yl,backendName:"webgl",kernelFunc:Yze};var Zze=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,Qze=Ze({opSnippet:Zze}),nie={kernelName:gl,backendName:"webgl",kernelFunc:Qze};var Jze=aa+`
  return sin(x);
`,eUe=`
  vec4 result = sin(x);
  bvec4 isNaN = isnan(x);
  ${Qi}
  return result;
`,tUe=Ze({opSnippet:Jze,packedOpSnippet:eUe}),rie={kernelName:hl,backendName:"webgl",kernelFunc:tUe};var nUe=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,rUe=Ze({opSnippet:nUe}),oie={kernelName:ml,backendName:"webgl",kernelFunc:rUe};var oUe=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,iUe=Ze({opSnippet:oUe}),iie={kernelName:xl,backendName:"webgl",kernelFunc:iUe};var sUe=n=>{let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{blockShape:i,paddings:s}=r;b.assert(o.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");let a=i.reduce((y,v)=>y*v),l=[[0,0]];l.push(...s);for(let y=1+i.length;y<o.shape.length;++y)l.push([0,0]);let c=[],u=x3({inputs:{x:o},backend:e,attrs:{paddings:l,constantValue:0}}),d=T.getReshaped(u.shape,i,a,!1),p=T.getPermuted(d.length,i.length,!1),f=T.getReshapedPermuted(u.shape,i,a,!1),h=Ee({inputs:{x:u},backend:e,attrs:{shape:d}}),m=Yn({inputs:{x:h},backend:e,attrs:{perm:p}}),g=Ee({inputs:{x:m},backend:e,attrs:{shape:f}});return c.push(u),c.push(h),c.push(m),c.forEach(y=>e.disposeIntermediateTensorInfo(y)),g},sie={kernelName:lu,backendName:"webgl",kernelFunc:sUe};function aUe(n){let{inputs:t,backend:e}=n,{indices:r,values:o,denseShape:i,defaultValue:s}=t;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${i.shape}`);if(r.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${r.shape}`);if(o.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${o.shape}`);if(s.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${s.shape}`);let a=e.readSync(r.dataId),l=e.readSync(o.dataId),c=e.readSync(i.dataId),u=e.readSync(s.dataId)[0],[d,p,f,h,m]=Nte(a,r.shape,r.dtype,l,o.dtype,c,u);return[e.makeTensorInfo(p,r.dtype,d),e.makeTensorInfo([p[0]],o.dtype,f),e.makeTensorInfo([h.length],"bool",new Uint8Array(h.map(g=>Number(g)))),e.makeTensorInfo([m.length],r.dtype,new Int32Array(m))]}var aie={kernelName:Oy,backendName:"webgl",kernelFunc:aUe};function lUe(n){let{inputs:t,backend:e}=n,{inputIndices:r,inputShape:o,newShape:i}=t;if(r.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${r.shape}`);if(o.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${o.shape}`);if(i.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${i.shape}`);let s=Array.from(e.readSync(o.dataId)),a=e.readSync(r.dataId),l=Array.from(e.readSync(i.dataId)),[c,u,d]=Ate(a,r.shape,r.dtype,s,l);return[e.makeTensorInfo(u,r.dtype,c),e.makeTensorInfo([d.length],i.dtype,new Int32Array(d))]}var lie={kernelName:My,backendName:"webgl",kernelFunc:lUe};function cUe(n){let{inputs:t,backend:e}=n,{data:r,indices:o,segmentIds:i}=t;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(o.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${o.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${i.shape}`);let s=e.readSync(r.dataId),a=e.readSync(o.dataId),l=e.readSync(i.dataId),[c,u]=HT(s,r.shape,r.dtype,a,l,!0);return e.makeTensorInfo(u,r.dtype,c)}var cie={kernelName:hf,backendName:"webgl",kernelFunc:cUe};function uUe(n){let{inputs:t,backend:e}=n,{data:r,indices:o,segmentIds:i}=t;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(o.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${o.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${i.shape}`);let s=e.readSync(r.dataId),a=e.readSync(o.dataId),l=e.readSync(i.dataId),[c,u]=HT(s,r.shape,r.dtype,a,l);return e.makeTensorInfo(u,r.dtype,c)}var uie={kernelName:mf,backendName:"webgl",kernelFunc:uUe};function dUe(n){let{inputs:t,backend:e,attrs:r}=n,{sparseIndices:o,sparseValues:i,defaultValue:s}=t,{outputShape:a}=r,{sliceRank:l,numUpdates:c,sliceSize:u,strides:d,outputSize:p}=T.calculateShapes(i,o,a),f=!1;if(i.dtype==="string"){let y=e.bufferSync(o),v=e.bufferSync(i),w=b.decodeString(e.readSync(s.dataId)[0]),C=Tte(y,v,a,p,u,c,l,d,w,f);return e.makeTensorInfo(a,C.dtype,C.values)}let h=new oh(c,l,o.shape.length,i.shape.length,d,[p,1],f),m=e.runWebGLProgram(h,[i,o,s],i.dtype),g=Ee({inputs:{x:m},backend:e,attrs:{shape:a}});return e.disposeIntermediateTensorInfo(m),g}var die={kernelName:gf,backendName:"webgl",kernelFunc:dUe};function pUe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{numOrSizeSplits:i,axis:s}=r,a=b.parseAxisParam(s,o.shape)[0],l=T.prepareSplitSize(o,i,a),c=o.shape.length,u=new Array(c).fill(0),d=o.shape.slice();return l.map(p=>{let f=[...d];f[a]=p;let h=Wl({inputs:{x:o},backend:e,attrs:{begin:u,size:f}});return u[a]+=p,h})}var pie={kernelName:cu,backendName:"webgl",kernelFunc:pUe};var fie="return sqrt(x);",fUe=Ze({opSnippet:fie,packedOpSnippet:fie,cpuKernelImpl:Rte}),hie={kernelName:vl,backendName:"webgl",kernelFunc:fUe};var hUe="return x * x;",mUe=Ze({opSnippet:hUe}),mie={kernelName:yf,backendName:"webgl",kernelFunc:mUe};var gie="return (a - b) * (a - b);",gUe=un({opSnippet:gie,packedOpSnippet:gie}),yie={kernelName:bl,backendName:"webgl",kernelFunc:gUe};function yUe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t;if(o.dtype!=="string")throw new Error("Input must be of datatype string");let i=e.readSync(o.dataId),s=T.fromUint8ToStringArray(i),a=Ote(s,"string",r);return e.makeTensorInfo(o.shape,"string",a)}var xie={kernelName:Qh,backendName:"webgl",kernelFunc:yUe};function xUe({inputs:n,attrs:t,backend:e}){let{x:r}=n,o=Br+`
    return x > 0.0 ? 1.0 : float(${t.alpha});
  `,i=new go(r.shape,o);return e.runWebGLProgram(i,[r],r.dtype)}var vie={kernelName:Sl,backendName:"webgl",kernelFunc:xUe};var pk=class{constructor(t,e,r){this.variableNames=["x"],this.outputShape=r;let o=r.length,i=vt(r.length),s=vt(r.length),a="";if(o===1)a="coords * strides + begin";else{let l=0;a=r.map((c,u)=>(l++,r.length===1?`coords * strides[${u}] + begin[${u}]`:`coords[${l-1}] * strides[${u}] + begin[${u}]`)).join(",")}this.userCode=`
      ${i} begin = ${i}(${t});
      ${i} strides = ${i}(${e});

      void main() {
        ${s} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}};function vUe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{begin:i,end:s,strides:a,beginMask:l,endMask:c,ellipsisMask:u,newAxisMask:d,shrinkAxisMask:p}=r,{finalShapeSparse:f,finalShape:h,isIdentity:m,sliceDim0:g,isSimpleSlice:y,begin:v,end:w,strides:C}=yr.sliceInfo(o.shape,i,s,a,l,c,u,d,p),I;if(m)I=Ee({inputs:{x:o},backend:e,attrs:{shape:h}});else if(g||y){b.assert(o.shape.length>=1,()=>`Input must have rank at least 1, got: ${o.shape.length}`);let M=yr.computeOutShape(v,w,C),$=Wl({inputs:{x:o},backend:e,attrs:{begin:v,size:M}});I=Ee({inputs:{x:$},backend:e,attrs:{shape:h}}),e.disposeIntermediateTensorInfo($)}else if(e.shouldExecuteOnCPU([o])){let $=e.readSync(o.dataId),V=ze(o.shape,o.dtype,$),W=Mte(f,V,C,v);I=e.makeTensorInfo(h,o.dtype,W.values)}else{let $=new pk(v,C,f);I=e.runWebGLProgram($,[o],o.dtype)}let A=Ee({inputs:{x:I},backend:e,attrs:{shape:h}});return e.disposeIntermediateTensorInfo(I),A}var bie={kernelName:xf,backendName:"webgl",kernelFunc:vUe};function bUe(n){let{inputs:t,backend:e,attrs:r}=n,{separator:o,nGramWidths:i,leftPad:s,rightPad:a,padWidth:l,preserveShortSequences:c}=r,{data:u,dataSplits:d}=t,p=e.readSync(u.dataId),f=e.readSync(d.dataId),[h,m]=Pte(p,f,o,i,s,a,l,c);return[e.makeTensorInfo([h.length],"string",h),e.makeTensorInfo(d.shape,"int32",m)]}var wie={kernelName:vf,backendName:"webgl",kernelFunc:bUe};function wUe(n){let{inputs:t,backend:e,attrs:r}=n,{skipEmpty:o}=r,{input:i,delimiter:s}=t;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(i.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${i.shape}`);if(s.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${s.shape}`);let a=e.readSync(i.dataId),l=e.readSync(s.dataId)[0],[c,u,d]=Fte(a,l,o),p=u.length;return[e.makeTensorInfo([p,2],"int32",c),e.makeTensorInfo([p],"string",u),e.makeTensorInfo([2],"int32",new Int32Array(d))]}var Cie={kernelName:Py,backendName:"webgl",kernelFunc:wUe};function CUe(n){let{inputs:t,backend:e,attrs:r}=n,{numBuckets:o}=r,{input:i}=t;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(o<=0)throw new Error("Number of buckets must be at least 1");let s=e.readSync(i.dataId),a=Lte(s,o);return e.makeTensorInfo(i.shape,"int32",a)}var _ie={kernelName:Fy,backendName:"webgl",kernelFunc:CUe};var _Ue="return tan(x);",SUe=Ze({opSnippet:_Ue}),Sie={kernelName:Cl,backendName:"webgl",kernelFunc:SUe};var IUe=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,EUe=Ze({opSnippet:IUe}),Iie={kernelName:_l,backendName:"webgl",kernelFunc:EUe};function TUe(n){let{inputs:t,backend:e,attrs:r}=n,{tensor:o,indices:i,updates:s}=t,{}=r,{sliceRank:a,numUpdates:l,sliceSize:c,strides:u,outputSize:d}=T.calculateShapes(s,i,o.shape),p=[d/c,c];if(d===0)return e.makeTensorInfo(o.shape,i.dtype);let f=Ee({inputs:{x:i},backend:e,attrs:{shape:[l,a]}}),h=Ee({inputs:{x:s},backend:e,attrs:{shape:[l,c]}}),m=Ee({inputs:{x:o},backend:e,attrs:{shape:p}}),g=new oh(l,a,f.shape.length,h.shape.length,u,p,!1,!0),y=e.runWebGLProgram(g,[h,f,m],m.dtype),v=Ee({inputs:{x:y},backend:e,attrs:{shape:o.shape}});return e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(h),e.disposeIntermediateTensorInfo(m),e.disposeIntermediateTensorInfo(y),v}var Eie={kernelName:pf,backendName:"webgl",kernelFunc:TUe};var fk=class{constructor(t,e){this.variableNames=["A"];let r=new Array(t.length);for(let s=0;s<r.length;s++)r[s]=t[s]*e[s];this.outputShape=r,this.rank=r.length;let o=vt(this.rank),i=DUe(t);this.userCode=`
      void main() {
        ${o} resRC = getOutputCoords();
        setOutput(getA(${i}));
      }
    `}};function DUe(n){let t=n.length;if(t>5)throw Error(`Tile for rank ${t} is not yet supported`);if(t===1)return`imod(resRC, ${n[0]})`;let e=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[];for(let o=0;o<n.length;o++)r.push(`imod(${e[o]}, ${n[o]})`);return r.join()}function b3(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{reps:i}=r;if(o.dtype==="string"||o.shape.length>5){let l=e.readSync(o.dataId),c=o.dtype==="string"?l.map(p=>b.decodeString(p)):l,u=ze(o.shape,o.dtype,c),d=Vte(u,i);return e.makeTensorInfo(d.shape,d.dtype,d.values)}let s=new fk(o.shape,i);return e.runWebGLProgram(s,[o],o.dtype)}var Tie={kernelName:Bs,backendName:"webgl",kernelFunc:b3};var hk=class{constructor(t){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=t,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}},mk=class{constructor(t){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=t,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}};function Hm(n,t){t!==null&&n.disposeIntermediateTensorInfo(t)}function Die(n){let t=1;for(;t<n;)t*=2;return t}function kUe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{k:i,sorted:s}=r,a=q().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),l=q().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),c=o.shape,u=c[c.length-1];if(e.shouldExecuteOnCPU([o])||u<a||i>l){let W=e.readSync(o.dataId),[K,te]=Bte(W,c,o.dtype,i,s);return[e.makeTensorInfo(K.shape,K.dtype,K.values),e.makeTensorInfo(te.shape,te.dtype,te.values)]}if(i===0)return c[c.length-1]=0,[e.makeTensorInfo(c,o.dtype,[]),e.makeTensorInfo(c,"int32",[])];if(u===1)return[o,Zd({attrs:{shape:c,dtype:"int32",value:0},backend:e})];let d=e.texData.get(o.dataId),p=d!==null&&d.isPacked,f=p?e.unpackTensor(o):o,m=b.sizeFromShape(c)/u,g=Ee({inputs:{x:f},attrs:{shape:[m,u]},backend:e});p&&Hm(e,f);let y=Die(i),v=Die(u),w=null,C=()=>w===null?[g,g]:[g,w],I=(W,K,te)=>{let ee=C(),oe=new hk(te),se=[[u],[w===null?1:0],[Number.NEGATIVE_INFINITY],[W],[K]],fe=w;w=e.runWebGLProgram(oe,ee,"int32",se),Hm(e,fe)};for(let W=1;W<y;W*=2){let K=W*2;for(let te=W;te>=1;te/=2)I(K,te,[m,v])}for(let W=v;W>y;W/=2){let K=C(),te=new mk([m,W/2]),oe=[[u],[w===null?1:0],[y]],ie=w;w=e.runWebGLProgram(te,K,"int32",oe),Hm(e,ie);let se=y/2,fe=se*2;for(let ue=se;ue>=1;ue/=2)I(fe,ue,w.shape)}let A=w;w=Wl({inputs:{x:w},backend:e,attrs:{begin:0,size:[m,i]}}),Hm(e,A);let M=f3({inputs:{x:g,indices:w},backend:e,attrs:{axis:1,batchDims:1}});Hm(e,g);let $=c.slice(0,-1);$.push(i),A=w,w=Ee({inputs:{x:w},attrs:{shape:$},backend:e}),Hm(e,A);let V=M;return M=Ee({inputs:{x:M},attrs:{shape:$},backend:e}),Hm(e,V),[M,w]}var kie={kernelName:bf,backendName:"webgl",kernelFunc:kUe};var gk=class{constructor(t,e,r,o,i,s){this.variableNames=["Image","Transforms"],this.outputShape=s;let a=r==="nearest"?1:2,l;switch(o){case"constant":l=1;break;case"reflect":l=2;break;case"wrap":l=3;break;case"nearest":l=4;break;default:l=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${l} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${t} && 0 <= coordX && coordX < ${e}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${i});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${i});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${e}));
                float mapY = mapCoord(inY, float(${t}));

                if (${a} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}};function NUe(n){let{inputs:t,backend:e,attrs:r}=n,{image:o,transforms:i}=t,{interpolation:s,fillMode:a,fillValue:l,outputShape:c}=r,[u,d,p,f]=o.shape,[h,m]=c??[d,p],g=[u,h,m,f],y=new gk(d,p,s,a,l,g);return e.runWebGLProgram(y,[o,i],"float32")}var Nie={kernelName:wf,backendName:"webgl",kernelFunc:NUe};function AUe(n){let{inputs:t,attrs:e,backend:r}=n,{axis:o}=e,{x:i}=t;Au(i,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");let s=r.readSync(i.dataId),{outputValues:a,outputShape:l,indices:c}=zte(s,o,i.shape,i.dtype);return[r.makeTensorInfo(l,i.dtype,a),r.makeTensorInfo([c.length],"int32",c)]}var Aie={kernelName:Ly,backendName:"webgl",kernelFunc:AUe};function RUe(n){let{inputs:t,backend:e,attrs:r}=n,{value:o}=t,{axis:i}=r;i<0&&(i+=o.shape.length);let s=o,a=s.shape.length,l=o.shape[i],c=new Array(a-1),u=0;for(let m=0;m<a;m++)m!==i&&(c[u++]=s.shape[m]);let d=[],p=new Array(a).fill(0),f=s.shape.slice();f[i]=1;let h=new Array(l);for(let m=0;m<h.length;m++){p[i]=m;let g=Wl({inputs:{x:s},backend:e,attrs:{begin:p,size:f}}),y=Ee({inputs:{x:g},backend:e,attrs:{shape:c}});h[m]=y,d.push(g)}return d.forEach(m=>e.disposeIntermediateTensorInfo(m)),h}var Rie={kernelName:du,backendName:"webgl",kernelFunc:RUe};var yk=class{constructor(t,e){this.variableNames=["x","segmentIds"];let r=t.windowSize,o=t.batchSize,i=t.inSize,s=t.numSegments,a=s*Math.ceil(i/r);this.outputShape=[o,a];let l="0.0",c="sumValue",u=Math.floor(r/4)*4,d=r%4,p=`
        sumValue += dot(values, segFilter);
    `,f="";i%r>0&&(f=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return initializationValue;
        }
      `);let h="";i%r>0&&(h=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${l};

      float getValue(int batch, int inIdx) {
        ${f}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${h}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${s})) * float(${r}));
        int currentSeg = int(mod(float(outIdx), float(${s})));

        float sumValue = 0.0;

        for (int i = 0; i < ${u}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${p}
        }

        int inIdx = inOffset + ${u};
        if (${d===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${p}
        } else if (${d===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${p}
        } else if (${d===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${p}
        }
        setOutput(${c});
      }
    `}};function OUe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,segmentIds:i}=t,{numSegments:s}=r,a=o.shape.length,l=[],c=0,u=T.getAxesPermutation([c],a),d=o;u!=null&&(d=Yn({inputs:{x:o},backend:e,attrs:{perm:u}}),l.push(d),c=T.getInnerMostAxes(1,a)[0]);let p=T.segment_util.computeOutShape(d.shape,c,s),f=b.sizeFromShape([d.shape[c]]),h=Ee({inputs:{x:d},backend:e,attrs:{shape:[-1,f]}});l.push(h);let m=kd(o.dtype),g=(C,I,A,M,$)=>{let V=C.shape[0],W=C.shape[1],K=T.segment_util.segOpComputeOptimalWindowSize(W,$),te={windowSize:K,inSize:W,batchSize:V,numSegments:$},ee=new yk(te,I),oe=e.compileAndRun(ee,[C,A],M);if(l.push(oe),oe.shape[1]===$)return oe;let ie=v3({backend:e,attrs:{start:0,stop:$,step:1,dtype:"float32"}}),se=b3({inputs:{x:ie},backend:e,attrs:{reps:[W/K]}});return l.push(ie),l.push(se),g(oe,I,se,M,$)},y=g(h,"unsortedSegmentSum",i,m,s),v=Ee({inputs:{x:y},backend:e,attrs:{shape:p}}),w=v;if(u!=null){l.push(v);let C=T.getUndoAxesPermutation(u);w=Yn({inputs:{x:w},backend:e,attrs:{perm:C}})}return l.forEach(C=>e.disposeIntermediateTensorInfo(C)),w}var Oie={kernelName:pu,backendName:"webgl",kernelFunc:OUe};var MUe=[mne,yne,xne,vne,wne,Cne,_ne,Sne,Tne,Dne,kne,Nne,Ane,Rne,One,Mne,Pne,Fne,Lne,$ne,Vne,zne,Une,Wne,Gne,Kne,Yne,Zne,ine,Jne,tre,nre,rre,ore,ire,sre,are,lre,cre,ure,fre,hre,mre,gre,yre,xre,vre,bre,wre,Cre,_re,Sre,Ire,Ere,Tre,Dre,Nre,Are,Rre,Ore,Pre,Fre,Lre,$re,Vre,Bre,zre,Ure,Wre,one,Gre,ere,jre,Hre,qre,sne,Kre,Xre,Yre,Zre,Qre,Jre,eoe,toe,noe,roe,ioe,soe,aoe,loe,coe,uoe,poe,hoe,moe,goe,yoe,xoe,_oe,cne,Soe,Ioe,Eoe,Toe,jne,Doe,Aoe,Roe,Ooe,Moe,ane,Poe,Foe,Loe,$oe,Voe,Hne,voe,Boe,zoe,Uoe,dne,Woe,Goe,joe,Hoe,qoe,Koe,Xoe,Yoe,Zoe,Qoe,Joe,eie,tie,nie,rie,oie,Bne,Coe,iie,sie,aie,lie,cie,uie,die,pie,hie,mie,yie,xie,vie,bie,wie,Cie,_ie,woe,fne,Sie,Iie,Eie,Tie,kie,Nie,hne,Aie,Rie,Oie,koe];for(let n of MUe)Vy(n);var uue=rg(Pie());var bs=q();bs.registerFlag("WEBGPU_DEFERRED_SUBMIT_BATCH_SIZE",()=>15);bs.registerFlag("WEBGPU_CPU_FORWARD",()=>!0);bs.registerFlag("WEBGPU_MATMUL_PROGRAM_TYPE",()=>-1);bs.registerFlag("WEBGPU_USE_NAIVE_CONV2D_TRANSPOSE",()=>!0);bs.registerFlag("WEBGPU_USE_LOW_POWER_GPU",()=>!1);bs.registerFlag("WEBGPU_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e3);bs.registerFlag("WEBGPU_USE_PROFILE_TOOL",()=>!1);bs.registerFlag("WEBGPU_IMPORT_EXTERNAL_TEXTURE",()=>!0);bs.registerFlag("WEBGPU_USE_NAIVE_CONV2D_DEBUG",()=>!1);bs.registerFlag("WEBGPU_THRESHOLD_TO_INCREASE_WORKGROUPS_FOR_MATMUL",()=>-1);bs.registerFlag("WEBGPU_CONV_SEPARATE_IM2COL_SHADER",()=>!1);bs.registerFlag("WEBGPU_PRINT_SHADER",()=>"");bs.registerFlag("WEBGPU_ENGINE_COMPILE_ONLY",()=>!1);var xk=class{constructor(t){t&&(this.vendor=t.vendor,this.architecture=t.architecture,this.intelGPUGeneration=this.getIntelGPUGeneration())}getIntelGPUGeneration(){if(this.isIntel()){if(this.architecture.startsWith("gen"))return Number(this.architecture.match(/\d+/));if(this.architecture.startsWith("xe"))return 12}return 0}isIntel(){return this.vendor==="intel"}};var vk=class{constructor(t){this.device=t,this.numUsedBuffers=0,this.numFreeBuffers=0,this.freeBuffers=new Map,this.usedBuffers=new Map,this.numBytesUsed=0,this.numBytesAllocated=0}acquireBuffer(t,e,r=!1,o=!0){let i,s=Fie(t,e);return o?(this.freeBuffers.has(s)||this.freeBuffers.set(s,[]),this.freeBuffers.get(s).length>0?(i=this.freeBuffers.get(s).pop(),this.numFreeBuffers--):(i=this.device.createBuffer({size:t,usage:e,mappedAtCreation:r}),this.numBytesAllocated+=t)):(i=this.device.createBuffer({size:t,usage:e,mappedAtCreation:r}),this.numBytesAllocated+=t),this.usedBuffers.has(s)||this.usedBuffers.set(s,[]),this.usedBuffers.get(s).push(i),this.numUsedBuffers++,this.numBytesUsed+=t,i}releaseBuffer(t,e=!0){if(this.freeBuffers.size===0)return;let r=t.size,o=t.usage,i=Fie(r,o),s=this.usedBuffers.get(i),a=s.indexOf(t);if(a<0)throw new Error("Cannot find the buffer in buffer manager");s[a]=s[s.length-1],s.pop(),this.numUsedBuffers--,this.numBytesUsed-=r,e?(this.freeBuffers.get(i).push(t),this.numFreeBuffers++):(t.destroy(),this.numBytesAllocated-=r)}getNumUsedBuffers(){return this.numUsedBuffers}getNumFreeBuffers(){return this.numFreeBuffers}dispose(){this.freeBuffers.forEach((t,e)=>{t.forEach(r=>{r.destroy()})}),this.usedBuffers.forEach((t,e)=>{t.forEach(r=>{r.destroy()})}),this.freeBuffers=new Map,this.usedBuffers=new Map,this.numUsedBuffers=0,this.numFreeBuffers=0,this.numBytesUsed=0,this.numBytesAllocated=0}};function Fie(n,t){return`${n}_${t}`}var bk=class{constructor(t){this.device=t,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures=new Map,this.usedTextures=new Map,this.numBytesUsed=0,this.numBytesAllocated=0}acquireTexture(t,e,r,o){let i=$ie(r),s=t*e*i,a=Lie(t,e,r,o);if(this.freeTextures.has(a)||this.freeTextures.set(a,[]),this.usedTextures.has(a)||this.usedTextures.set(a,[]),this.numBytesUsed+=s,this.numUsedTextures++,this.freeTextures.get(a).length>0){this.numFreeTextures--;let c=this.freeTextures.get(a).shift();return this.usedTextures.get(a).push(c),c}this.numBytesAllocated+=s;let l=this.device.createTexture({size:[t,e],format:r,usage:o});return this.usedTextures.get(a).push(l),l}releaseTexture(t){if(this.freeTextures.size===0)return;let e=t.width,r=t.height,o=t.format,i=t.usage,s=Lie(e,r,o,i);this.freeTextures.has(s)||this.freeTextures.set(s,[]),this.freeTextures.get(s).push(t),this.numFreeTextures++,this.numUsedTextures--;let a=this.usedTextures.get(s),l=a.indexOf(t);if(l<0)throw new Error("Cannot release a texture that was never provided by this texture manager");a.splice(l,1);let c=$ie(o),u=e*r*c;this.numBytesUsed-=u}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){this.freeTextures.forEach((t,e)=>{t.forEach(r=>{r.destroy()})}),this.usedTextures.forEach((t,e)=>{t.forEach(r=>{r.destroy()})}),this.freeTextures=new Map,this.usedTextures=new Map,this.numUsedTextures=0,this.numFreeTextures=0,this.numBytesUsed=0,this.numBytesAllocated=0}};function Lie(n,t,e,r){return`${n}_${t}_${e}_${r}`}function $ie(n){if(n==="rgba8unorm")return 16;throw new Error(`${n} is not supported!`)}function Vie(n,t){if(Math.max(...n)>5)throw new Error("Cannot symbolically compute strides for rank > 6 tensor.");let e=n.length,r="xyzwuv",o=n.map(s=>`${t}.${r[s]}`),i=new Array(e-1);i[e-2]=o[e-1];for(let s=e-3;s>=0;--s)i[s]=`(${i[s+1]} * ${o[s+1]})`;return i}var es=(n,t,e)=>e==="int32"?`atomicAdd(${n}, bitcast<i32>(${t}));`:`
          {
            var oldValue = 0;
            loop {
              let newValueF32 = bitcast<f32>(oldValue) + (${t});
              let newValue = bitcast<i32>(newValueF32);
              let res = atomicCompareExchangeWeak(${n}, oldValue, newValue);
              if res.exchanged {
                break;
              }
              oldValue = res.old_value;
            }
          }`;var sh=function(n){return n[n.FROM_PIXELS=0]="FROM_PIXELS",n[n.DRAW=1]="DRAW",n}(sh||{}),Wie=(n,t,e,r,o)=>{let i={dtype:r.dtype,shape:r.shape},s=LUe(e,i,t),a=n.createShaderModule({code:s,label:t.constructor.name}),l=q().get("WEBGPU_PRINT_SHADER");if(l!==""){l=l.toLowerCase();let c=l.split(",");(l==="all"||c.some(u=>t.shaderKey.toLowerCase().includes(u)))&&(console.group(t.shaderKey),console.debug(s),console.groupEnd())}return o?n.createComputePipelineAsync({compute:{module:a,entryPoint:"_start"},label:t.constructor.name,layout:"auto"}):n.createComputePipeline({compute:{module:a,entryPoint:"_start"},label:t.constructor.name,layout:"auto"})},At=(n,t="f32")=>{switch(n){case 1:return`${t}`;case 2:return`vec2<${t}>`;case 3:return`vec3<${t}>`;case 4:return`vec4<${t}>`;default:throw new Error(`${n}-component ${t} is not supported.`)}};function zn(n){if(n<=1)return"i32";if(n===2)return"vec2<i32>";if(n===3)return"vec3<i32>";if(n===4)return"vec4<i32>";if(n===5)return"vec5";if(n===6)return"vec6";throw Error(`GPU for rank ${n} is not yet supported`)}function la(n){if(n===0)return"x";if(n===1)return"y";if(n===2)return"z";if(n===3)return"w";if(n===4)return"u";if(n===5)return"v";throw Error(`Index ${n} is not yet supported`)}function de(...n){let t;switch(n.length){case 0:t=`
        fn main()
      `;break;case 1:t=`
        fn main(${n[0]} : i32)
      `;break;default:throw Error("Unreachable")}return t}function Bie(n,t){let e;return e=`
     ${FUe(t)}
      fn _start(@builtin(local_invocation_id) LocalId : vec3<u32>,
                @builtin(global_invocation_id) GlobalId : vec3<u32>,
                @builtin(local_invocation_index) LocalIndex: u32,
                @builtin(workgroup_id) WorkgroupId : vec3<u32>,
                @builtin(num_workgroups) NumWorkgroups : vec3<u32>) {
        localId = LocalId;
        localIndex = LocalIndex;
        globalId = GlobalId;
        numWorkgroups = NumWorkgroups;
        workgroupId = WorkgroupId;
        ${n?"main(getGlobalIndex());":"main();"};
      }
    `,e}function FUe(n){return`
  @compute @workgroup_size(${n.workgroupSize[0]}, ${n.workgroupSize[1]}, ${n.workgroupSize[2]})
`}function LUe(n,t,e){let r=[],o=e.workgroupSize[0]*e.workgroupSize[1]*e.workgroupSize[2];if(e.outputComponent=e.outputComponent?e.outputComponent:1,r.push(`

      var<private> localId: vec3<u32>;
      var<private> localIndex: u32;
      var<private> globalId: vec3<u32>;
      var<private> numWorkgroups: vec3<u32>;
      var<private> workgroupId: vec3<u32>;

      // Only used when the y/z dimension of workgroup size is 1.
      fn getGlobalIndex() -> i32 {
        ${jie(e)?"  return i32(globalId.x);":`  return i32((workgroupId.z * numWorkgroups.x * numWorkgroups.y +
                workgroupId.y * numWorkgroups.x + workgroupId.x) * ${o}u +
                localIndex);
        `}
      }
    `),e.pixelsOpType!=null){let h=e.pixelsOpType===sh.FROM_PIXELS?`@group(0) @binding(0) var<storage, read_write> result: array<${ih(t.dtype,e.outputComponent)}>;`:`@group(0) @binding(1) var<storage, read> inBuf : array<${ih(n[0].dtype,e.outputComponent)}>;`,m=t.shape.length===3?"vec2<i32>":"i32";r.push(`
        struct Uniform {
          outShapeStrides : ${m},
          size            : i32,
          numChannels     : i32,
          alpha           : f32,
        };

        ${h}
        @group(0) @binding(2) var<uniform> uniforms: Uniform;
      `);let g=Uie(e);return[zie,r.join(`
`),Tw(t.shape),e.getUserCode(),Bie(g,e)].join(`
`)}let i,s,a="struct Uniforms { NAN : f32, INFINITY : f32, ";e.variableNames.forEach((h,m)=>{let g=zn(n[m].shape.length);a+=`${h.charAt(0).toLowerCase()+h.slice(1)}Shape : ${g}, `,i=n[m].shape.length-1,s=zn(i),a+=`${h.charAt(0).toLowerCase()+h.slice(1)}ShapeStrides: ${s}, `});let l=zn(t.shape.length);a+=`outShape : ${l}, `,i=t.shape.length-1,s=zn(i),a+=`
         outShapeStrides: ${s}, `,e.size&&(a+="size : i32, "),e.uniforms&&(a+=e.uniforms),a+="};",a=jUe(a),r.push(a),e.atomic?r.push(`
      @group(0) @binding(0) var<storage, read_write> result: array<atomic<i32>>;
    `):r.push(`
      @group(0) @binding(0) var<storage, read_write> result: array<${ih(t.dtype,e.outputComponent)}>;
    `),e.variableNames.forEach((h,m)=>{r.push(`
      @group(0) @binding(${1+m}) var<storage, read> ${h}: array<${e.variableComponents?ih(n[m].dtype,e.variableComponents[m]):ih(n[m].dtype,e.outputComponent)}>;
        `)}),a!==""&&r.push(`
      @group(0) @binding(${1+e.variableNames.length}) var<uniform> uniforms: Uniforms;
      `);let c=UUe(t.shape,e.dispatchLayout),u=[zie,r.join(`
`)+$Ue,Tw(t.shape),c,WUe(t.shape.length)];e.atomic||u.push(GUe(t.shape,t.dtype,e.outputComponent)),e.variableNames.forEach((h,m)=>{u.push(`${Tw(n[m].shape,h)}`)});let d=n.map((h,m)=>zUe(h,t.shape,e.variableComponents?e.variableComponents[m]:e.outputComponent,e.dispatchLayout.x.length===t.shape.length)).join(`
`);u.push(d),u.push(e.getUserCode());let p=Uie(e);return u.push(Bie(p,e)),u.join(`
`)}function Gie(n,t,e){let r=n.shaderKey;if(n.pixelsOpType!=null)return r;let o=[],i=[];t.forEach(u=>{o.push(u.shape),i.push(u.dtype)}),o.push(e.shape),i.push(e.dtype);let s=t.map(u=>T.getBroadcastDims(u.shape,e.shape)),a=t.map(u=>b.arraysEqual(u.shape,e.shape)).join("_"),l=s.map(u=>u.join("_")).join(";"),c=jie(n)?"flatDispatch":"";return r+="_"+(n.workgroupSize?n.workgroupSize.join(","):"")+o.map(u=>u.length).join(",")+i.join(",")+n.variableNames.join(",")+l+a+c,r}var zie=`
  struct vec5 {x: i32, y: i32, z: i32, w: i32, u: i32};
  struct vec6 {x: i32, y: i32, z: i32, w: i32, u: i32, v: i32};

  // Checks whether coordinates lie within the bounds of the shape.
  fn coordsInBounds2D(coord : vec2<i32>, shape : vec2<i32>) -> bool {
    return all(coord >= vec2<i32>(0)) && all(coord < shape);
  }
  fn coordsInBounds3D(coord : vec3<i32>, shape : vec3<i32>) -> bool {
    return all(coord >= vec3<i32>(0)) && all(coord < shape);
  }
  fn coordsInBounds4D(coord : vec4<i32>, shape : vec4<i32>) -> bool {
    return all(coord >= vec4<i32>(0)) && all(coord < shape);
  }

  fn getIndexFromCoords1D(coord : i32, shape : i32) -> i32 {
    return coord;
  }
  fn getIndexFromCoords2D(coords : vec2<i32>, shape : vec2<i32>) -> i32 {
    return dot(coords, vec2<i32>(shape.y, 1));
  }
  fn getIndexFromCoords3D(coords : vec3<i32>, shape : vec3<i32>) -> i32 {
    return dot(coords, vec3<i32>(shape.y * shape.z, shape.z, 1));
  }
  fn getIndexFromCoords4D(coords : vec4<i32>, shape : vec4<i32>) -> i32 {
    return dot(coords, vec4<i32>(
        shape.y * shape.z * shape.w, shape.z * shape.w, shape.w, 1));
  }
  fn getIndexFromCoords5D(coords : vec5, shape : vec5) -> i32 {
    let shapeStrides: vec5 = vec5(shape.y * shape.z * shape.w * shape.u, shape.z * shape.w * shape.u, shape.w * shape.u, shape.u, 1);
    return coords.x*shapeStrides.x + coords.y*shapeStrides.y + coords.z*shapeStrides.z + coords.w*shapeStrides.w + coords.u*shapeStrides.u;
  }
  fn getIndexFromCoords6D(coords : vec6, shape : vec6) -> i32 {
    let shapeStrides: vec6 = vec6(shape.y * shape.z * shape.w * shape.u * shape.v, shape.z * shape.w * shape.u * shape.v, shape.w * shape.u * shape.v, shape.u * shape.v, shape.v, 1);
    return coords.x*shapeStrides.x + coords.y*shapeStrides.y + coords.z*shapeStrides.z + coords.w*shapeStrides.w + coords.u*shapeStrides.u + coords.v*shapeStrides.v;
  }

  // NaN defination in IEEE 754-1985 is :
  //   - sign = either 0 or 1.
  //   - biased exponent = all 1 bits.
  //   - fraction = anything except all 0 bits (since all 0 bits represents infinity).
  // https://en.wikipedia.org/wiki/IEEE_754-1985#Representation_of_non-numbers
  fn isnan(val: f32) -> bool {
    let floatToUint: u32 = bitcast<u32>(val);
    return (floatToUint & 0x7fffffffu) > 0x7f800000u;
  }
  fn isnanVec4(val : vec4<f32>) -> vec4<bool> {
    let floatToUint: vec4<u32> = bitcast<vec4<u32>>(val);
    return (floatToUint & vec4<u32>(0x7fffffffu)) > vec4<u32>(0x7f800000u);
  }
`,$Ue=`
  fn isinf(val: f32) -> bool {
    return abs(val) == uniforms.INFINITY;
  }
`;function Tw(n,t=""){let e=n.length,r=t!==""?`get${t.charAt(0).toUpperCase()+t.slice(1)}CoordsFromIndex`:"getCoordsFromIndex",o=t!==""?`${t.charAt(0).toLowerCase()+t.slice(1)}ShapeStrides`:"outShapeStrides";if(e<=1)return`fn ${r}(index : i32) -> i32 { return index; }`;let i=b.computeStrides(n),s=zn(e),a=[];for(let c=0;c<e;c++)a.push(`d${c}`);if(i.length===1)return`    fn ${r}(index : i32) -> vec2<i32> {
      let d0 = index / uniforms.${o}; let d1 = index - d0 * uniforms.${o};
      return vec2<i32>(d0, d1);
    }`;let l;return l="var index2 = index;"+i.map((c,u)=>{let d=`let ${a[u]} = index2 / uniforms.${o}.${la(u)}`,p=u===i.length-1?`let ${a[u+1]} = index2 - ${a[u]} * uniforms.${o}.${la(u)}`:`index2 = index2 - ${a[u]} * uniforms.${o}.${la(u)}`;return`${d}; ${p};`}).join(""),`
    fn ${r}(index : i32) -> ${s} {
      ${l}
      return ${s}(${a.join(",")});
    }
  `}function VUe(n,t){let e=n.name,r=n.shape.length,o=zn(r),i="get"+e.charAt(0).toUpperCase()+e.slice(1),s=["d0","d1","d2","d3","d4","d5"].slice(0,r),a=s.map(u=>`${u} : i32`).join(", ");if(r<1)return`
      fn ${i}() -> ${At(t)} {
        return ${At(t)}(${e}[0]);
      }
    `;let l=`uniforms.${e.charAt(0).toLowerCase()+e.slice(1)}Shape`,c=`${r}D`;return r===0&&(c="1D"),`
    fn ${i}(${a}) -> ${At(t)} {
      return ${At(t)}(${e}[getIndexFromCoords${c}(${o}(${s.join(",")}),
        ${l})${t===1?"":` / ${t}`}]);
    }
   `}function BUe(n,t,e,r){let o=n.name,i=o.charAt(0).toUpperCase()+o.slice(1),s="get"+i+"ByOutput",a=n.shape.length,l=t.length,c=zn(l);if(b.arraysEqual(n.shape,t)&&r)return`
    fn ${s}Index(globalIndex : i32) -> ${At(e)} {
      return ${At(e)}(${o}[globalIndex]);
    }

    fn ${s}Coords(coords : ${c}) -> ${At(e)} {
      return ${At(e)}(${o}[${l>1?"getOutputIndexFromCoords(coords)":"coords"}${e===1?"":` / ${e}`}]);
    }
    `;let u=T.getBroadcastDims(n.shape,t),d=l-a,p="";if(a===0)return`
    fn ${s}Index(globalIndex : i32) -> ${At(e)}{
      return get${i}();
    }

    fn ${s}Coords(coords : ${c}) -> ${At(e)}{
      return get${i}();
    }
  `;l<2&&u.length>=1?p="coords = 0;":p=u.map(g=>`coords.${la(g+d)} = 0;`).join(`
`);let f="";if(l<2&&a>0)f="coords";else if(l>1){let g=zn(a),y=n.shape.map((v,w)=>`coords.${la(w+d)}`).join(", ");f=`${g}(${y})`}else f="coords";let h=`uniforms.${o.charAt(0).toLowerCase()+o.slice(1)}Shape`,m=`${a}D`;return`
  fn ${s}Index(globalIndex : i32) -> ${At(e)} {
    var coords = getCoordsFromIndex(globalIndex);
    ${p}
    return ${At(e)}(${o}[getIndexFromCoords${m}(${f}, ${h})${e===1?"":` / ${e}`}]);
  }

  fn ${s}Coords(coordsIn : ${c}) -> ${At(e)} {
    var coords = coordsIn;
    ${p}
    return ${At(e)}(${o}[getIndexFromCoords${m}(${f}, ${h})${e===1?"":` / ${e}`}]);
  }
`}function zUe(n,t,e,r){let o=VUe(n,e);return n.shape.length<=t.length&&(o+=BUe(n,t,e,r)),o}function UUe(n,t){let{x:e,y:r=[],z:o=[]}=t,i=n.length,s=e.length+r.length+o.length;if(s!==i)return"";if(e.length===i)return`fn getOutputCoords() -> ${zn(i)}{
    let globalIndex = getGlobalIndex();
    return getCoordsFromIndex(globalIndex);
  }
  `;let a="",l=[e,r,o];for(let p=0;p<l.length;p++){let f=l[p];if(f.length!==0)if(f.length===1)a+=`let d${f[0]} = i32(globalId[${p}]);`;else{let h=Vie(f,"uniforms.outShape");a+=`var index${p} = i32(globalId[${p}]);`;for(let m=0;m<h.length;m++)a+=`let d${f[m]} = index${p} / ${h[m]};`,m===h.length-1?a+=`let d${f[m+1]} = index${p} - d${f[m]} * ${h[m]};`:a+=`index${p} = index${p} - d${f[m]} * ${h[m]};`}}let c=[];for(let p=0;p<s;p++)c.push(`d${p}`);let u=zn(s),d=`fn getOutputCoords() -> ${u} {
  ${a}
`;return c.length===0?d+=`return ${u}(0); }`:d+=`return ${u}(${c.join(",")}); }`,d}function WUe(n){let t="";switch(n){case 0:case 1:t+=`
        fn getOutputIndexFromCoords(coords : i32) -> i32 {
          return coords;
        }
        `;break;case 2:t+=`
        fn getOutputIndexFromCoords(coords : vec2<i32>) -> i32 {
          return dot(coords, vec2<i32>(uniforms.outShapeStrides, 1));
        }
        `;break;case 3:t+=`
        fn getOutputIndexFromCoords(coords : vec3<i32>) -> i32 {
          return dot(coords, vec3<i32>(uniforms.outShapeStrides.x, uniforms.outShapeStrides.y, 1));
        }
        `;break;case 4:t+=`
        fn getOutputIndexFromCoords(coords : vec4<i32>) -> i32 {
          return dot(coords, vec4<i32>(
            uniforms.outShapeStrides.x, uniforms.outShapeStrides.y, uniforms.outShapeStrides.z, 1));
        }
        `;break;case 5:t+=`
        fn getOutputIndexFromCoords(coords : vec5) -> i32 {
          return coords.x * uniforms.outShapeStrides.x +
              coords.y * uniforms.outShapeStrides.y +
              coords.z * uniforms.outShapeStrides.z +
              coords.w * uniforms.outShapeStrides.w +
              coords.u;
        }
        `;break;case 6:t+=`
        fn getOutputIndexFromCoords(coords : vec6) -> i32 {
          return coords.x * uniforms.outShapeStrides.x +
              coords.y * uniforms.outShapeStrides.y +
              coords.z * uniforms.outShapeStrides.z +
              coords.w * uniforms.outShapeStrides.w +
              coords.u * uniforms.outShapeStrides.u +
              coords.v;
        }
        `;break;default:b.assert(!1,()=>`Unsupported ${n}D shape`);break}return t}function jie(n){return n.dispatch[1]===1&&n.dispatch[2]===1}function ih(n,t=1){if(n==="float32")return At(t,"f32");if(n==="int32"||n==="bool")return At(t,"i32");throw new Error(`type ${n} is not supported.`)}function GUe(n,t,e){let r=n.length,o=ih(t,e),i=`fn setOutputAtIndex(flatIndex : i32, value : ${At(e)}) {
      result[flatIndex] = ${o}(value);
    }

    fn setOutputAtIndexI32(flatIndex : i32, value : ${At(e,"i32")}) {
      result[flatIndex] = ${o}(value);
    }
    `;if(r>=2){let s=["d0","d1","d2","d3","d4","d5"].slice(0,r),a=zn(r);i+=`
      fn setOutputAtCoords(${s.map(l=>`${l} : i32`).join(", ")}, value : ${At(e)}) {
        let flatIndex = getOutputIndexFromCoords(${a}(${s.join(", ")}));
        setOutputAtIndex(flatIndex${e===1?"":` / ${e}`}, value);
      }
      fn setOutputAtCoordsI32(${s.map(l=>`${l} : i32`).join(", ")}, value : ${At(e,"i32")}) {
        let flatIndex = getOutputIndexFromCoords(${a}(${s.join(", ")}));
        setOutputAtIndexI32(flatIndex${e===1?"":` / ${e}`}, value);
      }
    `}return i}function jUe(n){let t=/(\w+)\s*:\s*vec(5|6)/g;n=n.replace(t,r=>"@align(16) "+r);let e=/vec(5|6)\s*,\s*(\w+)/g;return n=n.replace(e,(r,o,i)=>`vec${o}, @align(16) ${i}`),n}function Uie(n){return!(n.dispatchLayout.hasOwnProperty("y")&&n.dispatchLayout.y.length!==0||n.dispatchLayout.hasOwnProperty("z")&&n.dispatchLayout.z.length!==0)}var ah={};bn(ah,{GPUBytesPerElement:()=>wk,MatMulProgramType:()=>Gl,assertNotComplex:()=>Aw,computeDispatch:()=>pe,computeWorkPerThreadForConv2d:()=>kw,computeWorkgroupInfoForMatMul:()=>w3,computeWorkgroupSizeForConv2d:()=>Dw,flatDispatchLayout:()=>xe,isWebGPUSupported:()=>Nw,tilesFitEvenlyIntoShape:()=>qUe});var qm=n=>{let t=1;for(let e=0;e<n.length;e++)t*=n[e];return t};function qUe(n,t){if(n.length!==t.length)throw new Error(`Cannot compute whether rank ${n.length} tiles fit evenly into rank ${t.length} shape - ranks must match.`);return t.every((e,r)=>e%n[r]===0)}function pe(n,t,e=[1,1,1],r=[1,1,1]){let[o,i,s]=[Math.ceil(qm(n.x.map(a=>t[a]))/(e[0]*r[0])),n.y?Math.ceil(qm(n.y.map(a=>t[a]))/(e[1]*r[1])):1,n.z?Math.ceil(qm(n.z.map(a=>t[a]))/(e[2]*r[2])):1];return[o,i,s]}function w3(n,t,e,r=!1){let o=[8,8,1],i=[4,4,1];return r||(n<=8&&(i[1]=1),t<=16&&e<=16&&(o[0]=4)),{workgroupSize:o,elementsPerThread:i}}function Dw(n,t,e=!1){if(e)return[8,8,1];let r=qm(n.x.map(i=>t[i])),o=qm(n.y.map(i=>t[i]));return r<=4?[4,16,1]:o<=4?[16,4,1]:[16,16,1]}function kw(n,t,e=!1){if(e)return[4,4,1];let r=qm(n.x.map(i=>t[i])),o=qm(n.y.map(i=>t[i]));return r<=4?[1,2,1]:o<=4?[2,1,1]:[2,2,1]}function xe(n){return{x:n.map((t,e)=>e)}}function wk(n){if(n==="float32"||n==="int32"||n==="bool"||n==="string")return 4;if(n==="complex64")return 8;throw new Error(`Unknown dtype ${n}`)}function Nw(){return!!(typeof globalThis<"u"&&globalThis.navigator&&globalThis.navigator.gpu)}function Aw(n,t){Array.isArray(n)||(n=[n]),n.forEach(e=>{e!=null&&b.assert(e.dtype!=="complex64",()=>`${t} does not support complex64 tensors in the WebGPU backend.`)})}var Gl=function(n){return n[n.MatMulReduceProgram=0]="MatMulReduceProgram",n[n.MatMulSplitKProgram=1]="MatMulSplitKProgram",n[n.MatMulSmallOutputSizeProgram=2]="MatMulSmallOutputSizeProgram",n[n.MatMulPackedProgram=3]="MatMulPackedProgram",n[n.MatMulMax=4]="MatMulMax",n}(Gl||{});var KUe=q().getNumber("WEBGPU_CPU_HANDOFF_SIZE_THRESHOLD"),XUe=(n,t)=>{let e=n.limits.maxComputeWorkgroupsPerDimension,r=t.dispatchLayout,o=t.dispatch;if(o.every(s=>s<=e))return o;b.assert(o[0]>e&&r.y===void 0&&r.z===void 0,()=>"Dispatch size exceeds WebGPU limits in Y or Z dimension.");let i=Math.ceil(Math.sqrt(o[0]));return i>e?(i=Math.ceil(Math.cbrt(o[0])),b.assert(i<=e,()=>"Total dispatch size exceeds WebGPU maximum."),[i,i,i]):[i,i,1]},mv=(()=>{class n extends Ra{nextDataId(){return n.nextDataId++}constructor(e,r){if(super(),this.commandQueueOwnedIds=new WeakSet,this.dispatchCountInPass=0,this.disposed=!1,this.downloadWaitMs=0,this.tensorDataPendingDisposal=[],this.queryResolveBuffer=null,this.querySet=null,this.querySetCount=2,this.stagingPendingDisposal=[],this.uniformPendingDisposal=[],this.uploadWaitMs=0,this.hasReadSyncWarned=!1,this.hasTimestampQueryWarned=!1,!Nw())throw new Error("WebGPU is not supported on this device");this.pipelineCache={},this.device=e,this.queue=e.queue,this.commandEncoder=null,this.computePassEncoder=null,this.adapterInfo=new xk(r),this.supportTimestampQuery=this.device.features.has("timestamp-query"),this.thresholdToIncreaseWorkgroups=this.adapterInfo.intelGPUGeneration>=12?16:8,this.bufferManager=new vk(this.device),this.textureManager=new bk(this.device),this.tensorMap=new md(this,Zr()),q().getBool("WEBGPU_USE_PROFILE_TOOL")&&(this.dummyCanvas=document.createElement("canvas"),this.dummyCanvas.width=1,this.dummyCanvas.height=1,this.dummyContext=this.dummyCanvas.getContext("webgpu"),this.dummyContext.configure({device:e,format:"bgra8unorm"}),document.body.appendChild(this.dummyCanvas))}floatPrecision(){return 32}disposeData(e,r=!1){if(!this.tensorMap.has(e))return!0;let o=this.tensorMap.get(e);return r?o.refCount=0:o.refCount--,o.refCount>0?!1:(o.complexTensorInfos!=null&&(this.disposeData(o.complexTensorInfos.real.dataId),this.disposeData(o.complexTensorInfos.imag.dataId)),this.commandQueueOwnedIds.has(e)?(this.tensorDataPendingDisposal.push(e),!0):(this.releaseResource(e),this.tensorMap.delete(e),!0))}memory(){return{numBytesInGPU:this.bufferManager.numBytesUsed,numBytesAllocatedInGPU:this.bufferManager.numBytesAllocated,unreliable:!1}}releaseResource(e){let r=this.tensorMap.get(e);if(!(!r||!r.resource)){if(r.external){r.resource=null;return}r.resource instanceof GPUBuffer?this.bufferManager.releaseBuffer(r.resource):r.resource instanceof GPUTexture&&this.textureManager.releaseTexture(r.resource),r.resource=null}}refCount(e){return this.tensorMap.has(e)?this.tensorMap.get(e).refCount:0}incRef(e){let r=this.tensorMap.get(e);r.refCount++}decRef(e){if(this.tensorMap.has(e)){let r=this.tensorMap.get(e);r.refCount--}}write(e,r,o){if(o==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");let i={id:this.nextDataId()};return this.tensorMap.set(i,{dtype:o,shape:r,values:e,refCount:1}),i}move(e,r,o,i,s){if(i==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.tensorMap.set(e,{dtype:i,shape:o,values:r,refCount:s})}submitQueue(){this.queue.submit([this.commandEncoder.finish()]),this.commandEncoder=null,this.dispatchCountInPass=0,this.commandQueueOwnedIds=new WeakSet,this.tensorDataPendingDisposal.forEach(e=>{this.releaseResource(e),this.tensorMap.delete(e)}),this.uniformPendingDisposal.forEach(e=>this.bufferManager.releaseBuffer(e)),this.stagingPendingDisposal.forEach(e=>this.bufferManager.releaseBuffer(e,!1)),this.tensorDataPendingDisposal=[],this.uniformPendingDisposal=[],this.stagingPendingDisposal=[]}ensureCommandEncoderReady(){this.commandEncoder||(this.commandEncoder=this.device.createCommandEncoder())}endComputePassEncoder(){this.computePassEncoder&&(this.computePassEncoder.end(),this.computePassEncoder=null)}checkCompileCompletionAsync(){return B(this,null,function*(){let e;try{e=yield Promise.all(Object.values(this.pipelineCache))}catch(r){throw new Error(r.message)}Object.keys(this.pipelineCache).map((r,o)=>{this.pipelineCache[r]=e[o]})})}getBufferData(e){return B(this,null,function*(){if(q().getBool("WEBGPU_ENGINE_COMPILE_ONLY"))return console.warn("The data may be invalid since WEBGPU_ENGINE_COMPILE_ONLY is true, this can only be called when WEBGPU_ENGINE_COMPILE_ONLY is false"),null;let r=e.size,o=this.bufferManager.acquireBuffer(r,GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ);this.ensureCommandEncoderReady(),this.endComputePassEncoder(),this.commandEncoder.copyBufferToBuffer(e,0,o,0,r),this.submitQueue(),yield o.mapAsync(GPUMapMode.READ);let i=o.getMappedRange().slice(0);return o.unmap(),o!=null&&this.bufferManager.releaseBuffer(o),q().getBool("WEBGPU_USE_PROFILE_TOOL")&&(b.assert(this.dummyContext!==void 0,()=>"Fail to get context for profiling tool"),this.dummyContext.getCurrentTexture()),i})}convertAndCacheOnCPU(e,r){let o=this.tensorMap.get(e);return o.values=r,o.values}readSync(e){let r=this.tensorMap.get(e),{values:o,complexTensorInfos:i}=r;if(o!=null||r.dtype==="string")return o;if(r.dtype==="complex64"){let g=this.readSync(i.real.dataId),y=this.readSync(i.imag.dataId),v=b.convertBackendValuesAndArrayBuffer(T.mergeRealAndImagArrays(g,y).buffer,"float32");return this.convertAndCacheOnCPU(e,v),v}this.hasReadSyncWarned||(this.hasReadSyncWarned=!0,console.warn("The performance of synchronously reading data from GPU to CPU is poor on the webgpu backend, please use asynchronous APIs instead."));let s=["opaque","premultiplied"],a=r.resource,l=a.size;b.assert(l%4===0,()=>"Because there is 4 bytes for one pixel, buffer size must be multiple of 4.");let c=l/4,u=new ArrayBuffer(l),d=256,p=256,f=s.map(g=>new OffscreenCanvas(d,p)),h=new OffscreenCanvas(d,p);this.endComputePassEncoder(),f.map((g,y)=>{let v=g.getContext("webgpu");return v.configure({device:this.device,format:"bgra8unorm",usage:GPUTextureUsage.COPY_DST,alphaMode:s[y]}),v.getCurrentTexture()}).map((g,y)=>{let v=d*4,w=(V,W,K)=>{this.ensureCommandEncoderReady(),this.commandEncoder.copyBufferToTexture({buffer:a,bytesPerRow:v,offset:K},{texture:g},{width:V,height:W}),this.submitQueue();let te=h.getContext("2d",{willReadFrequently:!0});te.clearRect(0,0,V,W),te.drawImage(f[y],0,0);let ee=te.getImageData(0,0,V,W).data,oe=s[y],ie=new Uint8ClampedArray(u,K,V*W*4);for(let se=0;se<ie.length;se+=4)if(oe==="premultiplied")ie[se+3]=ee[se+3];else{let fe=ee[se];ie[se]=ee[se+2],ie[se+1]=ee[se+1],ie[se+2]=fe}},C=Math.floor(c/(d*p)),I=d,A=p,M=0;for(let V=0;V<C;V++)w(I,A,M),M+=d*p*4;let $=c%(d*p);A=Math.floor($/d),A>0&&(w(I,A,M),M+=A*(d*4)),I=$%d,I>0&&w(I,1,M)});let m=b.convertBackendValuesAndArrayBuffer(u,r.dtype);return this.convertAndCacheOnCPU(e,m),m}read(e){return B(this,null,function*(){if(!this.tensorMap.has(e))throw new Error(`Tensor ${e} was not registered!`);let r=this.tensorMap.get(e),{values:o}=r;if(o!=null)return o;let i;if(r.dtype==="complex64"){let s=yield Promise.all([this.read(r.complexTensorInfos.real.dataId),this.read(r.complexTensorInfos.imag.dataId)]),a=s[0],l=s[1];i=T.mergeRealAndImagArrays(a,l)}else{let s=yield this.getBufferData(r.resource);i=b.convertBackendValuesAndArrayBuffer(s,r.dtype)}return this.convertAndCacheOnCPU(e,i),i})}copyBuffer(e){let r=e.size,o=e.usage,i=this.bufferManager.acquireBuffer(r,o);return this.ensureCommandEncoderReady(),this.endComputePassEncoder(),this.commandEncoder.copyBufferToBuffer(e,0,i,0,r),this.submitQueue(),i}createTensorFromGPUData(e,r,o){let i=e.buffer;if(o==="complex64")throw new Error("Cannot write to a complex64 dtype. ");let s={id:this.nextDataId()};this.tensorMap.set(s,{dtype:o,shape:r,values:null,refCount:1,external:e.zeroCopy});let a=this.tensorMap.get(s),l=wk(a.dtype)*b.sizeFromShape(a.shape);if(e.buffer.size<l)throw new Error(`GPUBuffer size(${e.buffer.size}) is smaller than tensor size(${l})!`);if((e.buffer.usage&(GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC))!==(GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC))throw new Error("GPUBuffer.usage should include GPUBufferUsage.STORAGE | GPUBufferUsage.COPY_SRC!");return e.zeroCopy!==!0&&(i=this.copyBuffer(i)),a.resource=i,Zr().makeTensorFromDataId(s,r,o,this)}readToGPU(e){let r=this.tensorMap.get(e),{values:o,dtype:i,shape:s,resource:a}=r;if(i==="complex64")throw new Error("Does not support reading buffer for complex64 dtype.");if(a==null)throw o!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");let l=a,c=l.size,u=l.usage,d=this.bufferManager.acquireBuffer(c,u);this.ensureCommandEncoderReady(),this.endComputePassEncoder(),this.commandEncoder.copyBufferToBuffer(a,0,d,0,c),this.submitQueue();let p=this.makeTensorInfo(s,i),f=Zr().makeTensorFromTensorInfo(p),h=this.tensorMap.get(p.dataId);return h.resource=d,{tensorRef:f,buffer:d}}bufferSync(e){let r=this.readSync(e.dataId);if(e.dtype==="string")try{let o=r.map(i=>b.decodeString(i));return ze(e.shape,e.dtype,o)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return ze(e.shape,e.dtype,r)}time(e){return B(this,null,function*(){!this.supportTimestampQuery&&!this.hasTimestampQueryWarned&&(console.warn("This device doesn't support timestamp-query extension. Start Chrome browser with flag --enable-dawn-features=allow_unsafe_apis to try it again. Otherwise, zero will be shown for the kernel time when profiling mode is enabled."),this.hasTimestampQueryWarned=!0);let r=this.activeTimers,o=[],i=!1;this.programTimersStack==null?(this.programTimersStack=o,i=!0):this.activeTimers.push(o),this.activeTimers=o,e();let s=b.flatten(this.activeTimers.map(u=>u.query)).filter(u=>u!=null),a=b.flatten(this.activeTimers.map(u=>u.name)).filter(u=>u!=null);this.activeTimers=r,i&&(this.programTimersStack=null);let l={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},c=yield Promise.all(s);return l.kernelMs=b.sum(c),l.getExtraProfileInfo=()=>c.map((u,d)=>({name:a[d],ms:u})).map(u=>`${u.name}: ${u.ms}`).join(", "),this.uploadWaitMs=0,this.downloadWaitMs=0,l})}makeTensorInfo(e,r,o){return r==="string"&&o!=null&&o.length>0&&b.isString(o[0])&&(o=o.map(s=>b.encodeString(s))),{dataId:this.write(o,e,r),shape:e,dtype:r}}tensorToBinding(e){if(!e)return null;let o=this.tensorMap.get(e.dataId).resource;return o instanceof GPUBuffer?{buffer:o}:o instanceof GPUTexture?o.createView():o}uploadToGPU(e){let r=this.tensorMap.get(e);if(r.resource!=null)return;let o=wk(r.dtype)*b.sizeFromShape(r.shape),i,s=GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST;if(r.values){if(i=this.bufferManager.acquireBuffer(o,s,!0),i.mapState==="unmapped"){let a=this.bufferManager.acquireBuffer(o,GPUBufferUsage.MAP_WRITE|GPUBufferUsage.COPY_SRC,!0,!1),l=a.getMappedRange();r.dtype==="int32"||r.dtype==="bool"?new Int32Array(l).set(r.values):new Float32Array(l).set(r.values),a.unmap(),this.ensureCommandEncoderReady(),this.endComputePassEncoder(),this.commandEncoder.copyBufferToBuffer(a,0,i,0,o),this.stagingPendingDisposal.push(a)}else{let a=i.getMappedRange();r.dtype==="int32"||r.dtype==="bool"?new Int32Array(a).set(r.values):new Float32Array(a).set(r.values),i.unmap()}r.values=null}else i=this.bufferManager.acquireBuffer(o,s);r.resource=i}makeUniforms(e){let r=0,o=0,i=[],s=1;e.forEach(c=>{c.data.length===0&&(c.data=[1]);let u;switch(c.data.length){case 1:u=4;break;case 2:u=8;break;case 3:u=16;break;case 4:u=16;break;case 5:u=16;break;case 6:u=16;break;default:b.assert(!1,()=>`Unsupported ${c.data.length}D shape`)}(o===5||o===6)&&(u=16),u>s&&(s=u),r=Math.ceil(r/u)*u,o=c.data.length,i.push(r),r+=c.data.length*4}),r=Math.ceil(r/s)*s;let a=new ArrayBuffer(r);e.forEach((c,u)=>{let d=i[u];c.type==="int32"?new Int32Array(a,d,c.data.length).set(c.data):c.type==="uint32"?new Uint32Array(a,d,c.data.length).set(c.data):new Float32Array(a,d,c.data.length).set(c.data)});let l=this.bufferManager.acquireBuffer(r,GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM);return this.queue.writeBuffer(l,0,a,0,r),this.uniformPendingDisposal.push(l),{offset:0,size:r,buffer:l}}runWebGPUProgram(e,r,o,i,s){if(s||(s=this.makeTensorInfo(e.outputShape,o)),b.sizeFromShape(s.shape)===0)return this.tensorMap.get(s.dataId).values=b.getTypedArrayFromDType(s.dtype,0),s;this.uploadToGPU(s.dataId),e.dispatch=XUe(this.device,e);let a=r.map((c,u)=>{if(c.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");return this.uploadToGPU(c.dataId),{dtype:this.tensorMap.get(c.dataId).dtype,shape:c.shape,name:e.variableNames[u]}});e.shaderKey=Gie(e,a,s);let l=q().getBool("WEBGPU_ENGINE_COMPILE_ONLY");return e.shaderKey in this.pipelineCache||(this.pipelineCache[e.shaderKey]=Wie(this.device,e,a,s,l)),e.pipeline=this.pipelineCache[e.shaderKey],l||this.recordAndSubmit(e,s,r,i),s}recordAndSubmit(e,r,o,i){if(e.pipeline instanceof Promise)throw new Error("Please call checkCompileCompletionAsync to ensure parallel compilation is done!");let s=[],a=[],l="int32";if(e.pixelsOpType==null){s.push({type:"float32",data:[NaN]},{type:"float32",data:[1/0]}),a=o.concat(r).map(h=>h.shape);let f="int32";a.map(h=>{s.push({type:f,data:h});let m=b.computeStrides(h);s.push({type:f,data:m})})}else{let f=b.computeStrides(r.shape);s.push({type:l,data:f})}if(e.size){let f=b.sizeFromShape(e.outputShape);s.push({type:l,data:[e.outputComponent?f/e.outputComponent:f]})}i&&(s=[...s,...i]);let c=[this.tensorToBinding(r),...o.map(f=>this.tensorToBinding(f)),this.makeUniforms(s)];o.forEach(f=>{this.commandQueueOwnedIds.add(f.dataId)}),this.commandQueueOwnedIds.add(r.dataId);let u=this.device.createBindGroup({layout:e.pipeline.getBindGroupLayout(0),entries:c.map((f,h)=>({binding:h,resource:f}))}),d=this.activeTimers!=null;this.ensureCommandEncoderReady();let p={};d&&this.supportTimestampQuery?(this.endComputePassEncoder(),this.querySet==null&&(this.querySet=this.device.createQuerySet({type:"timestamp",count:this.querySetCount})),p.timestampWrites={querySet:this.querySet,beginningOfPassWriteIndex:0,endOfPassWriteIndex:1},this.computePassEncoder=this.commandEncoder.beginComputePass(p)):this.computePassEncoder||(this.computePassEncoder=this.commandEncoder.beginComputePass(p)),this.computePassEncoder.setPipeline(e.pipeline),this.computePassEncoder.setBindGroup(0,u),this.computePassEncoder.dispatchWorkgroups(e.dispatch[0],e.dispatch[1],e.dispatch[2]),this.dispatchCountInPass++,(d||q().get("WEBGPU_DEFERRED_SUBMIT_BATCH_SIZE")<=this.dispatchCountInPass||e.pixelsOpType===sh.DRAW)&&(this.endComputePassEncoder(),d?this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime()}):this.submitQueue())}getQueryTime(){return B(this,null,function*(){if(!this.supportTimestampQuery)return 0;this.queryResolveBuffer==null&&(this.queryResolveBuffer=this.bufferManager.acquireBuffer(this.querySetCount*8,GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST|GPUBufferUsage.QUERY_RESOLVE)),this.commandEncoder.resolveQuerySet(this.querySet,0,this.querySetCount,this.queryResolveBuffer,0);let e=this.bufferManager.acquireBuffer(this.querySetCount*8,GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST);this.commandEncoder.copyBufferToBuffer(this.queryResolveBuffer,0,e,0,this.querySetCount*8),this.submitQueue(),yield e.mapAsync(GPUMapMode.READ);let r=new BigUint64Array(e.getMappedRange()),o=Number(r[1]-r[0])/1e6;return e.unmap(),this.bufferManager.releaseBuffer(e),o})}shouldExecuteOnCPU(e,r=KUe){return q().getBool("WEBGPU_CPU_FORWARD")&&e.every(o=>this.tensorMap.get(o.dataId).resource==null&&b.sizeFromShape(o.shape)<r)}numDataIds(){return this.tensorMap.numDataIds()-this.tensorDataPendingDisposal.length}dispose(){this.disposed||(this.querySet!=null&&this.querySet.destroy(),this.bufferManager.dispose(),this.textureManager.dispose(),this.disposed=!0)}}return n.nextDataId=0,n})();Nw()&&Hy("webgpu",()=>B(void 0,null,function*(){let n={powerPreference:q().get("WEBGPU_USE_LOW_POWER_GPU")?"low-power":"high-performance"},t=yield navigator.gpu.requestAdapter(n),e={},r=[];t.features.has("timestamp-query")&&r.push("timestamp-query"),t.features.has("bgra8unorm-storage")&&r.push(["bgra8unorm-storage"]),e.requiredFeatures=r;let o=t.limits;e.requiredLimits={maxComputeWorkgroupStorageSize:o.maxComputeWorkgroupStorageSize,maxComputeWorkgroupsPerDimension:o.maxComputeWorkgroupsPerDimension,maxStorageBufferBindingSize:o.maxStorageBufferBindingSize,maxBufferSize:o.maxBufferSize,maxComputeWorkgroupSizeX:o.maxComputeWorkgroupSizeX,maxComputeInvocationsPerWorkgroup:o.maxComputeInvocationsPerWorkgroup};let i=yield t.requestDevice(e),s="info"in t?t.info:"requestAdapterInfo"in t?yield t.requestAdapterInfo():void 0;return new mv(i,s)}),3);var Xe=function(n){return n[n.ADD=0]="ADD",n[n.ATAN2=1]="ATAN2",n[n.COMPLEX_MULTIPLY_IMAG=2]="COMPLEX_MULTIPLY_IMAG",n[n.COMPLEX_MULTIPLY_REAL=3]="COMPLEX_MULTIPLY_REAL",n[n.DIV=4]="DIV",n[n.ELU_DER=5]="ELU_DER",n[n.EQUAL=6]="EQUAL",n[n.FLOOR_DIV=7]="FLOOR_DIV",n[n.GREATER=8]="GREATER",n[n.GREATER_EQUAL=9]="GREATER_EQUAL",n[n.LESS=10]="LESS",n[n.LESS_EQUAL=11]="LESS_EQUAL",n[n.LOGICAL_AND=12]="LOGICAL_AND",n[n.LOGICAL_OR=13]="LOGICAL_OR",n[n.MAX=14]="MAX",n[n.MIN=15]="MIN",n[n.MOD=16]="MOD",n[n.MUL=17]="MUL",n[n.NOT_EQUAL=18]="NOT_EQUAL",n[n.POW=19]="POW",n[n.PRELU=20]="PRELU",n[n.SQUARED_DIFFERENCE=21]="SQUARED_DIFFERENCE",n[n.SUB=22]="SUB",n}(Xe||{}),YUe="let resultTemp = a + b;",ZUe="let resultTemp = atan2(a, b);",QUe="let resultTemp = areal * breal - aimag * bimag;",JUe="let resultTemp = areal * bimag + aimag * breal;",e4e="let resultTemp = a / b;",t4e="let resultTemp = select(a * (b + 1.0), a, b >= b - b);",n4e=`
  let zero = sign(a) * 0 + 0;
  let one = sign(b) * 0 + 1;
  let resultTemp = select(zero, one, a == b);
`,r4e=`
  let remainder =
      select(a % b, round(a % b), (round(a) == a) & (round(b) == b));
  let quotient = (a - remainder) / b;
  let resultTemp =
      round(select(quotient, quotient - 1, sign(remainder) == -sign(b)));
`,o4e=`
  let zero = sign(a) * 0 + 0;
  let one = sign(b) * 0 + 1;
  let resultTemp = select(zero, one, a > b);
`,i4e=`
  let zero = sign(a) * 0 + 0;
  let one = sign(b) * 0 + 1;
  let resultTemp = select(zero, one, a >= b);
`,s4e=`
  let zero = sign(a) * 0 + 0;
  let one = sign(b) * 0 + 1;
  let resultTemp = select(zero, one, a < b);
`,a4e=`
  let zero = sign(a) * 0 + 0;
  let one = sign(b) * 0 + 1;
  let resultTemp = select(zero, one, a <= b);
`,l4e="return f32(a >= 1.0 && b >= 1.0);",c4e=`return (vec4<f32>(a >= vec4<f32>(1.0)) *
  vec4<f32>(b >= vec4<f32>(1.0)));`,u4e="return f32(a >= 1.0 || b >= 1.0);",d4e=`return min(vec4<f32>(a >= vec4<f32>(1.0)) +
  vec4<f32>(b >= vec4<f32>(1.0)), vec4<f32>(1.0));`,p4e="let resultTemp = max(a, b);",f4e="let resultTemp = min(a, b);",h4e=`
  let isNaN = b == 0.;
  var resultTemp = a % b;
  resultTemp = select((resultTemp + b) % b, resultTemp,
      (a < 0. && b < 0.) || (a >= 0. && b > 0.));
`,m4e=`
  let isNaN = !vec4<bool>(b);
  var resultTemp = vec4<f32>(a % b);
  if (!((a[0] < 0. && b[0] < 0.) || (a[0] >= 0. && b[0] > 0.))) {
    resultTemp[0] = (resultTemp[0] + b[0]) % b[0];
  }
  if (!((a[1] < 0. && b[1] < 0.) || (a[1] >= 0. && b[1] > 0.))) {
    resultTemp[1] = (resultTemp[1] + b[1]) % b[1];
  }
  if (!((a[2] < 0. && b[2] < 0.) || (a[2] >= 0. && b[2] > 0.))) {
    resultTemp[2] = (resultTemp[2] + b[2]) % b[2];
  }
  if (!((a[3] < 0. && b[3] < 0.) || (a[3] >= 0. && b[3] > 0.))) {
    resultTemp[3] = (resultTemp[3] + b[3]) % b[3];
  }
`,g4e="let resultTemp = a * b;",y4e=`
  var resultTemp = f32(a != b);
  let valueForNaN = 1.0;
`,x4e=`
  var resultTemp = vec4<f32>(a != b);
  let valueForNaN = 1.0;
`,v4e=`
  let isNaN = a < 0.0 && floor(b) < b;
  if (b == 0.0) {
    return 1.0;
  }
  var resultTemp = select(sign(a) * pow(abs(a), b), pow(abs(a), b),
      round(abs(b) % 2.0) != 1.0);
`,b4e=`
  let isModRound1Bool = vec4<i32>(round(abs(b) % vec4<f32>(2.0))) == vec4<i32>(1);
  let isModRound1 = vec4<f32>(isModRound1Bool);
  let multiplier = sign(a) * isModRound1 + (vec4<f32>(1.0) - isModRound1);
  var resultTemp = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  let isExpZero = b == vec4<f32>(0.0);
  if (isExpZero.r) {
    resultTemp.r = 1.0;
  }
  if (isExpZero.g) {
    resultTemp.g = 1.0;
  }
  if (isExpZero.b) {
    resultTemp.b = 1.0;
  }
  if (isExpZero.a) {
    resultTemp.a = 1.0;
  }
  let isNaN = (a < vec4<f32>(0.0)) & (floor(b) < b);
`,w4e="if (a < 0.0) { return b * a; }  return a;",C4e=`
  let aLessThanZero = vec4<f32>(a < vec4<f32>(0.0));
  return (aLessThanZero * (b * a)) + ((vec4<f32>(1.0) - aLessThanZero) * a);
`,_4e="let resultTemp = (a - b) * (a - b);",S4e="let resultTemp = a - b;";function gv(n,t){let e;do{switch(n){case Xe.ATAN2:e=ZUe;break;case Xe.MAX:e=p4e;break;case Xe.MIN:e=f4e;break;case Xe.MOD:e=t?m4e:h4e;break;case Xe.NOT_EQUAL:e=t?x4e:y4e;break;case Xe.POW:e=t?b4e:v4e;break;default:continue}let r,o,i;return t?(r="isnanVec4",o="vec4<f32>",i="vec4<bool>"):(r="isnan",o="f32",i="bool"),`
      let aIsNaN = ${r}(a);
      let aPostLegalization = select(a, ${o}(42), aIsNaN);
      let bIsNaN = ${r}(b);
      let bPostLegalization = select(b, ${o}(42), bIsNaN);
      let isNaN = false;
      let valueForNaN = uniforms.NAN;
      {
        let a = aPostLegalization;
        let b = bPostLegalization;
        ${e}
        return select(
            resultTemp, ${o}(valueForNaN),
            ${i}(isNaN) | aIsNaN | bIsNaN);
      }
    `}while(!1);switch(n){case Xe.ADD:e=YUe;break;case Xe.COMPLEX_MULTIPLY_IMAG:e=JUe;break;case Xe.COMPLEX_MULTIPLY_REAL:e=QUe;break;case Xe.DIV:e=e4e;break;case Xe.ELU_DER:e=t4e;break;case Xe.EQUAL:e=n4e;break;case Xe.FLOOR_DIV:e=r4e;break;case Xe.GREATER:e=o4e;break;case Xe.GREATER_EQUAL:e=i4e;break;case Xe.LESS:e=s4e;break;case Xe.LESS_EQUAL:e=a4e;break;case Xe.LOGICAL_AND:return t?c4e:l4e;case Xe.LOGICAL_OR:return t?d4e:u4e;case Xe.MUL:e=g4e;break;case Xe.PRELU:return t?C4e:w4e;case Xe.SQUARED_DIFFERENCE:e=_4e;break;case Xe.SUB:e=S4e;break;default:}return`
    ${e}
    return resultTemp;
  `}var Ce=function(n){return n[n.ABS=0]="ABS",n[n.ACOS=1]="ACOS",n[n.ACOSH=2]="ACOSH",n[n.ASIN=3]="ASIN",n[n.ASINH=4]="ASINH",n[n.ATAN=5]="ATAN",n[n.ATANH=6]="ATANH",n[n.CEIL=7]="CEIL",n[n.COS=8]="COS",n[n.COSH=9]="COSH",n[n.ELU=10]="ELU",n[n.ERF=11]="ERF",n[n.EXP=12]="EXP",n[n.EXPM1=13]="EXPM1",n[n.FLOOR=14]="FLOOR",n[n.IS_FINITE=15]="IS_FINITE",n[n.IS_INF=16]="IS_INF",n[n.IS_NAN=17]="IS_NAN",n[n.LINEAR=18]="LINEAR",n[n.LOG=19]="LOG",n[n.LOG1P=20]="LOG1P",n[n.LOGICAL_NOT=21]="LOGICAL_NOT",n[n.NEG=22]="NEG",n[n.RELU=23]="RELU",n[n.RELU6=24]="RELU6",n[n.LEAKYRELU=25]="LEAKYRELU",n[n.RECIPROCAL=26]="RECIPROCAL",n[n.ROUND=27]="ROUND",n[n.RSQRT=28]="RSQRT",n[n.SELU=29]="SELU",n[n.SIGMOID=30]="SIGMOID",n[n.SIGN=31]="SIGN",n[n.SIN=32]="SIN",n[n.SINH=33]="SINH",n[n.SOFTPLUS=34]="SOFTPLUS",n[n.SQRT=35]="SQRT",n[n.SQUARE=36]="SQUARE",n[n.STEP=37]="STEP",n[n.TAN=38]="TAN",n[n.TANH=39]="TANH",n[n.TO_INT=40]="TO_INT",n}(Ce||{}),I4e="return abs(a);",E4e=`
  if (abs(a) > 1.) {
    return uniforms.NAN;
  }
  return acos(a);
`,T4e=`
  if (a < 1.) {
    return uniforms.NAN;
  }
  return acosh(a);
`,D4e=`
  if (abs(a) > 1.) {
    return uniforms.NAN;
  }
  return asin(a);
`,k4e="return asinh(a);",N4e=`
  if (isnan(a)) {
    return uniforms.NAN;
  }
  return atan(a);
`,A4e=`
  if (abs(a) > 1.) {
    return uniforms.NAN;
  }
  if (a == 1.) {
    return uniforms.INFINITY;
  }
  if (a == -1.) {
    return -uniforms.INFINITY;
  }
  return atanh(a);
`,R4e="return ceil(a);",O4e="return cos(a);",M4e=`
  let e2x = exp(-a);
  return (e2x + 1.0 / e2x) / 2.0;
`,P4e="return exp(a) - 1.0;",F4e="if (a >= 0.0) { return a; }  return (exp(a) - 1.0);",L4e=`
  var resFloat = exp(a) - vec4<f32>(1.0);
  if (a.r >= 0.0) {
    resFloat.r = a.r;
  }
  if (a.g >= 0.0) {
    resFloat.g = a.g;
  }
  if (a.b >= 0.0) {
    resFloat.b = a.b;
  }
  if (a.a >= 0.0) {
    resFloat.a = a.a;
  }
  return resFloat;
`,$4e=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  let p = ${T.ERF_P};
  let a1 = ${T.ERF_A1};
  let a2 = ${T.ERF_A2};
  let a3 = ${T.ERF_A3};
  let a4 = ${T.ERF_A4};
  let a5 = ${T.ERF_A5};

  let sign = sign(a);
  let absA = abs(a);
  let t = 1.0 / (1.0 + p * absA);
  return sign * (1.0 - (((((a5 * t + a4) * t) + a3) * t + a2) * t + a1) * t * exp(-absA * absA));
`,V4e="return exp(a);",B4e="return floor(a);",z4e="return f32(!isnan(a) && !isinf(a));",U4e="return f32(isinf(a));",W4e="return f32(isnan(a));",G4e="return a;",j4e=`if (a < 0.0) { return uniforms.NAN; }
  return log(a);`,H4e=`
  if (isnan(a)) { return a; }
  return log(1.0 + a);
`,q4e="return f32(!(a >= 1.0));",K4e="return -a;",X4e="if (a < 0.0) { return uniforms.alpha * a; } return a;",Y4e=`
  let aLessThanZero = vec4<f32>(a < vec4<f32>(0.0));
  return (aLessThanZero * (uniforms.alpha * a)) + ((vec4<f32>(1.0) - aLessThanZero) * a);
`,Z4e="return 1.0 / a;",Q4e="return select(a, 0.0, a < 0.0);",J4e="return clamp(a, 0.0, 6.0);",eWe="return clamp(a, vec4<f32>(0.0, 0.0, 0.0, 0.0), vec4<f32>(6.0, 6.0, 6.0, 6.0));",tWe=`
  return select(a, vec4<f32>(0.0), a < vec4<f32>(0.0));
`,nWe="return round(a);",rWe="return inverseSqrt(a);",oWe=`
  if (a >= 0.0) {
    return ${T.SELU_SCALE} * a;
  } else {
    return ${T.SELU_SCALEALPHA} * (exp(a) - 1.0);
  }
`,iWe="return 1.0 / (1.0 + exp(-1.0 * a));",sWe="return sign(a);",aWe="return sin(a);",lWe=`
  let e2x = exp(a);
  return (e2x - 1.0 / e2x) / 2.0;
`,cWe=`
  let epsilon = 1.1920928955078125e-7;
  let threshold = log(epsilon) + 2.0;

  let too_large = a > -threshold;
  let too_small = a < threshold;
  let exp_a = exp(a);

  if (too_large) {
    return a;
  } else if (too_small) {
    return exp_a;
  } else {
    return log(exp_a + 1.0);
  }
`,uWe="return sqrt(a);",dWe="return a * a;",pWe=`
  if (isnan(a)) {
    return a;
  }

  return select(uniforms.stepAlpha, 1.0, a > 0.0);
`,fWe="return tan(a);",hWe=`
  let e2x = exp(-2.0 * abs(a));
  return sign(a) * (1.0 - e2x) / (1.0 + e2x);
`,mWe="return f32(i32((a)));";function Qd(n,t){switch(n){case Ce.ABS:return I4e;case Ce.ACOS:return E4e;case Ce.ACOSH:return T4e;case Ce.ASIN:return D4e;case Ce.ASINH:return k4e;case Ce.ATAN:return N4e;case Ce.ATANH:return A4e;case Ce.COS:return O4e;case Ce.COSH:return M4e;case Ce.CEIL:return R4e;case Ce.ELU:return t?L4e:F4e;case Ce.ERF:return $4e;case Ce.EXP:return V4e;case Ce.EXPM1:return P4e;case Ce.FLOOR:return B4e;case Ce.IS_FINITE:return z4e;case Ce.IS_INF:return U4e;case Ce.IS_NAN:return W4e;case Ce.LINEAR:return G4e;case Ce.LOG:return j4e;case Ce.LOG1P:return H4e;case Ce.LOGICAL_NOT:return q4e;case Ce.NEG:return K4e;case Ce.LEAKYRELU:return t?Y4e:X4e;case Ce.RECIPROCAL:return Z4e;case Ce.RELU:return t?tWe:Q4e;case Ce.RELU6:return t?eWe:J4e;case Ce.ROUND:return nWe;case Ce.RSQRT:return rWe;case Ce.SELU:return oWe;case Ce.SIGMOID:return iWe;case Ce.SIGN:return sWe;case Ce.SIN:return aWe;case Ce.SINH:return lWe;case Ce.SOFTPLUS:return cWe;case Ce.SQRT:return uWe;case Ce.SQUARE:return dWe;case Ce.STEP:return pWe;case Ce.TAN:return fWe;case Ce.TANH:return hWe;case Ce.TO_INT:return mWe;default:throw new Error(`BinaryType ${n} is not implemented!`)}}function To(n,t=!1,e=!1,r=3){if(n===null)return"";let o="";if(n==="linear")o=Qd(Ce.LINEAR);else if(n==="relu")o=Qd(Ce.RELU,e);else if(n==="elu")o=Qd(Ce.ELU,e);else if(n==="relu6")o=Qd(Ce.RELU6,e);else if(n==="prelu")o=gv(Xe.PRELU,e);else if(n==="sigmoid")o=Qd(Ce.SIGMOID,e);else if(n==="leakyrelu")o=Qd(Ce.LEAKYRELU,e);else throw new Error(`Activation ${n} has not been implemented for the WebGPU backend.`);let s=At(e?4:1),a="";return t?a=`
      fn activation(a : ${s}, coords : vec${r}<i32>) -> ${s} {
        let b = getPreluActivationWeightsByOutputCoords(coords);
        ${o}
      }`:a=`
      fn activation(a : ${s}, coords : vec${r}<i32>) -> ${s} {
        ${o}
      }`,a}function ts(n,t){return`
      ${n?"value = value + getBiasByOutputCoords(coords);":""}
      ${t?"value = activation(value, coords);":""}
      `}function C3(n,t,e=!1,r=!1,o=!1,i=1){b.assert(n&&i===1||!n,()=>`transposeA ${n} is not compatible with component size ${i}`);let s=`
      ${n?"value = getA(batch, col, row);":"value = getA(batch, row, col);"}

    `,a=t?"value = getB(batch, col, row);":"value = getB(batch, row, col);";return`
  fn mm_readA(batch: i32, row: i32, col: i32) -> ${At(i)} {
    var value = ${At(i)}(0.0);
    ${e&&o?s:`
    ${n?"if(row < uniforms.dimAOuter && col < uniforms.dimInner)":"if(row < uniforms.aShape[1] && col < uniforms.aShape[2])"}
    {
      ${s}
    }
    `}
    return value;
  }

  fn mm_readB(batch: i32, row: i32, col: i32) -> ${At(i)} {
    var value = ${At(i)}(0.0);
    ${a}
    return value;
  }
  `}function Rw(n,t,e,r,o=!1,i=!1,s=!1,a=1){return`
  ${C3(e,r,o,i,s,a)}
  fn mm_write(batch: i32, row: i32, col: i32, valueIn: ${At(a)}) {
    ${o&&i?"":"if (row < uniforms.dimAOuter && col < uniforms.dimBOuter)"}
    {
      var value = valueIn;
      let coords = vec3<i32>(batch, row, col);
      ${ts(n,t)}
      setOutputAtCoords(coords[0], coords[1], coords[2], value);
    }
  }
  `}var gWe=(n,t)=>n?`
        mm_Asub[inputRow][inputCol] = mm_readA(batchA,
          kStart + inputRow,
          globalRowStart + inputCol * ${t});
        `:`
        mm_Asub[inputRow][inputCol] = mm_readA(batchA,
          globalRow + innerRow,
          kStart + inputCol * ${t});
        `,yWe=(n,t,e,r)=>{if(n)return`
      for (var k = 0; k < ${r}; k++) {
        let BCached0 = mm_Bsub[k][tileCol];
        let ACached0 = mm_Asub[k][localRow];
        for (var i = 0; i < ${e}; i++) {
          acc[i] = fma(BCached0, vec4<f32>(ACached0[i]), acc[i]);
        }
      }`;{let o="",i="";for(let s=0;s<t;s++)o+=`let BCached${s} = mm_Bsub[k * ${t} + ${s}][tileCol];`,i+=`acc[i] = fma(BCached${s}, vec4<f32>(ACached[${s}]), acc[i]);`;return`
      for (var k = 0; k < ${r/t}; k++) {
        ${o}
        for (var i = 0; i < ${e}; i++) {
          let ACached = mm_Asub[tileRow + i][k];
          ${i}
        }
      }`}};function Km(n,t,e=!1,r=32,o=!1,i=32,s=!1){let a=t[1]*n[1],l=t[0]*n[0],c=e?a:r,u=e?r:a,d=c/t[0],p=r/t[1],f=n[1],h=n[0];return b.assert((e&&d===4&&n[1]===4||!e&&(d===3||d===4))&&c%t[0]===0&&r%t[1]===0&&n[0]===4,()=>`If transposeA ${e} is true, innerElementSize ${d} and workPerThread[1] ${n[1]} must be 4.
          Otherwise, innerElementSize ${d} must be 3 or 4.
      tileAWidth ${c} must be divisible by workgroupSize[0]${t[0]}. tileInner ${r} must be divisible by workgroupSize[1] ${t[1]}. colPerThread ${n[0]} must be 4.`),`
  var<workgroup> mm_Asub : array<array<vec${d}<f32>, ${c/d}>, ${u}>;
  var<workgroup> mm_Bsub : array<array<vec4<f32>, ${l/n[0]}>, ${r}>;

  ${de()} {
    let localRow = i32(localId.y);
    let tileRow = localRow * ${f};
    let tileCol = i32(localId.x);

    let globalRow = i32(globalId.y) * ${f};
    let globalCol = i32(globalId.x) * ${h};
    let batch = ${o?"0":"i32(globalId.z)"};
    let batchA = ${o||!s?"batch":"batch % uniforms.aShape[0]"};
    let batchB = ${o||!s?"batch":"batch % uniforms.bShape[0]"};
    let globalRowStart = i32(workgroupId.y) * ${a};

    let numTiles = ${o?`${Math.ceil(i/r)}`:`(uniforms.dimInner - 1) / ${r} + 1`};
    var kStart = ${o?`i32(globalId.z) * ${i}`:"0"};

    var acc: array<vec4<f32>, ${f}>;

    // Loop over shared dimension.
    let tileRowB = localRow * ${p};
    for (var t = 0; t < numTiles; t++) {
        // Load one tile of A into local memory.
        for (var innerRow = 0; innerRow < ${f}; innerRow++) {
            let inputRow = tileRow + innerRow;
            let inputCol = tileCol;
            ${gWe(e,d)}
        }

        // Load one tile of B into local memory.
        for (var innerRow = 0; innerRow < ${p}; innerRow++) {
            let inputRow = tileRowB + innerRow;
            let inputCol = tileCol;
            mm_Bsub[inputRow][inputCol] = mm_readB(batchB, kStart + inputRow, globalCol);
        }
        kStart = kStart + ${r};
        workgroupBarrier();

        // Compute acc values for a single thread.
        ${yWe(e,d,f,r)}
        workgroupBarrier();
    }

    for (var innerRow = 0; innerRow < ${f}; innerRow++) {
        mm_write(batch, globalRow + innerRow, globalCol, acc[innerRow]);
    }
  }`}var Hie=n=>n?`
        mm_Asub[inputRow][inputCol] = mm_readA(batchA,
          kStart + inputRow,
          globalRowStart + inputCol);
        `:`
        mm_Asub[inputRow][inputCol] = mm_readA(batchA,
          globalRowStart + inputRow,
          kStart + inputCol);
        `,xWe=n=>n?"let ACached = mm_Asub[k][tileRow + innerRow];":"let ACached = mm_Asub[tileRow + innerRow][k];";function Xm(n,t,e=!1,r=32,o=!1,i=32,s=!1,a=!1){let l=n[1]*t[1],c=n[0]*t[0],u=e?l:r,d=e?r:l;b.assert(d%t[1]===0&&u%t[0]===0&&r%t[1]===0,()=>`tileAHight ${d} must be divisible by workgroupSize[1]${t[1]}, tileAWidth ${u} must be divisible by workgroupSize[0]${t[0]}, tileInner ${r} must be divisible by workgroupSize[1]${t[1]}`);let p=d/t[1],f=u/t[0],h=r/t[1],m=n[1],g=n[0],y=s?`
      let localRow = i32(localId.y);
      let localCol = i32(localId.x);
      let globalRowStart = i32(workgroupId.y) * ${l};
      let globalColStart = i32(workgroupId.x) * ${c};

      // Loop over shared dimension.
      for (var t = 0; t < numTiles; t++) {
        // Load one tile of A into local memory.
        for (var inputRow = localRow; inputRow < ${d}; inputRow = inputRow + ${t[1]}) {
          for (var inputCol = localCol; inputCol < ${u}; inputCol = inputCol + ${t[0]}) {
            ${Hie(e)}
          }
        }
        // Load one tile of B into local memory.
        for (var inputRow = localRow; inputRow < ${r}; inputRow = inputRow + ${t[1]}) {
              for (var inputCol = localCol; inputCol < ${c}; inputCol = inputCol + ${t[0]}) {
            mm_Bsub[inputRow][inputCol] = mm_readB(batchB,
              kStart + inputRow,
              globalColStart + inputCol);
          }
        }
        kStart = kStart + ${r};
        workgroupBarrier();

        // Compute acc values for a single thread.
        var BCached : array<f32, ${g}>;
        for (var k = 0; k < ${r}; k++) {
          for (var inner = 0; inner < ${g}; inner++) {
            BCached[inner] = mm_Bsub[k][localCol + inner * ${t[0]}];
          }
          for (var innerRow = 0; innerRow < ${m}; innerRow++) {
            let ACached = ${e?`mm_Asub[k][localRow + innerRow * ${t[1]}];`:`mm_Asub[localRow + innerRow * ${t[1]}][k];`}
            for (var innerCol = 0; innerCol < ${g}; innerCol++) {
              acc[innerRow][innerCol] =
                  fma(ACached, BCached[innerCol], acc[innerRow][innerCol]);
            }
          }
        }
        workgroupBarrier();
      }
      for (var innerRow = 0; innerRow < ${m}; innerRow++) {
        let gRow = globalRowStart + localRow + innerRow * ${t[1]};
        for (var innerCol = 0; innerCol < ${g}; innerCol++) {
          let gCol = globalColStart + localCol + innerCol * ${t[0]};
          mm_write(batch, gRow, gCol, acc[innerRow][innerCol]);
        }
      }
      `:`
  let tileRow = i32(localId.y) * ${m};
  let tileCol = i32(localId.x) * ${g};

  let globalRow = i32(globalId.y) * ${m};
  let globalCol = i32(globalId.x) * ${g};
  let globalRowStart = i32(workgroupId.y) * ${l};

  let tileRowA = i32(localId.y) * ${p};
  let tileColA = i32(localId.x) * ${f};
  let tileRowB = i32(localId.y) * ${h};
  // Loop over shared dimension.
  for (var t = 0; t < numTiles; t++) {
    // Load one tile of A into local memory.
    for (var innerRow = 0; innerRow < ${p}; innerRow++) {
      for (var innerCol = 0; innerCol < ${f}; innerCol++) {
        let inputRow = tileRowA + innerRow;
        let inputCol = tileColA + innerCol;
        ${Hie(e)}
      }
    }

    // Load one tile of B into local memory.
    for (var innerRow = 0; innerRow < ${h}; innerRow++) {
      for (var innerCol = 0; innerCol < ${g}; innerCol++) {
        let inputRow = tileRowB + innerRow;
        let inputCol = tileCol + innerCol;
        mm_Bsub[inputRow][inputCol] = mm_readB(batchB,
          kStart + inputRow,
          globalCol + innerCol);
      }
    }
    kStart = kStart + ${r};
    workgroupBarrier();

    // Compute acc values for a single thread.
    var BCached : array<f32, ${g}>;
    for (var k = 0; k < ${r}; k++) {
      for (var inner = 0; inner < ${g}; inner++) {
        BCached[inner] = mm_Bsub[k][tileCol + inner];
      }

      for (var innerRow = 0; innerRow < ${m}; innerRow++) {
        ${xWe(e)}
        for (var innerCol = 0; innerCol < ${g}; innerCol++) {
          acc[innerRow][innerCol] =
              fma(ACached, BCached[innerCol], acc[innerRow][innerCol]);
        }
      }
    }

    workgroupBarrier();
  }

  for (var innerRow = 0; innerRow < ${m}; innerRow++) {
    for (var innerCol = 0; innerCol < ${g}; innerCol++) {
      mm_write(batch, globalRow + innerRow, globalCol + innerCol,
          acc[innerRow][innerCol]);
    }
  }
  `;return`
    var<workgroup> mm_Asub : array<array<f32, ${u}>, ${d}>;
    var<workgroup> mm_Bsub : array<array<f32, ${c}>, ${r}>;

    ${de()} {
      let batch = ${o?"0":"i32(globalId.z)"};
      let batchA = ${o||!a?"batch":"batch % uniforms.aShape[0]"};
      let batchB = ${o||!a?"batch":"batch % uniforms.bShape[0]"};
      let numTiles = ${o?`${Math.ceil(i/r)}`:`(uniforms.dimInner - 1) / ${r} + 1`};
      var kStart = ${o?`i32(globalId.z) * ${i}`:"0"};

      var acc : array<array<f32, ${g}>, ${m}>;

      // Without this initialization strange values show up in acc.
      for (var innerRow = 0; innerRow < ${m}; innerRow++) {
        for (var innerCol = 0; innerCol < ${g}; innerCol++) {
          acc[innerRow][innerCol] = 0.0;
        }
      }
      ${y}
    }
  `}var vWe=n=>n?`
      mm_readA(batchA, colA, globalRow),
      mm_readA(batchA, colA + 1, globalRow),
      mm_readA(batchA, colA + 2, globalRow),
      mm_readA(batchA, colA + 3, globalRow)
  `:`
      mm_readA(batchA, globalRow, colA),
      mm_readA(batchA, globalRow, colA + 1),
      mm_readA(batchA, globalRow, colA + 2),
      mm_readA(batchA, globalRow, colA + 3)
  `;function bWe(n,t=!1){b.assert(n[1]===1&&n[2]===1,()=>`A linear work group size is required. But got ${n}.`);let e=n[0]*4;return`
    var<workgroup> mm_Asub : array<vec4<f32>, ${n[0]}>;

    ${de()} {
      let tileCol = i32(localId.x);
      let globalCol = i32(globalId.x);
      let globalRow = i32(globalId.y);

      let numTiles = (uniforms.dimInner - 1) / ${e} + 1;
      let batch = i32(globalId.z);
      let batchA = batch % uniforms.aShape[0];
      let batchB = batch % uniforms.bShape[0];
      // Without this initialization strange values show up in acc.
      var acc = 0.0;

      // Loop over shared dimension.
      for (var t = 0; t < numTiles; t++) {
        // Load one tile of A into local memory.
        let colA = t * ${e} + tileCol * 4;
        mm_Asub[tileCol] = vec4<f32>(${vWe(t)});
        workgroupBarrier();

        // Compute acc values for a single thread.
        for (var k = 0; k < ${e/4}; k++) {
          let rowB = t * ${e} + k * 4;
          let BCached = vec4<f32>(mm_readB(batchB, rowB, globalCol),
                              mm_readB(batchB, rowB + 1, globalCol),
                              mm_readB(batchB, rowB + 2, globalCol),
                              mm_readB(batchB, rowB + 3, globalCol));

          let ACached = mm_Asub[k];
          acc = acc + dot(ACached, BCached);
        }

        workgroupBarrier();
      }

      mm_write(batch, globalRow, globalCol, acc);
    }
  `}var Ck=class{constructor(t,e,r=!1,o=!1,i=null,s=null,a=null,l=!1){this.variableNames=["A","B"],this.uniforms="dimAOuter : i32, dimBOuter : i32, dimInner : i32,",this.outputShape=e,this.dispatchLayout={x:[2],y:[1],z:[0]};let c=r?t[1]:t[2];if(this.isVec4=(c%4===0&&!r||e[1]%4===0&&r)&&e[2]%4===0&&!o,this.outputComponent=this.isVec4?4:1,this.isVectorA=e[1]===1&&!r,!this.isVec4&&this.isVectorA)this.elementsPerThread=[1,1,1],this.workgroupSize=[32,1,1];else{let p=w3(e[1],c,e[2],r);this.workgroupSize=p.workgroupSize,this.elementsPerThread=p.elementsPerThread}this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize,this.elementsPerThread);let u=i!=null,d=a!=null;u&&this.variableNames.push("bias"),d&&this.variableNames.push("preluActivationWeights"),this.sequentialAccessByThreads=l,this.transposeA=r,this.transposeB=o,this.addBias=u,this.activation=s,this.hasPreluActivationWeights=d,[this.fitAOuter,this.fitBOuter,this.fitInner]=this.getShapeFit(e[1],e[2],c),this.shaderKey=`matMulPacked_${this.elementsPerThread}_${r}_${o}_${this.activation}_${this.fitAOuter}_${this.fitBOuter}_${this.fitInner}_${this.isVec4}_${this.isVectorA}_${this.sequentialAccessByThreads}`}getShapeFit(t,e,r){let o=this.workgroupSize[1]*this.elementsPerThread[1],i=this.workgroupSize[0]*this.elementsPerThread[0];!this.isVec4&&this.isVectorA?this.tileInner=this.workgroupSize[0]*4:this.tileInner=i;let s=t%o===0,a=e%i===0,l=r%this.tileInner===0;return[s,a,l]}getUserCode(){return`
      ${To(this.activation,this.hasPreluActivationWeights,this.isVec4)}
      ${Rw(this.addBias,this.activation,!1,this.transposeB,this.fitAOuter,this.fitBOuter,this.fitInner,this.isVec4?4:1)}
      ${this.isVec4?Km(this.elementsPerThread,this.workgroupSize,this.transposeA,this.tileInner,!1,null,!0):this.isVectorA?bWe(this.workgroupSize,this.transposeA):Xm(this.elementsPerThread,this.workgroupSize,this.transposeA,this.tileInner,!1,null,this.sequentialAccessByThreads,!0)}
    `}};function wWe(n){return`
    var<workgroup> sumValues : array<f32, ${n}>;
    ${de()} {
      let coords = getOutputCoords();
      let batch = coords[0];
      let batchA = batch % uniforms.aShape[0];
      let batchB = batch % uniforms.bShape[0];
      let row = coords[1];
      let col = coords[2];
      var sum = 0.0;
      let Length = uniforms.dimInner;
      for (var k = i32(localId.x); k < Length; k = k + ${n}) {
        let dataA = mm_readA(batchA, row, k);
        let dataB = mm_readB(batchB, k, col);
        sum = sum + dataA * dataB;
      }
      sumValues[localId.x] = sum;
      workgroupBarrier();

      for(var currentSize = ${n/2}u; currentSize > 1u;
          currentSize = currentSize / 2u) {
        if (localId.x < currentSize)
        {
          sumValues[localId.x] = sumValues[localId.x] + sumValues[localId.x + currentSize];
        }
        workgroupBarrier();
      }

      if (localId.x == 0u) {
        sum = sumValues[0] + sumValues[1];
        mm_write(batch, row, col, sum);
      }
    }
  `}var _k=class{constructor(t,e=!1,r=!1,o=null,i=null,s=null){this.variableNames=["A","B"],this.uniforms="dimAOuter : i32, dimBOuter : i32, dimInner : i32,",this.workgroupSize=[256,1,1],this.outputShape=t,this.dispatchLayout={x:[],y:[1,2],z:[0]},this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize);let a=o!=null,l=s!=null;a&&this.variableNames.push("bias"),l&&this.variableNames.push("preluActivationWeights"),this.transposeA=e,this.transposeB=r,this.addBias=a,this.activation=i,this.hasPreluActivationWeights=l,this.shaderKey=`matMulReduce_${this.activation}_${e}_${r}`}getUserCode(){return`
      ${To(this.activation,this.hasPreluActivationWeights)}
      ${Rw(this.addBias,this.activation,this.transposeA,this.transposeB)}
      ${wWe(this.workgroupSize[0])}
    `}};function CWe(n){let t=n[1],e=n[0],r=t>e?t:e;return`
  var<workgroup> mm_Asub : array<array<f32, ${r}>, ${t}>;
  var<workgroup> mm_Bsub : array<array<f32, ${e}>, ${r}>;

  // If the output size is small for matrix multiplication, avoid to use vec4
  // and handle some elements per thread to optimally utilize the ALU.
  // Read data from global memory to registers firstly, then store them into
  // shared memory, so it is instruction-Level parallelism for arithmetic
  // operations and others handle IO operations between barrier api, makes ALU
  // and load/store units work simultaneously, could improves the performance.
  ${de()} {
    let tileRow = i32(localId.y);
    let tileCol = i32(localId.x);
    let globalRow = i32(globalId.y);
    let globalCol = i32(globalId.x);
    let batch = i32(globalId.z);
    let batchA = batch % uniforms.aShape[0];
    let batchB = batch % uniforms.bShape[0];

    // uniforms.dimInner should be greater than 0.
    let numTiles = (uniforms.dimInner - 1) / ${r} + 1;
    var acc = 0.0;

    var globalColA = tileCol;
    var globalRowB = 0;
    var regA = mm_readA(batchA, globalRow, globalColA);
    var regB0 = mm_readB(batchB, globalRowB + 2 * tileRow, globalCol);
    var regB1 = mm_readB(batchB, globalRowB + 2 * tileRow + 1, globalCol);
    globalColA = globalColA + ${r};
    globalRowB = globalRowB + ${r};

    for (var t = 0; t < numTiles; t = t + 1) {
      mm_Asub[tileRow][tileCol] = regA;
      mm_Bsub[2 * tileRow][tileCol] = regB0;
      mm_Bsub[2 * tileRow + 1][tileCol] = regB1;

      workgroupBarrier();

      regA = mm_readA(batchA, globalRow, globalColA);
      regB0 = mm_readB(batchB, globalRowB + 2 * tileRow, globalCol);
      regB1 = mm_readB(batchB, globalRowB + 2 * tileRow + 1, globalCol);
      globalColA = globalColA + ${r};
      globalRowB = globalRowB + ${r};

      for (var k = 0; k < ${r}; k = k + 1) {
        acc = acc + mm_Asub[tileRow][k] * mm_Bsub[k][tileCol];
      }
      workgroupBarrier();
    }

    mm_write(batch, globalRow, globalCol, acc);
  }
  `}var Sk=class{constructor(t,e,r,o=!1,i=!1,s=null,a=null,l=null){this.variableNames=["A","B"],this.uniforms="dimAOuter : i32, dimBOuter : i32, dimInner : i32,",this.workgroupSize=[16,8,1],this.outputShape=r,this.dispatchLayout={x:[2],y:[1],z:[0]},this.dispatch=[Math.ceil(r[2]/this.workgroupSize[0]),Math.ceil(r[1]/this.workgroupSize[1]),r[0]];let c=s!=null;c&&this.variableNames.push("bias");let u=l!=null;u&&this.variableNames.push("preluActivationWeights"),this.transposeA=o,this.transposeB=i,this.addBias=c,this.activation=a,this.hasPreluActivationWeights=u,this.shaderKey=`matMulSmallOutputSize_${this.activation}_${o}_${i}`}getUserCode(){return`
      ${To(this.activation,this.hasPreluActivationWeights)}
      ${Rw(this.addBias,this.activation,this.transposeA,this.transposeB)}
      ${CWe(this.workgroupSize)}
    `}};var Ik=class{constructor(t,e,r=!1,o=!1){this.variableNames=["A","B"],this.uniforms="dimAOuter : i32, dimBOuter : i32, dimInner : i32,",this.workgroupSize=[8,8,1],this.atomic=!0,this.splitedDimInner=128,b.assert(t[0]===1,()=>"MatMulSplitKProgram only supports batch = 1."),this.outputShape=t,this.dispatchLayout={x:[2],y:[1],z:[0,3]};let i=(r&&this.outputShape[1]%4===0||!r&&e%4===0)&&this.outputShape[2]%4===0;this.elementsPerThread=[4,4,this.splitedDimInner],this.outputComponent=i?4:1,i||(this.outputShape[1]<16&&(this.elementsPerThread[1]=1),this.outputShape[2]<16&&(this.elementsPerThread[0]=1)),this.dispatch=pe(this.dispatchLayout,[this.outputShape[0],this.outputShape[1],this.outputShape[2],e],this.workgroupSize,this.elementsPerThread),this.transposeA=r,this.transposeB=o,this.shaderKey=`matMulSplitK_${r}_${o}_${this.elementsPerThread}_${this.outputComponent}`}getUserCode(){let t=this.outputComponent;return`
      ${C3(!1,this.transposeB,!1,!1,!1,t)}
      fn mm_write(batch: i32, row : i32, col : i32, value : ${At(t)}) {
        if (row < uniforms.dimAOuter && col < uniforms.dimBOuter) {
          let coords = vec3<i32>(batch, row, col);
          let flatIndex = getOutputIndexFromCoords(coords);
          // The problem is that we should initialize output to zero before using.
          // Otherwise, the original value will be added to the result.
          for (var i = 0; i < ${t}; i = i + 1) {
            ${es("&result[flatIndex + i]",`${t>1?"value[i]":"value"}`,"float32")}
          }
        }
      }
      ${t===4?Km(this.elementsPerThread,this.workgroupSize,this.transposeA,32,!0,this.splitedDimInner):Xm(this.elementsPerThread,this.workgroupSize,this.transposeA,32,!0,this.splitedDimInner)}
    `}},Ek=class{constructor(t,e=null,r=null,o=null){this.uniforms="",this.variableNames=["x"],this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=t,this.dispatchLayout=xe(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.addBias=e!=null,this.hasPreluActivationWeights=o!=null,this.activation=r,this.addBias&&this.variableNames.push("bias"),this.hasPreluActivationWeights&&this.variableNames.push("preluActivationWeights"),this.shaderKey=`biasActivation_${r}`}getUserCode(){return`
    ${To(this.activation,this.hasPreluActivationWeights)}
    ${de("index")} {
      if (index < uniforms.size) {
        let coords = getCoordsFromIndex(index);
        var value = getXByOutputIndex(index);
        ${ts(this.addBias,this.activation)}
        setOutputAtIndex(index, value);
      }
    }
    `}};var Tk=class{constructor(t){this.variableNames=[],this.outputShape=[],this.uniforms="value : f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=t,this.dispatchLayout=xe(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="fill"}getUserCode(){return`
    ${de("index")} {
      if (index < uniforms.size) {
        setOutputAtIndex(index, uniforms.value);
      }
    }
  `}};function dr(n){let{backend:t,attrs:e}=n,{shape:r,value:o}=e,{dtype:i}=e;if(i=i||b.inferDtype(o),i==="string"){let s=b.getArrayFromDType(i,b.sizeFromShape(r));return s.fill(o),t.makeTensorInfo(r,i,s)}else{let s=new Tk(r),a=[{type:"float32",data:[o]}];return t.runWebGPUProgram(s,[],i,a)}}var qie={kernelName:qp,backendName:"webgpu",kernelFunc:dr};function $e(n){let{inputs:t,attrs:e}=n,{x:r}=t,{shape:o}=e,i=b.sizeFromShape(r.shape),s=b.inferFromImplicitShape(o,i),a=b.sizeFromShape(s);return b.assert(i===a,()=>`The new shape (${s}) has ${a} elements and the old shape (${r.shape}) has ${i} elements. The new shape and old shape must have the same number of elements.`),n.backend.incRef(r.dataId),{dataId:r.dataId,shape:s,dtype:r.dtype}}var Kie={kernelName:tu,backendName:"webgpu",kernelFunc:$e};function Ym({a:n,b:t,transposeA:e,transposeB:r,backend:o,bias:i=null,preluActivationWeights:s=null,leakyreluAlpha:a=0,activation:l=null}){let c=n.shape.length,u=t.shape.length,d=e?n.shape[c-2]:n.shape[c-1],p=r?t.shape[u-1]:t.shape[u-2],f=e?n.shape[c-1]:n.shape[c-2],h=r?t.shape[u-2]:t.shape[u-1],m=n.shape.slice(0,-2),g=t.shape.slice(0,-2),y=b.sizeFromShape(m),v=b.sizeFromShape(g),C=Zo.assertAndGetBroadcastShape(n.shape.slice(0,-2),t.shape.slice(0,-2)).concat([f,h]);b.assert(d===p,()=>`Error in matMul: inner shapes (${d}) and (${p}) of Tensors with shapes ${n.shape} and ${t.shape} and transposeA=${e} and transposeB=${r} must match.`);let I=e?[y,d,f]:[y,f,d],A=r?[v,h,p]:[v,p,h],M=$e({inputs:{x:n},backend:o,attrs:{shape:I}}),$=$e({inputs:{x:t},backend:o,attrs:{shape:A}}),V=[M,$],W=Math.max(y,v),K=[M,$],te=[{type:"int32",data:[f]},{type:"int32",data:[h]},{type:"int32",data:[d]}],ee,oe,ie=[W,f,h],se=q().get("WEBGPU_MATMUL_PROGRAM_TYPE");if(se<0){let ue=q().getNumber("WEBGPU_THRESHOLD_TO_INCREASE_WORKGROUPS_FOR_MATMUL"),ye=ue>0?ue:o.thresholdToIncreaseWorkgroups,Te=W*Math.ceil(f/32)*Math.ceil(h/32);Te<=ye||f<=8&&Te<=ye*2?W*f*h<=128?se=Gl.MatMulReduceProgram:W===1&&p>=2e3?se=Gl.MatMulSplitKProgram:se=Gl.MatMulSmallOutputSizeProgram:se=Gl.MatMulPackedProgram}switch(se){case Gl.MatMulReduceProgram:ee=new _k(ie,e,r,i,l,s);break;case Gl.MatMulSplitKProgram:{if(oe=dr({backend:o,attrs:{shape:ie,value:0,dtype:n.dtype}}),ee=new Ik(ie,p,e,r),i||l){oe=o.runWebGPUProgram(ee,K,n.dtype,te,oe);let ye=new Ek(oe.shape,i,l,s),Te=null,De=[oe];i&&De.push(i),s&&De.push(s),l==="leakyrelu"&&(Te=[{type:"float32",data:[a]}],ye.uniforms+=" alpha : f32,");let Fe=o.runWebGPUProgram(ye,De,oe.dtype,Te);V.push(oe);let Re=$e({inputs:{x:Fe},backend:o,attrs:{shape:C}});V.push(Fe);for(let Ve of V)o.disposeData(Ve.dataId);return Re}break}case Gl.MatMulSmallOutputSizeProgram:ee=new Sk(I,A,ie,e,r,i,l,s);break;case Gl.MatMulPackedProgram:let ue=o.adapterInfo.isIntel();ee=new Ck(I,ie,e,r,i,l,s,ue);break;default:throw new Error(`Unsupported MatMulProgramType ${se}.`)}i&&K.push(i),s&&K.push(s),l==="leakyrelu"&&(te.push({type:"float32",data:[a]}),ee.uniforms+=" alpha : f32,"),oe=o.runWebGPUProgram(ee,K,n.dtype,te,oe);let fe=$e({inputs:{x:oe},backend:o,attrs:{shape:C}});V.push(oe);for(let ue of V)o.disposeData(ue.dataId);return fe}function _We(n){let{inputs:t,backend:e,attrs:r}=n,{a:o,b:i,bias:s,preluActivationWeights:a}=t,{transposeA:l,transposeB:c,activation:u,leakyreluAlpha:d}=r;return Ym({a:o,b:i,transposeA:l,transposeB:c,backend:e,bias:s,preluActivationWeights:a,leakyreluAlpha:d,activation:u})}var Xie={kernelName:Id,backendName:"webgpu",kernelFunc:_We};var Ow=class{constructor(t,e,r){this.variableNames=["AReal","AImag","BReal","BImag"],this.workgroupSize=[128,1,1],this.size=!0,this.outputShape=T.assertAndGetBroadcastShape(e,r),this.dispatchLayout=xe(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey=`binaryOpComplex_${t}`,this.op=t}getUserCode(){return`
      fn binaryOpComplex(
          areal : f32, aimag : f32, breal : f32, bimag : f32) -> f32 {
        ${gv(this.op,!1)}
      }

      ${de("index")} {
        if(index < uniforms.size) {
          let areal = getARealByOutputIndex(index);
          let aimag = getAImagByOutputIndex(index);
          let breal = getBRealByOutputIndex(index);
          let bimag = getBImagByOutputIndex(index);
          setOutputAtIndex(index, binaryOpComplex(areal, aimag, breal, bimag));
        }
      }
    `}};var Jd=class{constructor(t,e,r){if(this.size=!0,this.variableNames=["A","B"],this.outputShape=T.assertAndGetBroadcastShape(e,r),this.dispatchLayout=xe(this.outputShape),this.op=t,this.useSharedMemoryWithA=e.length<=1&&r.length>1&&e[0]<128,this.useSharedMemoryWithB=r.length<=1&&e.length>1&&r[0]<128,this.useSharedMemoryWithA||this.useSharedMemoryWithB)this.outputComponent=1,this.variableComponents=[1,1],this.lastDimensionSize=this.useSharedMemoryWithB?r[0]:e[0],this.shaderKey=`binary_${t}_${this.lastDimensionSize}`,this.type="shared",this.workgroupSize=[256,1,1];else{let o=e.length>0&&e[e.length-1]%4===0,i=r.length>0&&r[r.length-1]%4===0;o&&i?(this.outputComponent=4,this.variableComponents=[4,4]):o&&(b.isScalarShape(r)||r[r.length-1]===1)||i&&(b.isScalarShape(e)||e[e.length-1]===1)?(this.outputComponent=4,this.variableComponents=o?[4,1]:[1,4]):(this.outputComponent=1,this.variableComponents=[1,1]),this.type="nonshared",this.shaderKey=`binary_${t}_${this.variableComponents}`,this.workgroupSize=[128,1,1]}this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize,[this.outputComponent,1,1])}getUserCode(){let t,e=this.outputComponent===4?"vec4<f32>":"f32",r=`
    fn binaryOperation(a : ${e}, b : ${e}) -> ${e} {
      ${gv(this.op,this.outputComponent===4)}
    };
    `;if(this.type==="shared"){let o=this.lastDimensionSize>1?`coords[${this.outputShape.length-1}]`:"0",i=this.useSharedMemoryWithB?`let a = getAByOutputIndex(index);
          let b = sharedBuf[${o}];`:`let a = sharedBuf[${o}];
          let b = getBByOutputIndex(index);`;t=`
        ${r}
        var<workgroup> sharedBuf : array<f32, ${this.lastDimensionSize}>;
        ${de("index")} {
          // Fill in the shared memory buffer.
          let localIndex = i32(localId.x);
          if(localIndex < ${this.lastDimensionSize}) {
            sharedBuf[localIndex] = f32(${this.useSharedMemoryWithB?"B":"A"}[localIndex]);
          }
          workgroupBarrier();

          if(index < uniforms.size) {
            let coords = getCoordsFromIndex(index);
            ${i}
            setOutputAtIndex(index, binaryOperation(a, b));
          }
        }
        `}else t=`
       ${r}
       ${de("index")} {
         if (index < uniforms.size) {
           let coords = getCoordsFromIndex(index * ${this.outputComponent});
           let a = ${e}(getAByOutputCoords(coords));
           let b = ${e}(getBByOutputCoords(coords));
           setOutputAtIndex(index, binaryOperation(a, b));
         }
       }
       `;return t}};function Sr(n){let{inputs:t}=n,{x:e}=t;return n.backend.incRef(e.dataId),{dataId:e.dataId,shape:e.shape,dtype:e.dtype}}var Yie={kernelName:Vs,backendName:"webgpu",kernelFunc:Sr};function ws(n){let{inputs:t,backend:e}=n,{real:r,imag:o}=t,i=e.makeTensorInfo(r.shape,"complex64"),s=e.tensorMap.get(i.dataId),a=Sr({inputs:{x:r},backend:e}),l=Sr({inputs:{x:o},backend:e});return s.complexTensorInfos={real:a,imag:l},i}var Zie={kernelName:Op,backendName:"webgpu",kernelFunc:ws};var ns=class{constructor(t,e,r=""){this.variableNames=["A"],this.size=!0;let o=128;this.workgroupSize=[o,1,1],this.outputShape=t,this.dispatchLayout=xe(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.op=e,r!==""&&(this.uniforms=r),this.shaderKey=`unary_${e}`}getUserCode(){return`
      fn unaryOperation(a : f32) -> f32 {
        ${Qd(this.op,!1)}
      }
      ${de("index")} {
        if (index < uniforms.size) {
          let a = getAByOutputIndex(index);
          setOutputAtIndex(index, unaryOperation(a));
        }
      }
      `}};function Qe({opType:n,cpuKernelImpl:t,dtype:e}){return({inputs:r,backend:o})=>{let{x:i}=r,s=o,a=e||i.dtype;if(s.shouldExecuteOnCPU([i])&&t!=null){let c=s.tensorMap.get(i.dataId),u=t(c.values,a);return s.makeTensorInfo(i.shape,a,u)}let l=new ns(i.shape,n);return s.runWebGPUProgram(l,[i],a)}}function rn({opType:n,cpuKernelImpl:t,supportsComplex:e=!1,dtype:r}){return({inputs:o,backend:i})=>{let{a:s,b:a}=o,l=i;if(e&&s.dtype==="complex64"){let d=l.tensorMap.get(s.dataId),p=l.tensorMap.get(a.dataId),f,h;if(n!==Xe.MUL)[f,h]=[[d.complexTensorInfos.real,p.complexTensorInfos.real],[d.complexTensorInfos.imag,p.complexTensorInfos.imag]].map(g=>{let[y,v]=g,w={dataId:y.dataId,dtype:y.dtype,shape:s.shape},C={dataId:v.dataId,dtype:v.dtype,shape:a.shape},I=new Jd(n,s.shape,a.shape);return l.runWebGPUProgram(I,[w,C],En(y.dtype,v.dtype))});else{let g=new Ow(Xe.COMPLEX_MULTIPLY_REAL,s.shape,a.shape),y=new Ow(Xe.COMPLEX_MULTIPLY_IMAG,s.shape,a.shape),v=[{dataId:d.complexTensorInfos.real.dataId,dtype:d.complexTensorInfos.real.dtype,shape:s.shape},{dataId:d.complexTensorInfos.imag.dataId,dtype:d.complexTensorInfos.imag.dtype,shape:s.shape},{dataId:p.complexTensorInfos.real.dataId,dtype:p.complexTensorInfos.real.dtype,shape:a.shape},{dataId:p.complexTensorInfos.imag.dataId,dtype:p.complexTensorInfos.imag.dtype,shape:a.shape}];f=l.runWebGPUProgram(g,v,"float32"),h=l.runWebGPUProgram(y,v,"float32")}let m=ws({inputs:{real:f,imag:h},backend:l});return l.disposeData(f.dataId),l.disposeData(h.dataId),m}let c=r||En(s.dtype,a.dtype);if((s.dtype==="string"||a.dtype==="string"||l.shouldExecuteOnCPU([s,a]))&&t!=null){let d=l.tensorMap.get(s.dataId).values,p=l.tensorMap.get(a.dataId).values,f=s.dtype==="string"?T.fromUint8ToStringArray(d):d,h=s.dtype==="string"?T.fromUint8ToStringArray(p):p,[m,g]=t(s.shape,a.shape,f,h,c);return l.makeTensorInfo(g,c,m)}let u=new Jd(n,s.shape,a.shape);return l.runWebGPUProgram(u,[s,a],c)}}var{addImpl:Qie,castImpl:Jie,ceilImpl:ese,concatImpl:tse,equalImpl:nse,expImpl:rse,expm1Impl:ose,floorImpl:ise,floorDivImpl:sse,gatherNdImpl:ase,gatherV2Impl:lse,greaterEqualImpl:cse,greaterImpl:use,lessEqualImpl:dse,lessImpl:pse,logImpl:fse,maxImpl:hse,maximumImpl:mse,minimumImpl:gse,multiplyImpl:yse,negImpl:xse,notEqualImpl:vse,prodImpl:bse,rangeImpl:wse,rsqrtImpl:Cse,scatterImpl:_se,simpleAbsImpl:Sse,sliceImpl:Ise,stridedSliceImpl:Ese,stringNGramsImpl:Tse,subImpl:Dse,tileImpl:kse,topKImpl:Nse,transposeImpl:Ase,uniqueImpl:aGn}=lw;var SWe=Qe({opType:Ce.ABS,cpuKernelImpl:Sse}),Rse={kernelName:wc,backendName:"webgpu",kernelFunc:SWe};var IWe=Qe({opType:Ce.ACOS}),Ose={kernelName:Oa,backendName:"webgpu",kernelFunc:IWe};var EWe=Qe({opType:Ce.ACOSH}),Mse={kernelName:Ma,backendName:"webgpu",kernelFunc:EWe};var TWe=rn({opType:Xe.ADD,cpuKernelImpl:Qie,supportsComplex:!0}),Pse={kernelName:hs,backendName:"webgpu",kernelFunc:TWe};var Dk=class{constructor(t){this.workPerThread=1,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=t[0],this.variableNames=t.map((e,r)=>`T${r}`),this.dispatchLayout=xe(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize,[this.workPerThread,1,1]),this.shaderKey="addN"}getUserCode(){let t=[];this.variableNames.forEach(o=>{t.push(`let v${o} = get${o}ByOutputCoords(coords);`)});let e=this.variableNames.map(o=>`v${o}`).join(" + ");return`
      ${de("index")} {
        for (var i = 0; i < ${this.workPerThread}; i = i + 1) {
          let flatIndex = index * ${this.workPerThread} + i;
          if (flatIndex < uniforms.size) {
            let coords = getCoordsFromIndex(flatIndex);
            ${t.join(`
        `)}
            setOutputAtIndex(flatIndex, ${e});
          }
        }
      }
    `}};function DWe(n){let{inputs:t,backend:e}=n,r=t;if(r.length===1)return Sr({inputs:{x:r[0]},backend:e});let o=r.map(a=>a.dtype).reduce((a,l)=>En(a,l)),i=r.map(a=>a.shape),s=new Dk(i);return e.runWebGPUProgram(s,r,o)}var Fse={kernelName:Cc,backendName:"webgpu",kernelFunc:DWe};var kk=class{constructor(t,e){this.variableNames=["A"],this.workgroupSize=[16,16,1];let r=new Array(t.length);for(let o=0;o<r.length;o++)r[o]=t[e[o]];this.outputShape=r,this.dispatchLayout={x:[0],y:[1]},this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize,[1,1,1]),this.shaderKey="transposeShared"}getUserCode(){b.assert(this.workgroupSize[0]===this.workgroupSize[1],()=>`Must be a square tile, current tile shape is ${this.workgroupSize[0]} x ${this.workgroupSize[1]}`);let t=this.workgroupSize[0];return`
      var<workgroup> tile : array<array<f32, ${this.workgroupSize[0]+1}>, ${this.workgroupSize[0]}>;
      ${de()} {
        var x = i32(workgroupId.x) * ${t} + i32(localId.x);
        var y = i32(workgroupId.y) * ${t} + i32(localId.y);
        let width = uniforms.outShape[0];
        let height = uniforms.outShape[1];
        if (x < width && y < height) {
          tile[localId.y][localId.x] = f32(A[y * width + x]);
        }
        workgroupBarrier();

        x = i32(workgroupId.y) * ${t} + i32(localId.x);
        y = i32(workgroupId.x) * ${t} + i32(localId.y);
        if (x < height && y < width) {
          setOutputAtIndex((y * height + x), tile[localId.x]
            [localId.y]);
        }
      }
    `}};var Nk=class{constructor(t,e){this.variableNames=["A"],this.workPerThread=1,this.workgroupSize=[64,1,1],this.size=!0;let r=new Array(t.length);for(let o=0;o<r.length;o++)r[o]=t[e[o]];this.outputShape=r,this.dispatchLayout=xe(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize,[this.workPerThread,1,1]),this.newDim=e,this.shaderKey=`transpose_${e}`}getUserCode(){let t=zn(this.outputShape.length),e=_3(this.newDim);return`
      ${de("index")} {
        for(var i = 0; i < ${this.workPerThread}; i = i + 1) {
          let flatIndex = index * ${this.workPerThread} + i;
          if(flatIndex < uniforms.size) {
            let coords = getCoordsFromIndex(flatIndex);
            setOutputAtIndex(flatIndex, A[getIndexFromCoords${this.outputShape.length}D(
              ${t}(${e}), uniforms.aShape)]);
          }
        }
      }
    `}};function _3(n){let t=n.length;if(t>6)throw Error(`Transpose for rank ${t} is not yet supported`);let e=new Array(t);for(let r=0;r<n.length;r++)e[n[r]]=`coords.${la(r)}`;return e.join()}function Bo(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{perm:i}=r,s=e,a=o.shape.length,l=new Array(a);for(let u=0;u<l.length;u++)l[u]=o.shape[i[u]];if(e.shouldExecuteOnCPU([o])){let d=s.tensorMap.get(o.dataId).values,p=Ase(d,o.shape,o.dtype,i,l);return e.makeTensorInfo(l,o.dtype,p)}if(o.shape.length===2&&b.arraysEqual(i,[1,0])){let u=new kk(o.shape,i);return s.runWebGPUProgram(u,[o],o.dtype)}let c=new Nk(o.shape,i);return s.runWebGPUProgram(c,[o],o.dtype)}var Lse={kernelName:zs,backendName:"webgpu",kernelFunc:Bo};var Ak=class{constructor(t,e,r){this.variableNames=["x"],this.uniforms="reduceSize : i32,",this.size=!0,this.inputShape=[t.batchSize,t.inSize];let[o]=T.computeOutAndReduceShapes(this.inputShape,[1]);this.outputShape=o.length===0?[1]:o,t.inSize>=32768&&r>=512?this.workgroupSize=[512,1,1]:t.inSize>=4096?this.workgroupSize=[256,1,1]:this.workgroupSize=[64,1,1],this.dispatchLayout=xe(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,[1,1,1]),this.reduceType=e,this.shaderKey=`reduce_${e}`}getUserCode(){let t="",e="0.0",r=this.workgroupSize[0];this.reduceType==="min"||this.reduceType==="max"?(t=`
         if (isnan(candidate)) {
          bestValue = uniforms.NAN;
         } else if (!isnan(bestValue) && candidate ${this.reduceType==="min"?"<":">"} bestValue)
           {  bestValue = candidate; }`,e="f32(x[offset])"):this.reduceType==="sum"||this.reduceType==="mean"?t=" bestValue = bestValue + candidate; ":this.reduceType==="prod"?(t=" bestValue = bestValue * candidate; ",e="1.0"):this.reduceType==="all"?(t=" bestValue = f32(bestValue >= 1.0 && candidate >= 1.0); ",e="1.0"):this.reduceType==="any"&&(t=" bestValue = f32(bestValue >= 1.0 || candidate >= 1.0); ",e="0.0");let o=this.reduceType==="mean"?"setOutputAtIndex(outputIndex, bestValue / f32(uniforms.reduceSize));":"setOutputAtIndex(outputIndex, bestValue);";return`
       fn DIV_CEIL(a : u32, b : u32) -> u32 {
        return ((a - 1u) / b + 1u);
       }

       ${`
         var<workgroup> xBestValues : array<f32, ${r}>;
       `}
       fn getOffset(outputIndex : i32) -> i32 {
         let outputCoords = getCoordsFromIndex(outputIndex);
         let offset = ${this.outputShape.length===1?"outputCoords":"outputCoords[0]"} * uniforms.reduceSize;
          return offset;
       }
       ${de("index")} {
         let outputIndex = index / ${r};
         let offset = getOffset(outputIndex);
         var bestValue = ${e};
         let Length = uniforms.reduceSize;
         let WorkPerThread = DIV_CEIL(u32(Length), ${r}u);
         for (var k = i32(localId.x); k < Length && outputIndex < uniforms.size;
             k = k + ${r}) {
           let candidate = f32(x[offset + k]);
           ${t}
         }
         xBestValues[localId.x] = bestValue;
         workgroupBarrier();

         var reduceSize = min(u32(Length), ${r}u);
         for (var currentSize = reduceSize / 2u; reduceSize > 1u;
             currentSize = reduceSize / 2u) {
           let interval = DIV_CEIL(reduceSize, 2u);
           if (localId.x < currentSize) {
            let candidate = xBestValues[localId.x + interval];
            ${t}
            xBestValues[localId.x] = bestValue;
           }
           reduceSize = interval;
           workgroupBarrier();
         }

         if (localId.x == 0u && outputIndex < uniforms.size) {
          ${o}
        }
       }
     `}};var kWe={mean:"float32",all:"bool",any:"bool"};function rs(n,t,e,r,o){let i=n.shape.length,s=[],a=b.parseAxisParam(t,n.shape),l=a,c=T.getAxesPermutation(l,i),u=n;c!=null&&(u=Bo({inputs:{x:n},attrs:{perm:c},backend:o}),l=T.getInnerMostAxes(l.length,i),s.push(u)),T.assertAxesAreInnerMostDims(r,l,i);let[d,p]=T.computeOutAndReduceShapes(u.shape,l),f=d;e&&(f=T.expandShapeToKeepDim(d,a));let h;if((r==="max"||r==="prod")&&o.shouldExecuteOnCPU([u])){let m=o.tensorMap.get(u.dataId).values;switch(r){case"max":let g=hse(m,b.sizeFromShape(p),f,n.dtype);h=o.makeTensorInfo(f,n.dtype,g);break;case"prod":let{outVals:y,outShape:v,outDtype:w}=bse(u.shape,u.dtype,m,l);h=o.makeTensorInfo(v,w,y);break;default:throw new Error(`${r} CPU implementation is not yet supported.`)}}else{let m=b.sizeFromShape(p),y=b.sizeFromShape(u.shape)/m,v={windowSize:m,inSize:m,batchSize:y,outSize:1},w=kWe[r]||kd(n.dtype),C=[{type:"int32",data:[m]}],I=new Ak(v,r,o.device.limits.maxComputeWorkgroupSizeX),A=o.runWebGPUProgram(I,[u],w,C);s.push(A),h=$e({inputs:{x:A},attrs:{shape:f},backend:o})}return s.forEach(m=>o.disposeData(m.dataId)),h}function NWe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{keepDims:i,axis:s}=r;return rs(o,s,i,"all",e)}var $se={kernelName:Tp,backendName:"webgpu",kernelFunc:NWe};function AWe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{keepDims:i,axis:s}=r;return rs(o,s,i,"any",e)}var Vse={kernelName:Dp,backendName:"webgpu",kernelFunc:AWe};var yv=class{constructor(t,e,r){this.workgroupSize=[64,1,1],this.variableNames=["x"],this.uniforms="infinityValue : f32,",this.size=!0;let o=[e];this.op=r==="min"?"<":">";let[i,s]=T.computeOutAndReduceShapes(t,o);this.outputShape=i.length===0?[1]:i,this.dispatchLayout=xe(this.outputShape),b.sizeFromShape(s)<32?(this.type="plain",this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize)):(this.type="shared",this.dispatch=pe(this.dispatchLayout,this.outputShape,[1,1,1])),this.inputShape=t,this.shaderKey=`argMinMax_${this.op}_${this.type}`}getUserCode(){let t=this.workgroupSize[0],e=()=>this.inputShape.length===1?"uniforms.xShape":`uniforms.xShape.${la(this.inputShape.length-1)}`,r=()=>{let o="";if(this.outputShape.length===1)this.inputShape.length!==1&&(o+="outputCoords,");else for(let i=0;i<this.outputShape.length;i++)o+=`outputCoords.${la(i)},`;return o};return this.type==="shared"?`
      fn DIV_CEIL(a : u32, b : u32) -> u32 {
        return ((a - 1u) / b + 1u);
      }

      ${`
      var<workgroup> xBestIndices : array<i32, ${t}>;
      var<workgroup> xBestValues : array<f32, ${t}>;
    `}

      ${de("index")} {
        let outputIndex = index / ${t};
        let reduceLength = ${e()};

        var bestIndex = i32(localId.x);
        var bestValue = uniforms.infinityValue;
        let outputCoords = getCoordsFromIndex(outputIndex);
        for (var k = i32(localId.x); k < reduceLength && outputIndex < uniforms.size;
            k = k + ${t}) {
          let candidate = getX(${r()} k);
          if (!isnan(candidate) && candidate ${this.op} bestValue) {
            bestValue = candidate;
            bestIndex = k;
          }
        }
        xBestValues[localId.x] = bestValue;
        xBestIndices[localId.x] = bestIndex;
        workgroupBarrier();

        var reduceSize = min(u32(reduceLength), ${t}u);
        for (var currentSize = reduceSize / 2u; reduceSize > 1u;
            currentSize = reduceSize / 2u) {
          let interval = DIV_CEIL(reduceSize, 2u);
          if (localId.x < currentSize) {
            let candidate = xBestValues[localId.x + interval];
            if (candidate ${this.op} bestValue) {
              bestValue = candidate;
              xBestValues[localId.x] = bestValue;
              xBestIndices[localId.x] = xBestIndices[localId.x + interval];
            }
          }
          reduceSize = interval;
          workgroupBarrier();
        }

        if (localId.x == 0u && outputIndex < uniforms.size) {
          setOutputAtIndexI32(outputIndex, xBestIndices[localId.x]);
        }
      }
    `:`
      ${de("index")} {
        if (index < uniforms.size) {
          let outputCoords = getCoordsFromIndex(index);
          var bestIndex = 0;
          var bestValue = getX(${r()} 0);
          let reduceLength = ${e()};
          for (var i = 1; i < reduceLength; i++) {
            let candidate = getX(${r()} i);
            if (candidate ${this.op} bestValue) {
              bestValue = candidate;
              bestIndex = i;
            }
          }
          setOutputAtIndexI32(index, bestIndex);
        }
      }
      `}};function RWe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{axis:i}=r,s=b.parseAxisParam(i,o.shape),a=T.getAxesPermutation(s,o.shape.length),l=o,c=[];a!=null&&(l=Bo({inputs:{x:o},backend:e,attrs:{perm:a}}),c.push(l),s=T.getInnerMostAxes(s.length,l.shape.length)),T.assertAxesAreInnerMostDims("argMax",[s[0]],l.shape.length);let u=new yv(l.shape,s[0],"max"),d=[{type:"float32",data:[Number.NEGATIVE_INFINITY]}],p=e.runWebGPUProgram(u,[l],"int32",d);return c.forEach(f=>e.disposeData(f.dataId)),p}var Bse={kernelName:_c,backendName:"webgpu",kernelFunc:RWe};function OWe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{axis:i}=r,s=b.parseAxisParam(i,o.shape),a=T.getAxesPermutation(s,o.shape.length),l=o,c=[];a!=null&&(l=Bo({inputs:{x:o},backend:e,attrs:{perm:a}}),c.push(l),s=T.getInnerMostAxes(s.length,l.shape.length)),T.assertAxesAreInnerMostDims("argMin",[s[0]],l.shape.length);let u=new yv(l.shape,s[0],"min"),d=[{type:"float32",data:[Number.POSITIVE_INFINITY]}],p=e.runWebGPUProgram(u,[l],"int32",d);return c.forEach(f=>e.disposeData(f.dataId)),p}var zse={kernelName:Sc,backendName:"webgpu",kernelFunc:OWe};var MWe=Qe({opType:Ce.ASIN}),Use={kernelName:Pa,backendName:"webgpu",kernelFunc:MWe};var PWe=Qe({opType:Ce.ASINH}),Wse={kernelName:Fa,backendName:"webgpu",kernelFunc:PWe};var FWe=Qe({opType:Ce.ATAN}),Gse={kernelName:La,backendName:"webgpu",kernelFunc:FWe};var LWe=rn({opType:Xe.ATAN2}),jse={kernelName:Va,backendName:"webgpu",kernelFunc:LWe};var $We=Qe({opType:Ce.ATANH}),Hse={kernelName:$a,backendName:"webgpu",kernelFunc:$We};var Rk=class{constructor(t){this.variableNames=["x"],this.uniforms="strides : vec2<i32>,",this.workgroupSize=[256,1,1],this.size=!0,this.outputShape=t.outShape,this.dispatchLayout=xe(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="poolWithFilterSizeEqualsOne"}getUserCode(){return`
      ${de("index")} {
        if (index < uniforms.size) {
          let coords = getCoordsFromIndex(index);
          let batch = coords[0];
          let d = coords[3];

          let xRCCorner = coords.yz * uniforms.strides;
          let xRCorner = xRCCorner.x;
          let xCCorner = xRCCorner.y;

          let value = getX(batch, xRCorner, xCCorner, d);
          setOutputAtIndex(index, value);
        }
      }
    `}};var Ou=class{constructor(t,e,r=!1,o=!1,i=!1){if(this.variableNames=["x"],this.uniforms="strides : vec2<i32>, pads : vec2<i32>, dilations : vec2<i32>, convDims : vec2<i32>, filterDims : vec2<i32>,",this.workgroupSize=[128,1,1],this.size=!0,e==="avg"&&r)throw new Error("Cannot compute positions for average pool.");this.outputShape=t.outShape,this.dispatchLayout=xe(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.poolType=e,this.computePositions=r,this.flattenPositions=o,this.includeBatchIndex=i,this.shaderKey=`pool2D_${e}_${r}_${o}_${i}`}getUserCode(){let t;this.poolType==="avg"?t="resultValue = resultValue + value; count = count + 1.0;":this.computePositions?t=`let currMaxValue = mix(value, maxValue, maxValueFound);
      if (value >= currMaxValue) {
        maxValue = value;
        maxValueFound = 1.0;
        maxPosition = ${this.flattenPositions?this.includeBatchIndex?"((batch * uniforms.xShape[1] + xR) * uniforms.xShape[2] + xC) * uniforms.xShape[3] + d":"(xR * uniforms.xShape[2] + xC) * uniforms.xShape[3] + d":"wR * uniforms.filterDims.y + wC"};
      }`:t="resultValue = max(value, resultValue);";let e="resultValue";return this.poolType==="avg"&&(e="resultValue / max(count, 1.0)"),`
      ${de("index")} {
      if (index < uniforms.size) {
        let coords = getCoordsFromIndex(index);
          let batch = coords[0];
          let d = coords[3];
          let xRCCorner = vec2<i32>(coords.yz) * uniforms.strides - uniforms.pads;
          let xRCorner = xRCCorner.x;
          let xCCorner = xRCCorner.y;

          ${this.computePositions?`var maxValue = 0.0;
            var maxValueFound = 0.0;
            var maxPosition = 0;`:`var resultValue = ${this.poolType==="avg"?"0.0":"-1.0 / pow(10.0, -20.0)"};`}

          var count = 0.0;
          for (var wR = 0; wR < uniforms.filterDims.x; wR = wR + uniforms.dilations.x) {
            let xR = xRCorner + wR;

            if (xR < 0 || xR >= uniforms.convDims.x) {
              continue;
            }

            for (var wC = 0; wC < uniforms.filterDims.y; wC = wC + uniforms.dilations.y) {
              let xC = xCCorner + wC;
              if (xC < 0 || xC >= uniforms.convDims.y) {
                continue;
              }

              let value = getX(batch, xR, xC, d);
              ${t}
            }
          }

          ${this.computePositions?"setOutputAtIndexI32(index, maxPosition);":`setOutputAtIndex(index, ${e});`}
        }
      }
    `}},lh=class{constructor(t,e,r=!1,o=!1,i=!1){if(this.variableNames=["x"],this.uniforms="strides : vec3<i32>, pads : vec3<i32>, convDims : vec3<i32>, filterDims : vec3<i32>,",this.workgroupSize=[128,1,1],this.size=!0,e==="avg"&&r)throw new Error("Cannot compute positions for average pool.");this.outputShape=t.outShape,this.dispatchLayout=xe(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.poolType=e,this.computePositions=r,this.flattenPositions=o,this.includeBatchIndex=i,this.shaderKey=`pool3D_${e}_${r}_${o}_${i}`}getUserCode(){let t;this.poolType==="avg"?t="resultValue += value; count += 1.0;":this.computePositions?t=`let currMaxValue = mix(value, maxValue, maxValueFound);
      if (value >= currMaxValue) {
        maxValue = value;
        maxValueFound = 1.0;
        maxPosition = ${this.flattenPositions?this.includeBatchIndex?"(((batch * uniforms.xShape.y + xD) * uniforms.xShape.z + xR) * uniforms.xShape.w + xC) * uniforms.xShape.u + ch":"((xD * uniforms.xShape.z + xR) * uniforms.xShape.w + xC) * uniforms.xShape.u + ch":"wD * uniforms.filterDims.y * uniforms.filterDims.y + wR * uniforms.filterDims.z + wC"};
      }`:t="resultValue = max(value, resultValue);";let e="resultValue";return this.poolType==="avg"&&(e="resultValue / max(count, 1.0)"),`
      ${de("index")} {
        if (index < uniforms.size) {
          let coords = getCoordsFromIndex(index);
          let batch = coords.x;
          let ch = coords.u;

          let xCorner = vec3<i32>(coords.y, coords.z, coords.w) * uniforms.strides - uniforms.pads;
          let xDCorner = xCorner.x;
          let xRCorner = xCorner.y;
          let xCCorner = xCorner.z;

          ${this.computePositions?`var maxValue = 0.0;
            var maxValueFound = 0.0;
            var maxPosition = 0;`:`var resultValue = ${this.poolType==="avg"?"0.0":"-1.0 / pow(10.0, -20.0)"};`}

          var count = 0.0;
          for (var wD = 0; wD < uniforms.filterDims.x; wD++) {
            let xD = xDCorner + wD;
            if (xD < 0 || xD >= uniforms.convDims.x) {
              continue;
            }

            for (var wR = 0; wR < uniforms.filterDims.y; wR++) {
              let xR = xRCorner + wR;
              if (xR < 0 || xR >= uniforms.convDims.y) {
                continue;
              }

              for (var wC = 0; wC < uniforms.filterDims.z; wC++) {
                let xC = xCCorner + wC;
                if (xC < 0 || xC >= uniforms.convDims.z) {
                  continue;
                }

                let value = getX(batch, xD, xR, xC, ch);
                ${t}
              }
            }
          }

          ${this.computePositions?"setOutputAtIndexI32(index, maxPosition);":`setOutputAtIndex(index, ${e});`}
        }
      }
    `}};function S3(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{reductionIndices:i,keepDims:s}=r;return rs(o,i,s,"max",e)}var qse={kernelName:Uc,backendName:"webgpu",kernelFunc:S3};function I3(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{keepDims:i,axis:s}=r;return rs(o,s,i,"mean",e)}var Kse={kernelName:jc,backendName:"webgpu",kernelFunc:I3};function Ok(n,t,e,r){if(t.filterWidth===1&&t.filterHeight===1&&b.arraysEqual(t.inShape,t.outShape))return Sr({inputs:{x:n},backend:r});if(t.filterWidth===t.inWidth&&t.filterHeight===t.inHeight&&t.batchSize===1&&t.padInfo.type==="VALID"){let s=n.shape.length,a=$e({inputs:{x:n},backend:r,attrs:{shape:[n.shape[s-3]*n.shape[s-2],n.shape[s-1]]}}),l;e==="avg"?l=I3({inputs:{x:a},backend:r,attrs:{axis:0,keepDims:!1}}):(b.assert(e==="max",()=>`Invalid pool type ${e}`),l=S3({inputs:{x:a},backend:r,attrs:{reductionIndices:0,keepDims:!1}}));let c=$e({inputs:{x:l},backend:r,attrs:{shape:t.outShape}});return r.disposeData(a.dataId),r.disposeData(l.dataId),c}let o,i=[{type:"int32",data:[t.strideHeight,t.strideWidth]}];return t.filterHeight===1&&t.filterWidth===1?o=new Rk(t):(e==="avg"?o=new Ou(t,"avg"):(b.assert(e==="max",()=>`Invalid pool type ${e}`),o=new Ou(t,"max")),i.push({type:"int32",data:[t.padInfo.top,t.padInfo.left]},{type:"int32",data:[t.dilationHeight,t.dilationWidth]},{type:"int32",data:[t.inHeight,t.inWidth]},{type:"int32",data:[t.effectiveFilterHeight,t.effectiveFilterWidth]})),r.runWebGPUProgram(o,[n],n.dtype,i)}function VWe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{filterSize:i,strides:s,pad:a,dimRoundingMode:l}=r,u=T.computePool2DInfo(o.shape,i,s,1,a,l);return Ok(o,u,"avg",e)}var Xse={kernelName:Ic,backendName:"webgpu",kernelFunc:VWe};function BWe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{filterSize:i,strides:s,pad:a,dataFormat:l,dimRoundingMode:c}=r,u=[1,1,1],d=T.computePool3DInfo(o.shape,i,s,u,a,c,l),p=new lh(d,"avg"),f=[{type:"int32",data:[d.strideDepth,d.strideHeight,d.strideWidth]},{type:"int32",data:[d.padInfo.front,d.padInfo.top,d.padInfo.left]},{type:"int32",data:[d.inDepth,d.inHeight,d.inWidth]},{type:"int32",data:[d.effectiveFilterDepth,d.effectiveFilterHeight,d.effectiveFilterWidth]}];return e.runWebGPUProgram(p,[o],o.dtype,f)}var Yse={kernelName:Ec,backendName:"webgpu",kernelFunc:BWe};var Mk=class{constructor(t){this.variableNames=["dy"],this.uniforms=`strides : vec2<i32>, pads : vec2<i32>, dilations : vec2<i32>, filterDims : vec2<i32>,
       outHeight : i32, outWidth : i32, avgMultiplier : f32,`,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=t.inShape,this.dispatchLayout=xe(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="avgPool2DBackprop"}getUserCode(){return`
      ${de("index")} {
      if (index < uniforms.size) {
        let coords = getCoordsFromIndex(index);
        let batch = coords[0];
        let d = coords[3];

        let dyRCCorner = vec2<i32>(coords.yz) - uniforms.pads;
        let dyRCorner = dyRCCorner.x;
        let dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        var dotProd = 0.0;
        for (var wR = 0; wR < uniforms.filterDims[0]; wR = wR + uniforms.dilations[0]) {
          let dyR = f32(dyRCorner + wR) / f32(uniforms.strides[0]);

          if (dyR < 0.0 || dyR >= f32(uniforms.outHeight) || fract(dyR) > 0.0) {
            continue;
          }
          let idyR = i32(dyR);

          for (var wC = 0; wC < uniforms.filterDims[1]; wC = wC + uniforms.dilations[1]) {
            let dyC = f32(dyCCorner + wC) / f32(uniforms.strides[1]);

            if (dyC < 0.0 || dyC >= f32(uniforms.outWidth) || fract(dyC) > 0.0) {
              continue;
            }
            let idyC = i32(dyC);

            let dyValue = getDy(batch, idyR, idyC, d);

            dotProd = dotProd + dyValue * uniforms.avgMultiplier;
          }
        }
        setOutputAtIndex(index, dotProd);
      }
    }
    `}},Pk=class{constructor(t){this.variableNames=["dy"],this.uniforms=`strides : vec3<i32>, pads : vec3<i32>, filterDims : vec3<i32>,
       outDepth : i32, outHeight : i32, outWidth : i32, avgMultiplier : f32,`,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=t.inShape,this.dispatchLayout=xe(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="avgPool3DBackprop"}getUserCode(){return`
      ${de("index")} {
      if (index < uniforms.size) {
        let coords = getCoordsFromIndex(index);
        let batch = coords.x;
        let ch = coords.u;

        let dyCorner = vec3<i32>(coords.y, coords.z, coords.w) - uniforms.pads;
        let dyDCorner = dyCorner.x;
        let dyRCorner = dyCorner.y;
        let dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        var dotProd = 0.0;
        for (var wD = 0; wD < uniforms.filterDims[0]; wD++) {
          let dyD = f32(dyDCorner + wD) / f32(uniforms.strides[0]);

          if (dyD < 0.0 || dyD >= f32(uniforms.outDepth) || fract(dyD) > 0.0) {
            continue;
          }
          let idyD = i32(dyD);

          for (var wR = 0; wR < uniforms.filterDims[1]; wR++) {
            let dyR = f32(dyRCorner + wR) / f32(uniforms.strides[1]);

            if (dyR < 0.0 || dyR >= f32(uniforms.outHeight) || fract(dyR) > 0.0) {
              continue;
            }
            let idyR = i32(dyR);

            for (var wC = 0; wC < uniforms.filterDims[2]; wC++) {
              let dyC = f32(dyCCorner + wC) / f32(uniforms.strides[2]);

              if (dyC < 0.0 || dyC >= f32(uniforms.outWidth) || fract(dyC) > 0.0) {
                continue;
              }
              let idyC = i32(dyC);

              let dyValue = getDy(batch, idyD, idyR, idyC, ch);
              dotProd += dyValue * uniforms.avgMultiplier;
            }
          }
        }
        setOutputAtIndex(index, dotProd);
      }
    }
    `}};function zWe(n){let{inputs:t,backend:e,attrs:r}=n,{dy:o,input:i}=t,s=i,{filterSize:a,strides:l,pad:c,dimRoundingMode:u}=r,d=T.computePool3DInfo(s.shape,a,l,1,c,u),p=new Pk(d),f=1/(d.filterDepth*d.filterHeight*d.filterWidth),h=[{type:"int32",data:[d.strideDepth,d.strideHeight,d.strideWidth]},{type:"int32",data:[d.effectiveFilterDepth-1-d.padInfo.front,d.effectiveFilterHeight-1-d.padInfo.top,d.effectiveFilterWidth-1-d.padInfo.left]},{type:"int32",data:[d.effectiveFilterDepth,d.effectiveFilterHeight,d.effectiveFilterWidth]},{type:"int32",data:[d.outDepth]},{type:"int32",data:[d.outHeight]},{type:"int32",data:[d.outWidth]},{type:"float32",data:[f]}];return e.runWebGPUProgram(p,[o],s.dtype,h)}var Zse={kernelName:Np,backendName:"webgpu",kernelFunc:zWe};function UWe(n){let{inputs:t,backend:e,attrs:r}=n,{dy:o,input:i}=t,s=i;Aw([o,i],"avgPoolGrad");let{filterSize:a,strides:l,pad:c}=r,u=T.computePool2DInfo(s.shape,a,l,1,c),d=new Mk(u),p=1/(u.filterHeight*u.filterWidth),f=[{type:"int32",data:[u.strideHeight,u.strideWidth]},{type:"int32",data:[u.effectiveFilterHeight-1-u.padInfo.top,u.effectiveFilterWidth-1-u.padInfo.left]},{type:"int32",data:[u.dilationHeight,u.dilationWidth]},{type:"int32",data:[u.effectiveFilterHeight,u.effectiveFilterWidth]},{type:"int32",data:[u.outHeight]},{type:"int32",data:[u.outWidth]},{type:"float32",data:[p]}];return e.runWebGPUProgram(d,[o],s.dtype,f)}var Qse={kernelName:kp,backendName:"webgpu",kernelFunc:UWe};function WWe(n){let{inputs:t,backend:e,attrs:r}=n,{a:o,b:i}=t,{transposeA:s,transposeB:a}=r;return Ym({a:o,b:i,transposeA:s,transposeB:a,backend:e})}var Jse={kernelName:Tc,backendName:"webgpu",kernelFunc:WWe};var Fk=class{constructor(t,e){this.variableNames=["source"],this.workPerThread=1,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e,this.rank=e.length,this.dispatchLayout=xe(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize,[this.workPerThread,1,1]),this.start=t,this.uniforms=`start : ${zn(t.length)}, `,this.shaderKey="slice"}getUserCode(){let t=zn(this.rank),e=GWe(this.rank),r;return this.start.length===1?r=this.outputShape.map((i,s)=>"sourceLoc = uniforms.start + coords;"):r=this.outputShape.map((i,s)=>`sourceLoc.${E3[s]} = uniforms.start.${la(s)} + coords.${E3[s]};`),`
      ${de("index")} {
        if (index < uniforms.size) {
          var sourceLoc : ${t};
          let coords = getCoordsFromIndex(index);
          ${r.join(`
`)}
          setOutputAtIndex(index, getSource(${e}));
        }
      }
    `}},E3=["x","y","z","w","u","v"];function GWe(n){if(n===1)return"sourceLoc";if(n<=6)return E3.slice(0,n).map(t=>`sourceLoc.${t}`).join(",");throw Error(`Slicing for rank ${n} is not yet supported`)}function jl(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{begin:i,size:s}=r,[a,l]=yr.parseSliceParams(o,i,s);if(yr.assertParamsValid(o,a,l),e.shouldExecuteOnCPU([o])||o.dtype==="string"){let d=e.tensorMap.get(o.dataId),p=Ise(d.values,a,l,o.shape,o.dtype);return e.makeTensorInfo(l,o.dtype,p)}if(b.sizeFromShape(l)===0)return e.makeTensorInfo(l,o.dtype,[]);let c=new Fk(a,l),u=[{type:"int32",data:a}];return e.runWebGPUProgram(c,[o],o.dtype,u)}var eae={kernelName:su,backendName:"webgpu",kernelFunc:jl};var jWe=n=>{let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{blockShape:i,crops:s}=r;b.assert(o.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGPU backend not implemented yet");let a=i.reduce((v,w)=>v*w),l=T.getReshaped(o.shape,i,a),c=T.getPermuted(l.length,i.length),u=T.getReshapedPermuted(o.shape,i,a),d=T.getSliceBeginCoords(s,i.length),p=T.getSliceSize(u,s,i.length),f=[],h=$e({inputs:{x:o},backend:e,attrs:{shape:l}}),m=Bo({inputs:{x:h},backend:e,attrs:{perm:c}}),g=$e({inputs:{x:m},backend:e,attrs:{shape:u}}),y=jl({inputs:{x:g},backend:e,attrs:{begin:d,size:p}});return f.push(h),f.push(m),f.push(g),f.forEach(v=>e.disposeData(v.dataId)),y},tae={kernelName:Dc,backendName:"webgpu",kernelFunc:jWe};var HWe=`
  fn bincount_write(index: i32, value: f32) {
    ${es("&result[index]","value","float32")}
  }
`,qWe=`
  fn bincount_write(index: i32, value: f32) {
    atomicStore(&result[index], bitcast<i32>(value));
  }
`,xv=class{constructor(t,e,r=!1){this.outputShape=[],this.variableNames=["x"],this.uniforms="binCountSize : i32,",this.workgroupSize=[64,1,1],this.atomic=!0,this.hasWeights=!0,this.binaryOutput=!1,this.outputShape=t,this.rank=t.length,this.dispatchLayout=xe(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.binaryOutput=r,r&&(this.atomic=!1),this.hasWeights=e,this.hasWeights&&this.variableNames.push("w"),this.shaderKey=`bincount_${this.hasWeights}_${this.binaryOutput}_${this.rank}`}getUserCode(){return`
    ${this.binaryOutput?qWe:HWe}
  ${de("index")} {
    ${this.rank===1?`if (index < uniforms.xShape) {
      let indexVal = i32(getX(index));
      if (indexVal < uniforms.binCountSize) {
        let value = ${this.binaryOutput?1:this.hasWeights?"getW(index)":"1."};
        bincount_write(indexVal, value);
      }
    }`:`let coord = getCoordsFromIndex(index);
    if (coordsInBounds2D(coord, uniforms.xShape)) {
      let indexVal = i32(getX(coord[0], coord[1]));
      if (indexVal < uniforms.binCountSize) {
        let value = ${this.binaryOutput?1:this.hasWeights?"getW(coord[0], coord[1])":"1."};
        bincount_write(coord.x * uniforms.binCountSize + indexVal, value);
      }
    }`}
  }
  `}};function KWe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,weights:i}=t,{size:s}=r,a=b.sizeFromShape(o.shape),c=b.sizeFromShape(i.shape)>0,u=[s],d=i.dtype,p=dr({backend:e,attrs:{shape:u,value:0,dtype:d}}),f=new xv([a],c),h=[{type:"int32",data:[s]}],m=c?[o,i]:[o];return e.runWebGPUProgram(f,m,d,h,p)}var nae={kernelName:Ap,backendName:"webgpu",kernelFunc:KWe};var Lk=class{constructor(t){this.outputShape=[],this.variableNames=["s0","s1"],this.uniforms="s0Size : i32, s1Size : i32, ",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=[t],this.dispatchLayout=xe(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="broadcastArgs"}getUserCode(){return`
  ${de("index")} {
    if (index < uniforms.size) {
      var s0 = 1.0;
      var s1 = 1.0;
      let indexS0 = index - uniforms.size + uniforms.s0Size;
      let indexS1 = index - uniforms.size + uniforms.s1Size;
      if (indexS0 >= 0) {
        s0 = getS0(indexS0);
      }
      if (indexS1 >= 0) {
        s1 = getS1(indexS1);
      }

      if (s0 == 1.0) {
        setOutputAtIndex(index, s1);
      } else if (s1 == 1.0) {
        setOutputAtIndex(index, s0);
      } else if (s0 != s1) {
        setOutputAtIndex(index, uniforms.NAN);
      } else {
        setOutputAtIndex(index, s0);
      }
    }
  }
  `}};function XWe(n){let{inputs:t,backend:e}=n,{s0:r,s1:o}=t;if(e.shouldExecuteOnCPU([r,o])){let u=e.tensorMap.get(r.dataId),d=e.tensorMap.get(o.dataId),p=u.values,f=d.values,h=T.assertAndGetBroadcastShape(Array.from(p),Array.from(f));return e.makeTensorInfo([h.length],"int32",Int32Array.from(h))}let i=b.sizeFromShape(r.shape),s=b.sizeFromShape(o.shape),a=Math.max(i,s),l=new Lk(a),c=[{type:"int32",data:[i]},{type:"int32",data:[s]}];return e.runWebGPUProgram(l,[r,o],"int32",c)}var rae={kernelName:Rp,backendName:"webgpu",kernelFunc:XWe};var T3=rn({opType:Xe.NOT_EQUAL,dtype:"bool",cpuKernelImpl:vse}),oae={kernelName:Sd,backendName:"webgpu",kernelFunc:T3};function ep(n){let{inputs:t,backend:e}=n,{input:r}=t,o=e.tensorMap.get(r.dataId);return Sr({inputs:{x:o.complexTensorInfos.real},backend:e})}var iae={kernelName:lf,backendName:"webgpu",kernelFunc:ep};function sae(n,t){let e=new ns(n.shape,Ce.TO_INT),r=t.runWebGPUProgram(e,[n],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}function D3(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{dtype:i}=r;if(i==="complex64"){if(o.dtype==="complex64")return Sr({inputs:{x:o},backend:e});let s=hn(o.shape),a=D3({inputs:{x:o},backend:e,attrs:{dtype:"float32"}}),l=ws({inputs:{real:a,imag:s},backend:e});return s.dispose(),e.disposeData(a.dataId),l}if(o.dtype==="complex64"){let s=ep({inputs:{input:o},backend:e}),a=D3({inputs:{x:s},backend:e,attrs:{dtype:i}});return e.disposeData(s.dataId),a}if(!b.hasEncodingLoss(o.dtype,i)){let s=Sr({inputs:{x:o},backend:e});return{dataId:s.dataId,shape:s.shape,dtype:i}}if(e.shouldExecuteOnCPU([o])){let s=e.tensorMap.get(o.dataId).values,[a,l,c]=Jie(s,o.shape,o.dtype,i);return e.makeTensorInfo(a,l,c)}if(i==="int32")return sae(o,e);if(i==="bool"){let s=e.makeTensorInfo([],"bool",b.getTypedArrayFromDType("bool",1)),l=T3({inputs:{a:o,b:s},backend:e});return e.disposeData(s.dataId),l}throw new Error(`Error in Cast: failed to cast ${o.dtype} to ${i}`)}var aae={kernelName:$s,backendName:"webgpu",kernelFunc:D3};var YWe=Qe({opType:Ce.CEIL,cpuKernelImpl:ese}),lae={kernelName:Ba,backendName:"webgpu",kernelFunc:YWe};var $k=class{constructor(t){this.variableNames=["A"],this.uniforms="minVal : f32, maxVal : f32,",this.workPerThread=4,this.workgroupSize=[64,1,1],this.outputComponent=4,this.size=!0,this.outputShape=t,this.dispatchLayout=xe(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize,[this.workPerThread,1,1]),this.shaderKey="clipVec4"}getUserCode(){return`
      ${de("index")} {
        if(index < uniforms.size) {
          let value = getAByOutputIndex(index);
          var clampedValue = clamp(
              value, vec4<f32>(uniforms.minVal), vec4<f32>(uniforms.maxVal));
          clampedValue = select(clampedValue, value, isnanVec4(value));
          setOutputAtIndex(index, clampedValue);
        }
      }
    `}};var Vk=class{constructor(t){this.variableNames=["A"],this.uniforms="minVal : f32, maxVal : f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=t,this.dispatchLayout=xe(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="clip"}getUserCode(){return`
      ${de("index")} {
        if(index < uniforms.size) {
          let value = getAByOutputIndex(index);
          if (isnan(value)) {
            setOutputAtIndex(index, value);
            return;
          }
          setOutputAtIndex(index, clamp(value, uniforms.minVal, uniforms.maxVal));
        }
      }
    `}};function ZWe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{clipValueMin:i,clipValueMax:s}=r,a,l=[{type:"float32",data:[i]},{type:"float32",data:[s]}];return b.sizeFromShape(o.shape)%4===0?a=new $k(o.shape):a=new Vk(o.shape),e.runWebGPUProgram(a,[o],o.dtype,l)}var cae={kernelName:za,backendName:"webgpu",kernelFunc:ZWe};var Bk=class{constructor(t){this.outputShape=[],this.variableNames=["real","imag"],this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=t,this.dispatchLayout=xe(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="complexAbs"}getUserCode(){return`
    ${de("index")} {
      if (index < uniforms.size) {
        let re = abs(getRealByOutputIndex(index));
        let im = abs(getImagByOutputIndex(index));
        let mx = max(re, im);

        // The length function in wgsl may be not underflow-safe on some GPUs.
        // So the safe solution is to ensure underflow-safety in all cases.
        setOutputAtIndex(index, select(mx * length(vec2<f32>(1, min(re, im)/mx)), 0.0, mx == 0.0));
      }
    }
  `}};function uae(n,t){return{dataId:t.dataId,dtype:t.dtype,shape:n.shape}}function QWe(n){let{inputs:t,backend:e}=n,{x:r}=t,o=e.tensorMap.get(r.dataId),i=new Bk(r.shape),s=[uae(r,o.complexTensorInfos.real),uae(r,o.complexTensorInfos.imag)];return e.runWebGPUProgram(i,s,s[0].dtype)}var dae={kernelName:kc,backendName:"webgpu",kernelFunc:QWe};var zk=class{constructor(t){this.uniforms="",this.workPerThread=1,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=T.computeOutShape(t,1),this.variableNames=t.map((e,r)=>`T${r}`),this.dispatchLayout=xe(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize,[this.workPerThread,1,1]),this.offsetLength=t.length-1;for(let e=0;e<this.offsetLength;e++)this.uniforms+=`offset${e} : i32,`;this.shaderKey="concat"}getUserCode(){let t=[];if(this.offsetLength>0){t.push("if (yC < uniforms.offset0){ setOutputAtCoords(coords.x, coords.y, getT0(yR, yC)); }");for(let i=1;i<this.offsetLength;i++)t.push(`else if (yC < uniforms.offset${[i]}){ setOutputAtCoords(coords.x, coords.y, getT${i}(yR, yC - uniforms.offset${i-1})); }`);let r=this.offsetLength,o=this.offsetLength-1;t.push(`else { setOutputAtCoords(coords.x, coords.y, getT${r}(yR, yC - uniforms.offset${o})); }`)}else t.push("setOutputAtCoords(coords.x, coords.y, getT0(yR, yC));");return`
      ${de("index")} {
        for(var i = 0; i < ${this.workPerThread}; i = i + 1) {
          let flatIndex = index * ${this.workPerThread} + i;
          if(flatIndex < uniforms.size) {
            let coords = getCoordsFromIndex(flatIndex);
            let yR = coords.x;
            let yC = coords.y;

            ${t.join(`
        `)}
          }
        }
      }
    `}};function Zm(n){let{inputs:t,backend:e}=n,{input:r}=t,o=e.tensorMap.get(r.dataId);return Sr({inputs:{x:o.complexTensorInfos.imag},backend:e})}var pae={kernelName:Zp,backendName:"webgpu",kernelFunc:Zm};function vv(n,t,e){let r=n[0].dtype;if(r==="complex64"){let h=n.map(w=>ep({inputs:{input:w},backend:e})),m=n.map(w=>Zm({inputs:{input:w},backend:e})),g=vv(h,t,e),y=vv(m,t,e),v=ws({inputs:{real:g,imag:y},backend:e});return h.forEach(w=>e.disposeData(w.dataId)),m.forEach(w=>e.disposeData(w.dataId)),e.disposeData(g.dataId),e.disposeData(y.dataId),v}let o=e.shouldExecuteOnCPU(n);if(r==="string"&&(o=!0),o){let h=n.map(I=>{let M=[-1,b.sizeFromShape(I.shape.slice(t))];return $e({inputs:{x:I},backend:e,attrs:{shape:M}})}),m=h.map(I=>({vals:e.readSync(I.dataId),shape:I.shape})),g=T.computeOutShape(h.map(I=>I.shape),1),y=h[0].shape[0]===1,v=tse(m,g,r,y),w=T.computeOutShape(n.map(I=>I.shape),t),C=e.makeTensorInfo(w,r,v);return h.forEach(I=>e.disposeData(I.dataId)),C}let i=e.device.limits.maxStorageBuffersPerShaderStage-1;if(n.length>i){let h=[];for(let g=0;g<n.length;g+=i){let y=n.slice(g,g+i);h.push(vv(y,t,e))}let m=vv(h,t,e);for(let g of h)e.disposeData(g.dataId);return m}let{tensors2D:s,outShape:a}=JWe(n,t,e),l=s.map(h=>h.shape),c=new zk(l),u=[],d=new Array(l.length-1);if(d.length>0){d[0]=l[0][1],u.push({type:"int32",data:[d[0]]});for(let h=1;h<d.length;h++)d[h]=d[h-1]+l[h][1],u.push({type:"int32",data:[d[h]]})}let p=e.runWebGPUProgram(c,s,s[0].dtype,u);s.forEach(h=>e.disposeData(h.dataId));let f=$e({inputs:{x:p},backend:e,attrs:{shape:a}});return e.disposeData(p.dataId),f}function JWe(n,t,e){let r=T.computeOutShape(n.map(i=>i.shape),t);return{tensors2D:n.map(i=>$e({inputs:{x:i},backend:e,attrs:{shape:[b.sizeFromShape(i.shape.slice(0,t)),b.sizeFromShape(i.shape.slice(t))]}})),outShape:r}}function k3(n){let{inputs:t,backend:e,attrs:r}=n,{axis:o}=r,i=b.parseAxisParam(o,t[0].shape)[0],s=t.map(c=>c.shape);T.assertParamsConsistent(s,i);let a=T.computeOutShape(t.map(c=>c.shape),i);if(b.sizeFromShape(a)===0)return e.makeTensorInfo(a,t[0].dtype,[]);let l=t.filter(c=>b.sizeFromShape(c.shape)>0);return l.length===1?Sr({inputs:{x:l[0]},backend:e}):vv(l,i,e)}var fae={kernelName:Nc,backendName:"webgpu",kernelFunc:k3};function eGe(n,t,e,r,o=!1,i=null,s=!1,a=4,l=4,c=4){let u=V=>{switch(V){case 1:return"resData = f32(x[xIndex]);";case 3:return"resData = vec3<f32>(x[xIndex], x[xIndex + 1], x[xIndex + 2]);";case 4:return"resData = vec4<f32>(x[xIndex / 4]);";default:throw new Error(`innerElementSize ${V} is not supported.`)}},d=V=>{switch(V){case 1:return"return f32(W[row * uniforms.wShape[3] + col]);";case 4:return"return vec4<f32>(W[(row * uniforms.wShape[3] + col) / 4]);";default:throw new Error(`innerElementSize ${V} is not supported.`)}},p=n?`
      let coord = vec4<i32>(batch, xRow, xCol, xCh);
      `:`
      let coord = vec4<i32>(batch, xCh, xRow, xCol);
      `,f=n?`
      let coords = vec4<i32>(
        batch,
        row / outWidth,
        row % outWidth,
        col);
      `:`
      let coords = vec4<i32>(
        batch,
        row,
        col / outWidth,
        col % outWidth);
      `,h=n?"uniforms.xShape[1]":"uniforms.xShape[2]",m=n?"uniforms.xShape[2]":"uniforms.xShape[3]",g=n?"row":"col",y=n?"col":"row",v=`
      let inChannels = uniforms.wShape[2];
      let outWidth = ${n?"uniforms.outShape[2]":"uniforms.outShape[3]"};
      let outRow = ${g} / outWidth;
      let outCol = ${g} % outWidth;

      let WRow = ${y} / (uniforms.filterDims[1] * inChannels);
      let WCol = ${y} / inChannels % uniforms.filterDims[1];
      let xRow = outRow * uniforms.strides[0] + uniforms.dilations[0] * WRow - uniforms.pads[0];
      let xCol = outCol * uniforms.strides[1] + uniforms.dilations[1] * WCol - uniforms.pads[1];
      let xCh = ${y} % inChannels;
      var resData = ${At(a)}(0.0);
      // The bounds checking is always needed since we use it to pad zero for
      // the 'same' padding type.
      if (xRow >= 0 && xRow < ${h} && xCol >= 0 && xCol < ${m}) {
        ${p}
        let xIndex = getIndexFromCoords4D(coord, uniforms.xShape);
        ${u(a)}
      }
      return resData;`,w=n?t&&r?`
      ${v}`:`
      if (row < uniforms.dimAOuter && col < uniforms.dimInner) {
        ${v}
      }
      return ${At(a)}(0.0);`:r&&e?`
      ${v}`:`
      if (row < uniforms.dimInner && col < uniforms.dimBOuter) {
        ${v}
      }
      return ${At(a)}(0.0);`,C=`${d(l)}`,I=At(c),A=n?At(a):At(l),M=n?At(l):At(a);return`
      ${To(i,s,c===4,4)}
      fn mm_readA(batch: i32, row : i32, col : i32) -> ${A} {
        ${n?w:C}
      }

      fn mm_readB(batch: i32, row : i32, col : i32) -> ${M} {
        ${n?C:w}
      }

      fn mm_write(batch: i32, row : i32, col : i32, valueIn : ${I}) {
        if (row < uniforms.dimAOuter && col < uniforms.dimBOuter)
        {
        var value = valueIn;
        let outWidth = ${n?"uniforms.outShape[2]":"uniforms.outShape[3]"};
        ${f}
        ${ts(o,i)}
        setOutputAtCoords(coords[0], coords[1], coords[2], coords[3], value);
        }
      }`}var Uk=class{constructor(t,e,r,o,i=!1,s=null,a=!1,l=!1){this.variableNames=["x","W"],this.uniforms="filterDims : vec2<i32>, pads : vec2<i32>, strides : vec2<i32>, dilations : vec2<i32>, dimAOuter : i32, dimBOuter : i32, dimInner : i32,",this.outputShape=t.outShape,this.isChannelsLast=t.dataFormat==="channelsLast",this.isVec4=((t.inChannels%4===0||t.inChannels%3===0)&&this.isChannelsLast||t.outWidth%4===0&&!this.isChannelsLast)&&t.outChannels%4===0,this.dispatchLayout=this.isChannelsLast?{x:[3],y:[1,2],z:[0]}:{x:[2,3],y:[1],z:[0]},this.workgroupSize=Dw(this.dispatchLayout,this.outputShape,this.isVec4),this.elementsPerThread=kw(this.dispatchLayout,this.outputShape,this.isVec4),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize,this.elementsPerThread),this.isVec4?(this.outputComponent=4,this.isChannelsLast&&t.inChannels%4!==0?(this.innerElementSize=3,this.variableComponents=[1,4]):(this.innerElementSize=4,this.variableComponents=[4,4]),i&&(this.variableNames.push("bias"),this.variableComponents.push(4)),a&&(this.variableNames.push("preluActivationWeights"),this.variableComponents.push(4))):(this.innerElementSize=this.elementsPerThread[0],i&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights")),this.sequentialAccessByThreads=l,this.addBias=i,this.activation=s,this.hasPreluActivationWeights=a,this.tileAOuter=this.workgroupSize[1]*this.elementsPerThread[1],this.tileBOuter=this.workgroupSize[0]*this.elementsPerThread[0],this.tileInner=Math.max(this.workgroupSize[0]*this.innerElementSize,this.workgroupSize[1]),this.fitAOuter=e%this.tileAOuter===0,this.fitBOuter=r%this.tileBOuter===0,this.fitInner=o%this.tileInner===0,this.shaderKey=`conv2DMM_${this.elementsPerThread}_${this.activation}}_${this.fitAOuter}_${this.fitBOuter}_${this.fitInner}_${this.isVec4}_${this.innerElementSize}_${this.isChannelsLast}_${this.sequentialAccessByThreads}`}getUserCode(){let t=this.isVec4?Km(this.elementsPerThread,this.workgroupSize,!this.isChannelsLast,this.tileInner):Xm(this.elementsPerThread,this.workgroupSize,!this.isChannelsLast,this.tileInner,!1,null,this.sequentialAccessByThreads),e=this.isVec4?[this.innerElementSize,4,4]:[1,1,1];return`
    ${eGe(this.isChannelsLast,this.fitAOuter,this.fitBOuter,this.fitInner,this.addBias,this.activation,this.hasPreluActivationWeights,e[0],e[1],e[2])}
    ${t}
  `}};var Wk=class{constructor(t,e=!1,r=null,o=!1){this.variableNames=["x","W"],this.uniforms="filterDims: vec2<i32>, pads: vec2<i32>, strides: vec2<i32>, dilations: vec2<i32>,",this.workgroupSize=[4,4,8],this.outputShape=t.outShape,this.isChannelsLast=t.dataFormat==="channelsLast",this.dispatchLayout=this.isChannelsLast?{x:[2],y:[1],z:[0,3]}:{x:[3],y:[2],z:[0,1]},this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.addBias=e,this.activation=r,this.hasPreluActivationWeights=o,e&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),this.shaderKey=`conv2dnaive_${this.activation}_${this.isChannelsLast}`}getUserCode(){return`
       ${To(this.activation,this.hasPreluActivationWeights,!1,4)}
       fn readInp(batch : i32, row : i32, col : i32, chan : i32) -> f32{
         let coords = vec4<i32>(batch, row, col, chan);
         if (coordsInBounds4D(coords, uniforms.xShape)) {
           return  getX(batch, row, col, chan);
         } else {
          return 0.0;
         }
       }
       fn readFilt(row : i32, col : i32, xChannel : i32, outChannel : i32) -> f32{
         let coords = vec4<i32>(row, col, xChannel, outChannel);
         if(coordsInBounds4D(coords, uniforms.wShape)) {
           return getW(row, col, xChannel, outChannel);
          } else {
            return 0.0;
          }
       }
       fn writeResult(batch : i32, row : i32, col : i32, chan : i32, valueIn : f32) {
         let coords = ${this.isChannelsLast?"vec4<i32>(batch, row, col, chan);":"vec4<i32>(batch, chan, row, col);"}
         if (coordsInBounds4D(coords, uniforms.outShape)) {
           var value = valueIn;
           ${ts(this.addBias,this.activation)}
           setOutputAtCoords(coords.x, coords.y, coords.z, coords.w, value);
         }
       }
       ${de("index")} {
         let coords = getOutputCoords();
         let batch = coords[0];
         let outChannel = ${this.isChannelsLast?"coords[3];":"coords[1];"}
         let outRow = ${this.isChannelsLast?"coords[1];":"coords[2];"}
         let outCol = ${this.isChannelsLast?"coords[2];":"coords[3];"}
         var acc : f32 = 0.0;
         for (var row = 0; row < uniforms.filterDims[0]; row = row + 1) {
           for (var col = 0; col < uniforms.filterDims[1]; col = col + 1) {
             let xRow = outRow * uniforms.strides[0] + uniforms.dilations[0] * row - uniforms.pads[0];
             let xCol = outCol * uniforms.strides[1] + uniforms.dilations[1] * col - uniforms.pads[1];
             for (var xChannel = 0; xChannel < ${this.isChannelsLast?"uniforms.xShape[3];":"uniforms.xShape[1];"} xChannel = xChannel + 1) {
               ${this.isChannelsLast?"let v = readInp(batch, xRow, xCol, xChannel);":"let v = readInp(batch, xChannel, xRow, xCol);"}
               let f = readFilt(row, col, xChannel, outChannel);
               acc = acc + v * f;
             }
           }
         }
         writeResult(batch, outRow, outCol, outChannel, acc);
       }
     `}};var Gk=class{constructor(t,e){this.variableNames=["x"],this.uniforms=`pads : vec2<i32>, strides : vec2<i32>, dilations : vec2<i32>, outWidth : i32, itemsPerBlockRow : i32,
       inChannels : i32,`,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=t,this.dispatchLayout=xe(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.isChannelsLast=e,this.shaderKey=`im2col_${this.isChannelsLast}`}getUserCode(){let t=this.isChannelsLast?1:2,e=this.isChannelsLast?2:3,r=this.isChannelsLast?"coords[1]":"coords[2]",o=this.isChannelsLast?"coords[2]":"coords[1]",i=this.isChannelsLast?"getX(batch, xRow, xCol, ch)":"getX(batch, ch, xRow, xCol)";return`
    ${de("index")} {
      let coords = getCoordsFromIndex(index);
      if(index < uniforms.size) {
        let batch = coords[0];
        let row = ${r};
        let col = ${o};
        let offsetY = (row / uniforms.outWidth) * uniforms.strides[0] - uniforms.pads[0];
        let xRow = offsetY + uniforms.dilations[0] * (col / uniforms.itemsPerBlockRow);
        var value = 0.0;
        if(xRow < uniforms.xShape[${t}] && xRow >= 0) {
          let offsetX = (row % uniforms.outWidth) * uniforms.strides[1] -
              uniforms.pads[1];
          let xCol = offsetX + uniforms.dilations[1] * ((col %
              uniforms.itemsPerBlockRow) / uniforms.inChannels);
          let ch = col % uniforms.inChannels;
          if(xCol < uniforms.xShape[${e}] && xCol >= 0) {
            value = ${i};
          }
        }
        setOutputAtIndex(index, value);
      }
    }
   `}};function jk(n,t){let e=n.length;return e>=3?t?[...n.slice(0,-3),n[e-3]*n[e-2],n[e-1]]:[...n.slice(0,-3),n[e-3],n[e-2]*n[e-1]]:!t&&e===1&&n[0]>1?[n[0],1]:null}function tGe({x:n,filter:t,convInfo:e,backend:r,bias:o=null,preluActivationWeights:i=null,leakyreluAlpha:s=0,activation:a=null}){let l=e.dataFormat==="channelsLast",c=!l,u=!1,d=l&&e.filterHeight===e.inHeight&&e.filterWidth===e.inWidth&&e.padInfo.type==="VALID",p=[],f,h;if(d){let y=e.inHeight*e.inWidth*e.inChannels;f=$e({inputs:{x:n},backend:r,attrs:{shape:[1,e.batchSize,y]}}),h=$e({inputs:{x:t},backend:r,attrs:{shape:[1,y,e.outChannels]}})}else f=$e({inputs:{x:n},backend:r,attrs:{shape:l?[e.batchSize,e.inHeight*e.inWidth,e.inChannels]:[e.batchSize,e.inChannels,e.inHeight*e.inWidth]}}),h=$e({inputs:{x:t},backend:r,attrs:{shape:[1,e.inChannels,e.outChannels]}});if(p.push(f),p.push(h),i!=null){let y=jk(i.shape,l);y!=null&&(i=$e({inputs:{x:i},backend:r,attrs:{shape:y}}),p.push(i))}if(o!=null){let y=jk(o.shape,l);y!=null&&(o=$e({inputs:{x:o},backend:r,attrs:{shape:y}}),p.push(o))}let m=Ym({a:l?f:h,b:l?h:f,transposeA:c,transposeB:u,backend:r,bias:o,activation:a,preluActivationWeights:i,leakyreluAlpha:s}),g=$e({inputs:{x:m},backend:r,attrs:{shape:e.outShape}});p.push(m);for(let y of p)r.disposeData(y.dataId);return g}function nGe({x:n,filter:t,convInfo:e,backend:r,bias:o=null,preluActivationWeights:i=null,leakyreluAlpha:s=0,activation:a=null}){let{filterWidth:l,filterHeight:c,inChannels:u,strideWidth:d,strideHeight:p,padInfo:f,outWidth:h,outHeight:m,dilationWidth:g,dilationHeight:y,dataFormat:v}=e,w=v==="channelsLast",C=l*c*u,I=m*h,A=w?[e.batchSize,I,C]:[e.batchSize,C,I],M=new Gk(A,w),$=[{type:"int32",data:[f.top,f.left]},{type:"int32",data:[p,d]},{type:"int32",data:[y,g]},{type:"int32",data:[h]},{type:"int32",data:[u*l]},{type:"int32",data:[u]}],V=r.runWebGPUProgram(M,[n],n.dtype,$),W=[];W.push(V);let K=$e({inputs:{x:t},backend:r,attrs:{shape:[1,C,-1]}});if(W.push(K),i!=null){let se=jk(i.shape,w);se!=null&&(i=$e({inputs:{x:i},backend:r,attrs:{shape:se}}),W.push(i))}if(o!=null){let se=jk(o.shape,w);se!=null&&(o=$e({inputs:{x:o},backend:r,attrs:{shape:se}}),W.push(o))}let oe=Ym({a:w?V:K,b:w?K:V,transposeA:!w,transposeB:!1,backend:r,bias:o,activation:a,preluActivationWeights:i,leakyreluAlpha:s}),ie=$e({inputs:{x:oe},backend:r,attrs:{shape:e.outShape}});W.push(oe);for(let se of W)r.disposeData(se.dataId);return ie}function Hk({x:n,filter:t,convInfo:e,backend:r,bias:o=null,preluActivationWeights:i=null,leakyreluAlpha:s=0,activation:a=null}){let l=o!=null,c=i!=null,u=e.dataFormat==="channelsLast",d=u&&e.filterHeight===e.inHeight&&e.filterWidth===e.inWidth&&e.padInfo.type==="VALID",p=q().getBool("WEBGPU_USE_NAIVE_CONV2D_DEBUG");if(!p&&(d||e.filterHeight===1&&e.filterWidth===1&&e.dilationHeight===1&&e.dilationWidth===1&&e.strideHeight===1&&e.strideWidth===1&&(e.padInfo.type==="SAME"||e.padInfo.type==="VALID")))return tGe({x:n,filter:t,convInfo:e,backend:r,bias:o,activation:a,preluActivationWeights:i,leakyreluAlpha:s});let f=q().getNumber("WEBGPU_THRESHOLD_TO_INCREASE_WORKGROUPS_FOR_MATMUL"),h=f>-1?f:r.thresholdToIncreaseWorkgroups,m=e.batchSize*Math.ceil(e.outHeight*e.outWidth/32)*Math.ceil(e.outChannels/32);if(q().getBool("WEBGPU_CONV_SEPARATE_IM2COL_SHADER")||m<=h)return nGe({x:n,filter:t,convInfo:e,backend:r,bias:o,preluActivationWeights:i,leakyreluAlpha:s,activation:a});let g,y=[e.padInfo.top,e.padInfo.left],v=[{type:"int32",data:[e.filterHeight,e.filterWidth]},{type:"int32",data:[...y]},{type:"int32",data:[e.strideHeight,e.strideWidth]},{type:"int32",data:[e.dilationHeight,e.dilationWidth]}];if(p)g=new Wk(e,l,a,c);else{let A=u?e.outHeight*e.outWidth:e.outChannels,M=u?e.outChannels:e.outHeight*e.outWidth,$=e.filterHeight*e.filterWidth*e.inChannels;v.push({type:"int32",data:[A]},{type:"int32",data:[M]},{type:"int32",data:[$]});let V=r.adapterInfo.isIntel();g=new Uk(e,A,M,$,l,a,c,V)}let w=[],C=[n,t];l&&(!u&&o.shape.length===1&&(o=$e({inputs:{x:o},backend:r,attrs:{shape:[o.shape[0],1,1]}}),w.push(o)),C.push(o)),c&&(!u&&i.shape.length===1&&(i=$e({inputs:{x:i},backend:r,attrs:{shape:[i.shape[0],1,1]}}),w.push(i)),C.push(i)),a==="leakyrelu"&&(v.push({type:"float32",data:[s]}),g.uniforms+=" alpha : f32,");let I=r.runWebGPUProgram(g,C,n.dtype,v);for(let A of w)r.disposeData(A.dataId);return I}function rGe(n){let{inputs:t,attrs:e,backend:r}=n,{x:o,filter:i}=t,{strides:s,pad:a,dataFormat:l,dilations:c,dimRoundingMode:u}=e,d=T.convertConv2DDataFormat(l),p=T.computeConv2DInfo(o.shape,i.shape,s,c,a,u,!1,d);return Hk({x:o,filter:i,convInfo:p,backend:r})}var hae={kernelName:Ac,backendName:"webgpu",kernelFunc:rGe};var qk=class{constructor(t){this.variableNames=["dy","W"],this.uniforms="filterDims : vec2<i32>, pads : vec2<i32>, strides : vec2<i32>, outBackprop : vec4<i32>,",this.workgroupSize=[64,1,1],this.size=!1,this.isVec4=!1,this.workPerThread=1,this.outputShape=t.inShape,this.isChannelsLast=t.dataFormat==="channelsLast",this.isVec4=this.isChannelsLast&&t.outChannels%4===0&&t.inChannels%4===0,this.isVec4?(this.workPerThread=2,this.outputComponent=4,this.workgroupSize=[4,4,4],this.dispatchLayout={x:[3],y:[2],z:[0,1]},this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize,[4,this.workPerThread,1])):(this.size=!0,this.workPerThread=1,this.workgroupSize=[64,1,1],this.dispatchLayout=xe(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize)),this.shaderKey=`conv2DDerInput_${this.isChannelsLast}_${this.isVec4}_${this.workPerThread}`}getUserCode(){let t=this.isChannelsLast?1:2,e=this.isChannelsLast?2:3,r=this.isChannelsLast?3:1,o=`
    ${de()} {
      let batch = i32(globalId.z) / uniforms.outShape[1];
      let r = i32(globalId.z) % uniforms.outShape[1];
      let c = i32(globalId.y) * ${this.workPerThread};
      let d1 = i32(globalId.x) * 4;

      let dyCorner = vec2<i32>(r, c) - uniforms.pads;

      // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
      // ? = to be determined. : = across all values in that axis.
      var dotProd: array<vec4<f32>, ${this.workPerThread}>;
      for (var i = 0; i < ${this.workPerThread}; i++) {
        dotProd[i] = vec4<f32>(0.0);
      }
      for (var wR = 0; wR < uniforms.filterDims.x; wR = wR + 1) {
        let dyR = f32(dyCorner.x + wR) / f32(uniforms.strides.x);
        let wRPerm = uniforms.filterDims.x - 1 - wR;
        if (dyR < 0.0 || dyR >= f32(uniforms.outBackprop[1]) ||
            fract(dyR) > 0.0) {
          continue;
        }
        let idyR = i32(dyR);

        for (var wC = 0; wC < uniforms.filterDims.y; wC = wC + 1) {
          let dyC = f32(dyCorner.y + wC) / f32(uniforms.strides.y);
          let dyC2 = f32(dyCorner.y + 1 + wC) / f32(uniforms.strides.y);
          let wCPerm = uniforms.filterDims.y - 1 - wC;
          var bDyCVal = true;
          var bDyCVal2 = true;
          if (dyC < 0.0 || dyC >= f32(uniforms.outBackprop[2]) ||
              fract(dyC) > 0.0) {
            bDyCVal = false;
          }
          if (dyC2 < 0.0 || dyC2 >= f32(uniforms.outBackprop[2]) ||
              fract(dyC2) > 0.0) {
            bDyCVal2 = false;
          }

          let idyC = i32(dyC);
          let idyC2 = i32(dyC2);
          if (bDyCVal && bDyCVal2) {
            let d2Length = uniforms.outBackprop[3];
            for (var d2 = 0; d2 < d2Length; d2 = d2 + 4) {
              let wValue0 = getW(wRPerm, wCPerm, d1, d2);
              let wValue1 = getW(wRPerm, wCPerm, d1 + 1, d2);
              let wValue2 = getW(wRPerm, wCPerm, d1 + 2, d2);
              let wValue3 = getW(wRPerm, wCPerm, d1 + 3, d2);
              var xValue =  getDy(batch, idyR, idyC, d2);
              let tmpval = vec4<f32>(dot(xValue, wValue0),
                                     dot(xValue, wValue1),
                                     dot(xValue, wValue2),
                                     dot(xValue, wValue3));
              dotProd[0] = dotProd[0] + tmpval;
              xValue = getDy(batch, idyR, idyC2, d2);
              dotProd[1] = dotProd[1] + vec4<f32>(dot(xValue, wValue0),
                                                  dot(xValue, wValue1),
                                                  dot(xValue, wValue2),
                                                  dot(xValue, wValue3));
            }
          } else if (bDyCVal) {
            let d2Length = uniforms.outBackprop[3];
            for (var d2 = 0; d2 < d2Length; d2 = d2 + 4) {
              let wValue0 = getW(wRPerm, wCPerm, d1, d2);
              let wValue1 = getW(wRPerm, wCPerm, d1 + 1, d2);
              let wValue2 = getW(wRPerm, wCPerm, d1 + 2, d2);
              let wValue3 = getW(wRPerm, wCPerm, d1 + 3, d2);
              var xValue =  getDy(batch, idyR, idyC, d2);
              let tmpval = vec4<f32>(dot(xValue, wValue0),
                                     dot(xValue, wValue1),
                                     dot(xValue, wValue2),
                                     dot(xValue, wValue3));
              dotProd[0] = dotProd[0] + tmpval;
            }
          } else if (bDyCVal2) {
            let d2Length = uniforms.outBackprop[3];
            for (var d2 = 0; d2 < d2Length; d2 = d2 + 4) {
              let wValue0 = getW(wRPerm, wCPerm, d1, d2);
              let wValue1 = getW(wRPerm, wCPerm, d1 + 1, d2);
              let wValue2 = getW(wRPerm, wCPerm, d1 + 2, d2);
              let wValue3 = getW(wRPerm, wCPerm, d1 + 3, d2);
              var xValue =  getDy(batch, idyR, idyC2, d2);
              let tmpval = vec4<f32>(dot(xValue, wValue0),
                                     dot(xValue, wValue1),
                                     dot(xValue, wValue2),
                                     dot(xValue, wValue3));
              dotProd[1] = dotProd[1] + tmpval;
            }
          }
        }
      }

      for (var i = 0; i < ${this.workPerThread}; i = i + 1) {
        let coords = vec4<i32>(batch, r, c + i, d1);
        if (coordsInBounds4D(coords, uniforms.outShape)) {
          setOutputAtCoords(coords[0], coords[1], coords[2], coords[3], dotProd[i]);
        }
      }
    }
    `;return this.isVec4?`
    ${o}
    `:`
    ${de("index")} {
      if(index < uniforms.size) {
        let coords = getCoordsFromIndex(index);
        let batch = coords[0];
        let d1 = coords[${r}];

        let dyCorner = vec2<i32>(coords[${t}], coords[${e}]) - uniforms.pads;
        let dyRCorner = dyCorner.x;
        let dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        var dotProd = 0.0;
        for (var wR = 0; wR < uniforms.filterDims.x; wR = wR + 1) {
          let dyR = (f32(dyRCorner) + f32(wR)) / f32(uniforms.strides.x);
          let wRPerm = uniforms.filterDims.x - 1 - wR;
          if (dyR < 0.0 || dyR >= f32(uniforms.outBackprop[1]) || fract(dyR) > 0.0 ||
              wRPerm < 0) {
            continue;
          }
          let idyR = i32(dyR);

          for (var wC = 0; wC < uniforms.filterDims.y; wC = wC + 1) {
            let dyC = (f32(dyCCorner) + f32(wC)) / f32(uniforms.strides.y);
            let wCPerm = uniforms.filterDims.y - 1 - wC;
            if (dyC < 0.0 || dyC >= f32(uniforms.outBackprop[2]) ||
                fract(dyC) > 0.0 || wCPerm < 0) {
              continue;
            }
            let idyC = i32(dyC);

            for (var d2 = 0; d2 < uniforms.outBackprop[3]; d2 = d2 + 1) {
              let xValue = ${this.isChannelsLast?"getDy(batch, idyR, idyC, d2)":"getDy(batch, d2, idyR, idyC)"};
              let wValue = getW(wRPerm, wCPerm, d1, d2);
              dotProd = dotProd + xValue * wValue;
            }
          }
        }
        setOutputAtIndex(index, dotProd);
      }
    }
  `}},Kk=class{constructor(t){this.variableNames=["x","dy"],this.uniforms="pads : vec2<i32>, strides : vec2<i32>, batchSize : i32, outHeight : i32, outWidth : i32, inHeight : i32, inWidth : i32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=t.filterShape,this.dispatchLayout=xe(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.isChannelsLast=t.dataFormat==="channelsLast",this.shaderKey=`conv2DDerFilter_${this.isChannelsLast}`}getUserCode(){return`
    ${de("index")} {
      if(index < uniforms.size) {
        let coords = getCoordsFromIndex(index);
        let wR = coords[0];
        let wC = coords[1];
        let d1 = coords[2];
        let d2 = coords[3];

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        var dotProd = 0.0;
        for (var b = 0; b < uniforms.batchSize; b = b + 1) {
          for (var yR = 0; yR < uniforms.outHeight; yR = yR + 1) {
            let xR = wR + yR * uniforms.strides[0] - uniforms.pads[0];
            if (xR < 0 || xR >= uniforms.inHeight) {
              continue;
            }

            for (var yC = 0; yC < uniforms.outWidth; yC = yC + 1) {
              let xC = wC + yC * uniforms.strides[1] - uniforms.pads[1];

              if (xC < 0 || xC >= uniforms.inWidth) {
                continue;
              }

              if (${this.isChannelsLast}) {
                let dyValue = getDy(b, yR, yC, d2);
                let xValue = getX(b, xR, xC, d1);
                dotProd = dotProd + xValue * dyValue;
              } else {
                let dyValue = getDy(b, d2, yR, yC);
                let xValue = getX(b, d1, xR, xC);
                dotProd = dotProd + xValue * dyValue;
              }
            }
          }
        }
        setOutputAtIndex(index, dotProd);
      }
    }
  `}},Xk=class{constructor(t){this.variableNames=["x","dy"],this.uniforms=`pads : vec3<i32>, strides : vec3<i32>, batchSize : i32, outDepth : i32,
       outHeight : i32, outWidth : i32, inDepth : i32, inHeight : i32, inWidth : i32,`,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=t.filterShape,this.dispatchLayout=xe(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="conv3DDerFilter"}getUserCode(){return`
    ${de("index")} {
      if(index < uniforms.size) {
        let coords = getCoordsFromIndex(index);
        let wF = coords.x;
        let wR = coords.y;
        let wC = coords.z;
        let d1 = coords.w;
        let d2 = coords.u;

        var dotProd = 0.0;
        for (var b = 0; b < uniforms.batchSize; b++) {
          for (var yF = 0; yF < uniforms.outDepth; yF++) {
            let xF = wF + yF * uniforms.strides[0] - uniforms.pads[0];
            if (xF < 0 || xF >= uniforms.inDepth) {
              continue;
            }

            for (var yR = 0; yR < uniforms.outHeight; yR++) {
              let xR = wR + yR * uniforms.strides[1] - uniforms.pads[1];
              if (xR < 0 || xR >= uniforms.inHeight) {
                continue;
              }

              for (var yC = 0; yC < uniforms.outWidth; yC++) {
                let xC = wC + yC * uniforms.strides[2] - uniforms.pads[2];
                if (xC < 0 || xC >= uniforms.inWidth) {
                  continue;
                }

                let dyValue = getDy(b, yF, yR, yC, d2);
                let xValue = getX(b, xF, xR, xC, d1);
                dotProd += xValue * dyValue;
              }
            }
          }
        }
        setOutputAtIndex(index, dotProd);
      }
    }
  `}},Yk=class{constructor(t){this.variableNames=["dy","W"],this.uniforms=`filterDims : vec3<i32>, pads : vec3<i32>, strides : vec3<i32>,
      outDepth : i32, outHeight : i32, outWidth : i32, outChannels : i32,`,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=t.inShape,this.dispatchLayout=xe(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="conv3DDerInput"}getUserCode(){return`
    ${de("index")} {
      if(index < uniforms.size) {
        let coords = getCoordsFromIndex(index);
        let batch = coords.x;
        let d1 = coords.u;

        let dyCorner = vec3<i32>(coords.y, coords.z, coords.w) - uniforms.pads;
        let dyFCorner = dyCorner.x;
        let dyRCorner = dyCorner.y;
        let dyCCorner = dyCorner.z;

        var dotProd = 0.0;
        for (var wF = 0; wF < uniforms.filterDims[0]; wF++) {
          let dyF = f32(dyFCorner + wF) / f32(uniforms.strides[0]);
          if (dyF < 0.0 || dyF >= f32(uniforms.outDepth) || fract(dyF) > 0.0) {
            continue;
          }
          let idyF = i32(dyF);

          let wFPerm = uniforms.filterDims[0] - 1 - wF;

          for (var wR = 0; wR < uniforms.filterDims[1]; wR++) {
            let dyR = f32(dyRCorner + wR) / f32(uniforms.strides[1]);

            if (dyR < 0.0 || dyR >= f32(uniforms.outHeight) || fract(dyR) > 0.0) {
              continue;
            }
            let idyR = i32(dyR);

            let wRPerm = uniforms.filterDims[1] - 1 - wR;

            for (var wC = 0; wC < uniforms.filterDims[2]; wC++) {
              let dyC = f32(dyCCorner + wC) / f32(uniforms.strides[2]);

              if (dyC < 0.0 || dyC >= f32(uniforms.outWidth) || fract(dyC) > 0.0) {
                continue;
              }
              let idyC = i32(dyC);

              let wCPerm = uniforms.filterDims[2] - 1 - wC;

              for (var d2 = 0; d2 < uniforms.outChannels; d2++) {
                let xValue = getDy(batch, idyF, idyR, idyC, d2);
                let wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutputAtIndex(index, dotProd);
      }
    }
  `}};function oGe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,dy:i}=t,{strides:s,pad:a,dataFormat:l,dimRoundingMode:c,filterShape:u}=r,d=T.convertConv2DDataFormat(l),p=T.computeConv2DInfo(o.shape,u,s,1,a,c,!1,d),f=new Kk(p),h=[{type:"int32",data:[p.padInfo.top,p.padInfo.left]},{type:"int32",data:[p.strideHeight,p.strideWidth]},{type:"int32",data:[p.batchSize]},{type:"int32",data:[p.outHeight]},{type:"int32",data:[p.outWidth]},{type:"int32",data:[p.inHeight]},{type:"int32",data:[p.inWidth]}];return e.runWebGPUProgram(f,[o,i],o.dtype,h)}var mae={kernelName:Mp,backendName:"webgpu",kernelFunc:oGe};function iGe(n=4){let t=i=>{switch(i){case 1:return"return W[getIndexFromCoords4D(coord, uniforms.wShape)];";case 4:return`
            let coord1 = vec4<i32>(coordX, coordY, col + 1, rowInner);
            let coord2 = vec4<i32>(coordX, coordY, col + 2, rowInner);
            let coord3 = vec4<i32>(coordX, coordY, col + 3, rowInner);
            let v0 = W[getIndexFromCoords4D(coord, uniforms.wShape)];
            let v1 = W[getIndexFromCoords4D(coord1, uniforms.wShape)];
            let v2 = W[getIndexFromCoords4D(coord2, uniforms.wShape)];
            let v3 = W[getIndexFromCoords4D(coord3, uniforms.wShape)];
            return vec4<f32>(v0, v1, v2, v3);
            `;default:throw new Error(`innerElementSize ${i} is not supported.`)}},r=`if (row < uniforms.dimAOuter && col < uniforms.dimInner) {
        ${`
      let outRow = row / uniforms.outShape[2];
      let outCol = row % uniforms.outShape[2];

      let WRow = col / (uniforms.filterDims[1] * uniforms.outBackprop[3]);
      let WCol = col / uniforms.outBackprop[3] % uniforms.filterDims[1];
      let xR = f32(outRow - uniforms.pads[0] + WRow) / f32(uniforms.strides[0]);
      let xC = f32(outCol - uniforms.pads[1] + WCol) / f32(uniforms.strides[1]);
      if (xR < 0.0 || xR >= f32(uniforms.outBackprop[1]) || fract(xR) > 0.0) {
        return ${At(n)}(0.0);
      }
      if (xC < 0.0 || xC >= f32(uniforms.outBackprop[2]) || fract(xC) > 0.0) {
        return ${At(n)}(0.0);
      }
      let coord = vec4<i32>(
          batch,
          i32(xR),
          i32(xC),
          col % uniforms.outBackprop[3]);
      return x[getIndexFromCoords4D(coord, uniforms.xShape)/${n}];`}
      }
      return ${At(n)}(0.0);`;return`
  fn mm_readA(batch: i32, row : i32, col : i32) -> ${At(n)} {
    ${r}
  }

  fn mm_readB(batch: i32, row : i32, col : i32) -> ${At(n)} {
    let coordX = uniforms.filterDims.x - 1 -
        row / (uniforms.filterDims[1] * uniforms.outBackprop[3]);
    let coordY = uniforms.filterDims.y - 1 -
        (row / uniforms.outBackprop[3]) % uniforms.filterDims[1];
    if (row < uniforms.dimInner && col < uniforms.dimBOuter &&
        coordX >= 0 && coordY >= 0) {
      let rowInner = row % uniforms.outBackprop[3];
      let coord = vec4<i32>(coordX, coordY, col, rowInner);
      ${t(n)}
    }
    return ${At(n)}(0.0);
  }

  fn mm_write(batch: i32, row : i32, col : i32, valueInput : ${At(n)}) {
    if (row < uniforms.dimAOuter && col < uniforms.dimBOuter) {
      var value = valueInput;
      let outCoord = vec4<i32>(
          batch,
          row / uniforms.outShape[2],
          row % uniforms.outShape[2],
          col);
      result[getIndexFromCoords4D(outCoord, uniforms.outShape)/${n}] = value;
    }
  }`}var Zk=class{constructor(t){this.variableNames=["x","W"],this.uniforms="filterDims : vec2<i32>, pads : vec2<i32>, strides : vec2<i32>, outBackprop : vec4<i32>, dimAOuter : i32, dimBOuter : i32, dimInner : i32,",this.outputShape=t.inShape,b.assert(t.dataFormat==="channelsLast",()=>"TODO: NCHW is unimplemented"),this.isVec4=t.inChannels%4===0&&t.outChannels%4===0,this.dispatchLayout={x:[3],y:[1,2],z:[0]},this.workgroupSize=Dw(this.dispatchLayout,this.outputShape,this.isVec4),this.elementsPerThread=kw(this.dispatchLayout,this.outputShape,this.isVec4),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize,this.elementsPerThread),this.isVec4&&(this.outputComponent=4,this.variableComponents=[4,1]),this.shaderKey=`conv2DDerInputMM_${this.isVec4}_${this.elementsPerThread}`}getUserCode(){let t=this.isVec4?Km(this.elementsPerThread,this.workgroupSize):Xm(this.elementsPerThread,this.workgroupSize);return`
    ${iGe(this.isVec4?4:1)}
    ${t}
    `}};function sGe(n){let{inputs:t,backend:e,attrs:r}=n,{dy:o,filter:i}=t,{inputShape:s,strides:a,pad:l,dataFormat:c,dimRoundingMode:u}=r,d=T.convertConv2DDataFormat(c),p=T.computeConv2DInfo(s,i.shape,a,1,l,u,!1,d),f=[{type:"int32",data:[p.filterHeight,p.filterWidth]},{type:"int32",data:[p.filterHeight-1-p.padInfo.top,p.filterWidth-1-p.padInfo.left]},{type:"int32",data:[p.strideHeight,p.strideWidth]},{type:"int32",data:[p.batchSize,p.outHeight,p.outWidth,p.outChannels]}],h;if(q().getBool("WEBGPU_USE_NAIVE_CONV2D_TRANSPOSE")||p.dataFormat!=="channelsLast")h=new qk(p);else{h=new Zk(p);let m=p.inHeight*p.inWidth,g=p.inChannels,y=p.filterHeight*p.filterWidth*p.outChannels;f.push({type:"uint32",data:[m]},{type:"uint32",data:[g]},{type:"uint32",data:[y]})}return e.runWebGPUProgram(h,[o,i],"float32",f)}var gae={kernelName:Rc,backendName:"webgpu",kernelFunc:sGe};var Qk=class{constructor(t){this.variableNames=["x","W"],this.uniforms="filterDims: vec3<i32>, pads: vec3<i32>, strides: vec3<i32>, dilations: vec3<i32>,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=t.outShape,this.dispatchLayout=xe(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="conv3dnaive"}getUserCode(){return`
    ${de("index")} {
      if (index < uniforms.size) {
        let coords = getOutputCoords();
        let batch = coords.x;
        let d2 = coords.u;

        let xFRCCorner = vec3<i32>(coords.y, coords.z, coords.w) * uniforms.strides - uniforms.pads;
        let xFCorner = xFRCCorner.x;
        let xRCorner = xFRCCorner.y;
        let xCCorner = xFRCCorner.z;

        let inputDepthNearestVec4 = (uniforms.xShape.u / 4) * 4;
        let inputDepthVec4Remainder = uniforms.xShape.u % 4;

        var dotProd = 0.0;
        for (var wF = 0; wF < uniforms.filterDims[0]; wF++) {
          let xF = xFCorner + wF * uniforms.dilations[0];
          if (xF < 0 || xF >= uniforms.xShape.y) {
            continue;
          }

          for (var wR = 0; wR < uniforms.filterDims[1]; wR++) {
            let xR = xRCorner + wR * uniforms.dilations[1];
            if (xR < 0 || xR >= uniforms.xShape.z) {
              continue;
            }

            for (var wC = 0; wC < uniforms.filterDims[2]; wC++) {
              let xC = xCCorner + wC * uniforms.dilations[2];
              if (xC < 0 || xC >= uniforms.xShape.w) {
                continue;
              }

              for (var d1 = 0; d1 < inputDepthNearestVec4; d1 += 4) {
                let xValues = vec4<f32>(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                let wValues = vec4<f32>(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (inputDepthVec4Remainder == 1) {
                dotProd += getX(batch, xF, xR, xC, inputDepthNearestVec4) *
                  getW(wF, wR, wC, inputDepthNearestVec4, d2);
              } else if (inputDepthVec4Remainder == 2) {
                let xValues = vec2<f32>(
                  getX(batch, xF, xR, xC, inputDepthNearestVec4),
                  getX(batch, xF, xR, xC, inputDepthNearestVec4 + 1)
                );
                let wValues = vec2<f32>(
                  getW(wF, wR, wC, inputDepthNearestVec4, d2),
                  getW(wF, wR, wC, inputDepthNearestVec4 + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (inputDepthVec4Remainder == 3) {
                let xValues = vec3<f32>(
                  getX(batch, xF, xR, xC, inputDepthNearestVec4),
                  getX(batch, xF, xR, xC, inputDepthNearestVec4 + 1),
                  getX(batch, xF, xR, xC, inputDepthNearestVec4 + 2)
                );
                let wValues = vec3<f32>(
                  getW(wF, wR, wC, inputDepthNearestVec4, d2),
                  getW(wF, wR, wC, inputDepthNearestVec4 + 1, d2),
                  getW(wF, wR, wC, inputDepthNearestVec4 + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutputAtIndex(index, dotProd);
      }
    }`}};function aGe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,filter:i}=t,{strides:s,pad:a,dilations:l}=r,c=T.computeConv3DInfo(o.shape,i.shape,s,l,a),u=[c.padInfo.front,c.padInfo.top,c.padInfo.left],d=[{type:"int32",data:[c.filterDepth,c.filterHeight,c.filterWidth]},{type:"int32",data:[...u]},{type:"int32",data:[c.strideDepth,c.strideHeight,c.strideWidth]},{type:"int32",data:[c.dilationDepth,c.dilationHeight,c.dilationWidth]}],p=new Qk(c),f=En(o.dtype,i.dtype);return e.runWebGPUProgram(p,[o,i],f,d)}var yae={kernelName:Oc,backendName:"webgpu",kernelFunc:aGe};function lGe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,dy:i}=t,{strides:s,pad:a,filterShape:l}=r,c=T.computeConv3DInfo(o.shape,l,s,1,a),u=new Xk(c),d=[{type:"int32",data:[c.padInfo.front,c.padInfo.top,c.padInfo.left]},{type:"int32",data:[c.strideDepth,c.strideHeight,c.strideWidth]},{type:"int32",data:[c.batchSize]},{type:"int32",data:[c.outDepth]},{type:"int32",data:[c.outHeight]},{type:"int32",data:[c.outWidth]},{type:"int32",data:[c.inDepth]},{type:"int32",data:[c.inHeight]},{type:"int32",data:[c.inWidth]}];return e.runWebGPUProgram(u,[o,i],i.dtype,d)}var xae={kernelName:Pp,backendName:"webgpu",kernelFunc:lGe};function cGe(n){let{inputs:t,backend:e,attrs:r}=n,{dy:o,filter:i}=t,{strides:s,pad:a,inputShape:l}=r,c=T.computeConv3DInfo(l,i.shape,s,1,a),u=new Yk(c),d=[{type:"int32",data:[c.filterDepth,c.filterHeight,c.filterWidth]},{type:"int32",data:[c.filterDepth-1-c.padInfo.front,c.filterHeight-1-c.padInfo.top,c.filterWidth-1-c.padInfo.left]},{type:"int32",data:[c.strideDepth,c.strideHeight,c.strideWidth]},{type:"int32",data:[c.outDepth]},{type:"int32",data:[c.outHeight]},{type:"int32",data:[c.outWidth]},{type:"int32",data:[c.outChannels]}];return e.runWebGPUProgram(u,[o,i],o.dtype,d)}var vae={kernelName:Fp,backendName:"webgpu",kernelFunc:cGe};var uGe=Qe({opType:Ce.COS}),bae={kernelName:Ua,backendName:"webgpu",kernelFunc:uGe};var dGe=Qe({opType:Ce.COSH}),wae={kernelName:Wa,backendName:"webgpu",kernelFunc:dGe};var Jk=class{constructor(t,e,r,o){this.variableNames=["Image","Boxes","BoxInd"],this.uniforms="extrapolationValue : f32,",this.workgroupSize=[64,1,1],this.size=!0;let[i]=e;this.outputShape=[i,r[0],r[1],t],this.dispatchLayout=xe(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.methodId=o==="bilinear"?1:0,this.cropHeightBiggerThan1=this.outputShape[1]>1,this.cropWidthBiggerThan1=this.outputShape[2]>1,this.shaderKey=`cropAndResize_${this.methodId}_${this.cropHeightBiggerThan1}_${this.cropWidthBiggerThan1}`}getUserCode(){let[t,e]=["f32(uniforms.imageShape[1] - 1)","f32(uniforms.imageShape[2] - 1)"],[r,o,i]=this.cropHeightBiggerThan1?[`(${t} / f32(uniforms.outShape[1] - 1))`,"(y2-y1) * height_ratio",`y1*${t} + f32(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${t}`],[s,a,l]=this.cropWidthBiggerThan1?[`(${e} / f32(uniforms.outShape[2] - 1))`,"(x2-x1) * width_ratio",`x1*${e} + f32(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${e}`];return`
    ${de("index")} {
      if (index < uniforms.size) {
        let coords = getCoordsFromIndex(index);
        let height_ratio = f32(${r});
        let width_ratio = f32(${s});
        let b = coords[0];
        let y = coords[1];
        let x = coords[2];
        let d = coords[3];
        // get box vals
        let y1 = getBoxes(b, 0);
        let x1 = getBoxes(b, 1);
        let y2 = getBoxes(b, 2);
        let x2 = getBoxes(b, 3);
        // get image in batch index
        let bInd = i32(round(getBoxInd(b)));
        if(bInd < 0 || bInd >= uniforms.outShape[0]) {
          return;
        }
        let height_scale = ${o};
        let width_scale = ${a};
        let in_y = ${i};
        if( in_y < 0.0 || in_y > ${t} ) {
          setOutputAtIndex(index, uniforms.extrapolationValue);
          return;
        }
        let in_x = ${l};
        if( in_x < 0.0 || in_x > ${e} ) {
          setOutputAtIndex(index, uniforms.extrapolationValue);
          return;
        }
        let sourceFracIndexCR = vec2<f32>(in_x,in_y);
        if(${this.methodId} == 1) {
          // Compute the four integer indices.
          let sourceFloorCR = vec2<i32>(sourceFracIndexCR);
          let sourceCeilCR = vec2<i32>(ceil(sourceFracIndexCR));
          let topLeft = getImage(bInd, sourceFloorCR.y, sourceFloorCR.x, d);
          let bottomLeft = getImage(bInd, sourceCeilCR.y, sourceFloorCR.x, d);
          let topRight = getImage(bInd, sourceFloorCR.y, sourceCeilCR.x, d);
          let bottomRight = getImage(bInd, sourceCeilCR.y, sourceCeilCR.x, d);
          let fracCR = sourceFracIndexCR - vec2<f32>(sourceFloorCR);
          let top = topLeft + (topRight - topLeft) * fracCR.x;
          let bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          let newValue = top + (bottom - top) * fracCR.y;
          setOutputAtIndex(index, newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          let sourceNearestCR = vec2<i32>(floor(
            sourceFracIndexCR + vec2<f32>(0.5,0.5)));
          let newValue = getImage(
            bInd, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutputAtIndex(index, newValue);
        }
      }
    }
    `}};var pGe=n=>{let{inputs:t,backend:e,attrs:r}=n,{image:o,boxes:i,boxInd:s}=t,{cropSize:a,method:l,extrapolationValue:c}=r,u=new Jk(o.shape[3],i.shape,a,l),d=[{type:"float32",data:[c]}];return e.runWebGPUProgram(u,[o,i,s],"float32",d)},Cae={kernelName:$p,backendName:"webgpu",kernelFunc:pGe};var bv=function(n){return n.Prod="*",n.Sum="+",n}(bv||{}),Mw=class{constructor(t,e,r,o){this.variableNames=["x"],this.uniforms="index : f32,",this.size=!0,this.workgroupSize=[128,1,1],this.outputShape=e,this.dispatchLayout=xe(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.exclusive=r,this.reverse=o,this.op=t,this.shaderKey=`cum_${this.op}_${this.exclusive}_${this.reverse}`}getUserCode(){let t=this.outputShape.length,e=this.op===bv.Prod?"1.0":"0.0",r=this.exclusive?e:`getX(${_ae(t,"coords",this.op)})`,o=this.outputShape[this.outputShape.length-1],i="",s="";return this.exclusive?(i=this.reverse?`end != ${o-1}`:"end != 0",s=this.reverse?"end + 1":"end - 1"):(i=this.reverse?`end + pow2 < ${o}`:"end >= pow2",s=this.reverse?"end + pow2":"end - pow2"),`
      ${de("index")} {
       if (index < uniforms.size) {
         var coords = getCoordsFromIndex(index);

         let end = ${Sae(t,"coords",this.op)};
         var val = ${r};
         let pow2 = i32(pow(2.0, uniforms.index));
         if (${i}) {
           let idx = ${s};
           ${Sae(t,"coords",this.op)} = idx;
           val ${this.op}= getX(${_ae(t,"coords",this.op)});
         }
         setOutputAtIndex(index, val);
       }
      }
    `}};function _ae(n,t,e){if(n===1)return`${t}`;if(n===2)return`${t}.x, ${t}.y`;if(n===3)return`${t}.x, ${t}.y, ${t}.z`;if(n===4)return`${t}.x, ${t}.y, ${t}.z, ${t}.w`;throw Error(`Cumulative ${e} for rank ${n} is not yet supported`)}function Sae(n,t,e){if(n===1)return`${t}`;if(n===2)return`${t}.y`;if(n===3)return`${t}.z`;if(n===4)return`${t}.w`;throw Error(`Cumulative ${e} for rank ${n} is not yet supported`)}function eN(n,t,e,r,o,i){let s=t.shape.length,a=T.getAxesPermutation([r],s),l=t;a!=null&&(l=Bo({inputs:{x:t},backend:e,attrs:{perm:a}}));let c=T.getInnerMostAxes(1,s)[0];if(c!==s-1)throw new Error(`WebGPU cumprod shader expects an inner-most axis=${t.shape.length-1} but got axis=${r}`);let u=l.shape[c],d=Sr({inputs:{x:l},backend:e});for(let p=0;p<=Math.ceil(Math.log2(u))-1;p++){let f=new Mw(n,l.shape,!1,i),h=d,m=[{type:"float32",data:[p]}];d=e.runWebGPUProgram(f,[d],d.dtype,m),e.disposeData(h.dataId)}if(o){let p=new Mw(n,l.shape,o,i),f=d,h=[{type:"float32",data:[0]}];d=e.runWebGPUProgram(p,[d],d.dtype,h),e.disposeData(f.dataId)}if(a!=null){let p=T.getUndoAxesPermutation(a),f=Bo({inputs:{x:d},backend:e,attrs:{perm:p}});return e.disposeData(d.dataId),e.disposeData(l.dataId),f}return d}function fGe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{axis:i,exclusive:s,reverse:a}=r;return eN(bv.Prod,o,e,i,s,a)}var Iae={kernelName:Lp,backendName:"webgpu",kernelFunc:fGe};function hGe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{axis:i,exclusive:s,reverse:a}=r;return eN(bv.Sum,o,e,i,s,a)}var Eae={kernelName:Mc,backendName:"webgpu",kernelFunc:hGe};function mGe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,weights:i}=t,{size:s,binaryOutput:a}=r,l=o.shape.length===1,u=b.sizeFromShape(i.shape)>0,d=i.dtype,p=l?[o.shape[0]]:[o.shape[0],o.shape[1]],f=l?[s]:[o.shape[0],s],h=dr({backend:e,attrs:{shape:f,value:0,dtype:d}}),m=new xv(p,u,a),g=[{type:"int32",data:[s]}],y=u?[o,i]:[o];return e.runWebGPUProgram(m,y,d,g,h)}var Tae={kernelName:Vp,backendName:"webgpu",kernelFunc:mGe};var tN=class{constructor(t,e){this.variableNames=["x"],this.workgroupSize=[64,1,1],this.size=!0,this.uniforms="blockSize : i32,",this.outputShape=t,this.dispatchLayout=xe(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey=`depthToSpace_${e}`,this.dataFormat=e}getUserCode(){return`
      ${de("index")} {
        if (index < uniforms.size) {
          let coords = getCoordsFromIndex(index);
          let b = coords[0];
          let h = ${this.getHeightCoordString()};
          let w = ${this.getWidthCoordString()};
          let d = ${this.getDepthCoordString()};

          let in_h = h / uniforms.blockSize;
          let offset_h = h % uniforms.blockSize;
          let in_w = w / uniforms.blockSize;
          let offset_w = w % uniforms.blockSize;
          let offset_d = (offset_h * uniforms.blockSize + offset_w) *
            ${this.getOutputDepthSize()};
          let in_d = d + offset_d;

          let rlt = ${this.getInputSamplingString()};
          setOutputAtIndex(index, rlt);
        }
      }`}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?"uniforms.outShape[3]":"uniforms.outShape[1]"}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}};function gGe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{blockSize:i,dataFormat:s}=r,a=o.shape[0],l=s==="NHWC"?o.shape[1]:o.shape[2],c=s==="NHWC"?o.shape[2]:o.shape[3],u=s==="NHWC"?o.shape[3]:o.shape[1],d=l*i,p=c*i,f=u/(i*i),h=s==="NHWC"?[a,d,p,f]:[a,f,d,p],m=[{type:"int32",data:[i]}],g=new tN(h,s);return e.runWebGPUProgram(g,[o],o.dtype,m)}var Dae={kernelName:Bp,backendName:"webgpu",kernelFunc:gGe};var nN=class{constructor(t,e,r,o=!1,i=null,s=!1){this.variableNames=["x","W"],this.uniforms="pads : vec2<i32>, inDims : vec2<i32>,",this.workgroupSize=[16,16,1],this.outputShape=t,this.dispatchLayout={x:[3],y:[2],z:[0,1]},this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),o&&this.variableNames.push("bias"),s&&this.variableNames.push("preluActivationWeights"),this.addBias=o,this.activation=i,this.hasPreluActivation=s,this.filterHeight=e,this.filterWidth=r,this.shaderKey=`depthwiseNCHW_${this.activation}_${this.filterHeight}_${this.filterWidth}`}getUserCode(){let t=this.filterWidth*this.filterHeight,e=this.workgroupSize[0]*this.workgroupSize[1]*this.workgroupSize[2],r=this.workgroupSize[1]+this.filterHeight-1,o=this.workgroupSize[0]+this.filterWidth-1;return`
      ${To(this.activation,this.hasPreluActivation,!1,4)}

      var<workgroup> mm_Asub : array<array<f32, ${o}>, ${r}>;
      var<workgroup> mm_Bsub : array<array<f32, ${this.filterWidth}>, ${this.filterHeight}>;
      fn readX(batch : i32, channel : i32, row : i32, col : i32) -> f32 {
        var value = 0.0;
        if (row >=0 && row < uniforms.inDims[0] && col >=0 && col < uniforms.inDims[1])
        {
          value = getX(batch, channel, row, col);
        }
        return value;
      }

      ${de()} {
        let coords = getOutputCoords();
        let batch = coords[0];
        let xRCCorner = vec2<i32>(coords.zw) - uniforms.pads;
        let channelMul = uniforms.wShape[3];
        let d1 = coords[1] / channelMul;
        let q = coords[1] % channelMul;

        let inputRowStart = xRCCorner.x;
        let inputColStart = xRCCorner.y;

        let localRow = i32(localId.y);
        let localCol = i32(localId.x);

        // Load one tile of X into local memory.
        for (var inputRow = localRow; inputRow < ${r}; inputRow = inputRow + ${this.workgroupSize[1]}) {
          for (var inputCol = localCol; inputCol < ${o}; inputCol = inputCol + ${this.workgroupSize[0]}) {
            let rowOffset = inputRow - localRow;
            let colOffset = inputCol - localCol;
            mm_Asub[inputRow][inputCol] = readX(batch, d1, inputRowStart + rowOffset, inputColStart + colOffset);
          }
        }

        // Load one tile of W into local memory.
        var wIndex = i32(localIndex);
        ${t<e?`if (wIndex < ${t})`:`for(; wIndex < ${t}; wIndex = wIndex + ${e})`}

        {
          let wRow = wIndex / ${this.filterWidth};
          let wCol = wIndex % ${this.filterWidth};
          mm_Bsub[wRow][wCol] = getW(wRow, wCol, d1, q);
        }

        workgroupBarrier();

        var value = 0.0;
        for (var wR = 0; wR < ${this.filterHeight}; wR = wR + 1) {
          for (var wC = 0; wC < ${this.filterWidth}; wC = wC + 1) {
            let xVal = mm_Asub[localRow + wR][localCol + wC];
            let wVal = mm_Bsub[wR][wC];
            value = fma(xVal, wVal, value);
          }
        }
        ${ts(this.addBias,this.activation)}
        if (coordsInBounds4D(coords, uniforms.outShape)) {
          setOutputAtCoords(coords[0], coords[1], coords[2], coords[3], value);
        }
      }
    `}};var wv=class{constructor(t,e=!1,r=null,o=!1){this.variableNames=["x","W"],this.uniforms="pads : vec2<i32>, inDims : vec2<i32>, virtualWidth : i32,",this.workgroupSize=[64,1,1],this.workPerThread=4,this.outputComponent=4,this.outputShape=t.outShape,this.virtualWidth=Math.ceil(this.outputShape[2]/this.workPerThread)*this.workPerThread;let i=[this.outputShape[0],this.outputShape[1],this.virtualWidth,this.outputShape[3]];this.dispatchLayout=xe(i),this.dispatch=pe(this.dispatchLayout,i,this.workgroupSize,[this.outputComponent*this.workPerThread,1,1]),b.assert(t.dataFormat==="channelsLast",()=>"TODO: NCHW is unimplemented"),e&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),this.convInfo=t,this.addBias=e,this.activation=r,this.hasPreluActivation=o,this.shaderKey=`depthwiseVec4_${r}_${this.convInfo.filterHeight}_${this.convInfo.filterWidth}_${this.convInfo.strideHeight}_${this.convInfo.strideWidth}_${this.workPerThread}`}getUserCode(){let t=(this.workPerThread-1)*this.convInfo.strideWidth+this.convInfo.filterWidth,e=this.convInfo.strideHeight,r=this.convInfo.strideWidth;return`
      ${To(this.activation,this.hasPreluActivation,!0,4)}
      fn readX(batch : i32, row : i32, col : i32, channel : i32) -> vec4<f32> {
        var value = vec4<f32>(0.0);
        if (col >=0 && col < uniforms.inDims[1]) {
          value = getX(batch, row, col, channel);
        }
        return value;
      }

      ${de("index")} {
        let width0 = uniforms.outShape[3] / ${this.outputComponent};
        let d1 = (index % width0) * ${this.outputComponent};
        var index1 = index / width0;
        let width1 = uniforms.virtualWidth / ${this.workPerThread};
        let c = (index1 % width1) * ${this.workPerThread};
        index1 = index1 / width1;
        let r = index1 % uniforms.outShape[1];
        let batch = index1 / uniforms.outShape[1];

        let xRCCorner = vec2<i32>(r, c) * vec2<i32>(${e}, ${r}) - uniforms.pads;

        let xRCorner = xRCCorner.x;
        let xCCorner = xRCCorner.y;
        var xVals : array<vec4<f32>, ${t}>;
        var dotProd : array<vec4<f32>, ${this.workPerThread}>;
        for (var i = 0; i < ${this.workPerThread}; i++) {
          dotProd[i] = vec4<f32>(0.0);
        }

        // Use constant instead of uniform can give better performance.
        for (var wR = 0; wR < ${this.convInfo.filterHeight}; wR = wR + 1) {
          let xR = xRCorner + wR;
          if (xR >=0 && xR < uniforms.inDims[0]) {
            for (var i = 0; i < ${t}; i++) {
              xVals[i] = readX(batch, xR, xCCorner + i, d1);
            }
            for (var wC = 0; wC < ${this.convInfo.filterWidth}; wC = wC + 1) {
              let wValue = getW(wR, wC, d1, 0);
              for (var i = 0; i < ${this.workPerThread}; i++) {
                dotProd[i] = fma(xVals[i * ${r} + wC], wValue, dotProd[i]);
              }
            }
          }
        }

        for (var i = 0; i < ${this.workPerThread}; i = i + 1) {
          let coords = vec4<i32>(batch, r, c + i, d1);
          if (coordsInBounds4D(coords, uniforms.outShape)) {
            var value = dotProd[i];
            ${ts(this.addBias,this.activation)}
            setOutputAtCoords(coords[0], coords[1], coords[2], coords[3], value);
          }
        }
      }
    `}};var Cv=class{constructor(t,e=!1,r=null,o=!1){this.variableNames=["x","W"],this.uniforms=`pads : vec2<i32>, inDims : vec2<i32>, filterHeight : i32,
      filterWidth : i32, strides : vec2<i32>, dilations : vec2<i32>,`,this.workgroupSize=[256,1,1],this.size=!0,this.outputShape=t.outShape,this.dispatchLayout=xe(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.isChannelsLast=t.dataFormat==="channelsLast",e&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),this.convInfo=t,this.addBias=e,this.activation=r,this.hasPreluActivation=o,this.shaderKey=`depthwise_${this.activation}_${this.isChannelsLast}`}getUserCode(){let t=this.isChannelsLast?"getX(batch, xR, xC, d1);":"getX(batch, d1, xR, xC);";return`
      ${To(this.activation,this.hasPreluActivation,!1,4)}

      ${de("index")} {
        if (index < uniforms.size) {
          let coords = getOutputCoords();
          let batch = coords[0];
          let xRCCorner = vec2<i32>(coords.${this.isChannelsLast?"yz":"zw"}) * uniforms.strides - uniforms.pads;
          let d2 = coords[${this.isChannelsLast?3:1}];
          let channelMul = uniforms.wShape[3];
          let d1 = d2 / channelMul;
          let q = d2 % channelMul;

          let inputRowStart = xRCCorner.x;
          let inputColStart = xRCCorner.y;
          let inputRowEnd = inputRowStart + uniforms.filterHeight *
              uniforms.dilations[0];
          let inputColEnd = inputColStart + uniforms.filterWidth *
              uniforms.dilations[1];

          // Convolve x(?, ?, d1)|x(d1, ?, ?) with w(:, :, d1, q) to get
          // y(yR, yC, d2)|y(d2, yR, yC). ? = to be determined. : = across all
          // values in that axis. x(?, ?, d1) and y(yR, yC, d2) is for NHWC.
          // x(d1, ?, ?) and y(d2, yR, yC) is for NCHW.
          var value = 0.0;

          // Extract if checking out of for loop for performance.
          if (inputRowStart >= 0 && inputColStart >= 0 &&
            inputRowEnd < uniforms.inDims[0] &&
                inputColEnd < uniforms.inDims[1]) {
              for (var wR = 0; wR < uniforms.filterHeight; wR = wR + 1) {
                let xR = inputRowStart + wR * uniforms.dilations[0];

                for (var wC = 0; wC < uniforms.filterWidth; wC = wC + 1) {
                  let xC = inputColStart + wC * uniforms.dilations[1];

                  let xVal = ${t};
                  let wVal = getW(wR, wC, d1, q);
                  value = value + xVal * wVal;
                }
              }
            } else {
              for (var wR = 0; wR < uniforms.filterHeight; wR = wR + 1) {
                let xR = inputRowStart + wR * uniforms.dilations[0];

                if (xR < 0 || xR >= uniforms.inDims[0]) {
                  continue;
                }

                for (var wC = 0; wC < uniforms.filterWidth; wC = wC + 1) {
                  let xC = inputColStart + wC * uniforms.dilations[1];

                  if (xC < 0 || xC >= uniforms.inDims[1]) {
                    continue;
                  }

                  let xVal = ${t};
                  let wVal = getW(wR, wC, d1, q);
                  value = value + xVal * wVal;
                }
              }
            }
            ${ts(this.addBias,this.activation)}
          setOutputAtCoords(coords[0], coords[1], coords[2], coords[3], value);
        }
      }
    `}};function yGe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,filter:i}=t,{strides:s,pad:a,dataFormat:l,dilations:c,dimRoundingMode:u}=r,d=T.convertConv2DDataFormat(l),p=c;p==null&&(p=[1,1]);let f=T.computeConv2DInfo(o.shape,i.shape,s,p,a,u,!0,d),h=[{type:"int32",data:[f.padInfo.top,f.padInfo.left]},{type:"int32",data:[f.inHeight,f.inWidth]}],m=f.dataFormat==="channelsLast",g;return!m&&f.inHeight>16&&f.inWidth>16&&f.strideHeight===1&&f.strideWidth===1&&f.dilationWidth===1&&f.dilationHeight===1&&f.inChannels===f.outChannels?g=new nN(f.outShape,f.filterHeight,f.filterWidth):m&&f.outHeight>4&&f.outWidth>4&&f.strideWidth<=2&&f.inChannels===f.outChannels&&f.dilationHeight===1&&f.dilationWidth===1&&f.inChannels%4===0?(g=new wv(f),h.push({type:"int32",data:[g.virtualWidth]})):(g=new Cv(f),h.push({type:"int32",data:[f.filterHeight]},{type:"int32",data:[f.filterWidth]},{type:"int32",data:[f.strideHeight,f.strideWidth]},{type:"int32",data:[f.dilationHeight,f.dilationWidth]})),e.runWebGPUProgram(g,[o,i],o.dtype,h)}var kae={kernelName:Pc,backendName:"webgpu",kernelFunc:yGe};var rN=class{constructor(t){this.variableNames=["x","dy"],this.uniforms=`strides : vec2<i32>, pads : vec2<i32>, filterDims : vec2<i32>, outHeight : i32,
      outWidth : i32, inHeight : i32, inWidth : i32, batchSize : i32, channelMul : i32,`,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=t.filterShape,this.dispatchLayout=xe(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="depthwise_conv2d_backprop_filter"}getUserCode(){return`
      ${de("index")} {
      if (index < uniforms.size) {
        let coords = getCoordsFromIndex(index);
        let wR = coords[0];
        let wC = coords[1];
        let d1 = coords[2];
        let dm = coords[3];
        let d2 = d1 * uniforms.channelMul + dm;

        var dotProd = 0.0;
        for (var b = 0; b < uniforms.batchSize; b++) {
          for (var yR = 0; yR < uniforms.outHeight; yR++) {
            let xR = wR + yR * uniforms.strides[0] - uniforms.pads[0];

            if (xR < 0 || xR >= uniforms.inHeight) {
              continue;
            }

            for (var yC = 0; yC < uniforms.outWidth; yC++) {
              let xC = wC + yC * uniforms.strides[1] - uniforms.pads[1];

              if (xC < 0 || xC >= uniforms.inWidth) {
                continue;
              }

              let dyValue = getDy(b, yR, yC, d2);
              let xValue = getX(b, xR, xC, d1);
              dotProd += xValue * dyValue;
            }
          }
        }
        setOutputAtIndex(index, dotProd);
      }
    }
    `}},oN=class{constructor(t){this.variableNames=["dy","W"],this.uniforms=`strides : vec2<i32>, pads : vec2<i32>, filterDims : vec2<i32>,
       outHeight : i32, outWidth : i32, channelMul : i32,`,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=t.inShape,this.dispatchLayout=xe(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="depthwise_conv2d_backprop_input"}getUserCode(){return`
      ${de("index")} {
      if (index < uniforms.size) {
        let coords = getCoordsFromIndex(index);
        let batch = coords[0];
        let d1 = coords[3];
        let dyCorner = coords.yz - uniforms.pads;
        let dyRCorner = dyCorner.x;
        let dyCCorner = dyCorner.y;

        var dotProd = 0.0;
        for (var wR = 0; wR < uniforms.filterDims[0]; wR++) {
          let dyR = f32(dyRCorner + wR) / f32(uniforms.strides[0]);

          if (dyR < 0.0 || dyR >= f32(uniforms.outHeight) || fract(dyR) > 0.0) {
            continue;
          }

          let idyR = i32(dyR);
          let wRPerm = uniforms.filterDims[0] - 1 - wR;

          for (var wC = 0; wC < uniforms.filterDims[1]; wC++) {
            let dyC = f32(dyCCorner + wC) / f32(uniforms.strides[1]);

            if (dyC < 0.0 || dyC >= f32(uniforms.outWidth) || fract(dyC) > 0.0) {
              continue;
            }

            let idyC = i32(dyC);
            let wCPerm = uniforms.filterDims[1] - 1 - wC;

            for (var dm = 0; dm < uniforms.channelMul; dm++) {
              let d2 = d1 * uniforms.channelMul + dm;
              let xValue = getDy(batch, idyR, idyC, d2);
              let wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutputAtIndex(index, dotProd);
      }
    }
    `}};function xGe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,dy:i}=t,{strides:s,dilations:a,pad:l,dimRoundingMode:c,filterShape:u}=r,d=T.computeConv2DInfo(o.shape,u,s,a,l,c,!0),p=new rN(d),f=[{type:"int32",data:[d.strideHeight,d.strideWidth]},{type:"int32",data:[d.padInfo.top,d.padInfo.left]},{type:"int32",data:[d.filterHeight,d.filterWidth]},{type:"int32",data:[d.outHeight]},{type:"int32",data:[d.outWidth]},{type:"int32",data:[d.inHeight]},{type:"int32",data:[d.inWidth]},{type:"int32",data:[d.batchSize]},{type:"int32",data:[d.outChannels/d.inChannels]}];return e.runWebGPUProgram(p,[o,i],"float32",f)}var Nae={kernelName:zp,backendName:"webgpu",kernelFunc:xGe};function vGe(n){let{inputs:t,backend:e,attrs:r}=n,{dy:o,filter:i}=t,{strides:s,dilations:a,pad:l,dimRoundingMode:c,inputShape:u}=r,d=T.computeConv2DInfo(u,i.shape,s,a,l,c,!0),p=new oN(d),f=[{type:"int32",data:[d.strideHeight,d.strideWidth]},{type:"int32",data:[d.filterHeight-1-d.padInfo.top,d.filterWidth-1-d.padInfo.left]},{type:"int32",data:[d.filterHeight,d.filterWidth]},{type:"int32",data:[d.outHeight]},{type:"int32",data:[d.outWidth]},{type:"int32",data:[d.outChannels/d.inChannels]}];return e.runWebGPUProgram(p,[o,i],o.dtype,f)}var Aae={kernelName:Up,backendName:"webgpu",kernelFunc:vGe};var iN=class{constructor(t){this.variableNames=["x"],this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=[t,t],this.dispatchLayout=xe(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="diag"}getUserCode(){return`
      ${de("index")} {
        if (index < uniforms.size) {
          let coords = getOutputCoords();
          let value = select(0.0, getX(coords[0]), coords[0] == coords[1]);
          setOutputAtIndex(index, value);
        }
      }
    `}};function bGe(n){let{inputs:t,backend:e}=n,{x:r}=t,o=[...r.shape,...r.shape],i=b.sizeFromShape(r.shape),s=$e({inputs:{x:r},backend:e,attrs:{shape:[i]}}),a=new iN(i),l=e.runWebGPUProgram(a,[s],s.dtype),c=$e({inputs:{x:l},backend:e,attrs:{shape:o}});return e.disposeData(s.dataId),e.disposeData(l.dataId),c}var Rae={kernelName:Wp,backendName:"webgpu",kernelFunc:bGe};var sN=class{constructor(t){this.variableNames=["x","w"],this.uniforms="filterDims: vec2<i32>, pads: vec2<i32>, strides: vec2<i32>, dilations: vec2<i32>",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=t.outShape,this.dispatchLayout=xe(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="dilation2d"}getUserCode(){return`
       ${de("index")} {
         if (index < uniforms.size) {
           let neg_infinity = -3.4e38;
           let coords = getOutputCoords();
           let batch = coords.x;
           let d1 = coords.w;
           let outTopLeftCorner = coords.yz * uniforms.strides - uniforms.pads;
           let hBeg = outTopLeftCorner.x;
           let wBeg = outTopLeftCorner.y;

           var curVal = neg_infinity;
           for (var h = 0; h < uniforms.filterDims[0]; h = h + 1) {
             let hIn = hBeg + h * uniforms.dilations[0];

             if (hIn >= 0 && hIn < uniforms.xShape[1]) {
               for (var w = 0; w < uniforms.filterDims[1]; w = w + 1) {
                 let wIn = wBeg + w * uniforms.dilations[1];

                 if (wIn >= 0 && wIn < uniforms.xShape[2]) {
                   let val = getX(batch, hIn, wIn, d1) + getW(h, w, d1);
                   if (val > curVal) {
                     curVal = val;
                   }
                 }
               }
             }
           }

           setOutputAtIndex(index, curVal);
         }
       }
     `}};function wGe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,filter:i}=t,{strides:s,pad:a,dilations:l}=r,c=T.computeDilation2DInfo(o.shape,i.shape,s,a,"NHWC",l),u=[c.padInfo.top,c.padInfo.left],d=[{type:"int32",data:[c.filterHeight,c.filterWidth]},{type:"int32",data:[...u]},{type:"int32",data:[c.strideHeight,c.strideWidth]},{type:"int32",data:[c.dilationHeight,c.dilationWidth]}],p=new sN(c);return e.runWebGPUProgram(p,[o,i],o.dtype,d)}var Oae={kernelName:Fc,backendName:"webgpu",kernelFunc:wGe};var aN=class{constructor(t,e){if(this.variableNames=["x","w","dy"],this.uniforms="filterDims: vec2<i32>, pads: vec2<i32>, strides: vec2<i32>, dilations: vec2<i32>, dySize: i32,",this.workgroupSize=[64,1,1],this.atomic=!0,this.outputShape=t.inShape,this.dispatchLayout=xe(t.outShape),this.dispatch=pe(this.dispatchLayout,t.outShape,this.workgroupSize),e!=="float32"&&e!=="int32")throw new Error(`Dilation2DBackpropInput only supports float32 and int32
          types, does not support ${e} type.`);this.type=e,this.shaderKey="dilation2DBackpropInput"}getUserCode(){return`
       ${de("index")} {
         if (index < uniforms.dySize) {
           let coords = getDyCoordsFromIndex(index);
           let b = coords[0];
           let r = coords[1];
           let c = coords[2];
           let d = coords[3];

           let dyCorner = vec2<i32>(r, c) * uniforms.strides - uniforms.pads;
           var curVal = -3.4e38;  // neg_infinity
           var xRMax = 0;
           var xCMax = 0;

           // In the case of multiple argmax branches, we only back-propagate
           // along the last branch, i.e., the one with largest value of
           // 'wR * uniforms.filterDims[1] + wC', similarly to the max-pooling
           // backward routines.
           for (var wR = 0; wR < uniforms.filterDims[0]; wR++) {
             let xR = dyCorner.x + wR * uniforms.dilations[0];

             if (xR >= 0 && xR < uniforms.xShape[1]) {
               for (var wC = 0; wC < uniforms.filterDims[1]; wC++) {
                 let xC = dyCorner.y + wC * uniforms.dilations[1];

                 if (xC >= 0 && xC < uniforms.xShape[2]) {
                   let val = getX(b, xR, xC, d) + getW(wR, wC, d);
                   if (val > curVal) {
                     curVal = val;
                     xRMax = xR;
                     xCMax = xC;
                   }
                 }
               }
             }
           }

           let flatIndexIn = d + uniforms.xShape[3] *
               (xCMax + uniforms.xShape[2] * (xRMax + uniforms.xShape[1] * b));
           let value = getDy(b, r, c, d);
           ${es("&result[flatIndexIn]","value",this.type)}
         }
       }
     `}},lN=class{constructor(t,e,r){if(this.variableNames=["x","w","dy"],this.uniforms="filterDims: vec2<i32>, pads: vec2<i32>, strides: vec2<i32>, dilations: vec2<i32>, dySize: i32,",this.workgroupSize=[64,1,1],this.atomic=!0,this.outputShape=t.filterShape,this.dispatchLayout=xe(t.outShape),this.dispatch=pe(this.dispatchLayout,t.outShape,this.workgroupSize),r!=="float32"&&r!=="int32")throw new Error(`Dilation2DBackpropFilter only supports float32 and int32
          types, does not support ${r} type.`);this.type=r,this.shaderKey="dilation2DBackpropFilter"}getUserCode(){return`
       ${de("index")} {
         if (index < uniforms.dySize) {
           let coords = getDyCoordsFromIndex(index);
           let b = coords[0];
           let r = coords[1];
           let c = coords[2];
           let d = coords[3];

           let dyCorner = vec2<i32>(r, c) * uniforms.strides - uniforms.pads;
           var curVal = -3.4e38;  // neg_infinity
           var wRMax = 0;
           var wCMax = 0;

           // In the case of multiple argmax branches, we only back-propagate
           // along the last branch, i.e., the one with largest value of
           // 'wR * uniforms.filterDims[1] + wC', similarly to the max-pooling
           // backward routines.
           for (var wR = 0; wR < uniforms.filterDims[0]; wR++) {
             let xR = dyCorner.x + wR * uniforms.dilations[0];

             if (xR >= 0 && xR < uniforms.xShape[1]) {
               for (var wC = 0; wC < uniforms.filterDims[1]; wC++) {
                 let xC = dyCorner.y + wC * uniforms.dilations[1];

                 if (xC >= 0 && xC < uniforms.xShape[2]) {
                   let val = getX(b, xR, xC, d) + getW(wR, wC, d);
                   if (val > curVal) {
                     curVal = val;
                     wRMax = wR;
                     wCMax = wC;
                   }
                 }
               }
             }
           }

           let flatIndexIn = d + uniforms.wShape[2] * (wCMax + wRMax * uniforms.wShape[1]);
           let value = getDy(b, r, c, d);
           ${es("&result[flatIndexIn]","value",this.type)}
         }
       }
     `}};function CGe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,filter:i,dy:s}=t,{strides:a,pad:l,dilations:c}=r,u=T.computeDilation2DInfo(o.shape,i.shape,a,l,"NHWC",c),d=i.dtype,p=new lN(u,i.shape,d),f=[{type:"int32",data:[u.filterHeight,u.filterWidth]},{type:"int32",data:[u.padInfo.top,u.padInfo.left]},{type:"int32",data:[u.strideHeight,u.strideWidth]},{type:"int32",data:[u.dilationHeight,u.dilationWidth]},{type:"int32",data:[b.sizeFromShape(u.outShape)]}],h=dr({backend:e,attrs:{shape:i.shape,value:0,dtype:d}});return e.runWebGPUProgram(p,[o,i,s],d,f,h)}var Mae={kernelName:Yh,backendName:"webgpu",kernelFunc:CGe};function _Ge(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,filter:i,dy:s}=t,{strides:a,pad:l,dilations:c}=r,u=T.computeDilation2DInfo(o.shape,i.shape,a,l,"NHWC",c),d=o.dtype,p=new aN(u,d),f=[{type:"int32",data:[u.filterHeight,u.filterWidth]},{type:"int32",data:[u.padInfo.top,u.padInfo.left]},{type:"int32",data:[u.strideHeight,u.strideWidth]},{type:"int32",data:[u.dilationHeight,u.dilationWidth]},{type:"int32",data:[b.sizeFromShape(u.outShape)]}],h=dr({backend:e,attrs:{shape:u.inShape,value:0,dtype:d}});return e.runWebGPUProgram(p,[o,i,s],d,f,h)}var Pae={kernelName:Xh,backendName:"webgpu",kernelFunc:_Ge};var cN=class{constructor(t,e,r){this.variableNames=["Image"],this.uniforms="alpha: f32,",this.workgroupSize=[64,1,1],this.pixelsOpType=sh.DRAW,this.size=!0,this.outputShape=t,this.dispatchLayout=xe(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.type=e,this.textureFormat=r,this.shaderKey=`draw_${e}_${r}`}getUserCode(){let t,e=this.type==="float32"?"value":"value / 255.0";return t=`
      if (uniforms.numChannels == 1) {
        rgba[0] = ${e};
        rgba[1] = ${e};
        rgba[2] = ${e};
      } else {
        rgba[d] = ${e};
      }`,`
       @group(0) @binding(0) var outImage : texture_storage_2d<${this.textureFormat}, write>;
       ${de("index")} {
         if (index < uniforms.size) {
           var rgba = vec4<f32>(0.0, 0.0, 0.0, uniforms.alpha);
           for (var d = 0; d < uniforms.numChannels; d = d + 1) {
             let value = f32(inBuf[index * uniforms.numChannels + d]);
             ${t}
           }
           rgba.x = rgba.x * rgba.w;
           rgba.y = rgba.y * rgba.w;
           rgba.z = rgba.z * rgba.w;
           let coords = getCoordsFromIndex(index);
           textureStore(outImage, vec2<i32>(coords.yx), rgba);
         }
       }
      `}};function SGe(n){let{inputs:t,backend:e,attrs:r}=n,{image:o}=t,{canvas:i,options:s}=r,[a,l]=o.shape.slice(0,2),{imageOptions:c}=s||{},u=c?.alpha||1,d=e.device.features.has("bgra8unorm-storage")?"bgra8unorm":"rgba8unorm",p=[a,l],f=new cN(p,o.dtype,d);i.width=l,i.height=a;let h="webgpu",m=i.getContext(h),g;m||(g=new OffscreenCanvas(l,a),m=g.getContext(h));let y=o.shape.length===3?o.shape[2]:1;m.configure({device:e.device,format:d,usage:GPUTextureUsage.STORAGE_BINDING,alphaMode:"premultiplied"});let v="int32",w=e.makeTensorInfo(p,v),C=e.tensorMap.get(w.dataId);C.resource=m.getCurrentTexture(),C.external=!0;let I=[{type:"uint32",data:[y]},{type:"float32",data:[u]}];if(e.runWebGPUProgram(f,[o],v,I,w),g){let A=i.getContext("2d");if(!A)throw new Error("Please make sure this canvas has only been used for 2d or webgpu context!");A.drawImage(g,0,0)}return e.disposeData(w.dataId),o}var Fae={kernelName:Zh,backendName:"webgpu",kernelFunc:SGe};var N3=rn({opType:Xe.MUL,cpuKernelImpl:yse,supportsComplex:!0}),Lae={kernelName:sl,backendName:"webgpu",kernelFunc:N3};function A3(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{axis:i,keepDims:s}=r;return rs(o,i,s,"sum",e)}var $ae={kernelName:au,backendName:"webgpu",kernelFunc:A3};function IGe(n){let{inputs:t,backend:e,attrs:r}=n,{equation:o}=r,i=t,{allDims:s,summedDims:a,idDims:l}=T.decodeEinsumEquation(o,i.length);T.checkEinsumDimSizes(s.length,l,i);let{path:c,steps:u}=T.getEinsumComputePath(a,l),d=u.length,p=null,f=s.length,h=[];for(let m=0;m<d;++m){for(let g of u[m]){let{permutationIndices:y,expandDims:v}=T.getEinsumPermutation(f,l[g]),w;T.isIdentityPermutation(y)?w=i[g]:(w=Bo({inputs:{x:i[g]},backend:e,attrs:{perm:y}}),h.push(w));let C=w.shape.slice();for(let I=0;I<v.length;++I)C.splice(v[I],0,1);b.arraysEqual(w.shape,C)||(w=$e({inputs:{x:w},backend:e,attrs:{shape:C}}),h.push(w)),p===null?p=w:(p=N3({inputs:{a:w,b:p},backend:e}),h.push(p))}m<d-1&&(c[m]>=0&&(p=A3({inputs:{x:p},backend:e,attrs:{axis:c[m]-(s.length-f),keepDims:!1}}),h.push(p)),f--)}for(let m of h)m!==p&&e.disposeData(m.dataId);return p}var Vae={kernelName:Gp,backendName:"webgpu",kernelFunc:IGe};var EGe=Qe({opType:Ce.ELU}),Bae={kernelName:ja,backendName:"webgpu",kernelFunc:EGe};var TGe=n=>{let{inputs:t,backend:e}=n,{dy:r,y:o}=t,i=new Jd(Xe.ELU_DER,r.shape,o.shape);return e.runWebGPUProgram(i,[r,o],r.dtype)},zae={kernelName:jp,backendName:"webgpu",kernelFunc:TGe};var DGe=rn({opType:Xe.EQUAL,dtype:"bool",cpuKernelImpl:nse}),Uae={kernelName:yd,backendName:"webgpu",kernelFunc:DGe};var kGe=Qe({opType:Ce.ERF}),Wae={kernelName:Ha,backendName:"webgpu",kernelFunc:kGe};var NGe=Qe({opType:Ce.EXP,cpuKernelImpl:rse,dtype:"float32"}),Gae={kernelName:qa,backendName:"webgpu",kernelFunc:NGe};function uN(n){let{inputs:t,attrs:e,backend:r}=n,{dim:o}=e,{input:i}=t,s=i.shape.length,a=i.shape.slice(),l=o;return o<0&&(b.assert(-(s+1)<=o,()=>`Axis must be in the interval [${-(s+1)}, ${s}]`),l=s+o+1),a.splice(l,0,1),$e({inputs:{x:i},backend:r,attrs:{shape:a}})}var jae={kernelName:Lc,backendName:"webgpu",kernelFunc:uN};var AGe=Qe({opType:Ce.EXPM1,cpuKernelImpl:ose}),Hae={kernelName:Ka,backendName:"webgpu",kernelFunc:AGe};var Pw=class{constructor(t,e){this.variableNames=["real","imag"],this.outputShape=[],this.uniforms="exponentMultiplier : f32, denominator: f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=xe(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.component=t,this.shaderKey=`fft_${t}`}getUserCode(){return`
    fn unaryOpComplex(real: f32, expR: f32, imag: f32, expI: f32) -> f32 {
      ${this.component==="real"?"return real * expR - imag * expI;":"return real * expI + imag * expR;"}
    }

    fn mulMatDFT(batch: i32, index: i32) -> f32 {
      let indexRatio = f32(index) / f32(uniforms.realShape[1]);
      let exponentMultiplierTimesIndexRatio =
          uniforms.exponentMultiplier * indexRatio;

      var result = 0.0;

      for (var i = 0; i < uniforms.realShape[1]; i = i + 1) {
        // x = (-2|2 * PI / N) * index * i;
        let x = exponentMultiplierTimesIndexRatio * f32(i);
        let expR = cos(x);
        let expI = sin(x);
        let real = getReal(batch, i);
        let imag = getImag(batch, i);

        result = result +
            unaryOpComplex(real, expR, imag, expI) / uniforms.denominator;
      }

      return result;
    }

    ${de("index")} {
      if (index < uniforms.size) {
        let coords = getOutputCoords();
        setOutputAtIndex(index, mulMatDFT(coords[0], coords[1]));
      }
    }
  `}};function dN(n,t,e){let r=e.tensorMap.get(n.dataId),o=b.sizeFromShape(n.shape),i=n.shape[n.shape.length-1],s=o/i,a=[],l=$e({inputs:{x:n},backend:e,attrs:{shape:[s,i]}});a.push(l);let c=l.shape,u=new Pw("real",c),d=new Pw("imag",c),p=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:c},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:c}],f=t?2*Math.PI:-2*Math.PI,h=t?c[1]:1,m=[{type:"float32",data:[f]},{type:"float32",data:[h]}],g=e.runWebGPUProgram(u,p,"float32",m);a.push(g);let y=e.runWebGPUProgram(d,p,"float32",m);a.push(y);let v=ws({inputs:{real:g,imag:y},backend:e});a.push(v);let w=$e({inputs:{x:v},backend:e,attrs:{shape:n.shape}});return a.forEach(C=>e.disposeData(C.dataId)),w}function RGe(n){let{inputs:t,backend:e}=n,{input:r}=t;return dN(r,!1,e)}var qae={kernelName:Hp,backendName:"webgpu",kernelFunc:RGe};var pN=class{constructor(t){this.outputShape=[],this.variableNames=["x"],this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=t,this.dispatchLayout=xe(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="flipLeftRight"}getUserCode(){return`
      ${de("index")} {
        if (index < uniforms.size) {
          let coords = getCoordsFromIndex(index);
          let coordX = uniforms.xShape[2] - coords[2] - 1;
          let outputValue = getX(coords[0], coords[1], coordX, coords[3]);
          setOutputAtIndex(index, outputValue);
        }
      }
    `}};var Kae={kernelName:Kp,backendName:"webgpu",kernelFunc:({inputs:n,backend:t})=>{let{image:e}=n,r=t,o=new pN(e.shape);return r.runWebGPUProgram(o,[e],e.dtype)}};var OGe=Qe({opType:Ce.FLOOR,cpuKernelImpl:ise}),Xae={kernelName:Xa,backendName:"webgpu",kernelFunc:OGe};var MGe=rn({opType:Xe.FLOOR_DIV,cpuKernelImpl:sse,dtype:"int32"}),Yae={kernelName:Ya,backendName:"webgpu",kernelFunc:MGe};var fN=class{constructor(t,e,r=!1){this.pixelsOpType=sh.FROM_PIXELS,this.outputShape=[0],this.variableNames=[],this.workgroupSize=[256,1,1],this.outputShape=t,this.dispatchLayout=xe(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize,[e,1,1]),this.importVideo=r,this.shaderKey=`fromPixels_${this.importVideo}`}getUserCode(){let t=this.importVideo?"textureLoad(src, vec2<i32>(coords.yx));":"textureLoad(src, vec2<i32>(coords.yx), 0)";return`
      @binding(1) @group(0) var src: ${this.importVideo?"texture_external":"texture_2d<f32>"};
      ${de("index")} {
        let flatIndex = index * uniforms.numChannels;
        if (flatIndex < uniforms.size) {
          let coords = getCoordsFromIndex(flatIndex);
          let values = ${t};
          for (var i = 0; i < uniforms.numChannels; i = i + 1) {
            result[flatIndex + i] = i32(floor(255.0 * values[i]));
          }
        }
      }
  `}};var Zae={kernelName:Jh,backendName:"webgpu",kernelFunc:PGe},_v,R3=q().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function PGe(n){let{inputs:t,backend:e,attrs:r}=n,{pixels:o}=t,{numChannels:i}=r;if(o==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let s=typeof HTMLVideoElement<"u"&&o instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&o instanceof HTMLImageElement,l=typeof HTMLCanvasElement<"u"&&o instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&o instanceof OffscreenCanvas,c=typeof ImageBitmap<"u"&&o instanceof ImageBitmap,[u,d]=s?[o.videoWidth,o.videoHeight]:[o.width,o.height],p=[d,u,i],f=q().getBool("WEBGPU_IMPORT_EXTERNAL_TEXTURE")&&s,h=s||a;if(c||l||h){let v;if(f)v=e.device.importExternalTexture({source:o});else{if(h){let ee=q().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(_v==null||ee!==R3)&&(R3=ee,_v=document.createElement("canvas").getContext("2d",{willReadFrequently:R3})),_v.canvas.width=u,_v.canvas.height=d,_v.drawImage(o,0,0,u,d),o=_v.canvas}let W=GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING,te=e.textureManager.acquireTexture(p[1],p[0],"rgba8unorm",W);e.queue.copyExternalImageToTexture({source:o},{texture:te},[p[1],p[0]]),v=te}let w=b.sizeFromShape(p),C=b.computeStrides(p),I=new fN(p,i,f),A=[{type:"uint32",data:[w]},{type:"uint32",data:[i]},{type:"uint32",data:[...C]}],M=e.makeTensorInfo([d,u],"int32"),$=e.tensorMap.get(M.dataId);$.resource=v;let V=e.runWebGPUProgram(I,[M],"int32",A);return e.disposeData(M.dataId),V}let m=o.data,g=m;if(i!=null&&i!==4){g=new Uint8Array(o.width*o.height*i);let v=m.length,w=0;for(let C=0;C<v;C++)C%4<i&&(g[w++]=m[C])}let y=e.makeTensorInfo(p,"int32",new Int32Array(g));return e.uploadToGPU(y.dataId),y}var hN=class{constructor(t,e,r,o,i){this.uniforms="varianceEpsilon : f32,",this.workgroupSize=[128,1,1],this.size=!0,this.variableNames=["x","mean","variance"],T.assertAndGetBroadcastShape(t,e),T.assertAndGetBroadcastShape(t,r),this.outputShape=t,this.dispatchLayout=xe(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),o!=null&&(T.assertAndGetBroadcastShape(t,o),this.variableNames.push("offset")),i!=null&&(T.assertAndGetBroadcastShape(t,i),this.variableNames.push("scale")),this.offsetShape=o,this.scaleShape=i,this.shaderKey="batchNorm"}getUserCode(){let t="0.0";this.offsetShape!=null&&(t="getOffsetByOutputIndex(index)");let e="1.0";return this.scaleShape!=null&&(e="getScaleByOutputIndex(index)"),`
      ${de("index")} {
        if (index < uniforms.size)
        {
          let xValue = getXByOutputIndex(index);
          let meanValue = getMeanByOutputIndex(index);
          let varianValue = getVarianceByOutputIndex(index);
          let offsetValue = ${t};
          let scaleValue = ${e};
          let inv = scaleValue * inverseSqrt(varianValue + f32(uniforms.varianceEpsilon));
          setOutputAtIndex(index,dot(vec3<f32>(xValue, -meanValue, offsetValue), vec3<f32>(inv, inv, 1.0)));
        }
      }
  `}};var Qae={kernelName:$c,backendName:"webgpu",kernelFunc:({inputs:n,attrs:t,backend:e})=>{let{x:r,scale:o,offset:i,mean:s,variance:a}=n,{varianceEpsilon:l}=t,c=e,u=[r,s,a],d=null;i!=null&&(d=i.shape,u.push(i));let p=null;o!=null&&(p=o.shape,u.push(o));let f=new hN(r.shape,s.shape,a.shape,d,p),h=[{type:"float32",data:[l]}];return c.runWebGPUProgram(f,u,r.dtype,h)}};function FGe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,filter:i,bias:s,preluActivationWeights:a}=t,{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:p,activation:f,leakyreluAlpha:h}=r,m=T.convertConv2DDataFormat(u),g=T.computeConv2DInfo(o.shape,i.shape,l,d,c,p,!1,m);return Hk({x:o,filter:i,convInfo:g,backend:e,bias:s,preluActivationWeights:a,leakyreluAlpha:h,activation:f})}var Jae={kernelName:Ed,backendName:"webgpu",kernelFunc:FGe};function LGe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,filter:i,bias:s,preluActivationWeights:a}=t,{strides:l,pad:c,dilations:u,dimRoundingMode:d,activation:p,leakyreluAlpha:f}=r,h=u;h==null&&(h=[1,1]),b.assert(T.eitherStridesOrDilationsAreOne(l,h),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${l} and dilations '${h}'`);let m=T.computeConv2DInfo(o.shape,i.shape,l,h,c,d,!0),g=[o,i],y=s!=null,v=a!=null;y&&g.push(s),v&&g.push(a);let w=[{type:"int32",data:[m.padInfo.top,m.padInfo.left]},{type:"int32",data:[m.inHeight,m.inWidth]}],C;return m.outHeight>4&&m.outWidth>4&&m.strideWidth<=2&&m.inChannels===m.outChannels&&m.dilationHeight===1&&m.dilationWidth===1&&m.inChannels%4===0?(C=new wv(m,y,p,v),w.push({type:"int32",data:[C.virtualWidth]})):(C=new Cv(m,y,p,v),w.push({type:"int32",data:[m.filterHeight]},{type:"int32",data:[m.filterWidth]},{type:"int32",data:[m.strideHeight,m.strideWidth]},{type:"int32",data:[m.dilationHeight,m.dilationWidth]})),p==="leakyrelu"&&(w.push({type:"float32",data:[f]}),C.uniforms+=" alpha : f32,"),e.runWebGPUProgram(C,g,"float32",w)}var ele={kernelName:Td,backendName:"webgpu",kernelFunc:LGe};var mN=class{constructor(t,e){this.variableNames=["A","indices"],this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=xe(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey=`gathernd_${t}`,this.sliceDim=t,this.uniforms=`sliceDim : i32, strides : ${zn(t)},`}getUserCode(){let t;return this.sliceDim>1?t="uniforms.strides[j]":t="uniforms.strides",`
      ${de("index")} {
        if (index < uniforms.size) {
          let coords = getCoordsFromIndex(index);
          var flattenIndex = 0;
          for (var j = 0; j < uniforms.sliceDim; j = j + 1) {
            let indexTemp = i32(round(getIndices(coords[0], j)));
            let strideNum = ${t};
            flattenIndex = flattenIndex + indexTemp * strideNum;
          }

          setOutputAtIndex(index, getA(flattenIndex, coords[1]));
        }
      }
      `}};function $Ge(n){let{inputs:t,backend:e}=n,{params:r,indices:o}=t,i=o.shape,s=i[i.length-1],a=b.sizeFromShape(r.shape),[l,c,u,d]=T.prepareAndValidate(r,o),p=$e({inputs:{x:o},backend:e,attrs:{shape:[c,s]}}),f=$e({inputs:{x:r},backend:e,attrs:{shape:[b.sizeFromShape(r.shape)/u,u]}});if(e.shouldExecuteOnCPU([r,o])||r.dtype==="string"){let v=e.readSync(o.dataId),w=e.bufferSync(r),C=ase(v,w,r.dtype,c,s,u,d,r.shape,a);return e.makeTensorInfo(l,r.dtype,C.values)}let h=new mN(s,[c,u]),m=[{type:"int32",data:[s]},{type:"int32",data:d}],g=e.runWebGPUProgram(h,[f,p],f.dtype,m),y=$e({inputs:{x:g},backend:e,attrs:{shape:l}});return e.disposeData(p.dataId),e.disposeData(f.dataId),e.disposeData(g.dataId),y}var tle={kernelName:Xp,backendName:"webgpu",kernelFunc:$Ge};var gN=class{constructor(t,e){this.variableNames=["A","indices"],this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=t.slice(),this.aShape=t,this.outputShape=e,this.dispatchLayout=xe(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="gather"}getUserCode(){let t=VGe(this.aShape);return`
      ${de("index")} {
        if (index < uniforms.size) {
          let resRC = getCoordsFromIndex(index);
          let indexZ = i32(getIndices(resRC.x, resRC.z));
          let inBounds = select(0.0, 1.0, indexZ >= 0 && indexZ < uniforms.aShape[2]);
          setOutputAtIndex(index, inBounds * getA(${t}));
        }
      }
    `}};function VGe(n){let t=["resRC.x","resRC.y","resRC.z","resRC.w"],e=[];for(let r=0;r<n.length;r++)r===2?e.push("indexZ"):e.push(`${t[r]}`);return e.join()}function O3(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,indices:i}=t,{axis:s,batchDims:a}=r,l=b.parseAxisParam(s,o.shape)[0],c=T.segment_util.collectGatherOpShapeInfo(o,i,l,a),u=b.sizeFromShape(i.shape),d=[],p=$e({inputs:{x:o},backend:e,attrs:{shape:[c.batchSize,c.outerSize,c.dimSize,c.sliceSize]}}),f=$e({inputs:{x:i},backend:e,attrs:{shape:[c.batchSize,u/c.batchSize]}});d.push(p),d.push(f);let h=[c.batchSize,c.outerSize,u/c.batchSize,c.sliceSize];if(e.shouldExecuteOnCPU([o,i])){let w=e.tensorMap.get(f.dataId).values,C=ze(f.shape,f.dtype,w),A=e.tensorMap.get(p.dataId).values,M=ze(p.shape,p.dtype,A),$=lse(M,C,h);return d.forEach(V=>e.disposeData(V.dataId)),e.makeTensorInfo(c.outputShape,$.dtype,$.values)}let m=new gN(p.shape,h),g=e.runWebGPUProgram(m,[p,f],p.dtype);d.push(g);let y=$e({inputs:{x:g},backend:e,attrs:{shape:c.outputShape}});return d.forEach(v=>e.disposeData(v.dataId)),y}var nle={kernelName:Vc,backendName:"webgpu",kernelFunc:O3};var BGe=rn({opType:Xe.GREATER,cpuKernelImpl:use,dtype:"bool"}),rle={kernelName:xd,backendName:"webgpu",kernelFunc:BGe};var zGe=rn({opType:Xe.GREATER_EQUAL,dtype:"bool",cpuKernelImpl:cse}),ole={kernelName:Za,backendName:"webgpu",kernelFunc:zGe};function UGe(n){let{inputs:t,backend:e}=n,{input:r}=t;return dN(r,!0,e)}var ile={kernelName:Yp,backendName:"webgpu",kernelFunc:UGe};var WGe=Qe({opType:Ce.IS_FINITE,dtype:"bool"}),sle={kernelName:Qa,backendName:"webgpu",kernelFunc:WGe};var GGe=Qe({opType:Ce.IS_INF,dtype:"bool"}),ale={kernelName:Ja,backendName:"webgpu",kernelFunc:GGe};var jGe=Qe({opType:Ce.IS_NAN,dtype:"bool"}),lle={kernelName:el,backendName:"webgpu",kernelFunc:jGe};function HGe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{alpha:i}=r,s=[{type:"float32",data:[i]}],a=new ns(o.shape,Ce.LEAKYRELU,"alpha : f32,");return e.runWebGPUProgram(a,[o],"float32",s)}var cle={kernelName:Bc,backendName:"webgpu",kernelFunc:HGe};var qGe=rn({opType:Xe.LESS,dtype:"bool",cpuKernelImpl:pse}),ule={kernelName:vd,backendName:"webgpu",kernelFunc:qGe};var KGe=rn({opType:Xe.LESS_EQUAL,dtype:"bool",cpuKernelImpl:dse}),dle={kernelName:bd,backendName:"webgpu",kernelFunc:KGe};var yN=class{constructor(t){this.variableNames=[],this.outputShape=[],this.uniforms="start : f32, step : f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=[t],this.dispatchLayout=xe(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="linSpace"}getUserCode(){return`
      ${de("index")} {
        if (index < uniforms.size) {
          setOutputAtIndex(index, uniforms.start + f32(index) * uniforms.step);
        }
      }
    `}};function XGe(n){let{backend:t,attrs:e}=n,{start:r,stop:o,num:i}=e,s=(o-r)/(i-1),a=new yN(i),l=[{type:"float32",data:[r]},{type:"float32",data:[s]}];return t.runWebGPUProgram(a,[],"float32",l)}var ple={kernelName:Qp,backendName:"webgpu",kernelFunc:XGe};var YGe=Qe({opType:Ce.LOG,cpuKernelImpl:fse}),fle={kernelName:tl,backendName:"webgpu",kernelFunc:YGe};var ZGe=Qe({opType:Ce.LOG1P}),hle={kernelName:nl,backendName:"webgpu",kernelFunc:ZGe};var QGe=rn({opType:Xe.LOGICAL_AND,dtype:"bool"}),mle={kernelName:wd,backendName:"webgpu",kernelFunc:QGe};var JGe=Qe({opType:Ce.LOGICAL_NOT}),gle={kernelName:Cd,backendName:"webgpu",kernelFunc:JGe};var eje=rn({opType:Xe.LOGICAL_OR}),yle={kernelName:_d,backendName:"webgpu",kernelFunc:eje};var xle=`
  var powValue = 0.0;
  let basis = uniforms.bias + uniforms.alpha * sum;
  if (uniforms.beta == 0.5) {
    powValue = inverseSqrt(basis);
  } else if (uniforms.beta == 1.0) {
    powValue = 1.0 / basis;
  } else {
    powValue = exp(log(basis) * (-uniforms.beta));
  }
`,xN=class{constructor(t){this.outputShape=[],this.variableNames=["x"],this.uniforms="radius : i32, bias : f32, alpha : f32, beta : f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=t,this.dispatchLayout=xe(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="lrn"}getUserCode(){return`
    ${de("index")} {
      if (index < uniforms.size) {
        let coords = getOutputCoords();
        let b = coords[0];
        let r = coords[1];
        let c = coords[2];
        let d = coords[3];

        let x = getX(b, r, c, d);
        var sum = 0.0;
        for (var i = -uniforms.radius; i <= uniforms.radius; i = i + 1) {
          let idx = d + i;
          if (idx >= 0 && idx < uniforms.xShape[3]) {
            let z = getX(b, r, c, idx);
            sum = sum + z * z;
          }
        }
        ${xle}

        setOutputAtIndex(index, x * powValue);
      }
    }
  `}},vN=class{constructor(t,e){this.outputShape=[],this.variableNames=["x"],this.uniforms="radius : i32, bias : f32, alpha : f32, beta : f32,",this.workgroupSize=[256,1,1],this.maxAllowRadius=16,b.assert(e<=this.maxAllowRadius,()=>`Radius must be less than or equal to ${this.maxAllowRadius}, current radius is ${e}`),this.outputShape=t,this.elementsPerWorkgroup=this.workgroupSize[0]-2*this.maxAllowRadius,this.dispatchLayout={x:[3],y:[2],z:[0,1]},this.dispatch=pe(this.dispatchLayout,this.outputShape,[this.elementsPerWorkgroup,this.workgroupSize[1],this.workgroupSize[2]]),this.shaderKey="lrn_shared"}getUserCode(){return`
    var <workgroup>lrnSub: array<f32, ${this.workgroupSize[0]}>;
    const elementsPerWorkgroup = ${this.elementsPerWorkgroup};
    const maxAllowRadius = ${this.maxAllowRadius};

    ${de()} {
      let localDepth = i32(localId.x);
      let workgroupDepth = i32(workgroupId.x) * elementsPerWorkgroup;
      let xDepth = workgroupDepth + localDepth - maxAllowRadius;
      let b = i32(globalId.z) / uniforms.xShape[1];
      let r = i32(globalId.z) - b * uniforms.xShape[1];
      let c = i32(globalId.y);
      let d = workgroupDepth + localDepth;

      var x = 0.0;
      if (xDepth >= 0 && xDepth < uniforms.xShape[3]) {
        x = getX(b, r, c, xDepth);
      }
      lrnSub[localDepth] = x;
      workgroupBarrier();

      if (localDepth < elementsPerWorkgroup && d < uniforms.outShape[3]) {
        var sum = 0.0;
        let index = localDepth + maxAllowRadius;
        for (var i = -uniforms.radius; i <= uniforms.radius; i = i + 1) {
          let z = lrnSub[index + i];
          sum = sum + z * z;
        }
        ${xle}

        setOutputAtCoords(b, r, c, d, lrnSub[index] * powValue);
      }
    } `}};function tje(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{depthRadius:i,bias:s,alpha:a,beta:l}=r,c;i>16?c=new xN(o.shape):c=new vN(o.shape,i);let u=[{type:"int32",data:[i]},{type:"float32",data:[s]},{type:"float32",data:[a]},{type:"float32",data:[l]}];return e.runWebGPUProgram(c,[o],o.dtype,u)}var vle={kernelName:zc,backendName:"webgpu",kernelFunc:tje};var bN=class{constructor(t){this.outputShape=[],this.variableNames=["inputImage","outputImage","dy"],this.uniforms="depthRadius : i32, bias : f32, alpha : f32, beta : f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=t,this.dispatchLayout=xe(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="lrn_grad"}getUserCode(){return`
    ${de("index")} {
      if (index < uniforms.size) {
        let coords = getOutputCoords();
        let b = coords[0];
        let r = coords[1];
        let c = coords[2];

        let MIN_DEPTH_BEGIN = 0;
        let MAX_DEPTH_END = uniforms.outShape[3];
        var result = 0.0;
        for (var d = MIN_DEPTH_BEGIN; d < MAX_DEPTH_END; d++) {
          let depthBegin = max(MIN_DEPTH_BEGIN, d - uniforms.depthRadius);
          let depthEnd = min(MAX_DEPTH_END, d + uniforms.depthRadius + 1);

          var norm = 0.0;
          for (var k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; k++) {
            if (k < depthBegin) {
              continue;
            } else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            } else {
              break;
            }
          }

          norm = uniforms.alpha * norm + uniforms.bias;

          for (var k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; k++) {
            if (k < depthBegin) {
              continue;
            } else if (k >= depthBegin && k < depthEnd) {
              var dyi = -2.0 * uniforms.alpha * uniforms.beta
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d) / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * uniforms.beta);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            } else {
              break;
            }
          }
        }

        setOutputAtIndex(index, result);
      }
    }
  `}};function nje(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,y:i,dy:s}=t,{depthRadius:a,bias:l,alpha:c,beta:u}=r,d=new bN(o.shape),p=[{type:"int32",data:[a]},{type:"float32",data:[l]},{type:"float32",data:[c]},{type:"float32",data:[u]}];return e.runWebGPUProgram(d,[o,i,s],o.dtype,p)}var ble={kernelName:Jp,backendName:"webgpu",kernelFunc:nje};var rje=rn({opType:Xe.MAX,cpuKernelImpl:mse}),wle={kernelName:rl,backendName:"webgpu",kernelFunc:rje};function oje(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{filterSize:i,strides:s,pad:a,dimRoundingMode:l}=r,u=T.computePool2DInfo(o.shape,i,s,1,a,l);return Ok(o,u,"max",e)}var Cle={kernelName:Wc,backendName:"webgpu",kernelFunc:oje};function ije(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{filterSize:i,strides:s,pad:a,dataFormat:l,dimRoundingMode:c}=r,u=[1,1,1],d=T.computePool3DInfo(o.shape,i,s,u,a,c,l),p=new lh(d,"max"),f=[{type:"int32",data:[d.strideDepth,d.strideHeight,d.strideWidth]},{type:"int32",data:[d.padInfo.front,d.padInfo.top,d.padInfo.left]},{type:"int32",data:[d.inDepth,d.inHeight,d.inWidth]},{type:"int32",data:[d.effectiveFilterDepth,d.effectiveFilterHeight,d.effectiveFilterWidth]}];return e.runWebGPUProgram(p,[o],o.dtype,f)}var _le={kernelName:Gc,backendName:"webgpu",kernelFunc:ije};var wN=class{constructor(t){this.variableNames=["dy","maxPos"],this.uniforms=`strides : vec2<i32>, pads : vec2<i32>, dilations : vec2<i32>, filterDims : vec2<i32>,
       outHeight : i32, outWidth : i32`,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=t.inShape,this.dispatchLayout=xe(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="maxPool2DBackprop"}getUserCode(){return`
      ${de("index")} {
      if (index < uniforms.size) {
        let coords = getCoordsFromIndex(index);
        let batch = coords[0];
        let d = coords[3];

        let dyRCCorner = vec2<i32>(coords.yz) - uniforms.pads;
        let dyRCorner = dyRCCorner.x;
        let dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        var dotProd = 0.0;
        let lastIndex = uniforms.filterDims[0] * uniforms.filterDims[1] - 1;
        for (var wR = 0; wR < uniforms.filterDims[0]; wR += uniforms.dilations[0]) {
          let dyR = f32(dyRCorner + wR) / f32(uniforms.strides[0]);

          if (dyR < 0.0 || dyR >= f32(uniforms.outHeight) || fract(dyR) > 0.0) {
            continue;
          }
          let idyR = i32(dyR);

          for (var wC = 0; wC < uniforms.filterDims[1]; wC += uniforms.dilations[1]) {
            let dyC = f32(dyCCorner + wC) / f32(uniforms.strides[1]);

            if (dyC < 0.0 || dyC >= f32(uniforms.outWidth) || fract(dyC) > 0.0) {
              continue;
            }
            let idyC = i32(dyC);

            let dyValue = getDy(batch, idyR, idyC, d);
            let maxPosValue = lastIndex - i32(getMaxPos(batch, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            let curPosValue = wR * uniforms.filterDims[1] + wC;
            let mask = select(0.0, 1.0, maxPosValue == curPosValue);
            dotProd += dyValue * mask;
          }
        }
        setOutputAtIndex(index, dotProd);
      }
    }
    `}},CN=class{constructor(t){this.variableNames=["dy","maxPos"],this.uniforms=`strides : vec3<i32>, pads : vec3<i32>, filterDims : vec3<i32>,
      outDepth : i32, outHeight : i32, outWidth : i32`,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=t.inShape,this.dispatchLayout=xe(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="maxPool3DBackprop"}getUserCode(){return`
      ${de("index")} {
      if (index < uniforms.size) {
        let coords = getCoordsFromIndex(index);
        let batch = coords.x;
        let ch = coords.u;

        let dyCorner = vec3<i32>(coords.y, coords.z, coords.w) - uniforms.pads;
        let dyDCorner = dyCorner.x;
        let dyRCorner = dyCorner.y;
        let dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        var dotProd = 0.0;
        let lastIndex = uniforms.filterDims[0] * uniforms.filterDims[1] * uniforms.filterDims[2] - 1;

        for (var wD = 0; wD < uniforms.filterDims[0]; wD++) {
          let dyD = f32(dyDCorner + wD) / f32(uniforms.strides[0]);

          if (dyD < 0.0 || dyD >= f32(uniforms.outDepth) || fract(dyD) > 0.0) {
            continue;
          }
          let idyD = i32(dyD);

          for (var wR = 0; wR < uniforms.filterDims[1]; wR++) {
            let dyR = f32(dyRCorner + wR) / f32(uniforms.strides[1]);

            if (dyR < 0.0 || dyR >= f32(uniforms.outHeight) || fract(dyR) > 0.0) {
              continue;
            }
            let idyR = i32(dyR);

            for (var wC = 0; wC < uniforms.filterDims[2]; wC++) {
              let dyC = f32(dyCCorner + wC) / f32(uniforms.strides[2]);

              if (dyC < 0.0 || dyC >= f32(uniforms.outWidth) || fract(dyC) > 0.0) {
                continue;
              }
              let idyC = i32(dyC);

              let dyValue = getDy(batch, idyD, idyR, idyC, ch);
              let maxPosValue = lastIndex - i32(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              let curPosValue = wD * uniforms.filterDims[1] * uniforms.filterDims[2] + wR * uniforms.filterDims[2] + wC;
              let mask = select(0.0, 1.0, maxPosValue == curPosValue);
              dotProd += dyValue * mask;
            }
          }
        }

        setOutputAtIndex(index, dotProd);
      }
    }
    `}};function sje(n){let{inputs:t,backend:e,attrs:r}=n,{dy:o,input:i}=t,s=i,{filterSize:a,strides:l,pad:c,dimRoundingMode:u}=r,d=[1,1,1],p=T.computePool3DInfo(s.shape,a,l,d,c,u),f=new lh(p,"max",!0),h=[{type:"int32",data:[p.strideDepth,p.strideHeight,p.strideWidth]},{type:"int32",data:[p.padInfo.front,p.padInfo.top,p.padInfo.left]},{type:"int32",data:[p.inDepth,p.inHeight,p.inWidth]},{type:"int32",data:[p.effectiveFilterDepth,p.effectiveFilterHeight,p.effectiveFilterWidth]}],m=e.runWebGPUProgram(f,[s],"int32",h),g=new CN(p);h=[{type:"int32",data:[p.strideDepth,p.strideHeight,p.strideWidth]},{type:"int32",data:[p.effectiveFilterDepth-1-p.padInfo.front,p.effectiveFilterHeight-1-p.padInfo.top,p.effectiveFilterWidth-1-p.padInfo.left]},{type:"int32",data:[p.effectiveFilterDepth,p.effectiveFilterHeight,p.effectiveFilterWidth]},{type:"int32",data:[p.outDepth]},{type:"int32",data:[p.outHeight]},{type:"int32",data:[p.outWidth]}];let y=e.runWebGPUProgram(g,[o,m],s.dtype,h);return e.disposeData(m.dataId),y}var Sle={kernelName:tf,backendName:"webgpu",kernelFunc:sje};function aje(n){let{inputs:t,backend:e,attrs:r}=n,{dy:o,input:i,output:s}=t,a=i;Aw([i,s],"maxPoolGrad");let{filterSize:l,strides:c,pad:u,dimRoundingMode:d}=r,p=T.computePool2DInfo(a.shape,l,c,1,u,d),f=new Ou(p,"max",!0),h=[{type:"int32",data:[p.strideHeight,p.strideWidth]},{type:"int32",data:[p.padInfo.top,p.padInfo.left]},{type:"int32",data:[p.dilationHeight,p.dilationWidth]},{type:"int32",data:[p.inHeight,p.inWidth]},{type:"int32",data:[p.effectiveFilterHeight,p.effectiveFilterWidth]}],m=e.runWebGPUProgram(f,[a],"int32",h),g=new wN(p);h=[{type:"int32",data:[p.strideHeight,p.strideWidth]},{type:"int32",data:[p.effectiveFilterHeight-1-p.padInfo.top,p.effectiveFilterWidth-1-p.padInfo.left]},{type:"int32",data:[p.dilationHeight,p.dilationWidth]},{type:"int32",data:[p.effectiveFilterHeight,p.effectiveFilterWidth]},{type:"int32",data:[p.outHeight]},{type:"int32",data:[p.outWidth]}];let y=e.runWebGPUProgram(g,[o,m],a.dtype,h);return e.disposeData(m.dataId),y}var Ile={kernelName:ef,backendName:"webgpu",kernelFunc:aje};function lje(n){let{inputs:t,backend:e,attrs:r}=n,{filterSize:o,strides:i,pad:s,includeBatchInIndex:a}=r,{x:l}=t;b.assert(l.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${l.shape.length}.`);let c=[1,1];b.assert(T.eitherStridesOrDilationsAreOne(i,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${c}'`);let u=T.computePool2DInfo(l.shape,o,i,c,s),d=[{type:"int32",data:[u.strideHeight,u.strideWidth]},{type:"int32",data:[u.padInfo.top,u.padInfo.left]},{type:"int32",data:[u.dilationHeight,u.dilationWidth]},{type:"int32",data:[u.inHeight,u.inWidth]},{type:"int32",data:[u.effectiveFilterHeight,u.effectiveFilterWidth]}],p=new Ou(u,"max",!1),f=e.runWebGPUProgram(p,[l],l.dtype,d);p=new Ou(u,"max",!0,!0,a);let h=e.runWebGPUProgram(p,[l],"int32",d);return[f,h]}var Ele={kernelName:nf,backendName:"webgpu",kernelFunc:lje};function cje(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{axis:i,keepDims:s}=r;return rs(o,i,s,"min",e)}var Tle={kernelName:Hc,backendName:"webgpu",kernelFunc:cje};var uje=rn({opType:Xe.MIN,cpuKernelImpl:gse}),Dle={kernelName:ol,backendName:"webgpu",kernelFunc:uje};var _N=class{constructor(t,e,r){this.uniforms="",this.variableNames=["x"],this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e.map((o,i)=>o[0]+t[i]+o[1]),this.dispatchLayout=xe(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.xShape=t,e.map((o,i)=>{this.uniforms+=` pad${i} : vec2<i32>,`}),this.offset=r==="reflect"?0:1,this.shaderKey=`mirrorPad_${r}`}getUserCode(){let t=this.xShape.length,e=this.xShape.map((c,u)=>`uniforms.pad${u}[0]`).join(","),r=this.xShape.map((c,u)=>`uniforms.pad${u}[0] + uniforms.xShape${t>1?`[${u}]`:""}`).join(","),o=t===1?"start":"start[i]",i=t===1?"end":"end[i]",s=t===1?"outC":"outC[i]",a=zn(t),l=t>1?["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,t):"coords";return`
      ${de("index")} {
        if (index < uniforms.size) {
          let start = ${a}(${e});
          let end = ${a}(${r});
          var outC = getCoordsFromIndex(index);
          for (var i = 0; i < ${t}; i = i + 1) {
            if (${s} < ${o}) {
              ${s} = ${o} * 2 - ${s} - ${this.offset};
            } else if(${s} >= ${i}) {
              ${s} = (${i} - 1) * 2 - ${s} + ${this.offset};
            }
          }
          let coords = outC - start;
          setOutputAtIndex(index, getX(${l}));
        }
      }
    `}};var kle={kernelName:qc,backendName:"webgpu",kernelFunc:({inputs:n,attrs:t,backend:e})=>{let{x:r}=n,{paddings:o,mode:i}=t,s=e,a=o.map(u=>({type:"int32",data:[u[0],u[1]]})),l=new _N(r.shape,o,i);return s.runWebGPUProgram(l,[r],r.dtype,a)}};var dje=rn({opType:Xe.MOD}),Nle={kernelName:il,backendName:"webgpu",kernelFunc:dje};var SN=class{constructor(t,e){this.variableNames=["probs"],this.outputShape=[],this.uniforms="seed : f32, numOutcomes: i32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=[t,e],this.dispatchLayout=xe(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="multinomial"}getUserCode(){return`
    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    fn random (seed : f32, resultUV : vec2<f32>) -> f32 {
      let HASHSCALE1 = 443.8975;
      let p = resultUV * seed;
      var p3  = fract(vec3<f32>(p.xyx) * HASHSCALE1);
      p3 = p3 + dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${de("index")} {
      if (index < uniforms.size) {
        let coords = getOutputCoords();
        let batch = coords[0];

        let resUV = vec2<f32>(f32(coords[1]) / f32(uniforms.outShape[1]),
            f32(coords[0]) / f32(uniforms.outShape[0]));
        let r = random(uniforms.seed, resUV);
        var cdf = 0.0;
        for (var i = 0; i < uniforms.numOutcomes - 1; i = i + 1) {
          cdf = cdf + getProbs(batch, i);

          if (r < cdf) {
            setOutputAtIndexI32(index, i);
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutputAtIndexI32(index, uniforms.numOutcomes - 1);
      }
    }
  `}};var IN=class{constructor(t){this.variableNames=["logits"],this.outputShape=t,this.dispatchLayout=xe(this.outputShape),this.dispatch=[this.outputShape[0],1,1],this.outputShape[1]>=4096?this.workgroupSize=[256,1,1]:this.workgroupSize=[64,1,1],this.shaderKey="softmax"}getUserCode(){return`
    var<workgroup> buf : array<f32, ${this.workgroupSize[0]}>;
    var<workgroup> rowMaxShared : f32;
    var<workgroup> rowSumShared : f32;
    const blockSize = ${this.workgroupSize[0]};
    ${de("index")} {
      let row = index / blockSize;
      let tid = i32(localId.x);
      let cols = uniforms.outShape[1];

      var threadMax = -3.402823e+38f;
      for (var col = tid; col < cols; col += blockSize) {
        let value = getLogits(row, col);
        threadMax = max(threadMax, value);
      }
      if (tid < cols) {
        buf[tid] = threadMax;
      }
      workgroupBarrier();

      var reduceSize = min(cols, blockSize);
      for (var currSize = reduceSize >> 1;  currSize > 0; currSize = reduceSize >> 1) {
        reduceSize = currSize + (reduceSize & 1);
        if (tid < currSize) {
          buf[tid] = max(buf[tid], buf[tid + reduceSize]);
        }
        workgroupBarrier();
      }

      if (tid == 0) {
        rowMaxShared = buf[0];
      }
      workgroupBarrier();

      var threadSum = 0.0;
      for (var col = tid; col < cols; col += blockSize) {
        let subExp = exp(getLogits(row, col) - rowMaxShared);
        threadSum += subExp;
      }
      buf[tid] = threadSum;
      workgroupBarrier();

      for (var currSize = blockSize >> 1;  currSize > 0; currSize = currSize >> 1) {
        if (tid < currSize) {
          buf[tid] = buf[tid] + buf[tid + currSize];
        }
        workgroupBarrier();
      }

      if (tid == 0) {
        rowSumShared = buf[0];
      }
      workgroupBarrier();

      for (var col = tid; col < cols; col += blockSize) {
        let value = exp(getLogits(row, col) - rowMaxShared) / rowSumShared;
        setOutputAtCoords(row, col, value);
      }
  }
    `}};function M3(n){let{inputs:t,backend:e,attrs:r}=n,{logits:o}=t,{dim:i}=r,s=$e({inputs:{x:o},backend:e,attrs:{shape:[b.sizeFromShape(o.shape)/o.shape[i],o.shape[i]]}}),a=new IN(s.shape),l=e.runWebGPUProgram(a,[s],o.dtype),c=$e({inputs:{x:l},backend:e,attrs:{shape:o.shape}});return e.disposeData(s.dataId),e.disposeData(l.dataId),c}var Ale={kernelName:uu,backendName:"webgpu",kernelFunc:M3};function pje(n){let{inputs:t,backend:e,attrs:r}=n,{logits:o}=t,{numSamples:i,seed:s,normalized:a}=r,l=a?o:M3({inputs:{logits:o},backend:e,attrs:{dim:o.shape.length-1}}),c=l.shape[0],u=l.shape[1],d=new SN(c,i),p=[{type:"float32",data:[s]},{type:"int32",data:[u]}],f=e.runWebGPUProgram(d,[l],"int32",p);return a||e.disposeData(l.dataId),f}var Rle={kernelName:rf,backendName:"webgpu",kernelFunc:pje};function fje(n){let{inputs:t,backend:e}=n,{x:r}=t;if(e.shouldExecuteOnCPU([r])){let i=e.tensorMap.get(r.dataId),[s,a]=xse(i.values,r.shape,r.dtype);return e.makeTensorInfo(a,r.dtype,s)}let o=new ns(r.shape,Ce.NEG);return e.runWebGPUProgram(o,[r],r.dtype)}var Ole={kernelName:Kc,backendName:"webgpu",kernelFunc:fje};function hje(n){console.warn("tf.nonMaxSuppression() in webgpu locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");let{inputs:t,backend:e,attrs:r}=n,{boxes:o,scores:i}=t,{maxOutputSize:s,iouThreshold:a,scoreThreshold:l}=r,c=e.readSync(o.dataId),u=e.readSync(i.dataId),{selectedIndices:d}=Vr.nonMaxSuppressionV3Impl(c,u,s,a,l);return e.makeTensorInfo([d.length],"int32",new Int32Array(d))}var Mle={kernelName:of,backendName:"webgpu",kernelFunc:hje};function mje(n){console.warn("tf.nonMaxSuppression() in webgpu locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");let{inputs:t,backend:e,attrs:r}=n,{boxes:o,scores:i}=t,{maxOutputSize:s,iouThreshold:a,scoreThreshold:l,softNmsSigma:c}=r,u=e.readSync(o.dataId),d=e.readSync(i.dataId),p=s,f=a,h=l,m=c,{selectedIndices:g,selectedScores:y}=Vr.nonMaxSuppressionV5Impl(u,d,p,f,h,m);return[e.makeTensorInfo([g.length],"int32",new Int32Array(g)),e.makeTensorInfo([y.length],"float32",new Float32Array(y))]}var Ple={kernelName:sf,backendName:"webgpu",kernelFunc:mje};var EN=class{constructor(t,e){this.variableNames=["x"],this.uniforms="onValue : f32, offValue : f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=[t,e],this.dispatchLayout=xe(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="onehot"}getUserCode(){return`
      ${de("index")} {
        if(index < uniforms.size) {
          let coords = getCoordsFromIndex(index);
          setOutputAtIndex(index, mix(uniforms.offValue, uniforms.onValue,
                                      f32(i32(round(getX(coords.x))) == coords.y)));
        }
      }
    `}};function gje(n){let{inputs:t,backend:e,attrs:r}=n,{indices:o}=t,{dtype:i,depth:s,onValue:a,offValue:l}=r,c=b.sizeFromShape(o.shape),u=new EN(c,s),d=$e({inputs:{x:o},backend:e,attrs:{shape:[c]}}),p=[{type:"float32",data:[a]},{type:"float32",data:[l]}],f=e.runWebGPUProgram(u,[d],i,p);e.disposeData(d.dataId);let h=[...o.shape,s],m=$e({inputs:{x:f},backend:e,attrs:{shape:h}});return e.disposeData(f.dataId),m}var Fle={kernelName:Yc,backendName:"webgpu",kernelFunc:gje};function Fw(n){let{inputs:t,backend:e}=n,{x:r}=t;if(r.dtype==="complex64"){let o=ep({inputs:{input:r},backend:e}),i=Fw({inputs:{x:o},backend:e}),s=Zm({inputs:{input:r},backend:e}),a=Fw({inputs:{x:s},backend:e}),l=ws({inputs:{real:i,imag:a},backend:e});return e.disposeData(o.dataId),e.disposeData(i.dataId),e.disposeData(s.dataId),e.disposeData(a.dataId),l}else return dr({attrs:{shape:r.shape,dtype:r.dtype,value:r.dtype==="string"?"":0},backend:e})}var Lle={kernelName:fu,backendName:"webgpu",kernelFunc:Fw};function $le(n){let{inputs:t,backend:e}=n,{x:r}=t;if(r.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(r.dtype==="complex64"){let o=ep({inputs:{input:r},backend:e}),i=$le({inputs:{x:o},backend:e}),s=Zm({inputs:{input:r},backend:e}),a=Fw({inputs:{x:s},backend:e}),l=ws({inputs:{real:i,imag:a},backend:e});return e.disposeData(o.dataId),e.disposeData(i.dataId),e.disposeData(s.dataId),e.disposeData(a.dataId),l}else return dr({attrs:{shape:r.shape,dtype:r.dtype,value:1},backend:e})}var Vle={kernelName:Xc,backendName:"webgpu",kernelFunc:$le};function yje(n){let{inputs:t,backend:e,attrs:r}=n,{axis:o}=r;if(t.length===1)return uN({inputs:{input:t[0]},backend:e,attrs:{dim:o}});let i=t[0].shape,s=t[0].dtype;t.forEach(u=>{b.assertShapesMatch(i,u.shape,"All tensors passed to stack must have matching shapes"),b.assert(s===u.dtype,()=>"All tensors passed to stack must have matching dtypes")});let a=[],l=t.map(u=>{let d=uN({inputs:{input:u},backend:e,attrs:{dim:o}});return a.push(d),d}),c=k3({inputs:l,backend:e,attrs:{axis:o}});return a.forEach(u=>e.disposeData(u.dataId)),c}var Ble={kernelName:Zc,backendName:"webgpu",kernelFunc:yje};function P3(n,t=!1){let e=n.length,r=zn(e),o=n.map((d,p)=>`uniforms.pad${p}[0]`).join(","),i=n.map((d,p)=>`uniforms.pad${p}[0] + uniforms.xShape${e>1?`[${p}]`:""}`).join(","),s=e>1?`${r}(${o})`:`${o}`,a=e>1?`${r}(${i})`:`${i}`,l=e>1?"any(paddedCoords < start)":"paddedCoords < start",c=e>1?"any(paddedCoords >= end)":"paddedCoords >= end",u=e>1?["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,e):"coords";return`
        let start = ${s};
        let end = ${a};
        if (${l} || ${c}) {
          setOutputAtIndex(index, ${t?0:"uniforms.constantValue"});
        } else {
          let coords = paddedCoords - start;
          setOutputAtIndex(index, getX(${u}));
        }
  `}var TN=class{constructor(t,e){this.variableNames=["x"],this.uniforms="constantValue : f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e.map((r,o)=>r[0]+t[o]+r[1]),this.dispatchLayout=xe(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),e.map((r,o)=>{this.uniforms+=` pad${o} : vec2<i32>,`}),this.xShape=t,this.shaderKey="pad"}getUserCode(){return`
      ${de("index")} {
        if (index < uniforms.size) {
          let paddedCoords = getCoordsFromIndex(index);
          ${P3(this.xShape)}
        }
      }
    `}};var xje=n=>{let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{paddings:i,constantValue:s}=r;if(i.every(c=>b.arraysEqual(c,[0,0])))return Sr({inputs:{x:o},backend:e});if(b.sizeFromShape(o.shape)===0){let c=i.map((u,d)=>u[0]+o.shape[d]+u[1]);return dr({backend:e,attrs:{shape:c,value:s,dtype:o.dtype}})}let a=[{type:"float32",data:[s]}];i.map(c=>a.push({type:"int32",data:[c[0],c[1]]}));let l=new TN(o.shape,i);return e.runWebGPUProgram(l,[o],o.dtype,a)},zle={kernelName:Qc,backendName:"webgpu",kernelFunc:xje};var vje=rn({opType:Xe.POW}),Ule={kernelName:al,backendName:"webgpu",kernelFunc:vje};function bje(n){let{inputs:t,backend:e}=n,{x:r,alpha:o}=t,i=new Jd(Xe.PRELU,r.shape,o.shape);return e.runWebGPUProgram(i,[r,o],"float32")}var Wle={kernelName:Jc,backendName:"webgpu",kernelFunc:bje};function wje(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{axis:i,keepDims:s}=r;return rs(o,i,s,"prod",e)}var Gle={kernelName:eu,backendName:"webgpu",kernelFunc:wje};var Cje=n=>{let{backend:t,attrs:e}=n,{start:r,stop:o,step:i,dtype:s}=e,a=wse(r,o,i,s);return t.makeTensorInfo([a.length],s,a)},jle={kernelName:af,backendName:"webgpu",kernelFunc:Cje};var _je=rn({opType:Xe.DIV}),Hle={kernelName:Ga,backendName:"webgpu",kernelFunc:_je};var Sje=Qe({opType:Ce.RECIPROCAL}),qle={kernelName:ll,backendName:"webgpu",kernelFunc:Sje};var Ije=Qe({opType:Ce.RELU}),Kle={kernelName:cl,backendName:"webgpu",kernelFunc:Ije};var Eje=Qe({opType:Ce.RELU6}),Xle={kernelName:ul,backendName:"webgpu",kernelFunc:Eje};var DN=class{constructor(t,e,r){this.variableNames=["x"],this.uniforms="adjustHeightWidth : vec2<f32>, halfPixelCenters : f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=[t[0],e,r,t[3]],this.dispatchLayout=xe(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="resizeBilinear"}getUserCode(){return`
      ${de("index")} {
        if (index < uniforms.size) {
        let coords = getCoordsFromIndex(index);
          let b = coords[0];
          let d = coords[3];
          let rc = coords.yz;

          let effectiveInSize = vec2<f32>(
            f32(uniforms.xShape.y) - uniforms.adjustHeightWidth[0],
            f32(uniforms.xShape.z) - uniforms.adjustHeightWidth[1]);

          let effectiveOutSize = vec2<f32>(
            f32(uniforms.outShape.y) - uniforms.adjustHeightWidth[0],
            f32(uniforms.outShape.z) - uniforms.adjustHeightWidth[1]);

          let effectiveInputOverOutputRatioRC =
              effectiveInSize / effectiveOutSize;

          // Fractional source index
          let sourceFracIndexRC =
            (vec2<f32>(rc) + vec2<f32>(uniforms.halfPixelCenters)) *
            effectiveInputOverOutputRatioRC - vec2<f32>(uniforms.halfPixelCenters);

          // Compute the four integer indices.
          let sourceFloorRC = vec2<i32>(sourceFracIndexRC);
          let sourceCeilRC = vec2<i32>(
            min(vec2<f32>(uniforms.xShape.yz) - vec2<f32>(1.0), ceil(sourceFracIndexRC)));

          let topLeft = getX(b, sourceFloorRC.x, sourceFloorRC.y, d);
          let bottomLeft = getX(b, sourceCeilRC.x, sourceFloorRC.y, d);
          let topRight = getX(b, sourceFloorRC.x, sourceCeilRC.y, d);
          let bottomRight = getX(b, sourceCeilRC.x, sourceCeilRC.y, d);

          let fracRC = sourceFracIndexRC - vec2<f32>(sourceFloorRC);

          let top = topLeft + (topRight - topLeft) * fracRC.y;
          let bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
          let newValue = top + (bottom - top) * fracRC.x;

          setOutputAtIndex(index, newValue);
        }
      }
    `}};function Tje(n){let{inputs:t,backend:e,attrs:r}=n,{images:o}=t,{alignCorners:i,size:s,halfPixelCenters:a}=r,[l,c]=s,u=i&&l>1?1:0,d=i&&c>1?1:0,f=[{type:"float32",data:[u,d]},{type:"float32",data:[a?.5:0]}],h=new DN(o.shape,l,c);return e.runWebGPUProgram(h,[o],"float32",f)}var Yle={kernelName:ru,backendName:"webgpu",kernelFunc:Tje};var kN=class{constructor(t,e){this.variableNames=["dy"],this.uniforms=`effectiveXSize : vec2<i32>, effectiveYSize : vec2<i32>, heightScale : f32, widthScale : f32,
       invHeightScale : f32, invWidthScale : f32, winHeight : i32, winWidth : i32,`,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=t,this.dispatchLayout=xe(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.alignCorners=e,this.shaderKey=`resizeBilinearBackprop_${e}`}getUserCode(){return`
      ${de("index")} {
        if (index < uniforms.size) {
          let coords = getOutputCoords();
          let b = coords[0];
          let d = coords[3];
          let r = coords[1];
          let c = coords[2];

          var accumulator = 0.0;

          // Compute bounds for where in dy we will look
          let startRLerp = floor(f32(r) * uniforms.invHeightScale);
          let startDyR = i32(startRLerp - f32(uniforms.winHeight / 2));

          let startCLerp = floor(f32(c) * uniforms.invWidthScale);
          let startDyC = i32(startCLerp - f32(uniforms.winWidth / 2));

          // Loop over dy
          for (var dyROffset = 0; dyROffset < uniforms.winHeight; dyROffset++) {
            let dyR = startDyR + dyROffset;

            // Guard against the window exceeding the bounds of dy
            if (dyR < 0 || dyR >= uniforms.dyShape[1]) {
              continue;
            }

            for (var dyCOffset = 0; dyCOffset < uniforms.winWidth; dyCOffset++) {
              let dyC = startDyC + dyCOffset;

              // Guard against the window exceeding the bounds of dy
              if (dyC < 0 || dyC >= uniforms.dyShape[2]) {
                continue;
              }

              let dxR = f32(dyR) * uniforms.heightScale;
              let topDxRIndex = i32(floor(dxR));
              let bottomDxRIndex = i32(min(ceil(dxR), f32(uniforms.outShape[1] - 1)));
              let dxRLerp = dxR - f32(topDxRIndex);
              let inverseDxRLerp = 1.0 - dxRLerp;

              let dxC = f32(dyC) * uniforms.widthScale;
              let leftDxCIndex = i32(floor(dxC));
              let rightDxCIndex = i32(min(ceil(dxC), f32(uniforms.outShape[2] - 1)));
              let dxCLerp = dxC - f32(leftDxCIndex);
              let inverseDxCLerp = 1.0 - dxCLerp;

              if (r == topDxRIndex && c == leftDxCIndex) {
                // topLeft
                accumulator +=
                  getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
              }

              if (r == topDxRIndex && c == rightDxCIndex) {
                // topRight
                accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
              }

              if (r == bottomDxRIndex && c == leftDxCIndex) {
                // bottomLeft
                accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
              }

              if (r == bottomDxRIndex && c == rightDxCIndex) {
                // bottomRight
                accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
              }
            }
          }
          // End loop over dy

          setOutputAtIndex(index, accumulator);
        }
      }
    `}};function Dje(n){let{inputs:t,backend:e,attrs:r}=n,{images:o,dy:i}=t,{alignCorners:s}=r,[,a,l]=o.shape,[,c,u]=i.shape,d=[s&&c>1?a-1:a,s&&u>1?l-1:l],p=[s&&c>1?c-1:c,s&&u>1?u-1:u],f=d[0]/p[0],h=d[1]/p[1],m=1/f,g=1/h,y=Math.ceil(m)*2+2,v=Math.ceil(g)*2+2,w=new kN(o.shape,s),C=[{type:"int32",data:d},{type:"int32",data:p},{type:"float32",data:[f]},{type:"float32",data:[h]},{type:"float32",data:[m]},{type:"float32",data:[g]},{type:"int32",data:[y]},{type:"int32",data:[v]}];return e.runWebGPUProgram(w,[i],i.dtype,C)}var Zle={kernelName:uf,backendName:"webgpu",kernelFunc:Dje};var NN=class{constructor(t,e,r,o){this.variableNames=["x"],this.uniforms="adjustHeightWidth : vec2<f32>, roundBase : f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=[t[0],e,r,t[3]],this.dispatchLayout=xe(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.halfPixelCenters=o,this.shaderKey=`resizeNearest_${o}`}getUserCode(){let t;return this.halfPixelCenters?t="max((vec2<f32>(rc) + vec2<f32>(0.5)) * effectiveInputOverOutputRatioRC, vec2<f32>(0.0))":t="vec2<f32>(rc) * effectiveInputOverOutputRatioRC",`
      ${de("index")} {
        if (index < uniforms.size) {
          let coords = getCoordsFromIndex(index);
          let b = coords[0];
          let d = coords[3];
          let rc = coords.yz;

          let effectiveInSize = vec2<f32>(
            f32(uniforms.xShape.y) - uniforms.adjustHeightWidth[0],
            f32(uniforms.xShape.z) - uniforms.adjustHeightWidth[1]);

          let effectiveOutSize = vec2<f32>(
            f32(uniforms.outShape.y) - uniforms.adjustHeightWidth[0],
            f32(uniforms.outShape.z) - uniforms.adjustHeightWidth[1]);

          let effectiveInputOverOutputRatioRC =
              effectiveInSize / effectiveOutSize;

          // Fractional source index
          let sourceFracIndexRC = ${t};

          // Compute the coordinators of nearest neighbor point.
          let inputShapeRC = vec2<f32>(f32(uniforms.xShape.y), f32(uniforms.xShape.z));
          let sourceNearestRC = vec2<i32>(
            min(inputShapeRC - 1.0, floor(sourceFracIndexRC + uniforms.roundBase)));
          let newValue = getX(b, sourceNearestRC.x, sourceNearestRC.y, d);

          setOutputAtIndex(index, newValue);
        }
      }
    `}};function kje(n){let{inputs:t,backend:e,attrs:r}=n,{images:o}=t,{alignCorners:i,halfPixelCenters:s,size:a}=r,[l,c]=a,u=i&&l>1?1:0,d=i&&c>1?1:0,f=[{type:"float32",data:[u,d]},{type:"float32",data:[i?.5:0]}],h=new NN(o.shape,l,c,s);return e.runWebGPUProgram(h,[o],o.dtype,f)}var Qle={kernelName:nu,backendName:"webgpu",kernelFunc:kje};var AN=class{constructor(t,e){this.variableNames=["dy"],this.uniforms=`effectiveXSize : vec2<i32>, effectiveYSize : vec2<i32>, invHeightScale : f32, invWidthScale : f32,
       winHeight : i32, winWidth : i32,`,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=t,this.dispatchLayout=xe(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.alignCorners=e,this.shaderKey=`resizeNearestNeigborBackprop_${e}`}getUserCode(){return`
      ${de("index")} {
        if (index < uniforms.size) {
          let coords = getOutputCoords();
          let b = coords[0];
          let d = coords[3];
          let r = coords[1];
          let c = coords[2];

          var accumulator = 0.0;

          // Compute bounds for where in dy we will look
          let startRLerp = floor(f32(r) * uniforms.invHeightScale);
          let startDyR = i32(floor(startRLerp - f32(uniforms.winHeight / 2)));

          let startCLerp = floor(f32(c) * uniforms.invWidthScale);
          let startDyC = i32(floor(startCLerp - f32(uniforms.winWidth / 2)));

          // Loop over dy
          for (var dyROffset = 0; dyROffset < uniforms.winHeight; dyROffset++) {
            let dyR = startDyR + dyROffset;

            // Guard against the window exceeding the bounds of dy
            if (dyR < 0 || dyR >= uniforms.dyShape[1]) {
              continue;
            }

            for (var dyCOffset = 0; dyCOffset < uniforms.winWidth; dyCOffset++) {
              let dyC = startDyC + dyCOffset;

              // Guard against the window exceeding the bounds of dy
              if (dyC < 0 || dyC >= uniforms.dyShape[2]) {
                continue;
              }

              let sourceFracRow = f32(uniforms.effectiveXSize[0]) *
                  (f32(dyR) / f32(uniforms.effectiveYSize[0]));

              let sourceFracCol = f32(uniforms.effectiveXSize[1]) *
                  (f32(dyC) / f32(uniforms.effectiveYSize[1]));

              let sourceNearestRow =
                  i32(min(f32(uniforms.outShape[1] - 1),
                  ${this.alignCorners?"floor(sourceFracRow + 0.5)":"floor(sourceFracRow)"}));

              let sourceNearestCol =
                  i32(min(f32(uniforms.outShape[2] - 1),
                  ${this.alignCorners?"floor(sourceFracCol + 0.5)":"floor(sourceFracCol)"}));

              if (r == sourceNearestRow && c == sourceNearestCol) {
                accumulator += getDy(b, dyR, dyC, d);
              }
            }
          }
          // End loop over dy

          setOutputAtIndex(index, accumulator);
        }
      }
    `}};function Nje(n){let{inputs:t,backend:e,attrs:r}=n,{images:o,dy:i}=t,{alignCorners:s}=r,[,a,l]=o.shape,[,c,u]=i.shape,d=[s&&c>1?a-1:a,s&&u>1?l-1:l],p=[s&&c>1?c-1:c,s&&u>1?u-1:u],f=d[0]/p[0],h=d[1]/p[1],m=1/f,g=1/h,y=Math.ceil(m)*2+2,v=Math.ceil(g)*2+2,w=new AN(o.shape,s),C=[{type:"int32",data:d},{type:"int32",data:p},{type:"float32",data:[m]},{type:"float32",data:[g]},{type:"int32",data:[y]},{type:"int32",data:[v]}];return e.runWebGPUProgram(w,[i],i.dtype,C)}var Jle={kernelName:cf,backendName:"webgpu",kernelFunc:Nje};var RN=class{constructor(t){this.variableNames=["x"],this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=t,this.dispatchLayout=xe(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.uniforms=" axis : vec4<i32>,",this.shaderKey="reverse"}getUserCode(){return`
      
      // Using uniform variables as judging conditions, so the function has
      // coherent execution within all threads.
      fn getReverseCoords(coords : vec4<i32>) -> vec4<i32> {
        var reverseCoords = coords;
        if (uniforms.axis[0] == 1) {
          reverseCoords[0] = uniforms.xShape[0] - coords[0] - 1;
        }
        if (uniforms.axis[1] == 1) {
          reverseCoords[1] = uniforms.xShape[1] - coords[1] - 1;
        }
        if (uniforms.axis[2] == 1) {
          reverseCoords[2] = uniforms.xShape[2] - coords[2] - 1;
        }
        if (uniforms.axis[3] == 1) {
          reverseCoords[3] = uniforms.xShape[3] - coords[3] - 1;
        }

        return reverseCoords;
      }
    
      ${de("index")} {
        if (index < uniforms.size) {
          let coords = getCoordsFromIndex(index);
          let reverseCoords = getReverseCoords(coords);
          setOutputAtIndex(index, getX(reverseCoords[0],
              reverseCoords[1], reverseCoords[2], reverseCoords[3]));
        }
      }
    `}};function Aje(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{dims:i}=r,s=o.shape.length;if(s===0)return Sr({inputs:{x:o},backend:e});let a=o.shape,l=[1,1,1,1];a.forEach((g,y)=>{let v=y+4-s;l[v]=g});let c=b.parseAxisParam(i,o.shape),u=[0,0,0,0];c.forEach(g=>{let y=g+4-s;u[y]=1});let d=[{type:"int32",data:u}],p=$e({inputs:{x:o},backend:e,attrs:{shape:l}}),f=new RN(l),h=e.runWebGPUProgram(f,[p],p.dtype,d);e.disposeData(p.dataId);let m=$e({inputs:{x:h},backend:e,attrs:{shape:a}});return e.disposeData(h.dataId),m}var ece={kernelName:ou,backendName:"webgpu",kernelFunc:Aje};var ON=class{constructor(t,e){this.outputShape=[],this.variableNames=["x"],this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=t,this.dispatchLayout=xe(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.uniforms=`centerX : f32, centerY : f32, sinRadians : f32,
          cosRadians : f32,`,this.shaderKey="rotate",this.outputShape=t,typeof e=="number"?(this.uniforms+=" fillValue : f32,",this.fillSnippet="var outputValue = uniforms.fillValue;",this.shaderKey+="_float"):(this.uniforms+=" fillValue : vec3<f32>,",this.fillSnippet="var outputValue = uniforms.fillValue[coords[3]];",this.shaderKey+="_vec3")}getUserCode(){return`
        ${de("index")} {
          if (index < uniforms.size) {
            let coords = getCoordsFromIndex(index);
            let coordXFloat = (f32(coords[2]) - uniforms.centerX) *
                uniforms.cosRadians - (f32(coords[1]) - uniforms.centerY) *
                uniforms.sinRadians;
            let coordYFloat = (f32(coords[2]) - uniforms.centerX) *
                uniforms.sinRadians + (f32(coords[1]) - uniforms.centerY) *
                uniforms.cosRadians;
            let coordX = i32(round(coordXFloat + uniforms.centerX));
            let coordY = i32(round(coordYFloat + uniforms.centerY));
            ${this.fillSnippet}
            if(coordX >= 0 && coordX < uniforms.xShape[2] && coordY >= 0 &&
                coordY < uniforms.xShape[1]) {
              outputValue = getX(coords[0], coordY, coordX, coords[3]);
            }
            setOutputAtIndex(index, outputValue);
          }
        }
      `}};var tce={kernelName:Cf,backendName:"webgpu",kernelFunc:({inputs:n,attrs:t,backend:e})=>{let{image:r}=n,{radians:o,fillValue:i,center:s}=t,a=e,l=new ON(r.shape,i),[c,u]=T.getImageCenter(s,r.shape[1],r.shape[2]),d=[{type:"float32",data:[c]},{type:"float32",data:[u]},{type:"float32",data:[Math.sin(o)]},{type:"float32",data:[Math.cos(o)]}];return typeof i=="number"?d.push({type:"float32",data:[Number.parseFloat(i.toFixed(2))]}):d.push({type:"float32",data:i}),a.runWebGPUProgram(l,[r],r.dtype,d)}};var Rje=Qe({opType:Ce.ROUND}),nce={kernelName:dl,backendName:"webgpu",kernelFunc:Rje};var Oje=Qe({opType:Ce.RSQRT,cpuKernelImpl:Cse}),rce={kernelName:pl,backendName:"webgpu",kernelFunc:Oje};var Mu=class{constructor(t,e,r,o,i,s,a,l=!0){this.variableNames=["updates","indices"],this.workgroupSize=[64,1,1],this.atomic=!0,this.outputShape=s,this.type=a,this.sumDupeIndices=l,this.dispatchLayout=xe(t),this.dispatch=pe(this.dispatchLayout,t,this.workgroupSize),this.sliceDimGreaterThanOne=e>1,this.shaderKey=`scatter_${r}_${o}_${this.sliceDimGreaterThanOne}_${a}_${l}_${i.length}`;let c=zn(i.length);this.uniforms=`sliceDim : i32, strides: ${c}, updatesSize: i32,`,this.updatesRank=o,this.indicesRank=r}getUserCode(){let t="";this.indicesRank===1?t="coords[0]":this.indicesRank===2&&(t="coords[0], j");let e=`getIndices(${t})`,r=this.sliceDimGreaterThanOne?"uniforms.strides[j]":"uniforms.strides",o="",i="";this.dispatchLayout.x.length===1?(o="flattenedIndex",i=`
      fn getUpdatesCoordsFromFlatIndex(index : i32) -> i32 {
        return index;
      }
      `):this.dispatchLayout.x.length===2&&(o="vec2<i32>(flattenedIndex, coords[1])",i=`
      fn getUpdatesCoordsFromFlatIndex(index : i32) -> vec2<i32> {
        // N.B. |updates| could be a scalar tensor, conceptually representing a
        // 2D tensor with all values equal to that. By design, its size must be
        // the same as |outShape[1]| in one dimension, and |indicesShape[0]|
        // gives the other.
        let sliceSize = uniforms.outShape[1];
        let d0 = index / sliceSize;
        let d1 = index - d0 * sliceSize;
        return vec2<i32>(d0, d1);
      }
      `);let a=`getUpdates(${Array.from({length:this.updatesRank},(c,u)=>`coords[${u}]`).join(", ")})`;return`
    ${i}
      ${de("index")} {
        if (index < uniforms.updatesSize) {
          let coords = getUpdatesCoordsFromFlatIndex(index);
          var flattenedIndex = 0;
          for (var j = 0; j < uniforms.sliceDim; j = j + 1) {
            let indexInside = i32(round(${e}));
            flattenedIndex = flattenedIndex + indexInside * ${r};
          }
          let updateValue =
              ${ih(this.type)}(${a});
          let flatIndex = getOutputIndexFromCoords(${o});

          ${this.sumDupeIndices?es("&result[flatIndex]","updateValue",this.type):"atomicStore(&result[flatIndex], bitcast<i32>(updateValue));"}
        }
      }`}};function Mje(n){let{inputs:t,backend:e,attrs:r}=n,{indices:o,updates:i}=t,{shape:s}=r,{sliceRank:a,numUpdates:l,sliceSize:c,strides:u,outputSize:d}=T.calculateShapes(i,o,s),p=[d/c,c];if(d===0)return e.makeTensorInfo(s,o.dtype);let f=$e({inputs:{x:o},backend:e,attrs:{shape:[l,a]}}),h=$e({inputs:{x:i},backend:e,attrs:{shape:[l,c]}}),m=h.dtype,g=dr({backend:e,attrs:{shape:p,value:0,dtype:m}}),y=b.sizeFromShape(h.shape),v=[{type:"int32",data:[a]},{type:"int32",data:u},{type:"int32",data:[y]}],w=new Mu(h.shape,a,f.shape.length,h.shape.length,u,p,m),C=e.runWebGPUProgram(w,[h,f],m,v,g),I=$e({inputs:{x:C},backend:e,attrs:{shape:s}});return e.disposeData(f.dataId),e.disposeData(h.dataId),e.disposeData(C.dataId),I}var oce={kernelName:df,backendName:"webgpu",kernelFunc:Mje};var MN=class{constructor(t,e){this.outputShape=[],this.variableNames=["sortedSequence","values"],this.uniforms="numInputs : i32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=t,this.dispatchLayout=xe(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.side=e,this.shaderKey=`search_sorted_${e}`}getUserCode(){return`
      fn findBound(batch: i32, value: f32) -> i32 {
        var left = i32(0);
        var right = uniforms.numInputs;
        while (left < right) {
          var mid = (left + right) / 2;
          if (getSortedSequence(batch, mid) ${this.side==="left"?"<":"<="} value) {
            left = mid + 1;
          } else {
            right = mid;
          }
        }
        return right;
      }

      ${de("index")} {
        if (index < uniforms.size) {
          let coords = getCoordsFromIndex(index);
          let value = getValuesByOutputIndex(index);
          setOutputAtIndexI32(index, findBound(coords[0], value));
        }
      }
    `}};function Pje(n){let{inputs:t,backend:e,attrs:r}=n,{sortedSequence:o,values:i}=t,{side:s}=r,a=new MN([i.shape[0],i.shape[1]],s),l=[{type:"int32",data:[o.shape[1]]}];return e.runWebGPUProgram(a,[o,i],"int32",l)}var ice={kernelName:ff,backendName:"webgpu",kernelFunc:Pje};var PN=class{constructor(t,e,r){this.variableNames=["c","a","b"],this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=xe(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.cRank=t,this.rank=r,this.shaderKey="select"}getUserCode(){let t,e;if(this.rank>4)throw Error(`Where for rank ${this.rank} is not yet supported`);if(this.rank===1)e="resRC",t="resRC";else{let o=["resRC.x","resRC.y","resRC.z","resRC.w"],i=[],s=[];for(let a=0;a<this.outputShape.length;a++)s.push(`${o[a]}`),a<this.cRank&&i.push(`${o[a]}`);t=i.join(),e=s.join()}return`
      ${de("index")} {
        if (index < uniforms.size) {
          let resRC = getCoordsFromIndex(index);
          let cVal = getC(${t});
          if (cVal >= 1.0) {
            setOutputAtIndex(index, getA(${e}));
          } else {
            setOutputAtIndex(index, getB(${e}));
          }
        }
      }
    `}};function Fje(n){let{inputs:t,backend:e}=n,{condition:r,t:o,e:i}=t,s=new PN(r.shape.length,o.shape,o.shape.length);return e.runWebGPUProgram(s,[r,o,i],En(o.dtype,i.dtype))}var sce={kernelName:iu,backendName:"webgpu",kernelFunc:Fje};var Lje=Qe({opType:Ce.SELU}),ace={kernelName:fl,backendName:"webgpu",kernelFunc:Lje};var $je=Qe({opType:Ce.SIGMOID}),lce={kernelName:yl,backendName:"webgpu",kernelFunc:$je};var Vje=Qe({opType:Ce.SIGN}),cce={kernelName:gl,backendName:"webgpu",kernelFunc:Vje};var Bje=Qe({opType:Ce.SIN}),uce={kernelName:hl,backendName:"webgpu",kernelFunc:Bje};var zje=Qe({opType:Ce.SINH}),dce={kernelName:ml,backendName:"webgpu",kernelFunc:zje};var Uje=Qe({opType:Ce.SOFTPLUS}),pce={kernelName:xl,backendName:"webgpu",kernelFunc:Uje};var FN=class{constructor(t,e,r,o,i,s){this.variableNames=["x"],this.outputShape=[],this.uniforms="",this.workgroupSize=[64,1,1],this.size=!0;let a=new Array(o.length);for(let l=0;l<a.length;l++)a[l]=o[i[l]];this.outputShape=a,this.newDim=i,this.dispatchLayout=xe(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.xShape=t,this.paddedXShape=e,this.uniforms+=`reshapedPaddedXShape : ${zn(o.length)}, paddedXShapeStrides : ${zn(s)}, `,r.map((l,c)=>{this.uniforms+=` pad${c} : vec2<i32>,`}),this.shaderKey=`spaceToBatchND_${i}`}getUserCode(){let t=zn(this.outputShape.length),e=_3(this.newDim);return`
      ${Tw(this.paddedXShape,"PaddedX")}
      ${de("index")} {
        if(index < uniforms.size) {
          let coords = getCoordsFromIndex(index);
          let switchedIndex = getIndexFromCoords${this.outputShape.length}D(${t}(${e}), uniforms.reshapedPaddedXShape);
          let paddedCoords = getPaddedXCoordsFromIndex(switchedIndex);
          ${P3(this.xShape,!0)}
        }
      }
    `}};var Wje=n=>{let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{blockShape:i,paddings:s}=r;b.assert(o.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGPU backend not implemented yet");let a=i.reduce((v,w)=>v*w),l=[[0,0]];l.push(...s);for(let v=1+i.length;v<o.shape.length;++v)l.push([0,0]);let c=l.map((v,w)=>v[0]+o.shape[w]+v[1]),u=T.getReshaped(c,i,a,!1),d=T.getPermuted(u.length,i.length,!1),p=T.getReshapedPermuted(c,i,a,!1),f=b.computeStrides(c),h=new FN(o.shape,c,l,u,d,f.length),m=[{type:"int32",data:u},{type:"int32",data:f}];l.map(v=>m.push({type:"int32",data:[v[0],v[1]]}));let g=e.runWebGPUProgram(h,[o],o.dtype,m),y=$e({inputs:{x:g},backend:e,attrs:{shape:p}});return e.disposeData(g.dataId),y},fce={kernelName:lu,backendName:"webgpu",kernelFunc:Wje};var LN=class{constructor(t,e,r){this.variableNames=["input","indices","segmentIds"],this.outputShape=[],this.uniforms="segmentSize : i32, sparseSize : i32,",this.workgroupSize=[64,1,1],this.atomic=!0,this.outputShape=t,this.type=r,this.dispatchLayout=xe([e]),this.dispatch=pe(this.dispatchLayout,[e],this.workgroupSize),this.shaderKey="sparseSegmentSum"}getUserCode(){return`
    ${de("index")} {
      if (index < uniforms.sparseSize) {
        let indexInSegmentIds = index / uniforms.segmentSize;
        let indexInSegment = index % uniforms.segmentSize;
        let indexInInput = indices[indexInSegmentIds];
        let segmentId = segmentIds[indexInSegmentIds];

        let value = input[indexInInput * uniforms.segmentSize + indexInSegment];
        let outIndex = segmentId * uniforms.segmentSize + indexInSegment;
        ${es("&result[outIndex]","value",this.type)}
      }
    }
  `}},$N=class{constructor(t,e){this.variableNames=["segmentIds"],this.outputShape=[],this.workgroupSize=[64,1,1],this.atomic=!0,this.outputShape=[t],this.dispatchLayout=xe(e),this.dispatch=pe(this.dispatchLayout,e,this.workgroupSize),this.shaderKey="sparseSegmentIdCountProgram"}getUserCode(){return`
    ${de("index")} {
      if (index < uniforms.segmentIdsShape) {
        let segmentId = segmentIds[index];
        ${es("&result[segmentId]","1","int32")}
      }
    }
  `}},VN=class{constructor(t,e){this.variableNames=["segmentSum","sameSegmentIdCount"],this.outputShape=[],this.uniforms="segmentSize : i32",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=t,this.type=e,this.dispatchLayout=xe(t),this.dispatch=pe(this.dispatchLayout,t,this.workgroupSize),this.shaderKey="sparseSegmentMean"}getUserCode(){return`
    ${de("index")} {
      if (index < uniforms.size) {
        let segmentId = index / uniforms.segmentSize;
        let count = sameSegmentIdCount[segmentId];
        if (count != 0) {
          ${this.type==="float32"?"setOutputAtIndex(index, segmentSum[index] / f32(count));":"setOutputAtIndexI32(index, segmentSum[index] / count);"}
        }
      }
    }
  `}};function BN(n,t,e,r=!1,o){let s=b.sizeFromShape(n.shape)/n.shape[0],a=n.dtype,l=b.sizeFromShape(t.shape),c=o.readSync(e.dataId),d=l>0?c[l-1]+1:0,p,f=n.shape.slice();f[0]=d;let h=l*s,m=dr({backend:o,attrs:{shape:f,value:0,dtype:a}});p=new LN(f,h,a);let g=[{type:"int32",data:[s]},{type:"int32",data:[h]}],y=o.runWebGPUProgram(p,[n,t,e],a,g,m);if(r)return y;let v=dr({backend:o,attrs:{shape:[d],value:0,dtype:"int32"}});p=new $N(d,e.shape);let w=o.runWebGPUProgram(p,[e],"int32",null,v),C=dr({backend:o,attrs:{shape:f,value:0,dtype:a}});p=new VN(f,a),g=[{type:"int32",data:[s]}];let I=o.runWebGPUProgram(p,[y,w],a,g,C);return o.disposeData(y.dataId),o.disposeData(w.dataId),I}function Gje(n){let{inputs:t,backend:e}=n,{data:r,indices:o,segmentIds:i}=t;return BN(r,o,i,!1,e)}var hce={kernelName:hf,backendName:"webgpu",kernelFunc:Gje};function jje(n){let{inputs:t,backend:e}=n,{data:r,indices:o,segmentIds:i}=t;return BN(r,o,i,!0,e)}var mce={kernelName:mf,backendName:"webgpu",kernelFunc:jje};var zN=class{constructor(t,e){this.variableNames=["A"],this.workgroupSize=[64,1,1],this.size=!0;let r=new Array(t.length);for(let o=0;o<r.length;o++)r[o]=t[o]*e[o];this.outputShape=r,this.dispatchLayout=xe(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.rank=this.outputShape.length,this.shaderKey="tile"}getUserCode(){let t=Hje(this.rank,"uniforms.");return`
      ${de("index")} {
        if (index < uniforms.size) {
          let resRC = getCoordsFromIndex(index);
          setOutputAtIndex(index, getA(${t}));
        }
      }
    `}};function Hje(n,t=""){if(n>=5)throw Error(`Tile for rank ${n} is not yet supported`);if(n===1)return`(resRC % ${t}aShape)`;let e=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[];for(let o=0;o<n;o++)r.push(`(${e[o]} % ${t}aShape[${o}])`);return r.join()}function Lw(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{reps:i}=r;if(e.shouldExecuteOnCPU([o])||o.dtype==="string"||o.shape.length>=5){let l=e.readSync(o.dataId),c=o.dtype==="string"?l.map(p=>b.decodeString(p)):l,u=ze(o.shape,o.dtype,c),d=kse(u,i);return e.makeTensorInfo(d.shape,d.dtype,d.values)}let s=new zN(o.shape,i);return e.runWebGPUProgram(s,[o],o.dtype)}var gce={kernelName:Bs,backendName:"webgpu",kernelFunc:Lw};function qje(n){let{inputs:t,backend:e,attrs:r}=n,{sparseIndices:o,sparseValues:i,defaultValue:s}=t,{outputShape:a}=r,{sliceRank:l,numUpdates:c,sliceSize:u,strides:d,outputSize:p}=T.calculateShapes(i,o,a),f=!1;if(i.dtype==="string"){let $=e.bufferSync(o),V=e.bufferSync(i),W=b.decodeString(e.readSync(s.dataId)[0]),K=_se($,V,a,p,u,c,l,d,W,f);return e.makeTensorInfo(a,K.dtype,K.values)}let h=[p/u,u],m=$e({inputs:{x:o},backend:e,attrs:{shape:[c,l]}}),g=i.shape.length?$e({inputs:{x:i},backend:e,attrs:{shape:[c,u]}}):Sr({inputs:{x:i},backend:e}),y=g.dtype,v=e.makeTensorInfo([],y,b.makeZerosTypedArray(1,y)),w=$e({inputs:{x:s},backend:e,attrs:{shape:Array(h.length).fill(1)}}),C=Lw({inputs:{x:w},backend:e,attrs:{reps:h}}),I=b.sizeFromShape([c,u]),A=[{type:"int32",data:[l]},{type:"int32",data:d},{type:"int32",data:[I]}];switch(c){case 0:break;case 1:{let $=new Mu([c,u],l,m.shape.length,g.shape.length,d,h,y,f);e.runWebGPUProgram($,[g,m],y,A,C)}break;default:{let $=new Mu([c,u],l,m.shape.length,v.shape.length,d,h,y,f);e.runWebGPUProgram($,[v,m],y,A,C)}{let $=new Mu([c,u],l,m.shape.length,g.shape.length,d,h,y);e.runWebGPUProgram($,[g,m],y,A,C)}}let M=$e({inputs:{x:C},backend:e,attrs:{shape:a}});return e.disposeData(m.dataId),e.disposeData(g.dataId),e.disposeData(w.dataId),e.disposeData(v.dataId),e.disposeData(C.dataId),M}var yce={kernelName:gf,backendName:"webgpu",kernelFunc:qje};function Kje(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{numOrSizeSplits:i,axis:s}=r,a=b.parseAxisParam(s,o.shape)[0],l=T.prepareSplitSize(o,i,a),c=o.shape.length,u=new Array(c).fill(0),d=o.shape.slice();return l.map(p=>{let f=[...d];f[a]=p;let h=jl({inputs:{x:o},backend:e,attrs:{begin:u,size:f}});return u[a]+=p,h})}var xce={kernelName:cu,backendName:"webgpu",kernelFunc:Kje};var Xje=Qe({opType:Ce.SQRT}),vce={kernelName:vl,backendName:"webgpu",kernelFunc:Xje};var bce={kernelName:yf,backendName:"webgpu",kernelFunc:({inputs:n,backend:t})=>{let{x:e}=n,r=t,o=new ns(e.shape,Ce.SQUARE);return r.runWebGPUProgram(o,[e],e.dtype)}};var Yje=rn({opType:Xe.SQUARED_DIFFERENCE}),wce={kernelName:bl,backendName:"webgpu",kernelFunc:Yje};function Zje({inputs:n,attrs:t,backend:e}){let{x:r}=n,o=new ns(r.shape,Ce.STEP,"stepAlpha : f32,"),i=[{type:"float32",data:[t.alpha]}];return e.runWebGPUProgram(o,[r],r.dtype,i)}var Cce={kernelName:Sl,backendName:"webgpu",kernelFunc:Zje};var UN=class{constructor(t){this.variableNames=["x"],this.workPerThread=1,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=t,this.dispatchLayout=xe(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize,[this.workPerThread,1,1]);let e=zn(this.outputShape.length);this.uniforms=`begin : ${e},  strides : ${e}, `,this.shaderKey="stridedSlice"}getUserCode(){let t=this.outputShape.length,e="";if(t===1)e="coords * uniforms.strides + uniforms.begin";else{let o=0;e=this.outputShape.map((i,s)=>(o++,this.outputShape.length===1?`coords * uniforms.strides[${s}] + uniforms.begin[${s}]`:`coords[${o-1}] * uniforms.strides[${s}] + uniforms.begin[${s}]`)).join(",")}return`
       ${de("index")} {
         if (index < uniforms.size) {
           let coords = getCoordsFromIndex(index);
           setOutputAtIndex(index, getX(${e}));
         }
       }
     `}};function Qje(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{begin:i,end:s,strides:a,beginMask:l,endMask:c,ellipsisMask:u,newAxisMask:d,shrinkAxisMask:p}=r,{finalShapeSparse:f,finalShape:h,isIdentity:m,sliceDim0:g,isSimpleSlice:y,begin:v,end:w,strides:C}=yr.sliceInfo(o.shape,i,s,a,l,c,u,d,p),I;if(m)I=$e({inputs:{x:o},backend:e,attrs:{shape:h}});else if(g||y){b.assert(o.shape.length>=1,()=>`Input must have rank at least 1, got: ${o.shape.length}`);let A=yr.computeOutShape(v,w,C),M=jl({inputs:{x:o},backend:e,attrs:{begin:v,size:A}});I=$e({inputs:{x:M},backend:e,attrs:{shape:h}}),e.disposeData(M.dataId)}else if(e.shouldExecuteOnCPU([o])){let M=e.readSync(o.dataId),$=ze(o.shape,o.dtype,M),V=Ese(f,$,C,v);I=e.makeTensorInfo(h,o.dtype,V.values)}else{let M=new UN(f),$=[{type:"int32",data:v},{type:"int32",data:C}],V=e.runWebGPUProgram(M,[o],o.dtype,$);I=$e({inputs:{x:V},backend:e,attrs:{shape:h}}),e.disposeData(V.dataId)}return I}var _ce={kernelName:xf,backendName:"webgpu",kernelFunc:Qje};function Jje(n){let{inputs:t,backend:e,attrs:r}=n,{separator:o,nGramWidths:i,leftPad:s,rightPad:a,padWidth:l,preserveShortSequences:c}=r,{data:u,dataSplits:d}=t,p=e.readSync(u.dataId),f=e.readSync(d.dataId),[h,m]=Tse(p,f,o,i,s,a,l,c);return[e.makeTensorInfo([h.length],"string",h),e.makeTensorInfo(d.shape,"int32",m)]}var Sce={kernelName:vf,backendName:"webgpu",kernelFunc:Jje};var eHe=rn({opType:Xe.SUB,cpuKernelImpl:Dse,supportsComplex:!0}),Ice={kernelName:wl,backendName:"webgpu",kernelFunc:eHe};var tHe=Qe({opType:Ce.TAN}),Ece={kernelName:Cl,backendName:"webgpu",kernelFunc:tHe};var nHe=Qe({opType:Ce.TANH}),Tce={kernelName:_l,backendName:"webgpu",kernelFunc:nHe};function rHe(n){let{inputs:t,backend:e,attrs:r}=n,{tensor:o,indices:i,updates:s}=t,{}=r,{sliceRank:a,numUpdates:l,sliceSize:c,strides:u,outputSize:d}=T.calculateShapes(s,i,o.shape),p=[d/c,c];if(d===0)return e.makeTensorInfo(o.shape,i.dtype);let f=[],h=$e({inputs:{x:i},backend:e,attrs:{shape:[l,a]}});f.push(h);let m=$e({inputs:{x:s},backend:e,attrs:{shape:[l,c]}});f.push(m);let g=$e({inputs:{x:o},backend:e,attrs:{shape:p}});f.push(g);let y=Lw({inputs:{x:g},backend:e,attrs:{reps:Array(p.length).fill(1)}}),v=new Mu([l,c],a,h.shape.length,m.shape.length,u,p,o.dtype,!1),w=b.sizeFromShape([l,c]),C=[{type:"int32",data:[a]},{type:"int32",data:u},{type:"int32",data:[w]}],I=e.runWebGPUProgram(v,[m,h],g.dtype,C,y);f.push(I);let A=$e({inputs:{x:I},backend:e,attrs:{shape:o.shape}});return f.forEach(M=>e.disposeData(M.dataId)),A}var Dce={kernelName:pf,backendName:"webgpu",kernelFunc:rHe};var WN=class{constructor(t){this.variableNames=["x","indices"],this.workgroupSize=[256,1,1],this.size=!0,this.outputShape=t,this.dispatchLayout=xe(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.uniforms=`inputSize : i32, firstPass : i32, negativeInf : f32,
        dir : i32, inc : i32,`,this.shaderKey="swap"}getUserCode(){return`
        ${de("index")} {
          if (index < uniforms.size) {
            let outC = getCoordsFromIndex(index);
            let batch = outC[0];
            let elemIdx = outC[1];
            // We compare elements pair-wise within a group of size 2 * inc.
            // The comparing rule for each group alternates between ascending
            // and descending. Within each group, we compare each pair at
            // positions i and i+inc. To decide whether an element at position i
            // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
            // inc, it is in the first half of the group, we denote it as x0,
            // otherwise we denote it as x1.
            // For example, as shown in the Bitonic top K paper referenced
            // above, Figure5(a) shows that element[1] is in the second half of
            // the group when group size is 2, but it is in the first half of
            // the group when group size is 4.
            let isFirstInPair = elemIdx % (2 * uniforms.inc) < uniforms.inc;
            var i = 0;
            if (isFirstInPair) {
              i = elemIdx;
            } else {
              i = elemIdx - uniforms.inc;
            }

            var i0 = 0;
            if (uniforms.firstPass == 1) {
              i0 = i;
            } else {
              i0 = i32(getIndices(batch, i));
            }

            var i1 = 0;
            if (uniforms.firstPass == 1) {
              i1 = i + uniforms.inc;
            } else {
              i1 = i32(getIndices(batch, i + uniforms.inc));
            }

            var x0 = f32(0.0);
            var x1 = f32(0.0);
            if (i0 < uniforms.inputSize) {
              x0 = getX(batch, i0);
            } else {
              x0 = uniforms.negativeInf;
            }
            if (i1 < uniforms.inputSize) {
              x1 = getX(batch, i1);
            } else {
              x1 = uniforms.negativeInf;
            }

            let reverse = elemIdx % (2 * uniforms.dir) >= uniforms.dir;
            let isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
            if (reverse == isGreater) {
              // Elements in opposite order of direction
              let iTemp = i0;
              i0 = i1;
              i1 = iTemp;
            }
            if (isFirstInPair) {
              setOutputAtIndex(index, f32(i0));
            } else {
              setOutputAtIndex(index, f32(i1));
            }
          }
        }
      `}},GN=class{constructor(t){this.variableNames=["x","indices"],this.workgroupSize=[256,1,1],this.size=!0,this.outputShape=t,this.dispatchLayout=xe(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.uniforms="inputSize : i32, firstPass : i32, k : i32,",this.shaderKey="merge"}getUserCode(){return`
        ${de("index")} {
          if (index < uniforms.size) {
            let outC = getCoordsFromIndex(index);
            let batch = outC[0];
            let elemIdx = outC[1];
            // The output size is half of the previous size.
            // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _
            // (k=4), we only need to output the indices at positions |, the
            // indices at positions _ can be thrown away, see Figure5(b) After
            // Phase 2 (Merge phase) in the Bitonic Top K paper referenced
            // above.
            // For example, the paper shows we only need to output the orange
            // bars. The output sequence should look like this | | | | | | | |.
            // Because the sequence is halved, to map the output index back to
            // the previous sequence to find the corresponding value, we need
            // to double the index. When we double the index, we basically
            // interpolate a position, so 2i looks like
            // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k
            // position of each 2k positions by - elemIdx % k. E.g. for output
            // at index 4,5,6,7, we want to get the corresponding element at
            // original index 8,9,10,11, for output at index 8,9,10,11,
            // we want to get the corresponding element at original index
            // 16,17,18,19, so on and so forth.

            var i = 0;
            if (elemIdx < uniforms.k) {
              i = elemIdx;
            } else {
              i = elemIdx * 2 - elemIdx % uniforms.k;
            }
            var i0 = 0;
            if (uniforms.firstPass == 1) {
              i0 = i;
            } else {
              i0 = i32(getIndices(batch, i));
            }
            var i1 = 0;
            if (uniforms.firstPass == 1) {
              i1 = i + uniforms.k;
            } else {
              i1 = i32(getIndices(batch, i + uniforms.k));
            }

            let x0 = getX(batch, i0);
            var x1 = f32(0.0);
            if (i1 < uniforms.inputSize) {
              x1 = getX(batch, i1);
            } else {
              x1 = x0;
            }

            if (x0 >= x1) {
              setOutputAtIndex(index, f32(i0));
            } else {
              setOutputAtIndex(index, f32(i1));
            }
          }
        }
      `}};function Sv(n,t){t!==null&&n.disposeData(t.dataId)}function kce(n){let t=1;for(;t<n;)t*=2;return t}function oHe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o}=t,{k:i,sorted:s}=r,a=o.shape,l=a[a.length-1];if(e.shouldExecuteOnCPU([o])){let I=e.readSync(o.dataId),[A,M]=Nse(I,a,o.dtype,i,s);return[e.makeTensorInfo(A.shape,A.dtype,A.values),e.makeTensorInfo(M.shape,M.dtype,M.values)]}if(i===0)return a[a.length-1]=0,[e.makeTensorInfo(a,o.dtype,[]),e.makeTensorInfo(a,"int32",[])];if(l===1)return[o,dr({attrs:{shape:a,dtype:"int32",value:0},backend:e})];let u=b.sizeFromShape(a)/l,d=$e({inputs:{x:o},attrs:{shape:[u,l]},backend:e}),p=kce(i),f=kce(l),h=null,m=()=>h===null?[d,d]:[d,h],g=(I,A,M)=>{let $=m(),V=new WN(M),K=[{type:"int32",data:[l]},{type:"int32",data:[h===null?1:0]},{type:"float32",data:[Number.NEGATIVE_INFINITY]},{type:"int32",data:[I]},{type:"int32",data:[A]}],te=h;h=e.runWebGPUProgram(V,$,"int32",K),Sv(e,te)};for(let I=1;I<p;I*=2){let A=I*2;for(let M=I;M>=1;M/=2)g(A,M,[u,f])}for(let I=f;I>p;I/=2){let A=m(),M=new GN([u,I/2]),V=[{type:"int32",data:[l]},{type:"int32",data:[h===null?1:0]},{type:"int32",data:[p]}],W=h;h=e.runWebGPUProgram(M,A,"int32",V),Sv(e,W);let K=p/2,te=K*2;for(let ee=K;ee>=1;ee/=2)g(te,ee,h.shape)}let y=h;h=jl({inputs:{x:h},backend:e,attrs:{begin:0,size:[u,i]}}),Sv(e,y);let v=O3({inputs:{x:d,indices:h},backend:e,attrs:{axis:1,batchDims:1}});Sv(e,d);let w=a.slice(0,-1);w.push(i),y=h,h=$e({inputs:{x:h},attrs:{shape:w},backend:e}),Sv(e,y);let C=v;return v=$e({inputs:{x:v},attrs:{shape:w},backend:e}),Sv(e,C),[v,h]}var Nce={kernelName:bf,backendName:"webgpu",kernelFunc:oHe};var jN=class{constructor(t){this.variableNames=["Image","Transforms"],this.uniforms="interpolationModeId : i32, fillModeId : i32, fillValue : f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=t,this.dispatchLayout=xe(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="transform"}getUserCode(){return`
          fn mapCoord(outCoord : f32, len : f32) -> f32{
            var inCoord = outCoord;
            if(uniforms.fillModeId == 2) {
              if (inCoord < 0.0) {
                if (len <= 1.0) {
                  inCoord = 0.0;
                } else {
                  let sz2 = 2.0 * len;
                  if (inCoord < sz2) {
                    inCoord = sz2 * f32(i32(f32(-inCoord / sz2))) +
                    inCoord;
                  }
                  if (inCoord < -len) {
                    inCoord = inCoord + sz2;
                  } else {
                    inCoord = -inCoord - 1.0;
                  }
                }
              } else if (inCoord > len - 1.0) {
                if (len <= 1.0) {
                  inCoord = 0.0;
                } else {
                  let sz2 = 2.0 * len;
                  inCoord = inCoord - sz2 * f32(i32(f32(inCoord / sz2)));
                  if (inCoord >= len) {
                    inCoord = sz2 - inCoord - 1.0;
                  }
                }
              }
              return clamp(inCoord, 0.0, len - 1.0);
            } else if (uniforms.fillModeId == 3) {
              if (inCoord < 0.0) {
                if (len <= 1.0) {
                  inCoord = 0.0;
                } else {
                  let sz = len - 1.0;
                  inCoord = inCoord + len * (f32(i32(f32(-inCoord / sz))) + 1.0);
                }
              } else if (inCoord > len - 1.0) {
                if (len <= 1.0) {
                  inCoord = 0.0;
                } else {
                  let sz = len - 1.0;
                  inCoord = inCoord - len * f32(i32(f32(inCoord / sz)));
                }
              }
              return clamp(inCoord, 0.0, len - 1.0);
            } else if (uniforms.fillModeId == 4) {
              return clamp(outCoord, 0.0, len - 1.0);
            }
            return outCoord;
          }
          fn readWithFillValue(batch : i32, coordY : i32, coordX : i32,
            channel : i32) -> f32 {
            var outputValue : f32;
            if (0 <= coordY && coordY < uniforms.imageShape[1] && 0 <= coordX && coordX < uniforms.imageShape[2]) {
                outputValue = getImage(batch, coordY, coordX, channel);
            } else {
              outputValue = uniforms.fillValue;
            }
            return outputValue;
          }

          ${de("index")} {
            if (index < uniforms.size) {
              let coords = getCoordsFromIndex(index);
              var outputValue : f32;
              let batch = coords[0];
              let x = coords[2];
              let y = coords[1];
              let channel = coords[3];
              let xf = f32(x);
              let yf = f32(y);
              let a1 = getTransforms(batch, 0);
              let a2 = getTransforms(batch, 1);
              let a3 = getTransforms(batch, 2);
              let b1 = getTransforms(batch, 3);
              let b2 = getTransforms(batch, 4);
              let b3 = getTransforms(batch, 5);
              let c1 = getTransforms(batch, 6);
              let c2 = getTransforms(batch, 7);
              let projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = uniforms.fillValue;
              } else {
                let inX = (a1 * xf + a2 * yf + a3) / projection;
                let inY = (b1 * xf + b2 * yf + b3) / projection;
                let mapX = mapCoord(inX, f32(uniforms.imageShape[2]));
                let mapY = mapCoord(inY, f32(uniforms.imageShape[1]));

                if (uniforms.interpolationModeId == 1) {
                  let coordY = i32(round(mapY));
                  let coordX = i32(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  let yFloor = floor(mapY);
                  let xFloor = floor(mapX);
                  let yCeil = yFloor + 1.0;
                  let xCeil = xFloor + 1.0;
                  let valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, i32(yFloor), i32(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, i32(yFloor), i32(xCeil), channel);
                  let valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, i32(yCeil), i32(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, i32(yCeil), i32(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutputAtIndex(index, outputValue);
            }
          }
        `}};function iHe(n){let{inputs:t,backend:e,attrs:r}=n,{image:o,transforms:i}=t,{interpolation:s,fillMode:a,fillValue:l,outputShape:c}=r,[u,d,p,f]=o.shape,[h,m]=c??[d,p],g=[u,h,m,f],y=new jN(g),v=s==="nearest"?1:2,w;switch(a){case"constant":w=1;break;case"reflect":w=2;break;case"wrap":w=3;break;case"nearest":w=4;break;default:w=1;break}let C=[{type:"int32",data:[v]},{type:"int32",data:[w]},{type:"float32",data:[l]}];return e.runWebGPUProgram(y,[o,i],"float32",C)}var Ace={kernelName:wf,backendName:"webgpu",kernelFunc:iHe};function sHe(n){let{inputs:t,backend:e,attrs:r}=n,{value:o}=t,{axis:i}=r;i<0&&(i+=o.shape.length);let s=o,a=s.shape.length,l=o.shape[i],c=new Array(a-1),u=0;for(let m=0;m<a;m++)m!==i&&(c[u++]=s.shape[m]);let d=[],p=new Array(a).fill(0),f=s.shape.slice();f[i]=1;let h=new Array(l);for(let m=0;m<h.length;m++){p[i]=m;let g=jl({inputs:{x:s},backend:e,attrs:{begin:p,size:f}}),y=$e({inputs:{x:g},backend:e,attrs:{shape:c}});h[m]=y,d.push(g)}return d.forEach(m=>e.disposeData(m.dataId)),h}var Rce={kernelName:du,backendName:"webgpu",kernelFunc:sHe};var HN=class{constructor(t,e,r){if(this.outputShape=[],this.variableNames=["x","segmentIds"],this.uniforms="numSegments : i32, xSize: i32,",this.workgroupSize=[64,1,1],this.atomic=!0,this.outputShape=e,this.dispatchLayout=xe(t),this.dispatch=pe(this.dispatchLayout,t,this.workgroupSize),r!=="float32"&&r!=="int32")throw new Error(`UnsortedSegmentSum only supports float32 and int32
              types, does not support ${r} type.`);this.type=r,this.shaderKey="unsortedSegmentSum"}getUserCode(){return`
    ${de("index")} {
      if (index < uniforms.xSize) {
        let coords = getXCoordsFromIndex(index);
        let b = coords[0];
        let inCol = coords[1];

        let segmentId = i32(getSegmentIds(inCol));
        if (segmentId >= 0) {
          let flatIndex = b * uniforms.numSegments + segmentId % uniforms.numSegments;
          let value = getX(b, inCol);

          ${es("&result[flatIndex]","value",this.type)}
        }
      }
    }
  `}};function aHe(n){let{inputs:t,backend:e,attrs:r}=n,{x:o,segmentIds:i}=t,{numSegments:s}=r,a=o.shape.length,l=[],c=0,u=T.getAxesPermutation([c],a),d=o;u!=null&&(d=Bo({inputs:{x:o},backend:e,attrs:{perm:u}}),l.push(d),c=T.getInnerMostAxes(1,a)[0]);let p=T.segment_util.computeOutShape(d.shape,c,s),f=b.sizeFromShape([d.shape[c]]),h=$e({inputs:{x:d},backend:e,attrs:{shape:[-1,f]}});l.push(h);let m=o.dtype,g=[h.shape[0],s],y=dr({backend:e,attrs:{shape:g,value:0,dtype:m}}),v=new HN(h.shape,g,m),w=[{type:"int32",data:[s]},{type:"int32",data:[b.sizeFromShape(h.shape)]}],C=e.runWebGPUProgram(v,[h,i],m,w,y),I=$e({inputs:{x:C},backend:e,attrs:{shape:p}});l.push(C);let A=I;if(u!=null){l.push(I);let M=T.getUndoAxesPermutation(u);A=Bo({inputs:{x:A},backend:e,attrs:{perm:M}})}return l.forEach(M=>e.disposeData(M.dataId)),A}var Oce={kernelName:pu,backendName:"webgpu",kernelFunc:aHe};var lHe=[Xie,Rse,Ose,Mse,Pse,Fse,$se,Vse,Bse,zse,Use,Wse,Gse,jse,Hse,Xse,Yse,Zse,Qse,Jse,tae,nae,rae,aae,lae,cae,Zie,dae,fae,hae,mae,gae,yae,xae,vae,bae,wae,Cae,Iae,Eae,Tae,Dae,Nae,Aae,kae,Rae,Oae,Mae,Pae,Fae,Vae,Bae,zae,Uae,Wae,Gae,jae,Hae,qae,qie,Kae,Zae,Xae,Yae,Qae,Jae,ele,tle,nle,rle,ole,Yie,ile,pae,sle,ale,lle,cle,ule,dle,ple,hle,fle,mle,gle,yle,vle,ble,qse,wle,Cle,Ile,_le,Sle,Ele,Kse,Tle,Dle,kle,Nle,Rle,Lae,Ole,Mle,Ple,oae,Fle,Vle,Ble,zle,Ule,Wle,Gle,jle,iae,Hle,qle,Kle,Xle,Kie,Yle,Zle,Qle,Jle,ece,tce,nce,rce,oce,ice,sce,ace,lce,cce,uce,dce,eae,Cce,_ce,Sce,Ale,pce,fce,hce,mce,yce,xce,vce,bce,wce,Ice,$ae,Ece,Tce,Dce,gce,Nce,Ace,Lse,Rce,Oce,Lle];for(let n of lHe)Vy(n);var due=function(n,t){return(due=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])})(n,t)};function pue(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=n}due(n,t),n.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var Zn=function(){return(Zn=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++)for(var o in t=arguments[e])Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o]);return n}).apply(this,arguments)};function dn(n,t,e,r){return new(e||(e=Promise))(function(o,i){function s(c){try{l(r.next(c))}catch(u){i(u)}}function a(c){try{l(r.throw(c))}catch(u){i(u)}}function l(c){var u;c.done?o(c.value):(u=c.value,u instanceof e?u:new e(function(d){d(u)})).then(s,a)}l((r=r.apply(n,t||[])).next())})}function pn(n,t){var e,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function a(l){return function(c){return function(u){if(e)throw new TypeError("Generator is already executing.");for(;s;)try{if(e=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return s.label++,{value:u[1],done:!1};case 5:s.label++,r=u[1],u=[0];continue;case 7:u=s.ops.pop(),s.trys.pop();continue;default:if(o=s.trys,!((o=o.length>0&&o[o.length-1])||u[0]!==6&&u[0]!==2)){s=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){s.label=u[1];break}if(u[0]===6&&s.label<o[1]){s.label=o[1],o=u;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(u);break}o[2]&&s.ops.pop(),s.trys.pop();continue}u=t.call(n,s)}catch(d){u=[6,d],r=0}finally{e=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([l,c])}}}function Qm(n,t,e){if(e||arguments.length===2)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return n.concat(r||Array.prototype.slice.call(t))}var Pu=["nose","left_eye","right_eye","left_ear","right_ear","left_shoulder","right_shoulder","left_elbow","right_elbow","left_wrist","right_wrist","left_hip","right_hip","left_knee","right_knee","left_ankle","right_ankle"],Vw=["nose","left_eye_inner","left_eye","left_eye_outer","right_eye_inner","right_eye","right_eye_outer","left_ear","right_ear","mouth_left","mouth_right","left_shoulder","right_shoulder","left_elbow","right_elbow","left_wrist","right_wrist","left_pinky","right_pinky","left_index","right_index","left_thumb","right_thumb","left_hip","right_hip","left_knee","right_knee","left_ankle","right_ankle","left_heel","right_heel","left_foot_index","right_foot_index"],cHe={left:[1,2,3,7,9,11,13,15,17,19,21,23,25,27,29,31],right:[4,5,6,8,10,12,14,16,18,20,22,24,26,28,30,32],middle:[0]},uHe={left:[1,3,5,7,9,11,13,15],right:[2,4,6,8,10,12,14,16],middle:[0]},dHe=[[0,1],[0,2],[1,3],[2,4],[5,6],[5,7],[5,11],[6,8],[6,12],[7,9],[8,10],[11,12],[11,13],[12,14],[13,15],[14,16]],pHe=[[0,1],[0,4],[1,2],[2,3],[3,7],[4,5],[5,6],[6,8],[9,10],[11,12],[11,13],[11,23],[12,14],[14,16],[12,24],[13,15],[15,17],[16,18],[16,20],[15,17],[15,19],[15,21],[16,22],[17,19],[18,20],[23,25],[23,24],[24,26],[25,27],[26,28],[27,29],[28,30],[27,31],[28,32],[29,31],[30,32]];function qN(n){return n instanceof SVGAnimatedLength?n.baseVal.value:n}function fue(n){return dn(this,void 0,void 0,function(){var t,e;return pn(this,function(r){switch(r.label){case 0:return t=document.createElement("canvas"),n instanceof bt?[4,Ld.toPixels(n,t)]:[3,2];case 1:return r.sent(),[3,3];case 2:t.width=qN(n.width),t.height=qN(n.height),e=t.getContext("2d"),n instanceof ImageData?e.putImageData(n,0,0):e.drawImage(n,0,0),r.label=3;case 3:return[2,t]}})})}function hue(n){return dn(this,void 0,void 0,function(){var t,e,r,o,i,s;return pn(this,function(a){switch(a.label){case 0:return n instanceof bt?(t=n.shape.slice(0,2),e=t[0],r=t[1],o=ImageData.bind,[4,Ld.toPixels(n)]):[3,2];case 1:return[2,new(o.apply(ImageData,[void 0,a.sent(),r,e]))];case 2:return i=document.createElement("canvas"),s=i.getContext("2d"),i.width=qN(n.width),i.height=qN(n.height),s.drawImage(n,0,0),[2,s.getImageData(0,0,i.width,i.height)]}})})}function fHe(n){return dn(this,void 0,void 0,function(){var t,e;return pn(this,function(r){switch(r.label){case 0:return n instanceof SVGImageElement||n instanceof OffscreenCanvas?[4,fue(n)]:[3,2];case 1:return e=r.sent(),[3,3];case 2:e=n,r.label=3;case 3:return t=e,[2,Ld.fromPixels(t,4)]}})})}function mue(n){if(n<0||n>=256)throw new Error("Mask value must be in range [0, 255] but got ".concat(n));if(!Number.isInteger(n))throw new Error("Mask value must be an integer but got ".concat(n))}var $w={runtime:"mediapipe",enableSmoothing:!0,enableSegmentation:!1,smoothSegmentation:!0,modelType:"full"},hHe=function(){function n(t){this.mask=t}return n.prototype.toCanvasImageSource=function(){return dn(this,void 0,void 0,function(){return pn(this,function(t){return[2,this.mask]})})},n.prototype.toImageData=function(){return dn(this,void 0,void 0,function(){return pn(this,function(t){return[2,hue(this.mask)]})})},n.prototype.toTensor=function(){return dn(this,void 0,void 0,function(){return pn(this,function(t){return[2,fHe(this.mask)]})})},n.prototype.getUnderlyingType=function(){return"canvasimagesource"},n}();function mHe(n){return mue(n),"person"}var gHe=function(){function n(t){var e,r=this;switch(this.width=0,this.height=0,this.selfieMode=!1,this.poseSolution=new uue.Pose({locateFile:function(o,i){if(t.solutionPath){var s=t.solutionPath.replace(/\/+$/,"");return"".concat(s,"/").concat(o)}return"".concat(i,"/").concat(o)}}),t.modelType){case"lite":e=0;break;case"heavy":e=2;break;case"full":default:e=1}this.poseSolution.setOptions({modelComplexity:e,smoothLandmarks:t.enableSmoothing,enableSegmentation:t.enableSegmentation,smoothSegmentation:t.smoothSegmentation,selfieMode:this.selfieMode}),this.poseSolution.onResults(function(o){if(r.height=o.image.height,r.width=o.image.width,o.poseLandmarks==null)r.poses=[];else{var i=r.translateOutput(o.poseLandmarks,o.poseWorldLandmarks);o.segmentationMask&&(i.segmentation={maskValueToLabel:mHe,mask:new hHe(o.segmentationMask)}),r.poses=[i]}})}return n.prototype.translateOutput=function(t,e){var r=this,o={keypoints:t.map(function(i,s){return{x:i.x*r.width,y:i.y*r.height,z:i.z,score:i.visibility,name:Vw[s]}})};return e!=null&&(o.keypoints3D=e.map(function(i,s){return{x:i.x,y:i.y,z:i.z,score:i.visibility,name:Vw[s]}})),o},n.prototype.estimatePoses=function(t,e,r){return dn(this,void 0,void 0,function(){var o,i;return pn(this,function(s){switch(s.label){case 0:return e&&e.flipHorizontal&&e.flipHorizontal!==this.selfieMode&&(this.selfieMode=e.flipHorizontal,this.poseSolution.setOptions({selfieMode:this.selfieMode})),t instanceof bt?(i=ImageData.bind,[4,Ld.toPixels(t)]):[3,2];case 1:return o=new(i.apply(ImageData,[void 0,s.sent(),t.shape[1],t.shape[0]])),[3,3];case 2:o=t,s.label=3;case 3:return t=o,[4,this.poseSolution.send({image:t},r)];case 4:return s.sent(),[2,this.poses]}})})},n.prototype.dispose=function(){this.poseSolution.close()},n.prototype.reset=function(){this.poseSolution.reset()},n.prototype.initialize=function(){return this.poseSolution.initialize()},n}();function yHe(n){return dn(this,void 0,void 0,function(){var t,e;return pn(this,function(r){switch(r.label){case 0:return t=function(o){if(o==null)return Zn({},$w);var i=Zn({},o);return i.runtime="mediapipe",i.enableSegmentation==null&&(i.enableSegmentation=$w.enableSegmentation),i.enableSmoothing==null&&(i.enableSmoothing=$w.enableSmoothing),i.smoothSegmentation==null&&(i.smoothSegmentation=$w.smoothSegmentation),i.modelType==null&&(i.modelType=$w.modelType),i}(n),[4,(e=new gHe(t)).initialize()];case 1:return r.sent(),[2,e]}})})}function Ev(n){return n instanceof bt?{height:n.shape[0],width:n.shape[1]}:{height:n.height,width:n.width}}function gue(n){return n-2*Math.PI*Math.floor((n+Math.PI)/(2*Math.PI))}function X3(n){return n instanceof bt?n:Ld.fromPixels(n)}function yue(n,t,e){return j3(e,"inputResolution"),[1/e.width*n[0][0]*t.width,1/e.height*n[0][1]*t.width,n[0][3]*t.width,1/e.width*n[1][0]*t.height,1/e.height*n[1][1]*t.height,n[1][3]*t.height,0,0]}function j3(n,t){b.assert(n.width!==0,function(){return"".concat(t," width cannot be 0.")}),b.assert(n.height!==0,function(){return"".concat(t," height cannot be 0.")})}function F3(n,t,e){var r=e.rotationVectorStartKeypointIndex,o=e.rotationVectorEndKeypointIndex,i=n.locationData,s=i.relativeKeypoints[r].x*t.width,a=i.relativeKeypoints[r].y*t.height,l=i.relativeKeypoints[o].x*t.width,c=i.relativeKeypoints[o].y*t.height,u=2*Math.sqrt((l-s)*(l-s)+(c-a)*(c-a)),d=function(p,f,h){var m,g=p.locationData,y=h.rotationVectorStartKeypointIndex,v=h.rotationVectorEndKeypointIndex;m=h.rotationVectorTargetAngle?h.rotationVectorTargetAngle:Math.PI*h.rotationVectorTargetAngleDegree/180;var w=g.relativeKeypoints[y].x*f.width,C=g.relativeKeypoints[y].y*f.height,I=g.relativeKeypoints[v].x*f.width,A=g.relativeKeypoints[v].y*f.height;return gue(m-Math.atan2(-(A-C),I-w))}(n,t,e);return{xCenter:s/t.width,yCenter:a/t.height,width:u/t.width,height:u/t.height,rotation:d}}function xue(n){if(n.length!==16)throw new Error("Array length must be 16 but got ".concat(n.length));return[[n[0],n[1],n[2],n[3]],[n[4],n[5],n[6],n[7]],[n[8],n[9],n[10],n[11]],[n[12],n[13],n[14],n[15]]]}function L3(n,t,e,r,o,i,s){return n[t][o]*(n[e][i]*n[r][s]-n[e][s]*n[r][i])}function si(n,t,e){var r=(t+1)%4,o=(t+2)%4,i=(t+3)%4,s=(e+1)%4,a=(e+2)%4,l=(e+3)%4;return L3(n,r,o,i,s,a,l)+L3(n,o,i,r,s,a,l)+L3(n,i,r,o,s,a,l)}function Mce(n,t,e){e===void 0&&(e={ignoreRotation:!1});for(var r=[],o=0,i=n;o<i.length;o++){var s=i[o],a=s.x-.5,l=s.y-.5,c=e.ignoreRotation?0:t.rotation,u=Math.cos(c)*a-Math.sin(c)*l,d=Math.sin(c)*a+Math.cos(c)*l;u=u*t.width+t.xCenter,d=d*t.height+t.yCenter;var p=s.z*t.width,f=Zn({},s);f.x=u,f.y=d,f.z=p,r.push(f)}return r}function vue(n,t){var e=function(r,o,i,s){var a=o-r,l=s-i;if(a===0)throw new Error("Original min and max are both ".concat(r,", range cannot be 0."));var c=l/a;return{scale:c,offset:i-r*c}}(0,255,t[0],t[1]);return Z(function(){return ae(U(n,e.scale),e.offset)})}function H3(n,t,e){var r,o,i,s,a,l,c,u,d,p,f,h,m,g,y=t.outputTensorSize,v=t.keepAspectRatio,w=t.borderMode,C=t.outputTensorFloatRange,I=Ev(n),A=function(V,W){return W?{xCenter:W.xCenter*V.width,yCenter:W.yCenter*V.height,width:W.width*V.width,height:W.height*V.height,rotation:W.rotation}:{xCenter:.5*V.width,yCenter:.5*V.height,width:V.width,height:V.height,rotation:0}}(I,e),M=function(V,W,K){if(K===void 0&&(K=!1),!K)return{top:0,left:0,right:0,bottom:0};var te=W.height,ee=W.width;j3(W,"targetSize"),j3(V,"roi");var oe,ie,se=te/ee,fe=V.height/V.width,ue=0,ye=0;return se>fe?(oe=V.width,ie=V.width*se,ye=(1-fe/se)/2):(oe=V.height/se,ie=V.height,ue=(1-se/fe)/2),V.width=oe,V.height=ie,{top:ye,left:ue,right:ue,bottom:ye}}(A,y,v),$=(r=A,o=I.width,i=I.height,s=!1,a=r.width,l=r.height,c=s?-1:1,u=Math.cos(r.rotation),d=Math.sin(r.rotation),p=r.xCenter,f=r.yCenter,h=1/o,m=1/i,(g=new Array(16))[0]=a*u*c*h,g[1]=-l*d*h,g[2]=0,g[3]=(-.5*a*u*c+.5*l*d+p)*h,g[4]=a*d*c*m,g[5]=l*u*m,g[6]=0,g[7]=(-.5*l*u-.5*a*d*c+f)*m,g[8]=0,g[9]=0,g[10]=a*h,g[11]=0,g[12]=0,g[13]=0,g[14]=0,g[15]=1,xue(g));return{imageTensor:Z(function(){var V=X3(n),W=Fo(yue($,I,y),[1,8]),K=w==="zero"?"constant":"nearest",te=kr.transform(On(me(V,"float32")),W,"bilinear",K,0,[y.height,y.width]);return C!=null?vue(te,C):te}),padding:M,transformationMatrix:$}}function Pce(n,t,e,r){return r===1?.5*(n+t):n+(t-n)*e/(r-1)}function xHe(n){return Z(function(){var t=function(o){return Z(function(){return[Je(o,[0,0,0],[1,-1,1]),Je(o,[0,0,1],[1,-1,-1])]})}(n),e=t[0],r=t[1];return{boxes:qt(r),logits:qt(e)}})}function bue(n){return n!=null&&n.currentTime!=null}function Fce(n){for(var t={locationData:{relativeKeypoints:[]}},e=Number.MAX_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER,o=Number.MAX_SAFE_INTEGER,i=Number.MIN_SAFE_INTEGER,s=0;s<n.length;++s){var a=n[s];e=Math.min(e,a.x),r=Math.max(r,a.x),o=Math.min(o,a.y),i=Math.max(i,a.y),t.locationData.relativeKeypoints.push({x:a.x,y:a.y})}return t.locationData.relativeBoundingBox={xMin:e,yMin:o,xMax:r,yMax:i,width:r-e,height:i-o},t}function vHe(n,t,e,r){return dn(this,void 0,void 0,function(){var o,i,s,a,l;return pn(this,function(c){switch(c.label){case 0:return n.sort(function(u,d){return Math.max.apply(Math,d.score)-Math.max.apply(Math,u.score)}),o=Fo(n.map(function(u){return[u.locationData.relativeBoundingBox.yMin,u.locationData.relativeBoundingBox.xMin,u.locationData.relativeBoundingBox.yMax,u.locationData.relativeBoundingBox.xMax]})),i=Cn(n.map(function(u){return u.score[0]})),[4,kr.nonMaxSuppressionAsync(o,i,t,e)];case 1:return[4,(s=c.sent()).array()];case 2:return a=c.sent(),l=n.filter(function(u,d){return a.indexOf(d)>-1}),He([o,i,s]),[2,l]}})})}function wue(n,t){return n.map(function(e){var r=Zn(Zn({},e),{x:e.x*t.width,y:e.y*t.height});return e.z!=null&&(r.z=e.z*t.width),r})}function bHe(n,t,e){return dn(this,void 0,void 0,function(){var r,o,i,s,a,l,c,u,d,p,f,h,m,g,y,v,w,C,I,A,M,$,V,W;return pn(this,function(K){switch(K.label){case 0:if(r=qt(t,[0]),o=r.shape,i=o[0],s=o[1],a=o[2],n.length!==a)throw new Error("Expected heatmap to have same number of channels as the number of landmarks. But got landmarks length: "+"".concat(n.length,", heatmap length: ").concat(a));return l=[],[4,r.buffer()];case 1:for(c=K.sent(),u=0;u<n.length;u++)if(d=n[u],p=Zn({},d),l.push(p),f=Math.trunc(p.x*s),h=Math.trunc(p.y*i),!(f<0||f>=s||h<0||f>=i)){for(m=Math.trunc((e.kernelSize-1)/2),g=Math.max(0,f-m),y=Math.min(s,f+m+1),v=Math.max(0,h-m),w=Math.min(i,h+m+1),C=0,I=0,A=0,M=0,$=v;$<w;++$)for(V=g;V<y;++V)W=c.get($,V,u),C+=W,M=Math.max(M,W),I+=V*W,A+=$*W;M>=e.minConfidenceToRefine&&C>0&&(p.x=I/s/C,p.y=A/i/C)}return r.dispose(),[2,l]}})})}function Lce(n,t){var e=t.left,r=t.top,o=t.left+t.right,i=t.top+t.bottom;return n.map(function(s){return Zn(Zn({},s),{x:(s.x-e)/(1-o),y:(s.y-r)/(1-i),z:s.z/(1-o)})})}function wHe(n,t,e){return sm()==="webgl"?function(r,o,i){var s=i.combineWithPreviousRatio.toFixed(2),a={variableNames:["prevMask","newMask"],outputShape:r.shape,userCode:`
  void main() {
      ivec2 coords = getOutputCoords();
      int height = coords[0];
      int width = coords[1];

      float prevMaskValue = getPrevMask(height, width);
      float newMaskValue = getNewMask(height, width);

      /*
      * Assume p := newMaskValue
      * H(p) := 1 + (p * log(p) + (1-p) * log(1-p)) / log(2)
      * uncertainty alpha(p) =
      *   Clamp(1 - (1 - H(p)) * (1 - H(p)), 0, 1) [squaring the
      * uncertainty]
      *
      * The following polynomial approximates uncertainty alpha as a
      * function of (p + 0.5):
      */
      const float c1 = 5.68842;
      const float c2 = -0.748699;
      const float c3 = -57.8051;
      const float c4 = 291.309;
      const float c5 = -624.717;
      float t = newMaskValue - 0.5;
      float x = t * t;

      float uncertainty =
        1.0 - min(1.0, x * (c1 + x * (c2 + x * (c3 + x * (c4 + x * c5)))));

      float outputValue = newMaskValue + (prevMaskValue - newMaskValue) *
                             (uncertainty * `.concat(s,`);

      setOutput(outputValue);
    }
`)},l=mu();return Z(function(){var c=l.compileAndRun(a,[r,o]);return Zr().makeTensorFromDataId(c.dataId,c.shape,c.dtype)})}(n,t,e):Z(function(){var r=Ie(t,.5),o=xt(r),i=Ie(1,xi(1,U(o,ae(5.68842,U(o,ae(-.748699,U(o,ae(-57.8051,U(o,ae(291.309,U(o,-624.717)))))))))));return ae(t,U(Ie(n,t),U(i,e.combineWithPreviousRatio)))})}function CHe(n,t,e){return dn(this,void 0,void 0,function(){var r,o,i,s,a;return pn(this,function(l){switch(l.label){case 0:return r=n[0],o=n[1],i=function(c,u,d){return Z(function(){var p,f,h,m;d.reverseOutputOrder?(f=qt(Je(c,[0,d.boxCoordOffset+0],[-1,1])),p=qt(Je(c,[0,d.boxCoordOffset+1],[-1,1])),m=qt(Je(c,[0,d.boxCoordOffset+2],[-1,1])),h=qt(Je(c,[0,d.boxCoordOffset+3],[-1,1]))):(p=qt(Je(c,[0,d.boxCoordOffset+0],[-1,1])),f=qt(Je(c,[0,d.boxCoordOffset+1],[-1,1])),h=qt(Je(c,[0,d.boxCoordOffset+2],[-1,1])),m=qt(Je(c,[0,d.boxCoordOffset+3],[-1,1]))),f=ae(U(Se(f,d.xScale),u.w),u.x),p=ae(U(Se(p,d.yScale),u.h),u.y),d.applyExponentialOnBoxSize?(h=U(Gn(Se(h,d.hScale)),u.h),m=U(Gn(Se(m,d.wScale)),u.w)):(h=U(Se(h,d.hScale),u.h),m=U(Se(m,d.wScale),u.h));var g=Ie(p,Se(h,2)),y=Ie(f,Se(m,2)),v=ae(p,Se(h,2)),w=ae(f,Se(m,2)),C=Gt([G(g,[d.numBoxes,1]),G(y,[d.numBoxes,1]),G(v,[d.numBoxes,1]),G(w,[d.numBoxes,1])],1);if(d.numKeypoints)for(var I=0;I<d.numKeypoints;++I){var A=d.keypointCoordOffset+I*d.numValuesPerKeypoint,M=void 0,$=void 0;d.reverseOutputOrder?(M=qt(Je(c,[0,A],[-1,1])),$=qt(Je(c,[0,A+1],[-1,1]))):($=qt(Je(c,[0,A],[-1,1])),M=qt(Je(c,[0,A+1],[-1,1])));var V=ae(U(Se(M,d.xScale),u.w),u.x),W=ae(U(Se($,d.yScale),u.h),u.y);C=Gt([C,G(V,[d.numBoxes,1]),G(W,[d.numBoxes,1])],1)}return C})}(o,t,e),s=Z(function(){var c=r;return e.sigmoidScore?(e.scoreClippingThresh!=null&&(c=Pr(r,-e.scoreClippingThresh,e.scoreClippingThresh)),c=jr(c)):c}),[4,_He(i,s,e)];case 1:return a=l.sent(),He([i,s]),[2,a]}})})}function _He(n,t,e){return dn(this,void 0,void 0,function(){var r,o,i,s,a,l,c,u,d,p,f,h;return pn(this,function(m){switch(m.label){case 0:return r=[],[4,n.data()];case 1:return o=m.sent(),[4,t.data()];case 2:for(i=m.sent(),s=0;s<e.numBoxes;++s)if(!(e.minScoreThresh!=null&&i[s]<e.minScoreThresh||(a=s*e.numCoords,l=SHe(o[a+0],o[a+1],o[a+2],o[a+3],i[s],e.flipVertically,s),(c=l.locationData.relativeBoundingBox).width<0||c.height<0))){if(e.numKeypoints>0)for((u=l.locationData).relativeKeypoints=[],d=e.numKeypoints*e.numValuesPerKeypoint,p=0;p<d;p+=e.numValuesPerKeypoint)f=a+e.keypointCoordOffset+p,h={x:o[f+0],y:e.flipVertically?1-o[f+1]:o[f+1]},u.relativeKeypoints.push(h);r.push(l)}return[2,r]}})})}function SHe(n,t,e,r,o,i,s){return{score:[o],ind:s,locationData:{relativeBoundingBox:{xMin:t,yMin:i?1-e:n,xMax:r,yMax:i?1-n:e,width:r-t,height:e-n}}}}function IHe(n,t){return n==="none"?t:function(e){return 1/(1+Math.exp(-e))}(t)}function $ce(n,t,e,r){return dn(this,void 0,void 0,function(){var o,i,s,a,l,c,u,d;return pn(this,function(p){switch(p.label){case 0:return e=e||t.flipHorizontally||!1,r=r||t.flipVertically||!1,o=n.size,i=o/t.numLandmarks,[4,n.data()];case 1:for(s=p.sent(),a=[],l=0;l<t.numLandmarks;++l)c=l*i,(d={x:0,y:0}).x=e?t.inputImageWidth-s[c]:s[c],i>1&&(d.y=r?t.inputImageHeight-s[c+1]:s[c+1]),i>2&&(d.z=s[c+2]),i>3&&(d.score=IHe(t.visibilityActivation,s[c+3])),a.push(d);for(u=0;u<a.length;++u)(d=a[u]).x=d.x/t.inputImageWidth,d.y=d.y/t.inputImageHeight,d.z=d.z/t.inputImageWidth/(t.normalizeZ||1);return[2,a]}})})}function Vce(n,t,e){var r=n.width,o=n.height,i=n.rotation;if(e.rotation==null&&e.rotationDegree==null||(i=function(u,d){return d.rotation!=null?u+=d.rotation:d.rotationDegree!=null&&(u+=Math.PI*d.rotationDegree/180),gue(u)}(i,e)),i===0)n.xCenter=n.xCenter+r*e.shiftX,n.yCenter=n.yCenter+o*e.shiftY;else{var s=(t.width*r*e.shiftX*Math.cos(i)-t.height*o*e.shiftY*Math.sin(i))/t.width,a=(t.width*r*e.shiftX*Math.sin(i)+t.height*o*e.shiftY*Math.cos(i))/t.height;n.xCenter=n.xCenter+s,n.yCenter=n.yCenter+a}if(e.squareLong){var l=Math.max(r*t.width,o*t.height);r=l/t.width,o=l/t.height}else if(e.squareShort){var c=Math.min(r*t.width,o*t.height);r=c/t.width,o=c/t.height}return n.width=r*e.scaleX,n.height=o*e.scaleY,n}function EHe(n,t){return n.map(function(e){var r=Zn(Zn({},e),{x:e.x/t.width,y:e.y/t.height});return e.z!=null&&(e.z=e.z/t.width),r})}var ch=function(){function n(t){this.alpha=t,this.initialized=!1}return n.prototype.apply=function(t,e){var r;return this.initialized?r=e==null?this.storedValue+this.alpha*(t-this.storedValue):this.storedValue+this.alpha*e*Math.asinh((t-this.storedValue)/e):(r=t,this.initialized=!0),this.rawValue=t,this.storedValue=r,r},n.prototype.applyWithAlpha=function(t,e,r){return this.alpha=e,this.apply(t,r)},n.prototype.hasLastRawValue=function(){return this.initialized},n.prototype.lastRawValue=function(){return this.rawValue},n.prototype.reset=function(){this.initialized=!1},n}(),$3=function(){function n(t){this.frequency=t.frequency,this.minCutOff=t.minCutOff,this.beta=t.beta,this.thresholdCutOff=t.thresholdCutOff,this.thresholdBeta=t.thresholdBeta,this.derivateCutOff=t.derivateCutOff,this.x=new ch(this.getAlpha(this.minCutOff)),this.dx=new ch(this.getAlpha(this.derivateCutOff)),this.lastTimestamp=0}return n.prototype.apply=function(t,e,r){if(t==null)return t;var o=Math.trunc(e);if(this.lastTimestamp>=o)return t;this.lastTimestamp!==0&&o!==0&&(this.frequency=1/(1e-6*(o-this.lastTimestamp))),this.lastTimestamp=o;var i=this.x.hasLastRawValue()?(t-this.x.lastRawValue())*r*this.frequency:0,s=this.dx.applyWithAlpha(i,this.getAlpha(this.derivateCutOff)),a=this.minCutOff+this.beta*Math.abs(s),l=this.thresholdCutOff!=null?this.thresholdCutOff+this.thresholdBeta*Math.abs(s):null;return this.x.applyWithAlpha(t,this.getAlpha(a),l)},n.prototype.getAlpha=function(t){return 1/(1+this.frequency/(2*Math.PI*t))},n}(),q3=function(){function n(t){this.config=t}return n.prototype.apply=function(t,e,r){var o=this;if(t==null)return this.reset(),null;this.initializeFiltersIfEmpty(t);var i=1;if(!this.config.disableValueScaling){if(r<this.config.minAllowedObjectScale)return Qm([],t,!0);i=1/r}return t.map(function(s,a){var l=Zn(Zn({},s),{x:o.xFilters[a].apply(s.x,e,i),y:o.yFilters[a].apply(s.y,e,i)});return s.z!=null&&(l.z=o.zFilters[a].apply(s.z,e,i)),l})},n.prototype.reset=function(){this.xFilters=null,this.yFilters=null,this.zFilters=null},n.prototype.initializeFiltersIfEmpty=function(t){var e=this;this.xFilters!=null&&this.xFilters.length===t.length||(this.xFilters=t.map(function(r){return new $3(e.config)}),this.yFilters=t.map(function(r){return new $3(e.config)}),this.zFilters=t.map(function(r){return new $3(e.config)}))},n}(),V3=function(){function n(t){this.config=t,this.window=[],this.lowPassFilter=new ch(1),this.lastValue=0,this.lastValueScale=1,this.lastTimestamp=-1}return n.prototype.apply=function(t,e,r){if(t==null)return t;var o,i=Math.trunc(e);if(this.lastTimestamp>=i)return t;if(this.lastTimestamp===-1)o=1;else{for(var s=t*r-this.lastValue*this.lastValueScale,a=i-this.lastTimestamp,l=s,c=a,u=(1+this.window.length)*(1e6/30),d=0,p=this.window;d<p.length;d++){var f=p[d];if(c+f.duration>u)break;l+=f.distance,c+=f.duration}var h=l/(1e-6*c);o=1-1/(1+this.config.velocityScale*Math.abs(h)),this.window.unshift({distance:s,duration:a}),this.window.length>this.config.windowSize&&this.window.pop()}return this.lastValue=t,this.lastValueScale=r,this.lastTimestamp=i,this.lowPassFilter.applyWithAlpha(t,o)},n}(),THe=function(){function n(t){this.config=t}return n.prototype.apply=function(t,e,r){var o=this;if(t==null)return this.reset(),null;var i=1;if(!this.config.disableValueScaling){if(r<this.config.minAllowedObjectScale)return Qm([],t,!0);i=1/r}return this.initializeFiltersIfEmpty(t),t.map(function(s,a){var l=Zn(Zn({},s),{x:o.xFilters[a].apply(s.x,e,i),y:o.yFilters[a].apply(s.y,e,i)});return s.z!=null&&(l.z=o.zFilters[a].apply(s.z,e,i)),l})},n.prototype.reset=function(){this.xFilters=null,this.yFilters=null,this.zFilters=null},n.prototype.initializeFiltersIfEmpty=function(t){var e=this;this.xFilters!=null&&this.xFilters.length===t.length||(this.xFilters=t.map(function(r){return new V3(e.config)}),this.yFilters=t.map(function(r){return new V3(e.config)}),this.zFilters=t.map(function(r){return new V3(e.config)}))},n}(),B3=function(){function n(t){if(t.velocityFilter!=null)this.keypointsFilter=new THe(t.velocityFilter);else{if(t.oneEuroFilter==null)throw new Error("Either configure velocityFilter or oneEuroFilter, but got "+"".concat(t,"."));this.keypointsFilter=new q3(t.oneEuroFilter)}}return n.prototype.apply=function(t,e,r,o,i){if(o===void 0&&(o=!1),t==null)return this.keypointsFilter.reset(),null;var s=i!=null?function(c,u){return(c.width*u.width+c.height*u.height)/2}(i,r):1,a=o?wue(t,r):t,l=this.keypointsFilter.apply(a,e,s);return o?EHe(l,r):l},n}(),Bce=function(){function n(t){this.alpha=t.alpha}return n.prototype.apply=function(t){var e=this;if(t==null)return this.visibilityFilters=null,null;this.visibilityFilters!=null&&this.visibilityFilters.length===t.length||(this.visibilityFilters=t.map(function(a){return new ch(e.alpha)}));for(var r=[],o=0;o<t.length;++o){var i=t[o],s=Zn({},i);s.score=this.visibilityFilters[o].apply(i.score),r.push(s)}return r},n}(),DHe={reduceBoxesInLowestlayer:!1,interpolatedScaleAspectRatio:1,featureMapHeight:[],featureMapWidth:[],numLayers:5,minScale:.1484375,maxScale:.75,inputSizeHeight:224,inputSizeWidth:224,anchorOffsetX:.5,anchorOffsetY:.5,strides:[8,16,32,32,32],aspectRatios:[1],fixedAnchorSize:!0},Iv={runtime:"tfjs",modelType:"full",enableSmoothing:!0,enableSegmentation:!1,smoothSegmentation:!0,detectorModelUrl:"https://tfhub.dev/mediapipe/tfjs-model/blazepose_3d/detector/1",landmarkModelUrl:"https://tfhub.dev/mediapipe/tfjs-model/blazepose_3d/landmark/full/2"},kHe={maxPoses:1,flipHorizontal:!1},NHe={applyExponentialOnBoxSize:!1,flipVertically:!1,ignoreClasses:[],numClasses:1,numBoxes:2254,numCoords:12,boxCoordOffset:0,keypointCoordOffset:4,numKeypoints:4,numValuesPerKeypoint:2,sigmoidScore:!0,scoreClippingThresh:100,reverseOutputOrder:!0,xScale:224,yScale:224,hScale:224,wScale:224,minScoreThresh:.5},AHe=.3,zce={shiftX:0,shiftY:0,scaleX:1.25,scaleY:1.25,squareLong:!0},RHe={outputTensorSize:{width:224,height:224},keepAspectRatio:!0,outputTensorFloatRange:[-1,1],borderMode:"zero"},OHe={outputTensorSize:{width:256,height:256},keepAspectRatio:!0,outputTensorFloatRange:[0,1],borderMode:"zero"},MHe={numLandmarks:39,inputImageWidth:256,inputImageHeight:256,visibilityActivation:"sigmoid",flipHorizontally:!1,flipVertically:!1},PHe={numLandmarks:39,inputImageWidth:1,inputImageHeight:1,visibilityActivation:"sigmoid",flipHorizontally:!1,flipVertically:!1},FHe={kernelSize:7,minConfidenceToRefine:.5},Uce={alpha:.1},LHe={oneEuroFilter:{frequency:30,minCutOff:.05,beta:80,derivateCutOff:1,minAllowedObjectScale:1e-6}},$He={oneEuroFilter:{frequency:30,minCutOff:.01,beta:10,derivateCutOff:1,minAllowedObjectScale:1e-6}},VHe={oneEuroFilter:{frequency:30,minCutOff:.1,beta:40,derivateCutOff:1,minAllowedObjectScale:1e-6,disableValueScaling:!0}},BHe={activation:"none"},zHe={combineWithPreviousRatio:.7},UHe=function(){function n(t){this.mask=t}return n.prototype.toCanvasImageSource=function(){return dn(this,void 0,void 0,function(){return pn(this,function(t){return[2,fue(this.mask)]})})},n.prototype.toImageData=function(){return dn(this,void 0,void 0,function(){return pn(this,function(t){return[2,hue(this.mask)]})})},n.prototype.toTensor=function(){return dn(this,void 0,void 0,function(){return pn(this,function(t){return[2,this.mask]})})},n.prototype.getUnderlyingType=function(){return"tensor"},n}();function WHe(n){return mue(n),"person"}var GHe=function(){function n(t,e,r,o,i,s){this.detectorModel=t,this.landmarkModel=e,this.enableSmoothing=r,this.enableSegmentation=o,this.smoothSegmentation=i,this.modelType=s,this.regionOfInterest=null,this.prevFilteredSegmentationMask=null,this.anchors=function(d){d.reduceBoxesInLowestLayer==null&&(d.reduceBoxesInLowestLayer=!1),d.interpolatedScaleAspectRatio==null&&(d.interpolatedScaleAspectRatio=1),d.fixedAnchorSize==null&&(d.fixedAnchorSize=!1);for(var p=[],f=0;f<d.numLayers;){for(var h=[],m=[],g=[],y=[],v=f;v<d.strides.length&&d.strides[v]===d.strides[f];){var w=Pce(d.minScale,d.maxScale,v,d.strides.length);if(v===0&&d.reduceBoxesInLowestLayer)g.push(1),g.push(2),g.push(.5),y.push(.1),y.push(w),y.push(w);else{for(var C=0;C<d.aspectRatios.length;++C)g.push(d.aspectRatios[C]),y.push(w);if(d.interpolatedScaleAspectRatio>0){var I=v===d.strides.length-1?1:Pce(d.minScale,d.maxScale,v+1,d.strides.length);y.push(Math.sqrt(w*I)),g.push(d.interpolatedScaleAspectRatio)}}v++}for(var A=0;A<g.length;++A){var M=Math.sqrt(g[A]);h.push(y[A]/M),m.push(y[A]*M)}var $=0,V=0;if(d.featureMapHeight.length>0)$=d.featureMapHeight[f],V=d.featureMapWidth[f];else{var W=d.strides[f];$=Math.ceil(d.inputSizeHeight/W),V=Math.ceil(d.inputSizeWidth/W)}for(var K=0;K<$;++K)for(var te=0;te<V;++te)for(var ee=0;ee<h.length;++ee){var oe={xCenter:(te+d.anchorOffsetX)/V,yCenter:(K+d.anchorOffsetY)/$,width:0,height:0};d.fixedAnchorSize?(oe.width=1,oe.height=1):(oe.width=m[ee],oe.height=h[ee]),p.push(oe)}f=v}return p}(DHe);var a=Cn(this.anchors.map(function(d){return d.width})),l=Cn(this.anchors.map(function(d){return d.height})),c=Cn(this.anchors.map(function(d){return d.xCenter})),u=Cn(this.anchors.map(function(d){return d.yCenter}));this.anchorTensor={x:c,y:u,w:a,h:l},this.prevFilteredSegmentationMask=this.enableSegmentation?Fo([],[0,0]):null}return n.prototype.estimatePoses=function(t,e,r){return dn(this,void 0,void 0,function(){var o,i,s,a,l,c,u,d,p,f,h,m,g,y,v,w,C,I,A,M,$,V,W;return pn(this,function(K){switch(K.label){case 0:return o=function(te){var ee;if((ee=te==null?kHe:Zn({},te)).maxPoses==null&&(ee.maxPoses=1),ee.maxPoses<=0)throw new Error("Invalid maxPoses ".concat(ee.maxPoses,". Should be > 0."));if(ee.maxPoses>1)throw new Error("Multi-pose detection is not implemented yet. Please set maxPoses to 1.");return ee}(e),t==null?(this.reset(),[2,[]]):(this.maxPoses=o.maxPoses,this.timestamp=r!=null?1e3*r:bue(t)?1e6*t.currentTime:null,i=Ev(t),s=Z(function(){return me(X3(t),"float32")}),(a=this.regionOfInterest)!=null?[3,2]:[4,this.detectPose(s)]);case 1:if((l=K.sent()).length===0)return this.reset(),s.dispose(),[2,[]];c=l[0],a=this.poseDetectionToRoi(c,i),K.label=2;case 2:return[4,this.poseLandmarksByRoi(a,s)];case 3:return u=K.sent(),s.dispose(),u==null?(this.reset(),[2,[]]):(d=u.landmarks,p=u.auxiliaryLandmarks,f=u.poseScore,h=u.worldLandmarks,m=u.segmentationMask,g=this.poseLandmarkFiltering(d,p,h,i),y=g.actualLandmarksFiltered,v=g.auxiliaryLandmarksFiltered,w=g.actualWorldLandmarksFiltered,C=this.poseLandmarksToRoi(v,i),this.regionOfInterest=C,I=this.smoothSegmentation&&m!=null?this.poseSegmentationFiltering(m):m,(A=y!=null?wue(y,i):null)!=null&&A.forEach(function(te,ee){te.name=Vw[ee]}),(M=w)!=null&&M.forEach(function(te,ee){te.name=Vw[ee]}),$={score:f,keypoints:A,keypoints3D:M},I!==null&&(V=Z(function(){var te=On(I,2),ee=to(te,[[0,0],[0,0],[0,1]]);return lx(ee,[[0,0],[0,0],[0,2]],"symmetric")}),this.smoothSegmentation||He(I),W={maskValueToLabel:WHe,mask:new UHe(V)},$.segmentation=W),[2,[$]])}})})},n.prototype.poseSegmentationFiltering=function(t){var e=this.prevFilteredSegmentationMask;return e.size===0?this.prevFilteredSegmentationMask=t:(this.prevFilteredSegmentationMask=wHe(e,t,zHe),He(t)),He(e),this.prevFilteredSegmentationMask},n.prototype.dispose=function(){this.detectorModel.dispose(),this.landmarkModel.dispose(),He([this.anchorTensor.x,this.anchorTensor.y,this.anchorTensor.w,this.anchorTensor.h,this.prevFilteredSegmentationMask])},n.prototype.reset=function(){this.regionOfInterest=null,this.enableSegmentation&&(He(this.prevFilteredSegmentationMask),this.prevFilteredSegmentationMask=Fo([],[0,0])),this.visibilitySmoothingFilterActual=null,this.visibilitySmoothingFilterAuxiliary=null,this.landmarksSmoothingFilterActual=null,this.landmarksSmoothingFilterAuxiliary=null},n.prototype.detectPose=function(t){return dn(this,void 0,void 0,function(){var e,r,o,i,s,a,l,c,u,d;return pn(this,function(p){switch(p.label){case 0:return e=H3(t,RHe),r=e.imageTensor,o=e.padding,i=this.detectorModel.predict(r),s=xHe(i),a=s.boxes,[4,CHe([l=s.logits,a],this.anchorTensor,NHe)];case 1:return(c=p.sent()).length===0?(He([r,i,l,a]),[2,c]):[4,vHe(c,this.maxPoses,AHe)];case 2:return u=p.sent(),d=function(f,h){f===void 0&&(f=[]);for(var m=h.left,g=h.top,y=h.left+h.right,v=h.top+h.bottom,w=0;w<f.length;w++){var C=f[w],I=C.locationData.relativeBoundingBox,A=(I.xMin-m)/(1-y),M=(I.yMin-g)/(1-v),$=I.width/(1-y),V=I.height/(1-v);I.xMin=A,I.yMin=M,I.width=$,I.height=V,I.xMax=A+$,I.yMax=M+V;var W=C.locationData.relativeKeypoints;W&&W.forEach(function(K){var te=(K.x-m)/(1-y),ee=(K.y-g)/(1-v);K.x=te,K.y=ee})}return f}(u,o),He([r,i,l,a]),[2,d]}})})},n.prototype.poseDetectionToRoi=function(t,e){return Vce(F3(t,e,{rotationVectorEndKeypointIndex:1,rotationVectorStartKeypointIndex:0,rotationVectorTargetAngleDegree:90}),e,zce)},n.prototype.poseLandmarksByRoi=function(t,e){return dn(this,void 0,void 0,function(){var r,o,i,s,a,l,c,u,d,p,f,h,m,g;return pn(this,function(y){switch(y.label){case 0:if(r=Ev(e),o=H3(e,OHe,t),i=o.imageTensor,s=o.padding,a=o.transformationMatrix,this.modelType!=="lite"&&this.modelType!=="full"&&this.modelType!=="heavy")throw new Error("Model type must be one of lite, full or heavy,"+"but got ".concat(this.modelType));return l=["ld_3d","output_poseflag","activation_heatmap","world_3d"],this.enableSegmentation&&l.push("activation_segmentation"),c=this.landmarkModel.execute(i,l),[4,this.tensorsToPoseLandmarksAndSegmentation(c)];case 1:return(u=y.sent())==null?(He(c),He(i),[2,null]):(d=u.landmarks,p=u.auxiliaryLandmarks,f=u.poseScore,h=u.worldLandmarks,m=u.segmentationMask,[4,this.poseLandmarksAndSegmentationInverseProjection(r,t,s,a,d,p,h,m)]);case 2:return g=y.sent(),He(c),He(i),[2,Zn({poseScore:f},g)]}})})},n.prototype.poseLandmarksAndSegmentationInverseProjection=function(t,e,r,o,i,s,a,l){return dn(this,void 0,void 0,function(){var c,u,d,p,f,h;return pn(this,function(m){return c=Lce(i,r),u=Lce(s,r),d=Mce(c,e),p=Mce(u,e),f=function(g,y){for(var v=[],w=0,C=g;w<C.length;w++){var I=C[w],A=I.x,M=I.y,$=y.rotation,V=Math.cos($)*A-Math.sin($)*M,W=Math.sin($)*A+Math.cos($)*M,K=Zn({},I);K.x=V,K.y=W,v.push(K)}return v}(a,e),h=null,this.enableSegmentation&&(h=Z(function(){var g=l.shape,y=g[0],v=g[1],w=function(A){var M=xue(new Array(16).fill(0));M[0][0]=si(A,0,0),M[1][0]=-si(A,0,1),M[2][0]=si(A,0,2),M[3][0]=-si(A,0,3),M[0][2]=si(A,2,0),M[1][2]=-si(A,2,1),M[2][2]=si(A,2,2),M[3][2]=-si(A,2,3),M[0][1]=-si(A,1,0),M[1][1]=si(A,1,1),M[2][1]=-si(A,1,2),M[3][1]=si(A,1,3),M[0][3]=-si(A,3,0),M[1][3]=si(A,3,1),M[2][3]=-si(A,3,2),M[3][3]=si(A,3,3);for(var $=A[0][0]*M[0][0]+A[1][0]*M[0][1]+A[2][0]*M[0][2]+A[3][0]*M[0][3],V=0;V<M.length;V++)for(var W=0;W<M.length;W++)M[V][W]/=$;return M}(o),C=Fo(yue(w,{width:v,height:y},t),[1,8]),I=[1,y,v,1];return qt(kr.transform(G(l,I),C,"bilinear","constant",0,[t.height,t.width]),[0,3])}),He(l)),[2,{landmarks:d,auxiliaryLandmarks:p,worldLandmarks:f,segmentationMask:h}]})})},n.prototype.tensorsToPoseLandmarksAndSegmentation=function(t){return dn(this,void 0,void 0,function(){var e,r,o,i,s,a,l,c,u,d,p,f,h;return pn(this,function(m){switch(m.label){case 0:return e=t[0],r=t[1],o=t[2],i=t[3],s=this.enableSegmentation?t[4]:null,[4,r.data()];case 1:return(a=m.sent()[0])<.5?[2,null]:[4,$ce(e,MHe)];case 2:return[4,bHe(m.sent(),o,FHe)];case 3:return l=m.sent(),c=l.slice(0,33),u=l.slice(33,35),[4,$ce(i,PHe)];case 4:return d=m.sent(),p=d.slice(0,33),f=function(g,y,v){v===void 0&&(v=!0);for(var w=[],C=0;C<g.length;C++){var I=Zn({},y[C]);v&&(I.score=g[C].score),w.push(I)}return w}(c,p,!0),h=this.enableSegmentation?function(g,y,v){return Z(function(){var w=qt(g,[0]),C=w.shape[2];if(C===1){var I=w;switch(y.activation){case"none":break;case"sigmoid":I=jr(I);break;case"softmax":throw new Error("Softmax activation requires two channels.");default:throw new Error("Activation not supported (".concat(y.activation,")"))}var A=v?kr.resizeBilinear(I,[v.height,v.width]):I;return qt(A,[2])}throw new Error("Unsupported number of tensor channels ".concat(C))})}(s,BHe):null,[2,{landmarks:c,auxiliaryLandmarks:u,poseScore:a,worldLandmarks:f,segmentationMask:h}]}})})},n.prototype.poseLandmarksToRoi=function(t,e){return Vce(F3(Fce(t),e,{rotationVectorStartKeypointIndex:0,rotationVectorEndKeypointIndex:1,rotationVectorTargetAngleDegree:90}),e,zce)},n.prototype.poseLandmarkFiltering=function(t,e,r,o){var i,s,a;if(this.timestamp!=null&&this.enableSmoothing){var l=F3(Fce(e),o,{rotationVectorEndKeypointIndex:0,rotationVectorStartKeypointIndex:1,rotationVectorTargetAngleDegree:90});this.visibilitySmoothingFilterActual==null&&(this.visibilitySmoothingFilterActual=new Bce(Uce)),i=this.visibilitySmoothingFilterActual.apply(t),this.visibilitySmoothingFilterAuxiliary==null&&(this.visibilitySmoothingFilterAuxiliary=new Bce(Uce)),s=this.visibilitySmoothingFilterAuxiliary.apply(e),a=this.visibilitySmoothingFilterActual.apply(r),this.landmarksSmoothingFilterActual==null&&(this.landmarksSmoothingFilterActual=new B3(LHe)),i=this.landmarksSmoothingFilterActual.apply(i,this.timestamp,o,!0,l),this.landmarksSmoothingFilterAuxiliary==null&&(this.landmarksSmoothingFilterAuxiliary=new B3($He)),s=this.landmarksSmoothingFilterAuxiliary.apply(s,this.timestamp,o,!0,l),this.worldLandmarksSmoothingFilterActual==null&&(this.worldLandmarksSmoothingFilterActual=new B3(VHe)),a=this.worldLandmarksSmoothingFilterActual.apply(r,this.timestamp)}else i=t,s=e,a=r;return{actualLandmarksFiltered:i,auxiliaryLandmarksFiltered:s,actualWorldLandmarksFiltered:a}},n}();function jHe(n){return dn(this,void 0,void 0,function(){var t,e,r,o,i,s;return pn(this,function(a){switch(a.label){case 0:return t=function(l){var c=Zn({},l??Iv);if(c.enableSmoothing==null&&(c.enableSmoothing=Iv.enableSmoothing),c.enableSegmentation==null&&(c.enableSegmentation=Iv.enableSegmentation),c.smoothSegmentation==null&&(c.smoothSegmentation=Iv.smoothSegmentation),c.modelType==null&&(c.modelType=Iv.modelType),c.detectorModelUrl==null&&(c.detectorModelUrl=Iv.detectorModelUrl),c.landmarkModelUrl==null)switch(c.modelType){case"lite":c.landmarkModelUrl="https://tfhub.dev/mediapipe/tfjs-model/blazepose_3d/landmark/lite/2";break;case"heavy":c.landmarkModelUrl="https://tfhub.dev/mediapipe/tfjs-model/blazepose_3d/landmark/heavy/2";break;case"full":default:c.landmarkModelUrl="https://tfhub.dev/mediapipe/tfjs-model/blazepose_3d/landmark/full/2"}return c}(n),e=typeof t.detectorModelUrl=="string"&&t.detectorModelUrl.indexOf("https://tfhub.dev")>-1,r=typeof t.landmarkModelUrl=="string"&&t.landmarkModelUrl.indexOf("https://tfhub.dev")>-1,[4,Promise.all([Qf(t.detectorModelUrl,{fromTFHub:e}),Qf(t.landmarkModelUrl,{fromTFHub:r})])];case 1:return o=a.sent(),i=o[0],s=o[1],[2,new GHe(i,s,t.enableSmoothing,t.enableSegmentation,t.smoothSegmentation,t.modelType)]}})})}var Jm,zo,Cue=function(){function n(t){(function(e){if(e.maxTracks<1)throw new Error("Must specify 'maxTracks' to be at least 1, but "+"encountered ".concat(e.maxTracks));if(e.maxAge<=0)throw new Error("Must specify 'maxAge' to be positive, but "+"encountered ".concat(e.maxAge));if(e.keypointTrackerParams!==void 0){if(e.keypointTrackerParams.keypointConfidenceThreshold<0||e.keypointTrackerParams.keypointConfidenceThreshold>1)throw new Error("Must specify 'keypointConfidenceThreshold' to be in the range [0, 1], but encountered "+"".concat(e.keypointTrackerParams.keypointConfidenceThreshold));if(e.keypointTrackerParams.minNumberOfKeypoints<1)throw new Error("Must specify 'minNumberOfKeypoints' to be at least 1, but "+"encountered ".concat(e.keypointTrackerParams.minNumberOfKeypoints));for(var r=0,o=e.keypointTrackerParams.keypointFalloff;r<o.length;r++){var i=o[r];if(i<=0)throw new Error("Must specify each keypoint falloff parameterto be positive "+"but encountered ".concat(i))}}})(t),this.tracks=[],this.maxTracks=t.maxTracks,this.maxAge=1e3*t.maxAge,this.minSimilarity=t.minSimilarity,this.nextID=1}return n.prototype.apply=function(t,e){this.filterOldTracks(e);var r=this.computeSimilarity(t);return this.assignTracks(t,r,e),this.updateTracks(e),t},n.prototype.getTracks=function(){return this.tracks.slice()},n.prototype.getTrackIDs=function(){return new Set(this.tracks.map(function(t){return t.id}))},n.prototype.filterOldTracks=function(t){var e=this;this.tracks=this.tracks.filter(function(r){return t-r.lastTimestamp<=e.maxAge})},n.prototype.assignTracks=function(t,e,r){for(var o=Array.from(Array(e[0].length).keys()),i=[],s=0,a=Array.from(Array(t.length).keys());s<a.length;s++){var l=a[s];if(o.length!==0){for(var c=-1,u=-1,d=0,p=o;d<p.length;d++){var f=p[d],h=e[l][f];h>=this.minSimilarity&&h>u&&(c=f,u=h)}if(c>=0){var m=this.tracks[c];m=Object.assign(m,this.createTrack(t[l],r,m.id)),t[l].id=m.id;var g=o.indexOf(c);o.splice(g,1)}else i.push(l)}else i.push(l)}for(var y=0,v=i;y<v.length;y++){l=v[y];var w=this.createTrack(t[l],r);this.tracks.push(w),t[l].id=w.id}},n.prototype.updateTracks=function(t){this.tracks.sort(function(e,r){return r.lastTimestamp-e.lastTimestamp}),this.tracks=this.tracks.slice(0,this.maxTracks)},n.prototype.createTrack=function(t,e,r){var o={id:r||this.nextTrackID(),lastTimestamp:e,keypoints:Qm([],t.keypoints,!0).map(function(i){return Zn({},i)})};return t.box!==void 0&&(o.box=Zn({},t.box)),o},n.prototype.nextTrackID=function(){var t=this.nextID;return this.nextID+=1,t},n.prototype.remove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.tracks=this.tracks.filter(function(r){return!t.includes(r.id)})},n.prototype.reset=function(){this.tracks=[]},n}(),HHe=function(n){function t(e){return n.call(this,e)||this}return pue(t,n),t.prototype.computeSimilarity=function(e){var r=this;return e.length===0||this.tracks.length===0?[[]]:e.map(function(o){return r.tracks.map(function(i){return r.iou(o,i)})})},t.prototype.iou=function(e,r){var o=Math.max(e.box.xMin,r.box.xMin),i=Math.max(e.box.yMin,r.box.yMin),s=Math.min(e.box.xMax,r.box.xMax),a=Math.min(e.box.yMax,r.box.yMax);if(o>=s||i>=a)return 0;var l=(s-o)*(a-i);return l/(e.box.width*e.box.height+r.box.width*r.box.height-l)},t}(Cue),qHe=function(n){function t(e){var r=n.call(this,e)||this;return r.keypointThreshold=e.keypointTrackerParams.keypointConfidenceThreshold,r.keypointFalloff=e.keypointTrackerParams.keypointFalloff,r.minNumKeyoints=e.keypointTrackerParams.minNumberOfKeypoints,r}return pue(t,n),t.prototype.computeSimilarity=function(e){if(e.length===0||this.tracks.length===0)return[[]];for(var r=[],o=0,i=e;o<i.length;o++){for(var s=i[o],a=[],l=0,c=this.tracks;l<c.length;l++){var u=c[l];a.push(this.oks(s,u))}r.push(a)}return r},t.prototype.oks=function(e,r){for(var o=this.area(r.keypoints)+1e-6,i=0,s=0,a=0;a<e.keypoints.length;++a){var l=e.keypoints[a],c=r.keypoints[a];if(!(l.score<this.keypointThreshold||c.score<this.keypointThreshold)){s+=1;var u=Math.pow(l.x-c.x,2)+Math.pow(l.y-c.y,2),d=2*this.keypointFalloff[a];i+=Math.exp(-1*u/(2*o*Math.pow(d,2)))}}return s<this.minNumKeyoints?0:i/s},t.prototype.area=function(e){var r=this,o=e.filter(function(l){return l.score>r.keypointThreshold}),i=Math.min.apply(Math,Qm([1],o.map(function(l){return l.x}),!1)),s=Math.max.apply(Math,Qm([0],o.map(function(l){return l.x}),!1)),a=Math.min.apply(Math,Qm([1],o.map(function(l){return l.y}),!1));return(s-i)*(Math.max.apply(Math,Qm([0],o.map(function(l){return l.y}),!1))-a)},t}(Cue);function _ue(n){switch(n){case zo.BlazePose:return Vw.reduce(function(t,e,r){return t[e]=r,t},{});case zo.PoseNet:case zo.MoveNet:return Pu.reduce(function(t,e,r){return t[e]=r,t},{});default:throw new Error("Model ".concat(n," is not supported."))}}(function(n){n.Keypoint="keypoint",n.BoundingBox="boundingBox"})(Jm||(Jm={})),function(n){n.MoveNet="MoveNet",n.BlazePose="BlazePose",n.PoseNet="PoseNet"}(zo||(zo={}));var Lor=Object.freeze({__proto__:null,getKeypointIndexBySide:function(n){switch(n){case zo.BlazePose:return cHe;case zo.PoseNet:case zo.MoveNet:return uHe;default:throw new Error("Model ".concat(n," is not supported."))}},getAdjacentPairs:function(n){switch(n){case zo.BlazePose:return pHe;case zo.PoseNet:case zo.MoveNet:return dHe;default:throw new Error("Model ".concat(n," is not supported."))}},getKeypointIndexByName:_ue}),Wce=["SinglePose.Lightning","SinglePose.Thunder","MultiPose.Lightning"],Sue={modelType:"SinglePose.Lightning",enableSmoothing:!0},Gce={},jce={frequency:30,minCutOff:2.5,beta:300,derivateCutOff:2.5,thresholdCutOff:.5,thresholdBeta:5,disableValueScaling:!0},z3={maxTracks:18,maxAge:1e3,minSimilarity:.2,keypointTrackerParams:{keypointConfidenceThreshold:.3,keypointFalloff:[.026,.025,.025,.035,.035,.079,.079,.072,.072,.062,.062,.107,.107,.087,.087,.089,.089],minNumberOfKeypoints:4}},Hce={maxTracks:18,maxAge:1e3,minSimilarity:.15,trackerParams:{}};function KHe(n,t,e,r){for(var o={},i=0,s=Pu;i<s.length;i++){var a=s[i];o[a]=[t[e[a]].y*r.height,t[e[a]].x*r.width]}if(function(v,w){return(v[w.left_hip].score>.2||v[w.right_hip].score>.2)&&(v[w.left_shoulder].score>.2||v[w.right_shoulder].score>.2)}(t,e)){var l=(o.left_hip[0]+o.right_hip[0])/2,c=(o.left_hip[1]+o.right_hip[1])/2,u=function(v,w,C,I,A){for(var M=["left_shoulder","right_shoulder","left_hip","right_hip"],$=0,V=0,W=0;W<M.length;W++)(ie=Math.abs(I-C[M[W]][0]))>$&&($=ie),(se=Math.abs(A-C[M[W]][1]))>V&&(V=se);for(var K=0,te=0,ee=0,oe=Object.keys(C);ee<oe.length;ee++){var ie,se,fe=oe[ee];v[w[fe]].score<.2||((ie=Math.abs(I-C[fe][0]))>K&&(K=ie),(se=Math.abs(A-C[fe][1]))>te&&(te=se))}return[$,V,K,te]}(t,e,o,l,c),d=u[0],p=u[1],f=u[2],h=u[3],m=Math.max(1.9*p,1.9*d,1.2*f,1.2*h),g=[l-(m=Math.min(m,Math.max(c,r.width-c,l,r.height-l))),c-m];if(m>Math.max(r.width,r.height)/2)return K3(n==null,r);var y=2*m;return{yMin:g[0]/r.height,xMin:g[1]/r.width,yMax:(g[0]+y)/r.height,xMax:(g[1]+y)/r.width,height:(g[0]+y)/r.height-g[0]/r.height,width:(g[1]+y)/r.width-g[1]/r.width}}return K3(n==null,r)}function K3(n,t){var e,r,o,i;return n?t.width>t.height?(e=1,r=t.height/t.width,o=0,i=(t.width/2-t.height/2)/t.width):(e=t.width/t.height,r=1,o=(t.height/2-t.width/2)/t.height,i=0):t.width>t.height?(e=t.width/t.height,r=1,o=(t.height/2-t.width/2)/t.height,i=0):(e=1,r=t.height/t.width,o=0,i=(t.width/2-t.height/2)/t.width),{yMin:o,xMin:i,yMax:o+e,xMax:i+r,height:e,width:r}}function XHe(n){var t,e=n==null?Sue:Zn({},n);if(e.modelType==null)e.modelType="SinglePose.Lightning";else if(Wce.indexOf(e.modelType)<0)throw new Error("Invalid architecture ".concat(e.modelType,". ")+"Should be one of ".concat(Wce));if(e.enableSmoothing==null&&(e.enableSmoothing=!0),e.minPoseScore!=null&&(e.minPoseScore<0||e.minPoseScore>1))throw new Error("minPoseScore should be between 0.0 and 1.0");if(e.multiPoseMaxDimension!=null&&(e.multiPoseMaxDimension%32!=0||e.multiPoseMaxDimension<32))throw new Error("multiPoseMaxDimension must be a multiple of 32 and higher than 0");if(e.modelType==="MultiPose.Lightning"&&e.enableTracking==null&&(e.enableTracking=!0),e.modelType==="MultiPose.Lightning"&&e.enableTracking===!0)if(e.trackerType==null&&(e.trackerType=Jm.BoundingBox),e.trackerType===Jm.Keypoint)e.trackerConfig!=null?e.trackerConfig=function(r){var o=qce(z3,r);return o.keypointTrackerParams=Zn({},z3.keypointTrackerParams),r.keypointTrackerParams!=null&&(r.keypointTrackerParams.keypointConfidenceThreshold!=null&&(o.keypointTrackerParams.keypointConfidenceThreshold=r.keypointTrackerParams.keypointConfidenceThreshold),r.keypointTrackerParams.keypointFalloff!=null&&(o.keypointTrackerParams.keypointFalloff=r.keypointTrackerParams.keypointFalloff),r.keypointTrackerParams.minNumberOfKeypoints!=null&&(o.keypointTrackerParams.minNumberOfKeypoints=r.keypointTrackerParams.minNumberOfKeypoints)),o}(e.trackerConfig):e.trackerConfig=z3;else{if(e.trackerType!==Jm.BoundingBox)throw new Error("Tracker type not supported by MoveNet");e.trackerConfig!=null?e.trackerConfig=(t=e.trackerConfig,qce(Hce,t)):e.trackerConfig=Hce}return e}function qce(n,t){var e={maxTracks:n.maxTracks,maxAge:n.maxAge,minSimilarity:n.minSimilarity};return t.maxTracks!=null&&(e.maxTracks=t.maxTracks),t.maxAge!=null&&(e.maxAge=t.maxAge),t.minSimilarity!=null&&(e.minSimilarity=t.minSimilarity),e}var YHe=function(){function n(t,e){this.moveNetModel=t,this.modelInputResolution={height:0,width:0},this.keypointIndexByName=_ue(zo.MoveNet),e.modelType==="SinglePose.Lightning"?(this.modelInputResolution.width=192,this.modelInputResolution.height=192):e.modelType==="SinglePose.Thunder"&&(this.modelInputResolution.width=256,this.modelInputResolution.height=256),this.multiPoseModel=e.modelType==="MultiPose.Lightning",this.multiPoseModel||(this.keypointFilter=new q3(jce),this.cropRegionFilterYMin=new ch(.9),this.cropRegionFilterXMin=new ch(.9),this.cropRegionFilterYMax=new ch(.9),this.cropRegionFilterXMax=new ch(.9)),this.enableSmoothing=e.enableSmoothing,e.minPoseScore?this.minPoseScore=e.minPoseScore:this.minPoseScore=.25,e.multiPoseMaxDimension?this.multiPoseMaxDimension=e.multiPoseMaxDimension:this.multiPoseMaxDimension=256,this.enableTracking=e.enableTracking,this.multiPoseModel&&this.enableTracking&&(e.trackerType===Jm.Keypoint?this.tracker=new qHe(e.trackerConfig):e.trackerType===Jm.BoundingBox&&(this.tracker=new HHe(e.trackerConfig)),this.enableSmoothing&&(this.keypointFilterMap=new Map))}return n.prototype.runSinglePersonPoseModel=function(t){return dn(this,void 0,void 0,function(){var e,r,o,i,s;return pn(this,function(a){switch(a.label){case 0:if((e=this.moveNetModel.execute(t)).shape.length!==4||e.shape[0]!==1||e.shape[1]!==1||e.shape[2]!==17||e.shape[3]!==3)throw e.dispose(),new Error("Unexpected output shape from model: [".concat(e.shape,"]"));return sm()==="webgpu"?[3,1]:(r=e.dataSync(),[3,3]);case 1:return[4,e.data()];case 2:r=a.sent(),a.label=3;case 3:for(e.dispose(),o={keypoints:[],score:0},i=0,s=0;s<17;++s)o.keypoints[s]={y:r[3*s],x:r[3*s+1],score:r[3*s+2]},o.keypoints[s].score>.2&&(++i,o.score+=o.keypoints[s].score);return i>0&&(o.score/=i),[2,o]}})})},n.prototype.runMultiPersonPoseModel=function(t){return dn(this,void 0,void 0,function(){var e,r,o,i,s,a,l,c;return pn(this,function(u){switch(u.label){case 0:if((e=this.moveNetModel.execute(t)).shape.length!==3||e.shape[0]!==1||e.shape[2]!==56)throw e.dispose(),new Error("Unexpected output shape from model: [".concat(e.shape,"]"));return sm()==="webgpu"?[3,1]:(r=e.dataSync(),[3,3]);case 1:return[4,e.data()];case 2:r=u.sent(),u.label=3;case 3:for(e.dispose(),o=[],i=r.length/56,s=0;s<i;++s)for(o[s]={keypoints:[]},a=56*s+51,o[s].box={yMin:r[a],xMin:r[a+1],yMax:r[a+2],xMax:r[a+3],width:r[a+3]-r[a+1],height:r[a+2]-r[a]},l=56*s+55,o[s].score=r[l],o[s].keypoints=[],c=0;c<17;++c)o[s].keypoints[c]={y:r[56*s+3*c],x:r[56*s+3*c+1],score:r[56*s+3*c+2]};return[2,o]}})})},n.prototype.estimatePoses=function(t,e,r){return e===void 0&&(e=Gce),dn(this,void 0,void 0,function(){var o,i,s,a,l,c;return pn(this,function(u){switch(u.label){case 0:return e=function(d){return d==null?Gce:Zn({},d)}(e),t==null?(this.reset(),[2,[]]):(r==null?bue(t)&&(r=1e6*t.currentTime):r*=1e3,o=X3(t),i=Ev(o),s=On(o,0),t instanceof bt||o.dispose(),a=[],this.multiPoseModel?[3,2]:[4,this.estimateSinglePose(s,i,r)]);case 1:return a=u.sent(),[3,4];case 2:return[4,this.estimateMultiplePoses(s,i,r)];case 3:a=u.sent(),u.label=4;case 4:for(l=0;l<a.length;++l)for(c=0;c<a[l].keypoints.length;++c)a[l].keypoints[c].name=Pu[c],a[l].keypoints[c].y*=i.height,a[l].keypoints[c].x*=i.width;return[2,a]}})})},n.prototype.estimateSinglePose=function(t,e,r){return dn(this,void 0,void 0,function(){var o,i,s,a,l=this;return pn(this,function(c){switch(c.label){case 0:return this.cropRegion||(this.cropRegion=K3(this.cropRegion==null,e)),o=Z(function(){var u=Fo([[l.cropRegion.yMin,l.cropRegion.xMin,l.cropRegion.yMax,l.cropRegion.xMax]]),d=hn([1],"int32"),p=[l.modelInputResolution.height,l.modelInputResolution.width];return me(kr.cropAndResize(t,u,d,p,"bilinear",0),"int32")}),t.dispose(),[4,this.runSinglePersonPoseModel(o)];case 1:if(i=c.sent(),o.dispose(),i.score<this.minPoseScore)return this.reset(),[2,[]];for(s=0;s<i.keypoints.length;++s)i.keypoints[s].y=this.cropRegion.yMin+i.keypoints[s].y*this.cropRegion.height,i.keypoints[s].x=this.cropRegion.xMin+i.keypoints[s].x*this.cropRegion.width;return r!=null&&this.enableSmoothing&&(i.keypoints=this.keypointFilter.apply(i.keypoints,r,1)),a=KHe(this.cropRegion,i.keypoints,this.keypointIndexByName,e),this.cropRegion=this.filterCropRegion(a),[2,[i]]}})})},n.prototype.estimateMultiplePoses=function(t,e,r){return dn(this,void 0,void 0,function(){var o,i,s,a,l,c,u,d,p,f,h,m=this;return pn(this,function(g){switch(g.label){case 0:return e.width>e.height?(i=this.multiPoseMaxDimension,s=Math.round(this.multiPoseMaxDimension*e.height/e.width),o=kr.resizeBilinear(t,[s,i]),l=i,c=32*Math.ceil(s/32),a=to(o,[[0,0],[0,c-s],[0,0],[0,0]])):(i=Math.round(this.multiPoseMaxDimension*e.width/e.height),s=this.multiPoseMaxDimension,o=kr.resizeBilinear(t,[s,i]),l=32*Math.ceil(i/32),c=s,a=to(o,[[0,0],[0,0],[0,l-i],[0,0]])),o.dispose(),t.dispose(),u=me(a,"int32"),a.dispose(),[4,this.runMultiPersonPoseModel(u)];case 1:for(d=g.sent(),u.dispose(),d=d.filter(function(y){return y.score>=m.minPoseScore}),f=0;f<d.length;++f)for(p=0;p<d[f].keypoints.length;++p)d[f].keypoints[p].y*=c/s,d[f].keypoints[p].x*=l/i;if(this.enableTracking&&(this.tracker.apply(d,r),this.enableSmoothing)){for(f=0;f<d.length;++f)this.keypointFilterMap.has(d[f].id)||this.keypointFilterMap.set(d[f].id,new q3(jce)),d[f].keypoints=this.keypointFilterMap.get(d[f].id).apply(d[f].keypoints,r,1);h=this.tracker.getTrackIDs(),this.keypointFilterMap.forEach(function(y,v){h.has(v)||m.keypointFilterMap.delete(v)})}return[2,d]}})})},n.prototype.filterCropRegion=function(t){if(t){var e=this.cropRegionFilterYMin.apply(t.yMin),r=this.cropRegionFilterXMin.apply(t.xMin),o=this.cropRegionFilterYMax.apply(t.yMax),i=this.cropRegionFilterXMax.apply(t.xMax);return{yMin:e,xMin:r,yMax:o,xMax:i,height:o-e,width:i-r}}return this.cropRegionFilterYMin.reset(),this.cropRegionFilterXMin.reset(),this.cropRegionFilterYMax.reset(),this.cropRegionFilterXMax.reset(),null},n.prototype.dispose=function(){this.moveNetModel.dispose()},n.prototype.reset=function(){this.cropRegion=null,this.resetFilters()},n.prototype.resetFilters=function(){this.keypointFilter.reset(),this.cropRegionFilterYMin.reset(),this.cropRegionFilterXMin.reset(),this.cropRegionFilterYMax.reset(),this.cropRegionFilterXMax.reset()},n}();function ZHe(n){return n===void 0&&(n=Sue),dn(this,void 0,void 0,function(){var t,e,r,o;return pn(this,function(i){switch(i.label){case 0:return t=XHe(n),r=!0,t.modelUrl?(r=typeof t.modelUrl=="string"&&t.modelUrl.indexOf("https://tfhub.dev")>-1,[4,Qf(t.modelUrl,{fromTFHub:r})]):[3,2];case 1:return e=i.sent(),[3,4];case 2:return o=void 0,t.modelType==="SinglePose.Lightning"?o="https://tfhub.dev/google/tfjs-model/movenet/singlepose/lightning/4":t.modelType==="SinglePose.Thunder"?o="https://tfhub.dev/google/tfjs-model/movenet/singlepose/thunder/4":t.modelType==="MultiPose.Lightning"&&(o="https://tfhub.dev/google/tfjs-model/movenet/multipose/lightning/1"),[4,Qf(o,{fromTFHub:r})];case 3:e=i.sent(),i.label=4;case 4:return sm()==="webgl"&&q().set("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",0),[2,new YHe(e,t)]}})})}var Kce={architecture:"MobileNetV1",outputStride:16,multiplier:.75,inputResolution:{height:257,width:257}},Xce=["MobileNetV1","ResNet50"],Yce={MobileNetV1:[8,16],ResNet50:[16]},QHe=[8,16,32],Zce={MobileNetV1:[.5,.75,1],ResNet50:[1]},Qce=[1,2,4],Jce={maxPoses:1,flipHorizontal:!1},JHe={maxPoses:5,flipHorizontal:!1,scoreThreshold:.5,nmsRadius:20},e6e=[-123.15,-115.9,-103.06];function U3(n){return Math.floor(n/2)}var t6e=function(){function n(t,e){this.priorityQueue=new Array(t),this.numberOfElements=-1,this.getElementValue=e}return n.prototype.enqueue=function(t){this.priorityQueue[++this.numberOfElements]=t,this.swim(this.numberOfElements)},n.prototype.dequeue=function(){var t=this.priorityQueue[0];return this.exchange(0,this.numberOfElements--),this.sink(0),this.priorityQueue[this.numberOfElements+1]=null,t},n.prototype.empty=function(){return this.numberOfElements===-1},n.prototype.size=function(){return this.numberOfElements+1},n.prototype.all=function(){return this.priorityQueue.slice(0,this.numberOfElements+1)},n.prototype.max=function(){return this.priorityQueue[0]},n.prototype.swim=function(t){for(;t>0&&this.less(U3(t),t);)this.exchange(t,U3(t)),t=U3(t)},n.prototype.sink=function(t){for(;2*t<=this.numberOfElements;){var e=2*t;if(e<this.numberOfElements&&this.less(e,e+1)&&e++,!this.less(t,e))break;this.exchange(t,e),t=e}},n.prototype.getValueAt=function(t){return this.getElementValue(this.priorityQueue[t])},n.prototype.less=function(t,e){return this.getValueAt(t)<this.getValueAt(e)},n.prototype.exchange=function(t,e){var r=this.priorityQueue[t];this.priorityQueue[t]=this.priorityQueue[e],this.priorityQueue[e]=r},n}();function n6e(n,t,e,r,o,i){for(var s=i.shape,a=s[0],l=s[1],c=!0,u=Math.max(e-o,0),d=Math.min(e+o+1,a),p=u;p<d;++p){for(var f=Math.max(r-o,0),h=Math.min(r+o+1,l),m=f;m<h;++m)if(i.get(p,m,n)>t){c=!1;break}if(!c)break}return c}function r6e(n){return dn(this,void 0,void 0,function(){return pn(this,function(t){return[2,Promise.all(n.map(function(e){return e.buffer()}))]})})}function Iue(n,t,e,r){return{y:r.get(n,t,e),x:r.get(n,t,e+17)}}function Eue(n,t,e){var r=Iue(n.heatmapY,n.heatmapX,n.id,e),o=r.y,i=r.x;return{x:n.heatmapX*t+i,y:n.heatmapY*t+o}}function Tue(n,t,e,r){var o=e.x,i=e.y;return n.some(function(s){var a,l,c,u,d,p,f=s.keypoints;return a=i,l=o,c=f[r].y,u=f[r].x,(d=c-a)*d+(p=u-l)*p<=t})}var eue=Pu.reduce(function(n,t,e){return n[t]=e,n},{}),Due=[["nose","left_eye"],["left_eye","left_ear"],["nose","right_eye"],["right_eye","right_ear"],["nose","left_shoulder"],["left_shoulder","left_elbow"],["left_elbow","left_wrist"],["left_shoulder","left_hip"],["left_hip","left_knee"],["left_knee","left_ankle"],["nose","right_shoulder"],["right_shoulder","right_elbow"],["right_elbow","right_wrist"],["right_shoulder","right_hip"],["right_hip","right_knee"],["right_knee","right_ankle"]].map(function(n){var t=n[0],e=n[1];return[eue[t],eue[e]]}),W3=Due.map(function(n){return n[1]}),tue=Due.map(function(n){return n[0]});function nue(n,t,e){return n<t?t:n>e?e:n}function G3(n,t,e,r){return{y:nue(Math.round(n.y/t),0,e-1),x:nue(Math.round(n.x/t),0,r-1)}}function rue(n,t){return{x:n.x+t.x,y:n.y+t.y}}function oue(n,t,e,r,o,i,s,a){a===void 0&&(a=2);for(var l=r.shape,c=l[0],u=l[1],d={y:t.y,x:t.x},p=rue(d,function(v,w,C){var I=C.shape[2]/2;return{y:C.get(w.y,w.x,v),x:C.get(w.y,w.x,I+v)}}(n,G3(d,i,c,u),s)),f=0;f<a;f++){var h=G3(p,i,c,u),m=Iue(h.y,h.x,e,o);p=rue({x:h.x*i,y:h.y*i},{x:m.x,y:m.y})}var g=G3(p,i,c,u),y=r.get(g.y,g.x,e);return{y:p.y,x:p.x,name:Pu[e],score:y}}function o6e(n,t,e,r,o,i){var s=t.shape[2],a=W3.length,l=new Array(s),c=n.part,u=n.score,d=Eue(c,r,e);l[c.id]={score:u,name:Pu[c.id],y:d.y,x:d.x};for(var p=a-1;p>=0;--p){var f=W3[p],h=tue[p];l[f]&&!l[h]&&(l[h]=oue(p,l[f],h,t,e,r,i))}for(p=0;p<a;++p)f=tue[p],h=W3[p],l[f]&&!l[h]&&(l[h]=oue(p,l[f],h,t,e,r,o));return l}function i6e(n,t,e){return e.reduce(function(r,o,i){var s=o.y,a=o.x,l=o.score;return Tue(n,t,{y:s,x:a},i)||(r+=l),r},0)/e.length}function s6e(n,t,e,r,o,i,s,a){return s===void 0&&(s=.5),a===void 0&&(a=20),dn(this,void 0,void 0,function(){var l,c,u,d,p,f,h,m,g,y,v,w;return pn(this,function(C){switch(C.label){case 0:return[4,r6e([n,t,e,r])];case 1:for(l=C.sent(),c=l[0],u=l[1],d=l[2],p=l[3],f=[],h=function(I,A,M){for(var $=M.shape,V=$[0],W=$[1],K=$[2],te=new t6e(V*W*K,function(fe){return fe.score}),ee=0;ee<V;++ee)for(var oe=0;oe<W;++oe)for(var ie=0;ie<K;++ie){var se=M.get(ee,oe,ie);se<I||n6e(ie,se,ee,oe,A,M)&&te.enqueue({score:se,part:{heatmapY:ee,heatmapX:oe,id:ie}})}return te}(s,1,c),m=a*a;f.length<i&&!h.empty();)g=h.dequeue(),y=Eue(g.part,o,u),Tue(f,m,y,g.part.id)||(v=o6e(g,c,u,o,d,p),w=i6e(f,m,v),f.push({keypoints:v,score:w}));return[2,f]}})})}function kue(){for(var n,t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];switch(t.length){case 0:n="fn main() ";break;case 1:n="fn main(".concat(t[0]," : i32)");break;default:throw Error("Unreachable")}return n}var a6e=function(){function n(t){this.variableNames=["A","B"],this.size=!0,this.workgroupSize=[32,1,1],this.outputShape=[t[0],1],this.dispatchLayout=ah.flatDispatchLayout(this.outputShape),this.dispatch=ah.computeDispatch(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="getpointsConfidenceOp"}return n.prototype.getUserCode=function(){return`
        `.concat(kue("index"),` {
          if (index < uniforms.size) {
            let y = B[index * 2];
            let x = B[index * 2 + 1];
            let outIndex = y * uniforms.aShape.x * uniforms.aShape.z + x * uniforms.aShape.z + index;
            result[index] = A[outIndex];
          }
        }
        `)},n}();function l6e(n,t){if(mu()instanceof mv)return function(e,r){var o=mu(),i=new a6e(r.shape),s=o.runWebGPUProgram(i,[e,r],"float32");return Zr().makeTensorFromTensorInfo(s)}(n,t);throw new Error("getPointsConfidenceWebGPU is not supported in this backend!")}var c6e=function(){function n(t){if(this.variableNames=["A","B"],this.size=!0,this.supportedLastDimension=2,t.length!==2||t[1]!==this.supportedLastDimension)throw new Error("GetOffsetVectorsProgram only supports shape of [x, ".concat(this.supportedLastDimension,"], but current shape is ").concat(t));this.workgroupSize=[32,1,1],this.outputShape=t;var e=[t[0],1];this.dispatchLayout=ah.flatDispatchLayout(e),this.dispatch=ah.computeDispatch(this.dispatchLayout,e,this.workgroupSize),this.shaderKey="GetOffsetVectors"}return n.prototype.getUserCode=function(){return`
    fn getOffsetPoint(y: i32, x: i32, index: i32) -> vec2<i32> {
      let outIndexY = y * uniforms.bShape.x * uniforms.bShape.y + x * uniforms.bShape.y + index;
      let outIndexX = outIndexY + uniforms.bShape.z;
      let outY = i32(B[outIndexY]);
      let outX = i32(B[outIndexX]);
      return vec2<i32>(outY, outX);
    }

    `.concat(kue("index"),` {
      if (index < uniforms.size) {
        let indexY = index * `).concat(this.supportedLastDimension,`;
        let indexX = indexY + 1;
        let heatmapY = A[indexY];
        let heatmapX = A[indexX];
        let out = getOffsetPoint(i32(heatmapY), i32(heatmapX), index);
        result[indexY] = f32(out[0]);
        result[indexX] = f32(out[1]);
      }
    }
    `)},n}();function u6e(n,t){if(mu()instanceof mv)return function(e,r){var o=mu(),i=new c6e(e.shape),s=o.runWebGPUProgram(i,[e,r],"float32");return Zr().makeTensorFromTensorInfo(s)}(n,t);throw new Error("getOffsetVectorsGPU is not supported in this backend!")}function Nue(n){var t=n.shape,e=t[0],r=t[1],o=t[2];return Z(function(){var i,s,a=G(n,[e*r,o]),l=js(a,0),c=On(Se(l,Ae(r,"int32")),1),u=On((i=l,s=r,Z(function(){var d=Se(i,Ae(s,"int32"));return Ie(i,U(d,Ae(s,"int32")))})),1);return Gt([c,u],1)})}function d6e(n,t,e){return Z(function(){var r=function(o,i){for(var s=[],a=0;a<Pu.length;a++){var l=o.get(a,0).valueOf(),c=o.get(a,1).valueOf(),u=p6e(l,c,a,i),d=u.x,p=u.y;s.push(p),s.push(d)}return Fo(s,[Pu.length,2])}(n,e);return ae(me(U(n.toTensor(),Ae(t,"int32")),"float32"),r)})}function p6e(n,t,e,r){return{y:r.get(n,t,e),x:r.get(n,t,e+Pu.length)}}function f6e(n,t,e){return dn(this,void 0,void 0,function(){var r,o,i,s,a,l,c,u,d,p;return pn(this,function(f){switch(f.label){case 0:return r=0,o=Nue(n),[4,Promise.all([n.buffer(),t.buffer(),o.buffer()])];case 1:return i=f.sent(),s=i[0],a=i[1],l=i[2],[4,(c=d6e(l,e,a)).buffer()];case 2:return u=f.sent(),d=Array.from(function(h,m){for(var g=m.shape[0],y=new Float32Array(g),v=0;v<g;v++){var w=m.get(v,0),C=m.get(v,1);y[v]=h.get(w,C,v)}return y}(s,l)),p=d.map(function(h,m){return r+=h,{y:u.get(m,0),x:u.get(m,1),score:h,name:Pu[m]}}),o.dispose(),c.dispose(),[2,{keypoints:p,score:r/p.length}]}})})}function h6e(n,t,e){return dn(this,void 0,void 0,function(){var r,o,i;return pn(this,function(s){return r=Nue(n),o=function(a,l,c){return Z(function(){var u=u6e(a,c);return ae(me(U(a,Ae(l,"int32")),"float32"),u)})}(r,e,t),i=l6e(n,r),[2,[o,i]]})})}function iue(n,t){return(n-1)%t==0}var sue="https://storage.googleapis.com/tfjs-models/savedmodel/posenet/mobilenet/",aue="https://storage.googleapis.com/tfjs-models/savedmodel/posenet/resnet50/";function lue(n,t){return function(e,r){return(e-1)%r==0}(n,t)?n:Math.floor(n/t)*t+1}var cue=function(){function n(t,e){this.posenetModel=t;var r=this.posenetModel.inputs[0].shape;b.assert(r[1]===-1&&r[2]===-1,function(){return"Input shape [".concat(r[1],", ").concat(r[2],"] ")+"must both be equal to or -1"});var o,i,s=(o=e.inputResolution,i=e.outputStride,{height:lue(o.height,i),width:lue(o.width,i)});(function(a){b.assert(QHe.indexOf(a)>=0,function(){return"outputStride of ".concat(a," is invalid. ")+"It must be either 8 or 16."})})(e.outputStride),function(a,l){b.assert(iue(a.height,l),function(){return"height of ".concat(a.height," is invalid for output stride ")+"".concat(l,".")}),b.assert(iue(a.width,l),function(){return"width of ".concat(a.width," is invalid for output stride ")+"".concat(l,".")})}(s,e.outputStride),this.inputResolution=s,this.outputStride=e.outputStride,this.architecture=e.architecture}return n.prototype.estimatePoses=function(t,e){return e===void 0&&(e=Jce),dn(this,void 0,void 0,function(){return pn(this,function(r){return[2,this.estimatePosesGPU(t,e,!1)]})})},n.prototype.estimatePosesGPU=function(t,e,r){return e===void 0&&(e=Jce),r===void 0&&(r=!1),dn(this,void 0,void 0,function(){var o,i,s,a,l,c,u,d,p,f,h,m,g,y,v,w,C,I;return pn(this,function(A){switch(A.label){case 0:return o=function(M){var $=M;if($.maxPoses==null&&($.maxPoses=1),$.maxPoses<=0)throw new Error("Invalid maxPoses ".concat($.maxPoses,". Should be > 0."));if($.maxPoses>1){if(($=Zn(Zn({},JHe),$)).scoreThreshold<0||$.scoreThreshold>1)throw new Error("Invalid scoreThreshold ".concat($.scoreThreshold,". ")+"Should be in range [0.0, 1.0]");if($.nmsRadius<=0)throw new Error("Invalid nmsRadius ".concat($.nmsRadius,"."))}return $}(e),t==null?[2,r?[[],[]]:[]]:(this.maxPoses=o.maxPoses,i=H3(t,{outputTensorSize:this.inputResolution,keepAspectRatio:!0,borderMode:"replicate"}),s=i.imageTensor,a=i.padding,l=this.architecture==="ResNet50"?ae(s,e6e):vue(s,[-1,1]),c=this.posenetModel.predict(l),this.architecture==="ResNet50"?(u=qt(c[2],[0]),d=qt(c[3],[0]),p=qt(c[0],[0]),f=qt(c[1],[0])):(u=qt(c[0],[0]),d=qt(c[1],[0]),p=qt(c[2],[0]),f=qt(c[3],[0])),h=jr(d),this.maxPoses!==1?[3,5]:r?[4,h6e(h,u,this.outputStride)]:[3,2]);case 1:return g=A.sent(),v=g[0],y=g[1],m=[v,y],[3,4];case 2:return[4,f6e(h,u,this.outputStride)];case 3:v=A.sent(),m=[v],A.label=4;case 4:return[3,7];case 5:if(r)throw new Error("GPU renderer only supports single pose!");return[4,s6e(h,u,p,f,this.outputStride,this.maxPoses,o.scoreThreshold,o.nmsRadius)];case 6:m=A.sent(),A.label=7;case 7:if(r){if(o.flipHorizontal===!0)throw new Error("flipHorizontal is not supported!");w=this.getCanvasInfo(Ev(t),this.inputResolution,a)}else I=Ev(t),C=function(M,$,V,W){var K=$.height,te=$.width,ee=K/(V.height*(1-W.top-W.bottom)),oe=te/(V.width*(1-W.left-W.right)),ie=-W.top*V.height,se=-W.left*V.width;if(oe===1&&ee===1&&ie===0&&se===0)return M;for(var fe=0,ue=M;fe<ue.length;fe++)for(var ye=0,Te=ue[fe].keypoints;ye<Te.length;ye++){var De=Te[ye];De.x=(De.x+se)*oe,De.y=(De.y+ie)*ee}return M}(m,I,this.inputResolution,a),o.flipHorizontal&&(C=function(M,$){for(var V=0,W=M;V<W.length;V++)for(var K=0,te=W[V].keypoints;K<te.length;K++){var ee=te[K];ee.x=$.width-1-ee.x}return M}(C,I));return s.dispose(),l.dispose(),He(c),u.dispose(),d.dispose(),p.dispose(),f.dispose(),h.dispose(),[2,r?[m,w]:C]}})})},n.prototype.getCanvasInfo=function(t,e,r){var o=t.height,i=t.width,s=o/(e.height*(1-r.top-r.bottom)),a=i/(e.width*(1-r.left-r.right)),l=-r.top*e.height;return[-r.left*e.width,l,a,s,t.width,t.height]},n.prototype.dispose=function(){this.posenetModel.dispose()},n.prototype.reset=function(){},n}();function m6e(n){return n===void 0&&(n=Kce),dn(this,void 0,void 0,function(){var t,e,r,o,i;return pn(this,function(s){switch(s.label){case 0:return(t=function(u){var d=u||Kce;if(d.architecture==null&&(d.architecture="MobileNetV1"),Xce.indexOf(d.architecture)<0)throw new Error("Invalid architecture ".concat(d.architecture,". ")+"Should be one of ".concat(Xce));if(d.inputResolution==null&&(d.inputResolution={height:257,width:257}),d.outputStride==null&&(d.outputStride=16),Yce[d.architecture].indexOf(d.outputStride)<0)throw new Error("Invalid outputStride ".concat(d.outputStride,". ")+"Should be one of ".concat(Yce[d.architecture]," ")+"for architecture ".concat(d.architecture,"."));if(d.multiplier==null&&(d.multiplier=1),Zce[d.architecture].indexOf(d.multiplier)<0)throw new Error("Invalid multiplier ".concat(d.multiplier,". ")+"Should be one of ".concat(Zce[d.architecture]," ")+"for architecture ".concat(d.architecture,"."));if(d.quantBytes==null&&(d.quantBytes=4),Qce.indexOf(d.quantBytes)<0)throw new Error("Invalid quantBytes ".concat(d.quantBytes,". ")+"Should be one of ".concat(Qce," ")+"for architecture ".concat(d.architecture,"."));if(d.architecture==="MobileNetV1"&&d.outputStride===32&&d.multiplier!==1)throw new Error("When using an output stride of 32, you must select 1 as the multiplier.");return d}(n)).architecture!=="ResNet50"?[3,2]:(a=t.outputStride,l=t.quantBytes,c="model-stride".concat(a,".json"),e=l===4?aue+"float/"+c:aue+"quant".concat(l,"/")+c,[4,Qf(t.modelUrl||e)]);case 1:return r=s.sent(),[2,new cue(r,t)];case 2:return o=function(u,d,p){var f={1:"100",.75:"075",.5:"050"},h="model-stride".concat(u,".json");return p===4?sue+"float/".concat(f[d],"/")+h:sue+"quant".concat(p,"/").concat(f[d],"/")+h}(t.outputStride,t.multiplier,t.quantBytes),[4,Qf(t.modelUrl||o)];case 3:return i=s.sent(),[2,new cue(i,t)]}var a,l,c})})}function Aue(n,t){return dn(this,void 0,void 0,function(){var e,r;return pn(this,function(o){switch(n){case zo.PoseNet:return[2,m6e(t)];case zo.BlazePose:if(r=void 0,(e=t)!=null){if(e.runtime==="tfjs")return[2,jHe(t)];if(e.runtime==="mediapipe")return[2,yHe(t)];r=e.runtime}throw new Error("Expect modelConfig.runtime to be either 'tfjs' "+"or 'mediapipe', but got ".concat(r));case zo.MoveNet:return[2,ZHe(t)];default:throw new Error("".concat(n," is not a supported model name."))}})})}var Rue={modelType:{SINGLEPOSE_LIGHTNING:"SinglePose.Lightning",SINGLEPOSE_THUNDER:"SinglePose.Thunder",MULTIPOSE_LIGHTNING:"MultiPose.Lightning"}};var y6e=["videoElement"],x6e=["canvasElement"],Tv=class n{constructor(t,e){this.http=t;this.dialogRef=e}videoElement;canvasElement;video;canvas;ctx;detector;isRecording=!1;startTime;duration=0;detectedExercise="";videoButtonTitle="Start Recording";email=localStorage.getItem("email");authService=Q(xn);notification=Q(Vn);ngAfterViewInit(){setTimeout(()=>{this.video=this.videoElement.nativeElement,this.canvas=this.canvasElement.nativeElement,this.ctx=this.canvas.getContext("2d")},500)}startWebcam(){return B(this,null,function*(){try{let t=yield navigator.mediaDevices.getUserMedia({video:!0});this.video?(this.video.srcObject=t,this.video.onloadedmetadata=()=>this.video.play()):console.error("Video element is not initialized."),this.isRecording=!0,this.videoButtonTitle="Recording...",this.startTime=Date.now(),yield this.loadPoseDetectionModel(),this.detectPose()}catch(t){console.error("Error accessing webcam:",t),alert("Error accessing the camera. Please check permissions.")}})}loadPoseDetectionModel(){return B(this,null,function*(){try{yield YP("webgl"),yield n5();let t={modelType:Rue.modelType.SINGLEPOSE_THUNDER};this.detector=yield Aue(zo.MoveNet,t),console.log("MoveNet Thunder model loaded successfully!")}catch(t){console.error("Error loading pose detection model:",t)}})}detectPose(){return B(this,null,function*(){if(!this.detector){console.error("Pose detector is not loaded.");return}let t=()=>B(this,null,function*(){if(!this.isRecording)return;let e=yield this.detector.estimatePoses(this.video);e.length>0&&(this.drawPose(e[0]),this.detectedExercise=this.identifyExercise(e[0])),requestAnimationFrame(t)});t()})}drawPose(t){this.ctx&&(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.drawImage(this.video,0,0,this.canvas.width,this.canvas.height),t.keypoints.forEach(e=>{e.score&&e.score>.5&&(this.ctx.beginPath(),this.ctx.arc(e.x,e.y,5,0,2*Math.PI),this.ctx.fillStyle="red",this.ctx.fill())}))}identifyExercise(t){if(!t.keypoints||t.keypoints.length===0)return"Unknown Exercise";let e={};t.keypoints.forEach(c=>{c.name&&(e[c.name]=c)});let r=e.left_wrist,o=e.right_wrist,i=e.left_knee,s=e.right_knee,a=e.left_hip,l=e.right_hip;return!r||!o||!i||!s||!a||!l?"Unknown Exercise":r.y>a.y&&o.y>l.y?"Push-Up":i.y>a.y&&s.y>l.y?"Squat":r.y<a.y&&o.y<l.y&&Math.abs(r.x-o.x)>50?"Jumping Jack":"Unknown Exercise"}stopRecording(){this.isRecording=!1,this.videoButtonTitle="Start Recording",this.duration=(Date.now()-this.startTime)/1e3,this.video.srcObject&&(this.video.srcObject.getTracks().forEach(t=>t.stop()),this.video.srcObject=null),this.saveExerciseData()}saveExerciseData(){let t={exercise:this.detectedExercise,duration:this.duration};this.email&&this.authService.addExerciseData(this.email,t).subscribe(e=>{this.notification.showNotification("Exercise data saved successfully","success")},e=>{console.error("Error saving exercise data:",e)})}closeModal(){this.dialogRef.close()}static \u0275fac=function(e){return new(e||n)(Be(Ea),Be(gb))};static \u0275cmp=Ct({type:n,selectors:[["app-exercise-detection"]],viewQuery:function(e,r){if(e&1&&(hp(y6e,5),hp(x6e,5)),e&2){let o;uc(o=dc())&&(r.videoElement=o.first),uc(o=dc())&&(r.canvasElement=o.first)}},decls:16,vars:4,consts:[["videoElement",""],["canvasElement",""],[1,"main"],[1,"record-video-btn"],["type","button",3,"click"],["type","button",3,"click","disabled"],[1,"record-video-container"],["id","preview","autoplay","","muted","",1,"video"],[1,"video-canvas"],[1,"results"]],template:function(e,r){if(e&1){let o=et();E(0,"div",2)(1,"div",3)(2,"button",4),_e("click",function(){return ve(o),be(r.startWebcam())}),O(3),S(),E(4,"button",5),_e("click",function(){return ve(o),be(r.stopRecording())}),O(5,"Stop Recording"),S()(),E(6,"div",6),ce(7,"video",7,0),S(),ce(9,"canvas",8,1),E(11,"div",9)(12,"span"),O(13),S(),E(14,"span"),O(15),S()()()}e&2&&(z(3),Ye(r.videoButtonTitle),z(),re("disabled",!r.isRecording),z(9),Tt("Detected Exercise : ",r.detectedExercise,"\xA0\xA0"),z(2),Tt("Duration : ",r.duration," seconds"))},styles:[".main[_ngcontent-%COMP%]{background-color:var(--light);position:fixed;inset:0;padding:16px;display:flex;flex-direction:column;justify-content:center;align-items:center}.modal[_ngcontent-%COMP%]{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#f30000!important;padding:20px;border-radius:10px;box-shadow:0 4px 10px #0003;text-align:center}button[_ngcontent-%COMP%]{margin:10px;padding:8px 12px;border:none;background:var(--shade-1);color:var(--dark);font-size:larger;font-weight:600;border-radius:5px;cursor:pointer}button[_ngcontent-%COMP%]:hover{background:#b3db00}"]})};function v6e(n,t){if(n&1){let e=et();E(0,"div",25)(1,"img",26),_e("click",function(){let o=ve(e).$implicit,i=le(2);return be(i.showInLargeView(o,"image"))}),S()()}if(n&2){let e=t.$implicit;z(),re("src",e,di)}}function b6e(n,t){if(n&1){let e=et();E(0,"div",25)(1,"img",27),_e("click",function(){let o=ve(e).$implicit,i=le(2);return be(i.showInLargeView(o,"video"))}),S()()}}function w6e(n,t){if(n&1&&ce(0,"img",28),n&2){let e=le(2);re("src",e.largeViewSrc,di)}}function C6e(n,t){if(n&1&&ce(0,"iframe",29),n&2){let e=le(2);re("src",e.largeViewSrc,f0)}}function _6e(n,t){if(n&1&&(E(0,"li"),O(1),S()),n&2){let e=t.$implicit;z(),Ye(e)}}function S6e(n,t){if(n&1&&(E(0,"li"),O(1),S()),n&2){let e=t.$implicit;z(),Ye(e)}}function I6e(n,t){n&1&&(E(0,"div"),O(1,"Loading plant details..."),S())}function E6e(n,t){if(n&1){let e=et();E(0,"div")(1,"div",3)(2,"div",4)(3,"div",5)(4,"div",6),Ne(5,v6e,2,1,"div",7)(6,b6e,2,0,"div",7),S(),E(7,"div",8)(8,"button",9),_e("click",function(){ve(e);let o=le();return be(o.sharePage())}),ce(9,"i",10),S(),E(10,"div",11),Ne(11,w6e,1,1,"img",12)(12,C6e,1,1,"iframe",13),S()()(),E(13,"div",14)(14,"a")(15,"button",15),_e("click",function(){ve(e);let o=le();return be(o.openExerciseModal())}),O(16,"Exercise Detection"),S()()()(),E(17,"div",16)(18,"div",17)(19,"h3"),O(20),S()(),E(21,"div",18)(22,"p")(23,"strong"),O(24,"Type:"),S(),O(25),S()(),E(26,"div",18)(27,"p")(28,"strong"),O(29,"Duration:"),S(),O(30),S()(),E(31,"div",18)(32,"p")(33,"strong"),O(34,"Category:"),S(),O(35),S()(),E(36,"div",19)(37,"div",20)(38,"strong"),O(39,"Description"),S()(),E(40,"p"),O(41),S()(),E(42,"div",21)(43,"div",20)(44,"strong"),O(45,"How to Perform"),S()(),E(46,"ul",22),Ne(47,_6e,2,1,"li",23),S()(),E(48,"div",19)(49,"div",20)(50,"strong"),O(51,"Benefits"),S()(),E(52,"p"),O(53),S()(),E(54,"div",19)(55,"div",20)(56,"strong"),O(57,"Limitations"),S()(),E(58,"p"),O(59),S()(),E(60,"div",24)(61,"div",20)(62,"strong"),O(63,"Equipments Needed"),S()(),E(64,"ul",22),Ne(65,S6e,2,1,"li",23),S()()(),Ne(66,I6e,2,0,"div",2),S()()}if(n&2){let e=le();z(5),re("ngForOf",e.exerciseDetails.images),z(),re("ngForOf",e.exerciseDetails.videos),z(5),re("ngIf",e.largeViewType==="image"),z(),re("ngIf",e.largeViewType==="video"),z(8),Ye(e.exerciseDetails.exerciseName),z(5),Tt(" ",e.exerciseDetails.exerciseType,""),z(5),Tt(" ",e.exerciseDetails.exerciseDuration," mins"),z(5),Tt(" ",e.exerciseDetails.exerciseCategory,""),z(6),Ye(e.exerciseDetails.details),z(6),re("ngForOf",e.exerciseDetails.procedures),z(6),Ye(e.exerciseDetails.benefits),z(6),Ye(e.exerciseDetails.limitations),z(6),re("ngForOf",e.exerciseDetails.equipments),z(),re("ngIf",!e.exerciseDetails)}}var KN=class n{constructor(t){this.route=t;this.currentPageUrl=`${window.location.origin}${this.router.url}`}exerciseId=null;exerciseDetails=null;exerciseName=null;data=null;showModelInLargeView=!1;email=localStorage.getItem("email");showLock=!0;sanitizer=Q(w0);authService=Q(xn);params=Q(jo);router=Q(Ut);notificationService=Q(Vn);dialog=Q(h6);largeViewSrc;proxyUrl;largeViewType="";showCommentModal=!1;commentText="";currentPageUrl;loading=!1;isModel=!0;openExerciseModal(){this.dialog.open(Tv,{width:"800px",height:"600px",panelClass:"custom-dialog-container"})}ngOnInit(){this.exerciseId=this.params.snapshot.paramMap.get("id"),this.exerciseId&&this.fetchExerciseDetails(this.exerciseId)}goToWishlist(){this.router.navigate(["/wishList"])}fetchExerciseDetails(t){this.authService.findExerciseById(t).subscribe({next:e=>{this.exerciseDetails=e,this.largeViewType="image",this.largeViewSrc=this.exerciseDetails.images[0],this.exerciseName=this.exerciseDetails.exerciseName},error:e=>console.error("Error fetching exercise details:",e)})}sanitizeUrl(t){return this.sanitizer.bypassSecurityTrustResourceUrl(t)}showInLargeView(t,e){if(e==="video"||e==="image"?this.isModel=!1:this.isModel=!0,e==="video"){this.largeViewSrc=this.sanitizeUrl(t),console.log(this.largeViewSrc),this.largeViewType=e;return}this.largeViewSrc=t,this.largeViewType=e}sharePage(){navigator.share?navigator.share({title:"Check out this exercise!",text:"Here is a detailed view of the exercise.",url:this.currentPageUrl}).then(()=>console.log("Successfully shared")).catch(t=>console.error("Error sharing:",t)):navigator.clipboard.writeText(this.currentPageUrl).then(()=>alert("Link copied to clipboard!")).catch(t=>console.error("Error copying link:",t))}static \u0275fac=function(e){return new(e||n)(Be(jo))};static \u0275cmp=Ct({type:n,selectors:[["app-exercise-details"]],decls:5,vars:1,consts:[[1,"navbar"],[1,"main"],[4,"ngIf"],["id","pc",1,"item"],[1,"item-graphics"],[1,"item-media"],[1,"media-preview-column"],["class","preview-item",4,"ngFor","ngForOf"],[1,"media-large-view-column"],[1,"sharePage",3,"click"],[1,"fa-solid","fa-share-from-square"],[1,"large-view-item"],["alt","Large View","class","large-view-image",3,"src",4,"ngIf"],["controls","","autoplay","","class","large-view-video",3,"src",4,"ngIf"],[1,"item-button"],["id","wishlist",1,"bookmarkbtn",3,"click"],[1,"item-details"],[1,"item-common-names"],[1,"center-type"],[1,"item-description"],[1,"item-header"],[1,"item-procedures"],[1,"instruments-uses"],[4,"ngFor","ngForOf"],[1,"item-instruments"],[1,"preview-item"],["alt","Modal Image",1,"preview-image",3,"click","src"],["src","https://th.bing.com/th/id/OIP.8_bri3mAg46YzGyic7aGuwHaHa?w=512&h=512&rs=1&pid=ImgDetMain","alt","image",1,"preview-image",3,"click"],["alt","Large View",1,"large-view-image",3,"src"],["controls","","autoplay","",1,"large-view-video",3,"src"]],template:function(e,r){e&1&&(E(0,"div",0),ce(1,"app-navbar"),S(),E(2,"div",1),Ne(3,E6e,67,14,"div",2),ce(4,"app-footer"),S()),e&2&&(z(3),re("ngIf",r.exerciseDetails))},dependencies:[Xr,Kn,Ln,Er],styles:['.navbar[_ngcontent-%COMP%]{background-color:var(--dark)}.main[_ngcontent-%COMP%]{min-height:90vh;position:relative}.item[_ngcontent-%COMP%]{background-color:var(--shade-2);padding:10px;display:flex;margin:20px auto;width:95%;max-width:1500px;height:100vh;max-height:700px}.item-details[_ngcontent-%COMP%]{padding:12px;width:50%;max-height:700px;overflow:auto;scrollbar-width:none;font-size:larger;background-color:var(--dark);color:var(--light)}.item-details[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:var(--shade-1)}.item-details[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{padding-left:12px}.item-details[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-bottom:4px}.item-details[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:before{font-family:"Font Awesome 6 Free";font-weight:900;font-size:22px;content:"\\f0da";margin-right:6px}.item-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;background-color:var(--light-green);padding:5px;border-radius:4px;margin-top:8px;margin-bottom:10px}.item-common-names[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-weight:600}.item-graphics[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:50%}.item-button[_ngcontent-%COMP%]{display:flex;width:100%;justify-content:center}.item-button[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:300px;border:none;border-radius:6px;height:60px;font-size:20px;font-weight:600;margin:18px 12px;border:1px solid var(--shade-1);color:var(--shade-1);background-color:transparent;position:relative}.item-button[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:var(--shade-1);color:var(--dark)}#lock[_ngcontent-%COMP%]{color:#ff4000;position:absolute;top:-10px;z-index:3;right:5px}.item-media[_ngcontent-%COMP%]{display:flex}.media-preview-column[_ngcontent-%COMP%]{width:100px;display:flex;flex-direction:column}.preview-item[_ngcontent-%COMP%]{margin-bottom:10px;width:100px;height:80px}.preview-item[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:100%;object-fit:cover;width:100%}.preview-image[_ngcontent-%COMP%], .preview-video[_ngcontent-%COMP%]{width:100%;cursor:pointer}.media-large-view-column[_ngcontent-%COMP%]{width:calc(100% - 100px);padding:15px 15px 6px;display:flex;flex-direction:column;justify-content:center;align-items:center}.sharePage[_ngcontent-%COMP%]{border:none;outline:none;background:transparent;color:var(--shade-1);text-align:end;width:100%;font-size:26px}#large-view[_ngcontent-%COMP%]{width:400px;height:400px}.large-view-item[_ngcontent-%COMP%]{width:100%;height:auto;max-height:450px;display:flex;justify-content:center;align-items:center}.large-view-3dmodel[_ngcontent-%COMP%]{width:500px;height:auto;max-height:450px}.large-view-image[_ngcontent-%COMP%]{width:100%;height:100%}.large-view-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:100%}.large-view-video[_ngcontent-%COMP%]{width:100%;height:300px}.preview-item.selected[_ngcontent-%COMP%]{border:3px solid green}.item-name[_ngcontent-%COMP%]{font-size:larger;font-weight:600;color:#003c05}.spinner[_ngcontent-%COMP%]{width:24px;height:24px;border:4px solid #ccc;border-top-color:#007bff;border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}#note-button[_ngcontent-%COMP%]{border:none;outline:none;background-color:var(--light-green);color:var(--dark);font-size:larger;padding:10px;font-weight:600;position:fixed;right:-31px;top:50%;border-radius:6px 6px 0 0;transform:rotate(-90deg)}.modal[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#000e;display:flex;justify-content:center;align-items:center;z-index:3}.modal-content[_ngcontent-%COMP%]{max-width:600px;padding:12px}.modal-content[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border-radius:4px;border:none;outline:none;padding:4px 8px;margin-right:12px;font-size:large;font-weight:500}.modal-content[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{height:200px;max-height:200px;min-height:200px;width:100%;min-width:100%;max-width:100%;padding:12px;font-size:larger;font-weight:500}.language-selector[_ngcontent-%COMP%]{padding:10px 0}.language-selector[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{margin:0 8px;padding:2px}.language-selector[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border:none;outline:none;background-color:var(--dark);color:var(--light);padding:2px 12px;border-radius:4px}.modal[_ngcontent-%COMP%]{padding:18px}.modal-content[_ngcontent-%COMP%]{height:100%;width:100%;max-width:1600px;overflow:auto;padding:12px}.editForm[_ngcontent-%COMP%]{height:90%}.editInputs[_ngcontent-%COMP%]{display:flex;flex-direction:column}.deleteInput[_ngcontent-%COMP%]{display:flex;width:100%}#map[_ngcontent-%COMP%]{height:400px;width:100%;border:1px solid #ccc;border-radius:8px}#mobile[_ngcontent-%COMP%]{display:none}.show3D[_ngcontent-%COMP%]{border:none;outline:none;background-color:transparent;color:var(--dark);font-size:larger;font-weight:600;margin-bottom:18px}.model-popup[_ngcontent-%COMP%]{background-color:#000000e0;position:fixed;inset:0;display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:4}.model-viewer-popup[_ngcontent-%COMP%]{width:100%;max-width:700px;display:flex;flex-direction:column;justify-content:center;align-items:center;background-color:#fff;border-radius:6px;height:400px;padding:12px}.model-viewer-popup[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border:none;outline:none;background-color:transparent}#edit[_ngcontent-%COMP%]{border:none;outline:none;background-color:transparent;color:var(--light);font-size:large;font-weight:600;margin-bottom:18px}.notesContent[_ngcontent-%COMP%]{max-width:700px!important}.model-viewer-popup[_ngcontent-%COMP%]   model-viewer[_ngcontent-%COMP%]{width:100%;height:100%}@media (max-width: 550px){#mobile[_ngcontent-%COMP%]{display:flex!important;flex-direction:column}#pc[_ngcontent-%COMP%]{display:none}.item[_ngcontent-%COMP%]{flex-direction:column;width:100%;padding:12px;margin:0;overflow:auto;height:100vh;max-height:100vh}.item-graphics[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%}.item-media[_ngcontent-%COMP%]{display:flex;width:100%;flex-direction:column-reverse}.media-preview-column[_ngcontent-%COMP%]{display:flex;flex-direction:row;width:100%;overflow:auto;gap:16px;margin:18px 0}.media-large-view-column[_ngcontent-%COMP%]{width:100%}.preview-item[_ngcontent-%COMP%]{margin-right:16px}.item-details[_ngcontent-%COMP%]{width:100%;overflow:hidden}#note-button[_ngcontent-%COMP%]{display:none}.item-button[_ngcontent-%COMP%]{flex-direction:column;justify-content:center;align-items:center;gap:12px}#lock[_ngcontent-%COMP%]{display:none}.item-button[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}.item-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-wrap:wrap}}.custom-dialog-container[_ngcontent-%COMP%]{background-color:#f0f0f0}']})};var Oue=[{path:"",component:NS},{path:"login",component:AS,canActivate:[hy]},{path:"signup",component:tI,canActivate:[hy]},{path:"forgot-password",component:nI,canActivate:[hy]},{path:"admin",component:rI,canActivate:[iI]},{path:"user",component:oI,canActivate:[GH]},{path:"center",component:sI,canActivate:[WH]},{path:"centers",component:aI},{path:"centerDetails/:id",component:lI},{path:"wishList",component:cI,canActivate:[ab]},{path:"exercises",component:uI,canActivate:[ab]},{path:"community",component:dI},{path:"exerciseDetails/:id",component:KN},{path:"exerciseDetection",component:Tv}];var Mue={providers:[oW({eventCoalescing:!0}),FG(Oue),MW()]};function T6e(n,t){n&1&&ce(0,"i",6)}function D6e(n,t){n&1&&ce(0,"i",7)}function k6e(n,t){n&1&&ce(0,"i",8)}function N6e(n,t){if(n&1){let e=et();E(0,"div")(1,"span",1),Ne(2,T6e,1,0,"i",2)(3,D6e,1,0,"i",3)(4,k6e,1,0,"i",4),S(),E(5,"span"),O(6),S(),E(7,"button",5),_e("click",function(){ve(e);let o=le();return be(o.closeNotification())}),O(8,"x"),S()()}if(n&2){let e=le();Q4("notification ",e.type,""),z(2),re("ngIf",e.type==="success"),z(),re("ngIf",e.type==="error"),z(),re("ngIf",e.type==="info"),z(2),Ye(e.message)}}var XN=class n{constructor(t){this.notificationService=t}message=null;type="info";ngOnInit(){this.notificationService.notification$.subscribe(t=>{t?(this.message=t.message,this.type=t.type):(this.message=null,this.type="info")})}closeNotification(){this.notificationService.clearNotification()}static \u0275fac=function(e){return new(e||n)(Be(Vn))};static \u0275cmp=Ct({type:n,selectors:[["app-notification"]],decls:1,vars:1,consts:[[3,"class",4,"ngIf"],[1,"icon"],["class","fa-solid fa-check",4,"ngIf"],["class","fa-solid fa-x",4,"ngIf"],["class","fa-solid fa-info",4,"ngIf"],[3,"click"],[1,"fa-solid","fa-check"],[1,"fa-solid","fa-x"],[1,"fa-solid","fa-info"]],template:function(e,r){e&1&&Ne(0,N6e,9,7,"div",0),e&2&&re("ngIf",r.message)},dependencies:[Ln],styles:[".notification[_ngcontent-%COMP%]{position:fixed;bottom:20px;left:50%;transform:translate(-50%);padding:15px;border-radius:5px;color:#fff;font-weight:700;z-index:1000;font-family:Roboto;background-color:#000;display:flex;justify-content:space-between}.notification[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-weight:bolder;font-size:medium;color:#fff}.icon[_ngcontent-%COMP%]{width:25px;height:25px;background-color:#c7c7c7cf;display:flex;justify-content:center;align-items:center;border-radius:50%;margin-right:10px;font-size:18px}.notification.success[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{background-color:#2d8800}.notification.error[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{background-color:#d91102}.notification.info[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{background-color:#ffc823}.notification[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background:none;border:none;color:#fff;font-weight:700;cursor:pointer;margin-left:10px}"]})};var A6e=["chatbotMessages"],R6e=(n,t)=>({user:n,bot:t});function O6e(n,t){if(n&1){let e=et();E(0,"button",3),_e("click",function(){ve(e);let o=le();return be(o.toggleChatbotWindow())}),ce(1,"img",4),S()}}function M6e(n,t){if(n&1&&(E(0,"div",19),ce(1,"div",20),S()),n&2){let e=t.$implicit;re("ngClass",mp(2,R6e,e.sender==="user",e.sender==="bot")),z(),re("innerHTML",e.text,e4)}}function P6e(n,t){n&1&&ce(0,"i",21)}function F6e(n,t){n&1&&ce(0,"i",22)}function L6e(n,t){if(n&1){let e=et();E(0,"div",5)(1,"div",6)(2,"i",7),_e("click",function(){ve(e);let o=le();return be(o.close())}),S(),E(3,"p"),O(4,"FitGenie Chatbot\xA0"),S(),ce(5,"img",8),S(),E(6,"div",9,0)(8,"div",10)(9,"p"),O(10,"Welcome to Chatbot!"),S()(),Ne(11,M6e,2,5,"div",11),S(),E(12,"div",12)(13,"textarea",13),ht("ngModelChange",function(o){ve(e);let i=le();return gt(i.userInput,o)||(i.userInput=o),be(o)}),_e("keydown.enter",function(){ve(e);let o=le();return be(o.sendMessage())}),S(),E(14,"div",14)(15,"button",15),_e("click",function(){ve(e);let o=le();return be(o.sendMessage())}),Ne(16,P6e,1,0,"i",16)(17,F6e,1,0,"i",17),S()()(),E(18,"div",18)(19,"p"),O(20,"Chatbots may make errors; please consult a doctor for accurate medical advice"),S()()()}if(n&2){let e=le();z(11),re("ngForOf",e.messages),z(2),ft("ngModel",e.userInput),z(3),re("ngIf",!e.isLoading),z(),re("ngIf",e.isLoading)}}var YN=class n{constructor(t){this.authService=t}isChatbotVisible=!1;userInput="";isLoading=!1;isBtnVisible=!0;messages=[];chatbotMessages;router=Q(Ut);toggleChatbotWindow(){this.isBtnVisible=!1,this.isChatbotVisible=!0}close(){this.isChatbotVisible=!1,this.isBtnVisible=!0,this.messages=[]}sendMessage(){let t=this.userInput.trim();t&&(this.addMessage("user",t),this.isLoading=!0,this.authService.generateResponse(t).subscribe({next:e=>{this.isLoading=!1;let r=this.formatBotResponse(e.text);this.addMessage("bot",r)},error:()=>{this.isLoading=!1,this.addMessage("bot","Error: Unable to fetch response.")}}),this.userInput="")}addMessage(t,e){this.messages.push({sender:t,text:e}),setTimeout(()=>{this.scrollToBottom()},0)}formatBotResponse(t){return t=t.replace(/[#]/g,""),t=t.replace(/\*\*(.*?)\*\*/g,"<br><b>$1</b>"),t=t.replace(/[*]/g,""),t}scrollToBottom(){let t=this.chatbotMessages.nativeElement;t.scrollTop=t.scrollHeight}static \u0275fac=function(e){return new(e||n)(Be(xn))};static \u0275cmp=Ct({type:n,selectors:[["app-chatbot"]],viewQuery:function(e,r){if(e&1&&hp(A6e,5),e&2){let o;uc(o=dc())&&(r.chatbotMessages=o.first)}},decls:2,vars:2,consts:[["chatbotMessages",""],["class","chatbot-button",3,"click",4,"ngIf"],["class","chatbot-window",4,"ngIf"],[1,"chatbot-button",3,"click"],["src","https://png.pngtree.com/png-clipart/20230820/original/pngtree-chatbot-icon-chat-bot-robot-picture-image_8080841.png","alt","","width","50px"],[1,"chatbot-window"],[1,"chatbot-header"],[1,"fa-solid","fa-arrow-left",2,"cursor","pointer",3,"click"],["src","https://cdn-icons-png.flaticon.com/512/12662/12662292.png","alt",""],[1,"chatbot-messages"],[1,"welcome"],["class","message",3,"ngClass",4,"ngFor","ngForOf"],[1,"chatbot-input"],["type","text","placeholder","Ask your query here...",3,"ngModelChange","keydown.enter","ngModel"],[1,"chatsubmit"],[3,"click"],["class","fa-solid fa-arrow-up",4,"ngIf"],["class","fa-solid fa-square",4,"ngIf"],[1,"disclaimer"],[1,"message",3,"ngClass"],[1,"text",3,"innerHTML"],[1,"fa-solid","fa-arrow-up"],[1,"fa-solid","fa-square"]],template:function(e,r){e&1&&Ne(0,O6e,2,0,"button",1)(1,L6e,21,4,"div",2),e&2&&(re("ngIf",r.isBtnVisible),z(),re("ngIf",r.isChatbotVisible))},dependencies:[yp,Ln,Fs,vo,Ho,ka,Er],styles:["html[_ngcontent-%COMP%]{position:relative}.chatbot-button[_ngcontent-%COMP%]{position:fixed;bottom:20px;right:20px;background-color:var(--shade-1);color:#fff;border:none;border-radius:50%;width:60px;height:60px;cursor:pointer;font-size:24px;text-align:center;line-height:60px;z-index:1}.chatbot-button[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:50px}.chatbot-window[_ngcontent-%COMP%]{position:fixed;bottom:40px;right:20px;width:300px;max-height:500px;height:500px;border-radius:10px;box-shadow:0 0 15px #0003;background-position:center;background-size:cover;background-repeat:no-repeat;background-image:url(https://th.bing.com/th/id/OIP.Qn5JBKK-xYUkfLxDjxnzQgHaEK?rs=1&pid=ImgDetMain);background-color:#ffffffb3;z-index:1000;overflow:hidden}.chatbot-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;font-size:larger;color:#f4f4f4;font-family:Poppins,sans-serif;padding:10px;text-align:center;font-weight:600;background-color:var(--shade-2)}.chatbot-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-bottom:0}.chatbot-header[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:30px;height:30px}.chatbot-messages[_ngcontent-%COMP%]{height:calc(100% - 170px);padding:10px;overflow-y:auto;font-size:14px;background-color:#ffffffb3}.chatbot-messages[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:160px}.welcome[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;font-size:larger;font-weight:600}.chatbot-input[_ngcontent-%COMP%]{padding:10px;display:flex;height:90px;align-items:center;justify-content:center;background-color:#ffffffb3}.chatsubmit[_ngcontent-%COMP%]{width:65px;background-color:#e1e1e1;height:60px;display:flex;align-items:center;padding-right:12px;border-radius:0 16px 16px 0}.chatbot-input[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{background-color:#e1e1e1;padding:5px 10px;border:none;border-radius:16px 0 0 16px;outline:none;overflow-y:auto;height:60px;resize:none;width:90%;font-size:medium;font-weight:500}.chatbot-input[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:5px;background-color:var(--dark);color:#fff;border:none;cursor:pointer;width:40px;height:40px;margin:2px;border-radius:50%}.chatbot-input[_ngcontent-%COMP%]   .loader[_ngcontent-%COMP%]{border:4px solid #f3f3f3;border-radius:50%;border-top:4px solid #ffffff;color:#fff;width:20px;height:20px;animation:_ngcontent-%COMP%_spin 2s linear infinite;margin:auto;right:20px;top:10px}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.message.user[_ngcontent-%COMP%]{text-align:left;margin-bottom:10px;display:flex;justify-content:flex-end}.message.user[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{background-color:var(--shade-2);color:var(--light);padding:10px;border-radius:12px;max-width:90%;font-weight:600;font-size:medium}.message.bot[_ngcontent-%COMP%]{margin-bottom:10px;display:flex}.message.bot[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{background-color:var(--shade-1);color:var(--dark);padding:10px 18px;border-radius:12px;max-width:90%;font-weight:500;font-size:medium}.disclaimer[_ngcontent-%COMP%]{font-size:x-small;font-weight:600;color:#000;background-color:#fff;font-family:Poppins,sans-serif;padding:0 4px;text-align:center}"]})};var ZN=class n{title="MediCure";static \u0275fac=function(e){return new(e||n)};static \u0275cmp=Ct({type:n,selectors:[["app-root"]],decls:4,vars:0,consts:[[1,"main"]],template:function(e,r){e&1&&(E(0,"div",0),ce(1,"router-outlet")(2,"app-notification")(3,"app-chatbot"),S())},dependencies:[GO,XN,YN],encapsulation:2})};jW(ZN,Mue).catch(n=>console.error(n));
